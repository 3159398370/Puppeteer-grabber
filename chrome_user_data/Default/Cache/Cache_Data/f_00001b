(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["main-group~workbench-group"],{"002c":function(e,t,s){},"06eb":function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"f",(function(){return r})),s.d(t,"d",(function(){return l})),s.d(t,"h",(function(){return n})),s.d(t,"c",(function(){return o})),s.d(t,"g",(function(){return c})),s.d(t,"k",(function(){return d})),s.d(t,"e",(function(){return u})),s.d(t,"i",(function(){return p})),s.d(t,"a",(function(){return m})),s.d(t,"j",(function(){return h}));var a=s("dde5");const i=e=>Object(a["c"])("api/bid","createBidTask",e),r=e=>Object(a["c"])("api/bid","listBidTasks",e),l=e=>Object(a["c"])("api/bid","editBidTask",e),n=e=>Object(a["c"])("api/bid","rollBackBidTask",e),o=e=>Object(a["c"])("api/formal","createFormalTaskBatch",e),c=e=>Object(a["c"])("api/formal","listFormalTasks",e),d=e=>Object(a["c"])("api/formal","updateFormalTask",e),u=e=>Object(a["c"])("api/formal","getRecoverCount",e),p=e=>Object(a["c"])("api/formal","recoverDetails",e),m=e=>Object(a["c"])("api/formal","appendDataSetToFormalTask",e),h=e=>Object(a["c"])("api/report","statTaskProgress",e)},"121d":function(e,t,s){},"15cc":function(e,t,s){"use strict";s("4034")},2339:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{"mask-closable":!1,width:600},on:{"on-cancel":function(t){e.visible=!1,e.successStatus&&e.$emit("refresh")}},scopedSlots:e._u([{key:"header",fn:function(){return[e.successStatus?s("h3",[e._v("提交结果")]):[s("h3",[e._v("导出配置")]),e.title?s("div",{staticClass:"txt-muted mtm"},[e._v(e._s(e.title))]):e._e()]]},proxy:!0}]),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[1===e.successStatus?s("div",{staticClass:"export_result"},[s("div",{staticClass:"export__icon mbs success"},[s("Icon",{attrs:{type:"ios-checkmark",size:"50",color:"white"}})],1),s("h3",[e._v("提交成功")]),"tasks"===e.objType?s("div",{staticClass:"mtm"},[s("div",{staticClass:"txt-muted"},[e._v("成功"+e._s(e.obj.length-e.errorMessage.length)+"条，失败"+e._s(e.errorMessage.length)+"条")])]):e._e(),s("div",{staticClass:"mtm"},[s("div",{staticClass:"txt-muted"},[e._v("可前往【项目详情-导出管理】查看导出进度")])])]):2===e.successStatus?s("div",{staticClass:"export_result"},[s("div",{staticClass:"export__icon mbs warning"},[s("Icon",{attrs:{type:"ios-information",size:"50",color:"white"}})],1),s("h3",[e._v("提交完毕")]),"tasks"===e.objType?s("div",{staticClass:"mtm"},[s("div",{staticClass:"txt-muted"},[e._v("成功"+e._s(e.obj.length-e.errorMessage.length)+"条，失败"+e._s(e.errorMessage.length)+"条")])]):e._e(),e.errorMessage.length?s("div",{staticClass:"mtm error-message"},[s("div",{staticClass:"txt-muted"},[e._v("失败明细：")]),e._l(e.errorMessage,(function(t){return s("div",{staticClass:"txt-muted"},[e._v(e._s(t))])}))],2):e._e()]):s("div",[s("Alert",{staticClass:"mbm",scopedSlots:e._u([{key:"desc",fn:function(){return[s("p",[e._v("您可在导出后前往【项目详情 - 导出管理】查看导出进度并下载")])]},proxy:!0}])},[s("Row",{attrs:{type:"flex",justify:"start",align:"middle"}},[s("Icon",{attrs:{type:"ios-alert",color:"#2d8cf0"}}),s("h4",{staticClass:"mls"},[e._v("说明")])],1)],1),s("div",{staticClass:"export-edit"},[s("Form",{ref:"editForm",staticClass:"mlm",attrs:{model:e.form,"label-width":100,"label-position":"left"}},[s("FormItem",{attrs:{label:"导出内容"}},[s("RadioGroup",{model:{value:e.form.export_info,callback:function(t){e.$set(e.form,"export_info",t)},expression:"form.export_info"}},[s("Radio",{attrs:{label:"label"}},[e._v("仅标注结果")]),s("Radio",{attrs:{label:"label_resource",disabled:!e.isLabelSourceEnabled||"tasks"===e.objType}},["tasks"===e.objType?s("span",{staticClass:"txt-muted"},[e._v("标注结果 + 资源文件（批量导出暂不支持）")]):e.isLabelSourceEnabled?s("span",[e._v("标注结果 + 资源文件")]):s("span",{staticClass:"txt-muted"},[e._v("标注结果 + 资源文件（当前模板暂不支持）")])])],1)],1),s("FormItem",{attrs:{label:"标注结果格式"}},[s("RadioGroup",{model:{value:e.form.export_format,callback:function(t){e.$set(e.form,"export_format",t)},expression:"form.export_format"}},[e.isLabelSourceSelected?[s("Radio",{attrs:{label:"json"}},[e._v("JSON")])]:[["task","tasks","deliver"].includes(e.objType)?s("Radio",{attrs:{label:"json"}},[e._v("JSON")]):e._e(),s("Radio",{attrs:{label:"csv"}},[e._v("CSV")]),s("Radio",{attrs:{label:"xml"}},[e._v("XML")]),["task","deliver"].includes(e.objType)?s("Radio",{attrs:{label:"yolo"}},[e._v("YOLO")]):e._e()]],2),"yolo"===e.form.export_format?s("div",{staticStyle:{"font-size":"12px"}},[s("span",[e._v("交付文件命名规则：")]),s("RadioGroup",{attrs:{size:"small"},model:{value:e.form.use_primary_key,callback:function(t){e.$set(e.form,"use_primary_key",t)},expression:"form.use_primary_key"}},[s("Radio",{attrs:{label:0}},[e._v("按任务明细ID")]),s("Radio",{attrs:{label:1}},[e._v("按主键")])],1)],1):e._e(),"csv"===e.form.export_format?s("div",{staticClass:"csv-options"},[s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("span",[e._v("展开元素标签")]),s("i-switch",{attrs:{size:"small"},model:{value:e.form.isExtendElementTag,callback:function(t){e.$set(e.form,"isExtendElementTag",t)},expression:"form.isExtendElementTag"}})],1),e.task&&e.task.cross_num<2?s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("span",[e._v("导出历史版本")]),s("i-switch",{attrs:{size:"small"},model:{value:e.form.allLabelVersion,callback:function(t){e.$set(e.form,"allLabelVersion",t)},expression:"form.allLabelVersion"}})],1):e._e(),s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("span",[e._v("字段超长自动截断（适用于excel打开场景）")]),s("i-switch",{attrs:{size:"small"},model:{value:e.form.isTruncateItemContent,callback:function(t){e.$set(e.form,"isTruncateItemContent",t)},expression:"form.isTruncateItemContent"}})],1),s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("span",[e._v("特殊字符自动转义（如：回车符导出后转换为\\n）")]),s("i-switch",{attrs:{size:"small"},model:{value:e.form.isEscaped,callback:function(t){e.$set(e.form,"isEscaped",t)},expression:"form.isEscaped"}})],1)],1):e._e()],1),s("FormItem",{attrs:{label:"导出方式"}},[s("RadioGroup",{on:{"on-change":e.handleStorageType},model:{value:e.form.storage_type,callback:function(t){e.$set(e.form,"storage_type",t)},expression:"form.storage_type"}},[e.isSafetyBucket?s("Radio",{attrs:{label:"aioss"}},[s("span",{staticClass:"txt-green"},[e._v("AIdata安全桶")])]):e.project&&!e.project.project_type?s("Radio",{attrs:{label:"local"}},[s("span",[e._v("直接导出")])]):e.isAidataBucket?s("Radio",{attrs:{label:"aioss"}},[s("span",[e._v("AIdata需求单")])]):e._e()],1),"aioss"===e.form.storage_type?[s("Card",{staticClass:"card",attrs:{"dis-hover":"",padding:7}},[e.fetchAiossBucket.isPending?[s("Spin",{attrs:{fix:""}})]:e.fetchAiossBucket.isRejected?[s("p",{staticClass:"txt-red"},[e.fetchAiossBucket.rejectedWith.message.trim()?s("span",[e._v(e._s(e.fetchAiossBucket.rejectedWith.message))]):s("span",[e._v("获取路径失败")])])]:[e.aiossBucket?[s("p",[s("span",{staticClass:"txt-muted"},[e._v("默认存储到")]),e.isSafetyBucket?s("span",[e._v("指定安全桶 ("+e._s(e.aiossBucket.bucket_id)+")")]):e.isAidataBucket?s("span",[e._v("当前需求单（"+e._s(e.project.ai_order_code)+"）的【文件信息】")]):e._e()]),"tasks"!==e.objType?s("p",[s("span",{staticClass:"txt-muted"},[e._v("路径为：")]),s("span",[e._v(e._s(e.aiossBucket.bucket_name))])]):e._e()]:[s("p",{staticClass:"txt-muted"},[e.isSafetyBucket?s("span",[e._v("没有获取到相关的安全桶路径")]):e.isAidataBucket?s("span",[e._v("没有获取到相关的需求单路径")]):e._e()])]]],2)]:e._e()],2)],1)],1)],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:function(t){e.visible=!1,e.successStatus&&e.$emit("refresh")}}},[e._v("取消")]),e.successStatus?s("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.gotoProject}},[e._v("前往查看")]):[["task","deliver"].includes(e.objType)?s("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.submit}},[e._v("确认并导出")]):e._e(),"tasks"===e.objType?s("Button",{attrs:{type:"primary",loading:e.fetchMultiExport.isPending},on:{click:function(t){return e.submit({multi:!0})}}},[e._v("确认并批量导出")]):e._e()]],2)])},i=[],r=(s("8d0d"),s("9ec3")),l=s("175d"),n=s("cb78"),o=s("b0f9"),c=s("db49"),d={props:{defaultData:Object,obj:[Object,Array],objType:String,jqueryPre:String,title:String,projectId:[Object,Number,String],project:Object},data(){return{Config:c["a"],visible:!0,successStatus:0,errorMessage:[],form:{storage_area:"tdw",export_info:"label",export_format:"csv",storage_type:"",bucket:"disk",bucket_id:null,bucket_name:null,storage_path:"",use_primary_key:0,isExtendElementTag:!1,allLabelVersion:!1,isTruncateItemContent:!0,isEscaped:!0},bucketList:[],exportTargets:{},isLabelSourceEnabled:!1}},computed:{loading(){return this.fetchExportTaskDetailsJSON.isPending||this.fetchExportTaskDetailsCSV.isPending||this.fetchExportTaskDetailsXML.isPending||this.fetchExportTaskDetailsYolo.isPending},isLabelSourceSelected(){const{form:e}=this;return["label_resource"].includes(e.export_info)},isAidataBucket(){const{Config:e,project:t}=this;return e.STORAGE_AIOSS_ENABLED&&t&&t.project_type&&t.ai_order_code},isSafetyBucket(){const{Config:e,project:t}=this;return e.STORAGE_AIOSS_ENABLED&&t&&t.safety_bucket_id}},watch:{isLabelSourceSelected(){this.form.export_format="json"}},async mounted(){const{project:e,form:t}=this;if(["task","deliver"].includes(this.objType)){const e=await this.fetchTask();if(e){const e=await this.fetchTemplate();if(e){const t=JSON.parse(e.template_schema),s=Object(r["find"])(t,{type:"url"});this.isLabelSourceEnabled=s&&s.url_dump&&!s.parent_id}}}e&&(this.isSafetyBucket||e.project_type?(this.fetchAiossBucket(),t.storage_type="aioss"):t.storage_type="local")},methods:{submit(e){if(!this.form.storage_type)return this.$Message.warning("请选择导出方式"),0;if(null!==e&&void 0!==e&&e.multi)return this.fetchMultiExport();if("aioss"===this.form.storage_type&&!this.aiossBucket)return this.$Message.warning("导出路径不能为空"),0;switch(this.form.export_format){case"json":this.fetchExportTaskDetailsJSON();break;case"csv":this.fetchExportTaskDetailsCSV();break;case"xml":this.fetchExportTaskDetailsXML();break;case"yolo":this.fetchExportTaskDetailsYolo();break}},gotoProject(){window.open(`projects/list/${this.projectId}?tab=export`,"_self")},getQurry(){let e=this.jqueryPre+"&storageType=aioss";return this.isLabelSourceSelected&&"json"===this.form.export_format&&(e+="&includeSource=1"),e},getQuery(e){let t="";const{form:s}=this;return e.forEach(e=>{t+=`&${e}=${s[e]}`}),t},handleStorageType(e){"aioss"===e&&this.fetchAiossBucket()},localDownload(){this.$Message.info("导出中..."),this.visible=!1}},asyncMethods:{fetchBucketList(){const e={scene:this.form.bucket};return Object(l["r"])(e).then(e=>e.data).catch(e=>{this.$Message.error("存储桶获取失败："+e.message)})},fetchAiossBucket(){const{project:e,obj:t}=this,s={project_id:e.project_id,task_id:Object(r["isArray"])(t)?t[0].task_id:t.task_id};return Object(l["q"])(s).then(e=>e||"")},fetchExportTaskDetailsJSON(){return Object(l["c"])(this.getQurry(this.jqueryPre)).then(e=>{console.log(e),this.$Message.success("转存成功"),this.successStatus=1}).catch(e=>{console.log(e),this.$Message.success("转存成功"),this.successStatus=1})},fetchExportTaskDetailsCSV(){const e=["isExtendElementTag","allLabelVersion","isTruncateItemContent","isEscaped"],t=this.getQurry(this.jqueryPre),s=`${t}${this.getQuery(e)}${t.includes("cycleStep")?"":"&cycleStep=1"}`;return console.log(s),Object(l["b"])(s).then(()=>{console.log(),this.$Message.success("转存成功"),this.successStatus=1}).catch(e=>{console.log(e),this.$Message.success("转存成功"),this.successStatus=1})},fetchExportTaskDetailsXML(){return Object(l["d"])(this.getQurry(this.jqueryPre)).then(()=>{this.$Message.success("转存成功"),this.successStatus=1}).catch(e=>{console.log(e),this.$Message.success("转存成功"),this.successStatus=1})},fetchExportTaskDetailsYolo(){const e=new URLSearchParams(this.jqueryPre),t=this.getQurry(this.jqueryPre)+(1===this.form.use_primary_key?"&usePrimaryKey=true":"&usePrimaryKey=false");return n["a"].CheckDownloadStatus({project_id:e.get("projectId"),task_id:e.get("taskId")}).then(e=>{if(e.data.result.download)return Object(l["e"])(t).then(()=>{this.$Message.success("转存成功"),this.successStatus=1}).catch(e=>{console.log(e),this.$Message.success("转存成功"),this.successStatus=1});this.$Message.error("导出失败，此任务不支持导出yolo格式")}).catch(t=>{e.has("projectId")&&e.has("taskId")?this.$Message.error("导出失败："+t):this.$Message.error("导出失败：参数缺失")})},fetchMultiExport(){let e="",t=null;const{form:s}=this;switch(s.export_format){case"json":e=""+this.getQurry(this.jqueryPre),t=async e=>await Object(l["c"])(e);break;case"csv":{const s=["isExtendElementTag","allLabelVersion","isTruncateItemContent","isEscaped"],a=this.getQurry(this.jqueryPre);e=`${a}${this.getQuery(s)}${a.includes("cycleStep")?"":"&cycleStep=1"}`,t=async e=>await Object(l["b"])(e)}break;case"xml":e=""+this.getQurry(this.jqueryPre),t=async e=>await Object(l["d"])(e);break;case"yolo":break}return Promise.allSettled(this.obj.map(s=>t(`${e}&taskId=${s.task_id.toString()}`))).then(e=>{console.log(e);let t=0;e.forEach((e,s)=>{var a,i,r,l;null!==(a=e.value)&&void 0!==a&&null!==(i=a.data)&&void 0!==i&&i.result&&(t+=1),null!==(r=e.value)&&void 0!==r&&null!==(l=r.data)&&void 0!==l&&l.error&&this.errorMessage.push(`[任务${this.obj[s].task_id}] ${e.value.data.error.message}`),"rejected"===e.status&&(t+=1)}),this.successStatus=e.length===t?1:2}).catch(e=>{console.log(e),this.successStatus=1})},fetchTask(){const e={task_id:this.obj.task_id};return n["a"].GetTask(e).then(e=>e.data.result)},fetchTemplate(){const e={template_id:this.task.template_id};return Object(o["k"])(e).then(e=>e)}}},u=d,p=(s("5942"),s("2be6")),m=Object(p["a"])(u,a,i,!1,null,"5a20d8d1",null);t["a"]=m.exports},2537:function(e,t,s){},"259f":function(e,t,s){"use strict";var a=s("312d"),i=s("9ec3");t["a"]={props:["value"],render(e){const{value:t}=this,s=Object(i["find"])(Object(i["values"])(a["f"]),{value:t});if(s)switch(t){case a["f"].INIT.value:return e("Badge",{props:{}},s.text);case a["f"].WAIT_APPROVE.value:return e("Tag",{attrs:{color:"default"}},s.text);case a["f"].APPROVING.value:return e("Tag",{attrs:{color:"blue"}},s.text);case a["f"].PASS_APPROVE.value:return e("Tag",{attrs:{color:"success"}},s.text);case a["f"].UPDATE_APPROVE.value:return e("Tag",{attrs:{color:"orange"}},s.text);case a["f"].REJECT_APPROVE.value:return e("Tag",{attrs:{color:"error"}},s.text);default:return e("Tag",{props:{color:"default"}},s.text)}return e("Badge",{props:{}},"-")}}},"26b3":function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var a=s("dde5"),i=s("9ec3"),r=s("312d");const l={...r["h"]},n={...r["i"]},o=e=>Object(a["c"])("api","listFlowLogs",e).then(e=>(e.data=Object(i["map"])(e.data,e=>{const t=e;return t.flow_action_text=(l[e.flow_action]||{text:"未知动作"}).text,t.flow_step_text=(n[e.flow_step]||{text:"未知状态"}).text,t}),e))},"2c88":function(e,t,s){"use strict";s.d(t,"j",(function(){return l})),s.d(t,"q",(function(){return n})),s.d(t,"g",(function(){return o})),s.d(t,"n",(function(){return c})),s.d(t,"d",(function(){return d})),s.d(t,"e",(function(){return u})),s.d(t,"a",(function(){return p})),s.d(t,"b",(function(){return m})),s.d(t,"h",(function(){return h})),s.d(t,"o",(function(){return _})),s.d(t,"k",(function(){return f})),s.d(t,"m",(function(){return v})),s.d(t,"l",(function(){return b})),s.d(t,"f",(function(){return k})),s.d(t,"r",(function(){return y})),s.d(t,"i",(function(){return g})),s.d(t,"c",(function(){return T})),s.d(t,"s",(function(){return j})),s.d(t,"p",(function(){return O}));var a=s("dde5");const i="qlabel.Dataset",r=e=>Object(a["e"])(i,"IsGray",e).catch(()=>({is_gray:!1})),l=e=>Object(a["c"])("api/datahouse","listDataset",e),n=e=>Object(a["c"])("api/datahouse","modifyDataset",e),o=e=>Object(a["c"])("api/datahouse","deleteDataset",e),c=e=>Object(a["c"])("api/datahouse","listDatasetTask",e),d=async e=>{const{is_gray:t}=await r({method:"CreateDatasetFromFile"});if(t){const t={dataset_name:e.dataset_name,file_info:e.file_list,dataset_code:e.dataset_code,template_id:e.template_id};return Object(a["e"])("qlabel.Dataset","CreateDatasetFromFile",t)}return Object(a["c"])("api/datahouse","createDatasetTask",e)},u=async e=>{const{is_gray:t}=await r({method:"CreateDatasetFromURL"});if(t){const t={url:e.url,dataset_name:e.dataset_name,template_id:e.template_id};return Object(a["e"])("qlabel.Dataset","CreateDatasetFromURL",t)}return Object(a["c"])("api/datahouse","createDatasetUrlTask",e)},p=async e=>{const{is_gray:t}=await r({method:"AppendTaskToDataset",dataset_code:e.dataset_code});if(t){const t={file_info:e.file_list,dataset_code:e.dataset_code};return Object(a["e"])("qlabel.Dataset","AppendTaskToDataset",t)}return Object(a["c"])("api/datahouse","appendDatasetTask",e)},m=async e=>{const{is_gray:t}=await r({method:"AppendTaskFromURLToDataset",dataset_import_id:e.dataset_import_id});if(t){const t={url:e.url,dataset_code:e.dataset_code};return Object(a["e"])("qlabel.Dataset","AppendTaskFromURLToDataset",t)}return Object(a["c"])("api/datahouse","appendDatasetUrlTask",e)},h=e=>Object(a["c"])("api/datahouse","deleteDatasetTask",e),_=e=>Object(a["c"])("api/datahouse","listImportTaskProcess",e),f=e=>Object(a["c"])("api/datahouse","listDatasetData",e),v=e=>Object(a["c"])("api/datahouse","listDatasetSchema",e),b=e=>Object(a["c"])("api/datahouse","listDatasetHandleTask",e),k=e=>Object(a["c"])("api/datahouse","createHandleTask",e),y=e=>Object(a["c"])("api/datahouse","retryHandleTask",e),g=e=>Object(a["c"])("api/datahouse","deleteHandleTask",e),T=e=>Object(a["c"])("api/datahouse","createDatasetByHandleTask",e),j=e=>Object(a["c"])("api/datahouse","statTotal",e),O=e=>Object(a["c"])("api/datahouse","listRelatedImportTasks",e)},"2fa2":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{"line-height":"1"}},[0===e.validIndex?s("a",{on:{click:function(t){return e.validate()}}},[e._v("点击校验")]):s("Alert",{staticClass:"alert",attrs:{type:e.loading?"info":3===e.validIndex?"success":"error","show-icon":""}},[e.loading?s("span",[e._v("校验中……")]):s("Row",{attrs:{type:"flex",justify:"space-between"}},[s("div",{staticClass:"left"},[e._v(e._s(e.validOptions[e.validIndex]))]),2===e.validIndex?s("div",{staticClass:"right"},[s("a",{staticClass:"mlm",on:{click:function(t){e.visible=!0}}},[e._v("查看原因")]),s("a",{staticClass:"mlm",on:{click:function(t){return e.validate()}}},[e._v("重试")])]):e._e(),1===e.validIndex?s("div",{staticClass:"right"},[s("a",{staticClass:"mlm",on:{click:function(t){return e.validate()}}},[e._v("点击校验")])]):e._e()])],1),s("Modal",{attrs:{width:"600","footer-hide":""},on:{"on-cancel":function(t){e.visible=!1}},scopedSlots:e._u([{key:"header",fn:function(){return[s("Row",{staticClass:"mts mbs",attrs:{type:"flex",align:"middle"}},[s("Icon",{attrs:{type:"ios-close-circle-outline",color:"#ed4014",size:"22"}}),s("h4",{staticClass:"mls"},[e._v(e._s(e.validOptions[e.validIndex]))])],1)]},proxy:!0}]),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.isValid&&!e.isValidOk?[s("Table",{attrs:{columns:e.columns,data:e.template},scopedSlots:e._u([{key:"key",fn:function(t){var a=t.row;return[s("span",{class:!0===e.validField(a)?"txt-red":""},[e._v(e._s(a.key))])]}},{key:"reason",fn:function(t){var a=t.row;return[e.validField(a)?[s("span",{staticClass:"txt-red",domProps:{innerHTML:e._s(e.validField(a).length>0?e.validFieldContent(a):"字段缺失")}})]:s("span")]}}],null,!1,1538081782)}),s("br")]:e._e()],2)],1)},i=[],r=s("9ec3"),l=s("2c88"),n=s("b0f9"),o={props:{datasetCode:[String,Object],templateId:[String,Number,Object]},data(){return{isValid:!1,isValidOk:!1,loading:!1,validOptions:["点击校验","当前模板发生变化，请重新校验","校验失败","校验通过！"],validRules:{element_type:"元素类型",key:"KEY",name:"名称",primary:"主键",required:"必填",type:"类型",url_type:"媒体类型",url_dump:"是否转存"},columns:[{title:"KEY（标注数据包）",slot:"key",width:200},{title:"错误原因（对比模板不一致的地方）",slot:"reason"}],escapeOptions:{1:"是",0:"否","":"空",true:"是",false:"否",image:"图片",audio:"音频",video:"视频",web:"网页",model:"3D",mixed:"混合类型"},visible:!1}},computed:{validIndex(){const{isValid:e,isValidOk:t}=this;return parseInt(`${+e}${+t}`,2)},validField(){return function(e){let t=!1;const s=Object(r["find"])(this.dataset,t=>t.key===e.key);return s?Object(r["forIn"])(s,(a,i)=>{this.validRules[i]&&(console.log(`${i}: ${e[i]}, ${a}, ${e[i]==a}`),e[i]!=a&&(s.type!=e.type||"url"==s.type||"url_type"!==i&&"url_dump"!==i)&&("boolean"===typeof t&&(t=[]),t.push({key:this.validRules[i],dataset:a,template:e[i]})))}):t=!0,console.log("---"),t}},validFieldContent(){const{escapeOptions:e}=this;return function(t){let s="";return Object(r["map"])(this.validField(t),t=>{s+=`<p>"${t.key}"不一致（数据包为${e[t.dataset]||t.dataset}，模板为${e[t.template]||t.template}）; </p>`}),s}}},watch:{validIndex(e){this.$emit("update:index",e)},datasetCode(){this.reset()},templateId(){this.reset()}},mounted(){window.addEventListener("message",this.onEventListener)},destroyed(){window.removeEventListener("message",this.onEventListener)},methods:{reset(){this.isValid=!1,this.isValidOk=!1},async validate(){this.loading=!0;const e=await this.fetchDataset(),t=await this.fetchTemplate();if(e&&t){let s=!0;if(e.length!==t.length)return s=!1,this.isValid=!0,this.isValidOk=!1,this.loading=!1,void this.$Message.error("数据包与模板列数不一致");const a=Object(r["map"])(t,e=>{this.validField(e)&&(s=!1)});a&&(this.isValid=!0,this.loading=!1,s?this.isValidOk=!0:(this.isValidOk=!1,this.visible=!0))}},onEventListener(e){e.origin===window.origin&&"update-template-validate"===e.data&&(this.isValid=!1,this.isValidOk=!0)}},asyncMethods:{fetchDataset(){const e={dataset_code:this.datasetCode};return Object(l["m"])(e).then(e=>e).catch(e=>{console.log(e),this.$Message.error("获取数据包字段失败："+e.message)})},fetchTemplate(){const e={template_id:this.templateId};return Object(n["k"])(e).then(e=>{const t=JSON.parse(null===e||void 0===e?void 0:e.template_schema)||[];return Object(r["map"])(t,e=>{void 0===e.url_type&&this.$set(e,"url_type",""),void 0===e.url_dump&&this.$set(e,"url_dump","url"===e.type?1:0)}),t}).catch(e=>{console.log(e),this.$Message.error("获取模板详情失败："+e.message)})}}},c=o,d=(s("dda7"),s("2be6")),u=Object(d["a"])(c,a,i,!1,null,"27e20adb",null);t["a"]=u.exports},"30ac":function(e,t,s){"use strict";s.d(t,"e",(function(){return l})),s.d(t,"h",(function(){return n})),s.d(t,"f",(function(){return h})),s.d(t,"d",(function(){return u})),s.d(t,"g",(function(){return m})),s.d(t,"a",(function(){return _})),s.d(t,"c",(function(){return p})),s.d(t,"b",(function(){return f}));var a=s("dde5"),i=s("99f8");const r="qlabel.Dataset",l=e=>Object(a["e"])(r,"IsGray",e).catch(()=>({is_gray:!1})),n=e=>e.url?o(e):e.file_list?c(e):e.tdw_sql?d(e):Object(a["c"])("api/project","submitImportTask",e),o=e=>Object(a["e"])(r,"SubmitImportTaskFromURL",{...e,dataset_name:`${e.project_id}_${Date.now()}`},{instance:(t=e)=>Object(a["c"])("api/project","submitImportTask",t)}),c=e=>{const{file_list:t,...s}=e;return Object(a["e"])(r,"SubmitImportTaskFromFile",{...s,dataset_name:`${e.project_id}_${Date.now()}`,file_info:t},{instance:(t=e)=>Object(a["c"])("api/project","submitImportTask",t)})},d=e=>{const{file_list:t,...s}=e;return Object(a["e"])(r,"SubmitImportTaskFromTdw",{...s,dataset_name:`${e.project_id}_${Date.now()}`},{instance:(t=e)=>Object(a["c"])("api/project","submitImportTask",t)})},u=e=>Object(a["e"])(r,"GetImportTaskUploadToken",{import_task_id:e.import_task_id},{extra:{dataset_import_id:e.import_task_id},instance:(t={prefix:e.path})=>Object(a["c"])("api/cos","getTmpSecret",t).then(t=>{const{credentials:s,...a}=t;return{...a,token:{secret_id:s.tmp_secret_id,secret_key:s.tmp_secret_key,session_token:s.session_token},upload_path:e.path}})}),p=e=>Object(a["e"])(r,"FinishImportTaskUpload",{import_task_id:e.dataset_import_id},{extra:e,instance:(t=e)=>Object(a["c"])("api/datahouse","finishUpload",t)}),m=e=>Object(a["e"])(r,"RetryImportTask",e,{extra:e,instance:(t=e)=>Object(a["c"])("api/datahouse","retryDatasetProcess",t)}),h=e=>Object(a["e"])(r,"ListImportTaskProcess",e),_=e=>Object(a["e"])(r,"EffectiveSuccessData",e,{extra:e,instance:(t=e)=>Object(a["c"])("api/datahouse","effectiveSuccessData",t)}),f=async(e,t)=>{const{is_gray:s}=await l({method:"export-source-file",dataset_import_id:e.dataset_import_id});if(s){const s={project_id:e.project_id,import_task_id:e.dataset_import_id,dataset_code:e.dataset_code};return Object(i["a"])({url:"/api/dataset/v2/export/export-source-file",data:s,failCallback:t})}return Object(i["a"])({url:"api/export/download-source-file",data:e,failCallback:t})}},"312d":function(e,t,s){"use strict";s.d(t,"i",(function(){return a})),s.d(t,"m",(function(){return i})),s.d(t,"q",(function(){return r})),s.d(t,"p",(function(){return l})),s.d(t,"f",(function(){return n})),s.d(t,"g",(function(){return o})),s.d(t,"a",(function(){return c})),s.d(t,"c",(function(){return d})),s.d(t,"b",(function(){return u})),s.d(t,"h",(function(){return p})),s.d(t,"r",(function(){return m})),s.d(t,"k",(function(){return h})),s.d(t,"o",(function(){return _})),s.d(t,"n",(function(){return f})),s.d(t,"l",(function(){return v})),s.d(t,"d",(function(){return b})),s.d(t,"e",(function(){return k})),s.d(t,"j",(function(){return y}));const a={INIT:{value:0,text:"未接单"},WAIT_LABEL:{value:10,text:"待标注"},WAIT_RELABEL:{value:15,text:"待返修"},LABELING:{value:20,text:"标注中"},RELABELING:{value:25,text:"返修中"},WAIT_REVIEW:{value:30,text:"未质检"},REVIEWING:{value:40,text:"质检中"},REVIEWED:{value:50,text:"质检通过"},PASS_APPROVE:{value:60,text:"验收通过"},REJECT_APPROVE:{value:70,text:"验收不通过"}},i={WAIT_LABEL:{value:10,text:"待标注"},LABELING:{value:20,text:"标注中"},LABELED:{value:30,text:"已标注"}},r={INIT:{value:0,text:"-"},WAIT_REVIEW:{value:30,text:"待质检"},REVIEWING:{value:40,text:"质检中"},REVIEWED:{value:50,text:"质检通过"},REJECT_REVIEW:{value:15,text:"质检不通过"}},l={REJECT_REVIEW:{value:"REJECT_REVIEW",text:"不通过"},PASS_REVIEW:{value:"PASS_REVIEW",text:"通过"},EDIT_REVIEW:{value:"EDIT_REVIEW",text:"修改通过"}},n={INIT:{value:0,text:"-"},WAIT_APPROVE:{value:30,text:"待质检"},APPROVING:{value:40,text:"质检中"},PASS_APPROVE:{value:50,text:"质检通过"},REJECT_APPROVE:{value:15,text:"质检不通过"},UPDATE_APPROVE:{value:60,text:"修改通过"}},o={WAIT_DELIVER:{value:0,text:"待交付"},DELIVERED:{value:1,text:"已交付"}},c={WAIT_AUDIT:{value:0,text:"待审核"},AUDITED:{value:1,text:"已审核"}},d={PROCESSING:{value:0,text:"进行中"},DELIVERED:{value:10,text:"已完成"},INVALID:{value:20,text:"已失效"}},u={WAIT_DELIVER:{value:10,text:"待交付"},WAIT_AUDIT:{value:20,text:"待审核"},WAIT_APPROVE:{value:30,text:"待验收"},APPROVED:{value:60,text:"验收通过"},REJECTED:{value:70,text:"验收驳回"}},p={QUEUE_LABEL:{text:"开始标注"},SAVE_LABEL:{text:"保存标注结果"},UPDATE_LABEL:{text:"更新标注结果"},SUBMIT_LABEL:{text:"提交标注结果"},SUBMIT_RELABEL:{text:"提交返修标注"},QUEUE_REVIEW:{text:"开始质检"},PASS_REVIEW:{text:"质检通过"},EDIT_REVIEW:{text:"质检修改"},REJECT_REVIEW:{text:"质检驳回"},PASS_APPROVE:{text:"验收通过"},REJECT_APPROVE:{text:"验收不通过"},SKIP_LABEL:{text:"跳过标注题目"},RETURN_LABEL:{text:"退回标注题目"},SKIP_REVIEW:{text:"跳过质检题目"},RETURN_REVIEW:{text:"退回质检题目"},ADMIN_TRANS_DETAIL:{text:"管理员操作"},ADMIN_TRANS_WAIT_RELABEL:{text:"打回标注"},ADMIN_TRANS_LABELED:{text:"重新质检"},PAUSE:{text:"暂停"},RESUME:{text:"继续"},QUEUE_RELABEL:{text:"返修标注"},QUEUE_RE_REVIEW:{text:"复检"},RE_REVIEW:{text:"重新质检"},VIEW_LABEL:{text:"进入我的标注详情页"},EDITING_LABEL:{text:"进入重新标注状态"},VIEW_REVIEW:{text:"进入我的质检详情页"},EDITING_REVIEW:{text:"进入重新质检状态"},PRE_AUTO_VALIDATE:{text:"机审校验"}},m={INIT:{value:0,text:"草稿中"},WAIT_ACCEPT:{value:10,text:"待接单"},LABELING:{value:20,text:"进行中"},FINISHED:{value:40,text:"已完成"},REJECTED:{value:50,text:"已放弃"}},h={DRAFT:{value:0,text:"待确认"},WAITING:{value:1,text:"候选中"},WINBID:{value:2,text:"已中标"},VOID:{value:3,text:"作废"},NOWINBID:{value:4,text:"未中标"},ACCEPTBID:{value:5,text:"已确认中标"}},_={DRAFT:{value:0,text:"草稿中"},WAIT_APPROVE:{value:10,text:"待审批"},PROCESSING:{value:20,text:"进行中"},CLOSED:{value:30,text:"已关闭"},REJECT:{value:40,text:"审批不通过"},WAIT_SUPPLIER:{value:50,text:"确认供应商"}},f={DRAFT:{text:"保存草稿"},WAIT_APPROVE:{text:"提交审批"},WAIT_SUPPLIER:{text:"待确认供应商"},PROCESSING:{text:"审批通过"},CLOSED:{text:"关闭项目"},REJECT:{text:"审批不通过"}},v={PENDING:{value:0,text:"待投放"},PROCSSING:{value:10,text:"进行中"},FINISHED:{value:20,text:"已完成"},REJECT:{value:30,text:"数据已删除"}},b={INIT:{value:1,text:"申请中"},SUCCEED:{value:2,text:"申请成功"},CENCEL:{value:4,text:"已取消"},FAILED:{value:3,text:"驳回"}},k={CREATE:{text:"创建数据集"},MODIFY:{text:"修改数据集信息"},APPEND:{text:"追加数据包"},HANDLE:{text:"给数据集加工"}},y={START:{value:"初始化",text:"初始化"},EXPORTING:{value:"导出中",text:"导出中"},LOADING:{value:"加载中",text:"加载中"},SUCCEED:{value:"成功",text:"导出成功"},ERROR:{value:"失败",text:"导出失败"}}},"3a9c":function(e,t,s){"use strict";var a=s("312d"),i=s("9ec3");t["a"]={props:["value"],render(e){const{value:t}=this,s=Object(i["find"])(Object(i["values"])(a["r"]),{value:t});return s?t===a["r"].INIT.value||t===a["r"].REJECTED.value||t===a["r"].WAIT_ACCEPT.value?e("Tag",{attrs:{color:"default"}},s.text):t===a["r"].LABELING.value?e("Tag",{attrs:{color:"blue"}},s.text):t===a["r"].FINISHED.value?e("Tag",{attrs:{color:"green"}},s.text):void 0:e("Tag",{attrs:{color:"error"}},"状态错误")}}},4034:function(e,t,s){},"424a":function(e,t,s){"use strict";s("9f76")},4304:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"errorContainer"},[e.isErrorShow?s("div",{staticClass:"errorHeader"},[s("div",{staticClass:"errorTips"},[s("Icon",{staticStyle:{"margin-right":"4px"},attrs:{type:"md-alert"}}),s("span",[e._v("领取失败！以下题目正在处理中，如需领取当前题目，请先将以下题目退回/暂停。")])],1),s("a",{on:{click:e.handleRefresh}},[e._v("重试")])]):e._e(),s("div",{staticClass:"tasks"},[s("TableFilter",{attrs:{searchLoading:e.fetchQuestions.isPending,btnDirection:"horizontal"},on:{search:e.handleSearch,reset:e.reset}},[s("Form",{attrs:{"label-width":50,"label-colon":!0}},[s("Row",[s("Col",{attrs:{span:"8"}},[s("FormItem",{attrs:{label:"类型"}},[s("Select",{attrs:{placeholder:"请选择类型",clearable:""},on:{"on-clear":e.handleSearch},model:{value:e.queryInfo.event,callback:function(t){e.$set(e.queryInfo,"event",t)},expression:"queryInfo.event"}},e._l(Object.keys(e.QuestionType),(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(e.QuestionType[t]))])})),1)],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{attrs:{label:"状态"}},[s("Select",{attrs:{placeholder:"请选择状态",clearable:""},on:{"on-clear":e.handleSearch},model:{value:e.queryInfo.status,callback:function(t){e.$set(e.queryInfo,"status",t)},expression:"queryInfo.status"}},e._l(Object.keys(e.QuestiosnStatus),(function(t){return s("Option",{key:t,attrs:{value:t}},[e._v(e._s(e.QuestiosnStatus[t]))])})),1)],1)],1)],1)],1)],1),s("t-space",{staticClass:"mbb",attrs:{direction:"horizontal"}},[s("Button",{attrs:{type:"primary"},on:{click:e.batchReturn}},[e._v("批量退回")]),s("Button",{attrs:{type:"primary"},on:{click:e.batchPause}},[e._v("批量暂停")])],1),s("Table",{attrs:{columns:e.columns,data:e.questions,loading:e.fetchQuestions.isPending},on:{"on-selection-change":e.handleSelectionChange},scopedSlots:e._u([{key:"event",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(e.QuestionType[a.event]))])]}},{key:"status",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(e.QuestiosnStatus[a.status]))])]}},{key:"detail_id",fn:function(t){var a=t.row;return[1===a.group_detail_id_list?s("span",[e._v(e._s(a.detail_id))]):e._e(),s("div",{staticStyle:{"max-height":"200px",overflow:"auto"}},e._l(a.group_detail_id_list,(function(t){return s("p",[e._v(e._s(t))])})),0)]}},{key:"operation",fn:function(t){var a=t.row;return[a.event===e.ScenesObjMap.label||a.event===e.ScenesObjMap.review?[s("a",{on:{click:function(t){return e.returnQuestion(a)}}},[e._v("退回")]),s("Divider",{attrs:{type:"vertical"}})]:e._e(),"paused"!==a.status?[s("a",{on:{click:function(t){return e.handlePause(a)}}},[e._v("暂停")]),s("Divider",{attrs:{type:"vertical"}})]:e._e(),[s("a",{on:{click:function(t){return e.goToCheck(a)}}},[e._v("查看")])]]}}])}),s("Page",{staticClass:"footerPage",attrs:{current:e.pageIndex,total:e.pageTotal,"page-size":e.pageSize,"show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.onChangePageSize}})],1)])},i=[],r=(s("8d0d"),s("bc94")),l=s("c899"),n=s("dde5"),o=s("c605"),c={components:{TableFilter:o["a"]},props:{errorData:{},isErrorShow:{type:Boolean,default:!0}},data(){return{ScenesObjMap:l["e"],QuestionType:l["b"],QuestiosnStatus:l["c"],columns:[{type:"selection",width:60,align:"center"},{title:"任务编号",key:"task_id"},{title:"任务名称",key:"task_name"},{title:"任务明细ID",key:"detail_id",slot:"detail_id"},{title:"类型",key:"event",slot:"event"},{title:"状态",key:"status",slot:"status"},{title:"操作",key:"operation",slot:"operation"}],pageIndex:1,pageSize:10,pageTotal:0,queryInfo:{event:"",status:""},questions:[],selectedQuestions:[]}},computed:{},mounted(){this.fetchQuestions()},methods:{handleSearch(){this.fetchQuestions()},reset(){this.queryInfo={},this.fetchQuestions()},goToCheck(e){var t,s,a,i;const r=[l["e"].label,l["e"].label_again,l["e"].relabel],n={scenes:l["d"][e.event]},o=r.includes(e.event)?{pack_key:(null===(a=e.group_pack_key_list)||void 0===a?void 0:a.length)>1?0:null===(i=e.group_pack_key_list)||void 0===i?void 0:i[0],task_id:e.task_id}:{check_id:e.check_id||0,pack_id:(null===(t=e.group_pack_key_list)||void 0===t?void 0:t.length)>1?0:null===(s=e.group_pack_key_list)||void 0===s?void 0:s[0],dataset_id:0,task_id:e.task_id};e.event!==l["e"].review_again&&e.event!==l["e"].label_again||(n.from=e.event===l["e"].label_again?"label":"review");const c=this.$router.resolve({name:r.includes(e.event)?"wb-task-label-detail":"wb-task-review-detail",params:o,query:n});window.open(c.href,"_blank")},changePage(e){this.pageIndex=e,this.fetchQuestions()},handleRefresh(){window.location.reload()},handlePause(e){this.fetchPause(e).then(()=>{this.$Message.success("暂停成功"),this.fetchQuestions()}).catch(e=>{this.$Message.error(e.message)})},onChangePageSize(e){this.pageSize=e,this.pageIndex=1,this.fetchQuestions()},returnQuestion(e){this.$Modal.confirm({title:"确定要退回题目吗",content:"题目中有已保存的标注内容，退回将会清空标注。点击确定按钮继续退回",onOk:()=>{this.fetchReturnQuestions(e).then(()=>{this.$Message.success("退回成功"),this.fetchQuestions()}).catch(e=>{this.$Message.error(e.message)})}})},handleSelectionChange(e){this.selectedQuestions=e},handlePromiseResult(e,t,s){Promise.all(e).then(()=>{this.$Message.success(t),this.fetchQuestions()}).catch(()=>{this.$Message.error(s)})},validateSelectedTasks(){return 0!==this.selectedQuestions.length||(this.$Message.warning("请至少选择一项任务"),!1)},handleGroupQuestion(e){const t=new Set;return(null===e||void 0===e?void 0:e.filter(e=>{var s;return(null===(s=e.group_detail_id_list)||void 0===s?void 0:s.length)>1?!t.has(String(e.detail_id))&&(e.group_detail_id_list.forEach(e=>t.add(String(e))),!0):!t.has(String(e.detail_id))}))||[]},batchReturn(){this.validateSelectedTasks()&&this.$Modal.confirm({title:"确定要退回题目吗",content:"题目中有已保存的标注内容，退回将会清空标注。点击确定按钮继续退回",onOk:()=>{const e=this.selectedQuestions.map(e=>this.fetchReturnQuestions(e));this.handlePromiseResult(e,"批量退回成功","批量退回失败")}})},batchPause(){if(!this.validateSelectedTasks())return;const e=this.selectedQuestions.filter(e=>"paused"===e.status);e.length>0&&this.$Message.warning(`有${e.length}项任务已是暂停状态，无需重复操作`);const t=this.selectedQuestions.filter(e=>"paused"!==e.status);if(0===t.length)return;const s=t.map(e=>this.fetchPause(e));this.handlePromiseResult(s,"批量暂停成功","批量暂停失败")}},asyncMethods:{fetchQuestions(){const e={...this.queryInfo,page:{start:(this.pageIndex-1)*this.pageSize,size:this.pageSize,return_total:1}};return Object(r["u"])(e).then(e=>{var t;const s=this.handleGroupQuestion(null===(t=e.data)||void 0===t?void 0:t.map(e=>({...e,_disabled:"paused"===e.status&&!(e.event===l["e"].label||e.event===l["e"].review)})));return this.pageTotal=e.total,s})},fetchPause(e){const t={task_id:e.task_id,detail_id_list:e.group_detail_id_list,event:e.event};return Object(r["j"])(t)},fetchReturnQuestions(e){const t={task_id:e.task_id,pack_keys:e.group_pack_key_list,event:e.event};return e.event===l["e"].review&&(t.check_id=e.check_id),Object(n["c"])("api/workbench",e.event===l["e"].label?"returnLabel":"returnReview",t)}}},d=c,u=(s("6a4a"),s("2be6")),p=Object(u["a"])(d,a,i,!1,null,"23bee55a",null);t["a"]=p.exports},4463:function(e,t,s){"use strict";s.d(t,"j",(function(){return i})),s.d(t,"k",(function(){return r})),s.d(t,"n",(function(){return l})),s.d(t,"c",(function(){return n})),s.d(t,"a",(function(){return o})),s.d(t,"e",(function(){return c})),s.d(t,"l",(function(){return d})),s.d(t,"d",(function(){return u})),s.d(t,"f",(function(){return p})),s.d(t,"b",(function(){return m})),s.d(t,"m",(function(){return h})),s.d(t,"h",(function(){return _})),s.d(t,"g",(function(){return f})),s.d(t,"i",(function(){return v}));var a=s("dde5");const i=e=>Object(a["c"])("api/deliver","listDeliverTasks",e),r=e=>Object(a["c"])("api/workbench","opDeliver",e),l=e=>Object(a["c"])("api/workbench","statDeliverTask",e),n=e=>Object(a["c"])("api/workbench","createDeliverTask",e),o=e=>Object(a["c"])("api/workbench","addDeliverDetail",e),c=e=>Object(a["c"])("api/workbench","getAutoAddDeliver",e),d=e=>Object(a["c"])("api/workbench","setAutoAdd",e),u=e=>Object(a["c"])("api/workbench","deleteDeliverTask",e),p=e=>Object(a["c"])("api/deliver","getDeliverNum",e),m=e=>Object(a["c"])("api/deliver","appendDeliverDetailToNextTask",e),h=e=>Object(a["c"])("api/workbench","splitDeliver",e),_=e=>Object(a["c"])("api/workbench","listCheckTasks",e),f=e=>Object(a["c"])("api/deliver","getDeliverTask",e),v=e=>Object(a["c"])("api/deliver","listDeliverChecks",e)},4900:function(e,t,s){"use strict";s("d319")},4932:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.currentResult?s("Modal",{attrs:{"mask-closable":!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[e.fetchDelivers.isPending?s("Spin",{attrs:{fix:""}}):e._e(),s("h3",[e._v(e._s(e.approveResultOptions[e.currentResult].title))]),s("div",{staticClass:"mtm",staticStyle:{"font-weight":"normal"}},[["pass"].includes(e.currentResult)?[s("span",[e._v("确认对")]),e.isSelectAll?s("span",{staticClass:"txt-blue"},[e._v(" 全部 "+e._s(e.delivers.length)+" 个 ")]):e.isSelect?s("span",{staticClass:"txt-blue"},[e._v(" 已选的 "+e._s(e.delivers.length)+" 个 ")]):s("span",[e._v("当前")])]:e._e(),s("span",[e._v(e._s(e.approveResultOptions[e.currentResult].desc))])],2)],1),e.statData&&20!==e.status?s("div",{staticClass:"info mbm"},[s("h4",{staticClass:"mbs"},[e._v("辅助信息")]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("供应商抽检准确率")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.supplier_first_pass_rate))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("标管抽检准确率")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.xinan_first_pass_rate))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("算法抽检准确率")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.algorithm_first_pass_rate))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("批次数量")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.deliver_num))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("首标时长")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.first_label_hour))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("标注人效")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.label_efficiency))])]),s("div",{staticClass:"row"},[s("div",{staticClass:"label"},[e._v("交付周期")]),s("div",{staticClass:"value"},[e._v(e._s(e.statData.deliver_period))])])]):e._e(),s("Form",{ref:"form",attrs:{model:e.form}},[["reject"].includes(e.approveResult)?[s("FormItem",{attrs:{label:"筛选条件",prop:"rejectType",rules:e.ruleNotEmpty}},[s("RadioGroup",{on:{"on-change":function(t){return e.fetchDeliverNum()}},model:{value:e.form.rejectType,callback:function(t){e.$set(e.form,"rejectType",t)},expression:"form.rejectType"}},[s("Radio",{attrs:{label:"reject"}},[e._v("全部")]),s("Radio",{attrs:{label:"rejectByCondition"}},[e._v("自定义")])],1)],1),["rejectByCondition"].includes(e.currentResult)?[s("FormItem",{attrs:{"label-width":79,prop:"condition",rules:e.ruleNotEmpty}},[s("RadioGroup",{staticClass:"full-width",attrs:{vertical:""},on:{"on-change":e.changeCondition},model:{value:e.form.condition,callback:function(t){e.$set(e.form,"condition",t)},expression:"form.condition"}},[s("Radio",{staticClass:"fit-width",attrs:{label:"detail_id_list"}},[e._v("指定任务明细ID")]),["detail_id_list"].includes(e.form.condition)?[s("FormItem",{staticClass:"mlb",attrs:{prop:"detail_id_list",rules:{required:!0,message:" "}}},[s("Row",{attrs:{align:"top"}},[s("Col",{attrs:{span:"22"}},[s("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请填写任务明细ID"},on:{"on-blur":function(t){e.splitIds(e.form.detail_id_list).length>0&&e.fetchDeliverNum()}},model:{value:e.form.detail_id_list,callback:function(t){e.$set(e.form,"detail_id_list",t)},expression:"form.detail_id_list"}})],1),s("Col",{attrs:{span:"2"}},[s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符。ID数量不要超过500个",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)],1)],1)],1)]:e._e(),s("Radio",{staticClass:"fit-width",attrs:{label:"item_id_list"}},[e._v("指定题目ID")]),["item_id_list"].includes(e.form.condition)?[s("FormItem",{staticClass:"mlb",attrs:{prop:"item_id_list",rules:{required:!0,message:" "}}},[s("Row",{attrs:{align:"top"}},[s("Col",{attrs:{span:"22"}},[s("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请填写题目ID"},on:{"on-blur":function(t){e.splitIds(e.form.item_id_list).length>0&&e.fetchDeliverNum()}},model:{value:e.form.item_id_list,callback:function(t){e.$set(e.form,"item_id_list",t)},expression:"form.item_id_list"}})],1),s("Col",{attrs:{span:"2"}},[s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符。ID数量不要超过500个",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)],1)],1)],1)]:e._e(),s("Radio",{staticClass:"fit-width",attrs:{label:"check_status_list"}},[e._v("筛选当前环节质检结果")]),["check_status_list"].includes(e.form.condition)?[s("FormItem",{staticClass:"mlb",attrs:{prop:"check_status_list",rules:{required:!0,message:" "}}},[s("Select",{attrs:{multiple:""},on:{"on-change":function(t){return e.fetchDeliverNum()}},model:{value:e.form.check_status_list,callback:function(t){e.$set(e.form,"check_status_list",t)},expression:"form.check_status_list"}},[s("Option",{attrs:{value:30}},[e._v("待质检")]),s("Option",{attrs:{value:15}},[e._v("质检不通过")])],1)],1),s("Checkbox",{staticClass:"mlb",on:{"on-change":function(t){return e.fetchDeliverNum()}},model:{value:e.form.valid_check,callback:function(t){e.$set(e.form,"valid_check",t)},expression:"form.valid_check"}},[e._v("包含失效任务题目")])]:e._e()],2)],1)]:e._e()]:e._e(),["reject","rejectByCondition","audit","deliver"].includes(e.currentResult)?[s("FormItem",{attrs:{label:"填写原因",prop:"remark",rules:e.ruleNotEmpty}},[s("Input",{attrs:{placeholder:"请填写原因"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),["reject","rejectByCondition"].includes(e.currentResult)?s("FormItem",{attrs:{label:"处理方式",required:!0}},[e.totalDeliverNum===e.deliverNum?s("p",{staticStyle:{display:"inline-block",width:"100%"}},[e._v("批次整体驳回，批次状态将变更为“验收驳回”，标注团队需新建批次交付。")]):e.deliverNum!==e.totalDeliverNum&&e.isEnablement?s("p",{staticStyle:{display:"inline-block",width:"100%"}},[e._v("批次部分驳回，驳回数据将自动生成新的“待交付”批次（新批次无之前的质检结果，可在题目详情查看）")]):e.deliverNum===e.totalDeliverNum||e.isEnablement?e._e():s("p",{staticStyle:{display:"inline-block",width:"100%"}},[e._v("批次部分驳回，驳回数据将自动生成一个新的“验收驳回”批次，和一个相同数据范围的“待交付”批次（新批次无之前的质检结果，可在题目详情查看）")])]):e._e()]:[s("FormItem",{attrs:{label:"填写备注",prop:"remark"}},[s("Input",{attrs:{placeholder:"请填写备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)]],2),e.isRejectDeliver?[s("Alert",{attrs:{"show-icon":""}},[e.fetchDeliverNum.isPending?s("Spin",{attrs:{fix:""}}):e._e(),s("Row",[s("Col",{attrs:{span:"10"}},[s("span",[e._v("本批次数量："+e._s(e.totalDeliverNum))])]),s("Col",{attrs:{span:"10"}},[s("span",[e._v("验收驳回数量："+e._s(e.deliverNum))])]),s("Col",{attrs:{span:"4"}})],1)],1)]:e._e(),s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{staticClass:"mls",on:{click:function(t){e.visible=!1}}},[e._v("取消")]),s("Tooltip",{attrs:{disabled:e.isSubmitOk}},[s("div",{staticStyle:{"white-space":"normal",width:"200px"},attrs:{slot:"content"},slot:"content"},[s("p",[e._v("待处理的批次少于 1 个时不可用")]),s("p",[e._v("当前待处理: "+e._s(e.delivers.length))])]),s("Button",{staticClass:"mls",attrs:{type:e.approveResultOptions[e.currentResult].btnType,disabled:!e.isSubmitOk||e.isRejectDeliver&&!e.deliverNum,loading:e.fetchOpDeliver.isPending},on:{click:e.submit}},[s("span",[e._v("确认"+e._s(e.approveResultOptions[e.currentResult].title))])])],1)],1)],2):e._e()},i=[],r=(s("8d0d"),s("9ec3")),l=s("dde5"),n=s("4463"),o=s("bc94"),c=s("a06e"),d={props:{approveResult:String,task:Object,selection:Array,isSelectAll:{type:Boolean,default:!1},isSelect:{type:Boolean,default:!1},status:{type:Number},fetchPath:Number,searchParams:Object,stat:Object},data(){return{visible:!0,delivers:this.selection||[],currentResult:this.approveResult,approveResultOptions:{pass:{title:"验收通过",desc:"待验收批次整体通过，批次内的题目将变为 已验收 状态",btnType:"success",value:1},reject:{title:"验收驳回",desc:"打回至标注团队重新交付",handleType:"驳回后当前批次失效，标注团队可重新创建批次交付",btnType:"error",value:0},rejectByCondition:{title:"验收驳回",desc:"打回至标注团队重新交付",handleType:"驳回后自动生成一个新的待交付批次（已有质检结果将被清空）",btnType:"error",value:0},audit:{title:"重新审核",desc:"确认清空当前审核质检结果，打回审核团队重新审核",btnType:"primary",value:2},deliver:{title:"重新验收",desc:"确认对当前批次重新验收，确认后批次状态将变更为 待验收 ",btnType:"primary",value:2}},fetchPathOptions:["api/workbench","api/deliver"],form:{rejectType:this.approveResult,condition:"",item_id_list:"",detail_id_list:"",check_status_list:[],remark:"",valid_check:!1},ruleNotEmpty:{required:!0,message:"不能为空",trigger:"blur"},page:{size:500,total:0},totalDeliverNum:0}},computed:{isEnablement(){try{var e;const t=JSON.parse(null===(e=this.project)||void 0===e?void 0:e.business_config);return t.enable_settlement}catch{return!1}},isRejectDeliver(){const{currentResult:e,isSelect:t,isSelectAll:s,delivers:a}=this;return!t&&!s&&1===a.length&&["reject","rejectByCondition"].includes(e)},isSubmitOk(){const{delivers:e}=this;return e.length>0},statData(){var e,t;const s=(null===(e=this.stat)||void 0===e?void 0:e.deliver_stat)||(null===(t=this.statCheckTask)||void 0===t?void 0:t.deliver_stat);return s?{supplier_first_pass_rate:null===s.supplier_first_pass_rate?"-":this.format(100*s.supplier_first_pass_rate)+" %",xinan_first_pass_rate:null===s.xinan_first_pass_rate?"-":this.format(100*s.xinan_first_pass_rate)+" %",algorithm_first_pass_rate:null===s.algorithm_first_pass_rate?"-":this.format(100*s.algorithm_first_pass_rate)+" %",deliver_num:null===s.deliver_num?"-":s.deliver_num+" 条",first_label_hour:null===s.first_label_hour?"-":this.format(s.first_label_hour,4)+" h",label_efficiency:null===s.label_efficiency?"-":this.format(s.label_efficiency,4)+" 条/h",deliver_period:null===s.deliver_period?"-":this.convertHoursToDaysAndHours(s.deliver_period)}:null}},watch:{"form.rejectType"(e){this.currentResult=e}},mounted(){const{isSelectAll:e,isRejectDeliver:t}=this;e&&this.fetchDelivers(),this.fetchProject(this.task.project_id),t&&(this.totalDeliverNum=this.delivers[0].deliver_num,this.fetchDeliverNum()),void 0===this.stat&&this.fetchStatCheckTask()},methods:{format(e,t=2){return e.toFixed(t).replace(/\.?0+$/,"")},convertHoursToDaysAndHours(e){const t=Math.floor(e/24),s=e%24,a=t?t+" 天":"",i=s||!t?this.format(s,4)+" h":"";return a+i},submit(){const{isSelect:e,selection:t,isSelectAll:s,task:a}=this;this.$refs.form.validate(i=>{if(console.log(i),!i)return!1;a||!s&&(!e||e&&1===t.length)?this.fetchOpDeliver():this.fetchOpDelivers()})},refresh(){this.visible=!1,this.$emit("refresh")},splitIds(e){var t;if(!e)return[];let s=Object(r["compact"])(e.split(/[\n\s+,，;；、]/g));return(null===(t=s)||void 0===t?void 0:t.length)>=5e3&&(s=s.slice(0,5e3)),s},changeCondition(e){switch(e){case"detail_id_list":case"item_id_list":this.splitIds(this.form[e]).length>0&&this.fetchDeliverNum();break;case"check_status_list":this.fetchDeliverNum();break}}},asyncMethods:{fetchStatCheckTask(){var e,t,s,a;const{task:i,delivers:r}=this;console.log(r[0],this.delivers);const l={task_id:null!==(e=null===i||void 0===i?void 0:i.task_id)&&void 0!==e?e:null===r||void 0===r||null===(t=r[0])||void 0===t?void 0:t.task_id,deliver_id:null===r||void 0===r||null===(s=r[0])||void 0===s?void 0:s.deliver_id,team_id:Number(null===(a=this.$route)||void 0===a?void 0:a.query.team_id)||(null===r||void 0===r?void 0:r[0].team_id),stat_my_count:0,stat_scene:"deliver",stat_scope:"deliver"};return Object(o["q"])(l).then(e=>e).catch(e=>{this.$Message.error(e.message)})},fetchOpDeliver(){const{approveResultOptions:e,currentResult:t,task:s,delivers:a,fetchPathOptions:i,fetchPath:n,form:o}=this,c={result:e[t].value,remark:o.remark,deliver_id_list:Object(r["map"])(a,e=>e.deliver_id.toString()),task_id:s?s.task_id:a[0].task_id,project_id:a[0].project_id};if(["rejectByCondition"].includes(o.rejectType))switch(c.condition={},c.condition.valid_check=Number(!(["check_status_list"].includes(o.condition)&&o.valid_check)),o.condition){case"detail_id_list":c.condition.detail_id_list=this.splitIds(o.detail_id_list);break;case"item_id_list":c.condition.item_id_list=this.splitIds(o.item_id_list);break;case"check_status_list":c.condition.check_status_list=o.check_status_list;break}return Object(l["c"])(i[n],"opDeliver",c).then(()=>{this.$Message.success("已"+e[t].title),this.refresh()}).catch(e=>{console.log(e),this.$Message.error("提交失败："+e.message),this.refresh()})},fetchOpDelivers(){const{approveResultOptions:e,currentResult:t,delivers:s,fetchPathOptions:a,fetchPath:i,form:n}=this,o={result:e[t].value,remark:n.remark,deliver_id_list:Object(r["map"])(s,e=>e.deliver_id.toString()),task_id_list:Object(r["keys"])(Object(r["keyBy"])(s,"task_id"))};if(["rejectByCondition"].includes(n.rejectType))switch(o.condition={},o.condition.valid_check=Number(!(["check_status_list"].includes(n.condition)&&n.valid_check)),n.condition){case"detail_id_list":o.condition.detail_id_list=this.splitIds(n.detail_id_list);break;case"item_id_list":o.condition.item_id_list=this.splitIds(n.item_id_list);break;case"check_status_list":o.condition.check_status_list=n.check_status_list;break}return Object(l["c"])(a[i],"opDelivers",o).then(()=>{this.$Message.success("已"+e[t].title),this.refresh()}).catch(e=>{console.log(e),this.$Message.error("提交失败："+e.message),this.refresh()})},fetchDelivers(){const{page:e,searchParams:t,task:s,fetchPath:a}=this,i={page:{start:0,size:e.size,return_total:1},deliver_status:30,from:a};return t&&Object.assign(i,t),s&&(i.task_id=s.task_id),Object(n["j"])(i).then(t=>(e.total=t.total,console.log("cc",t),t.data)).catch(e=>{this.$Message.error("获取批次失败："+e),this.mergeQueue=[]})},fetchDeliverNum(){const{task:e,delivers:t,form:s}=this,a={task_id:e?e.task_id:t[0].task_id,deliver_id:t[0].deliver_id};if(["rejectByCondition"].includes(s.rejectType))switch(a.valid_check=Number(!(["check_status_list"].includes(s.condition)&&s.valid_check)),s.condition){case"detail_id_list":a.detail_id_list=this.splitIds(s.detail_id_list);break;case"item_id_list":a.item_id_list=this.splitIds(s.item_id_list);break;case"check_status_list":a.check_status_list=s.check_status_list;break}return Object(n["f"])(a).then(e=>e).catch(e=>{console.log(e)})},fetchProject(e){const t={project_id:e};return Object(c["i"])(t).then(e=>e)}}},u=d,p=(s("98d2"),s("2be6")),m=Object(p["a"])(u,a,i,!1,null,"8fc4e20a",null);t["a"]=m.exports},"4bd1":function(e,t,s){"use strict";var a=s("312d"),i=s("9ec3");t["a"]={props:["value"],render(e){const{value:t}=this,s=Object(i["find"])(Object(i["values"])(a["c"]),{value:t});return s?t===a["c"].PROCESSING.value?e("Tag",{attrs:{color:"blue"}},s.text):t===a["c"].DELIVERED.value?e("Tag",{attrs:{color:"green"}},s.text):t===a["c"].INVALID.value?e("Tag",{attrs:{color:"default"}},s.text):void 0:e("Tag",{attrs:{color:"error"}},"状态错误")}}},"4c8b":function(e,t,s){"use strict";s("f916")},"4e40":function(e,t,s){"use strict";s("002c")},"50a8":function(e,t,s){},"51cc":function(e,t,s){"use strict";var a=s("312d"),i=s("9ec3");t["a"]={props:["value"],render(e){const{value:t}=this,s=Object(i["find"])(Object(i["values"])(a["m"]),{value:t});if(s)switch(t){case a["m"].WAIT_LABEL.value:return e("Tag",{attrs:{color:"default"}},s.text);case a["m"].LABELING.value:return e("Tag",{attrs:{color:"blue"}},s.text);case a["m"].LABELED.value:return e("Tag",{attrs:{color:"success"}},s.text);default:return e("Tag",{props:{color:"default"}},s.text)}return e("Badge",{props:{}},"-")}}},5942:function(e,t,s){"use strict";s("ed18")},"5a3e":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{width:"600",title:"题目操作日志","mask-closable":!1,"footer-hide":""},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[e.fetchLogs.isResolved?s("div",{staticClass:"log"},[e.logs&&e.logs.length>0?s("Timeline",e._l(e.logs,(function(t){return s("TimelineItem",{key:t.flow_log_id.toString()},[s("Card",[s("b",[e._v(e._s(t.flow_handle_at))]),s("p",{staticClass:"content"},[s("span",[e._v(e._s(t.nick_name)+"："+e._s(e.flowAction(t.flow_action)))]),"ADMIN_TRANS_DETAIL"===t.flow_action?s("span",["角色删除"===t.flow_remark?s("span",[e._v(" (将成员从小组中删除)")]):"管理员撤回"===t.flow_remark?s("span",[e._v(" (撤回题目)")]):s("span",[e._v("("+e._s(t.flow_remark)+")")])]):e._e()]),["REJECT_REVIEW","REJECT_APPROVE"].includes(t.flow_action)?s("p",{staticClass:"txt-red"},[e._v("原因："+e._s(t.flow_remark||"-"))]):e._e()])],1)})),1):s("p",[e._v("暂无数据")])],1):s("Spin",{attrs:{fix:""}})],1)},i=[],r=s("9ec3"),l=s.n(r),n=s("cb78"),o=s("312d"),c={props:{task:Object,detail:Object,userInfo:Object},data(){return{visible:!0,logs:[],detailAction:o["h"]}},computed:{flowAction(){return function(e){let t="";return l.a.forIn(o["h"],(s,a)=>{if(e===a)return t=s.text,!1}),t}}},mounted(){this.fetchLogs()},asyncMethods:{fetchLogs(){const e={task_id:this.task.task_id,flow_code_list:[this.detail.detail_id.toString()],get_cycle_step:1,page:{start:0,size:100}};return n["a"].ListFlowLogs(e).then(e=>e.data.result.data).catch(e=>{this.$Message.error("查询失败："+e.message)})}}},d=c,u=(s("66c2"),s("2be6")),p=Object(u["a"])(d,a,i,!1,null,"63ff42b4",null);t["a"]=p.exports},"5c7d":function(e,t,s){},"5ca2":function(e,t,s){},"5ea9":function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("h4",[e._v("确定要处理"+e._s(e.isAll?"这些":"这 "+e.selection.length+" 条")+"数据吗？")])]),s("div",{staticClass:"content"},[10===e.status?s("p",[s("span",[e._v("确定之后，将会被打回到")]),s("span",{staticClass:"txt-red"},[e._v(" "+e._s(e.statusList[e.status].statusName)+" ")]),s("span",[e._v("状态。")])]):e._e(),15===e.status?s("p",[s("span",[e._v("确定之后，将会自动创建一个抽检任务，全部质检结果为")]),s("span",{staticClass:"txt-red"},[e._v(" 质检不通过 ")]),s("span",[e._v("；若不在有效批次的数据将先自动创建一个待交付批次。")])]):e._e(),30===e.status?s("p",[s("span",[e._v("确定之后，将清空所选数据的")]),s("span",{staticClass:"txt-red"},[e._v("质检结果。")])]):e._e(),s("p",{staticClass:"mtm txt-muted"},[e._v("(已自动剔除不满足条件的数据)")]),s("br"),e.statDetail?s("Alert",{attrs:{"show-icon":""}},[e.isPack?s("p",[e._v("预计本次处理题包量："+e._s(e.statDetail.group_count))]):s("p",[e._v("预计本次处理量："+e._s(e.statDetail.detail_count))])]):e._e(),e.isPack?s("Alert",{attrs:{"show-icon":"",type:"warning"}},[s("p",[e._v("题包任务将批量操作关联的题包，实际处理量以最后成功值为准")])]):e.isCross?s("Alert",{attrs:{"show-icon":"",type:"warning"}},[s("p",[e._v("交叉任务将批量操作关联的题目，实际处理量以最后成功值为准")])]):e._e()],1),e.statDetail?s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),s("Button",{attrs:{type:"primary",disabled:!e.statDetail.detail_count},on:{click:function(t){return e.fetchUpdateDetailStatus()}}},[e._v("确认并处理")])],1):e._e()])},i=[],r=s("9ec3"),l=s("864c"),n={props:{task:Object,deliver:Object,status:Number,selection:Array,form:Object,isAll:Boolean},data(){return{visible:!0,statusList:{10:{statusName:"待标注",operationName:"清空标注",operationValue:1},15:{statusName:"待返修",operationName:"打回返修",operationValue:2},30:{statusName:"待质检",operationName:"清空质检",operationValue:3}},submitNum:0}},computed:{isCross(){var e;return(null===(e=this.task)||void 0===e?void 0:e.cross_num)>=2},isPack(){var e;return(null===(e=this.task)||void 0===e?void 0:e.pack_num)>0},submitParams(){const{statusList:e,task:t,status:s,form:a,isAll:i,selection:l,isCross:n,isPack:o}=this,c={task_id:t.task_id,detail_status:30,operation_type:e[s].operationValue};return this.deliver&&(c.deliver_id=this.deliver.deliver_id),i?Object(r["forIn"])(a,(e,t)=>{switch(t){case"detail_valid":case"is_deliver":case"cycle_step":(e||0===e)&&(c[t]=Number(e));break;case"detail_id":case"detail_id_list":e&&(c.detail_ids=[e]);break;case"dataset_item_id":case"dataset_item_id_list":e&&(c.item_codes=[e]);break;case"pack_key":case"pack_keys":e&&(c.pack_keys=[e]);break;case"detail_status":break;case"nick_name_list":e&&(c.nick_names=[e]);break;case"labeler":case"last_labeler_list":e&&(c.last_labelers=[e]);break;case"reviewer":e&&(c.reviewer_list=[e]);break;default:e&&(c[t]=e);break}}):n?c.item_codes=Object(r["map"])(l,e=>e.dataset_item_id):o?c.pack_keys=Object(r["map"])(l,e=>e.pack_key):c.detail_ids=Object(r["map"])(l,e=>e.detail_id),c}},mounted(){this.fetchStatDetail()},asyncMethods:{fetchStatDetail(){const e={...this.submitParams};return l["a"].StatDetail(e).then(e=>e.data.result).catch(e=>(console.log(e),0))},fetchUpdateDetailStatus(){const e={...this.submitParams};return l["a"].UpdateDetailStatus(e).then(e=>{this.visible=!1,this.$emit("refresh"),setTimeout(()=>{this.$Modal.success({title:`成功处理了 ${e.data.result} 条数据`})},300)}).catch(e=>{console.log(e),this.$Message.error("批量处理失败："+e.message)})}}},o=n,c=s("2be6"),d=Object(c["a"])(o,a,i,!1,null,null,null);t["a"]=d.exports},"66c2":function(e,t,s){"use strict";s("121d")},6787:function(e,t,s){},6982:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{margin:"10px 0"}},[s("t-space",{attrs:{align:"center"}},[s("span",[e._v("1.全局标签筛选")]),s("RadioGroup",{model:{value:e.groupLogic,callback:function(t){e.groupLogic=t},expression:"groupLogic"}},[s("Radio",{attrs:{label:"and"}},[e._v("满足以下全部条件")]),s("Radio",{attrs:{label:"or"}},[e._v("满足以下任一条件")])],1)],1),s("Table",{ref:"form",attrs:{columns:e.columns(e.filterType),data:e.form[e.filterType]},scopedSlots:e._u([{key:"label",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?s("Select",{attrs:{transfer:""},on:{"on-change":e.changeFilter},model:{value:e.editItem[e.filterType].name,callback:function(t){e.$set(e.editItem[e.filterType],"name",t)},expression:"editItem[filterType].name"}},e._l(e.templateLabels,(function(t){return s("Option",{key:t.attributes.name,attrs:{value:t.attributes.name}},[e._v(e._s(t.attributes.label))])})),1):s("span",[e._v(e._s(a.label||"-"))])]:void 0}},{key:"multiple",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?[e.editItem[e.filterType].label?s("span",[e._v(e._s(e.labelValueName(e.editItem[e.filterType])))]):e._e()]:s("span",[e._v(e._s(e.labelValueName(a)))])]:void 0}},{key:"equal",fn:function(t){t.row;return["label"].includes(e.filterType)?[s("span",[e._v("=")])]:void 0}},{key:"values",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?[[0,1].includes(e.editItem[e.filterType].label_type)?s("Select",{attrs:{multiple:"",transfer:""},model:{value:e.editItem[e.filterType].values,callback:function(t){e.$set(e.editItem[e.filterType],"values",t)},expression:"editItem[filterType].values"}},[e.editItem[e.filterType].label?[e.labelValuesOptions.attributes.isMutuallyExclusive?e._l(e.labelValuesOptions.attributes.exclusiveOptions.flat(),(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})):e._l(e.resolveOptions(e.labelValuesOptions.attributes.options),(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])}))]:e._e()],2):e._e(),[2].includes(e.editItem[e.filterType].label_type)?s("optimus-engine",e._b({ref:"cascaderOptimus",staticClass:"cascader-optimus"},"optimus-engine",e.itemComponent(e.editItem[e.filterType]),!1)):e._e()]:s("span",{staticClass:"values"},[[0,1].includes(a.label_type)?[e._v(e._s(a.values.join("、")))]:e._e(),[2].includes(a.label_type)?[e._v(e._s(e.transformCascaderValues(a.values)))]:e._e()],2)]:void 0}},{key:"condition",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?s("Select",{attrs:{transfer:""},model:{value:e.editItem[e.filterType].condition,callback:function(t){e.$set(e.editItem[e.filterType],"condition",t)},expression:"editItem[filterType].condition"}},[s("Option",{attrs:{value:"any"}},[e._v("满足任一取值")]),e.isMultipleStage?s("Option",{attrs:{value:"all"}},[e._v("满足全部取值")]):e._e()],1):s("span",[e._v(e._s("any"===a.condition?"满足任一取值":"满足全部取值"))])]:void 0}},{key:"cross_label",fn:function(t){var a=t.row,i=t.index;return["cross"].includes(e.filterType)?[e.editIndex===i?s("Select",{attrs:{transfer:""},on:{"on-change":e.changeFilter},model:{value:e.editItem[e.filterType].label,callback:function(t){e.$set(e.editItem[e.filterType],"label",t)},expression:"editItem[filterType].label"}},[s("Option",{attrs:{value:"题目"}},[e._v("题目")]),e._l(e.templateLabelsCross,(function(t){return s("Option",{key:t.attributes.label,attrs:{value:t.attributes.label}},[e._v(e._s(t.attributes.label))])}))],2):s("span",[e._v(e._s(a.label||"-"))])]:void 0}},{key:"quota_type",fn:function(t){var a=t.row,i=t.index;return["cross"].includes(e.filterType)?[e.editIndex===i?[e.editItem[e.filterType].label?[s("Select",{attrs:{transfer:""},model:{value:e.editItem[e.filterType].quota_type,callback:function(t){e.$set(e.editItem[e.filterType],"quota_type",t)},expression:"editItem[filterType].quota_type"}},[e._l(e.quotaTypeOptions,(function(t,a){return[a<3||["check"].includes(e.scene)?["题目"===e.editItem[e.filterType].label||t.type===e.CrossEditItemType?s("Option",{key:a,attrs:{value:Number(a)}},[e._v(e._s(t.label))]):e._e()]:e._e()]}))],2)]:e._e()]:[e._l(e.quotaTypeOptions,(function(t,i){return[a.quota_type===Number(i)?s("span",{key:i},[e._v(e._s(t.label))]):e._e()]}))]]:void 0}},{key:"cross_condition",fn:function(t){var a=t.row,i=t.index;return["cross"].includes(e.filterType)?[e.editIndex===i?[e.editItem[e.filterType].label?[s("Row",{attrs:{gutter:5}},[s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{transfer:""},model:{value:e.editItem[e.filterType].operate_type,callback:function(t){e.$set(e.editItem[e.filterType],"operate_type",t)},expression:"editItem[filterType].operate_type"}},e._l(e.operateTypeOptions,(function(t,a){return s("Option",{key:a,attrs:{value:Number(a)}},[e._v(e._s(t))])})),1)],1),s("Col",{attrs:{span:"12"}},[e.editItem[e.filterType].quota_type&&e.editItem[e.filterType].quota_type%2!==0?[s("InputNumber",{staticStyle:{width:"75%"},attrs:{min:0,max:100,precision:.1},model:{value:e.editItem[e.filterType].value,callback:function(t){e.$set(e.editItem[e.filterType],"value",t)},expression:"editItem[filterType].value"}}),s("span",{staticClass:"mls"},[e._v("%")])]:[s("InputNumber",{attrs:{min:0,precision:1},model:{value:e.editItem[e.filterType].value,callback:function(t){e.$set(e.editItem[e.filterType],"value",t)},expression:"editItem[filterType].value"}})]],2)],1)]:e._e()]:[e._l(e.operateTypeOptions,(function(t,i){return[a.operate_type===Number(i)?s("span",{key:i},[e._v(e._s(t))]):e._e()]})),s("span",[e._v(e._s(a.value))]),a.quota_type%2!==0?s("span",[e._v("%")]):e._e()]]:void 0}},{key:"action",fn:function(t){var a=t.row,i=t.index;return[e.editEnabled?[e.editIndex===i?[s("a",{on:{click:function(t){return e.saveFilter(e.filterType,i)}}},[e._v("保存")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){a.label?e.cancelFilter(e.filterType):e.deleteFilter(e.filterType,i)}}},[e._v("取消")])]:-1===e.editIndex?[s("a",{on:{click:function(t){return e.editFilter(e.filterType,i)}}},[e._v("编辑")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){return e.deleteFilter(e.filterType,i)}}},[e._v("删除")])]:e._e()]:[s("span",[e._v("-")])]]}}],null,!0)}),e.editEnabled?s("Button",{staticClass:"mtm",attrs:{type:"dashed",icon:"md-add",long:"",disabled:-1!==e.editIndex},on:{click:function(t){return e.addFilter(e.filterType)}}},[e._v("新增")]):e._e()],1)},i=[],r=(s("8d0d"),s("0f30"),s("9ec3")),l=s("8416"),n={props:{filterType:String,template:Object,editEnabled:{type:Boolean,default:!0},scene:{type:String,default:""}},data(){return{form:{label:[],cross:[]},groupLogic:"and",templateLabels:[],templateLabelsCross:[],componentOptions:{"z-select":{component_name:"单选框",component_type:0},"z-single-select":{component_name:"单选框",component_type:0},"z-multiple-select":{component_name:"多选框",component_type:1},"z-cascader":{component_name:"级联选择器",component_type:2}},columnOptions:{label:{label:"label(标签)",multiple:"类型",equal:" ",values:"value(取值)",condition:"满足条件",action:"操作"},cross:{cross_label:"label(标签)/题目",quota_type:"结果评价指标",cross_condition:"满足条件",action:"操作"}},quotaTypeOptions:{3:{label:"最终结果(一致率)",type:"most"},4:{label:"最终结果(分差)",type:"average"},1:{label:"拟合结果(置信度)",type:"most"},2:{label:"拟合结果(分差)",type:"average"}},operateTypeOptions:{2:"小于",3:"等于",1:"大于"},editItem:{label:{name:"",label:"",values:"",label_type:"",condition:""},cross:{name:"",filter_type:"",label:"",quota_type:"",operate_type:"",value:0}},CrossEditItemType:"",editIndex:-1}},computed:{columns(){return function(e){return Object(r["map"])(this.columnOptions[e],(e,t)=>({title:e,slot:t,width:"equal"===t&&50}))}},labelValuesOptions(){const{templateLabels:e,editItem:t,filterType:s}=this,a=e.find(e=>e.attributes.name===t[s].name);return a},labelValueName(){return function(e){if(!e.label_type&&0!==e.label_type)return"";const{componentOptions:t,templateLabels:s}=this,a=Object.keys(t).find(s=>t[s].component_type===e.label_type);if(["z-multiple-select"].includes(a)){var i;const t=s.find(t=>t.attributes.name===e.name);if(null!==t&&void 0!==t&&null!==(i=t.attributes)&&void 0!==i&&i.selectType){const{selectType:e}=t.attributes;return"single"===e?"选择器(单选)":"选择器(多选)"}}return t[a].component_name}},isEmptyFilter(){const{editItem:e,filterType:t}=this;let s=!0;const a=e[t];return Object(r["forIn"])(a,(e,t)=>((""===e||void 0===e||e.length<=0||0===e&&!["value","label_type"].includes(t))&&(s=!1),s)),!s},itemComponent(){return function(e){const t=Object(r["cloneDeep"])([{...this.labelValuesOptions}]);t[0].attributes.label="",t[0].attributes.mode="多选";let s={};return e.values&&(s={tags:[{name:e.name,label:e.label,value:e.values.map(e=>JSON.parse(e))}]}),{component:{component:"z-form-stage",items:t},context:{},answer:s}}},isMultipleStage(){const{labelValuesOptions:e}=this;if(e)return["z-multiple-select"].includes(e.component)&&(!e.attributes.selectType||["multiple"].includes(e.attributes.selectType))||["多选"].includes(e.attributes.mode)}},watch:{"form.label"(){this.updateFilter()},"form.cross"(){this.updateFilter()}},mounted(){const{template:e}=this;if(e&&e.template_id){const{componentOptions:t}=this;this.templateComponent=JSON.parse(e.template_component),this.templateLabels=Object(r["remove"])(this.templateComponent.items,e=>Object.hasOwn(t,e.component)),this.templateLabelsCross=JSON.parse(e.template_component).items}},beforeDestroy(){Object.keys(this.form).forEach(e=>{this.form[e]=[]}),this.updateFilter()},methods:{changeFilter(e){var t;const{filterType:s,labelValuesOptions:a,templateLabelsCross:i,componentOptions:r}=this;switch(s){case"label":this.editItem[s].name=e,this.editItem[s].label=a.attributes.label,this.editItem[s].label_type=r[a.component].component_type,this.editItem[s].values="";break;case"cross":const l=null===(t=i.find(t=>t.attributes.label===e))||void 0===t?void 0:t.attributes.name;this.editItem[s].label=e,this.editItem[s].filter_type="题目"===e?1:2,this.editItem[s].name=l||"default","题目"!==e&&(this.CrossEditItemType=i.find(t=>t.attributes.label===e).attributes.fittingType||"most");break}},addFilter(e){this.form[e].push({...this.editItem[e]}),this.editIndex=this.form[e].length-1},saveFilter(e,t){const s=this.editItem[e];if([2].includes(s.label_type)){var a;const e=null===(a=this.$refs.cascaderOptimus)||void 0===a?void 0:a.formData[s.name];e&&(s.values=e.map(e=>JSON.stringify(e)))}this.isEmptyFilter?this.$Message.error("不能有空值，请检查"):(Object.assign(this.form[e][t],s),this.getNum(),this.cancelFilter(e))},cancelFilter(e){Object(r["forIn"])(this.editItem[e],(t,s)=>{switch(typeof t){case"object":case"string":this.editItem[e][s]="";break;case"number":this.editItem[e][s]=0;break}}),this.editIndex=-1},editFilter(e,t){Object.assign(this.editItem[e],this.form[e][t]),this.editIndex=t},deleteFilter(e,t){this.form[e].splice(t,1),this.getNum(),this.cancelFilter(e)},verifyFilter(){const{filterType:e}=this;Object(r["map"])(this.form[e],(t,s)=>{let a=!1;Object(r["forIn"])(t,(t,i)=>(a=!!t||a,!(t||"cross"===e&&"value"===i)&&this.deleteFilter(e,s),!1)),a||this.deleteFilter(e,s)})},updateFilter(){const{form:e,filterType:t}=this;this.$emit("update:filter",{data:e[t],groupLogic:this.groupLogic})},getNum(){this.updateFilter(),this.$emit("getNum")},transformCascaderValues(e){return"object"===typeof e&&e.length?e.map(e=>JSON.parse(e).join("/")).join("、"):"string"===typeof e?e.split("、").map(e=>JSON.parse(e.split("/"))):void 0},resolveOptions(e){return Object(l["o"])(e)}}},o=n,c=(s("7ac7"),s("2be6")),d=Object(c["a"])(o,a,i,!1,null,"eb6032b2",null);t["a"]=d.exports},"6a4a":function(e,t,s){"use strict";s("5ca2")},"7ac7":function(e,t,s){"use strict";s("d7e1")},"84ee":function(e,t,s){},"864c":function(e,t,s){"use strict";var a=s("dde5");class i extends a["b"]{GetDeliverWithTaskInfo(e){return this.post({method:"getDeliverWithTaskInfo",url:"api/workbench",params:e})}ListBidManagerTasks(e){return this.post({method:"listBidManagerTasks",url:"api/workbench",params:e})}ListFormalManagerTasks(e){return this.post({method:"listFormalManagerTasks",url:"api/workbench",params:e})}GetTask(e){return this.post({method:"getTask",url:"api/workbench",params:e})}StatTask(e){return this.post({method:"statTask",url:"api/workbench",params:e})}GetTaskDetailList(e){return this.post({method:"listDetail",url:"api/workbench",params:e})}GetTaskDetail(e){return this.post({method:"getDetail",url:"api/workbench",params:e})}ListAuditTasks(e){return this.post({method:"listAuditTasks",url:"api/workbench",params:e})}ListAuditDetail(e){return this.post({method:"listAuditDetail",url:"api/workbench",params:e})}AcceptTask(e){return this.post({method:"acceptTask",url:"api/workbench",params:e})}AbstainTask(e){return this.post({method:"abstainTask",url:"api/workbench",params:e})}SubmitBidTask(e){return this.post({method:"submitBidTask",url:"api/workbench",params:e})}SubmitTask(e){return this.post({method:"submitTask",url:"api/workbench",params:e})}AcceptWinBidTask(e){return this.post({method:"acceptWinBidTask",url:"api/workbench",params:e})}UpdateDetailStatus(e){return this.post({method:"updateDetailStatus",url:"api/workbench",params:e})}StatDetail(e){return this.post({method:"statDetail",url:"api/workbench",params:e})}ListMyLabelDetail(e){return this.post({method:"listMyLabelDetail",url:"api/workbench",params:e})}ListLabelTasks(e){return this.post({method:"listLabelTasks",url:"api/workbench",params:e})}listMyReLabelDetail(e){return this.post({method:"listMyReLabelDetail",url:"api/workbench",params:e})}ListMyLabelDetailLog(e){return this.post({method:"listMyLabelDetailLog",url:"api/workbench",params:e})}ListMyReviewDetailLog(e){return this.post({method:"listMyReviewDetailLog",url:"api/workbench",params:e})}ListMyReviewDetail(e){return this.post({method:"listMyReviewDetail",url:"api/workbench",params:e})}listMyReReviewDetail(e){return this.post({method:"listMyReReviewDetail",url:"api/workbench",params:e})}listReReviewDetail(e){return this.post({method:"listReReviewDetail",url:"api/workbench",params:e})}ListCheckTasks(e){return this.post({method:"listCheckTasks",url:"api/workbench",params:e})}CreateCheckTask(e){return this.post({method:"createCheckTask",url:"api/workbench",params:e})}GetCheckTask(e){return this.post({method:"getCheckTask",url:"api/workbench",params:e})}UpdateCheckTask(e){return this.post({method:"updateCheckTask",url:"api/workbench",params:e})}DeleteCheckTask(e){return this.post({method:"deleteCheckTask",url:"api/workbench",params:e})}RepealCheckTask(e){return this.post({method:"repealCheckTask",url:"api/workbench",params:e})}GetTaskCheckRangeNum(e){return this.post({method:"statDeliverTask",url:"api/workbench",params:e})}ListDeliverTasks(e){return this.post({method:"listDeliverTasks",url:"api/workbench",params:e})}ListBidTasks(e){return this.post({method:"listBidTasks",url:"api/workbench",params:e})}ListFormalTasks(e){return this.post({method:"listFormalTasks",url:"api/workbench",params:e})}SubmitAllRejectReview(e){return this.post({method:"updateReviewStatus",url:"api/workbench",params:e})}ListMyDeliverTasks(e){return this.post({method:"listMyDeliverTasks",url:"api/workbench",params:e})}ListLabelerUser(e){return this.post({method:"listLabelerUser",url:"api/workbench",params:e})}GetDetailDeliverHistory(e){return this.post({method:"getDetailDeliverHistory",url:"api/workbench",params:e})}SubmitMistakeReason(e){return this.post({method:"submitMistakeReason",url:"api/workbench",params:e})}}const r=new i;t["a"]=r},8859:function(e,t,s){"use strict";var a=s("9ec3"),i=s.n(a);t["a"]={modals:[],data(){const e={};return i.a.forEach(this.$options.modals,t=>{e[t+"Modal"]=!1,e[t+"Model"]=null}),e},methods:{showModal(e,t){this[e+"Modal"]=!0,this[e+"Model"]=t},hideModal(e){this[e+"Modal"]=!1}}}},"94fe":function(e,t,s){},"98d2":function(e,t,s){"use strict";s("94fe")},"9b01":function(e,t,s){"use strict";s("50a8")},"9f76":function(e,t,s){},a638:function(e,t,s){"use strict";var a=s("312d"),i=s("9ec3");t["a"]={props:["value"],render(e){const{value:t}=this,s=Object(i["find"])(Object(i["values"])(a["b"]),{value:t});if(s)switch(t){case a["b"].WAIT_DELIVER.value:return e("Tag",{attrs:{color:"default"}},s.text);case a["b"].WAIT_AUDIT.value:return e("Tag",{attrs:{color:"orange"}},s.text);case a["b"].WAIT_APPROVE.value:return e("Tag",{attrs:{color:"blue"}},s.text);case a["b"].APPROVED.value:return e("Tag",{attrs:{color:"success"}},s.text);case a["b"].REJECTED.value:return e("Tag",{attrs:{color:"error"}},s.text);default:return e("Tag",{props:{color:"default"}},s.text)}return e("Badge",{props:{}},"-")}}},a9f8:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{"mask-closable":!1,"footer-hide":""},scopedSlots:e._u([{key:"header",fn:function(){return[s("h4",[e._v(e._s(e.attach?"编辑":"添加")+e._s(e.attachTypeOptions[e.attachType]))])]},proxy:!0}]),model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("Form",{ref:"form",attrs:{model:e.form,"label-position":"top","label-colon":""}},["link"===e.attachType?[s("FormItem",{attrs:{label:"名称",prop:"attach_name"}},[s("Input",{attrs:{placeholder:"请输入文档名称，不填写则默认展示完整链接"},model:{value:e.form.attach_name,callback:function(t){e.$set(e.form,"attach_name",t)},expression:"form.attach_name"}})],1),s("FormItem",{attrs:{label:"链接",prop:"attach_path",rules:[{required:!0,message:"url不能为空"},{type:"url",trigger:"blur",message:"url不符合规则"}]}},[s("Input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"请输入文档链接，要求是符合规则的url"},model:{value:e.form.attach_path,callback:function(t){e.$set(e.form,"attach_path",t)},expression:"form.attach_path"}})],1)]:e._e(),"file"===e.attachType?[s("FormItem",{attrs:{label:"名称",prop:"attach_name",rules:{required:!0,message:"名称不能为空"}}},[s("Input",{attrs:{placeholder:"请输入文件名称"},model:{value:e.form.attach_name,callback:function(t){e.$set(e.form,"attach_name",t)},expression:"form.attach_name"}})],1)]:e._e()],2),s("Row",{attrs:{type:"flex",justify:"end"}},[s("Button",{staticClass:"mlm",attrs:{type:"text"},on:{click:function(t){e.visible=!1}}},[e._v("取消")]),s("Button",{staticClass:"mlm",attrs:{type:"primary"},on:{click:e.submit}},[e._v("确定")])],1)],1)},i=[],r=s("ffd0"),l={props:{task:Object,attach:Object,attachType:String,objId:String,objType:String,objScene:String},data(){return{visible:!0,form:{attach_name:"",attach_path:""},attachTypeOptions:{file:"文件名称",link:"文档链接"}}},mounted(){this.attach&&Object.assign(this.form,this.attach)},methods:{submit(){this.$refs.form.validate(async e=>{if(e)if(this.attach)this.fetchEditAttachment();else if(this.objId)this.fetchAddLink(this.objId);else{const e=await this.initTemporaryBucket();e&&this.fetchAddLink(e)}else this.$Message.error("提交失败，请检查是否有遗漏")})},initTemporaryBucket(){const{objType:e}=this;if("temporary"===e)return this.fetchCreateBucket()}},asyncMethods:{fetchAddLink(e){const{form:t,objId:s,objType:a,objScene:i}=this,l={obj_type:a,obj_id:e||s,attach_scene:i,attach_name:t.attach_name||t.attach_path,attach_path:t.attach_path};return Object(r["a"])(l).then(()=>{this.visible=!1,this.$emit("refresh"),this.$Message.success("提交成功！")}).catch(e=>{console.log(e),this.$Message.error("提交失败："+e.message)})},fetchEditAttachment(){const{form:e,attach:t,attachType:s}=this,a={attach_id:e.attach_id,attach_name:e.attach_name||("link"===s?e.attach_path:t.attach_name),attach_path:e.attach_path};return Object(r["e"])(a).then(()=>{this.visible=!1,this.$emit("refresh"),this.$Message.success("修改成功！")}).catch(e=>{console.log(e),this.$Message.error("修改失败："+e.message)})},fetchCreateBucket(){const e={obj_type:this.objType,attach_scene:this.objScene};return Object(r["c"])(e).then(e=>(console.log("创建临时桶"+e),this.$emit("initTemporaryBucket",e),e)).catch(e=>{console.log(e),this.$Message.error("提交失败：创建临时桶失败："+e.message)})}}},n=l,o=s("2be6"),c=Object(o["a"])(n,a,i,!1,null,null,null);t["a"]=c.exports},ac90:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("h3",[e._v(e._s(e.headerOptions[e.type].header))])]),s("p",{staticClass:"mbm",domProps:{innerHTML:e._s(e.headerOptions[e.type].desc)}}),s("Select",{staticClass:"mbm",attrs:{transfer:""},on:{"on-change":e.changeTask},model:{value:e.form.task_id,callback:function(t){e.$set(e.form,"task_id",t)},expression:"form.task_id"}},e._l(e.labelGroupTasks,(function(t){return s("Option",{key:t.task_id,attrs:{value:t.task_id,label:t.task_name}},[e._v(e._s(t.task_name))])})),1),s("templateValidate",{directives:[{name:"show",rawName:"v-show",value:e.dataset&&e.dataset.dataset_code&&e.form.template_id,expression:"dataset && dataset.dataset_code && form.template_id"}],attrs:{datasetCode:e.dataset&&e.dataset.dataset_code,templateId:e.form.template_id},on:{"update:index":function(t){e.templateValidIndex=t}}}),["next"].includes(e.type)&&e.labelGroupTasks&&!e.labelGroupTasks.length?s("p",{staticClass:"txt-muted"},[s("span",[e._v("当前任务未配置后置任务，请前往")]),s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.goEditFormalTask()}}},[e._v("任务编辑页")]),s("span",[e._v("配置")])]):e._e(),s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),["first"].includes(e.type)?[s("Tooltip",{staticClass:"mls",attrs:{content:"选择任务并校验，校验通过即可提交",disabled:3===e.templateValidIndex}},[s("Button",{attrs:{type:"primary",disabled:3!==e.templateValidIndex,loading:e.fetchAppendDataSetToFormalTask.isPending},on:{click:e.submit}},[e._v("确定")])],1)]:e._e(),["next"].includes(e.type)?[s("Button",{attrs:{type:"primary",disabled:!e.form.task_id,loading:e.fetchAppendDeliverDetailToNextTask.isPending},on:{click:e.submit}},[e._v("确定")])]:e._e()],2)],1)},i=[],r=(s("8d0d"),s("9ec3")),l=s("2fa2"),n=s("06eb"),o=s("4463"),c=s("cb78"),d={components:{templateValidate:l["a"]},props:{type:String,projectId:String,dataset:Object,lastTask:Object,deliver:Object},data(){return{visible:!0,headerOptions:{first:{header:"导入动态任务",desc:'导入到当前项目下<span class="txt-red">进行中</span>且<span class="txt-red">无前置任务</span>的动态任务中'},next:{header:"导入后置任务",desc:'导入到当前任务<span class="txt-red">进行中</span>的后置任务'}},form:{formal_code:"",formal_id:"",task_id:"",template_id:""},templateValidIndex:0}},mounted(){this.fetchLabelGroupTasks()},methods:{changeTask(e){const{type:t,labelGroupTasks:s}=this,a=Object(r["find"])(s,t=>t.task_id===e);a&&(this.form.task_id=a.task_id,this.form.formal_id=a.formal_id,this.form.formal_code=a.formal_code,["first"].includes(t)&&(this.form.template_id=a.template_id))},goEditFormalTask(){this.$emit("goEditFormalTask"),this.visible=!1},submit(){const{type:e}=this;["first"].includes(e)&&(this.dataset.valid_cnt-this.dataset.published_cnt>0?this.fetchAppendDataSetToFormalTask():this.$Message.error("提交失败，数据包剩余题目不足")),["next"].includes(e)&&this.fetchAppendDeliverDetailToNextTask()}},asyncMethods:{fetchLabelGroupTasks(){const{projectId:e,type:t,lastTask:s}=this,a={project_id:e,pre_task_id:["first"].includes(t)?0:s.task_id.toString()};return c["a"].listLabelGroupTasks(a).then(e=>e.data.result.data).catch(e=>{console.log(e)})},fetchAppendDataSetToFormalTask(){const{projectId:e,form:t,dataset:s}=this,a={project_id:e,formal_code:t.formal_code,task_id:t.task_id,dataset_import_id:s.dataset_import_id,data_num:s.valid_cnt-s.published_cnt,pack_num:void 0};return s.tag_key&&s.tag_cnt&&(a.pack_num=s.tag_cnt),Object(n["a"])(a).then(()=>{this.visible=!1,this.$Message.success("提交成功！"),this.$emit("refresh")}).catch(e=>{console.log(e),this.$Message.error("提交失败："+e.message)})},fetchAppendDeliverDetailToNextTask(){const{form:e,deliver:t,lastTask:s}=this,a={formal_id:e.formal_id,task_id:s.task_id.toString(),deliver_id:t.deliver_id.toString(),next_task_id:e.task_id,data_num:t.deliver_num};return Object(o["b"])(a).then(()=>{this.visible=!1,this.$Message.success("提交成功！"),this.$emit("refresh")}).catch(e=>{console.log(e),this.$Message.error("提交失败："+e.message)})}}},u=d,p=(s("e352"),s("2be6")),m=Object(p["a"])(u,a,i,!1,null,"6985b55a",null);t["a"]=m.exports},ad4a:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{width:"100%"}},[e.loading?s("Spin",{attrs:{fix:""}}):e._e(),e.attachments.length>0?s("CellGroup",e._l(e.attachments,(function(t){return s("Cell",{key:t.attach_id.toString(),staticClass:"attachments"},[s("Row",{staticClass:"content",attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("div",{staticClass:"icon"},[e.isFile(t)?s("Icon",{staticClass:"mrs",attrs:{type:"md-attach",size:"16"}}):e._e()],1),s("div",{staticClass:"title",on:{click:function(s){e.isFile(t)?e.downloadFile(t):e.openLink(t)}}},[e.isFile(t)?[s("Row",{attrs:{type:"flex",justify:"space-between"}},[s("div",{staticClass:"ellipsis"},[e._v(e._s(t.attach_name))]),e.uploadQueue[t.attach_id]?[e.uploadState(t,["queue-end"])?[0===t.attach_status?s("uploadStatusRender",{staticClass:"status finish",attrs:{uploadInfo:e.uploadQueue[t.attach_id],fileSize:t.attach_size}}):e._e()]:[s("uploadStatusRender",{staticClass:"status",attrs:{uploadInfo:e.uploadQueue[t.attach_id],fileSize:t.attach_size}})]]:e._e()],2),e.uploadState(t,["paused","unCompleted"])?[s("Progress",{staticClass:"progress txt-muted",attrs:{percent:e.percent(t),"stroke-width":3,"hide-info":""}})]:e._e(),e.uploadState(t,["waiting","uploading"])?[s("Progress",{staticClass:"progress txt-muted",attrs:{percent:e.percent(t),"stroke-width":3,"hide-info":"",status:"active"}})]:e._e()]:e._e(),e.isLink(t)?s("div",{staticClass:"ellipsis"},[s("a",{staticStyle:{"margin-left":"3px"},attrs:{title:"点击在新标签页中打开链接",target:"_blank"}},[e._v(e._s(t.attach_name))])]):e._e()],2),s("div",{staticClass:"extra mls"},[e.isDownloadOk?[e.isFile(t)&&1===t.attach_status?[s("Tooltip",{attrs:{content:"下载",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-download",size:"18"}})],1)]:e._e(),e.isLink(t)?[s("Tooltip",{attrs:{content:"新标签页打开",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"ios-redo",size:"18"}})],1)]:e._e()]:e._e(),e.isWriteOk?[e.isFile(t)?[e.uploadQueue[t.attach_id]?[e.uploadState(t,["waiting","uploading"])?[s("Tooltip",{attrs:{content:"暂停上传",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"ios-pause",size:"16"},on:{click:function(s){return e.pauseUpload(t)}}})],1)]:e._e(),e.uploadState(t,["paused","unCompleted"])?[s("Tooltip",{attrs:{content:"继续上传",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-play",size:"14"},on:{click:function(s){return e.restartUpload(t)}}})],1)]:e._e(),e.uploadState(t,["notStart","error"])?[s("Tooltip",{attrs:{content:"重试",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-refresh",size:"16"},on:{click:function(s){return e.restartUpload(t)}}})],1)]:e._e(),e.uploadState(t,["queue-error"])?[s("Tooltip",{attrs:{content:"重试",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-refresh",size:"16"},on:{click:function(s){return e.retryUpload(t)}}})],1)]:e._e()]:e._e(),e.uploadState(t,["queue-end"])||1===t.attach_status?[s("Tooltip",{attrs:{content:"编辑文件名称",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-create",size:"16"},on:{click:function(s){return e.editFile(t)}}})],1)]:e._e()]:e._e(),e.isLink(t)?[s("Tooltip",{attrs:{content:"编辑文档链接",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-create",size:"16"},on:{click:function(s){return e.editLink(t)}}})],1)]:e._e(),s("Tooltip",{attrs:{content:"删除",placement:"top",trigger:"hover",transfer:"",offset:5}},[s("Poptip",{attrs:{confirm:"",transfer:"",title:"删除这个"+e.attachTypeOptions[t.attach_type]+"？"},on:{"on-ok":function(s){return e.fetchDeleteAttachments(t)}}},[s("Icon",{staticClass:"mlm",attrs:{type:"md-close",size:"16"}})],1)],1)]:e._e()],2)])],1)})),1):s("div",{staticClass:"mlm txt-muted"},[e._v("无文档")]),e.isUploadOk?s("Row",{staticClass:"attachments mtm",attrs:{gutter:5}},[s("Col",{attrs:{span:"12"}},[s("Upload",{attrs:{multiple:"","default-file-list":e.files,"show-upload-list":!1,"before-upload":e.addFile,action:""}},[s("Button",{attrs:{type:"default",long:"",icon:"md-cloud-upload"}},[e._v("上传文件")])],1)],1),s("Col",{attrs:{span:"12"}},[s("Button",{attrs:{type:"default",long:"",icon:"md-add"},on:{click:function(t){return e.editLink()}}},[e._v("添加链接")])],1)],1):e._e()],1)},i=[],r=(s("8d0d"),s("9ec3")),l=s("a9f8"),n=s("ffd0"),o=s("f558"),c=s("c54b"),d=s("9ce4"),u=s("db98"),p={components:{update:l["a"],uploadStatusRender:u["a"]},props:{options:[Boolean,Array],objId:String,objType:String,objScene:String,task:Object,from:{type:String,default:""}},data(){return{visible:!1,form:{url:""},files:[],attachments:[],attachTypeOptions:{file:"文件",link:"链接"},bucketId:""}},computed:{...Object(d["c"])({uploadQueue:"uploadQueue"}),isUploadOk(){return"boolean"===typeof this.options&&this.options||"object"===typeof this.options&&this.options.includes("upload")},isDownloadOk(){return"boolean"===typeof this.options&&this.options||"object"===typeof this.options&&this.options.includes("download")},isWriteOk(){return"boolean"===typeof this.options&&this.options||"object"===typeof this.options&&this.options.includes("write")},isLink(){return function(e){return"link"===e.attach_type}},isFile(){return function(e){return"file"===e.attach_type}},percent(){return function(e){const t=this.uploadQueue[e.attach_id];return null!==t&&void 0!==t&&t.percent?100*(null===t||void 0===t?void 0:t.percent):Number(((null===t||void 0===t?void 0:t.loaded)/e.attach_size*100).toFixed(2))}},uploadState(){return function(e,t){return this.uploadQueue[e.attach_id]&&this.uploadQueue[e.attach_id].state&&t.includes(this.uploadQueue[e.attach_id].state)}},loading(){return this.fetchAttachments.isPending||this.fetchAddUpload.isPending||this.fetchDeleteAttachments.isPending}},mounted(){const{objType:e}=this;"temporary"!==e&&this.fetchAttachments().then(e=>this.checkUploadList(e))},methods:{...Object(d["b"])({setUploadQueue:"setUploadQueue"}),addFile(e){return e?(!this.objId&&!this.bucketId&&this.initTemporaryBucket(),this.files.push(e),this.debounce(this.files),!1):(this.$Message.error("文件不能为空"),!1)},editFile(e){const t=this,{task:s}=this;this.$FastModal.show(l["a"],{task:s,attach:e,attachType:"file"},{refresh(){t.fetchAttachments()}})},editLink(e){const t=this,{task:s,objId:a,objType:i,objScene:r,bucketId:n}=this;this.$FastModal.show(l["a"],{task:s,attach:e,attachType:"link",objId:n||a,objType:i,objScene:r},{initTemporaryBucket(e){t.bucketId=e,t.$emit("initTemporaryBucket",t.bucketId)},refresh(){t.fetchAttachments()}})},debounce:Object(r["debounce"])((function(e){this.uploadFiles(e)}),500),async uploadFiles(e){const t=this,s=[];for(let a=0;a<e.length;a++){const t=e[a],i=await this.fetchAddUpload(t);i&&s.push({...i,file:t})}this.fetchAttachments().then(()=>{for(let e=0;e<s.length;e++){const a=s[e],{attach_id:i,bucket:r,region:l,prefix:n,scene:o,file:d}=a,u={id:i,type:"attachment",Bucket:r,Region:l,Key:`${n}/${i}/${o}/${d.name}`,file:d,handleTaskReady(){t.$emit("handleTaskReady")}};Object(c["c"])(u)}}),this.files=[]},pauseUpload(e){this.uploadQueue[e.attach_id].cos.pauseTask(this.uploadQueue[e.attach_id].id)},restartUpload(e){this.uploadQueue[e.attach_id].cos?this.uploadQueue[e.attach_id].cos.restartTask(this.uploadQueue[e.attach_id].id):this.fetchUploadSecret(e).then(t=>{const{bucket:s,region:a,prefix:i,scene:r}=t;Object(c["a"])({id:e.attach_id,type:"attachment",bucket:s,region:a,prefix:i,scene:r,fileName:e.attach_name,fileSize:e.attach_size})})},retryUpload(e){const t=e.attach_id;this.setUploadQueue({id:t,data:{state:"queuing"}}),Object(o["a"])({attach_id:t}).then(()=>{this.setUploadQueue({id:t,data:{state:"queue-end"}})}).catch(e=>{this.$Message.error(e.message),this.setUploadQueue({id:t,data:{state:"queue-error"}})})},downloadFile(e){this.isDownloadOk&&this.isFile(e)&&1===e.attach_status&&this.fetchAttachmentUrl(e).then(e=>{window.open("https://"+e.download_link,"_blank")})},openLink(e){this.isLink(e)&&window.open(e.attach_path,e.attach_id)},checkUploadList(e){e.forEach(e=>{this.uploadQueue[e.attach_id]||"file"!==e.attach_type||0!==e.attach_status||this.fetchUploadSecret(e).then(t=>{const{attach_id:s,attach_name:a}=e,{bucket:i,region:r,prefix:l,scene:n}=t,o={id:s,Bucket:i,Region:r,Prefix:`${l}/${s}/${n}/${a}`};Object(c["b"])(o)})})},initTemporaryBucket(){const{objType:e}=this;"temporary"===e&&this.fetchCreateBucket()}},asyncMethods:{fetchAttachments(){const{task:e,from:t,objId:s,bucketId:a,objType:i,objScene:r}=this,l={obj_type:i,obj_id:"temporary"===i&&a?a:s,attach_scene:r};return"workbench"===t&&(l.auth_object_type="task",l.auth_object_id=e.task_id),Object(n["h"])(l).then(e=>(this.$emit("attachments",e.data),e.data))},fetchAddUpload(e){const{objId:t,bucketId:s,objType:a,objScene:i}=this,r={obj_type:a,obj_id:"temporary"===a&&s?s:t,attach_scene:i,attach_name:e.name,attach_size:e.size};return Object(n["b"])(r).then(e=>e.data[0]).catch(e=>{console.log(e),this.$Message.error("上传失败："+e.message)})},fetchDeleteAttachments(e){const t={attach_id:e.attach_id};return Object(n["d"])(t).then(()=>{this.fetchAttachments()}).catch(e=>{console.log(e),this.$Message.error("删除失败："+e.message)})},fetchUploadSecret(e){const t={attach_id:e.attach_id};return Object(n["g"])(t).then(e=>e)},fetchAttachmentUrl(e){const{task:t,from:s}=this,a={attach_id:e.attach_id};return"workbench"===s&&(a.auth_object_type="task",a.auth_object_id=t.task_id),Object(n["f"])(a).then(e=>e)},fetchCreateBucket(){const e={obj_type:this.objType,attach_scene:this.objScene};return Object(n["c"])(e).then(e=>(console.log("创建临时桶"+e),this.bucketId=e,this.$emit("initTemporaryBucket",e),e)).catch(e=>{console.log(e),this.$Message.error("提交失败：创建临时桶失败："+e.message)})},fetchOverwriteAttachments(e,t){const s={obj_id:e,obj_type:"order",attach_scene:this.objScene,target_bucket_id:t};return Object(n["i"])(s).then(()=>{this.fetchAttachments()}).catch(e=>{console.log(e),this.$Message.error("拉取桶附件失败："+e.massage)})}}},m=p,h=(s("f7aa"),s("2be6")),_=Object(h["a"])(m,a,i,!1,null,"66153fff",null);t["a"]=_.exports},b53d:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{margin:"10px 0","margin-top":"20px"}},[e._l(e.addLabelArray,(function(t,a){return s("div",[s("t-space",{staticStyle:{"justify-content":"space-between",display:"flex"}},[s("t-space",{attrs:{align:"center"}},[s("span",[e._v("元素标签筛选("+e._s(t.label)+")")]),s("RadioGroup",{model:{value:t.filterLogic,callback:function(s){e.$set(t,"filterLogic",s)},expression:"addLabel.filterLogic"}},[s("Radio",{attrs:{label:"and"}},[e._v("满足以下全部条件")]),s("Radio",{attrs:{label:"or"}},[e._v("满足以下任一条件")])],1)],1),s("DeleteIcon",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.deleteLabel(a)}}})],1),s("AttributesFilter",{ref:"AttributesFilter",refInFor:!0,attrs:{index:a,attributes:t,filterType:e.filterType,template:e.template,editEnabled:!e.isEdit},on:{"update:filter":e.emitFilter,getNum:e.getNum}})],1)})),s("t-dropdown",{attrs:{options:e.labelToolsOptions},on:{click:e.handleAddLabels}},[s("t-button",{attrs:{theme:"primary"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("AddIcon")]},proxy:!0}])},[s("span",[e._v("新建元素标签筛选")])])],1)],2)},i=[],r=(s("8d0d"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{margin:"10px 0"}},[s("div",[Object.keys(e.attributes.filterOption.data).length?s("div",[s("t-row",{staticStyle:{gap:"8px"},attrs:{align:"center"}},[s("t-col",{staticStyle:{width:"60px"}},[s("span",[e._v("data")]),s("t-tooltip",{attrs:{content:"可查看标注结果json中的data值定位具体的元素标签"}},[s("HelpCircleIcon",{attrs:{value:16}})],1)],1),e._l(Object.keys(e.attributes.filterOption.data),(function(t){return s("t-col",{staticStyle:{width:"260px"}},[s("t-input-adornment",{attrs:{prepend:t}},[s("t-input",{attrs:{placeholder:"请输入内容"},model:{value:e.attributes.filterOption.data[t],callback:function(s){e.$set(e.attributes.filterOption.data,t,s)},expression:"attributes.filterOption.data[item]"}})],1)],1)}))],2)],1):e._e(),s("div",{staticStyle:{"margin-top":"20px"}},[s("span",[e._v("featureid")]),s("t-tooltip",{attrs:{content:"可查看标注结果json中的feature值定位具体的元素标签"}},[s("HelpCircleIcon",{attrs:{value:16}})],1),s("t-input",{staticStyle:{width:"40%",display:"inline-block","margin-left":"20px"},attrs:{placeholder:"请输入内容"}})],1)]),s("Table",{ref:"form",attrs:{columns:e.columns(e.filterType),data:e.form[e.filterType]},scopedSlots:e._u([{key:"label",fn:function(t){var a=t.row,i=t.index;return[e.editIndex===i?s("Select",{attrs:{transfer:""},on:{"on-change":e.changeFilter},model:{value:e.editItem[e.filterType].label,callback:function(t){e.$set(e.editItem[e.filterType],"label",t)},expression:"editItem[filterType].label"}},e._l(e.labelObejctItems,(function(t){return s("Option",{key:t.attributes.label,attrs:{value:t.attributes.label}},[e._v(e._s(t.attributes.label))])})),1):s("span",[e._v(e._s(a.label||"-"))])]}},{key:"multiple",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?[e.editItem[e.filterType].label?s("span",[e._v(e._s(e.labelValueName(e.editItem[e.filterType])))]):e._e()]:s("span",[e._v(e._s(e.labelValueName(a)))])]:void 0}},{key:"equal",fn:function(t){t.row;return["label"].includes(e.filterType)?[s("span",[e._v("=")])]:void 0}},{key:"values",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?[[0,1].includes(e.editItem[e.filterType].label_type)?s("Select",{attrs:{multiple:"",transfer:""},model:{value:e.editItem[e.filterType].values,callback:function(t){e.$set(e.editItem[e.filterType],"values",t)},expression:"editItem[filterType].values"}},[e.editItem[e.filterType].label?[e.labelValuesOptions.attributes.isMutuallyExclusive?e._l(e.labelValuesOptions.attributes.exclusiveOptions.flat(),(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])})):e._l(e.resolveOptions(e.labelValuesOptions.attributes.options),(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.value))])}))]:e._e()],2):e._e(),[2].includes(e.editItem[e.filterType].label_type)?s("optimus-engine",e._b({ref:"cascaderOptimus",staticClass:"cascader-optimus"},"optimus-engine",e.itemComponent(e.editItem[e.filterType]),!1)):e._e()]:s("span",{staticClass:"values"},[[0,1].includes(a.label_type)?[e._v(e._s(a.values.join("、")))]:e._e(),[2].includes(a.label_type)?[e._v(e._s(e.transformCascaderValues(a.values)))]:e._e()],2)]:void 0}},{key:"condition",fn:function(t){var a=t.row,i=t.index;return["label"].includes(e.filterType)?[e.editIndex===i?s("Select",{attrs:{transfer:""},model:{value:e.editItem[e.filterType].condition,callback:function(t){e.$set(e.editItem[e.filterType],"condition",t)},expression:"editItem[filterType].condition"}},[s("Option",{attrs:{value:"any"}},[e._v("满足任一取值")]),e.isMultipleStage?s("Option",{attrs:{value:"all"}},[e._v("满足全部取值")]):e._e()],1):s("span",[e._v(e._s("any"===a.condition?"满足任一取值":"满足全部取值"))])]:void 0}},{key:"cross_label",fn:function(t){var a=t.row,i=t.index;return["cross"].includes(e.filterType)?[e.editIndex===i?s("Select",{attrs:{transfer:""},on:{"on-change":e.changeFilter},model:{value:e.editItem[e.filterType].label,callback:function(t){e.$set(e.editItem[e.filterType],"label",t)},expression:"editItem[filterType].label"}},[s("Option",{attrs:{value:"题目"}},[e._v("题目")]),e._l(e.templateLabelsCross,(function(t){return s("Option",{key:t.attributes.label,attrs:{value:t.attributes.label}},[e._v(e._s(t.attributes.label))])}))],2):s("span",[e._v(e._s(a.label||"-"))])]:void 0}},{key:"quota_type",fn:function(t){var a=t.row,i=t.index;return["cross"].includes(e.filterType)?[e.editIndex===i?[e.editItem[e.filterType].label?[s("Select",{attrs:{transfer:""},model:{value:e.editItem[e.filterType].quota_type,callback:function(t){e.$set(e.editItem[e.filterType],"quota_type",t)},expression:"editItem[filterType].quota_type"}},[e._l(e.quotaTypeOptions,(function(t,a){return[s("Option",{key:a,attrs:{value:Number(a)}},[e._v(e._s(t.label))])]}))],2)]:e._e()]:[e._l(e.quotaTypeOptions,(function(t,i){return[a.quota_type===Number(i)?s("span",{key:i},[e._v(e._s(t.label))]):e._e()]}))]]:void 0}},{key:"cross_condition",fn:function(t){var a=t.row,i=t.index;return["cross"].includes(e.filterType)?[e.editIndex===i?[e.editItem[e.filterType].label?[s("Row",{attrs:{gutter:5}},[s("Col",{attrs:{span:"10"}},[s("Select",{attrs:{transfer:""},model:{value:e.editItem[e.filterType].operate_type,callback:function(t){e.$set(e.editItem[e.filterType],"operate_type",t)},expression:"editItem[filterType].operate_type"}},e._l(e.operateTypeOptions,(function(t,a){return s("Option",{key:a,attrs:{value:Number(a)}},[e._v(e._s(t))])})),1)],1),s("Col",{attrs:{span:"12"}},[e.editItem[e.filterType].quota_type&&e.editItem[e.filterType].quota_type%2!==0?[s("InputNumber",{staticStyle:{width:"75%"},attrs:{min:0,max:100,precision:.1},model:{value:e.editItem[e.filterType].value,callback:function(t){e.$set(e.editItem[e.filterType],"value",t)},expression:"editItem[filterType].value"}}),s("span",{staticClass:"mls"},[e._v("%")])]:[s("InputNumber",{attrs:{min:0,precision:1},model:{value:e.editItem[e.filterType].value,callback:function(t){e.$set(e.editItem[e.filterType],"value",t)},expression:"editItem[filterType].value"}})]],2)],1)]:e._e()]:[e._l(e.operateTypeOptions,(function(t,i){return[a.operate_type===Number(i)?s("span",{key:i},[e._v(e._s(t))]):e._e()]})),s("span",[e._v(e._s(a.value))]),a.quota_type%2!==0?s("span",[e._v("%")]):e._e()]]:void 0}},{key:"action",fn:function(t){var a=t.row,i=t.index;return[e.editEnabled?[e.editIndex===i?[s("a",{on:{click:function(t){return e.saveFilter(e.filterType,i)}}},[e._v("保存")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){a.label?e.cancelFilter(e.filterType):e.deleteFilter(e.filterType,i)}}},[e._v("取消")])]:-1===e.editIndex?[s("a",{on:{click:function(t){return e.editFilter(e.filterType,i)}}},[e._v("编辑")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){return e.deleteFilter(e.filterType,i)}}},[e._v("删除")])]:e._e()]:[s("span",[e._v("-")])]]}}],null,!0)}),e.editEnabled?s("Button",{staticClass:"mtm",attrs:{type:"dashed",icon:"md-add",long:"",disabled:-1!==e.editIndex},on:{click:function(t){return e.addFilter(e.filterType)}}},[e._v("新增")]):e._e()],1)}),l=[],n=(s("0f30"),s("9ec3")),o=s("8416"),c=s("4528"),d=s("1cda"),u=s("4f2b"),p=s("bd51"),m=s("5feb"),h=(s("3bde"),["size"]);function _(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function f(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?_(Object(s),!0).forEach((function(t){Object(c["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):_(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var v={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12 21a9 9 0 100-18 9 9 0 000 18zm11-9a11 11 0 11-22 0 11 11 0 0122 0zm-10 6.25h-2v-2h2v2zm-2-3V14c0-.87.39-1.57.83-2.11.43-.53.97-.97 1.4-1.32A2 2 0 0012 7a2 2 0 00-1.89 1.33l-.33.95-1.89-.67.34-.94a4 4 0 116.24 4.47 7 7 0 00-1.1 1.01c-.27.34-.37.61-.37.85v1.25h-2z"}}]},b=u["default"].extend({name:"HelpCircleIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(e,t){var s=t.props,a=t.data,i=s.size,r=Object(d["a"])(s,h),l=Object(m["a"])(i),n=l.className,o=l.style,c=f(f({},r||{}),{},{id:"help-circle",icon:v,staticClass:n,style:o});return a.props=c,e(p["a"],a)}}),k=b,y={components:{HelpCircleIcon:k},props:{filterType:String,template:Object,editEnabled:{type:Boolean,default:!0},scene:{type:String,default:""},attributes:Object,index:Number},data(){return{form:{label:[],cross:[]},labelObejctItems:[],templateLabels:[],templateLabelsCross:[],componentOptions:{"z-select":{component_name:"单选框",component_type:0},"z-single-select":{component_name:"单选框",component_type:0},"z-multiple-select":{component_name:"多选框",component_type:1},"z-cascader":{component_name:"级联选择器",component_type:2}},columnOptions:{label:{label:"标签名",multiple:"类型",equal:" ",values:"value(取值)",condition:"满足条件",action:"操作"},cross:{label:"标签名",quota_type:"结果评价指标",cross_condition:"满足条件",action:"操作"}},quotaTypeOptions:{3:{label:"最终结果(一致率)",type:"most"},4:{label:"最终结果(分差)",type:"average"},1:{label:"拟合结果(置信度)",type:"most"},2:{label:"拟合结果(分差)",type:"average"}},operateTypeOptions:{2:"小于",3:"等于",1:"大于"},editItem:{label:{name:"",label:"",values:"",label_type:"",condition:""},cross:{name:"",label:"",quota_type:"",operate_type:"",value:0}},CrossEditItemType:"",editIndex:-1}},computed:{columns(){return function(e){return Object(n["map"])(this.columnOptions[e],(e,t)=>({title:e,slot:t,width:"equal"===t&&50}))}},labelValuesOptions(){const{labelObejctItems:e,editItem:t,filterType:s}=this,a=e.find(e=>e.attributes.label===t[s].label);return a},labelValueName(){return function(e){if(!e.label_type&&0!==e.label_type)return"";const{componentOptions:t,templateLabels:s}=this,a=Object.keys(t).find(s=>t[s].component_type===e.label_type);if(["z-multiple-select"].includes(a)){var i;const t=s.find(t=>t.attributes.name===e.name);if(null!==t&&void 0!==t&&null!==(i=t.attributes)&&void 0!==i&&i.selectType){const{selectType:e}=t.attributes;return"single"===e?"选择器(单选)":"选择器(多选)"}}return t[a].component_name}},isEmptyFilter(){const{editItem:e,filterType:t}=this;let s=!0;const a=e[t];return Object(n["forIn"])(a,(e,t)=>((""===e||void 0===e||e.length<=0||0===e&&!["value","label_type"].includes(t))&&(s=!1),s)),!s},itemComponent(){return function(e){const t=Object(n["cloneDeep"])([{...this.labelValuesOptions}]);t[0].attributes.label="",t[0].attributes.mode="多选";let s={};return e.values&&(s={tags:[{name:e.name,label:e.label,value:e.values.map(e=>JSON.parse(e))}]}),{component:{component:"z-form-stage",items:t},context:{},answer:s}}},isMultipleStage(){const{labelValuesOptions:e}=this;if(e)return["z-multiple-select"].includes(e.component)&&(!e.attributes.selectType||["multiple"].includes(e.attributes.selectType))||["多选"].includes(e.attributes.mode)}},watch:{"form.label"(){this.updateFilter()},"form.cross"(){this.updateFilter()}},mounted(){const{template:e}=this;if(e&&e.template_id){var t;const{componentOptions:s}=this;this.templateComponent=JSON.parse(e.template_component),this.templateLabels=Object(n["remove"])(this.templateComponent.items,e=>Object.hasOwn(s,e.component)),this.labelObejctItems="cross"===this.filterType?this.templateComponent.$object_items:null===(t=this.templateComponent.$object_items)||void 0===t?void 0:t.filter(e=>{var t;return!(null===(t=this.componentOptions[e.component])||void 0===t||!t.component_name)}),this.templateLabelsCross=JSON.parse(e.template_component).items}},beforeDestroy(){Object.keys(this.form).forEach(e=>{this.form[e]=[]}),this.updateFilter()},methods:{changeFilter(e){var t,s;const{filterType:a,labelValuesOptions:i,componentOptions:r}=this;switch(a){case"label":this.editItem[a].name=i.attributes.name,this.editItem[a].label=i.attributes.label,this.editItem[a].label_type=r[i.component].component_type,this.editItem[a].values="";break;case"cross":this.editItem[a].label=e,this.editItem[a].name=null===(t=this.templateComponent.$object_items.filter(t=>t.attributes.label===e))||void 0===t||null===(s=t[0])||void 0===s?void 0:s.attributes.name;break}},addFilter(e){this.form[e].push({...this.editItem[e]}),this.editIndex=this.form[e].length-1},saveFilter(e,t){const s=this.editItem[e];if([2].includes(s.label_type)){var a;const e=null===(a=this.$refs.cascaderOptimus)||void 0===a?void 0:a.formData[s.name];e&&(s.values=e.map(e=>JSON.stringify(e)))}this.isEmptyFilter?this.$Message.error("不能有空值，请检查"):(Object.assign(this.form[e][t],s),this.getNum(),this.cancelFilter(e))},cancelFilter(e){Object(n["forIn"])(this.editItem[e],(t,s)=>{switch(typeof t){case"object":case"string":this.editItem[e][s]="";break;case"number":this.editItem[e][s]=0;break}}),this.editIndex=-1},editFilter(e,t){Object.assign(this.editItem[e],this.form[e][t]),this.editIndex=t},deleteFilter(e,t){this.form[e].splice(t,1),this.getNum(),this.cancelFilter(e)},verifyFilter(){const{filterType:e}=this;Object(n["map"])(this.form[e],(t,s)=>{let a=!1;Object(n["forIn"])(t,(t,i)=>(a=!!t||a,!(t||"cross"===e&&"value"===i)&&this.deleteFilter(e,s),!1)),a||this.deleteFilter(e,s)})},updateFilter(){const{form:e,filterType:t}=this;this.$emit("update:filter",e[t],this.index)},getNum(){this.updateFilter(),this.$emit("getNum")},transformCascaderValues(e){return"object"===typeof e&&e.length?e.map(e=>JSON.parse(e).join("/")).join("、"):"string"===typeof e?e.split("、").map(e=>JSON.parse(e.split("/"))):void 0},resolveOptions(e){if("string"===typeof e){var t;if(e.startsWith("${")&&e.endsWith("}")){var s;const t=e.replace(/^\$\{/,"").replace(/\}$/,""),a=new Function("input","output","objOutput","groupOutput","return "+t);return null!==(s=a(Object(o["d"])({}),Object(o["d"])({}),Object(o["d"])({}),Object(o["d"])({})))&&void 0!==s?s:[]}return null===(t=e.split(","))||void 0===t?void 0:t.map(e=>({value:e,label:e}))}return null!==e&&void 0!==e?e:[]}}},g=y,T=(s("4900"),s("2be6")),j=Object(T["a"])(g,r,l,!1,null,"5dda5016",null),O=j.exports,w=["size"];function x(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function I(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?x(Object(s),!0).forEach((function(t){Object(c["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):x(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var C={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M13 4v7h7v2h-7v7h-2v-7H4v-2h7V4h2z"}}]},D=u["default"].extend({name:"AddIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(e,t){var s=t.props,a=t.data,i=s.size,r=Object(d["a"])(s,w),l=Object(m["a"])(i),n=l.className,o=l.style,c=I(I({},r||{}),{},{id:"add",icon:C,staticClass:n,style:o});return a.props=c,e(p["a"],a)}}),S=D,E=["size"];function $(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,a)}return s}function A(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?$(Object(s),!0).forEach((function(t){Object(c["a"])(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}var R={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M7.5 1h9v3H22v2h-2.03l-.5 17H4.53l-.5-17H2V4h5.5V1zm2 3h5V3h-5v1zM6.03 6l.44 15h11.06l.44-15H6.03zM13 8v11h-2V8h2z"}}]},L=u["default"].extend({name:"DeleteIcon",functional:!0,props:{size:{type:String},onClick:{type:Function}},render:function(e,t){var s=t.props,a=t.data,i=s.size,r=Object(d["a"])(s,E),l=Object(m["a"])(i),n=l.className,o=l.style,c=A(A({},r||{}),{},{id:"delete",icon:R,staticClass:n,style:o});return a.props=c,e(p["a"],a)}}),F=L,P={components:{AttributesFilter:O,AddIcon:S,DeleteIcon:F},props:{filterType:String,template:Object,editEnabled:{type:Boolean,default:!0},scene:{type:String,default:""}},data(){return{labelTools:[],addLabelArray:[]}},computed:{labelToolsOptions(){return this.labelTools.map(e=>({content:e.label,value:e.name,type:e.type}))}},mounted(){const{template:e}=this;e&&e.template_id&&(this.templateComponent=JSON.parse(e.template_component),this.labelTools=this.templateComponent.$object_tools)},methods:{emitFilter(e,t){let s;console.log(e,t),this.addLabelArray[t].label_score_cond_dtos=e.map(e=>({object_name:this.addLabelArray[t].value,object_data:Object(n["omitBy"])(this.addLabelArray[t].filterOption.data,n["isNil"]),feature_id:this.addLabelArray[t].filterOption.feature_id,filter_type:3,...e})),s="cross"===this.filterType?this.addLabelArray.map(e=>({label_score_condition:e.filterLogic,label_score_cond_dtos:e.label_score_cond_dtos})):this.addLabelArray.map(e=>({label_value_condition:e.filterLogic,label_value_cond_dtos:e.label_score_cond_dtos})),this.$emit("update:filter",s)},getNum(){this.$emit("getNum")},handleAddLabels(e){var t,s,a,i,r;const{template_type:l}=this.template,n={},o=null===(t=this.$OptimusStageMetadata.filter(e=>e.name===l))||void 0===t||null===(s=t[0])||void 0===s||null===(a=s.objectAnswerJson)||void 0===a||null===(i=a.items)||void 0===i||null===(r=i.properties)||void 0===r?void 0:r.data;null!==o&&void 0!==o&&o.oneOf&&o.oneOf.forEach(t=>{t.description.split(";").includes(e.type)&&Object.keys(t.properties).forEach(e=>{n[e]=null})});const c={label:e.content,value:e.value,filterLogic:"and",filterOption:{data:{...n},featureId:""},label_score_cond_dtos:[]};this.addLabelArray.push(c)},deleteLabel(e){this.addLabelArray=this.addLabelArray.filter((t,s)=>s!==e)}}},M=P,N=Object(T["a"])(M,a,i,!1,null,"531a85e0",null);t["a"]=N.exports},b92b:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{width:850},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[e.isAudit?[s("h3",[e._v("审核提交")]),s("div",{staticClass:"mtm"},[e._v("支持按批次提交审核结果")])]:[s("h3",[e._v("批次交付")]),e.deliverId?s("div",{staticClass:"mtm"},[e._v("支持对待交付的批次，统一交付")]):s("div",{staticClass:"mtm"},[e._v("支持对待交付的批次批量交付，批次过多时建议合并后交付")])]],2),s("div",{staticClass:"content"},[s("Table",{ref:"delivers",attrs:{columns:e.columns,data:e.delivers,loading:e.fetchDelivers.isPending},on:{"on-selection-change":function(t){e.selection=t}},scopedSlots:e._u([{key:"deliver_name",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_name))])]}},{key:"deliver_num",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_num))])]}},{key:"checked_num",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.checked_num||0))])]}},{key:"checked_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.checked_percent+"%"))])]}},{key:"first_pass_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.first_pass_percent+"%"))])]}},{key:"pass_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.pass_percent+"%"))])]}}])}),s("Alert",{staticClass:"mtm",attrs:{"show-icon":""}},[e._v("本次交付数量："+e._s(e.submitNum))]),e.task.task_type&&e.project&&!e.project.multiple_bids?[s("Card",[s("p",[e._v("试标任务数据仅能交付一次（驳回后可再次交付），交付后不可修改。")]),s("p",[e._v("请前往"),s("b",[e._v("【企鹅智达】")]),s("span",[e._v("创建交付数据，填写工时周期后交付成功。")])]),s("p",{staticClass:"txt-red"},[e._v("请确定已在"),s("b",[e._v("【企鹅智达】")]),s("span",[e._v("上登录成功，且权限为“管理员”或“负责人”才可执行此操作。")])])])]:e._e()],2),s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[!e.task.task_type||e.project&&e.project.multiple_bids?[s("Button",{on:{click:function(t){e.visible=!1}}},[e._v("取消")]),s("Button",{attrs:{type:"primary",loading:e.fetchOpDeliver.isPending||e.fetchOpDeliver.isResolved||e.fetchBidRelation.isPending},on:{click:function(t){return e.submit()}}},[e._v("确认提交")])]:[s("Button",{on:{click:e.refresh}},[e._v("确认完成")]),e.Config.EXTERNAL_URL?s("Button",{attrs:{type:"primary",disabled:!e.selection.length,loading:e.fetchDataToAidata.isPending},on:{click:e.fetchDataToAidata}},[e._v("立即前往")]):e._e()]],2)])},i=[],r=s("9ec3"),l=s("864c"),n=s("4463"),o=s("bc94"),c=s("a06e"),d=s("db49"),u={props:{task:Object,deliverId:String,isAudit:Boolean,disabled:{type:Boolean,default:!1},isWorkbench:{type:Boolean,default:!0}},data(){return{Config:d["a"],visible:!0,columnsOptions:{deliver_name:"批次名称",deliver_num:"批次数量",checked_num:"已质检",checked_percent:"已质检占比",first_pass_percent:"抽检通过率",pass_percent:"校正后通过率"},delivers:[],selection:[],form:{work_time:0,work_period:0,commit_remark:""},ruleNotEmpty:{required:!0,message:"不能为空"}}},computed:{columns(){const e=Object(r["map"])(this.columnsOptions,(e,t)=>{const s={title:e,slot:t};return"deliver_name"===t&&(s.width=150),s});return e.unshift({type:"selection",width:60}),e},submitNum(){let e=0;return Object(r["map"])(this.selection,t=>e+=t.deliver_num),e}},async mounted(){var e;this.fetchProject();const t=await this.fetchDelivers();t&&(null===(e=this.$refs.delivers)||void 0===e||e.selectAll(!0)),this.delivers.forEach(e=>{this.$set(e,"_disabled",this.disabled),this.$set(e,"_checked",!0)})},methods:{refresh(){this.visible=!1,this.$emit("refresh")},async submit(){if(!this.submitNum)return void this.$Message.error("提交失败，交付数量不允许为0");const e=await this.fetchOpDeliver();e&&this.refresh()},goToExternal(){var e,t;const{bid_code:s,formal_code:a}=this.task;if(null===(e=this.Config)||void 0===e||null===(t=e.EXTERNAL_URL)||void 0===t||!t.zhida)return this.$Message.error("暂时不支持跳转到其他系统"),0;if(!(this.task.task_type&&s||!this.task.task_type&&a))return this.$Message.error("企鹅智达任务编号缺失"),0;const i=this.task.task_type?s:a,r=this.task.task_type?"bidtask":"formaltask";let l=`${this.Config.EXTERNAL_URL.zhida}/${r}/${i}?&origin=qlabel`,n="&deliver_id";this.selection.forEach((e,t)=>{!t&&(n=`${n}=${e.deliver_id}`)}),l=`${l}${n}`,window.open(l,"_blank")}},asyncMethods:{fetchProject(){const e={project_id:this.task.project_id};return Object(c["i"])(e).then(e=>e)},fetchDataToAidata(){return Object(o["b"])({task_id:this.task.task_id}).then(()=>{this.goToExternal()}).catch(e=>{console.log(e),this.$Message.error("数据对接失败，请重试")})},fetchDelivers(){const{task:e,isAudit:t,deliverId:s}=this,a={task_id:e.task_id,page:{start:0,size:500,return_total:1},deliver_status:t?20:10,from:t?2:0},i=this.isWorkbench?l["a"].ListDeliverTasks.bind(l["a"]):n["j"];return s&&(a.deliver_id=s),i(a).then(e=>{var t;const s=null!==(t=e.data.result)&&void 0!==t?t:e,a=Object(r["forEach"])(s.data,e=>{this.$set(e,"_checked",!1)});return a}).catch(e=>{console.log(e),this.$Message.error("列表数据获取失败，请刷新重试")})},fetchOpDeliver(){const e={project_id:this.task.project_id,task_id:this.task.task_id,deliver_id_list:Object(r["map"])(this.selection,e=>e.deliver_id),result:1};return Object(n["k"])(e).then(e=>{console.log(e),this.visible=!1,this.$emit("refresh"),setTimeout(()=>{this.$Message.success("批次交付成功！")},300)}).catch(e=>{console.log(e),this.$Message.error("批次交付失败："+e.message)})},fetchBidRelation(){const{task:e,form:t}=this,s={task_id:e.task_id,work_time:t.work_time,work_period:t.work_period,commit_remark:t.commit_remark,update:0};return l["a"].SubmitBidTask(s).then(e=>e).catch(e=>{console.log(e)})}}},p=u,m=(s("424a"),s("2be6")),h=Object(m["a"])(p,a,i,!1,null,"b710b3e2",null);t["a"]=h.exports},bc94:function(e,t,s){"use strict";s.d(t,"k",(function(){return i})),s.d(t,"l",(function(){return r})),s.d(t,"j",(function(){return l})),s.d(t,"c",(function(){return n})),s.d(t,"h",(function(){return o})),s.d(t,"w",(function(){return m})),s.d(t,"g",(function(){return c})),s.d(t,"f",(function(){return d})),s.d(t,"o",(function(){return u})),s.d(t,"m",(function(){return p})),s.d(t,"p",(function(){return h})),s.d(t,"n",(function(){return _})),s.d(t,"d",(function(){return v})),s.d(t,"i",(function(){return k})),s.d(t,"b",(function(){return y})),s.d(t,"a",(function(){return g})),s.d(t,"e",(function(){return T})),s.d(t,"t",(function(){return j})),s.d(t,"q",(function(){return O})),s.d(t,"r",(function(){return w})),s.d(t,"s",(function(){return x})),s.d(t,"v",(function(){return b})),s.d(t,"u",(function(){return f}));var a=s("dde5");const i=e=>Object(a["c"])("api/workbench","reportEvent",e),r=e=>Object(a["c"])("api/workbench","reportHeartbeat",e),l=e=>Object(a["c"])("api/workbench","pauseOrResumeTask",e),n=e=>Object(a["c"])("api/workbench","getTask",e),o=e=>Object(a["c"])("api/workbench","listMyReLabelDetail",e),c=e=>Object(a["c"])("api/workbench","listMyLabelDetailLog",e),d=e=>Object(a["c"])("api/workbench","listMyDetail",e),u=e=>Object(a["c"])("api/workbench","skipLabel",e),p=e=>Object(a["c"])("api/workbench","returnLabel",e),m=e=>Object(a["c"])("api/workbench","queueReReview",e),h=e=>Object(a["c"])("api/workbench","skipReview",e),_=e=>Object(a["c"])("api/workbench","returnReview",e),f=e=>Object(a["c"])("api/workbench","listMyOngoingDetails",e),v=e=>Object(a["c"])("api/workbench","listCheckDetail",e),b=e=>Object(a["c"])("api/workbench","listPackDetail",e),k=e=>Object(a["c"])("api/workbench","listMyReviewDetailLog",e),y=e=>Object(a["c"])("api/workbench","deliverBidTask",e),g=e=>Object(a["c"])("api/workbench","checkTaskUserCondition",e),T=e=>Object(a["c"])("api","listLabelVersion",e),j=e=>Object(a["c"])("api/workbench","switchAutoAdd",e),O=e=>Object(a["c"])("api/report","statCheckTask",e),w=e=>Object(a["c"])("api/report","statMyCheckTask",e),x=e=>Object(a["c"])("api/report","statWorkbenchTaskProgress",e)},c54b:function(e,t,s){"use strict";s.d(t,"c",(function(){return m})),s.d(t,"b",(function(){return f})),s.d(t,"a",(function(){return b}));s("28eb");var a=s("534e"),i=s.n(a),r=s("4f2b"),l=s("6df9"),n=s("f558"),o=s("30ac"),c=s("db49"),d=s("9ec3");const u=async(e,t)=>{const s=await Object(o["d"])({import_task_id:e.toString(),path:t}),{token:a,start_time:i,expired_time:r,upload_path:l}=s;return{Key:l,authorizationToken:(e,t)=>{t({TmpSecretId:a.secret_id,TmpSecretKey:a.secret_key,SecurityToken:a.session_token,StartTime:i,ExpiredTime:r})}}},p=async(e,t,s,a)=>{const r=Object(d["template"])(c["a"].COS_DOMAIN);return new i.a({getAuthorization:null!==s&&void 0!==s?s:a,ChunkSize:5242880,ProgressInterval:500,UploadCheckContentMd5:!0,Domain:r({Bucket:e,Region:t})})},m=async({id:e,type:t,Bucket:s,Region:a,Key:i,file:r,handleTaskReady:n,authorization:o})=>{const{authorizationToken:c,Key:d}=await u(e,i),m=await p(s,a,o,c);return m.on("list-update",s=>{l["a"].dispatch("setUploadQueue",{id:e,data:{...s.list[0],cos:m}});const[{state:a}]=s.list;"success"===a&&h({id:e,type:t})}),m.sliceUploadFile({Bucket:s,Region:a,Key:null!==d&&void 0!==d?d:i,Body:r,onTaskReady(e){n&&n(m,e)}},(e,t)=>{console.log(e||t)}),m},h=({id:e,type:t})=>{let s;const a={};"questions"===t&&(s=o["c"],a.dataset_import_id=e),"datasets"===t&&(s=n["b"],a.dataset_import_id=e),"attachment"===t&&(s=n["a"],a.attach_id=e),s&&(l["a"].dispatch("setUploadQueue",{id:e,data:{state:"queuing"}}),s(a).then(()=>{l["a"].dispatch("setUploadQueue",{id:e,data:{state:"queue-end"}})}).catch(t=>{r["default"].prototype.$Message.error(t.message),l["a"].dispatch("setUploadQueue",{id:e,data:{state:"queue-error"}})}))},_=(e,t,s)=>{const a=[],i={Bucket:t.Bucket,Region:t.Region,Key:t.Key,UploadId:t.UploadId},r=function(){e.multipartListPart(i,(e,t)=>{if(e)return s(e);a.push(t.Part||[]),"true"===t.IsTruncated?(i.PartNumberMarker=t.NextPartNumberMarker,r()):s(null,{PartList:a})})};r()},f=async({id:e,Bucket:t,Region:s,Prefix:a,authorization:i})=>{const{authorizationToken:r,Key:n}=await u(e),o=await p(t,s,i,r);return o.multipartList({Bucket:t,Region:s,Prefix:null!==n&&void 0!==n?n:a},(c,d)=>{if(c)throw c;const{Upload:u}=d;if(u&&u.length>0){const[{Key:a,UploadId:i}]=u;_(o,{Bucket:t,Region:s,Key:null!==n&&void 0!==n?n:a,UploadId:i},(t,s)=>{const{PartList:a}=s;let i=0;a.forEach(e=>{const t=e.reduce((e,t)=>e+Number(t.Size),0);i+=t}),l["a"].dispatch("setUploadQueue",{id:e,data:{state:"unCompleted",loaded:i}})})}else v({Bucket:t,Region:s,Key:null!==n&&void 0!==n?n:a,authorization:null!==r&&void 0!==r?r:i,id:e,callback:({size:t,state:s})=>{l["a"].dispatch("setUploadQueue",{id:e,data:{state:s,size:t}})}})}),o},v=async({Bucket:e,Region:t,Key:s,callback:a,authorization:i})=>{const r=await p(e,t,i);return r.getObject({Bucket:e,Region:t,Key:s,Range:"bytes=0-1"},(e,t)=>{if(console.log(e,t),e&&404===e.statusCode&&"NoSuchKey"===e.code)a&&a({state:"notStart",size:0});else{const{headers:e}=t;a&&a({state:"queue-error",size:e["content-range"].split("/")[1]})}}),r},b=({id:e,type:t,bucket:s,region:a,prefix:i,scene:l,fileName:n,fileSize:o,Key:c})=>{const d=document.createElement("input");d.type="file",d.style="width:0;height:0;border:0;margin:0;padding:0;",d.onchange=function(){const{files:u}=this;if(!u.length)return r["default"].prototype.$Message.error("文件不能为空"),!1;const[p]=u;if(p.name!==n||p.size!==o)return r["default"].prototype.$Message.error("请选择相同文件继续上传"),!1;const h={id:e,type:t,Bucket:s,Region:a,Key:c||`${i}/${e}${l?"/"+l:""}/${n}`,file:p};m(h),document.body.removeChild(d)},document.body.appendChild(d),d.click()}},c899:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"e",(function(){return i})),s.d(t,"d",(function(){return r})),s.d(t,"b",(function(){return l})),s.d(t,"c",(function(){return n}));const a={LimitPageError:-30001},i={label:"QUEUE_LABEL",review:"QUEUE_REVIEW",review_again:"VIEW_REVIEW",relabel:"QUEUE_RELABEL",re_review:"QUEUE_RE_REVIEW",label_again:"EDITING_LABEL"},r=Object.fromEntries(Object.entries(i).map(([e,t])=>[t,e])),l={QUEUE_LABEL:"标注",QUEUE_REVIEW:"质检",EDITING_LABEL:"修改标注",VIEW_REVIEW:"修改质检",QUEUE_RELABEL:"返修",QUEUE_RE_REVIEW:"复检"},n={paused:"已暂停",labeling:"进行中"}},cab9:function(e,t,s){"use strict";s("2537")},cb78:function(e,t,s){"use strict";var a=s("dde5");class i extends a["b"]{ListImportTaskProcess(e){return this.post({method:"listImportTaskProcess",url:"api/datahouse",params:e})}CheckDownloadStatus(e){return this.post({method:"checkDownloadStatus",url:"api/task",params:e})}GetTaskList(e){return this.post({method:"listTasks",url:"api/task",params:e})}GetTask(e){return this.post({method:"getTask",url:"api/task",params:e})}UpdateTask(e){return this.post({method:"updateTask",url:"api/task",params:e})}DeleteTask(e){return this.post({method:"deleteTask",url:"api/task",params:e})}CheckUpdateTaskTemplate(e){return this.post({method:"checkUpdateTaskTemplate",url:"api/task",params:e})}PublishTask(e){return this.post({method:"publishTask",url:"api/task",params:e})}EvaluateTask(e){return this.post({method:"evaluateTask",url:"api/task",params:e})}ReceiveTask(e){return this.post({method:"receiveTask",url:"api/task",params:e})}GetTaskFlowLogs(e){return this.post({method:"listTaskFlowLogs",url:"api",params:e})}ListFlowLogs(e){return this.post({method:"listFlowLogs",url:"api",params:e})}GetTaskDetailList(e){return this.post({method:"listDetail",url:"api",params:e})}ApproveTaskDetail(e){return this.post({method:"submitDeliverCheckReview",url:"api/deliver",params:e})}UploadDetail(e){return this.post({method:"uploadDetail",url:"api/dataset",params:e})}GetDatasetLogs(e){return this.post({method:"listDataTasks",url:"api/dataset",params:e})}createTemplate(e){return this.post({method:"createTemplate",url:"api/template",params:e})}createProjectTemplate(e){return this.post({method:"createProjectTemplate",url:"api/template",params:e})}updateTemplate(e){return this.post({method:"updateTemplate",url:"api/template",params:e})}getTemplateDescribe(e){return this.post({method:"getTemplate",url:"api/template",params:e})}shareObject(e){return this.post({method:"shareObject",url:"api/objectperm",params:e})}shareObjectList(e){return this.post({method:"listShareObjects",url:"api/objectperm",params:e})}deleteShareUsers(e){return this.post({method:"deleteShareObject",url:"api/objectperm",params:e})}deleteTaskSourceData(e){return this.post({method:"deleteTaskSourceData",url:"api/task",params:e})}listLabelGroupTasks(e){return this.post({method:"listLabelGroupTasks",url:"api/task",params:e})}listTaskLabelers(e){return this.post({method:"listTaskLabelers",url:"api",params:e})}}const r=new i;t["a"]=r},d319:function(e,t,s){},d7e1:function(e,t,s){},da2a:function(e,t,s){"use strict";s("5c7d")},db98:function(e,t,s){"use strict";function a(e,t,s){let a,i=e;const r=s||["B","KB","MB","GB","TB"];while((a=r.shift())&&i>1024)i/=1024;return("B"===a?i:i.toFixed(void 0===t?2:t))+a}s("ede2"),t["a"]={props:["uploadInfo","fileSize"],render(e){const{state:t,hashPercent:s,percent:i,size:r,loaded:l}=this.uploadInfo,{fileSize:n}=this;if(t)switch(t){case"waiting":return e("span",["(等待上传)",e("Spin",{class:["upload-loading"]},[e("Icon",{class:["demo-spin-icon-load"],props:{type:"ios-loading",size:"18"}})])]);case"checking":return e("span",[`(校验中: ${(100*s).toFixed(2)}%)`,e("Spin",{class:["upload-loading"]},[e("Icon",{class:["demo-spin-icon-load"],props:{type:"ios-loading",size:"18"}})])]);case"uploading":return e("span",[`(上传中: ${(100*i).toFixed(2)}%)`,e("Spin",{class:["upload-loading"]},[e("Icon",{class:["demo-spin-icon-load"],props:{type:"ios-loading",size:"18"}})])]);case"paused":return e("span",`(已暂停: ${(100*i).toFixed(2)}%)`);case"error":return e("span",{style:{color:"#ed4014"}},`(上传失败: ${(100*i).toFixed(2)}%)`);case"success":return e("span",a(100*r,2));case"notStart":return e("span",{style:{color:"#ed4014"}},"(上传失败: 0%)");case"unCompleted":return e("span",`(${a(l)}/${a(n)})`);case"queuing":return e("span",["(排队中)",e("Spin",{class:["upload-loading"]},[e("Icon",{class:["demo-spin-icon-load"],props:{type:"ios-loading",size:"18"}})])]);case"queue-end":return e("span",{style:{color:"#52c41a"}},"(上传完成)");case"queue-error":return e("span",{style:{color:"#ed4014"}},"(排队中断)")}}}},dda7:function(e,t,s){"use strict";s("fb88")},e352:function(e,t,s){"use strict";s("6787")},e864:function(e,t,s){"use strict";s("84ee")},e9fa:function(e,t,s){"use strict";s("8d0d");t["a"]={computed:{isWorkbench(){var e;return null===(e=this.$route.name)||void 0===e?void 0:e.includes("wb")},isLabel(){return this.isWorkbench&&!this.isAudit},isAudit(){var e;return null===(e=this.$route.name)||void 0===e?void 0:e.includes("audit")}}}},ed18:function(e,t,s){},ede2:function(e,t,s){},f227:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Select",{attrs:{filterable:"",clearable:"",transfer:"",placeholder:e.placeholder,multiple:e.multiple,loading:e.fetchUserOptions.isPending,"remote-method":e.debounce},on:{"on-change":e.updateUser,"on-clear":function(t){return e.updateUser("")}},model:{value:e.users,callback:function(t){e.users=t},expression:"users"}},[this.userInfo?s("OptionGroup",{attrs:{label:"当前登录人"}},[s("Option",{key:this.userInfo.user.user_id,attrs:{value:e.userInfo.user[e.optionValue],label:e.multiple?e.userInfo.user.nick_name+e.userInfo.user.email:e.userInfo.user.nick_name,tag:e.userInfo.user.nick_name}},[s("p",[e._v(e._s(e.userInfo.user.nick_name))]),e.showEmail?s("p",{staticClass:"txt-muted"},[e._v(e._s(e.userInfo.user.email||"无邮箱"))]):e._e()])],1):e._e(),s("OptionGroup",{attrs:{label:"搜索"}},e._l(e.userOptions,(function(t){return s("Option",{key:t.user_id,attrs:{value:t[e.optionValue],label:e.multiple?t.nick_name+t.email:t.nick_name,tag:t.nick_name}},[s("p",[e._v(e._s(t.nick_name))]),e.showEmail?s("p",{staticClass:"txt-muted"},[e._v(e._s(t.email||"无邮箱"))]):e._e()])})),1)],1)],1)},i=[],r=s("9ec3"),l=s("e3fa"),n={props:{optionValue:{type:String,default:"user_id"},multiple:{type:[Boolean,String],default:!1},remote:{type:[Boolean,String],default:!1},showEmail:{type:[Boolean,String],default:!1},defaultUser:{type:Boolean,default:!1},placeholder:{type:String,default:"请输入关键字以搜索相关用户"}},data(){return{users:""}},computed:{queryParams(){return function(e){const t={page:{start:0,size:100,return_total:0},query:e};return t}},userInfo(){var e,t;return null===this||void 0===this||null===(e=this.$store)||void 0===e||null===(t=e.state)||void 0===t?void 0:t.userinfo}},mounted(){!this.remote&&this.fetchUserOptions()},methods:{debounce:Object(r["debounce"])((function(e){this.fetchUserOptions(e)}),500),updateUser(e){e!==this.user&&(this.users=e||"",this.$emit("update:user",this.users))}},asyncMethods:{fetchUserOptions(e){if(""!==e)return Object(l["t"])(this.queryParams(e)).then(e=>null===e||void 0===e?void 0:e.data.filter(e=>{var t,s;return e.user_id!==(null===(t=this.userInfo)||void 0===t||null===(s=t.user)||void 0===s?void 0:s.user_id)}))}}},o=n,c=s("2be6"),d=Object(c["a"])(o,a,i,!1,null,null,null);t["a"]=d.exports},f294:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.$route.query.deliver_id?[s("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("div",[s("span",{staticClass:"txt-muted"},[e._v("交付批次：")]),s("Select",{ref:"select",staticClass:"mrm",staticStyle:{width:"300px",position:"absolute"},attrs:{transfer:""},on:{"on-change":e.changeDeliver},model:{value:e.deliver.deliver_id,callback:function(t){e.$set(e.deliver,"deliver_id",t)},expression:"deliver.deliver_id"}},e._l(e.delivers,(function(t){return s("Option",{key:t.deliver_id.toString(),attrs:{value:t.deliver_id.toString()}},[e._v(e._s(t.deliver_name))])})),1),s("Input",{staticClass:"deliver-pointer mrm",staticStyle:{width:"300px"},attrs:{icon:"ios-swap",readonly:""},nativeOn:{click:function(t){return e.$refs.select.toggleMenu()}},model:{value:e.deliver.deliver_name,callback:function(t){e.$set(e.deliver,"deliver_name",t)},expression:"deliver.deliver_name"}}),s("span",{staticClass:"mlm mrm txt-muted"},[e._v("批次状态："),s("batchStatusRender",{attrs:{value:e.deliver.status}})],1),s("span",{staticClass:"mlm mrm txt-muted"},[e._v("批次数量："+e._s(e.deliver.deliver_num||"-"))])],1),s("div",[s("Button",{staticClass:"mlm",attrs:{icon:"ios-undo"},on:{click:e.goBack}},[e._v("返回批次列表")]),e.isLabel&&e.isTaskWorking&&10===e.deliver.status&&e.relation?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"submit",extra:{team:e.task.team_id,company:e.userinfo.company_id}},expression:"{domain: 'task', action: 'submit', extra: {team: task.team_id, company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mlm",attrs:{type:"primary",ghost:""},on:{click:e.submitDeliver}},[e._v("批次交付")])],1)]:e._e(),e.isAudit&&e.isTaskWorking&&20===e.deliver.status?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"submit",extra:{team:e.task.audit_team_id,company:e.userinfo.company_id}},expression:"{domain: 'task', action: 'submit', extra: {team: task.audit_team_id, company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mlm",attrs:{type:"primary",ghost:""},on:{click:e.submitDeliver}},[e._v("审核提交")])],1)]:e._e(),e.isWorkbench?e._e():[20===e.deliver.status?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"edit",extra:{project:e.task.project_id,company:e.userinfo.company_id}},expression:"{domain: 'project', action: 'edit', extra: {project: task.project_id, company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mlm",attrs:{type:"primary",ghost:""},on:{click:e.submitDeliver}},[e._v("审核提交")])],1),s("Tooltip",{attrs:{content:"试标任务不支持驳回，如需供应商重新交付，请重新下发试标任务",placement:"top",trigger:"hover","max-width":300,disabled:1!==e.task.task_type}},[s("Button",{staticClass:"mlm",attrs:{type:"error",ghost:"",icon:"md-close",disabled:1===e.task.task_type},on:{click:function(t){return e.approveDeliver("reject")}}},[e._v("验收驳回")])],1)]:e._e(),e.isTaskWorking&&30===e.deliver.status?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"edit",extra:{company:e.companyInfo.company_id,project:e.task.project_id}},expression:"{domain: 'project', action: 'edit', extra: {company: companyInfo.company_id, project: task.project_id}}"}]},[e.task.audit_supplier_id&&-1!==e.task.audit_supplier_id?s("Button",{staticClass:"mlm",attrs:{type:"primary",ghost:""},on:{click:function(t){return e.approveDeliver("audit")}}},[e._v("重新审核")]):e._e(),s("Button",{staticClass:"mlm",attrs:{type:"success",ghost:"",icon:"md-checkmark-circle-outline"},on:{click:function(t){return e.approveDeliver("pass")}}},[e._v("验收通过")]),s("Tooltip",{attrs:{content:"试标任务不支持驳回，如需供应商重新交付，请重新下发试标任务",placement:"top",trigger:"hover","max-width":300,disabled:1!==e.task.task_type}},[s("Button",{staticClass:"mlm",attrs:{type:"error",ghost:"",icon:"md-close",disabled:1===e.task.task_type},on:{click:function(t){return e.approveDeliver("reject")}}},[e._v("验收驳回")])],1)],1)]:e._e(),e.isTaskWorking&&60===e.deliver.status?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"edit",extra:{company:e.companyInfo.company_id,project:e.task.project_id}},expression:"{domain: 'project', action: 'edit', extra: {company: companyInfo.company_id, project: task.project_id}}"}]},[s("Button",{staticClass:"mlm",attrs:{type:"primary",ghost:"",disabled:e.disableDeliverAgain},on:{click:function(t){return e.approveDeliver("deliver")}}},[e._v("重新验收")]),e.relation.allow_label_group?s("Button",{staticClass:"mlm",attrs:{disabled:e.deliver.job_dataset_relation&&!!e.deliver.job_dataset_relation.job_dataset_relation_id,type:"primary",ghost:""},on:{click:function(t){return e.linkLabelGroupTask()}}},[e._v(e._s(e.deliver.job_dataset_relation&&e.deliver.job_dataset_relation.job_dataset_relation_id?"已导入后置任务":"导入后置任务"))]):e._e()],1)]:e._e(),[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"export",extra:{company:e.companyInfo.company_id,project:e.task.project_id}},expression:"{domain: 'project', action: 'export', extra: {company: companyInfo.company_id, project: task.project_id}}"}]},[s("Dropdown",{staticStyle:{"margin-right":"40px","margin-left":"12px"},scopedSlots:e._u([{key:"list",fn:function(){return[s("DropdownMenu",[s("DropdownItem",[s("div",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"export",extra:{company:e.companyInfo.company_id,project:e.task.project_id}},expression:"{domain: 'project', action: 'export', extra: {company: companyInfo.company_id, project: task.project_id}}"}],staticClass:"mrm",attrs:{type:"primary"},on:{click:e.downloadAllTask}},[s("Icon",{staticStyle:{"margin-right":"4px"},attrs:{type:"md-download"}}),e._v("导出全部题目")],1)]),s("DropdownItem",[s("div",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"export",extra:{company:e.companyInfo.company_id,project:e.task.project_id}},expression:"{domain: 'project', action: 'export', extra: {company: companyInfo.company_id, project: task.project_id}}"}],staticClass:"mrm",attrs:{type:"primary"},on:{click:e.exportTaskResult}},[s("Icon",{staticStyle:{"margin-right":"4px"},attrs:{type:"md-download"}}),e._v("标注结果统计")],1)]),70===e.deliver.status&&e.businessKey?s("DropdownItem",[s("div",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"export"},expression:"{domain: 'project', action: 'export'}"}],staticClass:"mrm",attrs:{type:"primary"},on:{click:e.exportErrorReason}},[s("Icon",{staticStyle:{"margin-right":"4px"},attrs:{type:"md-download"}}),e._v("出错原因统计")],1)]):e._e()],1)]},proxy:!0}],null,!1,2642595568)},[s("Button",{attrs:{icon:"md-download",type:"primary"}},[e._v("导出")])],1)],1)]]],2)]),e.deliver.deliver_id?s("Deliver",{ref:"deliver",attrs:{task:Object.assign({},e.task,{template:e.taskTemplate}),relation:e.relation},on:{disableDeliverAgain:function(t){e.disableDeliverAgain=t}}}):e._e()]:[e.isLabel&&e.isTaskWorking&&e.fetchStatTask?s("Alert",{attrs:{"show-icon":""}},[-1===e.autoAddDeliver?[s("Icon",{attrs:{slot:"icon",type:"ios-information-circle"},slot:"icon"}),s("Row",{attrs:{type:"flex",justify:"space-between"}},[s("span",[e._v("当前有 "+e._s(e.totalCount)+" 个已标注数据可添加到批次")]),s("div",[s("auth-view",{attrs:{perm:{domain:"task",action:"submit",extra:{team:e.task.team_id,company:e.userinfo.company_id}}}},[s("a",{staticClass:"mlb",on:{click:function(t){return e.addDataToDeliver("auto")}}},[e._v("自动添加")]),s("a",{staticClass:"mlb",on:{click:function(t){return e.addDataToDeliver("manual")}}},[e._v("手动添加")])])],1)])]:[s("Icon",{staticClass:"loading",attrs:{slot:"icon",type:"ios-loading"},slot:"icon"}),s("Row",{attrs:{type:"flex",justify:"space-between"}},[s("span",[e._v("当前已设置自动添加，已标注数据将自动添加到指定的批次（验收驳回数据需手动操作添加或批量打回返修）")]),s("div",[s("auth-view",{attrs:{perm:{domain:"task",action:"submit",extra:{team:e.task.team_id,company:e.userinfo.company_id}}}},[s("a",{staticClass:"mlb",on:{click:e.fetchDelivers}},[e._v("刷新")]),s("a",{staticClass:"mlb",on:{click:function(t){return e.setAutoAddData(!1)}}},[e._v("取消自动添加")])])],1)])]],2):e._e(),s("Row",{staticClass:"mbm",attrs:{type:"flex",justify:"space-between",align:"middle"}},[e.isSelect?[e.isWorkbench?s("div",[s("Button",{staticClass:"mrm",attrs:{type:"primary",ghost:"",icon:"md-build"},on:{click:function(t){e.isSelect=!1,e.isSelectAll=!1}}},[e._v("退出批量操作")]),s("Tooltip",{attrs:{content:"请勾选至少 2 个批次",disabled:e.isSelectAll&&e.page.total>=2||e.selection.length>=2}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",disabled:!e.isSelectAll&&e.selection.length<2||e.isSelectAll&&e.page.total<2},on:{click:function(t){return e.mergeDeliver(10)}}},[e._v("批次合并")])],1)],1):s("div",[s("Button",{staticClass:"mrm",attrs:{type:"primary",ghost:"",icon:"md-build"},on:{click:function(t){e.isSelect=!1,e.isSelectAll=!1}}},[e._v("退出批量操作")]),s("Button",{staticClass:"mrm",attrs:{type:"success",ghost:"",disabled:!e.isSelectAll&&e.selection.length<1},on:{click:function(t){return e.approveDeliver("pass",e.selection)}}},[e._v("验收通过")]),s("Tooltip",{attrs:{content:"试标任务不支持驳回，如需供应商重新交付，请重新下发试标任务",placement:"top",trigger:"hover","max-width":300,disabled:1!==e.task.task_type}},[s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:"",disabled:1===e.task.task_type||!e.isSelectAll&&e.selection.length<1},on:{click:function(t){return e.approveDeliver("reject",e.selection)}}},[e._v("验收驳回")])],1),s("auth-view",{attrs:{perm:{domain:"project",action:"edit",extra:{company:e.companyInfo.company_id,project:e.task.project_id}}}},[s("Tooltip",{attrs:{content:"请勾选至少 2 个批次",disabled:e.isSelectAll&&e.page.total>=2||e.selection.length>=2}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",disabled:!e.isSelectAll&&e.selection.length<2||e.isSelectAll&&e.page.total<2},on:{click:function(t){return e.mergeDeliver(30)}}},[e._v("批次合并")])],1)],1)],1),e.isSelectAll?s("div",[s("span",[e._v("已选中全部 "+e._s(e.page.total)+" 个批次，")]),s("a",{on:{click:function(t){return e.selectAll(!1)}}},[e._v("取消全选")])]):s("div",[s("span",[e._v("已选中 "+e._s(e.selection.length)+" 个批次，")]),s("a",{on:{click:function(t){return e.selectAll(!0)}}},[e._v("选中全部 "+e._s(e.page.total)+" 个批次")])])]:[e.isWorkbench?s("div",[e.isLabel?[s("Button",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"submit",extra:{team:e.task.team_id,company:e.userinfo.company_id}},expression:"{domain: 'task', action: 'submit', extra: {team: task.team_id, company: userinfo.company_id}}"}],staticClass:"mrm",attrs:{type:"primary",icon:"md-build"},on:{click:function(t){e.isSelect=!0}}},[e._v("批量操作批次")])]:e._e()],2):s("div",[s("Button",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"project",action:"edit",extra:{company:e.companyInfo.company_id,project:e.task.project_id}},expression:"{domain: 'project', action: 'edit', extra: {company: companyInfo.company_id, project: task.project_id}}"}],staticClass:"mrm",attrs:{type:"primary",icon:"md-build"},on:{click:function(t){e.isSelect=!0}}},[e._v("批量操作批次")])],1)]],2),s("Table",{ref:"delivers",attrs:{columns:e.columns,data:e.delivers,loading:e.fetchDelivers.isPending},on:{"on-selection-change":function(t){return e.selectDeliver(t,!0)},"on-select-cancel":function(t){e.isSelectAll=!1},"on-select-all-cancel":function(t){e.isSelectAll=!1}},scopedSlots:e._u([{key:"deliver_id",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_id))])]}},{key:"deliver_name",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_name))])]}},{key:"deliver_num",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_num))])]}},{key:"status",fn:function(t){var a=t.row;return[s("batchStatusRender",{attrs:{value:a.status}}),a.deliver_id.toString()===e.autoAddDeliver.toString()?s("Tag",[e._v("自动添加")]):e._e()]}},{key:"checked_num",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.checked_num||0))])]}},{key:"checked_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.checked_percent+"%"))])]}},{key:"first_pass_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.first_pass_percent+"%"))])]}},{key:"pass_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.deliver_task_stat.pass_percent+"%"))])]}},{key:"action",fn:function(t){var a=t.row;return[s("Row",[s("Col",[s("a",{on:{click:function(t){return e.goDeliver(a)}}},[e._v("详情")])]),s("Col",[e.isDeleteEnabled(a)?[s("auth-view",{attrs:{perm:{domain:"task",action:"submit",extra:{team:e.task.team_id,company:e.userinfo.company_id}}}},[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){return e.deleteDeliver(a)}}},[e._v("删除")]),a.deliver_num>0?[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){return e.splitDeliver(a)}}},[e._v("拆分")])]:e._e()],2)]:e._e()],2),s("Col",[70===a.status&&e.isWorkbench?[s("auth-view",{attrs:{perm:{domain:"task",action:"submit",extra:{team:e.task.team_id,company:e.userinfo.company_id}}}},[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(t){return e.handleCopyNewBatch(a)}}},[e._v("复制新批次")])],1)]:e._e()],2)],1)]}}],null,!1,1854110378)}),s("Row",{staticClass:"mtm",attrs:{type:"flex",justify:"space-between"}},[s("div",[e.isSelect?s("div",{staticClass:"mls"},[e.isWorkbench?s("span",[e._v("注：目前仅支持合并 待交付 的批次。")]):s("span",[e._v("注：目前仅支持操作 待验收 的批次。")])]):e._e()]),s("Page",{attrs:{current:e.page.index,total:e.page.total,"page-size":e.page.size,"show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)]],2)},i=[],r=(s("8d0d"),s("9ec3")),l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.fetchDeliver.isResolved?s("div",{staticClass:"padding"},[e.showDeadlineAutoDeliver?s("Alert",{staticClass:"mbb",attrs:{"show-icon":""}},[s("span",[e._v("验收有效期 "+e._s(e.deliverTask.deadline_day)+" 天，逾期则系统将在")]),s("span",{staticClass:"txt-blue"},[e._v(" "+e._s(e.moment(e.deliverTask.deadline_date).format("YYYY-MM-DD HH:mm:ss"))+" ")]),s("span",[e._v("自动“验收通过”，届时将无法驳回。为避免影响您的数据质量，请尽快验收。")])]):e._e(),s("Tabs",{attrs:{type:"card",name:"deliver",animated:!1},on:{"on-click":e.changeTab},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("TabPane",{attrs:{label:"题目详情",name:"detail",tab:"deliver"}},["detail"===e.tab?s("Detail",{attrs:{task:e.task,relation:e.relation,deliver:e.deliver}}):e._e()],1),s("TabPane",{attrs:{label:"抽检记录",name:"check-task",tab:"deliver"}},["check-task"===e.tab?s("CheckTask",{attrs:{task:e.task,relation:e.relation,deliver:e.deliver}}):e._e()],1),s("TabPane",{attrs:{label:"质检统计",name:"check",tab:"deliver"}},["check"===e.tab?s("Check",{attrs:{task:e.task,relation:e.relation,deliver:e.deliver}}):e._e()],1),s("TabPane",{attrs:{label:"日志",name:"log",tab:"deliver"}},["log"===e.tab?s("Log",{attrs:{task:e.task,deliver:e.deliver}}):e._e()],1)],1)],1):e._e()])},n=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("tableFilter",{attrs:{searchLoading:e.fetchDetails.isPending},on:{search:function(t){return e.fetchDetails(e.page.index=1)},reset:function(t){return e.reset(e.page.index=1)}}},[s("Form",{attrs:{inline:"","label-position":"left","label-width":60,"label-colon":!0}},[s("Row",{attrs:{gutter:30}},[s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"任务明细ID","label-width":90}},[s("Input",{attrs:{type:"text",placeholder:"输入任务明细ID进行搜索"},model:{value:e.form.detail_id,callback:function(t){e.$set(e.form,"detail_id",t)},expression:"form.detail_id"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"题目ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入题目ID进行搜索"},model:{value:e.form.dataset_item_id,callback:function(t){e.$set(e.form,"dataset_item_id",t)},expression:"form.dataset_item_id"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"题包Key","label-width":80}},[s("Input",{attrs:{type:"text",placeholder:"输入题包Key进行搜索"},model:{value:e.form.pack_key,callback:function(t){e.$set(e.form,"pack_key",t)},expression:"form.pack_key"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"标注员"}},[s("Select",{attrs:{"remote-method":e.debounceTaskLabelers,loading:e.fetchTaskLabelers.isPending,transfer:"",filterable:"",clearable:"",placeholder:"请输入关键字以搜索相关用户"},model:{value:e.form.labeler,callback:function(t){e.$set(e.form,"labeler",t)},expression:"form.labeler"}},[e._l(e.taskLabelers,(function(t){return t.user_id&&t.nick_name&&t.email?[s("Option",{key:t.user_id,attrs:{value:t.user_id,label:t.nick_name,tag:t.nick_name}},[s("p",[e._v(e._s(t.nick_name))])])]:e._e()}))],2)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"* 质检环节",prop:"cycle_step","label-width":90}},[s("Select",{attrs:{transfer:""},on:{"on-change":function(t){return e.fetchDetails(e.page.index=1)}},model:{value:e.form.cycle_step,callback:function(t){e.$set(e.form,"cycle_step",t)},expression:"form.cycle_step"}},e._l(e.cycleOptions,(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"质检员"}},[s("user-select",{ref:"userSelect",attrs:{remote:"",showEmail:""},on:{"update:user":function(t){e.form.reviewer=t}}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"质检结果","label-width":80}},[s("Select",{attrs:{transfer:""},model:{value:e.form.check_status,callback:function(t){e.$set(e.form,"check_status",t)},expression:"form.check_status"}},[e._l(e.deliverCheckStatus,(function(t,a){return[t.value>0?s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.text))]):e._e()]}))],2)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"是否有效","label-width":80}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:e.form.is_valid,callback:function(t){e.$set(e.form,"is_valid",t)},expression:"form.is_valid"}},[s("Option",{attrs:{value:1}},[e._v("有效")]),s("Option",{attrs:{value:0}},[e._v("无效")])],1)],1)],1)],1)],1)],1),s("Row",{staticClass:"mbm",attrs:{type:"flex",align:"middle",justify:"space-between"}},[e.isWorkbench&&[10,70].includes(e.deliver.status)?[s("div",{staticClass:"left"},[s("Button",{staticClass:"mrm",attrs:{type:"primary",icon:"md-build",ghost:e.isSelect},on:{click:function(t){e.isSelect=!e.isSelect}}},[s("span",[e._v(e._s(e.isSelect?"退出批量操作":"批量操作题目"))])]),e.isSelect?[s("Tooltip",{attrs:{content:"打回到待标注，无处理人",placement:"top",transfer:""}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",disabled:""},on:{click:function(t){return e.updateDetail(10)}}},[e._v("清空标注")])],1),s("Tooltip",{attrs:{content:"自动添加一个抽检任务，数据默认质检不通过",placement:"top","max-width":180,transfer:""}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",disabled:e.selection.length<=0},on:{click:function(t){return e.updateDetail(15)}}},[e._v("打回返修")])],1)]:e._e()],2),s("div",{staticClass:"right"},[e.isSelect?[e.isSelectAll?s("span",[e._v("已选中全部 "+e._s(e.page.total)+" 条数据，"),s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.selectDetailAll(!1)}}},[e._v("取消全选")])]):s("span",[e._v("已选中 "+e._s(e.selection.length)+" 条数据，"),s("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.selectDetailAll(!0)}}},[e._v("选中全部 "+e._s(e.page.total)+" 条数据")])])]:[[70].includes(e.deliver.status)?s("span",{staticClass:"txt-muted"},[e._v("已失效批次，数据仅为快照")]):e._e()]],2)]:e._e(),e.isWorkbench||70===e.deliver.status?e._e():[s("auth-view",{attrs:{perm:{domain:"project",action:"export",extra:{company:e.companyInfo.company_id,project:e.task.project_id}}}},[s("Tooltip",{attrs:{content:"任务数据已删除",placement:"top-start",disabled:!e.isDeleteSource}},[s("Button",{staticClass:"mbm mrm",attrs:{type:"primary",icon:"md-cloud-download",disabled:0===e.page.total||e.isDeleteSource},on:{click:function(t){return e.downloadDeliver(e.deliver)}}},[e.isSearching?s("span",[e._v("导出筛选的题目")]):s("span",[e._v("导出所有题目")])])],1)],1)]],2),s("Table",{ref:"details",attrs:{columns:e.columns,data:e.details,loading:e.fetchDetails.isPending},on:{"on-selection-change":e.selectDetail},scopedSlots:e._u([{key:"detail_id",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.detail_id))])]}},{key:"dataset_item_id",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.dataset_item_id))])]}},{key:"pack_key",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.pack_key))])]}},{key:"detail_is_valid",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(1===a.detail_is_valid?"有效":"无效"))])]}},{key:"labeler_nick_name",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.labeler_nick_name||"-"))])]}},{key:"cycle_step",fn:function(t){t.row;return[s("span",[e._v(e._s(e.cycleOptions.find((function(t){return t.value===e.cycleStep})).label||"-"))])]}},{key:"reviewer_name",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.reviewer_name||"-"))])]}},{key:"check_status",fn:function(t){var a=t.row;return[a.check_status>0?s("deliverCheckStatusRender",{attrs:{value:a.check_status}}):s("span",[e._v("-")])]}},{key:"remark",fn:function(t){var a=t.row;return[s("Tooltip",{attrs:{placement:"right",disabled:!a.remark,transfer:""}},[s("div",{staticStyle:{"white-space":"normal","max-width":"300px"},attrs:{slot:"content"},slot:"content"},[s("span",[e._v(e._s(a.remark))])]),s("div",{staticClass:"ellipsis"},[e._v(e._s(a.remark||"-"))])])]}},{key:"action",fn:function(t){var a=t.row;return[s("a",{on:{click:function(t){return e.goDetail(a)}}},[e._v("详情")])]}}])}),s("Row",{staticClass:"mtm",attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("div",[e.isSelect?[s("Icon",{attrs:{type:"ios-alert",color:"#2D8CF0"}}),s("Poptip",{attrs:{trigger:"hover",placement:"right-end",transfer:""}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("p",[e._v("清空标注：暂不支持")]),[70].includes(e.deliver.status)?s("p",[e._v("打回返修：仅不在有效批次&&不在有效抽检任务的数据支持")]):e._e(),[10].includes(e.deliver.status)?s("p",[e._v("打回返修：不在有效抽检任务的数据支持")]):e._e()]),s("span",{staticClass:"mls"},[e._v("注：目前仅支持部分场景下的状态流转。")])])]:e._e()],2),s("Page",{attrs:{current:e.page.index,total:e.page.total,"page-size":e.page.size,"show-total":"","show-elevator":""},on:{"on-change":e.changePage}})],1)],1)},c=[],d=s("5ea9"),u=s("2339"),p=s("259f"),m=s("312d"),h=s("f227"),f=s("cb78"),v=s("a06e"),b=s("dde5"),k=s("e9fa"),y=s("c605"),g={components:{DetailUpdate:d["a"],deliverCheckStatusRender:p["a"],UserSelect:h["a"],tableFilter:y["a"]},mixins:[k["a"]],props:{task:Object,relation:Object,deliver:Object},data(){return{deliverCheckStatus:m["f"],form:{detail_id:"",dataset_item_id:"",pack_key:"",labeler:"",cycle_step:0,reviewer:"",check_status:"",is_valid:""},columnsOptions:{detail_id:"任务明细ID",dataset_item_id:"题目ID",pack_key:"题包Key",detail_is_valid:"是否有效",labeler_nick_name:"标注员",cycle_step:"质检环节",reviewer_name:"质检员",check_status:"质检结果",remark:"不通过原因",action:"操作"},details:[],page:{index:1,size:10,total:1},fetchOptions:{label:{path:"api/workbench",method:"listLabelDeliverDetails"},audit:{path:"api/workbench",method:"listAuditDeliverDetails"},receive:{path:"api/deliver",method:"listDeliverDetails"}},cycleStep:"",cycleOptions:[{label:"标注质检",value:"0",required:"isWorkbench"},{label:"审核质检",value:"2"},{label:"验收质检",value:"1"}],selection:[],isSelect:!1,isSelectAll:!1,isSearching:!1}},computed:{companyInfo(){return this.$store.state.companyinfo},columns(){return Object(r["map"])(this.columnsOptions,(e,t)=>{let s={title:e,slot:t};return t.includes("id")?s.width=180:s.minWidth=120,(t.includes("action")||t.includes("key"))&&(s.minWidth=150),t.includes("remark")&&(s.minWidth=150),t.includes("detail_is_valid")&&(s.width=100),t.includes("selection")&&(s={type:"selection",align:"center",width:60}),s})},isDeleteSource(){const{relation:e}=this;return 1===(null===e||void 0===e?void 0:e.is_delete_source)}},watch:{deliver(){this.fetchDetails()},isSelect(){this.isSelect?this.columnsOptions={selection:"",...this.columnsOptions}:(this.selection.length>0&&(this.selection=[],this.$refs.details.selectAll(!1)),this.$delete(this.columnsOptions,"selection"))},"form.reviewer"(e){var t;null===(t=this.$refs.userSelect)||void 0===t||t.updateUser(e)}},mounted(){this.reset()},methods:{debounceTaskLabelers:Object(r["debounce"])((function(e){this.fetchTaskLabelers(e)}),500),reset(){this.selection=[],this.isSelect=!1,this.isSearching=!1,Object(r["forIn"])(this.form,(e,t)=>{this.$set(this.form,t,"")}),this.isAudit?this.form.cycle_step="2":this.isLabel?this.form.cycle_step="0":this.isWorkbench||(this.form.cycle_step="1"),this.fetchDetails()},changePage(e){this.page.index=e,this.fetchDetails()},goDetail(e){const t=this.$router.resolve({name:"wb-task-review-detail",params:{task_id:this.task.task_id,check_id:e.check_id||0,pack_id:e.pack_key||0,dataset_id:0},query:{team_id:this.task.team_id,row_id:e.detail_id}});window.open(t.href,"_blank")},selectDetail(e){this.selection=e},selectDetailAll(e){this.isSelectAll=e,this.$refs.details.selectAll(e),e&&this.$Message.success(e?"已全选题目":"已取消全选")},updateDetail(e){const t=this,{task:s,deliver:a,selection:i,form:r,isSelectAll:l}=this;this.$FastModal.show(d["a"],{task:s,deliver:a,status:e,selection:i,form:r,isAll:l},{refresh(){t.reset()}})},async downloadDeliver(e){const{task:t}=this;let s="";const a={projectId:t.project_id,taskId:e.task_id,deliverId:e.deliver_id};this.form.detail_id&&(a.detailIds=this.form.detail_id),this.form.dataset_item_id&&(a.itemCodes=this.form.dataset_item_id),this.form.pack_key&&(a.pack_key=this.form.pack_key),this.form.labeler&&(a.lastLabelers=this.form.labeler),this.form.check_status&&(a.deliverCheckStatus=this.form.check_status),this.form.cycle_step&&(a.cycleStep=this.form.cycle_step),Object(r["forIn"])(a,(e,t)=>{t&&(s=s?`${s}&${t}=${e}`:`${t}=${e}`)});const i=await this.fetchProject(t.project_id);i&&this.$FastModal.show(u["a"],{title:e.deliver_name,obj:e,objType:"deliver",jqueryPre:s,projectId:t.project_id,project:i},{})}},asyncMethods:{fetchDetails(){const{deliver:e,form:t,page:s,isWorkbench:a,fetchOptions:i}=this,l={task_id:e.task_id,deliver_id:e.deliver_id,page:{start:(s.index-1)*s.size,size:s.size,return_total:1}};Object(r["forIn"])(t,(e,t)=>{switch("cycle_step"!==t&&e&&(this.isSearching=!0),t){case"labeler":case"reviewer":e&&e.length>0&&(l[t]=e);break;case"cycle_step":(e||0===e)&&(l[t]=Number(e),this.cycleStep=e);break;case"is_valid":(e||0===e)&&(l[t]=e);break;default:e&&(l[t]=e);break}});const n=a?this.isAudit?"audit":"label":"receive";return Object(b["c"])(i[n].path,i[n].method,l).then(e=>{const t=Object(r["map"])(e.data,e=>(e.check_id&&this.$set(e,"_disabled",!0),e));return this.page.total=e.total,t}).catch(e=>{console.log(e),this.$Message.error("列表数据获取失败，请刷新重试")})},fetchTaskLabelers(e){const t={page:{start:0,size:100,return_total:1},task_id:this.task.task_id};return e&&(this.task.project_type&&/^[\d]*$/.test(e)?t.user_id=e:t.nick_name=e),f["a"].listTaskLabelers(t).then(e=>e.data.result.data).catch(e=>{this.$Message.error(e.message)})},fetchProject(e){const t={project_id:e};return Object(v["i"])(t).then(e=>e)}}},T=g,j=(s("15cc"),s("2be6")),O=Object(j["a"])(T,o,c,!1,null,"5d7b4868",null),w=O.exports,x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.isWorkbench?e._e():s("Alert",{attrs:{"show-icon":""}},[s("Row",{attrs:{type:"flex",justify:"space-between"}},[s("span",[e._v("验收质检 已移至【标注工作台-质检任务】")]),s("div",[30===e.deliver.status?[e.relation.receive_team_id?[s("router-link",{attrs:{to:"/workbench/review-tasks/"+e.task.task_id+"/"+e.deliver.deliver_id,target:"_blank"}},[e._v("去质检")])]:[s("span",[e._v("尚未配置验收质检小组。")]),e.task.task_type?[s("auth-view",{attrs:{perm:{domain:"task",action:"edit-bid-task",extra:{company:e.task.company_id,project:e.task.project_id}}}},[s("a",{on:{click:e.goEditTask}},[e._v("去配置")]),s("span",{attrs:{slot:"forbidden"},slot:"forbidden"},[e._v("请联系公司负责人配置")])])]:[s("auth-view",{attrs:{perm:{domain:"task",action:"edit-formal-task",extra:{company:e.task.company_id,project:e.task.project_id}}}},[s("a",{on:{click:e.goEditTask}},[e._v("去配置")]),s("span",{attrs:{slot:"forbidden"},slot:"forbidden"},[e._v("请联系公司负责人配置")])])]]]:[s("span",{staticClass:"txt-muted"},[e._v("仅待验收的批次可质检")])]],2)])],1),s("Table",{attrs:{border:"",columns:e.columns,data:e.checks,loading:e.fetchChecks.isPending},scopedSlots:e._u([{key:"cycle_step_name",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.cycle_step_name||"-"))])]}},{key:"checked_num",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.checked_num||0))])]}},{key:"checked_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.checked_percent+"%"))])]}},{key:"first_pass_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.first_pass_percent+"%"))])]}},{key:"pass_percent",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.pass_percent+"%"))])]}}])})],1)},I=[],C={mixins:[k["a"]],props:{task:Object,relation:Object,deliver:Object},data(){return{columnsOptions:{cycle_step_name:"质检环节",checked_num:"已质检",checked_percent:"已质检占比",first_pass_percent:"抽检通过率",pass_percent:"校正后通过率"},checks:[],fetchOptions:{label:{path:"api/workbench",method:"statDeliverCheck"},receive:{path:"api/deliver",method:"statDeliverCheck"}}}},computed:{columns(){const{columnsOptions:e,getTemplateTagsStat:t}=this;t().forEach(t=>{const{reference:s,name:a,label:i}=t;s?e[`tags_stat_${s.name}_${a}`]=`${s.label}_${i}_抽检正确率`:e["tags_stat_"+a]=i+"_抽检正确率"});const s=(e,{column:t})=>e("div",[e("span",t.title),e("Tooltip",{props:{content:"任务模板标签启用“单独统计批次抽检正确率”时展示",maxWidth:200,transfer:!0,placement:"top",theme:"light"}},[e("Icon",{props:{type:"ios-help-circle-outline",size:16}})])]);return Object(r["map"])(e,(e,t)=>{const a={title:e,slot:t,minWidth:150};return t.includes("tags_stat")&&(delete a.slot,Object.assign(a,{key:t,renderHeader:s})),a})}},mounted(){this.deliver&&this.fetchChecks()},methods:{goEditTask(){var e;const{task:t}=this,s=this.$router.resolve({name:t.task_type?"create-bid-tasks":"create-formal-tasks",params:{id:t.project_id},query:{task_id:null===(e=t.parent_task_id)||void 0===e?void 0:e.toString(),status:t.task_status}});window.open(s.href,"_blank")},getTemplateTagsStat(){const{template:e}=this.task,t=[];if(null!==e&&void 0!==e&&e.template_component)try{const s=JSON.parse(e.template_component),{items:a,$object_items:i,$object_tools:r}=s,l=e=>{const{component:t,attributes:s}=e;return["z-multiple-select"].includes(t)&&!0===s.calCheckPassRatio};return a.forEach(e=>{l(e)&&t.push({label:e.attributes.label,name:e.attributes.name})}),i.forEach(e=>{l(e)&&("all"===e.attributes.reference?r.forEach(s=>t.push({label:e.attributes.label,name:e.attributes.name,reference:{label:s.label,name:s.name}})):t.push({label:e.attributes.label,name:e.attributes.name,reference:{label:r.find(t=>t.name===e.attributes.reference).label,name:e.attributes.reference}}))}),t}catch(s){return console.log(s),t}return t}},asyncMethods:{fetchChecks(){const{deliver:e,fetchOptions:t,isWorkbench:s}=this,a=s?"label":"receive",i=this.getTemplateTagsStat(),l=i.length?Object(r["uniq"])(Object(r["compact"])(i.map(e=>{var t;return(null===(t=e.reference)||void 0===t?void 0:t.name)||""}))):void 0,n=i.length?Object(r["uniq"])(i.map(e=>e.name)):void 0,o={task_id:e.task_id,deliver_id:e.deliver_id,object_names:null!==l&&void 0!==l&&l.length||null!==n&&void 0!==n&&n.length?["",...null!==l&&void 0!==l&&l.length?l:[]]:void 0,tag_names:n};return Object(b["c"])(t[a].path,t[a].method,o).then(e=>{const t=e;return t.forEach(e=>{i.forEach(t=>{const{reference:s,name:a}=t,i=e=>{const t=null!==e&&void 0!==e?e:null;return null===t?"-":Math.round(1e4*t)/100+"%"};var r;if(s)if(s.name&&a){var l;const t=`${s.name}_${a}`;this.$set(e,`tags_stat_${s.name}_${a}`,i(null===(l=e.object_tags_stat)||void 0===l?void 0:l[t]))}else this.$set(e,`tags_stat_${s.name}_${a}`,"-");else this.$set(e,"tags_stat_"+a,i(null===(r=e.object_tags_stat)||void 0===r?void 0:r[a]))})}),t}).catch(e=>{console.log(e),this.$Message.error("列表数据获取失败，请刷新重试")})}}},D=C,S=Object(j["a"])(D,x,I,!1,null,null,null),E=S.exports,$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"deliver-check-task"},[s("Form",{ref:"form",staticClass:"mtb",attrs:{model:e.formData,"label-position":"right","label-width":80}},[s("Row",[s("Col",{attrs:{span:"24"}},[s("FormItem",{attrs:{label:"质检环节"}},[s("RadioGroup",{attrs:{type:"button"},on:{"on-change":function(t){return e.onChangePage(1)}},model:{value:e.formData.cycle_step,callback:function(t){e.$set(e.formData,"cycle_step",t)},expression:"formData.cycle_step"}},[s("Radio",{attrs:{label:null}},[e._v("全部")]),e._l(e.cycleStepOptions,(function(t){return s("Radio",{key:t.value,attrs:{label:t.value,value:t.value}},[e._v(e._s(t.label))])}))],2)],1)],1)],1)],1),s("Table",{attrs:{columns:e.columns,data:e.deliverChecks,loading:e.fetchDeliverChecks.isPending},scopedSlots:e._u([{key:"check_code",fn:function(t){var a=t.row;return[s("p",[e._v(e._s(a.check_code))]),a.created_at?s("small",{staticClass:"txt-muted"},[e._v("创建: "+e._s(a.created_at))]):e._e()]}},{key:"check_name",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.check_name))])]}},{key:"cycle_step",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(e.cycleStepOptions.find((function(e){return e.value===a.cycle_step})).label||"-"))])]}},{key:"check_num",fn:function(t){var a=t.row;return[s("b",[e._v(e._s(e.$FormatNumber(a.check_num)||"-"))])]}},{key:"checked_num",fn:function(t){var a=t.row;return[s("b",[e._v(e._s(e.$FormatNumber(a.checked_num)||"-"))])]}},{key:"check_task_status",fn:function(e){var t=e.row;return[s("CheckTaskStatusRender",{staticClass:"mls",attrs:{value:t.check_task_status}})]}},{key:"check_passed_str",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.check_passed_str||"-"))])]}},{key:"check_passed_re_str",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.check_passed_re_str||"-"))])]}},{key:"check_invalided_num",fn:function(t){var a=t.row;return[s("b",[e._v(e._s(e.$FormatNumber(a.check_invalided_num)||"-"))])]}},{key:"check_wait_review_num",fn:function(t){var a=t.row;return[s("b",[e._v(e._s(e.$FormatNumber(a.check_wait_review_num)||"-"))])]}},{key:"is_finish_check",fn:function(t){var a=t.row;return[s("span",[e._v(e._s(a.is_finish_check?"是":"否"))])]}}])}),s("Row",{staticClass:"mtm",attrs:{type:"flex",justify:"space-between",align:"top"}},[s("div",{staticClass:"left"}),s("div",{staticClass:"right"},[s("Page",{attrs:{current:e.page.index,total:e.page.total,"page-size":e.page.size,"show-total":"","show-elevator":""},on:{"on-change":e.onChangePage}})],1)])],1)},A=[],R=s("4bd1"),L=s("4463"),F={components:{CheckTaskStatusRender:R["a"]},mixins:[k["a"]],props:{task:Object,relation:Object,deliver:Object},data(){const e=(e,{column:t})=>e("Row",{props:{justify:"end",align:"middle"}},[e("span",t.title),e("Tooltip",{props:{content:t.desc,transfer:!0,placement:"top",maxWidth:"200"}},[e("Icon",{props:{type:"ios-help-circle-outline"},style:{marginLeft:"3px"}})])]);return{formData:{cycle_step:null},cycleStepOptions:[{label:"标注质检",value:0},{label:"审核质检",value:2},{label:"验收质检",value:1}],columns:[{slot:"check_code",title:"抽检编号",width:200},{slot:"check_name",title:"抽检名称",minWidth:120},{slot:"cycle_step",title:"质检环节",minWidth:100},{slot:"check_num",title:"抽检总量",desc:"抽检任务数据范围内的任务明细数量，包含已失效数据",renderHeader:e,align:"center",minWidth:110},{slot:"checked_num",title:"已抽检",align:"center",minWidth:100},{slot:"check_task_status",title:"状态",align:"center",minWidth:100},{slot:"check_passed_str",title:"抽检通过率",desc:"原标注结果的抽检通过率",renderHeader:e,align:"center",minWidth:130},{slot:"check_passed_re_str",title:"校正后通过率",desc:"原标注结果修改校正后的通过率",renderHeader:e,align:"center",minWidth:150},{slot:"check_invalided_num",title:"已失效",desc:"抽检任务中质检结果失效的数量",renderHeader:e,align:"center",minWidth:100},{slot:"check_wait_review_num",title:"待领取",desc:"抽检任务中可领取质检的数量",renderHeader:e,align:"center",minWidth:100},{slot:"is_finish_check",title:"是否最后一次抽检",align:"center",minWidth:150}],deliverChecks:[],page:{index:1,size:10,total:0}}},mounted(){this.isAudit?this.formData.cycle_step=2:this.isLabel?this.formData.cycle_step=0:this.isWorkbench||(this.formData.cycle_step=1),this.fetchDeliverChecks()},methods:{onChangePage(e){this.page.index=e,this.fetchDeliverChecks()},onFormatDeliverChecks(e){const t=e.map(e=>{const t=e,s=["check_num","checked_num","check_passed_str","check_passed_re_str","check_invalided_num","check_wait_review_num"];return s.forEach(e=>{this.$set(t,e,t.check_stats_data?t.check_stats_data[e]:null)}),t});return t}},asyncMethods:{fetchDeliverChecks(){const{task:e,deliver:t,page:s,formData:a}=this,i={task_id:e.task_id,deliver_id:t.deliver_id,page:{start:(s.index-1)*s.size,size:s.size,return_total:1}};return Object.keys(a).forEach(e=>{null!==a[e]&&(i[e]=a[e])}),Object(L["i"])(i).then(e=>(this.page.total=e.total,this.onFormatDeliverChecks(e.data)))}}},P=F,M=Object(j["a"])(P,$,A,!1,null,null,null),N=M.exports,B=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.logs.length>0?s("Timeline",e._l(e.logs,(function(t){return s("TimelineItem",{key:t.flow_log_id.toString()},[s("Card",[s("b",[e._v(e._s(t.flow_handle_at))]),s("p",{staticClass:"content"},[e._v(e._s(t.nick_name)+"："+e._s(t.flow_action))]),e.showReason(t)?[s("p",{staticClass:"txt-red"},[e._v("原因："+e._s(t.flow_remark||"-"))])]:e._e(),(t.flow_action.includes("通过")||t.flow_action.includes("PASS"))&&t.flow_remark?[s("p",{staticClass:"txt-green"},[e._v("备注："+e._s(t.flow_remark||"-"))])]:e._e()],2)],1)})),1):s("p",[e._v("暂无数据")])],1)},V=[],z={mixins:[k["a"]],props:{task:Object,deliver:Object},data(){return{logs:[],fetchOptions:{label:"api/workbench/listDeliverLogs",receive:"api/deliver/listDeliverLogs"}}},computed:{fetchPath(){let e="";return e=this.isWorkbench?"label":"receive",this.fetchOptions[e].substring(0,this.fetchOptions[e].lastIndexOf("/"))},fetchMethod(){let e="";return e=this.isWorkbench?"label":"receive",this.fetchOptions[e].substring(this.fetchOptions[e].lastIndexOf("/")+1)},showReason(){return function(e){return e.flow_action.includes("驳回")||e.flow_action.includes("重新")||e.flow_action.includes("REJECT")||e.flow_action.includes("创建批次")&&"CREATE_DELIVER"!==e.flow_remark}}},mounted(){this.fetchLogs()},asyncMethods:{fetchLogs(){const{task:e,deliver:t,fetchPath:s,fetchMethod:a}=this,i={task_id:e.task_id,deliver_id:t.deliver_id,page:{start:0,size:100,return_total:1}};return Object(b["c"])(s,a,i).then(e=>e)}}},q=z,W=Object(j["a"])(q,B,V,!1,null,null,null),U=W.exports,Q=s("c206"),G=s.n(Q),K={components:{Detail:w,Check:E,CheckTask:N,Log:U},mixins:[k["a"]],props:{task:Object,relation:Object},data(){return{moment:G.a,tab:"",fetchOptions:{label:{path:"api/workbench",method:"listDeliverTasks",from:0},receive:{path:"api/deliver",method:"listDeliverTasks",from:1},audit:{path:"api/workbench",method:"listDeliverTasks",from:2}},deliverTask:{}}},computed:{showDeadlineAutoDeliver(){const{deliverTask:e}=this;return!!e&&(30===e.status&&e.deadline_date&&new Date(e.deadline_date)>new Date)}},watch:{"$route.query.deliver_id"(){this.fetchDeliver(),this.fetchDeliverTask()}},mounted(){var e;this.fetchDeliver(),this.fetchDeliverTask(),this.changeTab((null===(e=this.$route.query)||void 0===e?void 0:e.type)||"check")},methods:{changeTab(e){this.tab=e,this.$router.replace({query:{...this.$route.query,type:e}})}},asyncMethods:{fetchDeliver(){const{task:e,fetchOptions:t,isWorkbench:s,isLabel:a,isAudit:i}=this;let r="";i?r="audit":a?r="label":s||(r="receive");const l={task_id:e.task_id,deliver_id:this.$route.query.deliver_id,page:{start:0,size:1,return_total:0},from:t[r].from};return Object(b["c"])(t[r].path,t[r].method,l).then(e=>e.data[0]).catch(e=>{console.log(e)})},fetchDeliverTask(){const{$route:e,task:t,fetchOptions:s,isWorkbench:a,isLabel:i,isAudit:r}=this;let l="";r?l="audit":i?l="label":a||(l="receive");const{from:n}=s[l],o={task_id:t.task_id,deliver_id:e.query.deliver_id,from:n};return Object(L["g"])(o).then(e=>{const t=!!(60===e.status&&e.deadline_date&&new Date(e.deadline_date)<=new Date);return this.$emit("disableDeliverAgain",t),e}).catch(e=>(console.log(e),{}))}}},J=K,H=(s("4c8b"),Object(j["a"])(J,l,n,!1,null,"7f1fb1c2",null)),Y=H.exports,X=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{width:1200,"mask-closable":!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("h3",[e._v(e._s(e.typeOptions[e.type].title))]),s("div",{staticClass:"mtm"},[e._v(e._s(e.typeOptions[e.type].desc))])]),s("div",{staticClass:"content"},[s("h4",[e._v("1、基础信息")]),s("Form",{ref:"formBasic",staticClass:"padding",attrs:{model:e.form,"label-width":100,"label-position":"left","label-colon":""}},[s("FormItem",{staticClass:"mbm",attrs:{label:"添加方式",prop:"hasDeliver",rules:e.ruleNotEmpty}},[s("RadioGroup",{model:{value:e.form.hasDeliver,callback:function(t){e.$set(e.form,"hasDeliver",t)},expression:"form.hasDeliver"}},[s("Radio",{attrs:{label:0,disabled:!(!e.task.task_type||!e.useDeliverLen)}},[e._v("添加到一个新批次")]),s("Radio",{attrs:{label:1}},[e._v("添加到一个已有批次")]),e.task.task_type&&e.useDeliverLen?s("small",{staticClass:"txt-muted"},[e._v("(试标任务仅能交付一次，批次驳回后可重新交付)")]):e._e()],1)],1),e.form.hasDeliver?s("FormItem",{staticClass:"mbm",attrs:{label:"选择批次",prop:"deliver_id",rules:e.ruleNotEmpty}},[s("Select",{attrs:{placeholder:"请选择待交付的批次"},model:{value:e.form.deliver_id,callback:function(t){e.$set(e.form,"deliver_id",t)},expression:"form.deliver_id"}},e._l(e.delivers,(function(t){return s("Option",{key:t.deliver_id.toString(),attrs:{value:t.deliver_id.toString(),label:t.deliver_name,disabled:10!==t.status}},[e._v(e._s(t.deliver_name)+" (状态: "+e._s(t.status_name)+")")])})),1)],1):s("FormItem",{staticClass:"mbm",attrs:{label:"批次名称",prop:"deliver_name",rules:e.ruleNotEmpty}},[s("Input",{attrs:{clearable:"",icon:"md-color-wand",placeholder:"请输入批次名称，任务内批次名称不可重复，默认为任务名_批次n"},on:{"on-click":e.defaultName},model:{value:e.form.deliver_name,callback:function(t){e.$set(e.form,"deliver_name",t)},expression:"form.deliver_name"}})],1)],1),"manual"===e.type?[s("h4",[e._v("2、数据范围")]),s("DataFilter",{ref:"formFilter",attrs:{task:e.task,statTask:e.statTask,delivers:e.delivers},on:{getNum:e.fetchStatTask}}),s("Alert",{staticClass:"mtm",attrs:{"show-icon":""}},[s("Row",[s("Col",{attrs:{span:"8"}},[s("span",[e._v("待添加总量：")]),e.isCross||e.isPack?e.isPack?s("span",[e._v(e._s(e.statTask.wait_add_count)+"个题包")]):e.isCross?s("span",[e._v(e._s(e.statTask.wait_detail_count)+" ("+e._s(e.statTask.wait_add_count)+"题)")]):e._e():s("span",[e._v(e._s(e.statTask.wait_add_count))])]),s("Col",{attrs:{span:"8"}},[s("span",[e._v("本次添加数量：")]),e.isCross||e.isPack?e.isPack?s("span",[e._v(e._s(e.statTask.range_wait_add_count)+"个题包")]):e.isCross?s("span",[e._v(e._s(e.statTask.range_wait_detail_count)+" ("+e._s(e.statTask.range_wait_add_count)+"题)")]):e._e():s("span",[e._v(e._s(e.statTask.range_wait_add_count))])])],1)],1)]:e._e()],2),s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{staticClass:"mlm",on:{click:function(t){e.visible=!1}}},[e._v("取消")]),s("Tooltip",{attrs:{content:"添加到批次的数量不能为0",placement:"top",disabled:!e.isManualEmpty}},[s("Button",{staticClass:"mlm",attrs:{type:"primary",loading:e.fetchCreateDeliverTask.isPending||e.fetchSetAutoAdd.isPending,disabled:e.isManualEmpty},on:{click:e.submit}},[e._v("确认"+e._s("auto"===e.type?"设置自动添加":"手动添加数据"))])],1)],1)])},Z=[],ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Form",{ref:"form",staticClass:"padding",attrs:{model:e.form,"label-width":100,"label-position":"left"}},[s("FormItem",{staticClass:"mbs",attrs:{label:"筛选条件",prop:"isRange",rules:e.ruleNotEmpty}},[s("RadioGroup",{on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isRange,callback:function(t){e.$set(e.form,"isRange",t)},expression:"form.isRange"}},[s("Radio",{attrs:{label:0}},[e._v("全部")]),s("Radio",{attrs:{label:1}},[e._v("自定义")])],1)],1),s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("p",[e._v("需同时满足：")])]),s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("Checkbox",{attrs:{disabled:0===e.form.isRange},model:{value:e.form.filterMode,callback:function(t){e.$set(e.form,"filterMode",t)},expression:"form.filterMode"}},[e._v("未在其他有效批次中")])],1),e.form.isRange?[e.form.filterMode?[e.isCross?e._e():s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Checkbox",{ref:"isLabeler",attrs:{disabled:e.isEdit},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isLabeler,callback:function(t){e.$set(e.form,"isLabeler",t)},expression:"form.isLabeler"}},[e._v("指定标注员的提交结果")]),e.form.isLabeler?s("Select",{ref:"labelers",attrs:{disabled:e.isEdit,multiple:"",filterable:"",transfer:"",placeholder:"请选择指定的标注员"},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.labelers,callback:function(t){e.$set(e.form,"labelers",t)},expression:"form.labelers"}},[e._l(e.taskLabelers,(function(t){return t.user_id&&t.nick_name&&t.email?[s("Option",{key:t.user_id,attrs:{value:t.user_id,label:t.nick_name,tag:t.nick_name}},[s("p",[e._v(e._s(t.nick_name))]),s("p",{staticClass:"txt-muted"},[e._v(e._s(t.email))])])]:e._e()}))],2):e._e()],1)]),e.isCross?e._e():s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Checkbox",{ref:"isLabelTime",attrs:{disabled:e.isEdit},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isLabelTime,callback:function(t){e.$set(e.form,"isLabelTime",t)},expression:"form.isLabelTime"}},[e._v("指定标注提交时间")]),e.form.isLabelTime?s("DatePicker",{ref:"labelTime",staticStyle:{width:"100%"},attrs:{disabled:e.isEdit,type:"datetimerange",placeholder:"开始时间 - 结束时间"},on:{"on-change":function(t){t&&(e.form.labelTime=t),e.getNum()}},model:{value:e.form.labelTime,callback:function(t){e.$set(e.form,"labelTime",t)},expression:"form.labelTime"}}):e._e()],1)]),s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Checkbox",{ref:"isDetailId",attrs:{disabled:e.isEdit||e.form.isItemId||e.form.isPackKey},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isDetailId,callback:function(t){e.$set(e.form,"isDetailId",t)},expression:"form.isDetailId"}},[e._v("指定任务明细ID")]),e.form.isDetailId?[s("Input",{ref:"detailIds",attrs:{disabled:e.isEdit,type:"textarea",autosize:{maxRows:6},placeholder:"请输入要筛选的任务明细ID，不支持筛选超过500个ID"},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.detailIds,callback:function(t){e.$set(e.form,"detailIds",t)},expression:"form.detailIds"}}),s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)]:e._e()],2)]),s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Checkbox",{ref:"isItemId",attrs:{disabled:e.isEdit||e.form.isDetailId||e.form.isPackKey},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isItemId,callback:function(t){e.$set(e.form,"isItemId",t)},expression:"form.isItemId"}},[e._v("指定题目ID")]),e.form.isItemId?[s("Input",{ref:"itemIds",attrs:{disabled:e.isEdit,type:"textarea",autosize:{maxRows:6},placeholder:"请输入要筛选的题目ID，不支持筛选超过500个ID"},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.itemIds,callback:function(t){e.$set(e.form,"itemIds",t)},expression:"form.itemIds"}}),s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)]:e._e()],2)]),s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Checkbox",{ref:"isPackKey",attrs:{disabled:e.isEdit||e.form.isDetailId||e.form.isItemId},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isPackKey,callback:function(t){e.$set(e.form,"isPackKey",t)},expression:"form.isPackKey"}},[e._v("指定题包Key")]),e.form.isPackKey?[s("Input",{ref:"packKeys",attrs:{disabled:e.isEdit,type:"textarea",autosize:{maxRows:6},placeholder:"请输入要筛选的题包Key，不支持筛选超过500个Key"},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.packKeys,callback:function(t){e.$set(e.form,"packKeys",t)},expression:"form.packKeys"}}),s("Tooltip",{attrs:{content:"Key间的间隔符号支持中英文逗号、分号、空格、换行符",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)]:e._e()],2)]),e.isCross||e.isPack?e._e():s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("Tooltip",{attrs:{placement:"left",transfer:"",delay:1e3}},[s("span",{staticStyle:{"white-space":"normal"},attrs:{slot:"content"},slot:"content"},[e._v("筛选标注结果和调整有效比例不能同时选择")]),s("Checkbox",{ref:"isLabelFilter",attrs:{disabled:e.isEdit||e.form.isValid},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isLabelFilter,callback:function(t){e.$set(e.form,"isLabelFilter",t)},expression:"form.isLabelFilter"}},[e._v("筛选标注结果（仅选择器类型）")])],1),e.form.isLabelFilter?[s("br"),s("t-space",{attrs:{align:"center"}},[s("RadioGroup",{model:{value:e.groupLogic,callback:function(t){e.groupLogic=t},expression:"groupLogic"}},[s("Radio",{attrs:{label:"and"}},[e._v("满足以下全部条件")]),s("Radio",{attrs:{label:"or"}},[e._v("满足以下任一条件")])],1)],1),s("LabelFilter",{ref:"LabelFilter",attrs:{filterType:"label",template:e.template,editEnabled:!e.isEdit},on:{"update:filter":function(t){e.form.LabelFilter=t},getNum:e.getNum}}),s("AttributesLabel",{ref:"AttributesLabel",attrs:{filterType:"label",template:e.template,editEnabled:!e.isEdit},on:{"update:filter":function(t){e.form.AttributesLabel=t},getNum:e.getNum}})]:e._e()],2),e.isCross||e.isPack?e._e():s("FormItem",{staticClass:"mtm mbm",attrs:{"label-width":160}},[s("Row",{attrs:{slot:"label",justify:"start",align:"top"},slot:"label"},[s("span",{staticClass:"mrs txt-red",staticStyle:{"font-size":"22px"}},[e._v("*")]),s("span",[e._v("调整有效/无效比例")])]),s("div",{staticClass:"flex"},[s("Tooltip",{attrs:{placement:"left",transfer:"",delay:1e3}},[s("span",{staticStyle:{"white-space":"normal"},attrs:{slot:"content"},slot:"content"},[e._v("调整有效比例和筛选标注结果不能同时选择")]),s("i-switch",{attrs:{disabled:e.isEdit||e.form.isLabelFilter},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.isValid,callback:function(t){e.$set(e.form,"isValid",t)},expression:"form.isValid"}},[s("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),s("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e.form.isValid?s("div",{staticClass:"mlm"},[s("span",{staticClass:"mlm"},[e._v("标注有效的占比")]),s("InputNumber",{ref:"validPercent",staticClass:"mlm",attrs:{disabled:e.isEdit||!e.form.isValid,min:0,max:100,precision:.1},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.validPercent,callback:function(t){e.$set(e.form,"validPercent",t)},expression:"form.validPercent"}}),s("span",{staticClass:"mlm"},[e._v("%")])],1):e._e(),e.form.isValid&&null===e.form.validPercent?s("div",{staticClass:"mlm txt-red"},[e._v("不能为空")]):e._e()],1),e.isEdit||e.form.isValid&&(!e.form.isValid||null===e.form.validPercent)?e._e():s("p",{staticClass:"txt-muted"},[s("span",[e._v(e._s(e.form.isValid?"(调整后：":"(调整前："))]),s("span",[e._v(e._s("有效数"+e.statTask.valid_wait_add_count+"，无效数"+(e.statTask.range_wait_add_count-e.statTask.valid_wait_add_count)+")"))])])],1),e.isCross?s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("Checkbox",{ref:"isCrossFilter",attrs:{disabled:e.isEdit},on:{"on-change":e.getNum},model:{value:e.form.isCrossFilter,callback:function(t){e.$set(e.form,"isCrossFilter",t)},expression:"form.isCrossFilter"}},[e._v("筛选结果评价指标（仅交叉标注）")]),e.form.isCrossFilter?[s("br"),s("t-space",{attrs:{align:"center"}},[s("RadioGroup",{model:{value:e.groupLogic,callback:function(t){e.groupLogic=t},expression:"groupLogic"}},[s("Radio",{attrs:{label:"and"}},[e._v("满足以下全部条件")]),s("Radio",{attrs:{label:"or"}},[e._v("满足以下任一条件")])],1)],1),s("LabelFilter",{ref:"CrossFilter",attrs:{filterType:"cross",template:e.template,editEnabled:!e.isEdit},on:{"update:filter":function(t){e.form.CrossFilter=t},getNum:e.getNum}}),s("AttributesLabel",{ref:"AttributesLabel",attrs:{filterType:"cross",template:e.template,editEnabled:!e.isEdit},on:{"update:filter":function(t){e.form.AttributesLabel=t},getNum:e.getNum}})]:e._e()],2):e._e(),e.statTask?[s("FormItem",{staticClass:"mtm mbm",attrs:{label:"本次添加数量","label-width":160}},[s("b",[e._v(e._s(e.statTask.range_wait_add_count))]),s("span",{staticClass:"mlm txt-muted"},[e._v("（通过数据范围筛选出来的数量）")])])]:e._e()]:[s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Select",{attrs:{placeholder:"请选择待交付的批次",multiple:"",filterable:""},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.fromDeliverIds,callback:function(t){e.$set(e.form,"fromDeliverIds",t)},expression:"form.fromDeliverIds"}},e._l(e.delivers,(function(t){return s("Option",{key:t.deliver_id.toString(),attrs:{value:t.deliver_id.toString(),label:t.deliver_name,disabled:10!==t.status}},[e._v(e._s(t.deliver_name)+" (状态: "+e._s(t.status_name)+")")])})),1)],1)]),s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("div",{staticClass:"flex"},[s("Select",{attrs:{placeholder:"请选择质检结果",filterable:"",clearable:""},on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.packKeyCheckStatus,callback:function(t){e.$set(e.form,"packKeyCheckStatus",t)},expression:"form.packKeyCheckStatus"}},e._l(e.deliverCheckStatus,(function(t,a){return[15,30,50,60].includes(t.value)?s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.text))]):e._e()})),1),s("div",{staticClass:"check-status-tip"},[e._v("(题包场景，题包内数据需同时满足；交叉标注，题目内数据需同时满足)")])],1)]),e.isCross||e.isPack?s("FormItem",{staticClass:"mbs",attrs:{label:""}},[s("Checkbox",{on:{"on-change":function(t){return e.getNum()}},model:{value:e.form.packKeyAllValid,callback:function(t){e.$set(e.form,"packKeyAllValid",t)},expression:"form.packKeyAllValid"}},[e._v("删除无效数据")])],1):e._e()]]:e._e()],2)],1)},te=[],se=s("864c"),ae=s("b0f9"),ie=s("6982"),re=s("b53d"),le={components:{LabelFilter:ie["a"],AttributesLabel:re["a"]},props:{task:Object,statTask:[Object,String],isEdit:{type:Boolean,default:!1},delivers:{type:Array,default:()=>[]}},data(){return{groupLogic:"and",form:{isRange:0,isLabeler:!1,labelers:[],isLabelTime:!1,labelTime:[],isLabelFilter:!1,LabelFilter:[],AttributesLabel:[],isCrossFilter:!1,CrossFilter:[],isDetailId:!1,detailIds:"",isItemId:!1,itemIds:"",isPackKey:!1,packKeys:"",isValid:!1,validPercent:100,filterMode:!0,fromDeliverIds:[],packKeyCheckStatus:"",packKeyAllValid:!1},ruleNotEmpty:{required:!0,message:"不能为空"},ruleMinimum:{type:"number",min:1,message:"不能小于1"},template:{},deliverCheckStatus:m["f"]}},computed:{isCross(){var e;return(null===(e=this.task)||void 0===e?void 0:e.cross_num)>=2},isPack(){var e;return(null===(e=this.task)||void 0===e?void 0:e.pack_num)>0},search_params(){const e=this.form,t=!!(e.isLabelTime&&e.labelTime[0]&&e.labelTime[1]),s={is_range:e.isRange?1:0,detail_user_list:e.isRange&&e.isLabeler?e.labelers:null,label_begin_date:e.isRange&&t?G()(e.labelTime[0]).format("YYYY-MM-DD HH:mm:ss"):null,label_end_date:e.isRange&&t?G()(e.labelTime[1]).format("YYYY-MM-DD HH:mm:ss"):null,label_value_cond:e.isRange&&e.isLabelFilter?e.LabelFilter.groupLogic:null,label_value_cond_dtos:e.isRange&&e.isLabelFilter?e.LabelFilter.data:null,check_filters_score_condition:this.isCross&&e.isRange&&e.isCrossFilter?e.CrossFilter.groupLogic:null,check_filters:this.isCross&&e.isRange&&e.isCrossFilter?e.CrossFilter.data:null,check_filters_group_condition:this.isCross?this.groupLogic:null,check_filters_object_label_score_conditions:this.isCross?e.AttributesLabel:null,label_group_condition:this.isCross?null:this.groupLogic,object_label_value_conditions:this.isCross?null:e.AttributesLabel,valid_percent:e.isRange&&e.isValid?e.validPercent:null,valid_count:this.statTask.valid_wait_add_count,detail_id_list:e.isRange&&e.isDetailId?this.splitIds(e.detailIds):null,item_id_list:e.isRange&&e.isItemId?this.splitIds(e.itemIds):null,pack_key_list:e.isRange&&e.isPackKey?this.splitIds(e.packKeys):null,filter_mode:Number(!e.filterMode),from_deliver_ids:e.isRange&&!e.filterMode?e.fromDeliverIds:null,pack_key_check_status:e.isRange&&!e.filterMode&&e.packKeyCheckStatus?e.packKeyCheckStatus:null,pack_key_all_valid:e.isRange&&!e.filterMode&&(this.isCross||this.isPack)?Number(e.packKeyAllValid):null};return Object(r["omitBy"])(s,r["isNil"])}},mounted(){this.fetchTemplate(),this.fetchTaskLabelers()},methods:{getNum(){this.$emit("getNum"),0===this.form.isRange&&(this.form.filterMode=!0)},validate(){const e=this.form,t=this.$refs.form.validate(e=>e);if(!t)return this.$Message.error("提交失败，请检查是否有遗漏"),!1;if(e.isRange){if(e.filterMode){var s,a,i,r,l,n,o,c;if(!(e.isLabeler||e.isLabelTime||e.isLabelFilter||e.isCrossFilter||e.isValid||e.isDetailId||e.isItemId||e.isPackKey))return this.$Message.error("尚未选择自定义范围的筛选条件"),null===(s=this.$refs.isLabeler)||void 0===s||s.onFocus(),null===(a=this.$refs.isLabelTime)||void 0===a||a.onFocus(),null===(i=this.$refs.isLabelFilter)||void 0===i||i.onFocus(),null===(r=this.$refs.isCrossFilter)||void 0===r||r.onFocus(),null===(l=this.$refs.validPercent)||void 0===l||l.focus(),null===(n=this.$refs.isDetailId)||void 0===n||n.onFocus(),null===(o=this.$refs.isItemId)||void 0===o||o.onFocus(),null===(c=this.$refs.isPackKey)||void 0===c||c.onFocus(),!1;if(e.isLabeler&&e.labelers.length<=0)return this.$Message.error("尚未选择指定的标注员"),this.$refs.labelers.toggleMenu(),!1;if(e.isLabelTime&&!e.labelTime[0]&&!e.labelTime[1])return this.$Message.error("尚未选择完整的提交时间"),this.$refs.labelTime.handleFocus(),Promise.resolve();if(e.isDetailId&&!e.detailIds)return this.$Message.error("尚未指定任务明细ID"),this.$refs.detailIds.focus(),Promise.resolve();if(e.isItemId&&!e.itemIds)return this.$Message.error("尚未指定题目ID"),this.$refs.itemIds.focus(),Promise.resolve();if(e.isPackKey&&!e.packKeys)return this.$Message.error("尚未指定题包Key"),this.$refs.packKeys.focus(),Promise.resolve();if(e.isLabelFilter&&this.$refs.LabelFilter.verifyFilter(),e.isLabelFilter&&e.LabelFilter.data.length<=0&&e.AttributesLabel.length<=0)return this.$Message.error("未找到筛选标注结果的筛选条件"),!1;if(e.isCrossFilter&&this.$refs.CrossFilter.verifyFilter(),e.isCrossFilter&&e.CrossFilter.data.length<=0&&e.AttributesLabel.length<=0)return this.$Message.error("未找到筛选结果评价指标的筛选条件"),!1;if(e.isValid&&null===e.validPercent)return this.$Message.error("尚未填写标注有效占比"),!1}else{if(e.fromDeliverIds.length<=0)return this.$Message.error("尚未选择待交付的批次"),!1;if(!e.packKeyCheckStatus)return this.$Message.error("尚未选择质检结果"),!1}return!0}return!0},splitIds(e){var t;if(!e)return[];let s=Object(r["compact"])(e.split(/[\n\s+,，;；、]/g));return(null===(t=s)||void 0===t?void 0:t.length)>=5e3&&(s=s.slice(0,5e3)),s},validateIds(e){let t=!0;return e.forEach(e=>{t=t&&RegExp(/^[0-9]+$/).test(e)}),t}},asyncMethods:{fetchTaskLabelers(){const e={task_id:this.task.task_id};return se["a"].ListLabelerUser(e).then(e=>e.data.result).catch(e=>{console.log(e),this.$Message.error("获取标注员列表失败："+e.message)})},fetchTemplate(){const e={template_id:this.task.template_id};return Object(ae["k"])(e).then(e=>e)}}},ne=le,oe=(s("da2a"),Object(j["a"])(ne,ee,te,!1,null,"b03ca232",null)),ce=oe.exports,de={components:{DataFilter:ce},props:{useDeliverLen:Number,type:String,task:Object},data(){return{visible:!0,typeOptions:{auto:{title:"自动添加数据",desc:"已标注数据将自动添加到指定批次，批次交付后自动终止"},manual:{title:"手动添加数据",desc:"已标注的数据需先添加到批次，再进行质检或交付"}},form:{hasDeliver:0,deliver_id:"",deliver_name:""},ruleNotEmpty:{required:!0,message:"不能为空"},deliverCount:0,statTask:""}},computed:{isManualEmpty(){const{type:e,statTask:t}=this;return"manual"===e&&0===t.range_wait_add_count},hasWaitSubmitDeliver(){let e=!1;return Object(r["map"])(this.delivers,t=>{t.status>=10&&t.status<70&&(e=!0)}),e},isCross(){var e;return(null===(e=this.task)||void 0===e?void 0:e.cross_num)>=2},isPack(){var e;return(null===(e=this.task)||void 0===e?void 0:e.pack_num)>0}},mounted(){this.useDeliverLen&&(this.form.hasDeliver=1),this.fetchStatTask(),this.fetchDelivers().then(()=>{this.defaultName()})},methods:{defaultName(){const{form:e,task:t,deliverCount:s}=this;e.deliver_name=`${t.task_name}_批次${s+1}`},async submit(){var e;const{type:t,task:s,form:a,hasWaitSubmitDeliver:i}=this,r=await this.$refs.formBasic.validate(e=>e),l=await(null===(e=this.$refs.formFilter)||void 0===e?void 0:e.validate(e=>e));if(!r||this.$refs.formFilter&&!l){if(!r)return console.log(l),this.$Message.error("提交失败，请检查是否有遗漏"),Promise.resolve()}else{var n;let[e,r]=["",""];if(a.hasDeliver)e="auto"===t?a:await this.fetchAddDeliverDetail(a.deliver_id);else{if(s.is_single_deliver&&i)return this.$Message.error("提交失败，试标任务只能存在一个交付批次"),Promise.resolve();e=await this.fetchCreateDeliverTask()}r=null===(n=e)||void 0===n||!n.deliver_id||"auto"!==t||await this.fetchSetAutoAdd("auto"===t,e.deliver_id),r&&(this.$emit("refresh"),this.visible=!1)}}},asyncMethods:{fetchDelivers(){const e={task_id:this.task.task_id,page:{start:0,size:500,return_total:1},from:0};return se["a"].ListDeliverTasks(e).then(e=>{const t=e.data.result;return this.deliverCount=t.total,t.data}).catch(e=>{console.log(e)})},fetchStatTask(){var e;const t={task_id:this.task.task_id,type:1},s=null===(e=this.$refs.formFilter)||void 0===e?void 0:e.search_params;return s&&Object.assign(t,s),t.detail_user_list&&(t.detail_labeler_list=t.detail_user_list,delete t.detail_user_list),Object(L["n"])(t).then(e=>e).catch(e=>(console.log(e),{valid_wait_add_count:0,range_wait_add_count:0,range_wait_detail_count:0,wait_add_count:this.statTask.wait_add_count,wait_detail_count:this.statTask.wait_detail_count}))},fetchCreateDeliverTask(){var e;const{task:t,statTask:s,form:a}=this,i={task_id:t.task_id,task_type:t.task_type,add_all:t.is_single_deliver,deliver_name:a.deliver_name,deliver_num:s.range_wait_add_count,from:1},r=null===(e=this.$refs.formFilter)||void 0===e?void 0:e.search_params;return r&&Object.assign(i,r),Object(L["c"])(i).then(e=>(this.$Message.success("创建批次成功"),e)).catch(e=>{console.log(e),this.$Message.error("创建批次失败："+e.message)})},fetchAddDeliverDetail(e){var t;const s={task_id:this.task.task_id,deliver_id:e,auto_add:0},a=null===(t=this.$refs.formFilter)||void 0===t?void 0:t.search_params;return a&&Object.assign(s,a),Object(L["a"])(s).then(e=>(e?this.$Message.success("已添加数据到批次"):this.$Message.error("添加数据失败"),!0)).catch(e=>{console.log(e),this.$Message.error("添加数据失败："+e.message)})},fetchSetAutoAdd(e,t){const s={task_id:this.task.task_id,deliver_id:t,auto_add:Number(e)};return Object(L["l"])(s).then(e=>(e?this.$Message.success("已设置自动添加"):this.$Message.error("设置自动添加失败"),{deliver_id:t})).catch(e=>{console.log(e),this.$Message.error("设置自动添加失败："+e.message)})}}},ue=de,pe=(s("9b01"),Object(j["a"])(ue,X,Z,!1,null,"958505ae",null)),me=pe.exports,he=s("b92b"),_e=s("4932"),fe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{closable:e.mergeQueue.length<=0,"mask-closable":!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("h3",[e._v("批次合并")]),s("div",{staticClass:"mtm"},[e._v("支持将"+e._s(e.detailStatusOptions[e.detailStatus].title)+"的批次合并后再交付")])]),e.mergeQueue.length>0?s("div",{staticClass:"content"},[e.isFinished?s("div",{staticClass:"mtm"},[0===e.rejectedNum?s("Alert",{attrs:{type:"success","show-icon":""}},[e._v("批次合并成功！")]):s("Alert",{attrs:{type:"warning","show-icon":""}},[e._v("合并完毕，成功合并"+e._s(e.fulfilledNum)+"个批次，失败"+e._s(e.rejectedNum)+"个批次；请重试。")]),e.page.total>e.page.size?s("Alert",{attrs:{type:"warning","show-icon":""}},[e._v("本次已达单次处理限制："+e._s(e.page.size)+"个")]):e._e()],1):s("div",{staticClass:"mtm"},[s("Alert",{attrs:{"show-icon":""}},[e._v("批次合并中……成功合并"+e._s(e.fulfilledNum)+"个批次，失败"+e._s(e.rejectedNum)+"个批次")])],1)]):s("div",{staticClass:"content"},[s("div",{staticClass:"mbm"},[s("span",[e._v("确定合并")]),e.isAll?s("span",{staticClass:"txt-blue"},[e._v(" 全部"+e._s(e.page.total>0?" "+e.page.total+" 个":"")+" ")]):s("span",[s("span",{staticClass:"txt-blue"},[e._v(" 已选的 "+e._s(e.num)+" 个 ")])]),s("span",[e._v(e._s(e.detailStatusOptions[e.detailStatus].title)+"批次，可编辑合并后的批次名称")])]),s("Input",{attrs:{placeholder:"非必填，默认取首个批次的名称"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[0===e.mergeQueue.length?s("Button",{staticClass:"mls",on:{click:function(t){e.visible=!1}}},[e._v("取消")]):e._e(),s("Tooltip",{attrs:{disabled:e.isSubmitOk}},[s("div",{staticStyle:{"white-space":"normal",width:"200px"},attrs:{slot:"content"},slot:"content"},[s("p",[e._v("待处理的批次少于 2 个时不可用")]),s("p",[e._v("当前待处理: "+e._s(e.page.total))])]),e.isSubmit?s("Button",{staticClass:"mls",attrs:{type:"primary",disabled:!e.isSubmitOk,loading:!e.isFinished},on:{click:e.merge}},[e._v("确认并处理")]):e._e()],1),e.mergeQueue.length>0&&e.isFinished?s("Button",{staticClass:"mls",attrs:{type:"primary"},on:{click:e.refresh}},[e._v("知道了")]):e._e()],1)])},ve=[],be={props:{task:Object,selection:Array,isAll:Boolean,detailStatus:Number},data(){return{visible:!0,name:"",page:{size:500,total:0},mergeQueue:[],detailStatusOptions:{10:{title:"待交付",fetchPath:"api/workbench"},30:{title:"待验收",fetchPath:"api/deliver"}}}},computed:{num(){var e;return null===(e=this.selection)||void 0===e?void 0:e.length},fulfilledNum(){return Object(r["filter"])(this.mergeQueue,{isFulfilled:!0}).length},rejectedNum(){return Object(r["filter"])(this.mergeQueue,{isRejected:!0}).length},isFinished(){return this.mergeQueue.length===this.fulfilledNum+this.rejectedNum},isSubmit(){const{mergeQueue:e,isFinished:t}=this;return 0===e.length||!t},isSubmitOk(){const{isAll:e,selection:t,delivers:s}=this;return e?(null===s||void 0===s?void 0:s.length)>1:(null===t||void 0===t?void 0:t.length)>1}},mounted(){this.name=this.selection[0].deliver_name,this.isAll&&this.fetchDelivers()},methods:{refresh(){this.$emit("refresh"),this.visible=!1},merge(){const{isAll:e,selection:t,delivers:s}=this,a=e?s:t,i=a[0].deliver_id;this.mergeQueue=Object(r["tail"])(a);let l=-1;const n=()=>{if(l+=1,l>=this.mergeQueue.length)return;const e=this.mergeQueue[l];e.promise=this.fetchMergeDeliver(e.deliver_id,i).then(()=>this.$set(e,"isFulfilled",!0)).catch(()=>this.$set(e,"isRejected",!0)).finally(()=>n())};n(),console.log(this.mergeQueue)},fetchMergeDeliver(e,t){const{task:s,detailStatus:a,detailStatusOptions:i}=this,r={task_id:s.task_id,source_deliver_id:e,target_deliver_id:t};return this.name&&(r.target_deliver_name=this.name),Object(b["c"])(i[a].fetchPath,"mergeDeliver",r)}},asyncMethods:{fetchDelivers(){const{task:e,page:t,detailStatus:s}=this,a={task_id:e.task_id,page:{start:0,size:t.size,return_total:1},deliver_status:s};return Object(L["j"])(a).then(e=>(this.page.total=e.total,e.data)).catch(e=>{this.$Message.error("获取批次失败："+e),this.mergeQueue=[]})}}},ke=be,ye=Object(j["a"])(ke,fe,ve,!1,null,null,null),ge=ye.exports,Te=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{"mask-closable":!1,width:700},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("h3",[e._v("批次拆分")]),s("div",{staticClass:"mtm"},[e._v("对待交付批次进行拆分，调整后数据将会从原批次分离出一个新的批次，质检结果仍然保留")])]),s("div",{staticClass:"content"},[s("Form",{ref:"form",attrs:{model:e.form,"label-position":"right","label-width":90}},[s("h4",{staticClass:"mbm"},[e._v("1、基础信息")]),s("FormItem",{attrs:{label:"批次名称",prop:"name",rules:e.ruleNotEmpty}},[s("Row",{attrs:{gutter:5}},[s("Col",{attrs:{span:"23"}},[s("Input",{attrs:{placeholder:"请填写新批次的名称，必填，不可以和已有批次名称重复"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),s("Col",{attrs:{span:"1"}},[s("Tooltip",{attrs:{content:"自动填充名称",transfer:""}},[s("Icon",{attrs:{type:"ios-color-wand-outline"},on:{click:function(t){return e.autoName()}}})],1)],1)],1)],1),s("h4",{staticClass:"mbm"},[e._v("2、数据范围")]),s("FormItem",{attrs:{label:"筛选条件",prop:"condition",rules:e.ruleNotEmpty}},[s("CheckboxGroup",{on:{"on-change":e.changeCondition},model:{value:e.form.condition,callback:function(t){e.$set(e.form,"condition",t)},expression:"form.condition"}},e._l(e.conditionOptions,(function(t,a){return s("Row",{key:a,attrs:{type:"flex",align:"top"}},[s("Checkbox",{attrs:{label:a,disabled:e.singleConditions.includes(e.form.condition[0])&&a!==e.form.condition[0]}},[s("span",[e._v(e._s(t))])]),e._l(e.singleConditions,(function(i){return[e.form.condition.includes(i)&&a===i?[s("FormItem",{staticStyle:{width:"400px"},attrs:{prop:a,rules:{required:!0,message:" "}}},[s("Row",{attrs:{align:"top"}},[s("Col",{attrs:{span:"22"}},[s("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请填写"+t},on:{"on-blur":function(t){return e.fetchSplitDeliver(!1)}},model:{value:e.form[a],callback:function(t){e.$set(e.form,a,t)},expression:"form[key]"}})],1),s("Col",{attrs:{span:"2"}},[s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符。ID数量不要超过"+e.limitIds+"个",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)],1)],1)],1)]:e._e()]})),e.form.condition.includes("check_id_list")&&"check_id_list"===a?[s("FormItem",{staticStyle:{width:"400px"},attrs:{prop:a,rules:{required:!0,message:" "}}},[s("Select",{attrs:{multiple:"",transfer:"",placeholder:"请"+t},on:{"on-change":function(t){return e.fetchSplitDeliver(!1)}},model:{value:e.form[a],callback:function(t){e.$set(e.form,a,t)},expression:"form[key]"}},e._l(e.checkTasks,(function(t){return s("Option",{key:t.check_id.toString(),attrs:{value:t.check_id.toString()}},[e._v(e._s(t.check_name))])})),1)],1)]:e._e(),e.form.condition.includes("check_detail_status")&&"check_detail_status"===a?[s("FormItem",{staticStyle:{width:"400px"},attrs:{prop:a,rules:{required:!0,message:" "}}},[s("Select",{attrs:{multiple:"",transfer:"",placeholder:"请"+t},on:{"on-change":function(t){return e.fetchSplitDeliver(!1)}},model:{value:e.form[a],callback:function(t){e.$set(e.form,a,t)},expression:"form[key]"}},e._l(e.reviewStatusOptions,(function(t,a){return s("Option",{key:a,attrs:{value:a}},[e._v(e._s(t))])})),1)],1)]:e._e()],2)})),1)],1)],1),s("Alert",{attrs:{"show-icon":""}},[s("Row",[s("Col",{attrs:{span:"10"}},[e._v("本批次数量 "+e._s(e.deliver.deliver_num))]),s("Col",{attrs:{span:"10"}},[e._v("本次拆分数量 "+e._s(e.splitNum))])],1)],1)],1),s("div",{staticClass:"footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{staticClass:"mls",on:{click:function(t){e.visible=!1}}},[e._v("取消")]),s("Button",{staticClass:"mls",attrs:{type:"primary",disabled:!e.splitNum,loading:e.fetchSplitDeliver.isPending},on:{click:e.submit}},[s("span",[e._v("确认拆分批次")])])],1)])},je=[],Oe={props:{task:Object,deliver:Object},data(){return{visible:!0,form:{name:"",condition:[],detail_id_list:"",item_id_list:"",check_id_list:[],check_detail_status:[]},ruleNotEmpty:{required:!0,message:"此项不能为空"},conditionOptions:{detail_id_list:"指定任务明细ID",item_id_list:"指定题目ID",check_id_list:"筛选抽检任务",check_detail_status:"筛选质检结果"},singleConditions:["detail_id_list","item_id_list"],limitIds:5e3,checkTasks:[],reviewStatusOptions:{50:"质检通过",60:"修改通过"},splitNum:0}},mounted(){this.autoName(),this.fetchCheckTasks()},methods:{submit(){this.$refs.form.validate(e=>{if(e)return this.fetchSplitDeliver(!0);this.$Message.error("提交失败，请检查是否有遗漏")})},autoName(){this.form.name=this.deliver.deliver_name+"_1"},changeCondition(e){for(const t of this.singleConditions)if(e.includes(t)){this.form.condition=[t];break}for(const t of Object.keys(this.conditionOptions))this.form.condition.includes(t)||(this.form[t]="string"===typeof this.form[t]?"":[]);this.form.condition.length<=0?this.splitNum=0:this.fetchSplitDeliver(!1)},splitIds(e){var t;if(!e)return[];let s=Object(r["compact"])(e.split(/[\n\s+,，;；、]/g));return(null===(t=s)||void 0===t?void 0:t.length)>=this.limitIds&&(s=s.slice(0,this.limitIds)),s}},asyncMethods:{fetchCheckTasks(){const{task:e,deliver:t}=this,s={task_id:t.task_id,deliver_id:t.deliver_id,team_id:e.team_id||void 0};return Object(L["h"])(s).then(e=>e.data).catch(e=>{console.log(e)})},fetchSplitDeliver(e){const{deliver:t,form:s}=this,a={task_id:t.task_id,source_deliver_id:t.deliver_id,deliver_name:s.name,split:e};return s.condition.length&&(s.detail_id_list||s.item_id_list||s.check_id_list.length||s.check_detail_status.length)?(s.condition.includes("detail_id_list")&&s.detail_id_list&&(a.detail_id_list=this.splitIds(s.detail_id_list)),s.condition.includes("item_id_list")&&s.item_id_list&&(a.item_id_list=this.splitIds(s.item_id_list)),s.condition.includes("check_id_list")&&s.check_id_list.length&&(a.check_id_list=s.check_id_list),s.condition.includes("check_detail_status")&&s.check_detail_status.length&&(a.check_detail_status=s.check_detail_status.map(e=>Number(e))),Object(L["m"])(a).then(t=>{if(t.error&&this.$Message.error("拆分失败"+t.error.message),e)return t&&this.$Message.success(`成功拆分了${t}条数据`),this.$emit("refresh"),this.visible=!1,t;this.splitNum=t}).catch(e=>{console.log(e),this.splitNum=0})):(this.splitNum=0,Promise.resolve())}}},we=Oe,xe=Object(j["a"])(we,Te,je,!1,null,null,null),Ie=xe.exports,Ce=s("ac90"),De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{width:"600",title:"","mask-closable":!1},on:{"on-cancel":function(t){return e.hideModal()}},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"header",attrs:{slot:"header"},slot:"header"},[s("p",{staticClass:"title"},[e._v("复制新批次")]),s("p",{staticClass:"tips"},[e._v("已标注的数据需先添加到批次，再进行质检或交付")])]),s("Form",[s("FormItem",{attrs:{label:"添加方式:",required:!0}},[s("RadioGroup",{model:{value:e.form.waysForAdding,callback:function(t){e.$set(e.form,"waysForAdding",t)},expression:"form.waysForAdding"}},[s("Radio",{attrs:{label:"create"}},[e._v("添加到一个新批次")]),s("Radio",{attrs:{label:"add"}},[e._v("添加到一个已有批次")])],1)],1),s("FormItem",{attrs:{label:"批次名称:",required:!0}},["create"===e.form.waysForAdding?s("Input",{staticStyle:{width:"400px"},model:{value:e.form.deliver_name,callback:function(t){e.$set(e.form,"deliver_name",t)},expression:"form.deliver_name"}}):s("Select",{staticStyle:{width:"400px"},attrs:{clearable:""},model:{value:e.form.deliver_name,callback:function(t){e.$set(e.form,"deliver_name",t)},expression:"form.deliver_name"}},e._l(e.delivers,(function(t){return s("Option",{key:t.deliver_id.toString(),attrs:{value:t.deliver_id.toString(),label:t.deliver_name,disabled:10!==t.status}},[e._v(e._s(t.deliver_name)+" (状态: "+e._s(t.status_name)+")")])})),1)],1)],1),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:function(t){return e.hideModal()}}},[e._v("取消")]),s("Button",{attrs:{type:"primary"},on:{click:e.Submit}},[e._v("确认复制新批次")])],1)],1)},Se=[],Ee={props:{deliver:Object},data(){return{visible:!1,form:{waysForAdding:"create",deliver_name:""}}},watch:{},mounted(){this.fetchDelivers(),this.fetchStatDeliverTask().then(()=>{this.beforeShowModal()})},methods:{async Submit(){try{"create"===this.form.waysForAdding?await this.fetchCreateDeliverTask():await this.fetchAddDeliverDetail()}catch{this.$Message.error("复制新批次失败，请重试")}this.$emit("refresh"),this.visible=!1},hideModal(){this.visible=!1},beforeShowModal(){this.statDeliverTask.range_wait_add_count===this.statDeliverTask.wait_add_count&&0!==this.statDeliverTask.wait_add_count?this.visible=!0:this.$Modal.confirm({title:"提示",content:"<p>当前批次有题目在其他批次，复制失败，可在批次【题目详情】对未入批次题目批量打回返修。</p>"})}},asyncMethods:{fetchStatDeliverTask(){const e={task_id:this.deliver.task_id,deliver_id:this.deliver.deliver_id,type:1,is_range:1},t={};return Object.assign(t,e),se["a"].GetTaskCheckRangeNum(t).then(e=>{const t=e.data.result;return this.isEdit||(this.form.check_num=t.range_wait_add_count),this.statCheck=t,t}).catch(e=>{this.total_num=0,this.form.detail_num=0,this.form.check_num=0,this.$Message.error(e.message)})},fetchCreateDeliverTask(){var e;const t={task_id:this.deliver.task_id,task_type:this.deliver.task_type,add_all:this.deliver.is_single_deliver,deliver_name:this.form.deliver_name,deliver_num:this.statDeliverTask.range_wait_add_count,deliver_id:this.deliver.deliver_id,from:1},s=null===(e=this.$refs.formFilter)||void 0===e?void 0:e.search_params;return s&&Object.assign(t,s),Object(L["c"])(t).then(e=>(this.$Message.success("复制新批次成功"),e)).catch(e=>{this.$Message.error(`复制新批次失败:${null===e||void 0===e?void 0:e.message}，请重试`)})},fetchAddDeliverDetail(){var e;const t={task_id:this.deliver.task_id,deliver_id:this.deliver.deliver_id,auto_add:0},s=null===(e=this.$refs.formFilter)||void 0===e?void 0:e.search_params;return s&&Object.assign(t,s),Object(L["a"])(t).then(e=>(e?this.$Message.success("复制新批次成功"):this.$Message.error("复制新批次失败，请重试"),!0)).catch(e=>{this.$Message.error(`复制新批次失败:${null===e||void 0===e?void 0:e.message}，请重试`)})},fetchDelivers(){const e={task_id:this.deliver.task_id,page:{start:0,size:500,return_total:1},from:0};return se["a"].ListDeliverTasks(e).then(e=>{const t=e.data.result;return this.form.deliver_name=`${this.deliver.task_name}_批次${t.total+1}`,t.data}).catch(e=>{console.log(e)})}}},$e=Ee,Ae=(s("4e40"),Object(j["a"])($e,De,Se,!1,null,"f7759b92",null)),Re=Ae.exports,Le=s("a638"),Fe=s("175d"),Pe=s("bccd"),Me={components:{Deliver:Y,DeliverAddData:me,DeliverSubmit:he["a"],DeliverApprove:_e["a"],DeliverMerge:ge,DeliverSplit:Ie,LinkDynamicTask:Ce["a"],batchStatusRender:Le["a"]},mixins:[k["a"]],props:{task:{type:Object,default(){return{}}},relation:{type:Object,default(){return{}}}},data(){return{userinfo:this.$store.state.userinfo.user,autoAddDeliver:-1,totalCount:0,columnsOptions:{deliver_id:"批次ID",deliver_name:"批次名称",deliver_num:"批次数量",status:"批次状态",checked_num:"已质检",checked_percent:"已质检占比",first_pass_percent:"抽检通过率",pass_percent:"校正后通过率",action:"操作"},delivers:[],deliver:{},page:{index:1,size:10,total:0},fetchOptions:{label:{path:"api/workbench",method:"listDeliverTasks",from:0},receive:{path:"api/deliver",method:"listDeliverTasks",from:1},audit:{path:"api/workbench",method:"listDeliverTasks",from:2}},isSelect:!1,isSelectAll:!1,selection:[],disableDeliverAgain:!1}},computed:{companyInfo(){return this.$store.state.companyinfo},columns(){return Object(r["map"])(this.columnsOptions,(e,t)=>{let s={title:e,slot:t};return"status"===t&&(s.minWidth=20),"action"===t&&(s.minWidth=30),t.includes("selection")&&(s={type:"selection",align:"center",width:60}),s})},isTaskWorking(){var e;return 20===(null===(e=this.task)||void 0===e?void 0:e.task_status)},isDeleteEnabled(){return function(e){const{isLabel:t,isTaskWorking:s}=this;return t&&s&&10===e.status}},businessKey(){var e;if(null===(e=this.project)||void 0===e||!e.business_config)return!1;try{var t;const e=JSON.parse(null===(t=this.project)||void 0===t?void 0:t.business_config);return!!e.mistake_error_config}catch(s){return!1}}},watch:{isSelect(){this.isSelect?this.columnsOptions={selection:"",...this.columnsOptions}:(this.selection.length>0&&(this.selection=[],this.$refs.delivers.selectAll(!1)),this.$delete(this.columnsOptions,"selection"))}},mounted(){var e;this.refresh(),this.fetchProject(),(null===(e=this.task)||void 0===e?void 0:e.template_id)&&this.fetchTaskTemplate()},methods:{refresh(){this.selectDeliver("",!1),this.fetchDelivers().then(()=>{var e;const t=null===(e=this.$route.query)||void 0===e?void 0:e.deliver_id;t&&this.changeDeliver("string"===typeof t?t:t.toString())}),this.isWorkbench&&(this.isLabel&&this.isTaskWorking&&this.fetchAutoAddDeliver(),this.fetchStatTask())},changePage(e){this.page.index=e,this.fetchDelivers().then(()=>{this.isSelect&&(this.isSelectAll?this.$refs.delivers.selectAll(!0):Object(r["map"])(this.selection,e=>{Object(r["forEach"])(this.delivers,t=>{if(t.deliver_id.toString()===e.deliver_id.toString())return this.$set(t,"_checked",!0),!1})}))}).catch(e=>{console.log(e),this.$Message.error("列表数据获取失败，请刷新重试")})},changePageSize(e){this.page.size=e,this.changePage(1)},goDeliver(e){this.selectDeliver("",!1);const{task:t}=this;this.$router.push({params:{task_id:t.task_id},query:{...this.$route.query,deliver_id:e.deliver_id.toString()}}),this.changeDeliver(e.deliver_id.toString())},deleteDeliver(e){this.$Modal.confirm({title:"确定要删除这个批次吗？",content:"删除批次后，批次已质检数据也将同步删除",loading:!0,onOk:async()=>{const t=await this.fetchDeliver(e),s=()=>{this.$Modal.remove(),this.refresh(),this.$emit("update")};if(t)if(this.isDeleteEnabled(t)){const t=await this.fetchDeleteDeliverTask(e);t?s():this.$Modal.remove()}else this.$Message.error("删除失败，批次当前状态无法删除"),s();else this.$Message.error("删除失败，批次已失效"),s()}})},changeDeliver(e){this.deliver={};const t=this.delivers.find(t=>t.deliver_id.toString()===e);t?(this.$route.query.deliver_id!==e&&this.$router.replace({query:{...this.$route.query,deliver_id:e}}),this.deliver={...t,deliver_id:t.deliver_id.toString()}):this.$Message.error("没有找到相关的交付批次")},goBack(){this.$router.replace({query:{...this.$route.query,deliver_id:void 0,type:void 0}}).then(()=>{this.deliver={},this.fetchDelivers()})},addDataToDeliver(e){const t=this;this.$FastModal.show(me,{type:e,task:t.task,useDeliverLen:t.delivers.filter(e=>70!==e.status).length},{refresh(){t.refresh(),t.$emit("update")}})},submitDeliver(){const e=this;this.$FastModal.show(he["a"],{task:e.task,deliverId:e.deliver.deliver_id,isAudit:20===e.deliver.status,disabled:!this.isAudit,isWorkbench:this.isWorkbench},{refresh(){e.refresh(),e.$emit("update")}})},setAutoAddData(e){this.$Modal.confirm({title:"确定要取消自动添加吗？",content:"取消后可以重新选择自动添加或手动添加数据",onOk:()=>{this.fetchSetAutoAdd(e)}})},approveDeliver(e,t){const{task:s,deliver:a,isWorkbench:i,isSelectAll:r,isSelect:l}=this,n=this;this.$FastModal.show(_e["a"],{task:s,approveResult:e,selection:t||[a],isSelectAll:r,isSelect:l,fetchPath:Number(!i),status:a.status},{refresh(){var e;n.refresh(),null===(e=n.$refs.deliver)||void 0===e||e.fetchDeliver(),n.$emit("update")}})},exportTaskResult(){const e={task_id:this.task.task_id};Object(Fe["n"])(e)},exportErrorReason(){const e={deliver_id:this.deliver.deliver_id};Object(Fe["h"])(e)},exportDeliverResult(){if(this.deliver.deliver_id){const e={task_id:this.task.task_id,deliver_id:this.deliver.deliver_id};Object(Fe["n"])(e)}},selectDeliver(e,t){t?this.selection=e:(this.isSelect=!1,this.isSelectAll=!1,this.selection=[])},mergeDeliver(e){const t=this;this.$FastModal.show(ge,{task:t.task,selection:t.selection,isAll:t.isSelectAll,detailStatus:e},{refresh(){t.refresh(),t.$emit("update")}})},selectAll(e){this.isSelectAll=e,this.$refs.delivers.selectAll(e),this.$Message.success(e?`已选中全部 ${this.page.total} 个批次`:"已取消全选")},splitDeliver(e){const t=this;this.$FastModal.show(Ie,{task:t.task,deliver:e},{refresh(){t.refresh(),t.$emit("update")}})},linkLabelGroupTask(){const e=this;e.$FastModal.show(Ce["a"],{type:"next",projectId:e.task.project_id,deliver:e.deliver,lastTask:e.task},{refresh(){e.refresh()},goEditFormalTask(){var t;const{task:s}=e,a=e.$router.resolve({name:"create-formal-tasks",params:{id:s.project_id},query:{task_id:null===(t=s.parent_task_id)||void 0===t?void 0:t.toString(),status:s.task_status}});window.open(a.href,"_blank")}})},handleCopyNewBatch(e){const t=this;this.$FastModal.show(Re,{deliver:e},{refresh(){t.fetchDelivers()}})},downloadAllTask(){this.fetchDownloadTask(this.task)}},asyncMethods:{fetchDelivers(){var e;const{task:t,page:s,fetchOptions:a,isWorkbench:i,isLabel:l,isAudit:n}=this;let o="";n?o="audit":l?o="label":i||(o="receive");const c={task_id:t.task_id,page:{start:(s.index-1)*s.size,size:null!==(e=this.$route.query)&&void 0!==e&&e.deliver_id?500:s.size,return_total:1},from:a[o].from};return Object(b["c"])(a[o].path,a[o].method,c).then(e=>(this.page.total=e.total,Object(r["map"])(e.data,e=>{i&&10!==e.status&&this.$set(e,"_disabled",!0),!i&&30!==e.status&&this.$set(e,"_disabled",!0)}),e.data)).catch(e=>{console.log(e)})},fetchDeliver(e){const{task:t,fetchOptions:s,isWorkbench:a,isLabel:i,isAudit:r}=this;let l="";r?l="audit":i?l="label":a||(l="receive");const n={task_id:t.task_id,deliver_id:e.deliver_id,page:{start:0,size:1,return_total:0},from:s[l].from};return Object(b["c"])(s[l].path,s[l].method,n).then(e=>e.data[0]).catch(e=>{console.log(e)})},fetchStatTask(){const e={task_id:this.task.task_id,type:1};return Object(L["n"])(e).then(e=>{this.totalCount=e.wait_detail_count})},fetchAutoAddDeliver(){const e={task_id:this.task.task_id};return Object(L["e"])(e).then(e=>e).catch(e=>(console.log(e),-1))},fetchSetAutoAdd(e){const t={task_id:this.task.task_id,deliver_id:this.autoAddDeliver,auto_add:Number(e)};return Object(L["l"])(t).then(e=>{e?this.$Message.success("已取消自动添加"):this.$Message.error("取消失败"),this.refresh(),this.$emit("update")})},fetchDeleteDeliverTask(e){const t={task_id:this.task.task_id,deliver_id:e.deliver_id};return Object(L["d"])(t).then(e=>(this.$Message.success("删除成功"),e)).catch(e=>{console.log(e),this.$Message.error("删除失败")})},fetchTaskTemplate(){const e={template_id:this.task.template_id};return Object(ae["k"])(e).then(e=>e).catch(e=>(console.log(e),null))},fetchProject(){console.log();const e={project_id:Object(Pe["BigNumber"])(this.task.project_id)};return Object(v["i"])(e).then(e=>e).catch(e=>{this.$Message.error("查询失败："+e.message)})},fetchDownloadTask(e){let t="";const s={projectId:this.task.project_id,taskId:e.task_id,deliverId:this.deliver.deliver_id};_.forIn(s,(e,s)=>{t=t?`${t}&${s}=${e}`:`${s}=${e}`}),this.$FastModal.show(u["a"],{title:this.task.task_name,obj:e,objType:"task",jqueryPre:t,projectId:this.task.project_id,project:this.project},{})}}},Ne=Me,Be=(s("e864"),s("cab9"),Object(j["a"])(Ne,a,i,!1,null,"4b850298",null));t["a"]=Be.exports},f558:function(e,t,s){"use strict";s.d(t,"c",(function(){return l})),s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return o}));var a=s("dde5");const i=e=>Object(a["e"])(r,"IsGray",e).catch(()=>({is_gray:!1})),r="qlabel.Dataset",l=e=>Object(a["c"])("api/datahouse","finishUpload",e),n=async e=>{const{is_gray:t}=await i({method:"AppendTaskToDataset",dataset_import_id:e.dataset_import_id});if(t){const t={import_task_id:e.dataset_import_id};return Object(a["e"])("qlabel.Dataset","FinishImportTaskUpload",t)}return Object(a["c"])("api/datahouse","finishUpload",e)},o=e=>Object(a["c"])("api/attachment","completeUpload",e)},f7aa:function(e,t,s){"use strict";s("f8b2")},f8b2:function(e,t,s){},f916:function(e,t,s){},fb88:function(e,t,s){}}]);