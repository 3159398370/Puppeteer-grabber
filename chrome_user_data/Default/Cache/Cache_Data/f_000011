(function(e){function t(t){for(var i,a,r=t[0],l=t[1],c=t[2],d=0,u=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&u.push(o[a][0]),o[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);h&&h(t);while(u.length)u.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],i=!0,a=1;a<s.length;a++){var r=s[a];0!==o[r]&&(i=!1)}i&&(n.splice(t--,1),e=l(l.s=s[0]))}return e}var i={},a={index:0},o={index:0},n=[];function r(e){return l.p+"static/js/"+({"admin-group~dataview-group~main-group~workbench-group":"admin-group~dataview-group~main-group~workbench-group","admin-group":"admin-group","dataview-group~main-group~workbench-group":"dataview-group~main-group~workbench-group","dataview-group~main-group":"dataview-group~main-group","dataview-group~workbench-group":"dataview-group~workbench-group","dataview-group":"dataview-group","main-group~workbench-group":"main-group~workbench-group","main-group":"main-group","workbench-group":"workbench-group","base-group":"base-group","company-group":"company-group","project-group":"project-group"}[e]||e)+"."+{"admin-group~dataview-group~main-group~workbench-group":"bd4ab0bc","admin-group":"11181ba2","dataview-group~main-group~workbench-group":"1c1e0840","dataview-group~main-group":"c2bebec2","dataview-group~workbench-group":"846da3ff","dataview-group":"6897b536","main-group~workbench-group":"9e2ba6a1","main-group":"26153b60","workbench-group":"f152af87","base-group":"92d9335c","chunk-2d0b305d":"16a67de6","chunk-76d6a780":"884d4262","company-group":"f1d92858","project-group":"cc24b9fb"}[e]+".js"}function l(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,l),s.l=!0,s.exports}l.e=function(e){var t=[],s={"admin-group~dataview-group~main-group~workbench-group":1,"admin-group":1,"dataview-group~main-group~workbench-group":1,"dataview-group~main-group":1,"dataview-group~workbench-group":1,"dataview-group":1,"main-group~workbench-group":1,"main-group":1,"workbench-group":1,"base-group":1,"chunk-76d6a780":1,"company-group":1,"project-group":1};a[e]?t.push(a[e]):0!==a[e]&&s[e]&&t.push(a[e]=new Promise((function(t,s){for(var i="static/css/"+({"admin-group~dataview-group~main-group~workbench-group":"admin-group~dataview-group~main-group~workbench-group","admin-group":"admin-group","dataview-group~main-group~workbench-group":"dataview-group~main-group~workbench-group","dataview-group~main-group":"dataview-group~main-group","dataview-group~workbench-group":"dataview-group~workbench-group","dataview-group":"dataview-group","main-group~workbench-group":"main-group~workbench-group","main-group":"main-group","workbench-group":"workbench-group","base-group":"base-group","company-group":"company-group","project-group":"project-group"}[e]||e)+"."+{"admin-group~dataview-group~main-group~workbench-group":"f59582f5","admin-group":"fc81083b","dataview-group~main-group~workbench-group":"e415cf91","dataview-group~main-group":"152699b5","dataview-group~workbench-group":"61195d71","dataview-group":"5514a1ee","main-group~workbench-group":"cb474370","main-group":"e88ab8c1","workbench-group":"dec72793","base-group":"8b6f9d1e","chunk-2d0b305d":"31d6cfe0","chunk-76d6a780":"f151db24","company-group":"7f825b72","project-group":"af4a38fd"}[e]+".css",o=l.p+i,n=document.getElementsByTagName("link"),r=0;r<n.length;r++){var c=n[r],d=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(d===i||d===o))return t()}var u=document.getElementsByTagName("style");for(r=0;r<u.length;r++){c=u[r],d=c.getAttribute("data-href");if(d===i||d===o)return t()}var h=document.createElement("link");h.rel="stylesheet",h.type="text/css",h.onload=t,h.onerror=function(t){var i=t&&t.target&&t.target.src||o,n=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");n.code="CSS_CHUNK_LOAD_FAILED",n.request=i,delete a[e],h.parentNode.removeChild(h),s(n)},h.href=o;var p=document.getElementsByTagName("head")[0];p.appendChild(h)})).then((function(){a[e]=0})));var i=o[e];if(0!==i)if(i)t.push(i[2]);else{var n=new Promise((function(t,s){i=o[e]=[t,s]}));t.push(i[2]=n);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=r(e);var u=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(h);var s=o[e];if(0!==s){if(s){var i=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+i+": "+a+")",u.name="ChunkLoadError",u.type=i,u.request=a,s[1](u)}o[e]=void 0}};var h=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return Promise.all(t)},l.m=e,l.c=i,l.d=function(e,t,s){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(l.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)l.d(s,i,function(t){return e[t]}.bind(null,i));return s},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var h=d;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("76ab")},"000e":function(e,t,s){"use strict";s("6ec8")},"01a1":function(e,t,s){e.exports=s.p+"static/img/pointOn.95d2ec4c.svg"},"028d":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADJCAYAAABmBH07AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAyKADAAQAAAABAAAAyQAAAACmOxQlAAAMYElEQVR4Ae2dYYxcVRXHO5QtUAWEkmqg0pAWkS9FTSiCKCZgjBEjxUiqJopEjFFrjLViI6ImGmKoMYpNozUifkA0SsIHoiASo0aqoC2iUg1iDZYGF4pS2oYu7fg/y+6y2+nWudM77953zu8mh9l588695/8797/v7cyQduZMG91u90w9/bTiYsWpihFFm8aYit2uuEdxfafTebhNxbe1Vu2bxard9s0litMU8xRtGrZvHlPYvvlyz76RwI5ilWK3wsswLR9VdNrUqbbVKr5XK55WeBkz9s345pGyVWrM19vWnD7rXaXfCN/o81xOSyCgffMBnb4xIaVNp35M++ZGu3IsUdV/VMxvU/UJte7Ruef0XDYTJuDUXgLaN6fr6IOKE3pfdXHE9s2yo/SftQqv5rBOmTa7P2bkJXCNpvNqDiNl+2atXUEe0Q9n2BHHY5uuIN41Nto+7ZutWvCsRhdtfrFtZpBntW7b3nVIRfWsDHJsahLnz05A++a/etXzFcTEj9ktVtveyrXCU4c1k5GXQASmI2aQCOO+CCIb1hiCaRSDrG9480RYbkMEkREM8l39/fGTCM1sUqOY3q31vtXkmiXWsj/SD2hhr582/1TaVqqZEe6XG98/2jvHa9FbFJc2vnhDC3q9guwQv6tljLdgjuHtJLHdpXibVni/wr7L5G4MegVZIxIPVUhjn2qyRv1FjetWWJ/bknQ1sbuQsxW1flnRvoj71eQG2C2WInVckLwQCRAoSEAb/NzUTW7ne73FKtgKlvZEAIN46iZashPAINmRMqEnAhjEUzfRkp0ABsmOlAk9EcAgnrqJluwEMEh2pEzoiQAG8dRNtGQngEGyI2VCTwQwiKduoiU7AQySHSkTeiKAQTx1Ey3ZCWCQ7EiZ0BMBDOKpm2jJTgCDZEfKhJ4IYBBP3URLdgIYJDtSJvREAIN46iZashPAINmRMqEnAhjEUzfRkp0ABsmOlAk9EcAgnrqJluwEMEh2pEzoiQAG8dRNtGQngEGyI2VCTwQwiKduoiU7AQySHSkTeiKAQTx1Ey3ZCWCQ7EiZ0BMBDOKpm2jJTgCDZEfKhJ4IYBBP3URLdgIYJDtSJvREAIN46iZashPAINmRMqEnAhjEUzfRkp2AGWSQfw12kJzsxTMhBBIIDLRnzSBPJiwyeerOyR94hEBLCAyyZ3eaQbYkCnxa5z+SmMPpEChN4J8qINUkm49W0kbFmxKqv7nT6YwlnF/9qfrnsI9RkacoOtUXO/wC92mJUfV4oFuS4Zc32ArSs199vknZqxNm2Di+IZR4m5JW9JH4D52zTIs908e51Z4ivS9RcVcoLlMsVyxQMF4gYL8A/6W4S/Fj9ftnL7zU3p/U9/mq/gHF0j5U3C7dtj/0V3q3u1DxO8Xhxna9eF4fE1d7iuofUaxW7FQw+ifwW516YbWNTShMOs5VPPp/pN+v1182Y1odmKv4jGK3Yvp4Tk++pzhpRkLLnqj+BYpfKBiDEbBblDUta/shy5WOExU3KWxvTx+2969V2J8e46PnnlsvHqdXXqswB/1HcZ8uNU/osbVDmk5W8fcqXtFaEfUUfoP2w6fqKWfwSrQv7NbabrHtl/8OxSZp26vHqdFjkKlXnPwgCHMl5U7FxU4k1SDjSm2km2soZNg1RDDIhwRxw7BBBpt/l/QukUlGvet2/VUTXT3sXYvPeW9iAX3Ha81rC6zb+JKuDSKalypmvhvROGK3C75Xv4BG3KqbEObdIG/33sCC+uyzpIsKrt/I0t4N8ppGKMZdxD1f7wY5Ne7ebUS5e75uDTLx9u4JjWyTuIvY50uuh1uDqGvu38KuYGe6Zzz1kXoFsGspYaUK2VpLMQ3WcY3WeleD67ViKQzS26a/6QMw+8ZnqKFb0lZ/nWhYzfJ8izUsZswbiAAGCdRspKYTwCDpzMgIRACDBGo2UtMJYJB0ZmQEIoBBAjUbqekEMEg6MzICEcAggZqN1HQCGCSdGRmBCGCQQM1GajoBDJLOjIxABDBIoGYjNZ0ABklnRkYgAhgkULORmk4Ag6QzIyMQAQwSqNlITSeAQdKZkRGIAAYJ1GykphPAIOnMyAhEAIMEajZS0wlgkHRmZAQigEECNRup6QQwSDozMgIRwCCBmo3UdAIYJJ0ZGYEIYJBAzUZqOgEMks6MjEAEMEigZiM1nQAGSWdGRiACGCRQs5GaTgCDpDMjIxABDBKo2UhNJ4BB0pmREYgABgnUbKSmE8Ag6czICEQAgwRqNlLTCWCQdGZkBCKAQQI1G6npBDBIOjMyAhHAIIGajdR0AhgknRkZgQhgkEDNRmo6AQySzoyMQAQwSKBmIzWdAAZJZ0ZGIAIYJFCzkZpOAIOkMyMjEAEMEqjZSE0ngEHSmZERiAAGCdRspKYTwCDpzMgIRACDBGo2UtMJYJB0ZmQEIoBBAjUbqekEMEg6MzICEcAggZqN1HQCGCSdGRmBCGCQQM1GajoBDJLOjIxABDBIoGYjNZ3A0ekp7jPO73a7C92r7BV4eu8hjmCQ3j2wvvcQR6IS8HyL1Y3a1AZ1H2hwrSJLuTVIp9PZL6JPFaEaZ9EnvEt1a5CJxj3mvYGF9W0vvP7Ql/dukHuHTjD2Apu8y/dukNu9N7Cgvse1NgYp2IAcS9+pSf6eYyLm6CHwTf2d5/6P9E6PbGcH9JnGSkn6vjNZpeX8WwUslUF2lS5k2Ot7v8WaoybeKogWjDwE7KpxZQRzGC73VxATqavIcXr4ueJ8e844IgIflzm+dkQzFE7WfrB9f5biDMUzir9Kk10Ve0aPQZR8ps56veLlilHFZiW3/t2gCZN8R3rslouRTmCvUq7SXmj11Vj74IPS8UmF7fPJYVfFOxTXSd+WyYMzHpW4SHGH4oDi4LFFB143I6GlT6TjnYqHDxbI88MS+JFenb6hWtd91T9PcethVXa7e/T6FdPFjV9BdHCZDt6leOn0Fw/6eUzP3yeHtf4PXukdkZZLFCsUyxWnKU5RMObMsT7vUGxT2J64TT1/SI+tHur5OglY3YeIfTrnvKkriRLnK7Yq+hm7ddLZfSzCKRCohoD27CsVh7ozmm3P/3qqeJ3xkdnOmuV4668gU+L5IQQB7eMvzrKXD3d4icGxt3nfnUjpMs06PzGH0yFQksCrB1j8VZZjBlmamHyszl+UmMPpEChJ4KQBFj/ZcswgCwZNHiCPFAiUIGBvyqSO8f+Z0AxikToGyUldg/MhUJwAG714CyigZgIYpObuUFtxAhikeAsooGYCGKTm7lBbcQIYpHgLKKBmAhik5u5QW3ECGKR4CyigZgIYpObuUFtxAhikeAsooGYCGKTm7lBbcQIYpHgLKKBmAhik5u5QW3ECGKR4CyigZgIYpObuUFtxAhikeAsooGYCGKTm7lBbcQIYpHgLKKBmAhik5u5QW3ECGKR4CyigZgIYpObuUFtxAhikeAsooGYCGKTm7lBbcQIYpHgLKKBmAhik5u5QW3ECGKR4CyigZgIYpObuUFtxAhikeAsooGYCGKTm7lBbcQIYpHgLKKBmAhik5u5QW3ECGKR4CyigZgIYpObuUFtxAhikeAsooGYCGKTm7lBbcQIYpHgLKKBmAhik5u5QW3EC4/+S5wBVLNa/lb5zgLxhp4xpgR2dTmfPsBdi/ucJaB+8Qz+tUNg/J/7i549W998lg1Y0qEFuGXTBBvIOqGmbtM5nZZR7Glgv5BJivEjCv614s2cAHm+xTNMFirvVxPWKeZ4bWEKbmC7Uur9XuDaHsfVoENNlo6P4sOIL9oSRlcAGzWYmcT88G2SyeWv0G2/55BMej4yAWL5BM1x+ZLO0JzuCQeaqHZ9oT0uqr/St1VeYscAIBjFcF2ZkFn2qxZEAmEGeCyB4QQCNTUnc29RChdd5ytY3gzxeuJAmlh9tYpEga/wpiM4HTacZ5FcBBEfQ2FQbf6iFvH8Qe78+Q/uzATWDrFN4vs0ybV9RMDIQ0MZ5VNOszTBVrVPsU2FXTRZ3lAT/QU+unzzg8PFLExodSism6Uat/INiqw9vYfuq0irtl/Hbq6ll9N72iGKdYr/CyzAtNyhGpoTyQ1YCYvsexZMKD2OzRJxzMCD7tHlq6AR7O/TziosUg35PS6lFh/0W+KXiOv0m+E3RSgIsrj1zjGS+UWFfVnyRok2jq2LtDZwHtFc2H6rwGQaZPEGizRz2VYK2/fa1+8dRifX8N9Vkm3hsgMD/AOqsoFi3FHzLAAAAAElFTkSuQmCC"},"0356":function(e,t,s){},"04d4":function(e,t,s){},"04f9":function(e,t,s){},"0679":function(e,t,s){},"070c":function(e,t,s){"use strict";s("648b")},"0738":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAjCAYAAADxG9hnAAAABmJLR0QA/wD/AP+gvaeTAAAEqElEQVRYhcWXTWxUVRTH/3dCO5AgNEiBIhslfLhhoRBIQ4RIkLohEhyJIIuyalKK0o2gILYQWKHIl8alhgidGKPEaKIpGGNAYNBQ+QgGSIBOaevQUgZsmXR+Lt558PqYodORhpNM7nvnno//O+fcc88ImAbsAMr1JAnYjkctwIQnCaTcQAwKBogCVcCnwAmgA7hnvw7j7TeZaLFgzhiY80BFaH+yOe+hcLplOhX5/BYMBhgJbAPuGD8LnAI2A/OBiUCJ/SYa7wMgEQCUBhqBkQWD+WTfl5VtNzrSZuBv4HQAwCFg+hA+bAbQZLoAxwqOzvKVtc3VNRtobb3RF/iiK8Ccgr/mYUBzgUtm6xowK5dcZMBLJrLizp1/z2/auqs02dbhszOSrhcLxDn3u6Q5kpolTZH0A/DMYOhH3bzZnVj/7naqazbQmrzRG6yZYsGY7VLgSCBN+WvGCpOurluXY2+tO1tds4HrrY8VzPhAmhqCe5GA0GRJ6yVRVjZmhfpY2NOTbtm8dVe0NdneJ2mmpOb/A8Y594+kVZKQVA9MyoX2M0N6yOfFYnXly1euPTMMkYmbrX3hjSheA8qGj+hwgAFmmq9uoDS48ao5OJlLcZjA+D1qifSgRpba+l0OhaebmnbXv7Jg/rIcNXPaBwOMAKqt8X0P7ASmPgLLtyHfEt5lBTA/B5CpFsYvBkQm2X4vEJkp5vwgsAR4EVgHJIHKPBF5yfSPB5mdxpyYB8hF4GcgFgSTbOvoN7024BfAhXQXG9BIDrsVptsuPUjNGFu78oQxK6la0o6mpt0lkYxb1NeXufR+w0cRS9MkSc/Zep+ccz9JcpKezWHzpq1jg+j8u6U0LG0RuWDPq4AfAZdInK2qXd+Q9jpwu3+x5RohDvsFGeJHTac3yBwsNRcC7weBWmBeKtV9PE/NVATkfwNm57CbMzWXbZ2WI4RhqpX0jqQZ48aNzUQyblHJiBGpzY0fl4Q7MN60N13ShRx2fF+Xg0AStr48GArnXEpSnaSdkhSP7+l8fWlV1VOjR2dCR/uopAOSPnfOpYFRwGsBU76vxH0O3owJkFCIwqkJ8PcDv/rvicRfS9bWN94NnaZO7MoHXgBSwGh7/9NkFgeNBlv8jMGiko9isbryN1a/fS7fCOEfb+B527vf4iOS5JzrkxdGJ2lrsUDi8T2d9GYX9PSkWzY1PnxrO+cw0W22HnDO3RtgxIorbVGZWywY6dF3E1BpPm6TawwwMI2mdAkYPwxgLgJX7XlLXmW8vw/HTPAIUPK4wARqBuAkoT9gA+4A51yvpGWSrklaKC+3Rf8Njcf3dEYyblE6fffcpsZd0cBAXiZp3KAGgFl4o7+fpnnFggEqu7puXQ0M5P51Utg8Y4XlpymLN94VfLTxprCvTZdUqvuEf7SHPFxZzTTYafLpNLAFb56YZD0oas8LgA+BPwLyt00+6tfMmpqNtCbbfTCHC/04mZN9eA2oUOoG9hK6SJetrpmw/M21LWtqNtJy9mJXf39/veQ1sKEAKpVXxEslzZY3Z5TZdrekK5JOyRs5jz7UrIxisbrybCmHs1m9981Xe5uHgmE4aEAQ/gNRtSItiNxV7gAAAABJRU5ErkJggg=="},"0747":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAA0tJREFUaEPtmd2LTlEUxp/nj+DaNeWOKxf8D2aSSL4SiUQ+w0w0mUTyNZLxFYkppZSUIlEiJUIpkVIipZSUsr3PtPe0nTkfe5y1R1PvuZnmfc+7zu9Za+21116HmOIXpzg/ugL+dwS7EehGoKUHklLIOTcbwDwA01o+L/XnXwA8IPm86QeNApxzfQD2RoY+A5jeZNjo+36Sen7lVSvAOTcHwGMA7wEMARj0lkY6Ik7W2J3vRb8GsK5BzHEAswBc88/Q7TP87/V3LsknVTaaBKwAMAxgJ4CBAE+yt8pgFLE3ABaSfFF2r3NupocW/FWSi+L7IjsrSZ79VwEK3zLvEdkYSYR/6+GfJcBfIbm4eJ9zTlG8C6A2jZoioNwPOZgK/w5AD8mnCfCXSS6puM9UQCr8B+/50pwtpM0lkktrUlFroscqAgtI3qvwVKhSHz38owTPXySp1Cy9OkIDvL43SaFSAdFC++ThHybAnye5PAH+pa9OeQRE8Np0VG3uJ8CfI6nK1uR5wa+3XMR/RSCC/+oXrKrFuKuQ88MkVyXCq0xrszSrQmMCIvhvHv5OAvwZkqtT4Tul+pV1GR0VEMF/9/C3E+BPk1wzEXjday4AQGgPfvicv5UAf4rk2onC5xDQ73uTn97zNxPgh0hW9kFRqdSC7VXaxDatIyDbvzz8jQT4EyRVRVKqzTj4HBH47eGvJ8AfI7mhDbwXoF1YG1ofSWVA6ZXaC8lLaqGbSuVRkhsN4WWqlYDQJlTtxHFLfITkJmP4fAIKm9RhkpuN4UPhsI9AAf4QyS0Z4NU8aie2FVCAP0hyqzW8zsFRGbUTUIAfJLndGH4M1lxA53CuaYTKms6wB0juyAVf2AdsIgAgTA8GSO7KCZ9DQDhc7Ce52xi+9MBinUJi3kdyz2TA54hA7bGuqTELop1zoT3QR6k2bdZAzaE+HMBLu8qW8Pl2Yh/m3PAaaV6om482NXNhtDgu3JnTRv4J48xWo8V4uKveRB7RpYOK8jlMD6rWtsbxitJozndOdaWzpYJN/bsNgE5y7Ya7Pk2K4/UqWIvPi6P7duP1aAGGFxyT9V5AQmxecFi4NaeNxjc0OR9uYbsrwMKLbWx0I9DGexa/nfIR+AMtjKlPmVtP3gAAAABJRU5ErkJggg=="},"074b":function(e,t,s){},"079a":function(e,t,s){},"07b4":function(e,t,s){},"094d":function(e,t,s){e.exports=s.p+"static/img/scale.08a4af0a.svg"},"0af0":function(e,t,s){"use strict";s("2256")},"0c36":function(e,t,s){"use strict";s("781f")},"0c3b":function(e,t,s){"use strict";s("167e")},"0ca0":function(e,t,s){},"0d58":function(e,t,s){e.exports=s.p+"static/img/hand.8b2ce7a6.svg"},"0d5b":function(e,t,s){},"0d8d":function(e,t,s){"use strict";s("888c")},"0ebb":function(e,t,s){},1:function(e,t){},"103f":function(e,t,s){},"12f7":function(e,t,s){"use strict";s("32ab")},"13c2":function(e,t,s){"use strict";s("a4f4")},"13c8":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.fitting?s("span",[s("span",{staticClass:"fitting"},[e._v(e._s("average"===e.fitting.type?"平均值: "+e.returnFloat(e.fitting.value||e.tag.value,2)+"  分差: "+e.returnFloat(e.fitting.score):"置信度: "+e.returnFloat(e.fitting.score)+"%"))])]):e._e()},a=[],o=s("9ec3"),n={props:{name:String,answer:{type:Object},multipleTag:{type:String,default:""}},computed:{fitting(){var e,t,s,i,a;let n=(null===(e=this.answer)||void 0===e?void 0:e.tags)||[];var r;null!==(t=this.answer)&&void 0!==t&&t.objects&&Object(o["forEach"])(null===(r=this.answer)||void 0===r?void 0:r.objects,e=>{Object(o["isArray"])(null===e||void 0===e?void 0:e.tags)&&(n=[...n,...null===e||void 0===e?void 0:e.tags])});const l=null===(s=n)||void 0===s||null===(i=s.find(e=>e.name===this.name))||void 0===i?void 0:i.fitting;var c;return(null===(a=this.multipleTag)||void 0===a?void 0:a.length)>0?null===l||void 0===l||null===(c=l.values)||void 0===c?void 0:c.find(e=>e.tag===this.multipleTag):l},tag(){var e;const t=(null===(e=this.answer)||void 0===e?void 0:e.tags)||[];return null===t||void 0===t?void 0:t.find(e=>e.name===this.name)}},methods:{returnFloat(e,t=1){const s=Object(o["isString"])(e)?parseFloat(e):e;return isNaN(s)?0:s.toFixed(t)}}},r=n,l=(s("da67"),s("2be6")),c=Object(l["a"])(r,i,a,!1,null,"6fc25a44",null);t["a"]=c.exports},"14f5":function(e,t,s){},"166a":function(e,t,s){"use strict";s("074b")},"167e":function(e,t,s){},"17e7":function(e,t,s){"use strict";s("ff86")},"18e5":function(e,t,s){},"1a9c":function(e,t,s){"use strict";s("2aa8")},"1cfb":function(e,t,s){},"1d30":function(e,t,s){},"1f41":function(e,t,s){"use strict";s("3df2")},"1f59":function(e,t,s){},"1fba":function(e,t,s){},2:function(e,t){},"203f":function(e,t,s){"use strict";s("e839")},2050:function(e,t,s){},2085:function(e,t,s){"use strict";s("f3a8")},2256:function(e,t,s){},"22cd":function(e,t,s){},"22fb":function(e,t,s){},"231d":function(e,t,s){},"234e":function(e,t,s){"use strict";s("93d2")},2449:function(e,t,s){},"25df":function(e,t,s){"use strict";s("103f")},"26ef":function(e,t,s){},"27a6":function(e,t,s){"use strict";s("5a6e")},"27ea":function(e,t,s){},"27f8":function(e,t,s){},"28af":function(e,t,s){e.exports=s.p+"static/img/small.21f9758e.png"},"28bd":function(e,t,s){},"2a0e":function(e,t,s){"use strict";s("cb88")},"2a91":function(e,t,s){"use strict";s("2449")},"2aa8":function(e,t,s){},"2c91":function(e,t,s){"use strict";t["a"]={inject:["$optimus"],props:{$renderedComponentConfig:Object}}},"2d15":function(e,t,s){},"2e78":function(e,t,s){"use strict";s("a8e7")},3:function(e,t){},"301b":function(e,t,s){"use strict";s("7a10")},3043:function(e,t,s){},"31a2":function(e,t,s){},3216:function(e,t,s){"use strict";s.d(t,"c",(function(){return c})),s.d(t,"b",(function(){return d})),s.d(t,"a",(function(){return u}));s("8d0d");var i=s("8206"),a=s.n(i),o=s("9ec3"),n=s.n(o),r=s("9c3a"),l=s.n(r);const c=a.a.create({timeout:6e4}),d=a.a.create({timeout:12e4,method:"post",maxRedirects:0,headers:{"X-Requested-With":"XMLHttpRequest"},transformResponse(e){let t={};try{t=l.a.parse(e)}catch(s){console.error("transformResponse error",e,s)}return t}});d.interceptors.request.use(e=>{const t={jsonrpc:"2.0",method:"noop",id:(new Date).getTime()+n.a.random(1e3,9999)};return e.data=Object.assign(t,e.data),e},e=>Promise.reject(e)),d.interceptors.response.use(e=>{if(n.a.has(e.data,"result"))return Promise.resolve(e);if(e.data.error){const{error:t}=e.data;if("string"===typeof t.message){const e=t.message.indexOf(":");t.message=t.message.slice(e+1)}return Promise.reject(t)}return Promise.reject({message:"服务器内部错误：响应格式错误"})},e=>e.message.includes("timeout")?Promise.reject({message:"网络超时"}):Promise.reject({message:"服务器内部错误，请稍后重试"}));const u=(e,t,s)=>d({url:`${e}/${t}`,data:{method:t,params:s}}).then(({data:e})=>e.result);a.a},3257:function(e,t,s){},"32ab":function(e,t,s){},"33f6":function(e,t,s){},3732:function(e,t,s){"use strict";var i=s("3216");const a=e=>Object(i["b"])({timeout:6e4,url:"api/helper/executeService",data:{method:"executeService",params:e}}).then(({data:e})=>e.result),o=e=>Object(i["b"])({timeout:12e4,url:"api/workbench/askGpt",data:{method:"askGpt",params:e}}).then(({data:e})=>e.result),n=e=>Object(i["b"])({timeout:6e4,url:"api/workbench/textCorrect",data:{method:"textCorrect",params:e}}).then(({data:e})=>e.result),r=e=>Object(i["a"])("api/workbench","searchEnhanceApi",e),l=e=>Object(i["b"])({timeout:6e4,url:"api/workbench/sandboxRun",data:{method:"sandboxRun",params:e}}).then(({data:e})=>e.result),c=e=>Object(i["c"])({timeout:12e4,url:"api/v3/agent/tools",method:"post",data:e}).then(({data:e})=>e),d=e=>Object(i["c"])({timeout:3e5,url:"api/v3/agent/chat",method:"post",data:e}).then(({data:e})=>e),u=e=>Object(i["c"])({timeout:3e5,url:"api/v3/assistant/component/chat",method:"post",data:e}).then(({data:e})=>e);t["a"]={getOcrTxet:a,askGpt:o,textCorrect:n,searchEnhanceApi:r,sandboxRun:l,getAgentTools:c,askGgentChat:d,askChat:u}},3747:function(e,t,s){"use strict";s("5e9e")},3785:function(e,t,s){},"39f9":function(e,t,s){},"3b1c":function(e,t,s){},"3b7e":function(e,t,s){"use strict";s("31a2")},"3d81":function(e,t,s){},"3df2":function(e,t,s){},"3e39":function(e,t,s){},"3ebb":function(e,t,s){},"3eeb":function(e,t,s){"use strict";s("7364")},"3f64":function(e,t,s){"use strict";s("5173")},4:function(e,t){},"409a":function(e,t,s){"use strict";s("9035")},4164:function(e,t,s){},"427d":function(e,t,s){"use strict";s("4825")},"433a":function(e,t,s){},"434d":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAArhJREFUaEPtmE+ITlEYxn+PLCz8K9nMiqVG8q9ILCZTJmVpElnQhJIodhQjZcGkFEJSsvFnoSiRyWyIpERjLZSUHQtsHnPq3LqN+b45997va75b393cxX3P8z7P+5w/77mi5o9qzp+ugJl2sOtA14GKFehOoYoFrDy8ZQ7YngusBd5K+lmZWSJASwTY3gCcA8L7taT1ifkrh1UWYPsAcCXHZFzS8srMEgFKC4hT5iqwM5frsaStiblbElZKQJwyL3IMPgNHJyp/vyWsCoAUFmD7OjCUyzFcIF8+9MsEzlfgnaTvJTGKNXO2TwEnyyZrMu49cEvSSFHsQg7YXgw8BNbFRGNFE+biVwILJ40fBc5KCu+kp5CADHEKJw5KupyUMRdkexmwChgAduc+HZZ0MQWvlIAAbHsjcD7vhqS+lKRTxdg+Fs+S7PMWSU+nwystIIqYBZwGjucS9Ur6OF3iRt9tv4kn+q9wMEr60AyrkoDclAp7fxCyBhir6MQi4EfEvjdRjMG2C4huLAD2AA8kfSrrQMQ6AlyIGHsl3WyE1xIHqpBtsB5mh54KWA2MSuqvlYDoQmhT9kXiPZK+TSWiIx2IAg4B2Va6TdKjugkIh+WrSHq/pGu1EhBdcCQ9LCm0Mf89nTyF8g4MSbpRNwH5NTAg6UndBGS70B9gvqS/tRFgew7wMjZ6dyTtqNU5YDv0Vmci6f5m7XXHLeLYYmfN4Iik0KU2fDpKgO3NwLPINkyhvkZzP1PUEQJszwMuTbrULE1pCmdMgO1wEwvNWnhvAlbEqo4Dg6l3ioYCbC8Bwq+TnlZ3m03wwqX+hKTfqTmbCdgF3E4FqhAXyN6NfyWSL/NJa8D2dqC3ArlmQ7P/Qs+nW6i12YXKFGrGFnEZsrVpJYqI6zpQpFrtiO060I6qFsHsOlCkWu2I/QcQob8xEcip5QAAAABJRU5ErkJggg=="},"43c9":function(e,t,s){"use strict";s("75ee")},"43f3":function(e,t,s){"use strict";s("18e5")},"443e":function(e,t,s){},"44cc":function(e,t,s){e.exports=s.p+"static/img/move.8b8acad0.png"},"462c":function(e,t,s){"use strict";s("e64b")},4668:function(e,t,s){"use strict";s("0d5b")},"475e":function(e,t,s){"use strict";s("a5c4")},"476b":function(e,t,s){e.exports=s.p+"static/img/move.8b8acad0.png"},4825:function(e,t,s){},"487d":function(e,t,s){"use strict";s("d75b")},4888:function(e,t,s){"use strict";s("af7e")},"48bc":function(e,t,s){},"49e3":function(e,t,s){},"4a0e":function(e,t,s){"use strict";s("63cc")},"4a16":function(e,t,s){"use strict";s.d(t,"a",(function(){return b})),s.d(t,"b",(function(){return g}));var i=s("4f2b"),a=s("9ec3"),o=s.n(a),n=s("dde5");s("6df9");const r=new i["default"];window.AuthCache={};const l={},c=e=>(o.a.isBoolean(e)&&(e={combined:e}),e=o.a.defaultsDeep({},e,{combined:!1,combinedPath:"",combinedRespPath:"",cached:!0}),e.combined&&(e.combinedPath=""===e.combinedPath?"request":"request."+e.combinedPath,e.combinedRespPath=""===e.combinedRespPath?"response":"response."+e.combinedRespPath),e),d=(e,t)=>{const s={};return o.a.set(s,t,"_"),o.a.defaultsDeep({},s,e)},u=e=>{const t={jsonrpc:"2.0",id:`${(new Date).getTime()}${o.a.random(1e3,9999)}`,method:"noop",params:{}},s=o.a.defaultsDeep({},e,t);return s},h=e=>{if(!l[e])return;const t=l[e],{url:s,data:i,id:a,path:n,obj:c}=t;o.a.set(c,n,i);const d=o.a.get(c,"request");let h;return delete l[e],h=o.a.isArray(d)?o.a.map(d,u):u(d),p(s,h).then(e=>(r.$emit("fullfiled."+a,e),i)).catch(e=>{throw r.$emit("rejected."+a,e),e})},p=(e,t)=>{const s={data:t.params[1]},i=new Promise((i,a)=>{Object(n["c"])(e,t.method,s).then(e=>{i(e)},({statusText:e,status:t})=>{a({error:{message:`${t}: ${e||"-"}`}})})});return i},m=(e,t,s)=>{const i=c(s),{combined:a,combinedPath:n,combinedRespPath:m}=i;if(!a){const s=p(e,u(t));return s}const g={request:t},b=o.a.get(g,n),f=d(g,n),v=JSON.stringify(f),y=`${e},${v}`;let w=o.a.noop(),x=0;l[y]?(w=l[y].handler,x=l[y].id):(w=()=>{setTimeout(()=>{h(y)},0)},x=o.a.uniqueId("jsonrpc-promise-"),l[y]={id:x,url:e,data:[],path:n,obj:f,handler:w});const C=l[y];let j;const O=C.data.findIndex(e=>JSON.stringify(e)===JSON.stringify(b[0]));-1===O?(j=C.data.length,C.data=o.a.concat(C.data,b)):j=O;let k=!1;const A=new Promise((e,t)=>{w(),r.$on("rejected."+x,e=>{k||t(e)}),r.$on("fullfiled."+x,s=>{if(k)return;const i=s.slice(j,j+1);try{e(i)}catch(a){t(a)}})});return A.cancel=()=>{k=!0},A},g=(e,t)=>{const s=JSON.stringify(e);return"boolean"===typeof window.AuthCache[s]?Promise.resolve(window.AuthCache[s]):m("api/auth",{method:"isPermitted",params:[null,[e]]},{combined:t,combinedPath:"params.1",combinedRespPath:"result"}).then(e=>e instanceof Array&&(window.AuthCache[s]=e[0],e[0]),e=>{console.log("rpc error",e)})},b=()=>{i["default"].directive("permissions",{bind:(e,t)=>{if(!e||!t.value)return;const{display:s}=e.style;e.style.display="none",g(t.value,!0).then(t=>{t&&(e.style.display=s)})}})}},"4a1a":function(e,t,s){},"4a32":function(e,t,s){},"4b72":function(e,t,s){},"4d03":function(e,t,s){"use strict";s("5eb0")},"4ea8":function(e,t,s){e.exports=s.p+"static/img/hidden.6028f5dd.png"},"4f56":function(e,t,s){"use strict";s("93c0")},"4f7c":function(e,t,s){"use strict";s("3785")},5:function(e,t){},"50c5":function(e,t,s){},5173:function(e,t,s){},5243:function(e,t,s){"use strict";s("231d")},5482:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAACLhJREFUeF7tnVFu2zoURK2dJStLurJmZ3pQ4AcEbVKLM9KMJJ8A/arGlzzU8SVtA5pu/EEAAj8SmGADAQj8TABBuDsg8A8CCMLtAQEE4R6AgEaADqJxI/UkBBDkSRaaaWoEEETjRupJCCDIkyw009QIIIjGjdSTEECQJ1lopqkRQBCNG6knIYAghYWe5/nldrst/0b+PqZp+hgJcK1PAEF8hsOvcBfk92DwFUEGiW1wOYJsAHH0JRBklFjvegQpsEeQAnSxJIKI4JwYgjj0slkEyfL+rIYgBehiSQQRwTkxBHHoZbMIkuVNBynwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62ezugszzvDxJafRxY2sp/Jqm6X3txUcZy96CzPO8MHlby2XwuuVRcK9rM0cay9oxf70OQRRq32dWy4ogm0EfklWpiiAKNQShg2x13xxlW7PM5yhjoYNsdXfd6CAPUK7e1iBI56bkDPKA+1HetREEQRQCnEEUapxBOINsdd/QQf4myRlkq7uLM8gjkpxBviF0pH3/kcby6Gb67v/ZYinU2GKxxdrqvmGLxRbrKN/qK/c0HUShRgehg2x139z3oI9ebr7dbpKsg7/FWvO7rd3HEjqky/N4tFgC80OM5dG8KmcQZVBXz+wtyNX5JecnvWsnB3jFWghynlVFkMJaIUgBulgSQURwTgxBHHrZLIJkeX9WQ5ACdLEkgojgnBiCOPSyWQTJ8qaDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSw5LMh9ccVyxL4Q+D1IY/VjzwZf96kun6bpY2TCiiDLY8zeRopwLQQOQmDoseHLmBHkICvHMCIEECSCmSJnJYAgZ105xh0hgCARzBQ5KwEEOevKMe4IAQSJYKbIWQkgyFlXjnFHCCBIBDNFzkoAQc66cow7QgBBIpgpclYCCHLWlWPcEQIRQV4iU7l+EX6sWFjj3X+sWJjT5Uryc/fzLOnwjxXPM7XjjhRBjrs2f44MQQprhSAF6GJJBBHBOTEEcehlswiS5f1ZDUEK0MWSCCKCc2II4tDLZhEky5sOUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLHk7oLM8/wujm1VbJqm1a9/lLHsLchR5rks4JHGsuqG+uOihCDLo8b2emzb0DPn5nk+xFhCgrwpN8SKzMc0Ta8rrvv/vLW8gR1iLGvH/PU6BFGofZ9ZLSuCbAZ9SFalKoIo1BCEDrLVfXOUbc19P8wWy1/YoXft+xmELdZP3BHkbzJssXxL768wJKtSlS2WQo0tFlusre4bOggdhE+x/mHTzoK8T9P0a63MRxlLYIu17PlXfz+0lp+yrZnn+TBjGZzn5+VssRRqbLHYYm113+z8rr36uwc+xdpqRW9DB2M+xXrAfWdB2GJ9w/9I25ojjUV5izj7FgtBEGT1du+QgiiDunpm70P61fkl57d7B0lO5iy1EOQsKxX4FOs8KHIjRZAca7cSHcQlKOQRRIBWiiBIATyCFKCLJRFEBOfEEMShl80iSJb3ZzUEKUAXSyKICM6JIYhDL5tFkCxvOkiBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAP0uyMtg6eXhmR+DGS43CSCICZD4tQkgyLXXl9mZBBDEBEj82gQQ5Nrry+xMAghiAiR+bQIIcu31ZXYmAQQxARK/NgEEufb6MjuTAIKYAIlfmwCCXHt9mZ1JAEFMgMSvTQBBrr2+zM4k8B/EwXUU8LcJBwAAAABJRU5ErkJggg=="},"557a":function(e,t,s){"use strict";s("df78")},5605:function(e,t,s){"use strict";s("5c2c")},5692:function(e,t,s){"use strict";s("3b1c")},"5a6e":function(e,t,s){},"5b96":function(e,t,s){"use strict";s("c710")},"5c1e":function(e,t,s){"use strict";s("22fb")},"5c2c":function(e,t,s){},"5e01":function(e,t,s){},"5e15":function(e,t,s){"use strict";s("22cd")},"5e9e":function(e,t,s){},"5eb0":function(e,t,s){},"5f58":function(e,t,s){"use strict";s("50c5")},"5f67":function(e,t,s){"use strict";s("cffa")},6:function(e,t){},"60e1":function(e,t,s){"use strict";s("fd31")},6255:function(e,t,s){"use strict";s("3ebb")},"62f8":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("t-dialog",{attrs:{width:"50%",header:"参数",visible:e.innerVisible,onClose:e.close,confirmBtn:null,cancelBtn:null,placement:"center"},on:{"update:visible":function(t){e.innerVisible=t}}},[s("JsonViewer",{attrs:{value:e.httpParams,"expand-depth":5}})],1)},a=[],o=s("0200"),n=s.n(o),r={components:{JsonViewer:n.a},props:{visible:{type:Boolean,default:!1},httpConf:{type:Object,default:()=>({})}},data(){return{innerVisible:this.visible}},computed:{httpParams(){var e;return(null===(e=this.httpConf)||void 0===e?void 0:e.params)||{}}},watch:{visible(e){this.innerVisible=e},innerVisible(e){this.$emit("update:visible",e)}},methods:{close(){this.innerVisible=!1}}},l=r,c=(s("ad58"),s("2be6")),d=Object(c["a"])(l,i,a,!1,null,"7bff414d",null);t["a"]=d.exports},6356:function(e,t,s){"use strict";s("d308")},"636d":function(e,t,s){"use strict";s("6c0b")},6385:function(e,t,s){"use strict";s("8d0d");var i=s("9ec3"),a=s("2c91");t["a"]={mixins:[a["a"]],props:{name:{type:String},required:{type:Boolean,default:!0},exhibit:{type:Array,default:()=>["auto"]},label:{required:!1,type:String},value:{type:String|Array|Boolean|Number},helps:{type:Object},labelGroup:{type:Array,default:()=>[]},isVisible:{type:Boolean,default:!0},autoLabelValueEnabled:{type:Boolean,default:!0},autoLabelSuggestEnabled:{type:Boolean,default:!0},autoLabel:[Object,String],autoValidatorEnabled:{type:Boolean,default:!1},autoValidator:[Object,String]},data(){return{showAutoValidator:!1}},computed:{isDisabled(){return this.$optimus.disabled||Boolean(this.$optimus.curLabelGroup)&&this.labelGroup.length>0&&!this.labelGroup.includes(this.$optimus.curLabelGroup)},autoLabelObj(){var e;if(this.autoLabel&&Object(i["isString"])(this.autoLabel))try{return JSON.parse(this.autoLabel)}catch(s){console.error("[OPTIMUS ENGINE] 辅助标注配置出错:",this.autoLabel)}const t=null===(e=this.$optimus.answer.tags)||void 0===e?void 0:e.find(e=>e.name===this.name&&e.autoLabel);return null===t||void 0===t?void 0:t.autoLabel},autoValidatorObj(){if(this.autoValidator){if(Object(i["isString"])(this.autoValidator))try{return JSON.parse(this.autoValidator)}catch(e){return void console.error("[OPTIMUS ENGINE] 标注检查配置出错:",this.autoValidator)}return this.autoValidator}}},created(){var e,t;const s=!(null!==(e=this.$optimus.reference)&&void 0!==e&&e.rawAnswer);s&&this.autoLabel&&this.autoLabelValueEnabled&&void 0!==(null===(t=this.autoLabelObj)||void 0===t?void 0:t.value)&&(this.$optimus.formData[this.name]=this.autoLabelObj.value),this.$optimus.$on("optimus:forms-stage:auto-check",()=>{this.showAutoValidator=!0})}}},"63cc":function(e,t,s){},"63d0":function(e,t,s){"use strict";s("27f8")},6430:function(e,t,s){},"648b":function(e,t,s){},"64bd":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAyKADAAQAAAABAAAAyAAAAACbWz2VAAAMdUlEQVR4Ae2dz4scxxXHd7SS8SbxQQfZIAV0WWkhyWFBmBDroAVdcouzi2MZgyAYdLEOe3AOkXJ2MLH9B/gSCOSHLMkot/hg4xxEZGzBHrQGOb7IZhckHWxYy4oshfX3zc5MtbZG65mqmerqqU/B01TX9Ot67/Pqq5nZ6e6ZmqqpbW5uzshOy96X3ZTdk30uOy/7taxVU2hJp1Wec7I3ZNdkGx2zvo3NJQ2mpsmUZ0u2KLPa2xqwtWBrwtaGrZGZmkKrZ1olfFy2JtupXdGTB+uJcPyzKrdp2Wuy+7JHNXvO9pkef0T1zKDcDsqs1js1WyvH64kw8axKdEm206KogrqljdnEIY59OuVk/2NeqCb6PX3bd+JeUZXTrMxqPEizNbM09uLUOYESPCS7MwiNyj6r6u+pM+5Rz618zlbyG7R7dtRx1Hk8q6nMajtMs7VzqM64xzq3krP3mCHt5bEGlvDgSv4p2dcBEMznyYShjnUq5fJyAANzOT/WwOo6uBLbKxv0rZWBqLaP64p71PMqKfvQGdpOjzqeuo4nAB8HQrA1tDdV3LtSTaR5jsp2B853RFCeCPTNzW0hIqAY34hpR+vaqeWRwKPaGrK1lKSlFMiByIz2R/rn4h7DIcY3l/wtjthaJuOQUiCxf8uO9c9lgcTkEeObS/4WR2wesf4Ds0gpkIGDYkcI5EIAgeRSCeLIkgACybIsBJULAQSSSyWII0sCCCTLshBULgQQSC6VII4sCSCQLMtCULkQQCC5VII4siSAQLIsC0HlQgCB5FIJ4siSAALJsiwElQsBBJJLJYgjSwIIJMuyEFQuBBBILpUgjiwJIJAsy0JQuRBAILlUgjiyJIBAsiwLQeVCoO814p2L4o8qSLu0cVRXbx2LTPpFxbUQeYwc3PdFBLFPDJYj/HNxjb1k9pg4jCqXuzrQmuxyq9X6cvtBH7oZmSa1ew69KntW1lc82w/ANgQmhMAD5XFJdkZC+W83p55AJA67a91fZD/oPskjBAok8I1yPimRXLTc2wKROOy+p/+S8aphVGilE7BXk19KJO/ZPWLtM8ZnsthbsZQOlfwni8C60pm1v2K9JEMck1VcsoknYJp4yQSyGH8sjgCBiSSwaG+xbiq1ibkp8kSWiaTqInDLBHJPsz9WVwTMC4GMCXxrb7FuZRwgoUGgTgI3TSBX6oyAuSGQMYEPTSB/zzhAQoNAnQT+Zp9B7MvC/8h+XmckzA2BzAh8qHh+0f0m3X5N9iNZzIl0meVHOBAIJnBbnk/rm/Qb9hZryjp6eEb2iW3TIFAwAdPAMx1NTLUFYjA0YKebzMvsd/CuymgQKImArXlb+/MdLbRzb7/F6kdBn03sNwHt6/ZRXQ/yoo71Sr+5Bhw7of2uD7hvzrudU3CHAwP8VH7PB/rm5DanYP4REdDr8v1rhH/V1a4HWZcoNqqD3f4jz97tOIxsQUpwC91JAx+vK6aVQN9s3MTBChLa7k4Ig9D8u35rqTj03mJ1Z+YRAhBwBBCIY0EPAh4BBOIhYQACjgACcSzoQcAjgEA8JAxAwBFAII4FPQh4BBCIh4QBCDgCCMSxoAcBjwAC8ZAwAAFHAIE4FvQg4BFAIB4SBiDgCCAQx4IeBDwCCMRDwgAEHAEE4ljQg4BHAIF4SBiAgCOAQBwLehDwCCAQDwkDEHAEEIhjQQ8CHgEE4iFhAAKOAAJxLOhBwCOAQDwkDEDAEUAgjgU9CHgEEIiHhAEIOAIIxLGgBwGPAALxkDAAAUcAgTgW9CDgEUAgHhIGIOAIIBDHgh4EPAIIxEPCAAQcAQTiWNCDgEcAgXhIGICAI4BAHAt6EPAIIBAPCQMQcAQQiGNBDwIeAQTiIWEAAo4AAnEs6EHAI4BAPCQMQMARQCCOBT0IeAQQiIeEAQg4AgjEsaAHAY8AAvGQMAABRwCBOBb0IOARQCAeEgYg4AggEMeCHgQ8AgjEQ8IABBwBBOJY0IOARwCBeEgYgIAjgEAcC3oQ8Ai0to9sbm4+qbHfyBZkB2QzslG0fTrI/ogDfSrfuxH+ubjOKZDHA4P5n/yuB/rm5GZr6nBEQOvyvR3hX3W1NbUm+0D2dqvVuqXHXusJRMKw/hnZ72U/7O1BBwLlELijVF+V/VFC2bS02wKROKbVPydbskEaBAoncFH5Py+R/L/7GcRUgzgKXxWk3yNgWjBNTLX06mHvia/JdtsADQIQaBN4oH9/Zq8gp2SIo82EfyDQI2CaOGWvIPbq8dPeMB0IQKBLYNUEsqGtH3VHeIQABHoEvu5+SO+N0IEABBwBE8gNt0kPAhCoELhhAnm3MkAXAhBwBN7lz7wOBj0IVAls/ZlX3xbauT1vVp+hDwEITL1p2uBUE1YCBHwCD59qYuecaJ/nZH+Q2QlbNAiUSMDWvmnguY4mtk5WrJLQ9yJP2Q6yBRmnuwvCiBunu29dQnE4guu6fJOc7h4R43CuEt6yLKbNDzdjnnsLwEoEhJU8sxouKuU/H8HAXJeHmzF8b74oDGeHZwEEEEgBRSbFcAIIJJwdngUQQCAFFJkUwwkgkHB2eBZAAIEUUGRSDCeAQMLZ4VkAAQRSQJFJMZwAAglnh2cBBBBIAUUmxXACCCScHZ4FEEAgBRSZFMMJIJBwdngWQACBFFBkUgwngEDC2eFZAAEEUkCRSTGcAAIJZ4dnAQQQSAFFJsVwAggknB2eBRBAIAUUmRTDCSCQcHZ4FkAAgRRQZFIMJ4BAwtnhWQABBFJAkUkxnAACCWeHZwEEEEgBRSbFcAIIJJwdngUQQCAFFJkUwwkgkHB2eBZAAIEUUGRSDCeAQMLZ4VkAAQRSQJFJMZwAAglnh2cBBBBIAUUmxXACCCScHZ4FEEAgBRSZFMMJIJBwdngWQACBFFBkUgwngEDC2eFZAAEEUkCRSTGcAAIJZ4dnAQQQSAFFJsVwAggknB2eBRBAIAUUmRTDCSCQcHZ4FkAAgRRQZFIMJ4BAwtnhWQABBFJAkUkxnMDuR7lubm4+oef2y2Yetc+Q4weG3H/77nOKaftYE7djeM6IwXwTk94W89y27WE3D4yQw11Nvt5qtTb6BdGqDmrSPdo+Jfut7Ej1OfoQmHACV5Xfn2VvSSz3u7n2BCJxzGrwn7KfdJ/kEQIFEvhEOf9KIvnMcm8LROI4qP5Hsn02SINA4QRuK/+nJZIbuyQOE8k5GeIofFWQfo+AaeGcaaOlfxa1cbH3FB0IQKBLYMn+zPtCd4tHCEDgIQIv2CvIFxr68UPDbEAAAkbgCxPIPXUegwcEIOAR+NbeYn3lDTMAAQgYga9MIKuwgAAE+hJYNYG80/cpBiEAgXfsM4idG2TfGtp5VzQIQGCLwLoeZnfp20I7Weuk7MHWOP9CoHgCpoWTpg17izWlznt6OCH7xrZpECiYgGngREcTU22BGAwN2Lfpdir1BRmvJoJAK4qArXlb+/MdLbST753NW0WhzyV7tX1UZtdwxFy/UD3sMW08Wx0Ysv+69l8b0ifH3X+noEI/79n74j/lmNSQMdm6emVIn+rul7Tx7+pARN8+Yti6uixhfBlxnDhXiW5ZFtPs1a3xTQBWIiCsNB6AElD+8xEMzHU5FYfeW6xUEzIPBJpEAIE0qVrEmpwAAkmOnAmbRACBNKlaxJqcAAJJjpwJm0QAgTSpWsSanAACSY6cCZtEAIE0qVrEmpwAAkmOnAmbRACBNKlaxJqcAAJJjpwJm0QAgTSpWsSanAACSY6cCZtEAIE0qVrEmpwAAkmOnAmbRACBNKlaxJqcAAJJjpwJm0QgpUDs0saYFusfM/cofWPyiPEdZQ6xx4rNI9Z/4PhTCiT2enK7HnsSWgyHGN+c2MXWMhmHlAK5rAqF3i3lqi6o7/sjizlVfcBYPhhwv367xfj2O14tY51a2m8ChjRbQ7aWkrRkAuncMcLuRhHS7McVJ6WdVyJ3ApIxn7cD/HJ1Ca3ppVrvPjJOmrobxSHZHbstxRBtVfvuGWdcqY+tfM4OkX931zOp4xznfFZTmdV2mGZr59A446r92EpwSXZ/QCq3tJ/9+u5ENeVk90S+MCAD28327XsPsyaDUU6zMqvxIM3WzFKT8x04diV6XLb2PVSu6Hn79d2JbMptWvaabKf/LOw522d6IiEoKeV2UGa13qnZWjk+qQz65qWEZ2SnZe/LbsruyT6XnZctyibuf8x+IJTnnOwN2TXZRsesb2Nz/XwmbUx52iuq1dxqb2vA1oKtCVsbtkZGdXfPodF9B21ceOJnoZjxAAAAAElFTkSuQmCC"},"65bd":function(e,t,s){"use strict";s("b924")},"65c5":function(e,t,s){"use strict";s("f410")},"65c9":function(e,t,s){"use strict";s("e97c")},"66b3":function(e,t,s){},"66e3":function(e,t,s){"use strict";s("433a")},"69d3":function(e,t,s){},"6b23":function(e,t,s){"use strict";t["a"]={label:"chat",icon:"ios-chatboxes-outline",name:"z-chat",attributes:[{name:"name",label:"字段标识",type:String,value(){return"input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"输入框"},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{label:"请求地址",name:"apiUrl",type:String,required:!0,value:""},{label:"请求header",name:"headers",type:String,required:!1,value:""},{name:"value",label:"请求参数",type:String,required:!0,value:""},{name:"resPath",label:"响应体字段路径",type:String,required:!0,value:""},{name:"targetTag",label:"目的标签（响应体字段值回写使用，目前仅支持全局标签）",type:String,required:!0,value:"",attributes:{enableExpression:!1}}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"输入框",type:["string","null"]}},required:["name","label"]}}},"6c0b":function(e,t,s){},"6cc3":function(e,t,s){"use strict";s("c952")},"6df9":function(e,t,s){"use strict";var i=s("4f2b"),a=s("9ce4");i["default"].use(a["a"]),t["a"]=new a["a"].Store({state:{userinfo:{},companyinfo:{},workInfo:{status:"",scene:"",employment:"",task_id:"",task_name:"",monthly_salary:0},taskTodo:{deliverWaitApprove:0},companyTodo:{memberJoin:0},uploadQueue:{}},mutations:{setUserInfo(e,t){e.userinfo=t},setCompanyInfo(e,t){e.companyinfo=t},setWorkStatus(e,t){Object.assign(e.workInfo,t)},setTaskTodo(e,t){e.taskTodo[t.params]=t.value},setCompanyTodo(e,t){e.companyTodo[t.params]=t.value},SET_UPLOAD_QUEUE(e,t){t.data&&i["default"].set(e.uploadQueue,t.id,t.data),!t.data&&e.uploadQueue[t.id]&&delete e.uploadQueue[t.id]}},actions:{setUploadQueue({commit:e},t){e("SET_UPLOAD_QUEUE",t)}},getters:{user(e){return e.userinfo&&e.userinfo.user||{}},config(e){return e.userinfo&&e.userinfo.config||{}},wx_user(e){return e.userinfo&&e.userinfo.wx_user||{}},oa_user(e){return e.userinfo&&e.userinfo.oa_user||{}},users(e){return e.userinfo&&e.userinfo.users||[]},uploadQueue(e){return e.uploadQueue}}})},"6e96":function(e,t,s){},"6eba":function(e,t,s){"use strict";s("079a")},"6ec8":function(e,t,s){},"6f05":function(e,t,s){"use strict";s("b30d")},"6f1e":function(e,t,s){"use strict";var i=s("3216");const a=e=>Object(i["c"])({timeout:6e4,method:"post",url:"api/turbo/llm/translate",data:e}).then(e=>e).catch(e=>e),o=e=>Object(i["c"])({timeout:12e4,method:"post",url:"api/turbo/llm/tianqiong/optimize_guideline",data:e}).then(e=>e).catch(e=>e),n=e=>Object(i["c"])({timeout:12e4,method:"post",url:"api/turbo/llm/tianqiong/label_dict",data:e}).then(e=>e).catch(e=>e),r=e=>Object(i["c"])({timeout:12e4,method:"post",url:"api/turbo/label/tianqiong/v1",data:e}).then(e=>e).catch(e=>e);t["a"]={translate:a,optimizeGuideline:o,labelDict:n,getHelper:r}},7:function(e,t){},7294:function(e,t,s){},7364:function(e,t,s){},7404:function(e,t,s){},"75ee":function(e,t,s){},"76ab":function(e,t,s){"use strict";s.r(t);var i=s("4f2b"),a=s("a35e"),o=s.n(a),n=(s("2e9b"),s("c495")),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.visible?s("Modal",{attrs:{title:e.title,transfer:!1},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("Form",{ref:"form",staticStyle:{margin:"10px"},attrs:{model:e.data,rules:e.rules}},e._l(e.contents,(function(t){return s("FormItem",{key:t.$index,attrs:{label:t.label,prop:t.value}},[t.isbox||t.table||t.isselect?e._e():s(t.type,e._b({tag:"component",model:{value:e.data[t.value],callback:function(s){e.$set(e.data,t.value,s)},expression:"data[content.value]"}},"component",t.props||{},!1)),t.table?s(t.type,e._b({tag:"component"},"component",t.props,!1)):e._e(),t.isbox?s(t.type,e._b({tag:"component",model:{value:e.data[t.value],callback:function(s){e.$set(e.data,t.value,s)},expression:"data[content.value]"}},"component",t.props||{},!1),e._l(t.box.option,(function(e){return s(t.box.type,{key:e.$index,tag:"component",attrs:{label:e}})})),1):e._e(),t.isselect?s(t.type,e._b({tag:"component",model:{value:e.data[t.value],callback:function(s){e.$set(e.data,t.value,s)},expression:"data[content.value]"}},"component",t.props||{},!1),e._l(t.select.option,(function(i){return s(t.select.type,e._b({key:i.value,tag:"component"},"component",i,!1))})),1):e._e()],1)})),1),s("template",{slot:"footer"},[s("Button",{attrs:{type:"primary"},on:{click:e.ok}},[e._v(e._s(e.footer||"确定"))]),s("Button",{on:{click:e.cancel}},[e._v("取消")])],1)],2):e._e()},l=[],c={props:{title:String,content:Array,footer:String},data(){return{visible:!0,contents:[],data:{},rules:{}}},created(){let e={};this.content.forEach(t=>{switch(e={},t.type){case"Input":e=t.rule?t.rule:[{required:!0,message:`字段${t.label}不能为空`,trigger:"blur"}],this.data[t.value]="",t.rule||!1===t.rule||(this.rules[t.value]=e),this.contents.push({value:t.value,type:t.type,label:t.label,props:{placeholder:t.placeholder?t.placeholder:"请输入..."}});break;case"Textarea":e=t.rule?t.rule:[{required:!0,message:`字段${t.label}不能为空`,trigger:"blur"}],this.$set(this.data,t.value,""),!1!==t.rule&&this.$set(this.rules,t.value,e),this.contents.push({value:t.value,type:"Input",label:t.label,props:{placeholder:t.placeholder?t.placeholder:"请输入...",type:"textarea",autosize:{minRows:4,maxRows:5}}});break;case"Select":e=t.rule?t.rule:[{required:!0,message:`字段${t.label}还未选择`,trigger:"change"}],this.$set(this.data,t.value,""),!1!==t.rule&&this.$set(this.rules,t.value,e),this.contents.push({value:t.value,type:t.type,label:t.label,isselect:!0,select:{type:"Option",option:t.options?t.options:[]},props:{placeholder:t.placeholder?t.placeholder:"请选择..."}});break;case"SelectMultiple":e=t.rule?t.rule:[{required:!0,type:"array",message:`字段${t.label}还未选择`,trigger:"change"}],this.$set(this.data,t.value,[]),!1!==t.rule&&this.$set(this.rules,t.value,e),this.contents.push({value:t.value,type:"Select",label:t.label,isselect:!0,select:{type:"Option",option:t.options?t.options:[]},props:{placeholder:t.placeholder?t.placeholder:"请选择...",multiple:!0}});break;case"RadioGroup":e=t.rule?t.rule:[{required:!0,message:`字段${t.label}还未选择`,trigger:"change"}],this.$set(this.data,t.value,""),!1!==t.rule&&this.$set(this.rules,t.value,e),this.contents.push({value:t.value,type:t.type,label:t.label,isbox:!0,box:{type:"Radio",option:t.options?t.options:[]},props:{}});break;case"CheckboxGroup":e=t.rule?t.rule:[{required:!0,type:"array",message:`字段${t.label}还未选择`,trigger:"change"}],this.$set(this.data,t.value,[]),!1!==t.rule&&this.$set(this.rules,t.value,e),this.contents.push({value:t.value,type:t.type,label:t.label,isbox:!0,box:{type:"Checkbox",option:t.options?t.options:[]},props:{}});break;case"Cascader":e=t.rule?t.rule:[{required:!0,type:"array",message:`字段${t.label}还未选择`,trigger:"change"}],this.$set(this.data,t.value,[]),!1!==t.rule&&this.$set(this.rules,t.value,e),this.contents.push({value:t.value,type:t.type,label:t.label,props:{placeholder:t.placeholder?t.placeholder:"请选择...",data:t.options?t.options:[]}});break;case"Table":this.contents.push({type:t.type,label:t.label,table:!0,props:{columns:t.options.columns?t.options.columns:[],data:t.options.data?t.options.data:[]}});break}})},mounted(){},methods:{ok(){this.$refs.form.validate(e=>{e?(this.visible=!1,this.$emit("onOk",this.data),this.$nextTick(()=>{this.$emit("destroy")})):this.$message.error("您有必填项未填")})},cancel(){this.visible=!1,this.$nextTick(()=>{this.$emit("destroy")})}}},d=c,u=s("2be6"),h=Object(u["a"])(d,r,l,!1,null,null,null),p=h.exports;class m{init(){let e=document.getElementById("fast-modal");e||(e=document.createElement("div"),e.setAttribute("id","fast-modal"),e.setAttribute("style","position: absolute; left: -100000px; top: -10000px;"),document.body.appendChild(e));const t=this;t.$modal=new i["default"]({data(){return{modal:null,props:null,events:null,key:null}},render(e){return e(this.modal,{props:{...this.props},key:this.key,on:{...this.events,destroy:this.destroy}})},methods:{destroy(){this.$destroy(),this.$el&&document.body.removeChild(this.$el),t.$modal=void 0}}}).$mount(e)}show(e,t,s){this.$modal||this.init();const i=String(Math.random()).slice(2);Object.assign(this.$modal,{modal:e,key:"fast-modal-"+i,props:{...t},events:s})}showSimple(e,t){const s=p;this.$modal||this.init();const i=String(Math.random()).slice(2);Object.assign(this.$modal,{modal:s,key:"fast-modal-"+i,props:{...e},events:t})}hide(e,t,s){if(!this.$modal)return;const i=String(Math.random()).slice(2);Object.assign(this.$modal,{modal:e,key:"fast-modal-"+i,props:t,events:s})}}var g={install(e){e.prototype.$FastModal=new m}},b=s("9ec3"),f=s.n(b);const v=e=>{let t=0,s=null;return function(...i){const a=this;t+=1;const o=t,n=f.a.bind(e,a,{isOutdated(){return t!==o},previous:s});return s=n.apply(a,i)}},y=e=>{const t=e.replace(/^(fetch|get|load|delete)/,"");return t.slice(0,1).toLowerCase()+t.slice(1)},w={install(e){e.config.optionMergeStrategies.asyncMethods=e.config.optionMergeStrategies.methods,e.mixin({data(){const e={};return Object.keys(this.$options.asyncMethods||{}).forEach(t=>{e[y(t)]=null}),e},beforeCreate(){const t=this;Object.keys(this.$options.asyncMethods||{}).forEach(s=>{const i=this.$options.asyncMethods[s],a=y(s),o=v((...e)=>{const[o,...n]=e,r=i.apply(t,n);return t[s].promise=Promise.resolve().then(()=>{if(!o.isOutdated())return t[s].isPending=!0,t[s].isResolved=!1,t[s].isRejected=!1,r}).then(e=>{if(!o.isOutdated())return t[a]=e,t[s].rejectedWith=null,t[s].isPending=!1,t[s].isResolved=!0,t[s].isRejected=!1,e}).catch(e=>{if(!o.isOutdated())throw t[a]=null,t[s].rejectedWith=e,t[s].isPending=!1,t[s].isResolved=!1,t[s].isRejected=!0,e}),t[s].promise});e.util.defineReactive(t,s,o);const n={execute:o,promise:null,isPending:!1,isResolved:!1,isRejected:!1,rejectedWith:null};Object.keys(n).forEach(t=>{e.util.defineReactive(o,t,n[t])})})}})}};var x=w,C=s("050d"),j=s.n(C);const O=/(\d{3})(?=\d)/g;i["default"].filter("comma",(e,t)=>{let s=e,i=t||{};f.a.isNumber(t)&&(i={decimal:Number(t)});const{decimal:a,zero:o,placeholder:n="-"}=i;if(f.a.isString(s)&&(-1!==s.indexOf(",")||-1!==s.indexOf("%")))return s;if(f.a.isNil(s))return n;if(s=Number(s),0===s)return void 0!==o?o:s;if(!isFinite(s)||!s&&0!==s)return" ";const r=s;s=f.a.isNumber(a)?Math.abs(s).toFixed(a):Math.abs(s);const l=s.toString().split("."),[c]=l,d=c.length%3,u=d>0?c.slice(0,d)+(c.length>3?",":""):"";let h="";l.length>1&&(h="."+l[1]);const p=r<0?"-":"";return p+u+c.slice(d).replace(O,"$1,")+h}),i["default"].filter("truncate",(e,t)=>f.a.truncate(e,t)),i["default"].filter("dayjs",(e,t,...s)=>{const i=j()(e),a=i.isValid();return a?i[t](...s):""});s("98f2"),s("3e39"),s("d9d0"),s("f75f"),s("33f6"),s("f308"),s("7f89");var k=s("be6d"),A=s.n(k),S=s("e4c5"),_=s.n(S),I=(s("6156"),s("1b20")),$=s("bd3bc"),M=s.n($),T=s("3664"),E=s.n(T),L=s("33a5"),D=s.n(L),P=s("db49");const B=(e,t,s)=>{let i="0%";if("number"!==typeof e||"number"!==typeof t)return"-";if("number"!==typeof s&&0!==t)i=Math.round(e/t*1e4)/100+"%";else if("number"===typeof e&&"number"===typeof t&&"number"===typeof s&&0!==t){const a=s?Math.pow(10,s):1;i=Math.round(e/t*100*a)/a+"%"}return i};!localStorage.getItem("email")&&localStorage.setItem("email","default"),!localStorage.getItem("realUserEmail")&&localStorage.setItem("realUserEmail","default");const R=new D.a({id:P["a"].EAGIS_ID?P["a"].EAGIS_ID:"default",api:{reportRequest:!0,apiDetail:!0,injectTraceHeader:"sw8",injectTraceIgnoreUrls:[/xy.woa.com/,/eywa.woa.com/,/w.gtimg.cn/,/vfiles.gtimg.cn/]},aid:localStorage.getItem("realUserEmail"),uin:"default",reportApiSpeed:!0,reportAssetSpeed:!0,spa:!0,random:P["a"].EAGIS_ID?1:0});i["default"].config.errorHandler=(e,t,s)=>{console.error("errorHandler:",e),R.error(`errorHandler: ${e.toString()}\nStack: ${e.stack}\nInfo: ${s}`)},i["default"].config.warnHandler=(e,t,s)=>{console.error("warnHandler:",e),R.error(`warnHandler: ${e.toString()}\ntrace: ${s}`)},i["default"].prototype.$aegis=R,i["default"].use(I["a"]),i["default"].use(M.a),i["default"].use(E.a),i["default"].prototype.$EventBus=new i["default"],j.a.locale("zh-cn"),j.a.extend(_.a),j.a.extend(A.a),i["default"].use(g),i["default"].use(x),i["default"].use(o.a),i["default"].use(n["a"]),i["default"].config.productionTip=!1,i["default"].prototype.$FormatNumber=e=>e?e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0",i["default"].prototype.$ToPercent=B;var z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.isGlobalGray&&"global-gray",attrs:{id:"app"}},[s("router-view")],1)},N=[];s("8d0d");const F=["2022-12-05 18:00:00","2022-12-07 09:00:00"],V=["project","deliver","datasets","datasetsHandle","templates","tagsets","wb-bid-tasks","wb-formal-tasks","wb-audit-tasks","wb-tasks-label","wb-tasks-review","wb-tasks-workTime","projectMonitor","projectDelay","companyMonitor","workTime","my-company","my-team","company-create","project-access","company","manager","auth","role","template","app"];var q={data(){const e=new Date,t=new Date(F[0]),s=new Date(F[1]);return{isGlobalGray:e>=t&&e<=s}},watch:{$route(e){const t=!!P["a"].INSIDE_DOMAIN;this.isGlobalGray=this.isGlobalGray&&V.includes(e.name)&&t,this.$FastModal.hide()}},created(){var e;const t=this.$store.state.userinfo;if(null!==t&&void 0!==t&&null!==(e=t.user)&&void 0!==e&&e.email&&(this.$aegis.setConfig({uin:t.user.email}),localStorage.getItem("email")!==t.user.email&&localStorage.setItem("email",t.user.email)),null!==t&&void 0!==t&&t.users){var s,i;const e=(null===(s=t.users)||void 0===s||null===(i=s[0])||void 0===i?void 0:i.email)||"default";this.$aegis.setConfig({aid:e}),localStorage.getItem("realUserEmail")!==e&&localStorage.setItem("realUserEmail",e)}console.log(this.$aegis.config)}},H=q,W=(s("5f58"),Object(u["a"])(H,z,N,!1,null,null,null)),U=W.exports,Q=s("5f2b"),J=[{path:"/oauth/authorize",name:"oauth-authorize",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"202b"))},{path:"/templates/:id/edit",name:"template-edit",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"1881"))},{path:"/templates/:id/preview",name:"template-preview",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"1728"))},{path:"",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"4f7f")),children:[{path:"/personal-center",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"e043")),children:[{path:"",redirect:"questions-processing"},{path:"my-company",name:"my-company",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"4e19"))},{path:"questions-processing",name:"questions-processing",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"1ea5"))},{path:"my-team",name:"my-team",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"6f0a"))},{path:"my-team/:id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"9c54"))},{path:"my-attendance",name:"my-attendance",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"db00"))}]},{path:"/templates-market",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"ddbb")),meta:{isPublisher:!0,permission:"template-markets"}},{path:"/company",component:()=>s.e("company-group").then(s.bind(null,"13c85")),meta:{permission:"company"},children:[{path:"",redirect:"authority"},{path:"authority",component:()=>s.e("company-group").then(s.bind(null,"9224"))},{path:"todo/member-join",component:()=>s.e("company-group").then(s.bind(null,"9872"))},{path:"my-team",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"6f0a"))},{path:"my-team/:id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"9c54"))},{path:"app",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"75c9"))}]},{path:"/projects",name:"demand-center",component:()=>s.e("project-group").then(s.bind(null,"533a")),redirect:{name:"project"},meta:{permission:"projects"},children:[{path:"list",name:"project",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"2a6b")),meta:{isPublisher:!0,group:"project"}},{path:"list/create",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"7e13")),meta:{isPublisher:!0,group:"project"}},{path:"list/:id",name:"projectDetail",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"be8c")),meta:{isPublisher:!0,keepAlive:!0,group:"project",hidden:!0},children:[{name:"create-template",path:"tasks/createTemplate",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"4609")),meta:{tab:"template"}},{name:"create-bid-tasks",path:"tasks/createBidTasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"e125")),meta:{tab:"bid-tasks"}},{name:"create-formal-tasks",path:"tasks/createFormalTasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"db67")),meta:{tab:"formal-tasks"}},{name:"create-task-orders",path:"tasks/createTaskOrders",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"6efa")),meta:{tab:"task-orders"}},{name:"task",path:"tasks/:taskId",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"a491")),meta:{}}]},{name:"task2",path:"list/tasks/:taskId",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"a491")),meta:{group:"project"}},{path:"templates",name:"templates",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"73f4")),meta:{group:"templates"}},{path:"standardize-templates",name:"standardize-templates",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"73f4")),meta:{group:"templates"}},{path:"templates/create",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"4609")),meta:{group:"templates.templates"}},{path:"tagsets",name:"tagsets",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"7dd9")),meta:{group:"templates"}},{path:"datasets/index",name:"datasets",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"021a")),meta:{isPublisher:!0,keepAlive:!0,group:"datasets"}},{path:"datasets/index/:id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"d33d")),meta:{isPublisher:!0,keepAlive:!0,group:"datasets.datasets"}},{path:"handle/index",name:"datasetsHandle",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"a845")),meta:{isPublisher:!0,keepAlive:!0,group:"datasets"}},{name:"deliver",path:"deliver/index",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"7c4f")),meta:{isPublisher:!0,keepAlive:!0,group:"project"}},{name:"task-config",path:"task-config",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"8a46")),meta:{group:"salary"}},{name:"monthly-salary",path:"monthly-salary",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"6ed2")),meta:{group:"salary"}},{name:"work-hour",path:"work-hour",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"828a")),meta:{group:"salary"}},{name:"import-status",path:"import-status",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"a914")),meta:{group:"salary"}},{name:"operation-export",path:"operation-export",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"881c")),meta:{group:"salary"}}]}]}],G=[{path:"/admin",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"4f7f")),meta:{permission:"admin"},children:[{path:"",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"e651")),children:[{path:"",redirect:"company"},{name:"project-access",path:"todo/project-access",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"a764"))},{name:"company",path:"company",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"22f8"))},{name:"manager",path:"manager",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"b484"))},{name:"auth",path:"auth",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"ce46"))},{name:"role",path:"role",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"322b"))},{name:"template",path:"template/index",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"2309"))},{name:"template-create",path:"template/create",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"d2db"))},{name:"app",path:"app",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("admin-group")]).then(s.bind(null,"bcee"))}]}]}],K=[{path:"/salary",name:"salary",redirect:{name:"task-config"}},{path:"/wb-tasks",name:"wb-tasks",redirect:{name:"wb-bid-tasks"}},{path:"/wb-my-task",name:"wb-my-task",redirect:{name:"wb-tasks-label"}},{path:"/wb-exam",name:"wb-exam",redirect:{name:"wb-tasks-workTime"}},{path:"/wb-salary",name:"wb-salary",redirect:{name:"wb-settlement-work-hour"}}],Y=[{name:"wb-queue-label",path:"/workbench/tasks/:task_id/queue-label",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"fa79"))},{name:"wb-queue-review",path:"/workbench/tasks/:task_id/:deliver_id/queue-review",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"7a5d"))},{name:"wb-queue-relabel",path:"/workbench/tasks/:task_id/queue-relabel",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"ba19"))},{name:"wb-queue-rereview",path:"/workbench/tasks/:task_id/:deliver_id/queue-rereview",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"fee5"))},{name:"wb-task-history-detail",path:"/workbench/tasks/:task_id/details/:detail_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"6e35")),meta:{isDetail:!0}},{name:"pj-task-history-detail",path:"/tasks/:task_id/detail/:detail_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"6e35")),meta:{isDetail:!0}},{name:"project-task-detail",path:"/tasks/:task_id/checks/:check_id/packs/:pack_id/:dataset_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"c930")),meta:{isDetail:!0}},{name:"wb-task-label-detail",path:"/workbench/tasks/:task_id/pack_key/:pack_key",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"bee4")),meta:{isDetail:!0}},{name:"wb-task-review-detail",path:"/workbench/tasks/:task_id/checks/:check_id/packs/:pack_id/:dataset_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"c930")),meta:{isDetail:!0}},{path:"/workbench",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"4f7f")),children:[{path:"",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"97db")),children:[{path:"",redirect:"label-tasks"},{name:"wb-bid-tasks",path:"bid-tasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"e497")),meta:{permission:"wb-tasks",keepAlive:!0,group:"wb-tasks"}},{name:"wb-formal-tasks",path:"formal-tasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"c351")),meta:{permission:"wb-tasks",keepAlive:!0,group:"wb-tasks"}},{name:"wb-audit-tasks",path:"audit-tasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"7a9f")),meta:{permission:"wb-tasks",keepAlive:!0,group:"wb-tasks"}},{name:"wb-tasks-label",path:"label-tasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"fb8d")),meta:{keepAlive:!0,group:"wb-my-task"}},{name:"wb-tasks-review",path:"review-tasks",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"55ba")),meta:{keepAlive:!0,group:"wb-my-task"}},{name:"wb-tasks-workTime",path:"work-time",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"86c9")),meta:{group:"wb-exam"}},{name:"wb-settlement-task-config",path:"task-config",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"8a46")),meta:{group:"wb-salary"}},{name:"wb-settlement-monthly-salary",path:"monthly-salary",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"6ed2")),meta:{group:"wb-salary"}},{name:"wb-settlement-work-hour",path:"work-hour",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"828a")),meta:{group:"wb-salary"}},{name:"wb-task",path:"tasks/:task_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"d361"))},{name:"wb-bid-task",path:"bid-tasks/:task_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"d361")),meta:{group:"wb-tasks.wb-bid-tasks"}},{name:"wb-formal-task",path:"formal-tasks/:task_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"d361")),meta:{group:"wb-tasks.wb-formal-tasks"}},{name:"wb-audit-task",path:"audit-tasks/:task_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"d361")),meta:{group:"wb-tasks.wb-audit-tasks"}},{name:"wb-label-task-detail",path:"label-tasks/:task_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"940f")),meta:{group:"wb-my-task.wb-tasks-label"}},{name:"wb-review-task-detail",path:"review-tasks/:task_id/:deliver_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"940f")),meta:{group:"wb-my-task.wb-tasks-review"}},{name:"wb-extract-review-task",path:"review-tasks/extract-review-tasks/:task_id/:deliver_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"f3bc")),meta:{group:"wb-my-task.wb-tasks-review"}},{name:"wb-create-check-task",path:"review-tasks/create-check-task/:task_id/:deliver_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"a822")),meta:{group:"wb-my-task.wb-tasks-review"}},{name:"wb-edit-check-task",path:"review-tasks/edit-check-task/:task_id/:deliver_id",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("main-group~workbench-group"),s.e("dataview-group~workbench-group"),s.e("workbench-group")]).then(s.bind(null,"a822")),meta:{group:"wb-my-task.wb-tasks-review"}}]}]}],Z=[{path:"/dataview",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"4f7f")),meta:{permission:"dataview"},children:[{path:"",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"0424")),children:[{path:"",redirect:P["a"].PRIVATIZATION?"dashborad":"work-time"},{name:"dashborad",path:"dashborad",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"fea6")),meta:{permission:"dashboard",group:"dataview"}},{name:"projectMonitor",path:"project-monitor",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"1abd")),meta:{group:"dataview"}},{name:"projectDelay",path:"project-delay",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"9327")),meta:{group:"dataview"}},{name:"companyMonitor",path:"company-monitor",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"de4f")),meta:{group:"dataview"}},{name:"workTime",path:"work-time",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("dataview-group~workbench-group"),s.e("dataview-group")]).then(s.bind(null,"1d76")),meta:{group:"dataview"}}]}]}],X=s("6df9"),ee=s("4a16"),te=s("e3fa"),se=s("dde5");i["default"].use(Q["a"]);const ie=Q["a"].prototype.push;Q["a"].prototype.push=function(e){return ie.call(this,e).catch(e=>e)};const ae=Q["a"].prototype.replace;Q["a"].prototype.replace=function(e){return ae.call(this,e).catch(e=>e)};const oe=[{path:"/"},...K,...J,...G,...Y,...Z,{path:"/login",name:"login",component:()=>s.e("base-group").then(s.bind(null,"1954"))},{path:"/wx-callback",name:"wxCallback",component:()=>s.e("chunk-2d0b305d").then(s.bind(null,"2735"))},{name:"register",path:"/register",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"2f50")),meta:{user:!0}},{name:"invite",path:"/invite",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"e5aa")),meta:{user:!0}},{path:"",component:()=>Promise.all([s.e("admin-group~dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group~workbench-group"),s.e("dataview-group~main-group"),s.e("main-group~workbench-group"),s.e("main-group")]).then(s.bind(null,"4f7f")),children:[{path:"/404",name:"404",component:()=>s.e("base-group").then(s.bind(null,"7746"))},{path:"/deny",name:"deny",component:()=>s.e("base-group").then(s.bind(null,"f78a"))}]}],ne=new Q["a"]({mode:"history",base:"/",routes:oe}),re=(e,t,s)=>{var i,a,o;const{origin:n}=window.location,{userinfo:r}=X["a"].state,l=e.matched.some(e=>e.meta.permission);if(console.log("test",e.name),"wxCallback"===e.name)s();else if("login"===e.name||"/login"===e.path)window.location.replace(n+"/v2/login");else if(null!==(i=r.user)&&void 0!==i&&i.user_id)if(e.meta.user)s({path:"/personal-center/my-company"});else if(l){const t={domain:"menu",action:"view",extra:{name:e.matched.find(e=>e.meta.permission).meta.permission}};Object(ee["b"])(t,!1).then(e=>{e?s():s({name:"deny"})})}else{var c;if("/"===e.path)null!==(c=r.company)&&void 0!==c&&c.is_publishable?s({path:"/projects"}):s({path:"/workbench"});else e.matched.length>0?s():s({name:"404"})}else if(null!==(a=r.wx_user)&&void 0!==a&&a.nick_name||null!==(o=r.oa_user)&&void 0!==o&&o.nick_name)e.fullPath.startsWith("/invite")?s():e.fullPath.startsWith("/register")?window.location.replace(`${n}/v2/${e.fullPath.substring(1)}`):window.location.replace(n+"/v2/register");else{const t=encodeURIComponent(e.fullPath);console.log(`${n}/v2/login?redirect=${t}`),window.location.replace(`${n}/v2/login?redirect=${t}`)}};ne.beforeEach((e,t,s)=>{Object(se["a"])();const i=X["a"].getters.user.company_id?X["a"].getters.user.company_id:void 0;!X["a"].state.companyinfo.company_name&&i?Object(te["i"])({company_id:i}).then(i=>{X["a"].commit("setCompanyInfo",i),re(e,t,s)}).catch(e=>{console.log(e)}):re(e,t,s)});var le=ne,ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.fetchIsPermitted.isResolved?s("fragment",[e.isPermitted?[e._t("default")]:[e._t("forbidden")]],2):e._e()},de=[],ue={props:{perm:Object},data(){return{isPermitted:!1}},created(){this.fetchIsPermitted()},asyncMethods:{fetchIsPermitted(){return Object(ee["b"])(this.perm,!0).then(e=>e)}}},he=ue,pe=Object(u["a"])(he,ce,de,!1,null,null,null),me=pe.exports;function ge(){Object(ee["a"])(),i["default"].component("auth-view",me),new i["default"]({router:le,store:X["a"],render:e=>e(U)}).$mount("#app")}const{protocol:be,pathname:fe,href:ve}=window.location,ye=-1!==ve.indexOf("?")?ve.substring(ve.indexOf("?")):"",we=`${be}//${P["a"].INSIDE_DOMAIN}${fe}${ye}`,xe=e=>{const t=document.getElementById(e);t&&(t.style.display="none")},Ce=(e,t)=>{const s=document.getElementById("app"),i=document.getElementById(e);i?i.style.display="block":s.innerHTML=t;const a=document.getElementById("mainAgainNode");a&&a.addEventListener("click",()=>{je()})},je=async()=>{if(xe("errorNode"),Ce("loadingNode","<div class='main-loading ' id='loadingNode'></div>"),P["a"].INSIDE_DOMAIN){if("1"===sessionStorage.getItem("isInside-v2"))return void window.location.replace(we);const e=await Object(se["d"])({timeout:2e3,method:"get",url:`${be}//${P["a"].INSIDE_DOMAIN}/inside-check.txt`}).then(e=>null===e||void 0===e?void 0:e.data).catch(e=>(console.log(e),!1));if("ok"===e)return sessionStorage.setItem("isInside-v2",e?"1":"0"),void window.location.replace(we)}Object(se["d"])({method:"get",url:"passport/profile"}).then(e=>{e.data.result?(X["a"].commit("setUserInfo",e.data.result),e.data.result.company&&X["a"].commit("setCompanyInfo",e.data.result.company)):console.log("profile数据获取失败"),xe("loadingNode"),ge()}).catch(e=>{console.log(e),xe("loadingNode"),Ce("errorNode","<div class='main-error-info' id='errorNode'><div class='error-circle'><div class='delWrapper'></div></div><div class='error-color'>内部错误，请刷新</div><div class='again' id='mainAgainNode'>重试</div></div>")})};je()},"76da":function(e,t,s){"use strict";s("49e3")},"781f":function(e,t,s){},7866:function(e,t,s){},7919:function(e,t,s){"use strict";s("b360")},"7a10":function(e,t,s){},"7a12":function(e,t,s){"use strict";s("7b73")},"7a7f":function(e,t,s){},"7b40":function(e,t,s){"use strict";t["a"]={type2defaultComponent:{string_:"z-default-text",url_model:"z-default-model",url_image:"z-default-image",array_image:"z-default-image-list",array_mixed:"z-default-image-list",json_:"z-default-json",url_audio:"z-default-audio",url_video:"z-default-video",url_web:"z-default-web",url_mixed:"z-default-web"},getDefaultComponent(e,t,s="z-default-text"){return this.type2defaultComponent[`${e}_${t}`]||s}}},"7b73":function(e,t,s){},"7c9b":function(e,t,s){"use strict";s("f6be")},"7d37":function(e,t,s){"use strict";s("8c5c")},"7dc0":function(e,t,s){},"7ddb":function(e,t,s){"use strict";s("ecd5")},"7e60":function(e,t,s){"use strict";s("7a7f")},"7e82":function(e,t,s){e.exports=s.p+"static/img/sidebar.4b8ca708.svg"},"7eaf":function(e,t,s){"use strict";s("9465")},"7f89":function(e,t,s){},"7fc9":function(e,t,s){"use strict";s("96e9")},"81c6":function(e,t,s){},"81d2":function(e,t,s){},8211:function(e,t,s){},8292:function(e,t,s){},8327:function(e,t,s){"use strict";s("2050")},8393:function(e,t,s){"use strict";s("ff1b")},"83bf":function(e,t,s){"use strict";s("d637")},8416:function(e,t,s){"use strict";s.d(t,"n",(function(){return a})),s.d(t,"p",(function(){return l})),s.d(t,"q",(function(){return o})),s.d(t,"j",(function(){return n})),s.d(t,"m",(function(){return r})),s.d(t,"i",(function(){return c})),s.d(t,"b",(function(){return d})),s.d(t,"f",(function(){return u})),s.d(t,"s",(function(){return h})),s.d(t,"r",(function(){return p})),s.d(t,"u",(function(){return m})),s.d(t,"t",(function(){return g})),s.d(t,"c",(function(){return b})),s.d(t,"l",(function(){return f})),s.d(t,"a",(function(){return v})),s.d(t,"g",(function(){return y})),s.d(t,"k",(function(){return w})),s.d(t,"e",(function(){return x})),s.d(t,"h",(function(){return C})),s.d(t,"d",(function(){return j})),s.d(t,"o",(function(){return O}));s("28eb"),s("f38f");var i=s("9ec3");const a=e=>Object(i["chain"])(e).map(e=>({[e.name||e.metadata.name]:e})).reduce((e,t)=>Object.assign(e,t),{}).value(),o=e=>Object(i["uniq"])(e.replace(/[\r\n]/g,"").split("@_@")).filter(e=>""!==Object(i["trim"])(e)).map(e=>({value:e,label:e})),n=e=>{const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let s="";for(let i=e;i>0;--i)s+=t[Math.floor(Math.random()*t.length)];return s},r=(e,t)=>{let s;if(Object(i["isArray"])(e))s=[],Object(i["forEach"])(e,e=>{s.push(r(e,t))});else if(Object(i["isObject"])(e))s={},Object(i["forEach"])(e,(e,i)=>{s[i]=r(e,t)});else if(Object(i["isString"])(e))try{s=Object(i["template"])(e)(t)}catch(a){s=e,console.error("替换出错",e)}else s=e;return s},l=e=>Object(i["map"])(e,e=>e.metadata),c=()=>{const e=window.getSelection();let t,s,i,a,o=null,n=null;try{var r,l;o=null===e||void 0===e||null===(r=e.anchorNode)||void 0===r?void 0:r.parentNode,n=null===e||void 0===e||null===(l=e.focusNode)||void 0===l?void 0:l.parentNode}catch(c){return null}try{t=o.annotatorElement,s=n.annotatorElement,i=t.startIndex+(null===e||void 0===e?void 0:e.anchorOffset),a=s.startIndex+(null===e||void 0===e?void 0:e.focusOffset)}catch(c){return null}return i>a&&([i,a]=[a,i]),{startIndex:i,endIndex:a}},d={hexToRgba:e=>{const t=d.parseColorString(e);return d.toRgbaString(t)},rgbaToHex:e=>{const t=d.parseColorString(e);return d.toHexString(t)},parseColorString:e=>{const t=e=>{let t=e.slice(1),s=1;3===t.length&&(t=`${t[0]}${t[0]}${t[1]}${t[1]}${t[2]}${t[2]}`),8===t.length&&(s=parseInt(t.slice(6),16)/255,t=t.slice(0,6));const i=parseInt(t,16);return{r:i>>16&255,g:i>>8&255,b:255&i,a:s}},s=e=>{const t=e.match(/(\d(\.\d+)?)+/g)||[],s=t.map(e=>parseInt(e,10));return{r:s[0],g:s[1],b:s[2],a:parseFloat(t[3])}};if(e.startsWith("#"))return t(e);if(e.startsWith("rgb"))return s(e);if("transparent"===e)return t("#00000000");throw new Error("color string error: "+e)},toHexString:e=>{const t=e=>`${e>15?"":0}${e.toString(16)}`,{r:s,g:i,b:a,a:o=1}=e;return`#${t(s)}${t(i)}${t(a)}${1===o?"":t(Math.floor(255*o))}`},toRgbaString:(e,t=1e4)=>{const{r:s,g:i,b:a,a:o=1}=e;return`rgba(${s},${i},${a},${Math.floor(o*t)/t})`},translateOpacity:(e,t=1)=>{let s=d.parseColorString(e);return s.a=t,s=d.toRgbaString(s),s}},u=e=>{const t=document.createElement("a");return t.setAttribute("href",e),t.href},h=[{value:"https://www.baidu.com",label:"百度"},{value:"https://www.google.com",label:"google"},{value:"https://www.sogou.com",label:"搜狗"}],p=(e,t)=>{const s=Object(i["find"])(h,t=>t.label===e).value;"百度"===e?window.open(`${s}/s?wd=${t}`):"搜狗"===e?window.open(`${s}/web?query=${t}`):window.open(`${s}/search?q=${t}`)},m=[{value:"https://fanyi.baidu.com",label:"百度"},{value:"https://translate.google.com",label:"google"},{value:"https://fanyi.sogou.com",label:"搜狗"}],g=(e,t)=>{const s=Object(i["find"])(m,t=>t.label===e).value;"百度"===e?window.open(`${s}/#en/zh/${t}`):"搜狗"===e?window.open(`${s}/text?keyword=${t}`):window.open(`${s}/?sl=auto&tl=zh-CN&op=translate&text=${t}%0A`)},b=e=>{try{let t=e;return t=Object(i["isString"])(e)?e:Object(i["isObject"])(e)?JSON.stringify(e):String(e),(t||"").replace(/&#x([\dA-Fa-f]+);/g,(e,t)=>String.fromCodePoint(parseInt(t,16)))}catch(t){return console.log("convertUnicodeToString",e,t),e}},f=e=>{let t=e;return t=t.replace(/\\text\{([a-zA-Z]+)·([a-zA-Z]+)\}/g,"\\text{$1} \\cdot \\text{$2}"),t=t.replace(/([a-zA-Z]+)·([a-zA-Z]+)/g,"\\text{$1} \\cdot \\text{$2}"),t=t.replace(/\{array\}\{\*\{\d+\}\{([lcr]+)\}\}/g,"{array}{$1}"),t},v=e=>{const t=(e||"").replace(/\s+/g,"");return t.length},y=e=>e>=0&&e<26?"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[e]:e,w=e=>!!Object(i["isNil"])(e)||!(!Object(i["isString"])(e)||!Object(i["isEmpty"])(e)),x=(e,t)=>{const s="string"===typeof e?e:JSON.stringify(e);let i=0;for(let o=0;o<s.length;o++)i=(i<<5)-i+s.charCodeAt(o),i|=0;const a=Math.abs(i).toString(16);return a.padStart(t,"0").substring(0,t)},C=(e="",t,s)=>{const i=e=>{const t=1e4*Math.sin(e);return t-Math.floor(t)},a=e=>{let t=0;for(let s=0;s<e.length;s++)t+=e.charCodeAt(s)*(s+1);return t},o=!e||""===e,n=o?0:a(e),r=[];for(let l=0;l<t;l++){const e=Array.from({length:s},(e,t)=>t);for(let t=s-1;t>0;t--){let s;if(o)s=Math.floor(Math.random()*(t+1));else{const e=n+1e3*l+t;s=Math.floor(i(e)*(t+1))}[e[t],e[s]]=[e[s],e[t]]}r.push(e)}return r},j=(e={})=>{let t=null;const s={get(e,s){if(s===Symbol.toPrimitive)return()=>"";if("toString"===s)return()=>"[SafeObject]";if("valueOf"===s)return()=>0;if("function"===typeof Array.prototype[s])return Array.isArray(e)?Array.prototype[s].bind(e):Array.prototype[s].bind([]);if(s===Symbol.iterator)return function*(){};if(s in e){const i=e[s];return"function"===typeof i?i.bind(t):i}return t},set(e,t,s){return e[t]=s,!0},apply(e,s,i){return"function"===typeof e?e.apply(s,i):t}};return t=new Proxy("function"===typeof e?e:Object.assign(()=>{},e),s),t},O=e=>{if(Object(i["isString"])(e)&&e.match(/^\${(.+)}$/)){const t=e.replace(/^\${(.+)}$/,"$1"),s=j(),i=new Function("input","output","objOutput","groupOutput","return "+t);return i(s,s,s,s)}return e}},"84c8":function(e,t,s){"use strict";s("81d2")},8673:function(e,t,s){e.exports=s.p+"static/img/line.32357b39.svg"},8841:function(e,t,s){"use strict";s("04d4")},"885f":function(e,t,s){"use strict";s("6430")},"888c":function(e,t,s){},"88b7":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAjCAYAAADxG9hnAAAABmJLR0QA/wD/AP+gvaeTAAAEqElEQVRYhcWXTWxUVRTH/3dCO5AgNEiBIhslfLhhoRBIQ4RIkLohEhyJIIuyalKK0o2gILYQWKHIl8alhgidGKPEaKIpGGNAYNBQ+QgGSIBOaevQUgZsmXR+Lt558PqYodORhpNM7nvnno//O+fcc88ImAbsAMr1JAnYjkctwIQnCaTcQAwKBogCVcCnwAmgA7hnvw7j7TeZaLFgzhiY80BFaH+yOe+hcLplOhX5/BYMBhgJbAPuGD8LnAI2A/OBiUCJ/SYa7wMgEQCUBhqBkQWD+WTfl5VtNzrSZuBv4HQAwCFg+hA+bAbQZLoAxwqOzvKVtc3VNRtobb3RF/iiK8Ccgr/mYUBzgUtm6xowK5dcZMBLJrLizp1/z2/auqs02dbhszOSrhcLxDn3u6Q5kpolTZH0A/DMYOhH3bzZnVj/7naqazbQmrzRG6yZYsGY7VLgSCBN+WvGCpOurluXY2+tO1tds4HrrY8VzPhAmhqCe5GA0GRJ6yVRVjZmhfpY2NOTbtm8dVe0NdneJ2mmpOb/A8Y594+kVZKQVA9MyoX2M0N6yOfFYnXly1euPTMMkYmbrX3hjSheA8qGj+hwgAFmmq9uoDS48ao5OJlLcZjA+D1qifSgRpba+l0OhaebmnbXv7Jg/rIcNXPaBwOMAKqt8X0P7ASmPgLLtyHfEt5lBTA/B5CpFsYvBkQm2X4vEJkp5vwgsAR4EVgHJIHKPBF5yfSPB5mdxpyYB8hF4GcgFgSTbOvoN7024BfAhXQXG9BIDrsVptsuPUjNGFu78oQxK6la0o6mpt0lkYxb1NeXufR+w0cRS9MkSc/Zep+ccz9JcpKezWHzpq1jg+j8u6U0LG0RuWDPq4AfAZdInK2qXd+Q9jpwu3+x5RohDvsFGeJHTac3yBwsNRcC7weBWmBeKtV9PE/NVATkfwNm57CbMzWXbZ2WI4RhqpX0jqQZ48aNzUQyblHJiBGpzY0fl4Q7MN60N13ShRx2fF+Xg0AStr48GArnXEpSnaSdkhSP7+l8fWlV1VOjR2dCR/uopAOSPnfOpYFRwGsBU76vxH0O3owJkFCIwqkJ8PcDv/rvicRfS9bWN94NnaZO7MoHXgBSwGh7/9NkFgeNBlv8jMGiko9isbryN1a/fS7fCOEfb+B527vf4iOS5JzrkxdGJ2lrsUDi8T2d9GYX9PSkWzY1PnxrO+cw0W22HnDO3RtgxIorbVGZWywY6dF3E1BpPm6TawwwMI2mdAkYPwxgLgJX7XlLXmW8vw/HTPAIUPK4wARqBuAkoT9gA+4A51yvpGWSrklaKC+3Rf8Njcf3dEYyblE6fffcpsZd0cBAXiZp3KAGgFl4o7+fpnnFggEqu7puXQ0M5P51Utg8Y4XlpymLN94VfLTxprCvTZdUqvuEf7SHPFxZzTTYafLpNLAFb56YZD0oas8LgA+BPwLyt00+6tfMmpqNtCbbfTCHC/04mZN9eA2oUOoG9hK6SJetrpmw/M21LWtqNtJy9mJXf39/veQ1sKEAKpVXxEslzZY3Z5TZdrekK5JOyRs5jz7UrIxisbrybCmHs1m9981Xe5uHgmE4aEAQ/gNRtSItiNxV7gAAAABJRU5ErkJggg=="},"88d5":function(e,t,s){},"8ad2":function(e,t,s){"use strict";s("1fba")},"8b52":function(e,t,s){"use strict";s("abd3")},"8c5c":function(e,t,s){},"8ca9":function(e,t,s){},"8cfc":function(e,t,s){"use strict";s("04f9")},"8dc3":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("t-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.content,expression:"content",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:function(){return e.$Message.success("已复制到剪贴板")},expression:"() => $Message.success('已复制到剪贴板')",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:function(){return e.$Message.error("复制失败")},expression:"() => $Message.error('复制失败')",arg:"error"}],attrs:{variant:"text",size:"small"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"file-copy",size:"14"}})]},proxy:!0}])})},a=[],o={name:"CopyBtn",props:{content:{type:String,default:""}}},n=o,r=s("2be6"),l=Object(r["a"])(n,i,a,!1,null,null,null);t["a"]=l.exports},"8e65":function(e,t,s){},"900f":function(e,t,s){},9035:function(e,t,s){},"912b":function(e,t,s){e.exports=s.p+"static/img/large.5a2d1bd7.png"},9150:function(e,t,s){},"91a2":function(e,t,s){"use strict";s("14f5")},"91a7":function(e,t,s){"use strict";s("d561")},"922f":function(e,t,s){"use strict";s("7dc0")},"93c0":function(e,t,s){},"93d2":function(e,t,s){},"940b":function(e,t,s){},9416:function(e,t,s){"use strict";s("940b")},9465:function(e,t,s){},"96e9":function(e,t,s){},9801:function(e,t,s){"use strict";s("d9a5")},"98f2":function(e,t,s){},9917:function(e,t,s){"use strict";s("27ea")},"9a35":function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.showValue||e.showValidator?i("div",{staticClass:"suggest-container"},[i("t-row",{staticClass:"mbs",attrs:{justify:"space-between",align:"center"}},[i("img",{attrs:{src:s("c38f")}})]),e.showValue?[void 0!==e.value.result?i("div",[e._v("【评估结果】"),i("span",{class:e.value.result?"txt-green":"txt-red"},[e._v(" "+e._s(e.value.result?"通过":"不通过"))])]):e._e(),e.value.suggest?i("div",[e._v("【建议】"+e._s(e.value.suggest))]):e._e(),e.value.reason?i("div",[e._v("【说明】"+e._s(e.value.reason))]):e._e()]:e._t("default"),e.showValidator?[i("div",[e._v("【判定结果】"),i("span",{class:e.validator.result?"txt-green":"txt-red"},[e._v(" "+e._s(e.validator.result?"通过":"不通过"))])]),e.validator.value?i("div",[e._v("【建议值】"+e._s(e.validator.value))]):e._e(),e.validator.reason?i("div",[e._v("【说明】"+e._s(e.validator.reason))]):e._e()]:e._e()],2):e._e()},a=[],o={props:{scene:{type:String,default:"label"},value:{type:Object},validator:Object},data(){return{thumb:null}},computed:{showValue(){return this.value&&![this.value.result,this.value.suggest,this.value.reason].every(e=>void 0===e)},showValidator(){return this.validator&&![this.validator.result,this.validator.value,this.validator.reason].every(e=>void 0===e)}},methods:{handleThumb(e){this.thumb===e?this.thumb=null:this.thumb=e}}},n=o,r=(s("166a"),s("2be6")),l=Object(r["a"])(n,i,a,!1,null,"4f6e861d",null);t["a"]=l.exports},"9abe":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADTklEQVRYhbWXyWtUQRDGvx41iSC4JJqZiKJGEz2o4JYQghtIFCF68Q/woqIo/gMaDYInD4JR8eBBEIziwYAXcYMQXKO5GTSLuIFIJG6gHubn4dUznZc3mTeOKRimu7qqvu91V3dXOyUUoFTSJkk7JK2WtEDSDBselvRa0lNJHZLuOed+JY2dD7gKOAd8Jbl8MZ9MMcBlwAnghwXNAk+BI0AjUAlMsV+l6Y4C3R6R70ArUFYoeAZ45AG3AzUF+NcCV80X4EHi2QBWAu/M8RWwtiD2o2PVAf0W6y2wIp9D2gwBOoHZ/wruxZwF3LGY74G5uQynetN+F5hSLLgXuwS45y3H2JywhAunvfx/gXvxK7zlOB4drLJszxaz5glI1BvGNyDtD5w3Zu0TBe5hXTOstlBRSnBwZAvZakUQWGpYw0CJgG3G6MlEg3sknhlmU0pSs+k7YgzLgZPA9Ih+PrDP608GdtuBdRM4BVSPw+GG/TcLeGxsGmMIVNt0XYro64FOa08y0CtAE7AaOAR8ABpyzMB6w3wo4JN1KnMQeAncBnblILAXuAW4iO8W4AWQiombMcyPAn5ZpyQHgV5gHtAHVMUQuAFsz/GlvXFLYYkP8HMMuzhxzr2V1CLpYvRLJS2S1JfD9ZWkxePFTkn6au2ZeUhcVlB47I8MfdZIYRKVWZKGcugl6UtK0oB1loxHwOSApMOSaj1dj6SmqCEwR1KNpN6YOCHWQEpSt3U250N3zg1JOijplKc+LWmPn/G2bS9KuuCc+05w0e30fEKsbgFbLSG6FZEwCWP0Z8MktP46gkqoF+giuHZbwx0ArAKGgGnW7zHMLdGjuDYKVogQ1BOLiLnKw+QFlhn48N+dZ18EcLUYAglJXjesNl+ZISggs0DdBII3EHcd22CrMesHKiYAvAIYNIyWOIMygnIJgvLpf5dk9y12F8EjJ9YwDbwxw07by8WClzO6KK3K57CCkcq4H6gvArzBm/Y3wPKkjhlvObIEZVTiLUpQ9Vxn5GHSNSbpEgQpA47b7gjlGdBCcJ+nCc6QUmtvAI4Bzz37b2Yfv+YJiaSBNoKDI6kMA2eIqTGiEr1axyNSImmjghJujaSFGv08H9TI8/y+c+53krh/AAKmks63Bu7wAAAAAElFTkSuQmCC"},"9c14":function(e,t,s){},"9d3e":function(e,t,s){},"9e01":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAADTklEQVRYhbWXyWtUQRDGvx41iSC4JJqZiKJGEz2o4JYQghtIFCF68Q/woqIo/gMaDYInD4JR8eBBEIziwYAXcYMQXKO5GTSLuIFIJG6gHubn4dUznZc3mTeOKRimu7qqvu91V3dXOyUUoFTSJkk7JK2WtEDSDBselvRa0lNJHZLuOed+JY2dD7gKOAd8Jbl8MZ9MMcBlwAnghwXNAk+BI0AjUAlMsV+l6Y4C3R6R70ArUFYoeAZ45AG3AzUF+NcCV80X4EHi2QBWAu/M8RWwtiD2o2PVAf0W6y2wIp9D2gwBOoHZ/wruxZwF3LGY74G5uQynetN+F5hSLLgXuwS45y3H2JywhAunvfx/gXvxK7zlOB4drLJszxaz5glI1BvGNyDtD5w3Zu0TBe5hXTOstlBRSnBwZAvZakUQWGpYw0CJgG3G6MlEg3sknhlmU0pSs+k7YgzLgZPA9Ih+PrDP608GdtuBdRM4BVSPw+GG/TcLeGxsGmMIVNt0XYro64FOa08y0CtAE7AaOAR8ABpyzMB6w3wo4JN1KnMQeAncBnblILAXuAW4iO8W4AWQiombMcyPAn5ZpyQHgV5gHtAHVMUQuAFsz/GlvXFLYYkP8HMMuzhxzr2V1CLpYvRLJS2S1JfD9ZWkxePFTkn6au2ZeUhcVlB47I8MfdZIYRKVWZKGcugl6UtK0oB1loxHwOSApMOSaj1dj6SmqCEwR1KNpN6YOCHWQEpSt3U250N3zg1JOijplKc+LWmPn/G2bS9KuuCc+05w0e30fEKsbgFbLSG6FZEwCWP0Z8MktP46gkqoF+giuHZbwx0ArAKGgGnW7zHMLdGjuDYKVogQ1BOLiLnKw+QFlhn48N+dZ18EcLUYAglJXjesNl+ZISggs0DdBII3EHcd22CrMesHKiYAvAIYNIyWOIMygnIJgvLpf5dk9y12F8EjJ9YwDbwxw07by8WClzO6KK3K57CCkcq4H6gvArzBm/Y3wPKkjhlvObIEZVTiLUpQ9Vxn5GHSNSbpEgQpA47b7gjlGdBCcJ+nCc6QUmtvAI4Bzz37b2Yfv+YJiaSBNoKDI6kMA2eIqTGiEr1axyNSImmjghJujaSFGv08H9TI8/y+c+53krh/AAKmks63Bu7wAAAAAElFTkSuQmCC"},"9e66":function(e,t,s){"use strict";s("4164")},a053:function(e,t,s){},a1b2:function(e,t,s){"use strict";s("a890")},a3f0:function(e,t,s){e.exports=s.p+"static/img/center.f6f29c14.svg"},a457:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAACLhJREFUeF7tnVFu2zoURK2dJStLurJmZ3pQ4AcEbVKLM9KMJJ8A/arGlzzU8SVtA5pu/EEAAj8SmGADAQj8TABBuDsg8A8CCMLtAQEE4R6AgEaADqJxI/UkBBDkSRaaaWoEEETjRupJCCDIkyw009QIIIjGjdSTEECQJ1lopqkRQBCNG6knIYAghYWe5/nldrst/0b+PqZp+hgJcK1PAEF8hsOvcBfk92DwFUEGiW1wOYJsAHH0JRBklFjvegQpsEeQAnSxJIKI4JwYgjj0slkEyfL+rIYgBehiSQQRwTkxBHHoZbMIkuVNBynwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62SyCZHlzBinwdkoiiENPzNJBRHCFGIIUoCNIAbpYEkFEcE4MQRx62ezugszzvDxJafRxY2sp/Jqm6X3txUcZy96CzPO8MHlby2XwuuVRcK9rM0cay9oxf70OQRRq32dWy4ogm0EfklWpiiAKNQShg2x13xxlW7PM5yhjoYNsdXfd6CAPUK7e1iBI56bkDPKA+1HetREEQRQCnEEUapxBOINsdd/QQf4myRlkq7uLM8gjkpxBviF0pH3/kcby6Gb67v/ZYinU2GKxxdrqvmGLxRbrKN/qK/c0HUShRgehg2x139z3oI9ebr7dbpKsg7/FWvO7rd3HEjqky/N4tFgC80OM5dG8KmcQZVBXz+wtyNX5JecnvWsnB3jFWghynlVFkMJaIUgBulgSQURwTgxBHHrZLIJkeX9WQ5ACdLEkgojgnBiCOPSyWQTJ8qaDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSyJICI4J4YgDr1sFkGyvDmDFHg7JRHEoSdm6SAiuEIMQQrQEaQAXSw5LMh9ccVyxL4Q+D1IY/VjzwZf96kun6bpY2TCiiDLY8zeRopwLQQOQmDoseHLmBHkICvHMCIEECSCmSJnJYAgZ105xh0hgCARzBQ5KwEEOevKMe4IAQSJYKbIWQkgyFlXjnFHCCBIBDNFzkoAQc66cow7QgBBIpgpclYCCHLWlWPcEQIRQV4iU7l+EX6sWFjj3X+sWJjT5Uryc/fzLOnwjxXPM7XjjhRBjrs2f44MQQprhSAF6GJJBBHBOTEEcehlswiS5f1ZDUEK0MWSCCKCc2II4tDLZhEky5sOUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLEkgojgnBiCOPSyWQTJ8uYMUuDtlEQQh56YpYOI4AoxBClAR5ACdLHk7oLM8/wujm1VbJqm1a9/lLHsLchR5rks4JHGsuqG+uOihCDLo8b2emzb0DPn5nk+xFhCgrwpN8SKzMc0Ta8rrvv/vLW8gR1iLGvH/PU6BFGofZ9ZLSuCbAZ9SFalKoIo1BCEDrLVfXOUbc19P8wWy1/YoXft+xmELdZP3BHkbzJssXxL768wJKtSlS2WQo0tFlusre4bOggdhE+x/mHTzoK8T9P0a63MRxlLYIu17PlXfz+0lp+yrZnn+TBjGZzn5+VssRRqbLHYYm113+z8rr36uwc+xdpqRW9DB2M+xXrAfWdB2GJ9w/9I25ojjUV5izj7FgtBEGT1du+QgiiDunpm70P61fkl57d7B0lO5iy1EOQsKxX4FOs8KHIjRZAca7cSHcQlKOQRRIBWiiBIATyCFKCLJRFEBOfEEMShl80iSJb3ZzUEKUAXSyKICM6JIYhDL5tFkCxvOkiBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAB1BCtDFkggignNiCOLQy2YRJMubM0iBt1MSQRx6YpYOIoIrxBCkAP0uyMtg6eXhmR+DGS43CSCICZD4tQkgyLXXl9mZBBDEBEj82gQQ5Nrry+xMAghiAiR+bQIIcu31ZXYmAQQxARK/NgEEufb6MjuTAIKYAIlfmwCCXHt9mZ1JAEFMgMSvTQBBrr2+zM4k8B/EwXUU8LcJBwAAAABJRU5ErkJggg=="},a460:function(e,t,s){},a4f4:function(e,t,s){},a5c4:function(e,t,s){},a75f:function(e,t,s){"use strict";s("a053")},a890:function(e,t,s){},a8ae:function(e,t,s){s("8d0d"),s("3b2d"),s("e45f");const i=e=>{e.inline.ruler.before("link","reference",(e,t)=>{const{pos:s}=e;if(91!==e.src.charCodeAt(s))return!1;const i=e.src.indexOf("]",s);if(-1===i)return!1;if("(@ref)"!==e.src.slice(i+1,i+7))return!1;const a=e.src.slice(s+1,i);if(!/^[0-9,\s]+$/.test(a))return!1;const o=i+7-s;if(t)return!0;const n=a.split(",").map(e=>e.trim()).filter(e=>e.length>0);if(0===n.length)return!1;const r=e.push("ref_open","span",1);r.attrSet("class","ref-list"),r.attrSet("data-refs",n.join(",")),r.markup="[",n.forEach(t=>{const s=e.push("ref_item","span",0);s.attrSet("class","ref"),s.content=t});const l=e.push("ref_close","span",-1);return l.markup="](@ref)",e.pos+=o,!0}),e.inline.ruler.after("escape","math_inline",(e,t)=>{const s=e.pos;if("$"!==e.src[s])return!1;const i=e.src.indexOf("$",s+1);if(-1===i)return!1;if(!t){const t=e.push("math_inline","",0);t.markup=e.src.slice(s,i+1),t.content=e.src.slice(s+1,i)}return e.pos=i+1,!0}),e.inline.ruler.before("escape","math_inline_double",(e,t)=>{const s=e.pos;if("$$"!==e.src.slice(s,s+2))return!1;const i=e.src.indexOf("$$",s+2);if(-1===i)return!1;if(!t){const t=e.push("math_block","",0);t.markup=e.src.slice(s,i+2),t.content=e.src.slice(s+2,i)}return e.pos=i+2,!0}),e.block.ruler.after("blockquote","math_block",(e,t,s,i)=>{let a,o,n,r,l=!1,c=e.bMarks[t]+e.tShift[t],d=e.eMarks[t];if(c+2>d)return!1;if("$$"!==e.src.slice(c,c+2))return!1;if(a=e.src.slice(c,d),a.includes("$$",2))return!1;if(c+=2,a=e.src.slice(c,d),i)return!0;for(n=t;!l;){if(n+=1,n>=s)break;c=e.bMarks[n]+e.tShift[n],d=e.eMarks[n];const t=e.src.slice(c,d);t.includes("$$")&&(r=c+t.indexOf("$$"),o=e.src.slice(c,r),l=!0)}e.line=n+1;const u=e.push("math_block","",0);return u.block=!0,u.content=(a&&a.trim()?a+"\n":"")+e.getLines(t+1,n,e.tShift[t],!0)+(o&&o.trim()?o:""),u.map=[t,e.line],u.markup="$$",!0},{alt:["paragraph","reference","blockquote","list"]}),e.inline.ruler.before("escape","math_inline",(e,t)=>{const s=e.pos;if("\\("!==e.src.slice(s,s+2))return!1;const i=e.src.indexOf("\\)",s+2);if(-1===i)return!1;if(!t){const t=e.push("math_inline","",0);t.markup=e.src.slice(s,i+2),t.content=e.src.slice(s+2,i)}return e.pos=i+2,!0}),e.inline.ruler.before("escape","math_block",(e,t)=>{const s=e.pos;if("\\["!==e.src.slice(s,s+2))return!1;const i=e.src.indexOf("\\]",s+2);if(-1===i)return!1;if(!t){const t=e.push("math_block","",0);t.markup=e.src.slice(s,i+2),t.content=e.src.slice(s+2,i)}return e.pos=i+2,!0}),e.inline.ruler.at("emphasis",(e,t)=>{if(42!==e.src.charCodeAt(e.pos)||42!==e.src.charCodeAt(e.pos+1))return!1;let s=e.pos+2;const i=e.src.indexOf("**",s);if(-1===i)return!1;while(s<i&&32===e.src.charCodeAt(s))s+=1;if(s>=i)return!1;if(!t){const t=e.push("strong_open","strong",1);t.markup="**",e.md.inline.parse(e.src.slice(s,i),e.md,e.env,e.tokens);const a=e.push("strong_close","strong",-1);a.markup="**"}return e.pos=i+2,!0}),e.inline.ruler.after("emphasis","em",(e,t)=>{if(42!==e.src.charCodeAt(e.pos)||42===e.src.charCodeAt(e.pos+1))return!1;let s=e.pos+1;const i=e.src.indexOf("*",s);if(-1===i)return!1;while(s<i&&32===e.src.charCodeAt(s))s+=1;if(s>=i)return!1;if(!t){const t=e.push("em_open","em",1);t.markup="*",e.md.inline.parse(e.src.slice(s,i),e.md,e.env,e.tokens);const a=e.push("em_close","em",-1);a.markup="*"}return e.pos=i+1,!0}),e.renderer.rules.ref_open=function(t,s){const i=t[s].attrs.find(e=>"data-refs"===e[0]);return i?`<span class="ref-list" data-refs="${e.utils.escapeHtml(i[1])}">`:'<span class="ref-list">'},e.renderer.rules.ref_item=function(t,s){const i=e.utils.escapeHtml(t[s].content);return`<span class="ref">${i}</span>`},e.renderer.rules.ref_close=function(){return"</span>"},e.core.ruler.before("normalize","add_break_before_image",e=>{const{src:t}=e,s=t.replace(/!\[(.*?)\]\((.*?)\)/g,(e,s,i,a)=>{const o=t.slice(a-1,a);return"\n"!==o?"\n\n"+e:e});e.src=s})};e.exports=i},a8e7:function(e,t,s){},ab17:function(e,t,s){"use strict";s("8211")},abd3:function(e,t,s){},ac2c:function(e,t,s){"use strict";s("0679")},ad58:function(e,t,s){"use strict";s("1d30")},aeb7:function(e,t,s){"use strict";s("8ca9")},af7e:function(e,t,s){},b007:function(e,t,s){"use strict";s("c66b")},b042:function(e,t,s){"use strict";s("69d3")},b148:function(e,t,s){},b169:function(e,t,s){},b16a:function(e,t,s){"use strict";s("26ef")},b1db:function(e,t,s){"use strict";s("3257")},b1ec:function(e,t,s){},b1f0:function(e,t,s){"use strict";s("48bc")},b209:function(e,t,s){"use strict";s("beb7")},b30d:function(e,t,s){},b360:function(e,t,s){},b5ef:function(e,t,s){e.exports=s.p+"static/img/center.58e488fb.png"},b706:function(e,t,s){e.exports=s.p+"static/img/gridOn.2c2b3ae6.svg"},b8cf:function(e,t,s){"use strict";s("900f")},b924:function(e,t,s){},b9c1:function(e,t,s){"use strict";s("1cfb")},ba57:function(e,t,s){},bd27:function(e,t,s){"use strict";s("c7a8")},bd3b:function(e,t,s){},bd97:function(e,t,s){"use strict";s("4a32")},beb3:function(e,t,s){},beb7:function(e,t,s){},bec9:function(e,t,s){"use strict";s("df32")},c156:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAAhxJREFUeF7tmlFywzAIROEm7U2ak7U5WXOU3ESN2jqTKI4L2cU1E/zjH5ClxyJhRirJntbam4i8i0h/I89BRPaKjPAfvq21T8Lip6kfMgJoTPAFgElzjbFaa1cKUFVXEG/815g08xsFoBRQKVB7wOWeUptgnQJ1DFYd4KkzqhAa6wgPvS3YViU4RBANimsDQT/G8B8VgI6ZEcDTN0R6K6xDQJ+0LbEbAN5y+KqURjGu7f/bFL1UwEFVd4/OQ+ldVtUurbBnpim6U+CbHQB3UwGiYaE2cwrAALhdVuffmWXRk82M/AXJ/z5uV0BmAFD+zwLwEkVLU6cCxnSF5J8RwKjW5wEQkf+pFMA+/6fUu9kEt7oHsM//jADo+Z8mBaLyPzMA+PxPlQJR+Z9JASH5nwJAZP5nBUDL/xQ/Q5H5nwVAWP5PAJgNkaOqvnr+8JZso/N/AsC6eDitZX/qiXwwIETV/7Sm6KmX0hfab22ODwVCdP5/KwCNVCQEdv9vbq0wgD7oAoSjiLygkM9la0C/kQLgDwis9VPP/zNU1uxWgAC3v8JS4HLghXRAWecAcE8JW+000faAMbxouxz1t8qtAFhJee3QCKL+1vmWAqykvHZoBFF/63xLAVZSXjs0gqi/db6lACsprx0aQdTfOt9SgJWU1w6NIOpvne9qCrBO6J6d91/C+r0CYCXltcty/S5SAaxu88+dXuAy5FLwvgA9xQwRaqamwgAAAABJRU5ErkJggg=="},c189:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAu5JREFUaEPtmDFrFUEURr9T2GgjgoIi2IiFFmqljYVYaSGKGDBIwKBBUQhKxCCKiSASMSgBRYkSIcZEA/4PbaysrK38Edcs7JP31n13ZndnXwhk2529e87cuXOHQRv8YYPza1NgvTPYegbMbL+k05K+A99SC7cqYGYXJX3pgn4MPEop0ZpACXyH+wnwIJVEKwIOfIf7KXA/hURygQj4Dvcz4F5TiaQCDvyUpKweDhWAZ4GJJhLJBDx4YNrMDuYFXZR4CdyuK5FEIATfgXMk5oDxOhKNBRz4aSBbOj2PI/EKuFVVopFAVfiITLwBblSRqC1QFz5CYh4Yi5WoJRDYKqO7rbOc3gNXYyQqC0Tu89Hd1pH4AFwJSVQScOB/luzxM8BkCCB770gsAiNejGgBB/6hpK999vjnwN2GEkvA5X4xogQc+ElgJjCLL4A7DSVWgEtlMYICDvwEMNsdNEWjcmKsAkNFCVfAgR8H5spmJEWjcmLsBX53/7evgAN/E3jtLQkH4C1wPbSczOxwXlMHCmN3AX+CAg78GDAfAgjUxLu1WbzWL4aZHZe0ImlfYUzp0eS/DDjwo8BCDHxEt10ARouxzOykpCVJuwvvprITbbCIHfgRYLEKfIREzx5vZmckZf/YEQufjfuXgfz24FcJ5DCwXAc+QmIZGDazc5I+StpWBb4okB19izcGQ8BqE/gIiezW4rykLVXhiwJHJP0ogR2ERPG3fde82wfMrCwL2TeDlIiG78lAV6rXU6J0q/SWcGkjazMTZnY0b1LZlWP3Uxm+NANtZsLMjkn6HNukYjaP0Fko2XIysxN5h92TYuY7MWJOo40lzOyUpKyX7EwJ7y6h7h81qQkzy67WP0nanho+WiAbWEfCzM7mM7+1DfhKAlUlzOxCDl/ssLV2m34FHayB4odOJmI2jdpj1k6jpayVBQKZqA0Y+jCpwHpIJBcYtEQrAqG0D+J9rRoYBFjsPzYFYmeqrXGbGWhrZmPj/gWcUXNAv9o5IAAAAABJRU5ErkJggg=="},c262:function(e,t,s){"use strict";s("b1ec")},c280:function(e,t,s){"use strict";s("4a1a")},c30b:function(e,t,s){"use strict";s("beb3")},c38f:function(e,t,s){e.exports=s.p+"static/img/robot.6fb05cab.svg"},c495:function(e,t,s){"use strict";s.d(t,"b",(function(){return f})),s.d(t,"a",(function(){return aA}));var i={};s.r(i),s.d(i,"getId",(function(){return fc})),s.d(i,"max",(function(){return vc})),s.d(i,"min",(function(){return yc})),s.d(i,"absMax",(function(){return wc})),s.d(i,"Observer",(function(){return xc})),s.d(i,"style",(function(){return Cc})),s.d(i,"requestAnimationFrame",(function(){return jc})),s.d(i,"frame",(function(){return Oc})),s.d(i,"debounce",(function(){return Ac.a})),s.d(i,"preventClick",(function(){return _c})),s.d(i,"fetchFile",(function(){return $c})),s.d(i,"clamp",(function(){return Mc})),s.d(i,"withOrientation",(function(){return Dc})),s.d(i,"ignoreSilenceMode",(function(){return Pc}));s("8d0d");var a=s("9ec3"),o=s.n(a),n=s("8416"),r=s("c6f0");const l=["output","objOutput","groupOutput"],c=(e,t,s)=>{const i=e.match(/^\${(.+)}$/);if(null===i)return e;const[,o]=i,n=Object(r["tokenize"])(o),c=Object(a["some"])(n,(e,t)=>"Identifier"===e.type&&Object(a["some"])(l,s=>{var i;return e.value===s&&"."!==(null===(i=n[t-1])||void 0===i?void 0:i.value)}));if(!c){const i={input:{}};for(const[e,s]of Object.entries(t))i.input[e]=s;const o=e.includes("function")?e.replace(/^\${(.+)}$/,"<%=$1%>"):e,n=Object(a["template"])(o)({...t,...i});return s?n:h(n)}const d=n.map(e=>e.value),u=d.includes("return"),p=d.includes("+")||d.includes("-")||d.includes("*")||d.includes("/")||d.includes("%");let g=o;return p&&!u&&(g=m(d)),{$expression:g,$expressionFn:new Function("input","output","objOutput","groupOutput",`\n      function createResult(value, deps) {\n        const DEPS = Symbol('deps');\n        const VALUE = Symbol('value');\n\n        return {\n          [VALUE]: value,\n          [DEPS]: deps,\n          getValue() { return this[VALUE]; },\n          getDeps() { return this[DEPS]; }\n        };\n      }\n\n      return ${g}\n      `)}},d=(e,t,s)=>{let i;if(Object(a["isArray"])(e))i=[],Object(a["forEach"])(e,(e,a)=>{const o=[...s,a];i.push(d(e,t,o))});else if(Object(a["isObject"])(e))i={},e.component&&(i.$rawConfig=Object(a["cloneDeep"])(e),i.$path=s.join(".")),Object(a["forEach"])(e,(e,a)=>{if(a.startsWith("$")&&!["$object_items","$object_tools"].includes(a))i[a]=e;else{const o=[...s,a];i[a]=d(e,t,o)}});else if(Object(a["isString"])(e))try{const a=null!==e.match(/^\${(.+)}$/)&&"value"===s.pop()&&"attributes"===s.pop();i=c(e,t,a)}catch(o){i=e,console.error("[OPTIMUS ENGINE] 渲染出错:",{path:s.join("."),str:e,context:t})}else i=e;return i},u=(e,t,s)=>{if(Object(a["isArray"])(e))Object(a["forEach"])(e,e=>{u(e,t,s)});else if(Object(a["isObject"])(e)){if(e.attributes){const{component:i,attributes:{name:o,value:r,options:l}}=e;if("z-group"!==i&&o&&void 0===t[o])if(r&&Object(a["isFunction"])(r.$expressionFn)){const e=s;let[i,c,d,u]=[void 0,"",!1,void 0];Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get(){try{let s,o;if(!r.$expression.includes("objOutput")||Object.keys(e.objOutput).length){const i=p(r.$expressionFn(e.input,e.output,e.objOutput,e.groupOutput));if(l){let o=[];o=Object(a["isString"])(l)?l.includes("@_@")?Object(n["q"])(l):JSON.parse(l):null!==l&&void 0!==l&&l.$expressionFn?l.$expressionFn(e.input,e.output,e.objOutput,e.groupOutput):l;const r=o.map(e=>e.value);let c;try{c=Object(a["isString"])(i)?JSON.parse(i):i}catch(t){c=i}const d=Object.getOwnPropertySymbols(c).length?c.getValue():c;s=d.every(e=>r.includes(e))?d:[]}else s=Object.getOwnPropertySymbols(i).length?i.getValue():i;o=Object.getOwnPropertySymbols(i).length?null===i||void 0===i?void 0:i.getDeps():void 0}return d?(d=!1,i=""+s,u=""+o,c):i===""+s&&u===""+o?c:(i=void 0,u=void 0,s)}catch(s){console.log(s),console.error("[OPTIMUS ENGINE] 表达式配置出错 2:",r.$expression)}},set(e){d=!0,c=e}})}else t[o]=r}e.items&&u(e.items,t,s)}},h=e=>"true"===e||"false"!==e&&(/^[+-]?(\d|[1-9]\d+)(\.\d+)?$/.test(e)?Number(e):e),p=e=>Object.getOwnPropertySymbols(e).length?e:Object(a["isNumber"])(e)||Object(a["isBoolean"])(e)?String(e):Object(a["isObject"])(e)?JSON.stringify(e):e,m=e=>{let t="",s=[];for(const i of e)["+","-","*","/","%","(",")"].includes(i)?(s.length>0&&(t+=["input","output","objOutput","groupOutput"].includes(s[0])?`Number(${s.join("")})`:s.join(""),s=[]),t+=i):s.push(i);return s.length>0&&(t+=["input","output","objOutput","groupOutput"].includes(s[0])?`Number(${s.join("")})`:s.join("")),t},g=(e,t,s)=>{const{renderedComponentConfig:i,context:o,formData:n,curLabelGroup:r}=e;try{const{$object_items:e,$object_tools:l,items:c,component:d}=i,u=Object(a["find"])(t,{name:d});if(!u||!u.objectAnswerJson)return{};const h=[];Object(a["forEach"])(c,e=>{var t;const i=null===(t=Object(a["cloneDeep"])(Object(a["find"])(s,{name:e.component})))||void 0===t?void 0:t.answerJson;i&&h.push(b(r,i,e,o,n))});const p=Object(a["cloneDeep"])(u.objectAnswerJson);return e.length&&Object(a["forEach"])(e,e=>{var t;const i=null===(t=Object(a["cloneDeep"])(Object(a["find"])(s,{name:e.component})))||void 0===t?void 0:t.answerJson;if(i){const t=b(r,i,e,o,n);p.items.properties.tags.items.anyOf.push(t)}}),l.length&&Object(a["forEach"])(l,e=>{p.items.properties.name.enum.push(e.name)}),{$schema:"https://json-schema.org/draft/2019-09/schema",description:"预标注结果格式校验",type:"object",properties:{tags:{description:"全局标签",type:"array",...h.length?{items:{oneOf:h}}:{}},objects:p},required:["tags",...e.length&&l.length?["objects"]:[]]}}catch(l){return console.error(l),{}}},b=(e,t,s)=>{const i=Object(a["cloneDeep"])(t),{name:o,required:n,labelGroup:r,isVisible:l,hidden:c}=s.attributes;i.properties.name.const=o;let d=n;if(null!==n&&void 0!==n&&n.$expressionFn&&Object(a["isFunction"])(null===n||void 0===n?void 0:n.$expressionFn)||null!==l&&void 0!==l&&l.$expressionFn&&Object(a["isFunction"])(l.$expressionFn))try{d=!1}catch(h){console.error("[OPTIMUS ENGINE] 表达式配置出错 3:",n.$expression)}d=d&&!0!==c;const u=!e||!r||(null===r||void 0===r?void 0:r.length)>0&&(null===r||void 0===r?void 0:r.includes(e));return!0===d&&u&&(i.required.push("value"),i.properties.value.minLength=1,i.properties.value.minItems=1),i},f=(e,t)=>{try{const{$object_tools:s,$object_items:i}=e,o=Object(a["isString"])(t)?JSON.parse(t):Object(a["cloneDeep"])(t),{objects:r,tags:l}=o;!l&&(o.tags=[]),!r&&(o.objects=[]),o.tags=o.tags.filter(t=>e.items.find(e=>e.attributes.name===t.name&&!1!==e.attributes.autoLabelValueEnabled));const c=[];return Object(a["cloneDeep"])(o.objects).forEach(e=>{!e.tags&&(e.tags=[]);const t=[],o=Object(a["find"])(s,{label:e.label});if(o){const{type:s,name:r,color:l,label:d}=o;i.forEach(s=>{const{attributes:{name:i,label:o,value:n,reference:l,autoLabelValueEnabled:c}}=s;if(!l||"all"===l||l===r){const s=Object(a["find"])(e.tags,e=>i===e.name),r={name:i,label:o,value:s?s.value:n};(null===s||void 0===s?void 0:s.fitting)&&(r.fitting=s.fitting),!1!==c&&t.push(r)}});const u=Object.assign(e,{featureId:e.featureId?e.featureId:"feature_"+Object(n["j"])(8),tags:t,type:s,name:r,label:d,color:e.color||l});c.push(u)}else console.log(e.label+"标签无法匹配，请在模板中添加此标签")}),o.objects=c,o}catch(s){return console.error("预标注结果格式错误:",t,s),{objects:[],tags:[]}}},v=(e,t)=>{const{tags:s,objects:i}=t;if(0===s.length&&0===i.length)return t;const{$object_items:o,items:n}=e,r=s.filter(e=>Object(a["find"])(n,t=>t.attributes.name===e.name)),l=i.map(e=>{const t=e.tags.filter(e=>Object(a["find"])(o,t=>t.attributes.name===e.name));return Object.assign({},e,{tags:t})});return Object.assign({},t,{tags:r,objects:l})};var y=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{staticClass:"select",attrs:{label:e.label,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未选择"},prop:e.name}},["auto"===e.myExhibit?[0===e.myOptions.length||e.myOptions.length>10?s("Select",{ref:"selectComponent",attrs:{"default-label":e.$optimus.formData[e.name],disabled:e.isDisabled,transfer:"",clearable:"",filterable:"","remote-method":e.remoteMethod,loading:e.loading},on:{"hook:mounted":e.setValue,"on-query-change":e.handleQueryChange},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.curOptions,(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1):s("CheckboxGroup",{on:{"on-change":e.onChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.myOptions,(function(t){return s("Checkbox",{key:t.value,staticClass:"checkboxItem",attrs:{label:t.value,disabled:e.isDisabled}},[e._v(e._s(t.label))])})),1)]:["dropdown"===e.myExhibit||0===e.myOptions.length||e.myOptions.length>100?s("Select",{ref:"selectComponent",attrs:{"default-label":e.$optimus.formData[e.name],disabled:e.isDisabled,transfer:"",clearable:"",filterable:"","remote-method":e.remoteMethod,loading:e.loading},on:{"hook:mounted":e.setValue,"on-query-change":e.handleQueryChange},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.curOptions,(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1):s("CheckboxGroup",{on:{"on-change":e.onChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.myOptions,(function(t){return s("Checkbox",{key:t.value,staticClass:"checkboxItem",attrs:{label:t.value,disabled:e.isDisabled}},[e._v(e._s(t.label))])})),1)],s("p",{directives:[{name:"show",rawName:"v-show",value:e.myOptions.length>e.maxLength&&!e.isDisabled,expression:"myOptions.length > maxLength && !isDisabled"}],staticClass:"txt-red"},[s("Icon",{attrs:{type:"ios-alert-outline"}}),s("span",[e._v("由于导入数据量过大，一共"+e._s(e.myOptions.length)+"条，只展示前 "+e._s(e.maxLength)+" 条")])],1),s("selectDisabled",{directives:[{name:"show",rawName:"v-show",value:e.showOptionModal&&e.isDisabled,expression:"showOptionModal && isDisabled"}],ref:"selectDisabled",attrs:{type:"select",options:e.myOptions},on:{closeModal:function(t){e.showOptionModal=!1}}})],2)},w=[],x=s("6385"),C={label:"单选(废弃)",icon:"ios-arrow-down",name:"z-select",type:"deprecated",attributes:[{name:"name",label:"字段标识",type:String,value(){return"select_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"单选(废弃)"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"exhibit",label:"是否平铺选项",component:"z-single-select",type:String,value:"auto",options:[{value:"dropdown",label:"下拉"},{value:"tiled",label:"平铺"},{value:"auto",label:"默认"}]},{name:"options",label:"选项",type:String,component:"z-options-input",value:""}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"单选(废弃)",type:["array","string","null"]}},required:["name","label"]}},j=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"options-modal"},[s("Input",{ref:"inputSearch",staticClass:"modal-input",attrs:{search:"",placeholder:"Enter something..."},on:{"on-blur":e.inputBlur},model:{value:e.searchVal,callback:function(t){e.searchVal=t},expression:"searchVal"}}),s("span",{staticClass:"icon-close",on:{click:e.handleCloseModal}},[s("Icon",{attrs:{type:"ios-close-circle-outline"}}),e._v("关闭")],1),s("div",{staticClass:"options-content"},e._l(e.curOptions,(function(t){return s("p",{key:t.value},[e._v(e._s(t.label))])})),0)],1)},O=[],k={props:{options:Array,type:String},data(){return{curOptions:[],myOptions:[],loading:!1,searchVal:"",maxLength:200,cascaderOption:[]}},watch:{searchVal(e){Object(a["trim"])(e)?this.curOptions=this.myOptions.filter(e=>e.label.toLowerCase().indexOf(this.searchVal.toLowerCase())>-1):this.curOptions=this.myOptions.slice(0,this.maxLength)}},created(){if("cascader"===this.type){this.cascaderDisabled(this.options,"");const e=Object(a["map"])(this.cascaderOption,e=>({label:e,value:e}));this.myOptions=e}else this.myOptions=this.options;this.curOptions=this.myOptions.slice(0,this.maxLength)},methods:{cascaderDisabled(e,t){Object(a["forEach"])(e,e=>{let s;s=t?`${t}/${e.label}`:""+e.label,e.children?this.cascaderDisabled(e.children,s):this.cascaderOption.push(s)})},handleInputFocus(){this.$nextTick(()=>{this.$refs.inputSearch.focus()})},inputBlur(){this.handleCloseModal()},handleCloseModal(){this.$emit("closeModal","false")}}},A=k,S=(s("7a12"),s("2be6")),_=Object(S["a"])(A,j,O,!1,null,"28879452",null),I=_.exports,$={metadata:C,components:{selectDisabled:I},mixins:[x["a"]],props:{options:[Array,String],exhibit:{type:[Array,String],default:"auto"}},data(){return{loading:!1,showOptionModal:!1,curOptions:[],maxLength:200,query:"",myExhibit:Object(a["isArray"])(this.exhibit)?this.exhibit[0]:this.exhibit}},computed:{myOptions(){let e=[];return""===this.options?[]:(e=Object(a["isString"])(this.options)?Object(n["q"])(this.options):this.options,("auto"===this.myExhibit&&e.length>10||"dropdown"===this.myExhibit||e.length>100||0===e.length)&&Object(a["isArray"])(this.$optimus.formData[this.name])?this.$optimus.formData[this.name]=this.$optimus.formData[this.name].length>0?this.$optimus.formData[this.name][0]:"":("auto"===this.myExhibit&&e.length<=10||"tiled"===this.myExhibit&&e.length<=100)&&Object(a["isString"])(this.$optimus.formData[this.name])&&(this.$optimus.formData[this.name]=this.$optimus.formData[this.name].length>0?[this.$optimus.formData[this.name]]:[]),e)}},created(){this.curOptions=this.myOptions.slice(0,this.maxLength)},methods:{remoteMethod(e){""!==Object(a["trim"])(e)&&(this.loading=!0,setTimeout(()=>{this.loading=!1,this.curOptions=this.myOptions.filter(t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1)},300))},handleQueryChange(e){Object(a["trim"])(e)||(this.curOptions=this.myOptions.slice(0,this.maxLength))},setValue(){this.$refs.selectComponent.values&&this.$refs.selectComponent.values.push({value:this.$optimus.formData[this.name]?this.$optimus.formData[this.name]:"",label:this.$optimus.formData[this.name]?this.$optimus.formData[this.name]:""})},onChange(e){e.length>1&&e.shift()},showModal(){this.showOptionModal=!0,this.$refs.selectDisabled.handleInputFocus()}}},M=$,T=(s("fb76"),Object(S["a"])(M,y,w,!1,null,"418c0bf0",null)),E=T.exports,L=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{staticClass:"select",attrs:{label:e.label,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未选择"},prop:e.name}},["dropdown"===e.myExhibit?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e(),"固定值"===e.typeMode?["auto"===e.myExhibit?[0===e.myOptions.length||e.myOptions.length>10?s("Select",{ref:"selectComponent",attrs:{"default-label":e.selectValue,disabled:e.isDisabled||e.readOnly,transfer:"",clearable:e.clearable,filterable:"","remote-method":e.hasRemoteMethod,loading:e.loading},on:{"hook:mounted":e.setValue,"on-query-change":e.handleQueryChange,"on-change":e.onChange},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},e._l(e.curOptions,(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1):s("CheckboxGroup",{attrs:{disabled:e.readOnly},on:{"on-change":e.onChange},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},e._l(e.myOptions,(function(t){return s("Checkbox",{key:t.value,staticClass:"checkboxItem",attrs:{label:t.value,disabled:e.isDisabled||e.readOnly}},[e._v(e._s(t.label))])})),1),e.optionsDesc?s("div",{staticClass:"txt-muted"},[e._v(e._s(e.optionsDesc))]):e._e()]:["dropdown"===e.myExhibit||0===e.myOptions.length||e.myOptions.length>e.maxLength?s("Select",{ref:"selectComponent",attrs:{"default-label":e.selectValue,disabled:e.isDisabled||e.readOnly,transfer:"",clearable:e.clearable,filterable:"","remote-method":e.hasRemoteMethod,loading:e.loading},on:{"hook:mounted":e.setValue,"on-query-change":e.handleQueryChange,"on-change":e.onChange},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},e._l(e.curOptions,(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1):s("CheckboxGroup",{on:{"on-change":e.onChange},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},e._l(e.myOptions,(function(t){return s("Checkbox",{key:t.value,staticClass:"checkboxItem",attrs:{label:t.value,disabled:e.isDisabled||e.readOnly}},[e._v(e._s(t.label))])})),1)],s("p",{directives:[{name:"show",rawName:"v-show",value:e.myOptions.length>e.maxLength&&!e.isDisabled,expression:"myOptions.length > maxLength && !isDisabled"}],staticClass:"txt-red"},[s("Icon",{attrs:{type:"ios-alert-outline"}}),s("span",[e._v("由于导入数据量过大，一共"+e._s(e.myOptions.length)+"条，只展示前 "+e._s(e.maxLength)+" 条")])],1),s("selectDisabled",{directives:[{name:"show",rawName:"v-show",value:e.showOptionModal&&e.isDisabled,expression:"showOptionModal && isDisabled"}],ref:"selectDisabled",attrs:{type:"select",options:e.myOptions},on:{closeModal:function(t){e.showOptionModal=!1}}}),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),"fittingType"===e.name?s("span",{attrs:{slot:"label"},slot:"label"},[s("span",{staticClass:"tips"},[e._v("(仅用于交叉标注)")])]):e._e(),"fittingType"===e.name?s("span",{staticClass:"explanation"},[e._v(e._s({most:"说明：拟合结果取多人标注的众数；置信度反映了有几人结果同拟合结果一致",average:"说明：拟合结果取多人标注的平均数；分差为多人结果同拟合结果的分差之和"}[e.selectValue]))]):e._e()]:[s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})]],2):e._e()},D=[],P={label:"单选(废弃)",icon:"ios-arrow-down",name:"z-single-select",type:"deprecated",attributes:[{name:"name",label:"字段标识",type:String,value(){return"single_select_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"单选(废弃)"},{name:"readOnly",label:"是否只读",component:"z-switch",type:Boolean,value:!1},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"exhibit",label:"是否平铺选项",component:"z-single-select",type:String,value:"auto",options:[{value:"dropdown",label:"下拉"},{value:"tiled",label:"平铺"},{value:"auto",label:"默认"}]},{name:"options",label:"选项",type:String,component:"z-options-input",required:!0,value:""},{name:"value",label:"默认值",component:"z-single-select",type:String,attributes:{basicMode:!0,exhibit:"dropdown",options:"${output.options}"},required:!1,value:""}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"单选",type:["string","null"]}},required:["name","label"]}},B=s("13c8"),R=s("d010"),z={metadata:P,components:{selectDisabled:I,Fitting:B["a"],ExpressionDropdown:R["a"]},mixins:[x["a"]],props:{options:[Array,String],basicMode:{type:Boolean,default:!1},exhibit:{type:[Array,String],default:"auto"},clearable:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1},optionsDesc:{type:[String,Boolean],default:""}},data(){return{typeMode:"固定值",fixedValue:!1,expressionValue:"${}",loading:!1,showOptionModal:!1,curOptions:[],maxLength:500,query:"",selectValue:this.$optimus.formData[this.name],myExhibit:Object(a["isArray"])(this.exhibit)?this.exhibit[0]:this.exhibit}},computed:{myOptions(){let e=[];if(Object(a["isString"])(this.options)){if(""===this.options||this.options.match(/^\${(.+)}$/))return[];try{e=this.options.includes("@_@")?Object(n["q"])(this.options):JSON.parse(this.options)}catch(t){console.info(this.options+" 解析失败")}}else e=this.options;return e=Object(a["uniqBy"])(e,"value"),("auto"===this.myExhibit&&e.length>10||"dropdown"===this.myExhibit||e.length>this.maxLength||0===e.length)&&Object(a["isArray"])(this.$optimus.formData[this.name])?this.selectValue=this.$optimus.formData[this.name].length>0?this.$optimus.formData[this.name][0]:"":("auto"===this.myExhibit&&e.length<=10||"tiled"===this.myExhibit&&e.length<=this.maxLength)&&Object(a["isString"])(this.$optimus.formData[this.name])&&(this.selectValue=this.$optimus.formData[this.name].length>0?[this.$optimus.formData[this.name]]:[]),e},hasRemoteMethod(){return this.basicMode?null:this.remoteMethod}},watch:{options(){this.basicMode&&(this.curOptions=this.myOptions.slice(0,this.maxLength))}},created(){const e=this.$optimus.formData[this.name];Object(a["isString"])(e)&&e.match(/^\$\{.*\}$/)?(this.typeMode="表达式",this.expressionValue=e):(this.typeMode="固定值",this.fixedValue=e),this.curOptions=this.myOptions.slice(0,this.maxLength)},methods:{updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue},handleExpressionChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value},remoteMethod(e){this.basicMode||""===Object(a["trim"])(e)||(this.loading=!0,setTimeout(()=>{this.loading=!1,this.curOptions=this.myOptions.filter(t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1)},300))},handleQueryChange(e){this.basicMode||Object(a["trim"])(e)||(this.curOptions=this.myOptions.slice(0,this.maxLength))},setValue(){this.$refs.selectComponent.values&&this.$refs.selectComponent.values.push({value:this.$optimus.formData[this.name]?this.$optimus.formData[this.name]:"",label:this.$optimus.formData[this.name]?this.$optimus.formData[this.name]:""})},onChange(e){e&&Object(a["isArray"])(e)?(e.length>1&&e.shift(),this.$optimus.formData[this.name]=e.length>0?e[0]:""):this.$optimus.formData[this.name]=e||""},showModal(){this.showOptionModal=!0,this.$refs.selectDisabled.handleInputFocus()}}},N=z,F=(s("43f3"),Object(S["a"])(N,L,D,!1,null,"354cc834",null)),V=F.exports,q=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{class:{inputItem:"竖向(从左到右)"===e.curDirection||"竖向(从右到左)"===e.curDirection},attrs:{label:e.label,prop:e.name,rules:e.rules}},[s("CustomLayoutInput",{attrs:{contenteditable:!e.isDisabled&&!e.readOnly,direction:e.direction,lang:e.lang,defaultFontSize:e.defaultFontSize,editFontSize:e.editFontSize,name:e.name,label:e.label,required:e.required,wordCount:e.wordCount,typeMode:e.typeMode,correction:e.correction,defaultTextType:e.type,editTextType:e.correction||"markdown"===e.type,enableExpression:e.enableExpression},on:{updateTypeMode:e.updateTypeMode,handleFixedInputChange:e.handleFixedInputChange,handleExpressionInputChange:e.handleExpressionInputChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),s(e.help,{tag:"component"}),"name"===e.name?s("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(e.label)),s("span",{staticClass:"tips"},[e._v("(由字母、数字、下划线、$组成并不能以数字开头)")])]):s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},H=[],W=(s("f38f"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"customLayoutInput",class:{layoutClass:e.layoutClass}},[e.editFontSize?s("div",{staticClass:"bar"},[e.correction&&"string"===e.textType?[e.errorLength?s("Tag",{attrs:{type:"border",color:"error"}},[e._v("! "+e._s(e.errorLength)+"项错误")]):e.validateNum&&!e.correctLoading?s("Tag",{attrs:{type:"border",color:"success"}},[e._v("未检出错误")]):e._e(),s("Button",{attrs:{size:"small",type:"primary",loading:e.correctLoading,disabled:!e.contenteditable},on:{click:e.handleValidate}},[e._v("校对")]),s("Button",{attrs:{size:"small",disabled:!e.contenteditable},on:{click:e.handleClear}},[e._v("清空")])]:e._e(),s("div",{class:e.correction?"":"select"},[e.editTextType?s("Dropdown",{class:e.correction?"select2":"select1",staticStyle:{"margin-right":"8px"},attrs:{trigger:"click"},on:{"on-click":e.handleTypeChange}},[s("div",{staticClass:"selected"},[e._v(e._s(e.textType)),s("Icon",{attrs:{type:"ios-arrow-down"}})],1),s("DropdownMenu",{staticClass:"select-content",attrs:{slot:"list"},slot:"list"},e._l(e.textTypeList,(function(t){return s("DropdownItem",{key:t,staticClass:"select-option",attrs:{selected:e.textType===t,name:t}},[e._v(e._s(t))])})),1)],1):e._e(),"markdown"!==e.textType?s("Dropdown",{class:e.correction?"select2":"select1",attrs:{trigger:"click"},on:{"on-click":e.handleSelectSize}},[s("div",{staticClass:"selected"},[e._v(e._s(e.fontSize)+"px"),s("Icon",{attrs:{type:"ios-arrow-down"}})],1),s("DropdownMenu",{staticClass:"select-content",attrs:{slot:"list"},slot:"list"},e._l(e.fontSizeList,(function(t){return s("DropdownItem",{key:t,staticClass:"select-option",attrs:{selected:e.fontSize===t,name:t}},[e._v(e._s(t)+"px")])})),1)],1):e._e()],1)],2):[e.enableExpression?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e()],"表达式"===e.typeMode?[s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionInputChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})]:"markdown"===e.textType?[e.name?s("markdown-editor",{attrs:{id:e.name+"_markdown_"+e.enginePrimaryKey,value:e.$optimus.formData[e.name],disabled:!e.contenteditable,"word-count":e.wordCount},on:{input:e.handleInput,blur:e.handleBlur}}):e._e()]:[s("div",{key:e.name+"-"+e.validateNum,ref:"input",staticClass:"customInput",class:e.classObj,style:{fontFamily:e.fontFamily,fontSize:e.fontSize+"px"},attrs:{contenteditable:e.contenteditable},on:{focus:e.handleFocus,blur:e.handleBlur,input:e.handleInput}},[e.correction&&e.correctTextList.length?e._l(e.correctTextList,(function(t,i){return s("div",{key:e.name+"-line-"+i},[t.diffs?s("span",e._l(t.diffs,(function(t,a){return s("span",{key:e.name+"-diff-"+i+"-"+a,staticClass:"correction"},["normal"===t.type?s("span",[e._v(e._s(t.str))]):e._e(),["error","error:code"].includes(t.type)?s("span",{staticClass:"error-text",class:e.diffItem&&e.diffItem.errorIndex===t.errorIndex?"error-text-actived":"",on:{click:function(t){return t.stopPropagation(),function(t){return e.showPoptip(i,a,t)}.apply(null,arguments)}}},[t.str?s("span",[e._v(e._s(t.str))]):s("span",{staticStyle:{display:"inline-block",width:"4px"}},[e._v(e._s(t.str))])]):e._e()])})),0):t.content?s("span",[e._v(e._s(t.content))]):s("div",{staticStyle:{height:"20px",width:"100%"}},[e._v(e._s(t.content))])])})):[e._v(e._s(e.inputContent))]],2),e.wordCount?s("span",{staticClass:"word-count"},[s("WordCount",{attrs:{content:e.$optimus.formData[e.name],defaultType:e.wordCountType}})],1):e._e()],s("Modal",{ref:"correctModal",staticStyle:{"min-width":"300px","max-width":"500px"},attrs:{mask:!1,closable:!1,draggable:"","footer-hide":"",sticky:"",width:"auto",styles:e.correctStyles},model:{value:e.correctPoptip,callback:function(t){e.correctPoptip=t},expression:"correctPoptip"}},[s("template",{slot:"header"},[s("div",{staticClass:"correctPoptip"},[e.diffItem?s("div",{staticClass:"title"},[s("h4",[e._v("智能纠错"),s("div",{staticClass:"tip"},[e._v("("+e._s(e.diffItem.errorIndex)+"/"+e._s(e.errorLength)+")")])]),s("div",{staticClass:"btns"},[s("a",{on:{click:function(t){return e.handleCorrect(!0,!0)}}},[e._v("全部采纳")]),s("a",{on:{click:function(t){return e.handleCorrect(!1,!0)}}},[e._v("全部忽略")])])]):e._e()])]),e.diffItem?s("div",{staticClass:"correctPoptip"},[s("Row",{staticClass:"content"},["error"===e.diffItem.type?[s("div",{staticClass:"str"},[e._v(e._s(e.diffItem.str))]),s("div",{staticClass:"tip"},[e._v("建议"+e._s(e.diffItem.str2&&e.diffItem.str?"替换为":e.diffItem.str?"删除":"增加"))]),s("div",{staticClass:"str"},[e._v(e._s(e.diffItem.str2))])]:s("span",{staticClass:"memo"},[e._v(e._s(e.diffItem.errorMemo))])],2),s("Row",{staticClass:"operations"},[s("div",{staticClass:"btns"},[s("Button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleCorrect(!0)}}},[e._v("采纳")]),s("Button",{attrs:{size:"small",type:"text"},on:{click:function(t){return e.handleCorrect(!1)}}},[e._v("忽略")])],1),s("div",{staticClass:"btns"},[s("div",{staticClass:"icon",class:1===e.diffItem.errorIndex?"disabled":""},[s("Icon",{class:1===e.diffItem.errorIndex?"icon-disabled":"",attrs:{type:"ios-arrow-back"},on:{click:e.findPrevError}})],1),s("div",{staticClass:"icon",class:e.diffItem.errorIndex===e.errorLength?"disabled":""},[s("Icon",{class:e.diffItem.errorIndex===e.errorLength?"icon-disabled":"",attrs:{type:"ios-arrow-forward"},on:{click:e.findNextError}})],1)])])],1):e._e()],2)],2)}),U=[],Q=(s("28eb"),s("b2ad"));function J(e){let t;switch(s.e("chunk-76d6a780").then(s.t.bind(null,"9ef1",7)),e){case"蒙语(MongolQaganTig.ttf)":t="Mongol";break;case"哈语(ALKATIP Asliya.ttf)":t="Alkatip";break;case"维语(ALKATIP-Basma-Tom.ttf)":t="Basma";break;case"藏语(microsoft-himalaya.ttf)":t="Himalaya";break;default:t=""}return t}var G=s("a040"),K=s.n(G),Y=s("3732"),Z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:e.id}})},X=[],ee=s("91cd"),te=s.n(ee),se=(s("9454"),{components:{},directives:{},props:{id:{type:String,default:"markdownEditor"},value:{type:String,default:""},disabled:{type:Boolean,default:!1},wordCount:{type:Boolean,default:!1}},data(){return{}},mounted(){this.initMarkdown()},methods:{initMarkdown(){this.contentEditor=new te.a(this.id,{cdn:"/vditor",preview:{theme:{path:"/vditor"}},lang:"zh_CN",mode:"wysiwyg",height:360,value:this.value,counter:{enable:this.wordCount},cache:{enable:!1},input:e=>{this.$emit("input",e)},blur:e=>{this.$emit("blur",e)},after:()=>{this.disabled&&this.contentEditor.disabled()}})}}}),ie=se,ae=(s("0af0"),Object(S["a"])(ie,Z,X,!1,null,"494b9e4c",null)),oe=ae.exports,ne=(s("de4c"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e.enabled||e.controlled?s("t-dropdown",{attrs:{placement:"bottom-right",minColumnWidth:220},model:{value:e.wordCountType,callback:function(t){e.wordCountType=t},expression:"wordCountType"}},[s("span",[s("t-button",{staticStyle:{padding:"4px"},attrs:{variant:"text",size:e.controlled?"":"small"}},[s("div",{staticClass:"text"},[e._v(e._s(e.countLabel))]),s("t-icon",{attrs:{slot:"suffix",name:"chevron-down",size:"14"},slot:"suffix"})],1)],1),s("t-dropdown-menu",[s("t-dropdown-item",{staticClass:"rule-item",on:{click:e.openRuleDesc}},[s("t-row",{staticClass:"rule-desc",attrs:{align:"center",justify:"end"}},[s("span",[e._v("规则说明")]),s("t-icon",{attrs:{name:"info-circle",size:"14"}})],1)],1),e._l(e.wordCountOptions,(function(t){return s("t-dropdown-item",{key:t.value,attrs:{value:t.value},on:{click:function(s){e.wordCountType=t.value}}},[s("t-row",{attrs:{align:"center",justify:"space-between"}},[s("span",[e.wordCountType?s("span",{staticClass:"actived"},[e.wordCountType===t.value?s("t-icon",{attrs:{name:"check",size:"14"}}):e._e()],1):e._e(),s("span",[e._v(e._s(t.content))])]),e.controlled?e._e():s("span",{staticClass:"count"},[e._v(e._s(e.counts[t.value]))])])],1)}))],2)],1):e._e(),e.controlled?s("t-switch",{attrs:{size:"small"},model:{value:e.enabled,callback:function(t){e.enabled=t},expression:"enabled"}}):e._e()],1)}),re=[],le={props:{content:{type:String,default:""},defaultType:{type:String,default:"字数"},defaultEnabled:{type:Boolean,default:!0},controlled:{type:Boolean,default:!1}},data(){return{wordCountType:this.controlled?localStorage.getItem("word-count-type")||"字数":this.defaultType,enabled:this.controlled?"false"!==localStorage.getItem("word-count"):this.defaultEnabled,wordCountOptions:[{content:"字数",value:"字数"},{content:"字数（不计标点）",value:"字数（不计标点）"},{content:"字符数",value:"字符数"},{content:"字符数（不计空格）",value:"字符数（不计空格）"},{content:"中文字符",value:"中文字符"}]}},computed:{countLabel(){return this.controlled?"字数统计":`${this.counts[this.wordCountType]} 个${this.wordCountType.replace("数","")}`},counts(){const e=Object(a["isObject"])(this.content)?JSON.stringify(this.content):this.content,t=e.replace(/[\n\r\t\f\v]/g,""),s=e=>{const t=e.match(/[a-zA-Z0-9!"#$%&'()*+,\-./:;<=>?@[\]^_`{|}~]+/g)||[],s=e.match(/[\u4e00-\u9fff]/g)||[],i=e.match(/\p{Emoji}/gu)||[],a=t.join(""),o=s.join(""),n=i.join(""),r=a.length+o.length+n.length,l=e.replace(/\s/g,"").length-r;return t.length+s.length+i.length+l},i=e=>{const t=e.match(/[a-zA-Z0-9]+/g)||[],s=e.match(/[\u4e00-\u9fff]/g)||[];return t.length+s.length},o={"字数":s(e),"字数（不计标点）":i(e),"字符数":t.length,"字符数（不计空格）":t.replace(/\s/g,"").length,"中文字符":e.replace(/[^\u4e00-\u9fff，。！？；：“”、]/g,"").length};return o}},watch:{enabled(){const e=!!this.enabled;this.controlled&&(this.$emit("change","word-count",e),localStorage.setItem("word-count",e))},wordCountType(e){this.controlled&&(this.$emit("change","word-count-type",e),localStorage.setItem("word-count-type",e))},defaultEnabled(e){this.enabled=e},defaultType(e){this.wordCountType=e}},mounted(){this.$emit("change","word-count-type",this.wordCountType),this.$emit("change","word-count",this.enabled)},methods:{openRuleDesc(){window.open("https://doc.weixin.qq.com/doc/w3_AFsAOAYsACkgvFGWAdKTfqFhxSzvA?scode=AJEAIQdfAAoSWHlkqBAFsAOAYsACk&isEnterEdit=1","_blank")}}},ce=le,de=(s("76da"),Object(S["a"])(ce,ne,re,!1,null,"a1bcf600",null)),ue=de.exports,he={components:{ExpressionDropdown:R["a"],markdownEditor:oe,WordCount:ue},mixins:[x["a"],Q["a"]],props:{direction:{type:[String,Array],default:"横向(从左到右)"},lang:{type:[String,Array],default:"默认字体"},defaultFontSize:{type:[String,Array,Number],default:"14"},editFontSize:{type:Boolean,default:!1},editTextType:{type:Boolean,default:!1},value:{type:[String,Number,Boolean],default:""},contenteditable:{type:Boolean,default:!0},typeMode:String,wordCount:{type:Boolean,default:!1},correction:{type:Boolean,default:!1},defaultTextType:{type:String,default:"string"},enableExpression:{type:Boolean,default:!0}},data(){return{fontSizeList:["8","10","12","14","16","18","24","30","32","36","48"],fontSize:this.defaultFontSize,fontFamily:"",showOptions:!1,inputContent:this.value,isChange:!0,layoutClass:!1,classObj:{horizontalLtr:!1,horizontalRtl:!1,verticalRtr:!1,verticalLtr:!1,focusStyle:!1,errorStyle:!1,disabledStyle:!1},textTypeList:["string","markdown"],textType:this.defaultTextType,correctTextList:[],correctAnswer:"",correctLoading:!1,correctPoptip:!1,correctIndexs:void 0,validateNum:0,correctStyles:{},wordCountType:"字数"}},computed:{enginePrimaryKey(){return this.$optimus.enginePrimaryKey||0},errorLength(){let e=0;return this.correctTextList.forEach(t=>{t.diffs&&(e+=t.diffs.filter(e=>["error","error:code"].includes(e.type)).length)}),e},diffItem(){var e;if(null!==(e=this.correctIndexs)&&void 0!==e&&e.length){const[e,t]=this.correctIndexs;if(this.correctTextList[e].diffs){const s=this.correctTextList[e].diffs[t];return s}}return null}},watch:{contenteditable:{handler(e){this.classObj.disabledStyle=!e},immediate:!0},value:{handler(e,t){!this.isChange&&this.value||(this.inputContent=e,this.$nextTick(()=>{this.$refs.input&&(this.$refs.input.innerText=e)}),this.required&&(this.classObj.errorStyle=void 0!==t&&!e,this.dispatch("FormItem","on-form-blur",e)))},immediate:!0}},created(){this.init(),this.$EventBus.$on("optimus:word-count:change",(e,t)=>{"word-count-type"===e&&(this.wordCountType=t)})},destroyed(){this.$EventBus.$off("optimus:word-count:change")},mounted(){document.addEventListener("click",this.closePopup)},beforeDestroy(){document.removeEventListener("click",this.closePopup)},methods:{init(){const e=Object(a["isArray"])(this.lang)?this.lang[0]:this.lang;this.fontFamily=J(e);const t=Object(a["isArray"])(this.direction)?this.direction[0]:this.direction;switch(t){case"横向(从左到右)":this.classObj.horizontalLtr=!0;break;case"横向(从右到左)":this.classObj.horizontalRtl=!0;break;case"竖向(从左到右)":this.classObj.verticalLtr=!0,this.layoutClass=!0;break;case"竖向(从右到左)":this.classObj.verticalRtl=!0,this.layoutClass=!0;break}},focus(){this.$refs.input.focus();const e=window.getSelection();e.selectAllChildren(this.$refs.input),e.collapseToEnd()},handleInput(e){var t;let s=(Object(a["isString"])(e)?e:null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.innerText)||"";s.endsWith("\n")&&(s=s.slice(0,s.lastIndexOf("\n"))),Object(a["isString"])(e)&&"markdown"===this.textType&&(this.isChange=!0,this.correctTextList=[],this.validateNum=0),this.$emit("input",s),this.$emit("handleFixedInputChange",s)},handleFocus(){this.isChange=!1,this.classObj.focusStyle=!0,this.classObj.errorStyle=!1},handleBlur(){this.isChange=!0,this.dispatch("FormItem","on-form-blur",this.value),this.required&&!this.value?(this.classObj.focusStyle=!1,this.classObj.errorStyle=!0):(this.classObj.focusStyle=!1,this.classObj.errorStyle=!1)},handleSelectSize(e){this.fontSize=e},handleTypeChange(e){this.textType=e},updateTypeMode(e){this.$emit("updateTypeMode",e)},handleExpressionInputChange(e){var t;this.$emit("handleExpressionInputChange",null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value)},handleClear(){this.handleInput(""),this.inputContent="",this.correctTextList=[],this.$refs.input.innerHTML=""},diff(e,t,s){let i=this.errorLength;const a=s?K.a.prototype.diff_wordMode(e,t):K.a.prototype.diff_main(e,t);return a.reduce((e,t,s)=>{const[o,n]=t;if(0===o)e.push({diffIdx:s,type:"normal",str:n});else if(-1===o){const t=a[s+1];i+=1,e.push({diffIdx:s,errorIndex:i,type:"error",str:n,str2:t&&1===t[0]?t[1]:""})}else if(1===o){const t=a[s-1];t&&t[0]||(i+=1,e.push({diffIdx:s,errorIndex:i,type:"error",str:"",str2:n}))}return e},[{type:"normal",str:""}])},detectLanguage(e){let t=0,s=0;for(let i=0;i<Math.min(50,e.length);i++){const a=e.charCodeAt(i);a>=19968&&a<=40959?t+=1:a<128&&(s+=1)}return t>0?"cmn":s>0?"eng":"cmn"},splitContent(){const e=this.$optimus.formData[this.name].split("\n"),t=e.reduce((e,t)=>(t.startsWith("```")?e.length>0&&"coding"===e[e.length-1].type?(e[e.length-1].content+=t,e[e.length-1].type="code"):e.push({type:"coding",language:t.slice(3),content:t+"\n"}):e.length>0&&"coding"===e[e.length-1].type?(e[e.length-1].content+=t+"\n",e[e.length-1].type="coding"):e.push({type:"text",language:this.detectLanguage(t),content:t}),e),[]);return t},joinContent(){return this.correctTextList.map(e=>e.diffs?e.diffs.map(e=>e.str).join(""):e.content).join("\n")},async handleValidate(){this.validateNum+=1,this.correctTextList=this.splitContent();try{this.correctLoading=!0;for(let e=0;e<this.correctTextList.length;e++){const t=this.correctTextList[e];if("code"===t.type){const s=t.content.split("\n"),i=s.slice(1,-1).join(""),a=await this.codeValidate(t.language,i);!0!==a&&this.$set(this.correctTextList,e,{...this.correctTextList[e],diffs:[{diffIdx:0,errorIndex:this.errorLength+1,type:"error:code",str:t.content,errorMemo:`请检查代码格式，不符合${t.language}语言规范`}]})}else if("text"===t.type){const s=await this.fetchAnswer(t.language,t.content);if(s){const t="eng"===this.correctTextList[e].language,i=this.diff(this.correctTextList[e].content,s.answer,t);this.correctTextList[e].diffs=i,this.$set(this.correctTextList,e,{...this.correctTextList[e],diffs:i})}}}}catch(e){console.error(e)}finally{this.correctLoading=!1}},async fetchAnswer(e,t){try{if(t)return await Y["a"].textCorrect({role:e,text:t})}catch(s){this.$Message.error("校对失败："+s.message)}},async codeValidate(e,t){if("json"!==e)return!0;try{return JSON.parse(t),!0}catch(s){return s}},showPoptip(e,t,s){this.correctIndexs=[e,t],this.correctPoptip=!0;const i=window.innerWidth;this.correctStyles={top:s.y+20+"px",left:Math.min(i-300,s.x)+"px",position:"absolute"}},handleCorrect(e,t=!1){if(t)this.correctTextList.forEach((t,s)=>{t.diffs&&t.diffs.forEach((t,i)=>{("error"===t.type||!e&&"error:code"===t.type)&&(this.$set(this.correctTextList[s].diffs[i],"str",e?t.str2:t.str),this.$set(this.correctTextList[s].diffs[i],"type","normal"),this.$set(this.correctTextList[s].diffs[i],"errorIndex",void 0))})}),this.correctPoptip=!1,this.correctIndexs=void 0;else{const[t,s]=this.correctIndexs;("error"===this.diffItem.type||!e&&"error:code"===this.diffItem.type)&&(this.$set(this.correctTextList[t].diffs[s],"str",e?this.diffItem.str2:this.diffItem.str),this.$set(this.correctTextList[t].diffs[s],"type","normal"),this.correctTextList.forEach((e,i)=>{e.diffs&&e.diffs.forEach((e,a)=>{if(["error","error:code"].includes(e.type)&&(a>s||i>t)){const{errorIndex:e}=this.correctTextList[i].diffs[a];this.$set(this.correctTextList[i].diffs[a],"errorIndex",e>this.correctTextList[t].diffs[s].errorIndex?e-1:e)}})}));const i=this.correctTextList[t].diffs[s];i.errorIndex-1===this.errorLength||"error:code"===i.type&&e&&i.errorIndex===this.errorLength?(this.correctPoptip=!1,this.correctIndexs=void 0):this.findNextError()}this.$nextTick(()=>{const e=this.joinContent();this.inputContent=e,this.handleInput(e)})},findNextError(){const[e,t]=this.correctIndexs;for(let s=e;s<this.correctTextList.length;s++){const i=this.correctTextList[s];if(i.diffs)for(let a=s===e?t+1:0;a<i.diffs.length;a++)if(["error","error:code"].includes(i.diffs[a].type))return void(this.correctIndexs=[s,a])}return null},findPrevError(){const[e,t]=this.correctIndexs;for(let s=e;s>=0;s--){const i=this.correctTextList[s];if(i.diffs)for(let a=s===e?t-1:i.diffs.length-1;a>=0;a--)if(["error","error:code"].includes(i.diffs[a].type))return void(this.correctIndexs=[s,a])}},closePopup(e){this.$refs.correctModal&&!this.$refs.correctModal.$el.contains(e.target)&&(this.correctPoptip=!1,this.correctIndexs=void 0)}}},pe=he,me=(s("ab17"),Object(S["a"])(pe,W,U,!1,null,"26b707b2",null)),ge=me.exports,be={label:"输入框",icon:"ios-create-outline",name:"z-input",attributes:[{name:"name",label:"字段标识",type:String,value(){return"input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"输入框"},{name:"type",label:"默认数据形式",type:String,value:"string",component:"z-single-select",attributes:{basicMode:!0,clearable:!1,options:[{label:"默认字符串",value:"string"},{label:"markdown",value:"markdown"}],exhibit:"dropdown"}},{name:"readOnly",label:"是否只读",component:"z-switch",type:Boolean,value:!1},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"direction",label:"输入方向",component:"z-single-select",attributes:{isVisible:'${output.type==="string"}',options:[{label:"横向 (从左到右)",value:"横向(从左到右)"},{label:"横向 (从右到左)",value:"横向(从右到左)"},{label:"竖向 (从左到右)",value:"竖向(从左到右)"},{label:"竖向 (从右到左)",value:"竖向(从右到左)"}]},type:String,value:"横向(从左到右)"},{name:"lang",label:"字体",component:"z-single-select",type:String,value:"默认字体",attributes:{isVisible:'${output.type==="string"}',basicMode:!0,options:[{label:"默认字体",value:"默认字体"},{label:"蒙语(MongolQaganTig.ttf)",value:"蒙语(MongolQaganTig.ttf)"},{label:"哈语(ALKATIP Asliya.ttf)",value:"哈语(ALKATIP Asliya.ttf)"},{label:"维语(ALKATIP-Basma-Tom.ttf)",value:"维语(ALKATIP-Basma-Tom.ttf)"},{label:"藏语(microsoft-himalaya.ttf)",value:"藏语(microsoft-himalaya.ttf)"}],exhibit:"dropdown"}},{name:"defaultFontSize",label:"默认字体大小 (px)",component:"z-single-select",type:String,value:"14",attributes:{isVisible:'${output.type==="string"}',basicMode:!0,options:[{label:"8",value:"8"},{label:"10",value:"10"},{label:"12",value:"12"},{label:"14",value:"14"},{label:"16",value:"16"},{label:"18",value:"18"},{label:"24",value:"24"},{label:"30",value:"30"},{label:"32",value:"32"},{label:"36",value:"36"},{label:"48",value:"48"}]}},{name:"wordCount",label:"字数统计",component:"z-switch",attributes:{enableExpression:!1},type:Boolean,value:!1},{name:"correction",label:"智能纠错",component:"z-switch",type:Boolean,value:!1},{name:"value",label:"默认值",type:String|Number|Boolean,required:!1,value:""}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"输入框",type:["string","null"]}},required:["name","label"]}},fe=s("9a35"),ve={metadata:be,components:{CustomLayoutInput:ge,Fitting:B["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{direction:{type:[String,Array],default:"横向(从左到右)"},lang:{type:[String,Array],default:"默认字体"},defaultFontSize:{type:[String,Array,Number],default:"14"},editFontSize:{type:Boolean,default:!1},readOnly:{type:Boolean,default:!1},wordCount:{type:Boolean,default:!1},fittingType:{type:String,default:""},isVisible:{type:Boolean,default:!0},type:{type:String,default:"string"},correction:{type:Boolean,default:!1},editTextType:{type:Boolean,default:!1},enableExpression:{type:Boolean,default:!0}},data(){return{typeMode:"",fixedValue:"",expressionValue:"${}",curDirection:Object(a["isArray"])(this.direction)?this.direction[0]:this.direction,contentEditor:"",optimusId:this._uid,help:null}},computed:{rules(){const e=[];return this.isDisabled||e.push({required:this.required,message:this.label+"未填写",trigger:"blur"}),"markdown"===this.type&&e.push({validator:(e,t,s)=>{!this.required||t&&"\n"!==t?s():s(new Error(this.label+"未输入"))}}),"average"===this.fittingType&&e.push({pattern:/^(-|\+)?\d+(\.\d+)?$/,message:"仅支持填写正数、负数和小数"}),e}},created(){const e=this.$optimus.formData[this.name]||"";this.$optimus.formData[this.name]=e,Object(a["isString"])(e)&&e.match(/^\$\{.*\}$/)?(this.typeMode="表达式",this.expressionValue=e):(this.typeMode="固定值",this.fixedValue=e),this.help=this.$renderedComponentConfig.$rawConfig.attributes.help},methods:{updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue},handleFixedInputChange(e){this.fixedValue=e},handleExpressionInputChange(e){this.expressionValue=e}}},ye=ve,we=(s("b9c1"),Object(S["a"])(ye,q,H,!1,null,"75e77825",null)),xe=we.exports,Ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未填写"}}},[e.enableExpression?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e(),"固定值"===e.typeMode?[s("TInputNumber",{staticStyle:{width:"100%"},attrs:{disabled:e.isDisabled||e.readOnly,theme:"column",allowInputOverLimit:!1,decimalPlaces:Number(e.decimalPlaces),min:e.isUndefinedOrEmpty(e.min)?-1/0:e.min,max:e.isUndefinedOrEmpty(e.max)?1/0:e.max},on:{enter:e.handleEnter},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1)]:s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},je=[],Oe={label:"数字输入框",icon:"ios-create-outline",name:"z-input-number",attributes:[{name:"name",label:"字段标识",type:String,value(){return"input_number_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"数字输入框"},{name:"readOnly",label:"是否只读",component:"z-switch",type:Boolean,value:!1},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"decimalPlaces",label:"小数位数",component:"z-input-number",type:Number,attributes:{min:0},required:!1},{name:"min",label:"最小值",component:"z-input-number",type:Number,attributes:{max:"${output.max}"},required:!1},{name:"max",label:"最大值",component:"z-input-number",type:Number,attributes:{min:"${output.min}"},required:!1},{name:"value",label:"默认值",component:"z-input-number",type:Number,attributes:{min:"${output.min}",max:"${output.max}",decimalPlaces:"${output.decimalPlaces}"},required:!1}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"数字输入框",type:["number","string","null"]}},required:["name","label"]}},ke={metadata:Oe,components:{Fitting:B["a"],ExpressionDropdown:R["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{enableExpression:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1},fittingType:{type:String,default:""},decimalPlaces:{type:[Number,String]},min:{type:[Number,String]},max:{type:[Number,String]}},data(){return{isUndefinedOrEmpty:n["k"],typeMode:"",fixedValue:"",expressionValue:"${}"}},computed:{},created(){const e=this.$optimus.formData[this.name]||"";Object(a["isString"])(e)&&e.match(/^\$\{.*\}$/)?(this.typeMode="表达式",this.expressionValue=e):(this.typeMode="固定值",this.fixedValue=e)},methods:{updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue},handleEnter(e,t){var s;null===(s=t.e)||void 0===s||s.preventDefault()}}},Ae=ke,Se=Object(S["a"])(Ae,Ce,je,!1,null,"f032499c",null),_e=Se.exports,Ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,prop:e.name,rules:e.ruleNotEmpty}},[s("Input",{attrs:{readonly:"",type:"textarea",autosize:!0},nativeOn:{click:function(t){return e.handleShowModal.apply(null,arguments)}},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),e.wordCount?s("span",{staticClass:"word-count"},[e._v("字数:"+e._s(e.$optimus.formData[e.name].length))]):e._e()],1)},$e=[],Me={label:"智能纠错输入框",icon:"ios-create-outline",name:"z-error-correction-input",permission:{domain:"template",action:"view-labels",extra:{name:"error_correction_input"}},attributes:[{name:"name",label:"字段标识",type:String,value(){return"error-correction-input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"智能纠错输入框"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"wordCount",label:"字数统计",component:"z-switch",attributes:{enableExpression:!1},type:Boolean,value:!0},{name:"value",label:"默认值",type:String|Number|Boolean,required:!1,value:""},{name:"url",label:"辅助工具链接",type:String,required:!0,value:"https://service-jvxv0smm-1258344706.gz.apigw.tencentcs.com"}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"智能纠错输入框",type:["string","null"]}},required:["name","label"]}},Te={metadata:Me,mixins:[x["a"]],props:{url:{type:String,default:""},wordCount:{type:Boolean,default:!0}},data(){return{isShowModal:!0}},computed:{ruleNotEmpty(){return{required:this.required,message:this.label+"未填写",trigger:"blur"}}},mounted(){window.addEventListener("message",this.handleEventListener)},destroyed(){window.removeEventListener("message",this.handleEventListener)},methods:{handleShowModal(){!this.isDisabled&&this.$optimus.showWujieModal({url:this.url,name:this.name,initValue:this.$optimus.formData[this.name],wordCount:this.wordCount})},handleEventListener(e){var t;if("getInputValue"!==e.data.type)return;const{data:{name:s,text:i}}=e.data;s===`${this.$optimus._uid}-${this.name}`&&(console.log(i),this.$optimus.formData[this.name]=i.trim()),null===(t=this.$FastModal.$modal)||void 0===t||t.destroy()}}},Ee=Te,Le=(s("f35e"),Object(S["a"])(Ee,Ie,$e,!1,null,"15b6787e",null)),De=Le.exports,Pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.$attrs.label,prop:e.$attrs.name,rules:{required:e.$attrs.required,message:e.$attrs.label+"未添加"}}},[s("OptionsInputComponent",e._b({},"OptionsInputComponent",e.$attrs,!1))],1):e._e()},Be=[],Re=s("2c91"),ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"options-input-component"},[s("div",{staticClass:"expression"},[s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}})],1),"固定值"===e.typeMode?["普通输入"===e.listMode?[s("RecycleScroller",{staticClass:"list-group",attrs:{items:e.listOptions,"item-size":40,"key-field":"id"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item,a=t.index;return[s("div",{staticClass:"list-group-item"},[s("div",{staticClass:"input"},[s("Input",{staticClass:"options-input",attrs:{type:"text",placeholder:"输入选项",disabled:e.readOnly},on:{"on-blur":function(e){i.label=i.value}},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"item.value"}})],1),s("div",{staticClass:"actions"},[e.readOnly?e._e():s("span",{on:{click:function(t){return e.del(a)}}},[s("Icon",{attrs:{type:"ios-trash"}})],1),s("span",{attrs:{disabled:0===a},on:{click:function(t){return e.up(a)}}},[s("Icon",{attrs:{type:"ios-arrow-up"}})],1),s("span",{attrs:{disabled:a===e.listOptions.length-1},on:{click:function(t){return e.down(a)}}},[s("Icon",{attrs:{type:"ios-arrow-down"}})],1)])])]}}],null,!1,2240967672)}),e.readOnly?e._e():s("div",{staticClass:"list-actions"},[s("Button",{staticClass:"mrs",attrs:{size:"small",type:"primary"},on:{click:e.add}},[e._v("添加选项")]),s("Button",{staticClass:"mrs",attrs:{size:"small",type:"primary"},on:{click:e.handleBatchInput}},[e._v("批量导入")])],1)]:[s("Input",{attrs:{type:"textarea",placeholder:"选项之间的分割符是@_@"},on:{"on-focus":function(t){e.tipMessage=!1}},model:{value:e.importOptions,callback:function(t){e.importOptions=t},expression:"importOptions"}}),"批量导入"===e.listMode?s("Button",{staticClass:"mrs",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.changeListMode("普通输入")}}},[e._v("导入")]):e._e(),"批量导入"===e.listMode?s("Button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取消")]):e._e(),"批量导入"===e.listMode?s("Tooltip",{attrs:{placement:"bottom-start",transfer:!0,theme:"light"}},[s("a",{staticStyle:{margin:"0px 3px"}},[s("Icon",{attrs:{type:"ios-alert-outline"}})],1),s("div",{attrs:{slot:"content"},slot:"content"},[s("b",[e._v("输入指引")]),s("p",[e._v("示例、a@_@b@_@c@_@d@_@e")])])]):e._e(),e.tipMessage?s("span",{staticClass:"txt-red",staticStyle:{"font-size":"12px"}},[e._v("导入数据不能为空")]):s("span",{staticStyle:{"font-size":"12px"}},[e._v("选项之间的分割符是@_@”")])]]:[s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})]],2)},Ne=[],Fe=s("f3b2"),Ve=s("d7dc"),qe=(s("577d"),{components:{RecycleScroller:Fe["a"],ExpressionDropdown:R["a"]},mixins:[x["a"]],props:{options:[Array,String],readOnly:{type:Boolean,default:!1}},data(){return{typeMode:"固定值",listMode:"普通输入",expressionValue:"",importOptions:"",listOptions:[],tipMessage:!1}},watch:{listOptions:{deep:!0,handler(e){this.$optimus.formData[this.name]=Object(a["uniqBy"])(e.filter(e=>""!==Object(a["trim"])(e.value)),"value"),this.$emit("update:value",this.$optimus.formData[this.name])}}},created(){const e=this.$optimus.formData[this.name];if(Object(a["isString"])(e)){if(e.match(/^\$\{.*\}$/)||Object.keys(this.$optimus.formData).includes("fileUrl")&&Object.keys(this.$optimus.formData).includes("fileName"))return this.typeMode="表达式",void(this.expressionValue=this.$optimus.formData[this.name]);this.listOptions=Object(n["q"])(this.$optimus.formData[this.name])}else Object(a["isArray"])(e)&&(this.listOptions=e.length?this.$optimus.formData[this.name]:[{value:"",label:""}]);this.listOptions=this.listOptions.map(e=>({...e,id:Object(Ve["a"])()}))},methods:{add(){this.listOptions.push({value:"",label:"",id:Object(Ve["a"])()}),this.$nextTick(()=>{const e=this.$el.querySelector(".list-group");e.scrollTop=e.scrollHeight})},del(e){this.listOptions.splice(e,1)},up(e){if(0===e)return!1;[this.listOptions[e]]=this.listOptions.splice(e-1,1,this.listOptions[e])},down(e){if(e===this.listOptions.length-1)return!1;[this.listOptions[e]]=this.listOptions.splice(e+1,1,this.listOptions[e])},updateTypeMode(e){"固定值"===e&&Object.keys(this.$optimus.formData).includes("fileUrl")&&Object.keys(this.$optimus.formData).includes("fileName")?this.$Message.warning({content:"图片选择只支持表达式"}):(this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.listOptions.filter(e=>""!==Object(a["trim"])(e.value)))},handleBatchInput(){this.listMode="批量导入",this.importOptions=this.listOptions.map(e=>e.value).join("@_@")},changeListMode(e){0===this.importOptions.length?this.tipMessage=!0:(this.listMode=e,this.tipMessage=!1,this.listOptions=Object(n["q"])(this.importOptions),this.listOptions=this.listOptions.map(e=>({...e,id:Object(Ve["a"])()})))},handleExpressionChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value},cancel(){this.listMode="普通输入",this.tipMessage=!1}}}),He=qe,We=(s("b16a"),Object(S["a"])(He,ze,Ne,!1,null,"ddef3f22",null)),Ue=We.exports,Qe={label:"选项输入",icon:"ios-create-outline",name:"z-options-input",attributes:[{name:"name",label:"字段标识",type:String,value(){return"options_input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"}]},Je={name:"z-options-input",metadata:Qe,components:{OptionsInputComponent:Ue},mixins:[Re["a"]],props:{isVisible:{type:Boolean,default:!0}},data(){return{name:this.$attrs.name}}},Ge=Je,Ke=Object(S["a"])(Ge,Pe,Be,!1,null,"aba7fa40",null),Ye=Ke.exports,Ze=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,validator:e.validateOptionsInput}}},[e._l(e.listOptionsMap,(function(t,i,a){return s("div",{staticClass:"optionsInputItem"},[s("div",{staticClass:"title"},[s("span",[e._v("互斥组"+e._s(a+1))]),e.readOnly?e._e():s("div",{staticClass:"delete-btn",on:{click:function(t){return e.handleDelete(i)}}},[e._v("删除互斥组")])]),s("OptionsInputComponent",{attrs:{name:"excludeOptionsInput-"+(a+1),value:e.listOptionsMap[i],readOnly:e.readOnly},on:{"update:value":function(t){return e.$set(e.listOptionsMap,i,t)}}})],1)})),s("div",{staticClass:"action"},[e.readOnly?e._e():s("Button",{staticClass:"mrs",attrs:{size:"small",type:"primary"},on:{click:e.handleAdd}},[e._v("添加互斥组")])],1)],2):e._e()},Xe=[],et={name:"z-exclude-options-input",metadata:it,components:{OptionsInputComponent:Ue},mixins:[x["a"]],props:{isVisible:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1}},data(){return{listOptionsMap:{},itemData:[]}},watch:{listOptionsMap:{deep:!0,handler(e){this.$optimus.formData[this.name]=Object.keys(e).map(t=>e[t])}}},created(){this.$optimus.formData[this.name]&&this.$optimus.formData[this.name].forEach((e,t)=>{this.$set(this.listOptionsMap,"excludeOptionsInput-"+(t+1),e)})},methods:{handleAdd(){this.$set(this.listOptionsMap,"excludeOptionsInput-"+(Object.keys(this.listOptionsMap).length+1),[])},handleDelete(e){this.$delete(this.$optimus.formData,e),this.$delete(this.listOptionsMap,e)},validateOptionsInput(e,t,s){if(!t.every(e=>e.length>0))return void s(new Error("请完善互斥组选项"));const i=Object(a["flattenDeep"])(t),o=Object(a["uniqBy"])(i,"value");i.length===o.length?s():s(new Error("互斥组不允许有重复选项"))}}},tt=et,st=(s("eafa"),Object(S["a"])(tt,Ze,Xe,!1,null,"e4d762d0",null)),it=st.exports,at=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{staticClass:"multiple-select",attrs:{label:e.label,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未选择"},prop:e.name}},[e.enableExpression?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e(),"固定值"===e.typeMode?[e.isShowDropdown?s("Select",{ref:"selectRef",attrs:{"default-label":e.$optimus.formData[e.name],multiple:"",disabled:e.isDisabled||e.readOnly,transfer:"",filterable:"","remote-method":e.myRemoteMethod,loading:e.loading},on:{"on-query-change":e.handleQueryChange,"on-change":e.handleValueChange},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.curOptions,(function(t){return s("Option",{key:t.value,attrs:{value:t.value,disabled:t.disabled}},[e._v(e._s(t.label))])})),1):"list"===e.myExhibit?s("CheckboxGroup",{attrs:{disabled:e.readOnly},on:{"on-change":e.handleValueChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.myOptions,(function(t){return s("Row",{key:t.value},[s("Checkbox",{staticClass:"checkboxItem checkboxItemExhibitList",attrs:{label:t.value,disabled:e.isDisabled||t.disabled||e.readOnly}},[e._v(e._s(t.label))])],1)})),1):s("CheckboxGroup",{attrs:{disabled:e.readOnly},on:{"on-change":e.handleValueChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.myOptions,(function(t){return s("Checkbox",{key:t.value,staticClass:"checkboxItem",attrs:{label:t.value,disabled:e.isDisabled||t.disabled||e.readOnly}},[e._v(e._s(t.label))])})),1),s("p",{directives:[{name:"show",rawName:"v-show",value:e.myOptions.length>e.maxLength&&!e.isDisabled,expression:"myOptions.length > maxLength && !isDisabled"}],staticClass:"txt-red"},[s("Icon",{attrs:{type:"ios-alert-outline"}}),s("span",[e._v("由于导入数据量过大，一共"+e._s(e.myOptions.length)+"条，只展示前 "+e._s(e.maxLength)+" 条")])],1),s("selectDisabled",{directives:[{name:"show",rawName:"v-show",value:e.showOptionModal&&e.isDisabled,expression:"showOptionModal && isDisabled"}],ref:"selectDisabled",attrs:{type:"select",options:e.myOptions},on:{closeModal:function(t){e.showOptionModal=!1}}}),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1)]:s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},ot=[],nt={label:"选择器",icon:"ios-arrow-down",name:"z-multiple-select",attributes:[{name:"name",label:"字段标识",type:String,value(){return"select_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"选择器"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"readOnly",label:"是否只读",component:"z-switch",type:Boolean,value:!1},{name:"selectType",label:"选择类型",component:"z-single-select",type:String,value:"multiple",options:[{value:"single",label:"单选"},{value:"multiple",label:"多选"}]},{name:"exhibit",label:"展示样式",component:"z-single-select",type:String,value:"auto",options:[{value:"auto",label:"默认"},{value:"dropdown",label:"下拉"},{value:"tiled",label:"平铺"},{value:"list",label:"列表"}],attributes:{optionsDesc:'${output.exhibit === "auto" && "选项数量小于或等于10为平铺；选项数量大于10则为下拉"}'}},{name:"isMutuallyExclusive",label:"是否配置互斥组",component:"z-switch",type:Boolean,value:!1,attributes:{isVisible:'${output.selectType === "multiple"}'}},{name:"options",label:"选项",component:"z-options-input",type:String,required:!0,value:"",attributes:{isVisible:'${!(output.selectType === "multiple" && output.isMutuallyExclusive)}'}},{name:"exclusiveOptions",label:"互斥组选项",component:"z-exclude-options-input",type:String,required:!0,value:"",attributes:{isVisible:'${output.selectType === "multiple" && output.isMutuallyExclusive}'}},{name:"value",label:"默认值",component:"z-multiple-select",type:String,attributes:{basicMode:!0,selectType:"${output.selectType}",exhibit:"dropdown",options:"${output.options}",isMutuallyExclusive:"${output.isMutuallyExclusive}",exclusiveOptions:"${output.exclusiveOptions}",enableExpression:!0},required:!1,value:[]}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"多选",type:["array","null"]}},required:["name","label"]}},rt={metadata:nt,components:{selectDisabled:I,Fitting:B["a"],ExpressionDropdown:R["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{selectType:{type:String,default:"multiple"},options:[Array,String],basicMode:{type:Boolean,default:!1},exhibit:{type:[Array,String],default:"auto"},isMutuallyExclusive:{type:Boolean,default:!1},exclusiveOptions:[Array,String],readOnly:{type:Boolean,default:!1},enableExpression:{type:Boolean,default:!1}},data(){return{loading:!1,curOptions:[],maxLength:500,showOptionModal:!1,searchVal:"",myExhibit:Object(a["isArray"])(this.exhibit)?this.exhibit[0]:this.exhibit,typeMode:"固定值",fixedValue:!1,expressionValue:"${}"}},computed:{myOptions(){let e=[];if("multiple"===this.selectType&&this.isMutuallyExclusive)this.exclusiveOptions.forEach(t=>{e.push(...t)});else if(Object(a["isString"])(this.options)){if(""===this.options||this.options.match(/^\${(.+)}$/))return[];try{e=this.options.includes("@_@")?Object(n["q"])(this.options):JSON.parse(this.options)}catch(t){console.info(this.options+" 解析失败")}}else e=this.options;return Object(a["uniqBy"])(e,"value")},myRemoteMethod(){return this.basicMode?null:this.remoteMethod},isShowDropdown(){return"auto"===this.myExhibit&&(0===this.myOptions.length||this.myOptions.length>10)||"dropdown"===this.myExhibit||0===this.myOptions.length||this.myOptions.length>this.maxLength}},watch:{options(){this.basicMode&&(this.curOptions=this.myOptions.slice(0,this.maxLength))},myOptions(){this.curOptions=this.myOptions.slice(0,this.maxLength)}},created(){this.$optimus.formData[this.name]=this.$optimus.formData[this.name]||[];const e=this.$optimus.formData[this.name];if(Object(a["isString"])(e))if(e.match(/^\$\{.*\}$/))this.typeMode="表达式",this.expressionValue=e;else try{this.$optimus.formData[this.name]=JSON.parse(e)}catch(t){console.log(t)}else this.typeMode="固定值",this.fixedValue=e;this.curOptions=this.myOptions.slice(0,this.maxLength),this.isMutuallyExclusive&&this.mutuallyExclusiveChange(this.$optimus.formData[this.name])},methods:{updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue},handleExpressionChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value},remoteMethod(e){this.basicMode||""===Object(a["trim"])(e)||(this.loading=!0,setTimeout(()=>{this.loading=!1,this.curOptions=this.myOptions.filter(t=>t.label.toLowerCase().indexOf(e.toLowerCase())>-1)},300))},handleQueryChange(e){this.basicMode||Object(a["trim"])(e)||(this.curOptions=this.myOptions.slice(0,this.maxLength))},showModal(){this.showOptionModal=!0,this.$refs.selectDisabled.handleInputFocus()},handleValueChange(e){if("single"===this.selectType)return e&&Object(a["isArray"])(e)?(e.length>1&&e.shift(),this.$optimus.formData[this.name]=e.length>0?[e[0]]:[]):e.match(/^\$\{.*\}$/)||(this.$optimus.formData[this.name]=e?[e]:[]),void this.$nextTick(()=>{var e,t,s,i,a,o;null===(e=this.$refs.selectRef)||void 0===e||null===(t=e.$el)||void 0===t||null===(s=t.parentElement)||void 0===s||s.click(),null===(i=this.$refs.selectRef)||void 0===i||null===(a=i.$el)||void 0===a||null===(o=a.querySelector('input[type="text"]'))||void 0===o||o.blur()});this.isMutuallyExclusive&&this.mutuallyExclusiveChange(e),"multiple"===this.selectType&&(this.$optimus.formData[this.name]=e.filter(e=>this.myOptions.find(t=>t.value===e)))},mutuallyExclusiveChange(e){e.length>0?this.exclusiveOptions.forEach(t=>{const s=Object(a["find"])(t,{value:e[0]});s?t.forEach(e=>{Object.assign(e,{disabled:!1})}):t.forEach(e=>{Object.assign(e,{disabled:!0})})}):this.myOptions.forEach(e=>Object.assign(e,{disabled:!1}))}}},lt=rt,ct=(s("4888"),Object(S["a"])(lt,at,ot,!1,null,"da337c04",null)),dt=ct.exports,ut=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未选择"},prop:e.name}},[e._l(e.myTagLists,(function(t,i){return s("CheckboxGroup",{key:t.tag,staticStyle:{display:"block"},on:{"on-change":e.onChange},model:{value:t.level,callback:function(s){e.$set(t,"level",s)},expression:"tagObj.level"}},[s("div",[e._v(e._s(t.tag)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name,multipleTag:t.tag}})],1),e._l(t.type,(function(t){return s("Checkbox",{key:t,staticClass:"checkboxItem",attrs:{label:String(t),disabled:e.isDisabled}},[e._v(e._s(t))])}))],2)})),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2)},ht=[],pt={label:"多标签选择器",icon:"ios-arrow-down",name:"z-multiple-tag-select",attributes:[{name:"name",label:"字段标识",type:String,value(){return"multiple_tag_select_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"标签是否准确"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"selectType",label:"选择类型",component:"z-single-select",type:String,value:"single",options:[{value:"single",label:"单选"},{value:"multiple",label:"多选"}]},{name:"tagLists",label:"标签集",value:"",type:String}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"多标签选择器",type:["array","null"]}},required:["name","label"]}},mt={metadata:pt,components:{Fitting:B["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{tagLists:[Array,String],selectType:{type:String,default:"single"}},data(){return{myTagLists:[],ended:!1}},watch:{myTagLists:{handler(){const e=Object(a["cloneDeep"])(this.myTagLists).map(e=>({tag:e.tag,level:"single"===this.selectType?Object(a["join"])(e.level):e.level}));this.ended="single"===this.selectType?e.every(e=>""!==e.level):e.every(e=>e.level.length>0),this.$optimus.formData[this.name]=e},deep:!0}},created(){this.initTagLists()},mounted(){const e=this;this.$optimus.$on("optimus:forms-stage:check",()=>{const t=!e.required||e.ended;this.$optimus.$emit("optimus:optimus-engine:check",t)})},methods:{initTagLists(){try{let e=[];if(""===this.tagLists)return[];e=Object(a["isString"])(this.tagLists)?JSON.parse(this.tagLists):this.tagLists,this.myTagLists=e.map(e=>{let t=[];if(this.$optimus.formData[this.name]){const s=Object(a["find"])(this.$optimus.formData[this.name],{tag:e.tag});s&&s.level&&(t="single"===this.selectType?[s.level]:s.level)}return Object.assign(e,{level:t})})}catch(e){console.log("标签集格式错误:",this.tagLists,e)}},onChange(e){"single"===this.selectType&&e.length>1&&e.shift()}}},gt=mt,bt=(s("7e60"),Object(S["a"])(gt,ut,ht,!1,null,"34987632",null)),ft=bt.exports,vt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未选择"}}},[s("div",{staticClass:"expression"},[e.enableExpression?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e()],1),"固定值"===e.typeMode?[e.isFullPath?s("t-cascader",{ref:"cascader",attrs:{disabled:e.isDisabled,options:e.fullPathOptions,"value-type":"full",multiple:"多选"===e.mode,clearable:"",filterable:"",trigger:e.trigger},on:{change:e.handleChangeValue},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.fullPathValue,callback:function(t){e.fullPathValue=t},expression:"fullPathValue"}}):s("Cascader",{ref:"cascader",attrs:{data:e.myOptions,disabled:e.isDisabled,filterable:"",transfer:"",multiple:"多选"===e.mode,"change-on-select":!0,"transfer-class-name":"cascader-select-dropdown"},nativeOn:{click:function(t){return e.showModal.apply(null,arguments)}},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})]:[s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})],s("selectDisabled",{directives:[{name:"show",rawName:"v-show",value:e.showOptionModal&&e.isDisabled,expression:"showOptionModal && isDisabled"}],ref:"selectDisabled",attrs:{type:"cascader",options:e.isFullPath?e.fullPathOptions:e.myOptions},on:{closeModal:function(t){e.showOptionModal=!1}}}),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},yt=[],wt={label:"级联选择器",icon:"ios-arrow-down",name:"z-cascader",attributes:[{name:"name",label:"字段标识",type:String,value(){return"cascader_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"级联选择器"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"mode",label:"选择类型",component:"z-single-select",type:String,value:"多选",attributes:{options:[{label:"多选",value:"多选"},{label:"单选",value:"单选"}]}},{name:"isFullPath",label:"是否限制为全路径输入",component:"z-switch",type:Boolean,value:!1},{name:"trigger",label:"触发方式",component:"z-single-select",type:String,value:"hover",attributes:{isVisible:"${output.isFullPath}",options:[{label:"悬浮触发",value:"hover"},{label:"点击触发",value:"click"}]}},{name:"options",label:"选项",type:String,required:!0,component:"z-tree-input",value:""},{name:"value",label:"默认值",type:String,component:"z-cascader",attributes:{required:!1,mode:"${output.mode}",isFullPath:"${output.isFullPath}",options:"${output.options}",enableExpression:!0},value:""}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"级联选择器",type:["array","null"]}},required:["name","label"]}},xt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.handleClose,expression:"handleClose"}],class:e.classes},[s("div",{ref:"reference",class:[e.prefixCls+"-rel"],on:{click:e.toggleOpen}},[s("input",{attrs:{type:"hidden",name:e.name},domProps:{value:e.currentValue}}),e._t("default",(function(){return[s("i-input",{ref:"input",staticClass:"z-cascader-input",attrs:{"element-id":e.elementId,readonly:!e.filterable&&e.multiple,disabled:e.itemDisabled,value:e.displayInputRender,size:e.size,placeholder:e.multiple?"":e.inputPlaceholder},on:{"on-change":e.handleInput}}),e.multiple?s("div",{ref:"tags",staticClass:"ivu-cascader__tags"},[e._l(e.presentTags,(function(t,i){return s("Tag",{key:i,attrs:{name:t,fade:!1,closable:!e.itemDisabled},on:{"on-close":e.deleteTag}},[s("span",[e._v(e._s(t))])])})),e.filterable&&!e.itemDisabled?s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.query,expression:"query",modifiers:{trim:!0}}],staticClass:"ivu-cascader__search-input",attrs:{type:"text",placeholder:e.presentTags.length?"":e.inputPlaceholder},domProps:{value:e.query},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete","Del"])?null:e.deleteQuery.apply(null,arguments)},input:function(t){t.target.composing||(e.query=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}):e._e()],2):e._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:e.filterable&&""===e.query&&!e.multiple,expression:"filterable && query === '' && !multiple"}],class:[e.prefixCls+"-label"],on:{click:e.handleFocus}},[e._v(e._s(e.displayRender))]),s("Icon",{directives:[{name:"show",rawName:"v-show",value:e.showCloseIcon,expression:"showCloseIcon"}],class:[e.prefixCls+"-arrow"],attrs:{type:"ios-close-circle"},nativeOn:{click:function(t){return t.stopPropagation(),e.clearSelect.apply(null,arguments)}}}),s("Icon",{class:[e.prefixCls+"-arrow"],attrs:{type:e.arrowType,custom:e.customArrowType,size:e.arrowSize}})]}))],2),s("transition",{attrs:{name:"transition-drop"}},[s("Drop",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"},{name:"transfer-dom",rawName:"v-transfer-dom"}],ref:"drop",class:e.dropdownCls,attrs:{"data-transfer":e.transfer,transfer:e.transfer}},[s("div",[s("Caspanel",{directives:[{name:"show",rawName:"v-show",value:!e.filterable||e.filterable&&""===e.query,expression:"!filterable || (filterable && query === '')"}],ref:"caspanel",attrs:{"prefix-cls":e.prefixCls,data:e.data,disabled:e.itemDisabled,"change-on-select":e.changeOnSelect,trigger:e.trigger,multiple:e.multiple,"prefix-path":""}}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.filterable&&""!==e.query&&e.querySelections.length,expression:"filterable && query !== '' && querySelections.length"}],class:[e.prefixCls+"-dropdown"]},[s("ul",{class:[e.selectPrefixCls+"-dropdown-list"]},e._l(e.querySelections,(function(t,i){var a;return s("li",{key:i,class:[e.selectPrefixCls+"-item",(a={},a[e.selectPrefixCls+"-item-disabled"]=t.disabled,a[e.selectPrefixCls+"-item-checked"]=t.checked,a)],domProps:{innerHTML:e._s(t.display)},on:{click:function(t){return e.handleSelectItem(t,i)}}})})),0)]),s("ul",{directives:[{name:"show",rawName:"v-show",value:e.filterable&&""!==e.query&&!e.querySelections.length||!e.data.length,expression:"(filterable && query !== '' && !querySelections.length) || !data.length"}],class:[e.prefixCls+"-not-found-tip"]},[s("li",[e._v(e._s(e.localeNotFoundText))])])],1)])],1)],1)},Ct=[],jt=s("4d11"),Ot=s("8703"),kt=s("34c4"),At=s("8665"),St=s("7a40"),_t=s("54a8"),It=s("3a17"),$t=s("4a57"),Mt=s("fd49"),Tt=s("c5d5"),Et=s("f867"),Lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("span",[e.data&&e.data.length?s("ul",{class:[e.prefixCls+"-menu"]},e._l(e.data,(function(t,i){return s("Casitem",{key:i,attrs:{"prefix-cls":e.prefixCls,data:t,"tmp-item":e.tmpItem,multiple:e.multiple,"prefix-path":e.prefixPath},nativeOn:{click:function(s){return s.stopPropagation(),e.handleClickItem(s,t)},dblclick:function(s){return s.stopPropagation(),e.handleDbclick(t)},mouseenter:function(s){return s.stopPropagation(),e.handleHoverItem(t)}}})})),1):e._e(),e.sublist&&e.sublist.length?s("Caspanel",{attrs:{"prefix-cls":e.prefixCls,data:e.sublist,disabled:e.disabled,trigger:e.trigger,multiple:e.multiple,"prefix-path":e.prefixPath+"/"+e.tmpItem.value,"change-on-select":e.changeOnSelect}}):e._e()],1)},Dt=[],Pt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{class:e.classes},[e.multiple?s("Checkbox",{attrs:{label:e.data.label,value:e.checked},on:{"on-change":e.handleCheck}}):e._e(),s("span",[e._v(e._s(e.data.label))]),e.showArrow?s("Icon",{attrs:{type:e.arrowType,custom:e.customArrowType,size:e.arrowSize}}):e._e(),e.showLoading?s("i",{staticClass:"ivu-icon ivu-icon-ios-loading ivu-load-loop ivu-cascader-menu-item-loading"}):e._e()],1)},Bt=[],Rt=s("30f0"),zt={name:"Casitem",components:{Icon:St["a"],Checkbox:Rt["a"]},mixins:[Mt["a"]],inject:{Cascader:{default:""}},props:{data:Object,prefixCls:String,tmpItem:Object,multiple:Boolean,prefixPath:String},data(){return{}},computed:{classes(){return[this.prefixCls+"-menu-item",{[this.prefixCls+"-menu-item-active"]:this.tmpItem.value===this.data.value,[this.prefixCls+"-menu-item-disabled"]:this.data.disabled,["in-checked-path"]:this.inPath}]},showArrow(){return this.data.children&&this.data.children.length||"loading"in this.data&&!this.data.loading},showLoading(){return"loading"in this.data&&this.data.loading},arrowType(){let e="ios-arrow-forward";return this.$IVIEW&&(this.$IVIEW.cascader.customItemArrow?e="":this.$IVIEW.cascader.itemArrow&&(e=this.$IVIEW.cascader.itemArrow)),e},customArrowType(){let e="";return this.$IVIEW&&this.$IVIEW.cascader.customItemArrow&&(e=this.$IVIEW.cascader.customItemArrow),e},arrowSize(){let e="";return this.$IVIEW&&this.$IVIEW.cascader.itemArrowSize&&(e=this.$IVIEW.cascader.itemArrowSize),e},checked(){const{currentValue:e}=this.Cascader;return!(!e||0===e.length)&&e.some(e=>{const t="/"+e.join("/"),s=`${this.prefixPath}/${this.data.value}`;return t===s})},inPath(){if(!this.multiple)return!1;const{currentValue:e}=this.Cascader;if(!e||0===e.length)return!1;const t=e.some(e=>{const t=Object(a["findIndex"])(e,e=>e===this.data.value);if(-1===t)return!1;const s="/"+e.slice(0,t+1).join("/"),i=`${this.prefixPath}/${this.data.value}`;return s===i});return t}},methods:{handleCheck(e){const t=this.genCheckdItem();this.dispatch("Cascader","on-checked-change",{item:t,checked:e})},genCheckdItem(){const e=[this.data.value];let t=this.$parent.$parent;while(null!==t&&"Caspanel"===t.$options.name)e.unshift(t.tmpItem.value),t=t.$parent;return e}}},Nt=zt,Ft=(s("636d"),Object(S["a"])(Nt,Pt,Bt,!1,null,"6ffae99a",null)),Vt=Ft.exports,qt={name:"Caspanel",components:{Casitem:Vt},mixins:[Mt["a"]],inject:{Cascader:{default:""}},props:{data:{type:Array,default(){return[]}},disabled:Boolean,changeOnSelect:Boolean,trigger:String,prefixCls:String,multiple:{type:Boolean,default:!1},prefixPath:String},data(){return{tmpItem:{},result:[],sublist:[]}},watch:{data(){this.sublist=[]}},mounted(){this.$on("on-find-selected",e=>{const t=e.value,s=[...t];for(let i=0;i<s.length;i++)for(let e=0;e<this.data.length;e++)if(s[i]===this.data[e].value)return this.handleTriggerItem(this.data[e],!0),s.splice(0,1),this.$nextTick(()=>{this.broadcast("Caspanel","on-find-selected",{value:s})}),!1}),this.$on("on-clear",(e=!1)=>{if(this.sublist=[],this.tmpItem={},e){const e=Object($t["a"])(this,"Caspanel");e&&e.$emit("on-clear",!0)}})},methods:{handleClickItem(e,t){"click"!==this.trigger&&t.children&&t.children.length||this.handleTriggerItem(t,!1,!0,e)},handleHoverItem(e){"hover"===this.trigger&&e.children&&e.children.length&&this.handleTriggerItem(e,!1,!0)},handleDbclick(e){if(!0===this.multiple){const{currentValue:t}=this.Cascader;let s=!1;s=!(!t||0===t.length)&&t.some(t=>{const s="/"+t.join("/"),i=`${this.prefixPath}/${e.value}`;return s===i});const i=[e.value];let a=this.$parent;while(null!==a&&"Caspanel"===a.$options.name)i.unshift(a.tmpItem.value),a=a.$parent;this.dispatch("Cascader","on-checked-change",{item:i,checked:!s})}},handleTriggerItem(e,t=!1,s=!1,i=null){if(e.disabled)return;const o=Object($t["b"])(this,"Cascader");if(void 0!==e.loading&&!e.children.length&&o&&o.loadData)o.loadData(e,()=>{s&&(o.isLoadedChildren=!0),e.children.length&&this.handleTriggerItem(e)});else{if(!0===this.multiple){if(i&&"checkbox"===i.target.type)return;const t=this.getBaseItem(e);if(Object(a["isEqual"])(t,this.tmpItem))return;this.tmpItem=t,this.emitUpdate([t]),e.children&&e.children.length?(this.sublist=e.children,this.$nextTick(()=>{const e=Object($t["a"])(this,"Caspanel");this.multipleClearTmp(e)})):this.sublist=[]}else{const s=this.getBaseItem(e);if((this.changeOnSelect||s.label!==this.tmpItem.label||s.value!==this.tmpItem.value||s.label===this.tmpItem.label&&s.value===this.tmpItem.value)&&(this.tmpItem=s,this.emitUpdate([s])),e.children&&e.children.length){if(this.sublist=e.children,this.dispatch("Cascader","on-result-change",{lastValue:!1,changeOnSelect:this.changeOnSelect,fromInit:t}),this.changeOnSelect){const e=Object($t["a"])(this,"Caspanel");e&&e.$emit("on-clear",!0)}}else this.sublist=[],this.dispatch("Cascader","on-result-change",{lastValue:!0,changeOnSelect:this.changeOnSelect,fromInit:t})}o&&o.$refs.drop.update()}},updateResult(e){this.result=[this.tmpItem].concat(e),this.emitUpdate(this.result)},getBaseItem(e){const t=Object.assign({},e);return t.children&&delete t.children,t},emitUpdate(e){"Caspanel"===this.$parent.$options.name?this.$parent.updateResult(e):this.$parent.$parent.updateResult(e)},multipleClearTmp(e){function t(e){const s=e;s.tmpItem={};const i=Object($t["a"])(e,"Caspanel");i&&t(i)}t(e)}}},Ht=qt,Wt=Object(S["a"])(Ht,Lt,Dt,!1,null,null,null),Ut=Wt.exports,Qt=s("3e8f");const Jt="ivu-cascader",Gt="ivu-select";var Kt={name:"Cascader",components:{iInput:jt["a"],Drop:kt["a"],Icon:St["a"],Caspanel:Ut,Tag:At["a"],Select:Ot["a"]},directives:{clickOutside:_t["a"],TransferDom:It["a"]},mixins:[Mt["a"],Tt["a"],Et["a"]],provide(){return{Cascader:this}},props:{data:{type:Array,default(){return[]}},value:{type:Array,default(){return[]}},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},placeholder:{type:String},size:{validator(e){return Object($t["e"])(e,["small","large","default"])},default(){return this.$IVIEW&&""!==this.$IVIEW.size?this.$IVIEW.size:"default"}},trigger:{validator(e){return Object($t["e"])(e,["click","hover"])},default:"click"},multiple:{type:Boolean,default:!1},changeOnSelect:{type:Boolean,default:!1},renderFormat:{type:Function,default(e){return e.join(" / ")}},loadData:{type:Function},filterable:{type:Boolean,default:!1},notFoundText:{type:String},transfer:{type:Boolean,default(){return!(!this.$IVIEW||""===this.$IVIEW.transfer)&&this.$IVIEW.transfer}},name:{type:String},elementId:{type:String},capture:{type:Boolean,default(){return!this.$IVIEW||this.$IVIEW.capture}},transferClassName:{type:String}},data(){return{prefixCls:Jt,selectPrefixCls:Gt,visible:!1,selected:[],tmpSelected:[],updatingValue:!1,currentValue:this.value,query:"",validDataStr:"",isLoadedChildren:!1,presentTags:[]}},computed:{classes(){return[""+Jt,{[Jt+"-show-clear"]:this.showCloseIcon,[`${Jt}-size-${this.size}`]:!!this.size,[Jt+"-visible"]:this.visible,[Jt+"-disabled"]:this.itemDisabled,[Jt+"-not-found"]:this.filterable&&""!==this.query&&!this.querySelections.length}]},showCloseIcon(){return this.currentValue&&this.currentValue.length&&this.clearable&&!this.itemDisabled},displayRender(){const e=[];for(let t=0;t<this.selected.length;t++)e.push(this.selected[t].label);return this.renderFormat(e,this.selected)},displayInputRender(){return this.filterable?"":this.displayRender},localePlaceholder(){return void 0===this.placeholder?this.t("i.select.placeholder"):this.placeholder},inputPlaceholder(){return this.filterable&&this.currentValue.length?null:this.localePlaceholder},localeNotFoundText(){return void 0===this.notFoundText?this.t("i.select.noMatch"):this.notFoundText},querySelections(){let e=[];const{currentValue:t}=this;function s(i,o,n){for(let r=0;r<i.length;r++){const l=i[r];if(l.__label=o?`${o} / ${l.label}`:l.label,l.__value=n?`${n},${l.value}`:l.value,l.children&&l.children.length)s(l.children,l.__label,l.__value),delete l.__label,delete l.__value;else{let s=!1;s=t.some(e=>Object(a["isEqual"])(e,l.__value.split(","))),e.push({label:l.__label,value:l.__value,display:l.__label,item:l,disabled:!!l.disabled,checked:s})}}}return s(this.data),e=e.filter(e=>!!e.label&&e.label.indexOf(this.query)>-1).map(e=>(e.display=e.display.replace(new RegExp(this.query,"g"),`<span>${this.query}</span>`),e)),e},arrowType(){let e="ios-arrow-down";return this.$IVIEW&&(this.$IVIEW.cascader.customArrow?e="":this.$IVIEW.cascader.arrow&&(e=this.$IVIEW.cascader.arrow)),e},customArrowType(){let e="";return this.$IVIEW&&this.$IVIEW.cascader.customArrow&&(e=this.$IVIEW.cascader.customArrow),e},arrowSize(){let e="";return this.$IVIEW&&this.$IVIEW.cascader.arrowSize&&(e=this.$IVIEW.cascader.arrowSize),e},dropdownCls(){return{[Jt+"-transfer"]:this.transfer,[this.transferClassName]:this.transferClassName}}},watch:{visible(e){e?(this.currentValue.length&&this.updateSelected(),this.transfer&&(this.updateDropTIndex(),this.$refs.drop.update()),this.broadcast("Drop","on-update-popper")):(this.filterable&&!this.multiple&&(this.query="",this.$refs.input.currentValue=""),this.transfer&&this.$refs.drop.destroy(),this.broadcast("Drop","on-destroy-popper"),this.query=""),this.$emit("on-visible-change",e)},value(e){this.currentValue=e,e.length||(this.selected=[])},currentValue(){this.$emit("input",this.currentValue),this.updatingValue?this.updatingValue=!1:(this.updateSelected(!0),this.multiple&&this.updatePresentTags())},data:{deep:!0,handler(){const e=JSON.stringify(this.getValidData(this.data));e!==this.validDataStr&&(this.validDataStr=e,this.isLoadedChildren||this.$nextTick(()=>this.updateSelected(!1,this.changeOnSelect)),this.isLoadedChildren=!1)}}},created(){this.validDataStr=JSON.stringify(this.getValidData(this.data)),this.$on("on-result-change",e=>{const{lastValue:t}=e,{changeOnSelect:s}=e,{fromInit:i}=e;if(t||s){const e=JSON.stringify(this.currentValue);this.selected=this.tmpSelected;const t=[];this.selected.forEach(e=>{t.push(e.value)}),i||(this.updatingValue=!0,this.currentValue=t,this.emitValue(this.currentValue,e))}!t||i||this.multiple||this.handleClose()}),this.$on("on-checked-change",e=>{const{item:t,checked:s}=e,i=JSON.stringify(this.currentValue),o=Object(a["findIndex"])(this.currentValue,e=>Object(a["isEqual"])(e,t));-1===o||s?-1===o&&s&&this.currentValue.push(t):this.currentValue.splice(o,1),this.emitValue(this.currentValue,i)})},mounted(){this.updateSelected(!0),this.multiple&&this.updatePresentTags()},methods:{clearSelect(){if(this.itemDisabled)return!1;const e=JSON.stringify(this.currentValue);this.currentValue=[],this.selected=[],this.tmpSelected=[],this.handleClose(),this.emitValue(this.currentValue,e),this.broadcast("Caspanel","on-clear")},handleClose(){this.visible=!1},toggleOpen(){if(this.itemDisabled)return!1;this.visible?this.filterable||this.handleClose():this.onFocus()},onFocus(){this.visible=!0,this.currentValue.length||this.broadcast("Caspanel","on-clear")},updateResult(e){this.tmpSelected=e},updateSelected(e=!1,t=!1){(!this.changeOnSelect||e||t)&&this.broadcast("Caspanel","on-find-selected",{value:this.currentValue})},emitValue(e,t){JSON.stringify(e)!==t&&(this.$emit("on-change",this.currentValue,JSON.parse(JSON.stringify(this.selected))),this.$nextTick(()=>{this.dispatch("FormItem","on-form-change",{value:this.currentValue,selected:JSON.parse(JSON.stringify(this.selected))})}))},handleInput(e){this.query=e.target.value},handleSelectItem(e,t){const s=this.querySelections[t];if(s.item.disabled)return!1;if(this.multiple)e.stopPropagation(),this.$emit("on-checked-change",{item:s.value.split(","),checked:!0});else{this.query="",this.$refs.input.currentValue="";const e=JSON.stringify(this.currentValue);this.currentValue=s.value.split(","),setTimeout(()=>{this.emitValue(this.currentValue,e),this.handleClose()},0)}},handleFocus(){this.$refs.input.focus()},getValidData(e){function t(e){const s=Object.assign({},e);return"loading"in s&&delete s.loading,"__value"in s&&delete s.__value,"__label"in s&&delete s.__label,"children"in s&&s.children.length&&(s.children=s.children.map(e=>t(e))),s}return e.map(e=>t(e))},updatePresentTags(){this.currentValue&&this.currentValue.length?this.presentTags=this.currentValue.map(e=>e.join("/")):this.presentTags=[],this.$nextTick(()=>{this.updateStyle()})},updateStyle(){const e=window.getComputedStyle(this.$refs.tags,null).height,t=this.$refs.input.$el.querySelector("input"),s=window.getComputedStyle(t,null),{height:i,paddingTop:a,paddingBottom:o}=s;parseInt(e,10)!==parseInt(i,10)&&(t.style.height=parseInt(e,10)+parseInt(a,10)+parseInt(o,10)+"px")},deleteTag(e,t){const s=t.split("/"),i=JSON.stringify(this.currentValue),o=Object(a["findIndex"])(this.currentValue,e=>Object(a["isEqual"])(e,s));-1!==o&&this.currentValue.splice(o,1),this.emitValue(this.currentValue,i)},deleteQuery(){if(""===this.query)return this.query="";this.query=this.query.slice(0,this.query.length)},updateDropTIndex(){let e;const t=document.querySelectorAll(".ivu-modal-wrap");t.forEach(t=>{if(t.contains(this.$refs.reference)){e=Number(getComputedStyle(t).zIndex)-1e3;while(e>Qt["b"])Object(Qt["a"])()}})}}},Yt=Kt,Zt=(s("7ddb"),Object(S["a"])(Yt,xt,Ct,!1,null,"0b3024f2",null)),Xt=Zt.exports,es={metadata:wt,components:{Cascader:Xt,selectDisabled:I,Fitting:B["a"],ExpressionDropdown:R["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{options:[Array,String],mode:{type:String,default:"多选"},isFullPath:{type:Boolean,default:!1},trigger:{type:String,default:"hover"},enableExpression:{type:Boolean,default:!1}},data(){return{selectData:[],showOptionModal:!1,fullPathValue:[],fixedValue:[],expressionValue:"${}",typeMode:"固定值",tag:"*_*"}},computed:{myOptions(){let e=[];return e=this.options&&Object(a["isString"])(this.options)&&this.isJSON(this.options)?JSON.parse(this.options):Object(a["isArray"])(this.options)?this.options:[],e},fullPathOptions(){const e=(t,s)=>t.map((t,i)=>{const{label:a,value:o,disabled:n}=t,r=s?`${s}${this.tag}${i+1}`:i+1;if(t.children&&t.children.length>0){const s={label:a,value:`${o}${this.tag}${r}`,children:e(t.children,r),disabled:n};return s}return{label:a,value:`${o}${this.tag}${r}`,disabled:n}});return e(this.myOptions)},isEditTemplate(){var e;return"template-edit"===(null===(e=this.$route)||void 0===e?void 0:e.name)}},watch:{mode(){this.onDefaultValueValidate()},isFullPath(){this.onDefaultValueValidate()}},created(){var e;this.$optimus.formData[this.name]=this.$optimus.formData[this.name]||[];const t=this.$optimus.formData[this.name];if(Object(a["isString"])(t))if(t.match(/^\$\{.*\}$/))this.typeMode="表达式",this.expressionValue=t;else try{this.$optimus.formData[this.name]=JSON.parse(t)}catch(s){this.$optimus.formData[this.name]=t,console.log(s)}else this.typeMode="固定值",this.fixedValue=t;this.isFullPath&&(null===(e=this.$optimus.formData[this.name])||void 0===e?void 0:e.length)>0&&("多选"===this.mode?this.$optimus.formData[this.name].forEach(e=>{const t=this.findValueByLabels(e,this.fullPathOptions);t.length&&this.fullPathValue.push(t)}):this.fullPathValue=this.findValueByLabels(this.$optimus.formData[this.name],this.fullPathOptions))},methods:{findValueByLabels(e,t,s=0,i=[]){if(s===e.length)return i;const a=e[s];for(let o=0;o<t.length;o++){const n=t[o];if(n.label===a){const t=[...i,n.value],a=n.children||[],o=this.findValueByLabels(e,a,s+1,t);if(o.length>0)return o}}return[]},isJSON(e){try{if("object"===typeof JSON.parse(e)&&JSON.parse(e).length)return!0}catch(t){console.log(t)}return!1},showModal(){if(this.isDisabled){this.showOptionModal=!0;const e=this.$refs.selectDisabled.$el,{top:t,left:s,width:i}=this.$refs.cascader.$el.getBoundingClientRect();e.style.top=t+30+"px",e.style.left=s+"px",e.style.width=i+"px",document.body.appendChild(e),this.$refs.selectDisabled.handleInputFocus()}},handleChangeValue(e){if(e&&0!==(null===e||void 0===e?void 0:e.length))if("多选"===this.mode){if(!e.every(e=>Object(a["isArray"])(e)))return;this.$optimus.formData[this.name]=e.map(e=>e.map(e=>e.split(this.tag)[0]))}else this.$optimus.formData[this.name]=e.map(e=>e.split(this.tag)[0]);else this.$optimus.formData[this.name]=[]},onDefaultValueValidate(){const{isEditTemplate:e,$optimus:t,name:s}=this;try{var i;e&&null!==t&&void 0!==t&&null!==(i=t.formData[s])&&void 0!==i&&i.length&&(this.$optimus.formData[s]=[],this.fullPathValue=[],this.$Message.warning("由于配置改变，默认值已被重置"))}catch(a){console.log(a)}},handleExpressionChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value},updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue}}},ts=es,ss=(s("27a6"),s("203f"),Object(S["a"])(ts,vt,yt,!1,null,"0ceeee16",null)),is=ss.exports,as=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,message:e.label+"未添加"}}},[s("div",{staticClass:"expression"},[s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}})],1),"固定值"===e.typeMode?[s("div",{staticClass:"list-mode"},["批量导入"===e.listMode?s("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.getDataRenderCpy(e.listOptions,"listOptions")}}},[e._v("导入")]):e._e(),"批量导入"===e.listMode?s("Button",{staticClass:"mls",attrs:{size:"small"},on:{click:function(t){e.listMode="普通输入"}}},[e._v("取消导入")]):e._e(),"批量导入"===e.listMode?s("Tooltip",{attrs:{placement:"bottom-start",transfer:!0,theme:"light"}},[s("a",{staticStyle:{margin:"0px 3px"}},[s("Icon",{attrs:{type:"ios-alert-outline"}})],1),s("div",{attrs:{slot:"content"},slot:"content"},[s("b",[e._v("输入指引")]),s("p",[e._v("1、数组对象：")]),s("Input",{staticClass:"mbm",attrs:{type:"textarea",rows:5},model:{value:e.exampleMessage,callback:function(t){e.exampleMessage=t},expression:"exampleMessage"}}),s("p",[e._v("2、批量复制表格格式")]),s("Table",{attrs:{columns:e.exampleColumn,data:e.exampleData,size:"small",border:""}})],1)]):e._e()],1),"普通输入"===e.listMode?[s("ul",{staticClass:"list-actions"},[s("li",[s("Tree",{staticClass:"demo-tree-render",attrs:{data:e.dataRenderCpy,render:e.renderContent}})],1)])]:[s("Input",{staticClass:"mts",attrs:{type:"textarea",placeholder:"请输入数组对象 或 从表格中批量复制选项",rows:5},on:{"on-focus":function(t){e.tipMessage=!1}},model:{value:e.listOptions,callback:function(t){e.listOptions=t},expression:"listOptions"}}),e.tipMessage?s("p",{staticClass:"txt-red"},[e._v("文本中有特殊字符无法匹配 或 选项层级不正确 或 导入空数据")]):e._e()]]:[s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})]],2)},os=[],ns={label:"选项输入",icon:"ios-create-outline",name:"z-tree-input",attributes:[{name:"name",label:"字段标识",type:String,value(){return"tree_input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"}]},rs=s("6e12"),ls=s.n(rs),cs={metadata:ns,components:{draggable:ls.a,ExpressionDropdown:R["a"]},mixins:[x["a"]],props:{options:[String,Array,Object]},data(){return{typeMode:"固定值",listMode:"普通输入",exampleMessage:[{value:"1",label:"1",children:[{value:"11",label:"11"}]},{value:"2",label:"2",children:[{value:"22",label:"22",children:[{value:"222",label:"222"}]}]}],exampleColumn:[{title:"层级一",key:"one"},{title:"层级二",key:"two"},{title:"层级三",key:"three"}],exampleData:[{one:"1"},{two:"11"},{one:"2"},{two:"22"},{three:"222"}],tipMessage:!1,selectData:Array,dataRenderCpy:Array,dataRender:[{title:"",expand:!0,render:(e,{root:t,node:s,data:i})=>e("span",[e("Button",{props:Object.assign({},this.buttonProps,{type:"primary"}),style:{height:"24px",width:"72px"},on:{click:()=>{this.append(t,s,i)}}},[e("span",{style:{margin:"0px",padding:"0px"}},"添加选项")]),e("Button",{props:Object.assign({},this.buttonProps,{type:"primary"}),style:{margin:"0 5px",height:"24px",width:"72px"},on:{click:()=>{this.changeListMode("批量导入")}}},[e("span",{style:{margin:"0px",padding:"0px"}},"批量导入")])]),children:[{title:"",expand:!0}]}],buttonProps:{type:"default",size:"small"},listOptions:""}},created(){const e=this.$optimus.formData[this.name];if(Object(a["isString"])(e)&&e.match(/^\$\{.*\}$/))return this.typeMode="表达式",void(this.expressionValue=this.$optimus.formData[this.name]);this.exampleMessage=JSON.stringify(this.exampleMessage,null,2),this.resolveOptions()},methods:{updateTypeMode(e){this.typeMode=e,"表达式"===e?this.$optimus.formData[this.name]=this.expressionValue:(this.exampleMessage=JSON.stringify(this.exampleMessage,null,2),this.resolveOptions())},handleExpressionChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value},renderContent(e,{root:t,node:s,data:i}){return e("span",{style:{display:"inline-block",width:"100%"}},[e("span",[e("Input",{style:{width:"70%",margin:"4px"},attrs:{value:i.title,type:"text",placeholder:"输入选项"},on:{"on-change":e=>{i.title=e.target.value,this.getListOptions()}}})]),e("span",{style:{display:"inline-block",float:"left"}},[e("Button",{props:Object.assign({},this.buttonProps,{icon:"ios-add"}),style:{margin:"8px 4px"},on:{click:()=>{this.append(t,s,i)}}}),e("Button",{props:Object.assign({},this.buttonProps,{icon:"ios-remove"}),style:{margin:"8px 4px"},on:{click:()=>{this.remove(t,s,i)}}})])])},append(e,t,s){if(s){const e=s.children||[];e.push({title:"",expand:!0}),this.$set(s,"children",e)}else this.dataRenderCpy.push({title:"",expand:!0})},remove(e,t,s){const i=e.find(e=>e===t).parent,a=e.find(e=>e.nodeKey===i).node,o=a.children.indexOf(s);a.children.splice(o,1),this.getListOptions()},resolveOptions(){this.dataRenderCpy=Object(a["cloneDeep"])(this.dataRender),this.$optimus.formData[this.name]&&this.getDataRenderCpy(this.$optimus.formData[this.name],"optimus")},changeListMode(e){this.listMode=e,this.tipMessage=!1,this.getListOptions()},getDataRenderCpy(e,t){if(e)if(this.isJSON(e)){const t=JSON.parse(e);this.dataRenderCpy[0].children=this.reduction(t),this.$optimus.formData[this.name]=e,this.listMode="普通输入"}else this.jsonToTree();else"optimus"===t?this.dataRenderCpy[0].children=this.dataRender[0].children:this.tipMessage=!0},getListOptions(){const e=Object(a["cloneDeep"])(this.dataRenderCpy[0].children);this.selectData=[],this.selectData=this.filterData(this.traverse(e)),this.$optimus.formData[this.name]="[]"===JSON.stringify(this.selectData)?"":JSON.stringify(this.selectData,null,2)},isJSON(e){try{if("object"===typeof JSON.parse(e)&&JSON.parse(e).length)return!0}catch(t){return!1}return!1},reduction(e){let t=1,s=1;return Object(a["forEach"])(e,e=>{e.children?(s+=1,e.title=e.value,e.nodeKey=t,e.expand=!(s>2),delete e.value,delete e.label,t+=1,this.reduction(e.children)):(e.title=e.value,e.nodeKey=t,e.expand=!0,delete e.value,delete e.label,t+=1)})},traverse(e){return Object(a["forEach"])(e,e=>{void 0!==e.expand&&delete e.expand,void 0!==e.nodeKey&&delete e.nodeKey,void 0!==e.render&&delete e.render,void 0!==e.selected&&delete e.selected,void 0!==e.title&&(""!==e.title?(e.value=e.title,e.label=e.title,delete e.title):(delete e.title,delete e.children)),e.children&&this.traverse(e.children)})},filterData(e){if(0!==e.length)return e=e.filter(e=>void 0!==e.value),Object(a["forEach"])(e,e=>{Object(a["isArray"])(e.children)&&e.children.length>0?0===Object.keys(e.children[0]).length?delete e.children:this.filterData(e.children):Object(a["isArray"])(e.children)&&0===e.children.length&&delete e.children})},analyzeText(){const e=this.listOptions.replace(/(\n[\s|\t]*\r*\n)/g,"\n").split("\n").map((e,t)=>{let s=0;const i=e.replace(/^\s+|\s+$/gm,"");0===t&&(s=e.match(/^(\s*).*/)[1].length);const a=e.match(/^(\s*).*/)[1].length-s,o={name:i,amount:a};return o});return e},jsonToTree(){try{const e=this.analyzeText(),t=[],s=(e,t,i)=>{let o=0;e.forEach((n,r)=>{if(n.amount===i&&(t.push({value:n.name,label:n.name,children:[],index:r}),o+=1,o>1)){const n=Object(a["cloneDeep"])(t[o-2].index),r=e.slice(n+1,t[o-1].index);r&&r.length>0&&s(r,t[o-2].children,i+1),delete t[o-2].index}if(e.length===r+1){const o=Object(a["cloneDeep"])(t[t.length-1].index),n=e.slice(o+1,e.length);n&&n.length>0&&s(n,t[t.length-1].children,i+1),delete t[t.length-1].index}})};s(e,t,0);const i=Object(a["cloneDeep"])(t);this.$optimus.formData[this.name]=JSON.stringify(t,null,2),this.dataRenderCpy[0].children=this.reduction(i),this.listMode="普通输入"}catch(e){this.tipMessage=!0,console.log(e)}}}},ds=cs,us=(s("427d"),Object(S["a"])(ds,as,os,!1,null,"e1c87a2c",null)),hs=us.exports,ps=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name,rules:"固定值"===e.typeMode?e.ruleNotEmpty:[e.ruleNotEmpty,e.ruleRegExp]}},[e.enableExpression?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e(),"固定值"===e.typeMode?s("t-tooltip",{attrs:{content:e.disabledTip,disabled:!e.disabledTip}},[s("i-switch",{attrs:{disabled:e.$optimus.disabled||e.disabled},on:{"on-change":e.handleSwitchChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},[s("span",{attrs:{slot:"open"},slot:"open"},[e._v(e._s(e.openLabel))]),s("span",{attrs:{slot:"close"},slot:"close"},[e._v(e._s(e.closeLabel))])]),e.labels.length?s("span",{staticClass:"description"},[e._v(e._s(e.labels[e.$optimus.formData[e.name]?0:1]))]):e._e()],1):[s("Input",{attrs:{type:"textarea",autosize:!0,placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleInputChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})],e.description&&"固定值"===e.typeMode?s("span",{staticClass:"description"},[e._v("("+e._s(e.description)+")")]):e._e()],2):e._e()},ms=[],gs={label:"选项输入",icon:"ios-create-outline",name:"z-switch",attributes:[{name:"name",label:"字段标识",type:String,value(){return"switch_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"},{name:"description",label:"字段提示",type:String},{name:"disabled",label:"是否禁用",type:Boolean}]},bs={metadata:gs,components:{ExpressionDropdown:R["a"]},mixins:[x["a"]],props:{description:{type:String},openLabel:{type:String,default:"是"},closeLabel:{type:String,default:"否"},disabled:{type:Boolean,default:!1},isVisible:{type:Boolean,default:!0},enableExpression:{type:Boolean,default:!0},labels:{type:Array,default:()=>[]},disabledTip:String},data(){return{typeMode:"",fixedValue:!1,expressionValue:"${}",ruleNotEmpty:{required:this.required,message:this.label+"未输入"},ruleRegExp:{pattern:/^\$\{.*\}$/,message:"请输入格式如${xxx}的表达式"}}},created(){const e=this.$optimus.formData[this.name];Object(a["isString"])(e)&&e.match(/^\$\{.*\}$/)?(this.typeMode="表达式",this.expressionValue=e):(this.typeMode="固定值",this.fixedValue=e)},methods:{updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue},handleSwitchChange(e){this.fixedValue=e},handleInputChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value}}},fs=bs,vs=(s("7d37"),Object(S["a"])(fs,ps,ms,!1,null,"6822a7c8",null)),ys=vs.exports,ws=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,message:e.label+"未选择",trigger:"change"}}},[s("ColorPicker",{attrs:{disabled:e.$optimus.disabled,recommend:""},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),e.$optimus.formData&&"default_audio"===e.$optimus.formData.id?s("RadioGroup",{model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},[s("Radio",{staticClass:"mlm",attrs:{disabled:e.$optimus.disabled,label:"random_audio"}},[e._v("随机色")])],1):e._e()],1)},xs=[],Cs={label:"颜色选择器",icon:"ios-arrow-down",name:"z-color-picker",attributes:[{label:"字段标识",name:"name",type:String,value(){return"color_picker_"+(new Date).getTime()}},{label:"字段名称",name:"label",type:String,value:"颜色选择器"},{name:"value",label:"默认值",type:String}]},js={metadata:Cs,mixins:[x["a"]]},Os=js,ks=Object(S["a"])(Os,ws,xs,!1,null,null,null),As=ks.exports,Ss=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{staticClass:"select-items",attrs:{prop:e.name,label:e.label,rules:e.isDisabled?[]:{required:e.required,message:e.label+"未选择"}}},[s("Button",{staticClass:"select-btn",attrs:{disabled:e.isDisabled||0===e.myOptions.length},on:{click:e.selectAll}},[e.isSelectAll?s("span",[e._v("取消全选")]):s("span",[e._v("全选")])]),s("CheckboxGroup",{staticClass:"image-options",model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}},e._l(e.myOptions,(function(t,i){return s("div",{staticClass:"image-checkbox"},[s("safeImage",{staticClass:"image-item",class:{isSelect:e.$optimus.formData[e.name]&&-1!==e.$optimus.formData[e.name].indexOf(t[e.fileName])},attrs:{src:t[e.fileUrl]}}),s("Checkbox",{key:i,ref:i,refInFor:!0,staticClass:"img-checkbox",attrs:{label:t[e.fileName],disabled:e.isDisabled}},[s("Tooltip",{staticClass:"img-tooltip",attrs:{"max-width":"200",content:t[e.fileName]}},[s("span",{staticClass:"name-box ellipsis"},[e._v(e._s(t[e.fileName]))])])],1)],1)})),0),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2)},_s=[],Is={label:"图片选择",icon:"ios-create-outline",name:"z-image-select",attributes:[{name:"name",label:"字段标识",type:String,value(){return"image_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"图片"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"fileUrl",label:"图片地址",type:String,value:"file_url"},{name:"fileName",label:"图片名称",type:String,value:"file_name"},{name:"options",label:"选项",component:"z-options-input",required:!0,type:String,value:""}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"图片选择",type:["array","null"]}},required:["name","label"]}},$s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"safe-image",on:{click:e.lanuchViewer}},[e.isCanvas?s("div",{ref:"safe-image-container",staticStyle:{width:"100%"}},[s("canvas",{ref:"safe-image-canvas"})]):s("img",{staticClass:"img",style:Object.assign({},{objectFit:"contain"},e.imgStyle),attrs:{src:e.src}})])},Ms=[],Ts=(s("abb3"),s("f638")),Es=s.n(Ts),Ls={props:{imageIndx:{type:Number,default:0},src:{type:String},width:{type:Number},height:{type:Number},showViewer:{type:Boolean,default:!0},fit:{type:String,default:"normal"},isCanvas:{type:Boolean,default:!0},imgStyle:{type:Object,default:()=>({})},parentRefs:{type:Object,default:()=>({})}},data(){return{image:null,canvas:null}},watch:{src(){this.init()}},mounted(){this.init()},beforeDestroy(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.canvas&&(this.canvas.removeEventListener("contextmenu",this.preventContextMenu),this.canvas.removeEventListener("touchStart",this.preventTouch)),this.image&&(this.image.onload=null,this.image.onerror=null,this.image=null)},methods:{preventContextMenu(e){e.preventDefault()},preventTouch(e){e.preventDefault()},init(){if(this.image=new Image,this.image.src=this.src,!this.isCanvas)return;const e=this.$refs["safe-image-container"],t=this.width?this.width:e.clientWidth;this.canvas=this.$refs["safe-image-canvas"],this.canvas.addEventListener("contextmenu",this.preventContextMenu),this.canvas.addEventListener("touchStart",this.preventTouch);const s=this;this.image.onerror=function(){console.log("图片加载出错")},this.image.onload=function(){if("contain"===s.fit){const e=new ResizeObserver(e=>{const[{contentRect:{width:t,height:i}}]=e,a=t/s.image.width,o=i/s.image.height,n=Math.min(a,o),r=s.image.width*n,l=s.image.height*n,c=s.canvas.getContext("2d");c.clearRect(0,0,s.canvas.width,s.canvas.height),s.canvas.width=r,s.canvas.height=l,c.drawImage(s.image,0,0,r,l)}),t=s.$refs["safe-image-container"];e.observe(t),s.resizeObserver=e}else{const e=s.height?s.height:s.image.height*(t/s.image.width);s.canvas.width=t,s.canvas.height=e,s.canvas.getContext("2d").drawImage(s.image,0,0,t,e)}}},lanuchViewer(e){var t;if(e.stopPropagation(),!this.showViewer)return;const s=(null===(t=this.parentRefs)||void 0===t?void 0:t.viewers)||this.image,i=new Es.a(s,{title:!1,navbar:!1,viewed(){i.image.addEventListener("contextmenu",e=>{e.preventDefault()})},play(){i.player.addEventListener("contextmenu",e=>{e.preventDefault()})},hidden(){i.destroy()}});i.view(this.imageIndx)}}},Ds=Ls,Ps=(s("d468"),Object(S["a"])(Ds,$s,Ms,!1,null,"92a52416",null)),Bs=Ps.exports,Rs={metadata:Is,components:{safeImage:Bs,Fitting:B["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{options:[Array,String],fileName:{type:String},fileUrl:{type:String}},computed:{myOptions(){let e=[];if(Object(a["isString"])(this.options)){if(""===this.options)return e;try{e=JSON.parse(this.options),e.some(e=>Object(a["isString"])(e))&&(e=e.map(e=>({[this.fileUrl]:e,[this.fileName]:e})))}catch(t){console.error("[image-select] options出错",{options:this.options})}}else try{e=this.options.map(e=>JSON.parse(e.value))}catch(t){console.error("[image-select] options出错",{options:this.options})}return e},isSelectAll(){if(0===this.myOptions.length)return!1;const e=this.$optimus.formData[this.name]?this.$optimus.formData[this.name].length:0;return e===this.myOptions.length}},methods:{selectAll(){const e=this.$optimus.formData[this.name]?this.$optimus.formData[this.name].length:0;this.$optimus.formData[this.name]=[],e!==this.myOptions.length&&(this.$optimus.formData[this.name]=[],this.myOptions.forEach(e=>{this.$optimus.formData[this.name].push(e[this.fileName])}))}}},zs=Rs,Ns=(s("65bd"),Object(S["a"])(zs,Ss,_s,!1,null,"010790ac",null)),Fs=Ns.exports,Vs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name,rules:e.required&&!e.isDisabled?{required:e.required,validator:e.required&&e.validateRequired,trigger:"blur",message:" "}:[],id:"custom-input"}},[e.enableExpression?s("expression-dropdown",{attrs:{typeMode:e.typeMode},on:{updateTypeMode:e.updateTypeMode}}):e._e(),"固定值"===e.typeMode?[s("div",{staticClass:"search-icon",class:e.enableExpression?"":"icon-absolute"},[s("span",{on:{click:e.addInput}},[s("Icon",{attrs:{type:"ios-add-circle"}}),e._v("新增")],1),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.showTagSearch&&e.tagSearch,expression:"!showTagSearch && tagSearch"}],on:{click:e.showSearchModal}},[s("Icon",{attrs:{type:"md-search"}}),e._v("检索")],1),s("span",{directives:[{name:"show",rawName:"v-show",value:e.showTagSearch,expression:"showTagSearch"}],on:{click:function(t){e.showTagSearch=!1}}},[s("Icon",{attrs:{type:"md-close-circle"}}),e._v("关闭检索")],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.showTagSearch,expression:"showTagSearch"}],staticClass:"tag-search-modal"},[s("Input",{ref:"searchInput",attrs:{search:"","enter-button":"搜索",placeholder:"请输入关键词"},on:{"on-search":e.handleSearchTag},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}}),s("Tabs",[s("TabPane",{attrs:{label:"外显标签列表"}},[s("Table",{attrs:{border:"",columns:e.tagColumns,data:e.extPage.showList,loading:e.loading},scopedSlots:e._u([{key:"action",fn:function(t){var i=t.row;t.index;return[s("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleSelect(i)}}},[e._v("选中")])]}}],null,!1,3858463968)}),s("Page",{attrs:{total:e.extPage.allPieces,simple:"","page-size":e.extPage.pagePieces},on:{"on-change":e.extCurrentPage}})],1),s("TabPane",{attrs:{label:"其他标签列表"}},[s("Table",{attrs:{border:"",columns:e.tagColumns,data:e.comPage.showList,loading:e.loading},scopedSlots:e._u([{key:"action",fn:function(t){var i=t.row;t.index;return[s("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleSelect(i)}}},[e._v("选中")])]}}],null,!1,3858463968)}),s("Page",{attrs:{total:e.comPage.allPieces,simple:"","page-size":e.comPage.pagePieces},on:{"on-change":e.comCurrentPage}})],1)],1)],1),s("ul",e._l(e.inputList,(function(t,i){return s("li",{key:i,staticClass:"input-list"},[s("div",{staticClass:"input"},[s("Row",{attrs:{gutter:10}},e._l(e.digitize(e.composeConfig),(function(a){return s("Col",{key:"col-"+a,attrs:{span:e.colSpan}},[s("Input",{ref:"textarea_"+i+"_"+a,refInFor:!0,attrs:{placeholder:"请输入",disabled:e.isDisabled,type:"textarea"},on:{input:function(t){return e.handleInput(i,a)}},model:{value:t.tag[a],callback:function(s){e.$set(t.tag,a,s)},expression:"item.tag[i]"}},[e.wordCount?s("span",{staticClass:"word-count",attrs:{slot:"suffix"},slot:"suffix"},[e._v(e._s(t.tag[a]&&t.tag[a].length))]):e._e()])],1)})),1)],1),s("div",{staticClass:"actions"},[s("t-button",{attrs:{size:"small",theme:"default",variant:"text"},on:{click:function(t){return e.delInput(i)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"delete"}})]},proxy:!0}],null,!0)})],1)])})),0)]:s("Input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入格式如${xxx}的表达式"},on:{"on-change":e.handleExpressionChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},qs=[],Hs={label:"动态输入框",icon:"ios-create-outline",name:"z-custom-input",attributes:[{name:"tagSearch",label:"新闻tag搜索",component:"z-switch",type:Boolean,value:!1,attributes:{description:"支持在内置的新闻标签库搜索"}},{name:"name",label:"字段标识",type:String,value(){return"custom-input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"动态输入框"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"wordCount",label:"字数统计",component:"z-switch",attributes:{enableExpression:!1},type:Boolean,value:!1},{name:"composeConfig",label:"组合输入框",component:"z-compose-config",type:Number,required:!0,value:1},{name:"autosizeConfig",label:"输入框自适应展示配置",component:"z-autosize-config",type:Object,required:!0},{name:"value",label:"默认值",component:"z-custom-input",type:String,required:!1,attributes:{enableExpression:!0,composeConfig:"${output.composeConfig}",autosizeConfig:"${output.autosizeConfig}"}},{name:"isValidUnit",label:"是否计入有效标注单元数",component:"z-switch",type:Boolean,value:!1}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"动态输入框",type:["array","null"]}},required:["name","label"]}},Ws=s("3216");const Us=e=>Object(Ws["a"])("api/helper","listStarlinkTags",e);var Qs=s("e419"),Js={metadata:Hs,components:{Fitting:B["a"],ExpressionDropdown:R["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{tagSearch:Boolean,SearchUrl:{type:String,default:""},wordCount:{type:Boolean,default:!1},composeConfig:{type:Number,default:1},isVisible:{type:Boolean,default:!0},autosizeConfig:{type:Object,default:()=>({minRows:void 0,maxRows:void 0,defaultRows:void 0})},enableExpression:{type:Boolean,default:!1}},data(){return{typeMode:"固定值",expressionValue:"${}",inputList:[],showTagSearch:!1,loading:!1,searchInput:"",comTagLists:[],extTagLists:[],extPage:{pagePieces:6,allPieces:0,showList:[]},comPage:{pagePieces:6,allPieces:0,showList:[]},tagColumns:[{title:"标签",key:"tag"},{title:"类型",key:"type"},{title:"操作",slot:"action",align:"center"}],resizeObserver:null,defaultHeight:null,observers:[]}},computed:{isCompose(){return this.composeConfig>1},colSpan(){let e=24;switch(this.composeConfig){case 1:e=24;break;case 2:e=12;break;default:e=8;break}return e}},watch:{inputList:{deep:!0,handler(e){const t=Object(a["filter"])(e,e=>Object(a["trim"])(e.tag));this.$optimus.formData[this.name]=t.map(e=>{var t;return{...e,tag:this.isCompose?null===e||void 0===e?void 0:e.tag:null===e||void 0===e||null===(t=e.tag)||void 0===t?void 0:t[0]}})}}},created(){if(this.$optimus.formData[this.name])if(Object(a["isString"])(this.$optimus.formData[this.name]))if(this.$optimus.formData[this.name].includes("¬")){const e={tag:this.$optimus.formData[this.name].split("¬"),type:"human"};this.inputList.push(e)}else try{const e=JSON.parse(this.$optimus.formData[this.name]);e.length?this.inputList=e.map(e=>({tag:this.isCompose?e:[e],type:"human"})):this.inputList=[{tag:new Array(this.composeConfig).fill(""),type:"human"}]}catch(e){console.log(e),this.inputList=[]}else this.inputList=Object(a["cloneDeep"])(this.$optimus.formData[this.name]),this.inputList=this.inputList.length>0?this.inputList.map(e=>({...e,tag:this.isCompose?null===e||void 0===e?void 0:e.tag:[null===e||void 0===e?void 0:e.tag]})):[{tag:new Array(this.composeConfig).fill(""),type:"human"}]},mounted(){this.setDefaultHeight(),this.inputList.forEach((e,t)=>{this.setRows(t)})},methods:{setDefaultHeight(){var e;const t=null===(e=this.$refs.textarea_0_0)||void 0===e?void 0:e[0].$el.children[0];this.defaultHeight=t&&this.autosizeConfig.defaultRows?parseFloat(Object(Qs["a"])(t,this.autosizeConfig.defaultRows,this.autosizeConfig.defaultRows).height):null},setRows(e){const t={};this.digitize(this.composeConfig).forEach(e=>{const s=Math.floor(e/3);t[s]||(t[s]=[]),t[s].push(e)}),Object.keys(t).forEach(s=>{const i=t[s];let a=0;const o={};i.forEach(t=>{const[s]=this.$refs[`textarea_${e}_${t}`],[i]=s.$el.children,n=Object(Qs["a"])(i,this.autosizeConfig.minRows,this.autosizeConfig.maxRows);o[t]=n,a=this.defaultHeight?this.defaultHeight:Math.max(a,parseFloat(n.height))}),i.forEach(t=>{const[s]=this.$refs[`textarea_${e}_${t}`],n=o[t];s.textareaStyles={...n,height:a+"px"};const[r]=s.$el.children,l=new ResizeObserver(()=>{const s=r.style.height;s&&i.forEach(i=>{if(i!==t){const[t]=this.$refs[`textarea_${e}_${i}`];t.textareaStyles.height=s}})});l.observe(r),this.observers.push(l)})})},handleExpressionChange(e){var t;this.expressionValue=null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value},handleInput(e,t){const[s]=this.$refs[`textarea_${e}_${t}`],[i]=s.$el.children,a=Object(Qs["a"])(i,this.autosizeConfig.minRows,this.autosizeConfig.maxRows);this.$nextTick(()=>{i.setAttribute("style",`height: ${a.height};max-height:${a.maxHeight};min-height:${a.minHeight};overflow-y:${a.overflowY}`)})},updateTypeMode(e){this.typeMode=e,"表达式"===e?this.$optimus.formData[this.name]=this.expressionValue:(this.inputList=[],this.$optimus.formData[this.name]="")},addInput(){this.isDisabled?this.$Notice.warning({title:"当前状态下无法操作哦！",duration:3}):(this.inputList.push({tag:new Array(this.composeConfig).fill(""),type:"human"}),this.$nextTick(()=>{1===this.inputList.length&&this.setDefaultHeight(),this.setRows(this.inputList.length-1)}))},delInput(e){this.isDisabled?this.$Notice.warning({title:"当前状态下无法操作哦！",duration:3}):this.inputList.length>1?this.inputList.splice(e,1):this.$Notice.warning({title:"最后一条输入框不能删除哦！",duration:3})},showSearchModal(){this.isDisabled?this.$Notice.warning({title:"当前状态下无法操作哦！",duration:3}):(this.showTagSearch=!0,this.$nextTick(()=>{this.$refs.searchInput.focus()}))},handleSearchTag(){this.searchInput?(this.loading=!0,this.comTagLists=[],this.extTagLists=[],this.getTagList(0,this.comTagLists,this.comPage),this.getTagList(1,this.extTagLists,this.extPage)):this.$Notice.warning({title:"搜索关键词不能为空哦",duration:3})},getTagList(e,t,s){s.showList=[],s.allPieces=0;const i={page:{start:0,size:200,return_total:1},input_text:this.searchInput,display:e};Us(i).then(e=>{this.loading=!1,Object(a["forEach"])(e.data,e=>{t.push({tag:e.retag_name,type:e.retag_type_name})}),s.allPieces=t.length,s.showList=t.slice(0,s.pagePieces)}).catch(e=>{this.loading=!1,this.$Message.error(e.message)})},comCurrentPage(e){const t=e*this.comPage.pagePieces-this.comPage.pagePieces,s=e*this.comPage.pagePieces;this.comPage.showList=this.comTagLists.slice(t,s)},extCurrentPage(e){const t=e*this.extPage.pagePieces-this.extPage.pagePieces,s=e*this.extPage.pagePieces;this.extPage.showList=this.extTagLists.slice(t,s)},handleSelect(e){Object(a["findIndex"])(this.inputList,{tag:[e.tag]})<0?this.inputList.unshift({tag:[e.tag],type:"search"}):this.$Notice.warning({title:"当前值已存在，请勿重复输入",duration:3})},digitize(e){const t=[];for(let s=0;s<e;s++)t.push(s);return t},validateRequired(e,t,s){Object(a["isArray"])(t)&&(t.find(e=>Object(a["isArray"])(e.tag)&&(""===e.tag||Object(a["isArray"])(e.tag)&&e.tag.includes("")))||0===t.length)&&s(new Error("")),s()}}},Gs=Js,Ks=(s("c262"),Object(S["a"])(Gs,Vs,qs,!1,null,"4b6df30a",null)),Ys=Ks.exports,Zs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name,rules:e.isDisabled?[]:{required:e.required,validator:e.validateRequired,trigger:"change",message:"请确认排序结果 "},id:"drag-sort-card"}},[e.confirmed||e.checked?[s("Row",{staticStyle:{"align-items":"center"},attrs:{justify:"space-between"}},[e.checked?s("div",[e._v("无法研判")]):s("div",{staticClass:"result"},e._l(e.list,(function(t,i){return s("div",{staticClass:"item"},[!e.duplicates||t.length?[s("div",{staticClass:"idx"},[e._v(e._s(i+1))]),s("div",{staticClass:"label"},[e._v(e._s(e.getLabel(t)))])]:e._e()],2)})),0),e.confirmed||e.checked?s("Button",{attrs:{size:"small",disabled:e.isDisabled},on:{click:function(t){e.confirmed=!1,e.checked=!1,e.$optimus.formData[e.name]=void 0}}},[e._v("修改")]):e._e()],1)]:[s("div",{staticClass:"rank"},e._l(e.myOptions,(function(t,i){return s("div",{staticClass:"rank-content"},[s("div",{staticClass:"rank-title",style:{backgroundColor:e.colors[i]}},[e._v("RANK "+e._s(i+1))])])})),0),e.checked?e._e():[e.duplicates?s("div",{staticClass:"rank"},e._l(e.list,(function(t,i){return s("draggable",{key:i,staticClass:"rank-content",attrs:{group:e.name,disabled:e.isDisabled,animation:100},on:{add:e.handleUpdate},model:{value:e.list[i],callback:function(t){e.$set(e.list,i,t)},expression:"list[idx]"}},e._l(e.list[i],(function(t,i){return s("div",{key:t.id+"-"+i,staticClass:"rank-list-item",style:{cursor:e.isDisabled?"not-allowed":"move"}},[e._v(e._s(t.label)),s("Icon",{staticClass:"handle",attrs:{type:"ios-move",size:"20"}})],1)})),0)})),1):s("draggable",{key:e.name,staticClass:"rank",attrs:{direction:"Horizontal",disabled:e.isDisabled,move:e.handleMove,animation:100,swap:!0},on:{end:e.handleDragEnd},model:{value:e.list,callback:function(t){e.list=t},expression:"list"}},e._l(e.list,(function(t){return s("div",{key:t.id,staticClass:"rank-list-item",style:{cursor:e.isDisabled?"not-allowed":"move"}},[e._v(e._s(t.label)),s("Icon",{staticClass:"handle",attrs:{type:"ios-move",size:"20"}})],1)})),0)],s("Button",{staticClass:"btn",staticStyle:{float:"right"},attrs:{size:"small",disabled:e.isDisabled},on:{click:function(t){e.confirmed=!0}}},[e._v("确认")]),s("Checkbox",{staticClass:"btn",attrs:{disabled:e.isDisabled},model:{value:e.checked,callback:function(t){e.checked=t},expression:"checked"}},[e._v("无法研判")])],s("template",{slot:"label"},[s("span",{staticStyle:{display:"inline-block"}},[s("span",[e._v(e._s(e.label))]),s("div",{staticClass:"tip"},[e._v("请拖拽卡片进行排序并确认结果")]),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1)]),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},Xs=[],ei={label:"拖拽排序卡片",icon:"ios-create-outline",name:"z-drag-sort_card",attributes:[{name:"name",label:"字段标识",type:String,value(){return"drag_sort_card_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"卡片排序"},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"duplicates",label:"允许相同排序",component:"z-switch",type:Boolean,value:!0},{name:"autoFill",label:"是否自动补位",type:Boolean,component:"z-switch",value:!0,attributes:{isVisible:"${output.duplicates}",enableExpression:!1}},{name:"dragType",label:"拖拽排序方式",type:String,component:"z-single-select",value:"insert",attributes:{isVisible:"${!output.duplicates}",options:[{label:"插入",value:"insert"},{label:"交换",value:"swap"}]}},{name:"options",label:"卡片数据",component:"z-options-input",type:String,required:!0,value:""},{name:"labelName",label:"展示字段",component:"z-input",type:String,required:!1,attributes:{enableExpression:!1}},{name:"valueName",label:"值字段",component:"z-input",type:String,required:!1,attributes:{enableExpression:!1}},{name:"defaultValue",label:"默认值",type:Array,value:"",required:!1}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"动态输入框",type:["array","null"]}},required:["name","label"]}},ti={metadata:ei,components:{draggable:ls.a,Fitting:B["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{duplicates:{type:Boolean,default:!1},options:{type:[Array,String],default:()=>[]},isVisible:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},autoFill:{type:Boolean,default:!0},dragType:{type:String,default:"insert"},labelName:{type:String,default:""},valueName:{type:String,default:""},defaultValue:Array},data(){return{checked:!1,confirmed:!1,list:[],isFormInit:!0}},computed:{colors(){const e=this.options.length;if(e<=0)return[];const t=[[355,73,60],[217,87,69],[24,84,56],[160,100,33],[51,97,61]],s=Array.from({length:e}).map((s,i)=>{let a,o,n;i<t.length?[a,o,n]=t[i]:(a=360*i/e,o=65,n=50);const r=this.checked||this.isDisabled?.5:1;return`hsl(${a}, ${o}%, ${n}%, ${r})`});return s},myOptions(){let e=[];if(Object(a["isArray"])(this.options))e=this.options;else if(this.options.includes("@_@"))e=Object(n["q"])(this.options);else try{e=JSON.parse(this.options)}catch(s){e=[]}const t=e.map((e,t)=>({idx:t,label:this.getLabelName(e,t),value:e[this.valueName||"value"]||e}));return t}},watch:{defaultValue:{deep:!0,handler(e,t){Object(a["isEqual"])(t,e)||this.isFormInit||this.init(e)}},confirmed(){this.confirmed?this.$optimus.formData[this.name]=this.list.map(e=>this.duplicates?e.map(e=>e.value):e.value):this.$optimus.formData[this.name]=[]},checked(){this.checked&&(this.$optimus.formData[this.name]=[])}},created(){this.init(),this.$nextTick(()=>{this.isFormInit=!1})},methods:{init(e){const t=null!==e&&void 0!==e?e:this.$optimus.formData[this.name];t?t.length?(this.list=t.map((e,t)=>{if(this.duplicates)return e.map(e=>{const s=this.myOptions.findIndex(t=>Object(a["isEqual"])(t.value,e)),i=-1===s?t:s;return this.myOptions[i]});const s=this.myOptions.findIndex(t=>Object(a["isEqual"])(t.value,e)),i=-1===s?t:s;return this.myOptions[i]}),this.confirmed=!e):(this.checked=!e,this.list=this.myOptions.map(e=>this.duplicates?[e]:e)):this.list=this.myOptions.map(e=>this.duplicates?[e]:e)},handleUpdate(){this.duplicates&&this.autoFill&&this.list.sort((e,t)=>0===e.length?1:0===t.length?-1:0)},handleDragEnd(){if("swap"===this.dragType){this.futureItem=this.list[this.futureIndex],this.movingItem=this.list[this.movingIndex];const e=Object.assign([],this.list);e[this.futureIndex]=this.movingItem,e[this.movingIndex]=this.futureItem,this.list=e}},handleMove(e){if("swap"===this.dragType){const{index:t,futureIndex:s}=e.draggedContext;return this.movingIndex=t,this.futureIndex=s,!1}},validateRequired(e,t,s){this.confirmed||this.checked?s():s(new Error("请确认排序结果"))},getLabelName(e,t){return this.labelName?this.labelName.includes("${__index}")?this.labelName.replace("${__index}",t+1):this.labelName.includes("${__alpha}")?this.labelName.replace("${__alpha}",Object(n["g"])(t)):e[this.labelName]:e.label||e},getLabel(e){return this.duplicates?e.map(e=>Object(a["isString"])(e.label)?e.label:JSON.stringify(e.label)).join("、"):e.label}}},si=ti,ii=(s("8cfc"),Object(S["a"])(si,Zs,Xs,!1,null,"4699966a",null)),ai=ii.exports,oi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.layoutClass,staticStyle:{"margin-bottom":"15px"}},[s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,message:e.label+"未填写",trigger:"blur,change"}}},[s("CustomLayoutInput",{ref:"ocrInput",attrs:{contenteditable:!e.$optimus.disabled,lang:e.lang,direction:e.direction,editFontSize:e.editFontSize,defaultFontSize:e.defaultFontSize,name:e.name,label:e.label},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})],1),s("div",{staticClass:"ocr-content"},[s("Button",{attrs:{type:"primary",loading:e.fetchOcrResult1.isPending||e.fetchOcrResult2.isPending||e.fetchOcrResult3.isPending,disabled:e.$optimus.disabled},on:{click:e.handleFetchOcrResult}},[e._v("智能识别")]),e.isEmpty(e.ocrFetchMap)?e._e():s("div",{staticClass:"result-container"},e._l(e.helpLists,(function(t){return s("div",{staticClass:"ocr-result"},[s("span",{staticStyle:{"flex-shrink":"0"}},[e._v(e._s(t.api_provider))]),e.ocrFetchMap[t.id].isPending?s("span",[e._v("识别中...")]):e._e(),e.ocrFetchMap[t.id].isRejected?s("span",{staticStyle:{color:"red"}},[e._v("识别出错,请重试")]):e._e(),e.ocrFetchMap[t.id].isResolved?[e.ocrResultMap[t.id]?s("CustomLayoutInput",{attrs:{contenteditable:!1,direction:e.direction,name:e.name,label:e.label},nativeOn:{click:function(s){return e.applyOcrResult(t.id)}},model:{value:e.ocrResultMap[t.id],callback:function(s){e.$set(e.ocrResultMap,t.id,s)},expression:"ocrResultMap[help.id]"}}):s("span",[e._v("识别失败,请重试")])]:e._e(),e.ocrFetchMap[t.id].isPending?e._e():s("Icon",{staticClass:"cursor-pointer",attrs:{type:"md-refresh",size:"17"},nativeOn:{click:function(s){return e.handleRefresh(t.id)}}})],2)})),0)],1)],1)},ni=[],ri={label:"ocr-输入框",icon:"ios-create-outline",name:"z-ocr-input",type:"ai",attributes:[{name:"name",label:"字段标识",type:String,value:"OCR-input"},{name:"label",label:"字段名称",type:String,value:"OCR-输入框"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"direction",label:"输入方向",component:"z-single-select",attributes:{options:[{label:"横向 (从左到右)",value:"横向(从左到右)"},{label:"横向 (从右到左)",value:"横向(从右到左)"},{label:"竖向 (从左到右)",value:"竖向(从左到右)"},{label:"竖向 (从右到左)",value:"竖向(从右到左)"}]},type:String,value:"横向(从左到右)"},{name:"lang",label:"字体",component:"z-single-select",type:String,value:"默认字体",attributes:{basicMode:!0,options:[{label:"默认字体",value:"默认字体"},{label:"蒙语(MongolQaganTig.ttf)",value:"蒙语(MongolQaganTig.ttf)"},{label:"哈语(ALKATIP Asliya.ttf)",value:"哈语(ALKATIP Asliya.ttf)"},{label:"维语(ALKATIP-Basma-Tom.ttf)",value:"维语(ALKATIP-Basma-Tom.ttf)"},{label:"藏语(microsoft-himalaya.ttf)",value:"藏语(microsoft-himalaya.ttf)"}],exhibit:"dropdown"}},{name:"defaultFontSize",label:"默认字体大小 (px)",component:"z-single-select",type:String,value:"14",attributes:{basicMode:!0,options:[{label:"8",value:"8"},{label:"10",value:"10"},{label:"12",value:"12"},{label:"14",value:"14"},{label:"16",value:"16"},{label:"18",value:"18"},{label:"24",value:"24"},{label:"30",value:"30"},{label:"32",value:"32"},{label:"36",value:"36"},{label:"48",value:"48"}]}}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"ocr-输入框",type:["string","null"]}},required:["name","label"]}};const li={component:"z-ocr-input",attributes:{label:"ocr转写",required:!0,name(){return"ocr_input_"+(new Date).getTime()},direction:"横向(从左到右)",lang:"默认字体",defaultFontSize:"14",editFontSize:!0}},ci={api_id:"${apiId}",image_url:"${imageStr}"},di={component:"z-asr-input",attributes:{label:"ASR转写",required:!0,name(){return"asr_input_"+(new Date).getTime()},direction:"横向(从左到右)",lang:"默认字体",defaultFontSize:"14",editFontSize:!0}},ui={api_id:"",lan:"",audio_url:"",start_time:0,end_time:0};var hi={helpComponents:{1234567890:li,1000000001:li,1000000002:li,1e9:di},requestMap:{1234567890:ci,1000000001:ci,1000000002:ci,1e9:ui}},pi={helpConfig:hi},mi={metadata:ri,components:{CustomLayoutInput:ge},mixins:[x["a"]],props:{aiHelp:{type:String,default:"ocr"},helps:{type:[Object,Array]},direction:{type:[String,Array],default:"横向(从左到右)"},lang:{type:[String,Array],default:"默认字体"},defaultFontSize:{type:[String,Array],default:"14"},editFontSize:{type:Boolean,default:!1}},data(){return{isEmpty:a["isEmpty"],layoutClass:{horizontal:!1,vertical:!1},curDirection:"",helpLists:Object(a["isArray"])(this.helps)?this.helps:[this.helps],paramsMap:{},ocrFetchMap:{}}},computed:{ocrResultMap(){return{1234567890:this.ocrResult1,1000000001:this.ocrResult2,1000000002:this.ocrResult3}}},created(){this.initStyle()},asyncMethods:{fetchOcrResult1(){return console.log("1234567890: ",this.paramsMap[1234567890]),this.fetchOcrService(this.paramsMap[1234567890])},fetchOcrResult2(){return console.log("1000000001: ",this.paramsMap[1000000001]),this.fetchOcrService(this.paramsMap[1000000001])},fetchOcrResult3(){return console.log("1000000002: ",this.paramsMap[1000000002]),this.fetchOcrService(this.paramsMap[1000000002])}},methods:{initStyle(){switch(this.curDirection=Object(a["isArray"])(this.direction)?this.direction[0]:this.direction,this.curDirection){case"横向(从左到右)":this.layoutClass.horizontal=!0;break;case"横向(从右到左)":this.layoutClass.horizontal=!0;break;case"竖向(从左到右)":this.layoutClass.vertical=!0;break;case"竖向(从右到左)":this.layoutClass.vertical=!0;break}},fetchOcrService(e){return Y["a"].getOcrTxet(e).then(e=>e.strTxt?e.strTxt.replace(/\n/g,""):"").catch(e=>{this.$Message.error(e.message)})},handleFetchOcrResult(){const{helpConfig:{requestMap:e}}=pi,t={};this.helpLists.forEach(s=>{const{id:i,request:a}=s;Object.keys(a).forEach(s=>{t[s]=e[i][s]});const o={api_id:i,request_params:Object(n["m"])(t,{...this.$optimus.objectContext})};switch(this.paramsMap[i]=o,i){case"1234567890":this.ocrFetchMap[i]=this.fetchOcrResult1,this.ocrFetchMap[i]();break;case"1000000001":this.ocrFetchMap[i]=this.fetchOcrResult2,this.ocrFetchMap[i]();break;case"1000000002":this.ocrFetchMap[i]=this.fetchOcrResult3,this.ocrFetchMap[i]();break}})},applyOcrResult(e=this.helpLists[0].id){this.ocrFetchMap[e].isResolved&&this.ocrResultMap[e]&&(this.$optimus.formData[this.name]=this.ocrResultMap[e])},handleRefresh(e){this.ocrFetchMap[e]()}}},gi=mi,bi=(s("5243"),Object(S["a"])(gi,oi,ni,!1,null,"07217ae3",null)),fi=bi.exports,vi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:e.layoutClass,staticStyle:{"margin-bottom":"15px"}},[s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,message:e.label+"未填写",trigger:"blur,change"}}},[s("CustomLayoutInput",{ref:"ocrInput",attrs:{contenteditable:!e.$optimus.disabled,lang:e.lang,direction:e.direction,editFontSize:e.editFontSize,defaultFontSize:e.defaultFontSize,name:e.name,label:e.label},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})],1),s("div",{staticClass:"asr-content"},[s("Button",{attrs:{type:"primary",loading:e.fetchAsrResult.isPending,disabled:e.$optimus.disabled},on:{click:e.handleFetchAsrResult}},[e._v("智能识别")]),s("Dropdown",{attrs:{placement:"bottom-start",trigger:"click",transfer:!0},on:{"on-click":e.getAsrLang}},[s("a",{staticClass:"hover-hand",staticStyle:{marginLeft:"10px",color:"#515a6e"}},[e._v(e._s(e.curAsrLang)),s("Icon",{attrs:{type:"ios-arrow-down",size:"15"}})],1),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.asrLangLists,(function(t,i){return s("DropdownItem",{key:t,attrs:{name:t,selected:t===e.curAsrLang}},[e._v(e._s(t))])})),1)],1),s("Tooltip",{attrs:{placement:["横向(从左到右)","横向(从右到左)"].includes(e.curDirection)?"top-start":"left-start","max-width":"400"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}}),s("div",{attrs:{slot:"content"},slot:"content"},[s("p",[e._v("切换语种识别更准确；特殊字符说明如下：")]),s("p",[e._v("[UNK] 机器也听不懂的")]),s("p",[e._v("[LAUGH] 笑声")]),s("p",[e._v("[NOISE] 咂嘴，咳嗽，打喷嚏，各类非嗓子发出的噪声")]),s("p",[e._v("[MUSIC] 音乐")])])],1),e.isEmpty(e.asrFetchMap)?e._e():s("div",{staticClass:"result-container"},e._l(e.helpLists,(function(t){return s("div",{staticClass:"asr-result"},[s("span",{staticStyle:{"flex-shrink":"0"}},[e._v(e._s(t.api_provider))]),e.asrFetchMap[t.id].isPending?s("span",[e._v("识别中...")]):e._e(),e.asrFetchMap[t.id].isRejected?s("span",{staticStyle:{color:"red"}},[e._v("识别出错,请重试")]):e._e(),e.asrFetchMap[t.id].isResolved?[e.asrResultMap[t.id]?s("CustomLayoutInput",{attrs:{contenteditable:!1,direction:e.direction,name:e.name,label:e.label},nativeOn:{click:function(s){return e.applyAsrResult(t.id)}},model:{value:e.asrResultMap[t.id],callback:function(s){e.$set(e.asrResultMap,t.id,s)},expression:"asrResultMap[help.id]"}}):s("span",[e._v("识别失败,请重试")])]:e._e(),e.asrFetchMap[t.id].isPending?e._e():s("Icon",{staticClass:"cursor-pointer",attrs:{type:"md-refresh",size:"17"},nativeOn:{click:function(s){return e.handleRefresh(t.id)}}})],2)})),0)],1)],1)},yi=[],wi={label:"asr-输入框",icon:"ios-create-outline",name:"z-asr-input",type:"ai",attributes:[{name:"name",label:"字段标识",type:String,value:"ASR-input"},{name:"label",label:"字段名称",type:String,value:"ASR-输入框"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"direction",label:"输入方向",component:"z-single-select",attributes:{options:[{label:"横向 (从左到右)",value:"横向(从左到右)"},{label:"横向 (从右到左)",value:"横向(从右到左)"},{label:"竖向 (从左到右)",value:"竖向(从左到右)"},{label:"竖向 (从右到左)",value:"竖向(从右到左)"}]},type:String,value:"横向(从左到右)"},{name:"lang",label:"字体",component:"z-single-select",type:String,value:"默认字体",attributes:{basicMode:!0,options:[{label:"默认字体",value:"默认字体"},{label:"蒙语(MongolQaganTig.ttf)",value:"蒙语(MongolQaganTig.ttf)"},{label:"哈语(ALKATIP Asliya.ttf)",value:"哈语(ALKATIP Asliya.ttf)"},{label:"维语(ALKATIP-Basma-Tom.ttf)",value:"维语(ALKATIP-Basma-Tom.ttf)"},{label:"藏语(microsoft-himalaya.ttf)",value:"藏语(microsoft-himalaya.ttf)"}],exhibit:"dropdown"}},{name:"defaultFontSize",label:"默认字体大小 (px)",component:"z-single-select",type:String,value:"14",attributes:{basicMode:!0,options:[{label:"8",value:"8"},{label:"10",value:"10"},{label:"12",value:"12"},{label:"14",value:"14"},{label:"16",value:"16"},{label:"18",value:"18"},{label:"24",value:"24"},{label:"30",value:"30"},{label:"32",value:"32"},{label:"36",value:"36"},{label:"48",value:"48"}]}}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"asr-输入框",type:["string","null"]}},required:["name","label"]}},xi={metadata:wi,components:{CustomLayoutInput:ge},mixins:[x["a"]],props:{aiHelp:{type:String,default:"asr"},helps:{type:[Object,Array]},direction:{type:[String,Array],default:"横向(从左到右)"},lang:{type:[String,Array],default:"默认字体"},defaultFontSize:{type:[String,Array],default:"14"},editFontSize:{type:Boolean,default:!1}},data(){const{objectContext:e}=this.$optimus;return{isEmpty:a["isEmpty"],layoutClass:{horizontal:!1,vertical:!1},curDirection:"",asrLangLists:["汉语","粤语","英语","维语","藏语","蒙语","哈语","哼唱"],curAsrLang:e&&e.lan?e.lan:"汉语",helpLists:Object(a["isArray"])(this.helps)?this.helps:[this.helps],paramsMap:{},asrFetchMap:{}}},computed:{asrResultMap(){return{1e9:this.asrResult}}},created(){this.init()},asyncMethods:{fetchAsrResult(){return Y["a"].getOcrTxet(this.paramsMap[1e9]).then(e=>e.text?e.text.replace(/\n/g,""):"").catch(e=>{this.$Message.error(e.message)})}},methods:{init(){switch(this.curDirection=Object(a["isArray"])(this.direction)?this.direction[0]:this.direction,this.curDirection){case"横向(从左到右)":this.layoutClass.horizontal=!0;break;case"横向(从右到左)":this.layoutClass.horizontal=!0;break;case"竖向(从左到右)":this.layoutClass.vertical=!0;break;case"竖向(从右到左)":this.layoutClass.vertical=!0;break}},getAsrLang(e){this.curAsrLang=e,this.$optimus.objectContext.lan=e},handleFetchAsrResult(){const{helpConfig:{requestMap:e}}=pi,t={};this.helpLists.forEach(s=>{const{id:i,request:a}=s;Object.keys(a).forEach(s=>{t[s]=e[i][s]}),this.$optimus.objectContext.lan=this.curAsrLang;const o={api_id:i,request_params:this.$optimus.objectContext};switch(this.paramsMap[i]=o,i){case"1000000000":this.asrFetchMap[i]=this.fetchAsrResult,this.asrFetchMap[i]();break}})},applyAsrResult(e=this.helpLists[0].id){this.asrFetchMap[e].isResolved&&this.asrResultMap[e]&&(this.$optimus.formData[this.name]=this.asrResultMap[e])},handleRefresh(e){this.asrFetchMap[e]()}}},Ci=xi,ji=(s("475e"),Object(S["a"])(Ci,vi,yi,!1,null,"1ee74966",null)),Oi=ji.exports,ki=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,message:e.label+"未输入"}}},[s("i-switch",{attrs:{disabled:e.$optimus.disabled},on:{"on-change":e.handleSwitchChange},model:{value:e.isOpen,callback:function(t){e.isOpen=t},expression:"isOpen"}},[s("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),s("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])]),e.isOpen?s("div",{staticClass:"num"},[e._v("设置每组含"),s("InputNumber",{attrs:{min:2,max:6},on:{change:e.handleChange},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),e._v("个输入框")],1):e._e()],1)},Ai=[],Si={label:"组合输入框",icon:"ios-create-outline",name:"z-compose-config",attributes:[{name:"name",label:"字段标识",type:String,value(){return"compose_config_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"}]},_i={metadata:Si,components:{},mixins:[x["a"]],data(){return{isOpen:!1}},created(){this.isOpen=this.$optimus.formData[this.name]>1},methods:{handleSwitchChange(e){this.$optimus.formData[this.name]=e?2:1,this.isOpen=e,this.handleChange()},handleChange(){this.$optimus.formData.value=""}}},Ii=_i,$i=(s("3f64"),Object(S["a"])(Ii,ki,Ai,!1,null,"6296c2eb",null)),Mi=$i.exports,Ti=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,validator:e.validateRequired}}},[s("div",{staticClass:"row"},[s("div",[e._v("最小高度")]),s("t-switch",{model:{value:e.formData.minRowsEnabled,callback:function(t){e.$set(e.formData,"minRowsEnabled",t)},expression:"formData.minRowsEnabled"}}),e.formData.minRowsEnabled?s("t-input-number",{attrs:{size:"small",theme:"normal",suffix:"行","auto-width":!0,decimalPlaces:0,min:1,status:e.status.minRows,max:e.formData.maxRowsEnabled?e.formData.maxRows:void 0},on:{input:function(t){return e.clearStatus("minRows")},blur:function(t){return e.clearStatus("minRows")}},model:{value:e.formData.minRows,callback:function(t){e.$set(e.formData,"minRows",t)},expression:"formData.minRows"}}):e._e()],1),s("div",{staticClass:"row"},[s("div",[e._v("最大高度")]),s("t-switch",{model:{value:e.formData.maxRowsEnabled,callback:function(t){e.$set(e.formData,"maxRowsEnabled",t)},expression:"formData.maxRowsEnabled"}}),e.formData.maxRowsEnabled?s("t-input-number",{attrs:{size:"small",theme:"normal",suffix:"行","auto-width":!0,decimalPlaces:0,status:e.status.maxRows,min:e.formData.minRowsEnabled?e.formData.minRows:1},on:{input:function(t){return e.clearStatus("maxRows")},blur:function(t){return e.clearStatus("maxRows")}},model:{value:e.formData.maxRows,callback:function(t){e.$set(e.formData,"maxRows",t)},expression:"formData.maxRows"}}):e._e()],1),s("div",{staticClass:"row"},[s("div",[e._v("默认高度")]),s("t-switch",{model:{value:e.formData.defaultRowsEnabled,callback:function(t){e.$set(e.formData,"defaultRowsEnabled",t)},expression:"formData.defaultRowsEnabled"}}),e.formData.defaultRowsEnabled?s("t-input-number",{attrs:{size:"small",theme:"normal",suffix:"行","auto-width":!0,decimalPlaces:0,min:e.formData.minRowsEnabled?e.formData.minRows:1,max:e.formData.maxRowsEnabled?e.formData.maxRows:void 0,status:e.status.defaultRows},on:{input:function(t){return e.clearStatus("defaultRows")},blur:function(t){return e.clearStatus("defaultRows")}},model:{value:e.formData.defaultRows,callback:function(t){e.$set(e.formData,"defaultRows",t)},expression:"formData.defaultRows"}}):e._e()],1)])},Ei=[],Li={label:"输入框自适应配置",icon:"ios-create-outline",name:"z-autosize-config",attributes:[{name:"name",label:"字段标识",type:String,value(){return"compose_config_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"}]},Di={metadata:Li,components:{},mixins:[x["a"]],data(){return{isOpen:!1,formData:{},status:{minRows:void 0,maxRows:void 0,defaultRows:void 0}}},watch:{formData:{handler(){this.$optimus.formData[this.name]={minRows:this.formData.minRowsEnabled?this.formData.minRows:void 0,maxRows:this.formData.maxRowsEnabled?this.formData.maxRows:void 0,defaultRows:this.formData.defaultRowsEnabled?this.formData.defaultRows:void 0}},deep:!0}},created(){this.$optimus.formData[this.name]||(this.$optimus.formData[this.name]={minRows:void 0,maxRows:void 0,defaultRows:void 0}),this.formData={minRowsEnabled:void 0!==this.$optimus.formData[this.name].minRows,minRows:this.$optimus.formData[this.name].minRows,maxRowsEnabled:void 0!==this.$optimus.formData[this.name].maxRows,maxRows:this.$optimus.formData[this.name].maxRows,defaultRowsEnabled:void 0!==this.$optimus.formData[this.name].defaultRows,defaultRows:this.$optimus.formData[this.name].defaultRows}},methods:{handleSwitchChange(e){this.$optimus.formData[this.name]=e?2:1,this.isOpen=e,this.handleChange()},handleChange(){this.$optimus.formData.value=""},clearStatus(e){this.status[e]=void 0},validateRequired(e,t,s){const i=[{key:"minRows",enabled:this.formData.minRowsEnabled,message:"最小高度未输入",rangeMessage:"最小高度需为1～最大高度间的整数",min:1,max:this.formData.maxRowsEnabled?this.formData.maxRows:void 0},{key:"maxRows",enabled:this.formData.maxRowsEnabled,message:"最大高度未输入",rangeMessage:"最大高度需为>最小高度的整数",min:this.formData.minRowsEnabled?this.formData.minRows:1,max:void 0},{key:"defaultRows",enabled:this.formData.defaultRowsEnabled,message:"默认高度未输入",rangeMessage:"默认高度需为最小高度~最大高度间的整数",min:this.formData.minRowsEnabled?this.formData.minRows:1,max:this.formData.maxRowsEnabled?this.formData.maxRows:void 0}];i.forEach(({key:e,enabled:i,message:a,rangeMessage:o,min:n,max:r})=>{i&&(t[e]?this.numValidator(t[e],n,r)||(s(new Error(o)),this.status[e]="error"):(s(new Error(a)),this.status[e]="error"))}),s()},numValidator(e,t,s){return!!((void 0===t||e>=t)&&(void 0===s||e<=s)&&Number.isInteger(e))}}},Pi=Di,Bi=(s("5b96"),Object(S["a"])(Pi,Ti,Ei,!1,null,"0fcbdc9c",null)),Ri=Bi.exports,zi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("Row",{staticClass:"group-container",attrs:{id:"group-container_"+e.name}},[e.isTitleVisible?s("Col",{staticClass:"title-col",attrs:{span:"2"}},[e._v(e._s(e.label))]):e._e(),s("Col",{style:{height:"custom"===e.heightType?e.height+"px":"",overflow:"auto"},attrs:{span:e.isTitleVisible?"22":"24"}},[e.isTiming&&this.$optimus.disabled?s("div",{staticClass:"timing-string"},[e._v("标注时长："+e._s(e.times[e.name]||0)+" s")]):e._e(),s("div",{staticClass:"labelObjects-container",class:e.isLocked?"locked-container":""},e._l(e.myLabelObjects,(function(t,i){return s("div",{key:i,staticClass:"object-group-item",class:{isSelect:e.selectIndex===i,isNeedToLabel:e.isNeedToLabel(i),isLabeled:e.labeledLists.includes(i),locked:e.isLocked},attrs:{id:"group-container_"+e.name+"_"+i},on:{click:function(t){return e.addObject(i)}}},[e.isLocked?s("div",{staticClass:"locked-icon"},[s("Icon",{staticStyle:{"font-size":"32px"},attrs:{type:"ios-lock"}}),s("div",[e._v(e._s(e.locked.lockedBy)+"标注 "+e._s(e.locked.lockedTime)+"s 后方可解锁")])],1):e._e(),s("div",{staticClass:"mark-icon-container"},[s("div",{staticClass:"mark-icon",class:{markIsNeedLabel:e.isNeedToLabel(i),markIsLabeled:e.labeledLists.includes(i)}},[e._v(e._s(e.isNeedToLabel(i)?"待标注":e.labeledLists.includes(i)?"已标注":""))])]),s("div",{staticClass:"obj-group"},e._l(t,(function(t){return s("div",{key:t.id,staticClass:"object-item",staticStyle:{flex:"1"}},[s("Tooltip",{staticClass:"object-tooltip",attrs:{"max-width":"100",content:t[e.objectName],placement:"bottom",transfer:!0}},[s("span",{staticClass:"name-box ellipsis"},[e._v(e._s(t[e.objectName]))])]),"image"===t.objectType?s("img",{key:t[e.objectUrl],staticClass:"object-content",style:e.objectItemStyle,attrs:{src:t[e.objectUrl],oncontextmenu:"return false;"},on:{click:function(s){return e.lanuchViewer(t.id)}}}):e._e(),"audio"===t.objectType?s("audio",{staticClass:"object-content",style:e.objectItemStyle,attrs:{src:t[e.objectUrl],controls:"true",controlslist:"nodownload"}}):e._e(),"video"===t.objectType?s("video",{staticClass:"object-content",style:e.objectItemStyle,attrs:{src:t[e.objectUrl],controls:"true",controlslist:"nodownload","webkit-playsinline":"true",playsinline:"true","x-webkit-airplay":"allow","x5-playsinline":""},on:{click:e.handlePlay}}):e._e(),"web"===t.objectType?[s("a",{attrs:{href:t[e.objectUrl],target:"_blank"}},[s("Icon",{attrs:{type:"ios-link-outline"}}),s("span",{staticClass:"mls"},[e._v("新窗口打开")])],1),e.isWebShow?s("iframe",{staticClass:"iframe-item",style:e.objectItemStyle,attrs:{src:t[e.objectUrl]}}):e._e()]:e._e(),"model"===t.objectType?s("Preview",{staticClass:"object-content",style:e.objectItemStyle,attrs:{previewUrl:t[e.objectUrl],previewType:"model"}}):e._e(),e.isCount&&"string"===t.objectType?s("div",{staticClass:"count-string"},[s("WordCount",{attrs:{content:t[e.objectUrl]}})],1):e._e(),"string"===t.objectType?s("div",{staticClass:"string-item",style:e.objectItemStyle},[e._v(e._s(t[e.objectUrl]))]):e._e(),t[e.objectDesc]?s("div",{staticClass:"object-desc"},[s("Tooltip",{staticClass:"object-tooltip",attrs:{"max-width":"300",content:t[e.objectDesc],placement:"bottom",transfer:!0}},[s("span",{staticClass:"description-box ellipsis",style:{maxWidth:e.objectWidth?e.objectWidth+"px":"150px"}},[e._v(e._s(t[e.objectDesc]))])])],1):e._e()],2)})),0),t[0]&&t[0][e.objectIndexDesc]?s("div",{staticClass:"object-desc"},[s("Tooltip",{staticClass:"object-tooltip",attrs:{"max-width":"300",content:t[0][e.objectIndexDesc],placement:"bottom",transfer:!0}},[s("span",{staticClass:"description-box ellipsis",style:{maxWidth:e.objectWidth?e.objectWidth+"px":"150px"}},[e._v(e._s(t[0][e.objectIndexDesc]))])])],1):e._e(),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:i,expression:"index"}],ref:"form_"+i,refInFor:!0,staticClass:"mark-content",attrs:{group:e.name+"_"+i,component:e.componentConfig,context:e.$optimus.context,answer:e.markAnswer[e.getObjectIndex(i)],disabled:e.$optimus.disabled,isNeedValidate:e.required||!e.required&&e.labeledLists.includes(i)}}),e.labeledLists.includes(i)&&!e.$optimus.disabled?s("div",{staticClass:"delete-btn",on:{click:function(t){return e.handleDeleteObject(t,i)}}},[e._v("清空（Q）")]):e._e()],1)})),0)])],1):e._e()},Ni=[],Fi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{on:{click:e.handlePreview}},[e._t("default",(function(){return["model"===e.previewType?s("modelPreview",{staticClass:"preview-simple",staticStyle:{width:"200px",height:"100px"},attrs:{url:e.tUrl,isBasic:!0,modelConfig:'{"backgroundColor": "#efecec"}'},on:{fullscreenPreview:e.handleFullscreenPreview}}):"image"===e.previewType?s("safeImage",{staticClass:"preview-simple",style:Object.assign({},{width:"100px",height:"100px"},e.imagStyle),attrs:{src:e.tUrl,fit:"contain"}}):s("div",[e._v(e._s(e.filename))])]}))],2),s("div",{ref:"mask"},[e.visible?s("div",{staticClass:"mask"},[s("Row",{staticClass:"title-bar",attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("Col",[e._v(e._s(e.filename))]),s("Col",[s("Icon",{staticStyle:{cursor:"pointer"},attrs:{type:"md-close",color:"white",size:"20"},on:{click:e.closeModal}})],1)],1),s("div",{staticClass:"warpper"},[e.loading?s("Spin"):"model"===e.previewType?s("modelPreview",{attrs:{url:e.tUrl,downloadEnabled:e.downloadEnabled,enabledFullscreen:!1,modelConfig:'{"backgroundColor": "#efecec"}'}}):s(e.currentComponent,{tag:"component",attrs:{url:e.tUrl}})],1)],1):e._e()])])},Vi=[],qi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("img",{staticClass:"img",attrs:{src:e.url}})},Hi=[],Wi={name:"imagePreview",components:{safeImage:Bs},props:{url:{type:String,required:!0}},methods:{}},Ui=Wi,Qi=(s("f8bd"),Object(S["a"])(Ui,qi,Hi,!1,null,"08e48a94",null)),Ji=Qi.exports,Gi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("audio",{staticClass:"audio",attrs:{controls:"",controlsList:"nodownload",oncontextmenu:"return false"}},[s("source",{attrs:{src:e.url,type:"audio/ogg"}}),s("source",{attrs:{src:e.url,type:"audio/mpeg"}}),s("source",{attrs:{src:e.url,type:"audio/wav"}}),s("span",[e._v("您的浏览器不支持 audio 元素。")])])},Ki=[],Yi={name:"audioPreview",props:{url:{type:String,required:!0}}},Zi=Yi,Xi=(s("e7cb"),Object(S["a"])(Zi,Gi,Ki,!1,null,"0931bd49",null)),ea=Xi.exports,ta=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("video",{staticClass:"video",attrs:{controls:"",controlsList:"nodownload nofullscreen",oncontextmenu:"return false",disablePictureInPicture:"",src:e.url}},[s("source",{attrs:{src:e.url,type:"video/mp4"}}),s("source",{attrs:{src:e.url,type:"video/ogg"}}),s("source",{attrs:{src:e.url,type:"video/webm"}}),s("span",[e._v("您的浏览器不支持 HTML5 video 标签。")])])},sa=[],ia={name:"videoPreview",props:{url:{type:String,required:!0}}},aa=ia,oa=(s("cb01"),Object(S["a"])(aa,ta,sa,!1,null,"0d90a3fb",null)),na=oa.exports,ra=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container",style:{height:e.cHeight+"px"}},[!e.url||e.isError?s("div",{staticClass:"error"},[s("ImageErrorIcon",{attrs:{size:"24px"}}),this.type?s("div",[["glb","gltf","obj","fbx","stl","dae","ply","json","zip","blend","usdz"].includes(this.type)?s("div",[s("span",[e._v(e._s(this.type)+"格式渲染出错，")]),s("t-link",{attrs:{theme:"primary",hover:"color"},on:{click:e.download}},[e._v("点我下载")])],1):s("div",[s("t-space",{attrs:{size:0}},[s("div",[e._v("暂不支持"+e._s(this.type)+"格式，")]),s("t-link",{attrs:{theme:"primary",hover:"color"},on:{click:e.download}},[e._v("点我下载"),s("DownloadIcon")],1)],1)],1)]):s("div",[s("span",[e._v("未获取到文件格式，")]),s("t-link",{attrs:{theme:"primary",hover:"color"},on:{click:e.download}},[e._v("点我下载")])],1)],1):this.type?e.cFileSize>e.FILE_MAX_SIZE?s("t-alert",{staticStyle:{height:"fit-content"},attrs:{theme:"info"}},[e._v("浏览器远程读取 "+e._s(e.cFileSize)+"M 的文件会超出内存上限导致崩溃，要继续渲染么？"),s("t-space",[s("t-link",{attrs:{hover:"color",theme:"primary"},on:{click:e.tryRender}},[e._v("尝试渲染")]),s("t-link",{attrs:{hover:"color",theme:"primary"},on:{click:e.download}},[e._v("下载文件")])],1)],1):s("div",[s(e.currentComponent,e._b({ref:"modelViewer",tag:"component",attrs:{src:e.url,"output-encoding":3001,controlsOptions:{enableZoom:e.formData.enableZoom},rotation:e.rotation,zip:e.zip,isNgonWireframe:e.isNgonWireframe,fileSize:e.fileSize,fileType:e.type},on:{load:e.handleLoad,error:e.handleError}},"component",e.formData,!1)),s("Row",{staticClass:"operation",attrs:{justify:"end"}},[s("ButtonGroup",{attrs:{shape:"circle",size:"small"}},[e.isBasic?e._e():[e.downloadEnabled?s("Button",{attrs:{icon:"md-download"},on:{click:e.download}}):e._e(),e.formData.enableZoom?e._e():s("Button",{attrs:{icon:"ios-add"},on:{click:function(t){return e.zoom("+")}}}),s("Button",{attrs:{icon:"ios-settings-outline"},on:{click:e.showConfigModal}}),e.formData.enableZoom?e._e():s("Button",{attrs:{icon:"ios-remove"},on:{click:function(t){return e.zoom("-")}}})],e.enabledFullscreen?s("Button",{attrs:{icon:"ios-expand"},on:{click:e.handleFullscreenPreview}}):e._e()],2)],1)],1):s("t-loading"),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isError&&!e.isBasic&&e.showConfig,expression:"!isError && !isBasic && showConfig"}],staticClass:"config-container",style:{"pointer-events":e.showConfigContent?"all":"none"}},[s("div",{staticClass:"minimize",on:{click:function(t){e.showConfigContent=!e.showConfigContent}}},[s("span",[e._v("模型配置")]),s("t-icon",{attrs:{name:"chevron-down-s",size:"28px"}})],1),s("t-form",{directives:[{name:"show",rawName:"v-show",value:e.showConfigContent,expression:"showConfigContent"}],ref:"formData",staticClass:"content",style:{height:e.cHeight-40+"px"},attrs:{data:e.formData,"label-align":"left",labelWidth:"170px"}},[s("t-form-item",{attrs:{name:"rotation",label:"旋转(rotation)"}},[s("t-switch",{model:{value:e.formData.rotation,callback:function(t){e.$set(e.formData,"rotation",t)},expression:"formData.rotation"}})],1),s("t-form-item",{attrs:{name:"backgroundColor",label:"背景颜色(backgroundColor)",labelAlign:"top"}},[s("t-color-picker",{attrs:{colorModes:["monochrome"],"show-primary-color-preview":!1},model:{value:e.formData.backgroundColor,callback:function(t){e.$set(e.formData,"backgroundColor",t)},expression:"formData.backgroundColor"}})],1),s("t-form-item",{attrs:{name:"autoLights",label:"自动灯光(autoLights)"}},[s("t-switch",{model:{value:e.formData.autoLights,callback:function(t){e.$set(e.formData,"autoLights",t)},expression:"formData.autoLights"}})],1),e.formData.autoLights?e._e():s("t-form-item",{attrs:{name:"lightsInput",label:"灯光(lights)",labelAlign:"top"}},[s("t-textarea",{model:{value:e.formData.lightsInput,callback:function(t){e.$set(e.formData,"lightsInput",t)},expression:"formData.lightsInput"}})],1),s("t-form-item",{attrs:{name:"enableZoom",label:"滚动缩放(enableZoom)"}},[s("t-switch",{model:{value:e.formData.enableZoom,callback:function(t){e.$set(e.formData,"enableZoom",t)},expression:"formData.enableZoom"}})],1),s("t-form-item",{attrs:{name:"renderMode",labelAlign:"top"}},[s("t-radio-group",{staticStyle:{display:"flex","flex-direction":"column","align-items":"flex-start",color:"white"},model:{value:e.formData.renderMode,callback:function(t){e.$set(e.formData,"renderMode",t)},expression:"formData.renderMode"}},[s("div",[e._v("渲染")]),s("t-radio",{attrs:{value:"finalRender"}},[e._v("Final Render")]),"finalRender"===e.formData.renderMode?s("t-form-item",{attrs:{name:"emissive",label:"亮度增强"}},[s("t-switch",{model:{value:e.formData.emissive,callback:function(t){e.$set(e.formData,"emissive",t)},expression:"formData.emissive"}})],1):e._e(),s("div",[e._v("几何")]),s("t-radio",{attrs:{value:"wireframe"}},[e._v("Wireframe")]),e.enableNgonType.includes(e.type)?[e.ngonLoading?s("t-loading",{attrs:{loading:e.ngonLoading,size:"small"}}):[e.fileContent?s("t-radio",{attrs:{value:"NgonWireframe"}},[e._v("Ngon Wireframe")]):e._e()]]:e._e(),s("t-radio",{attrs:{value:"matcap"}},[e._v("Matcap")]),s("t-radio",{attrs:{value:"matcap+surface"}},[e._v("Matcap+Surface")]),s("div",[e._v("纹理")]),s("t-radio",{attrs:{value:"basecolor"}},[e._v("BaseColor")]),s("t-radio",{attrs:{value:"metalness"}},[e._v("Metalness")]),s("t-radio",{attrs:{value:"roughness"}},[e._v("Roughness")]),s("t-radio",{attrs:{value:"normalMap"}},[e._v("Normal Map")]),s("t-radio",{attrs:{value:"emission"}},[e._v("Emission")]),s("div",[e._v("UV")]),s("t-radio",{attrs:{value:"uv"}},[e._v("UV Checker")]),s("t-radio",{attrs:{value:"uvMap"}},[e._v("UV Map")]),"uvMap"===e.formData.renderMode?s("t-select",{on:{change:e.handleUvMapSelect},model:{value:e.currentSelectMesh,callback:function(t){e.currentSelectMesh=t},expression:"currentSelectMesh"}},e._l(e.modelMeshes,(function(e){return s("t-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1):e._e(),s("div",[e._v("动作")]),s("t-radio",{attrs:{value:"bones"}},[e._v("Bones")]),s("t-radio",{attrs:{value:"bonesInfluence"}},[e._v("Bones Influence")]),s("t-radio",{attrs:{value:"skeletalHeatMapper"}},[e._v("Skeletal HeatMapper")]),"skeletalHeatMapper"===e.formData.renderMode&&e.allBones.length>0?s("div",[s("t-select",{on:{change:e.handleBoneSelect},model:{value:e.currentSelectBoneIndex,callback:function(t){e.currentSelectBoneIndex=t},expression:"currentSelectBoneIndex"}},e._l(e.sortedAllBones,(function(e){return s("t-option",{key:e.userData.index,attrs:{label:e.name,value:e.userData.index}})})),1)],1):e._e()],2)],1)],1)],1),s("div",{ref:"uvMap",staticStyle:{position:"relative",display:"block",margin:"12px"}})],1)},la=[],ca=s("5312"),da=s("4f2b"),ua=(s("0d5c"),s("aaf0")),ha=s("37cb");s("dc28"),s("e890"),s("f465"),s("81ee");const pa=new ca["n"];function ma(e){return pa.setFromObject(e),pa.getSize(new ca["ze"])}function ga(e){return pa.setFromObject(e),pa.getCenter(new ca["ze"])}function ba(e){const t=e.getAttribute("position").array;let s;const i=void 0!==e.getAttribute("uv");let a;i&&(s=e.getAttribute("uv").array);const o=void 0!==e.getAttribute("normal");o&&(a=e.getAttribute("normal").array);const n=[],r=[],l=[],c=[];let d,u,h,p;const m=new ca["ze"],g=new ca["ze"],b=new ca["ze"],f=new ca["ze"],v=new ca["ze"],y=new ca["ze"],w=new ca["ye"],x=new ca["ye"],C=new ca["ye"];for(let I=0;I<t.length;I+=9)m.x=t[I],m.y=t[I+1],m.z=t[I+2],g.x=t[I+3],g.y=t[I+4],g.z=t[I+5],b.x=t[I+6],b.y=t[I+7],b.z=t[I+8],d=[m,g,b],o&&(f.x=a[I],f.y=a[I+1],f.z=a[I+2],v.x=a[I+3],v.y=a[I+4],v.z=a[I+5],y.x=a[I+6],y.y=a[I+7],y.z=a[I+8],u=[f,v,y]),i&&(w.x=s[I],w.y=s[I+1],x.x=s[I+2],x.y=s[I+3],C.x=s[I+4],C.y=s[I+5],h=[w,x,C]),p=[],d.forEach((e,t)=>{let s=_(e,r);-1===s&&(s=r.length,r.push(e.clone()),o&&l.push(u[t].clone()),i&&c.push(h[t].clone())),p.push(s)}),n.push(p[0],p[1],p[2]);const j=new Float32Array(3*r.length);let O,k;o&&(O=new Float32Array(3*r.length)),i&&(k=new Float32Array(2*r.length));let A=0,S=0;for(let I=0;I<r.length;I++)S=3*I,j[S]=r[I].x,j[S+1]=r[I].y,j[S+2]=r[I].z,o&&(O[S]=l[I].x,O[S+1]=l[I].y,O[S+2]=l[I].z),i&&(A=2*I,k[A]=c[I].x,k[A+1]=c[I].y);return e.addAttribute("position",new ca["p"](j,3)),o&&e.addAttribute("normal",new ca["p"](O,3)),i&&e.addAttribute("uv",new ca["p"](k,2)),e.setIndex(new ca["p"](new Uint32Array(n),1)),e;function _(e,t){for(let s=0;s<t.length;s++)if(e.equals(t[s]))return s;return-1}}function fa(e){const t=e=>{e()&&setTimeout(()=>{t(e)},10)};t(e)}function va(e){if(!e||!e.image)return!1;const t=document.createElement("canvas"),s=t.getContext("2d");t.width=e.image.width,t.height=e.image.height,s.drawImage(e.image,0,0);const i=s.getImageData(0,0,t.width,t.height),{data:a}=i;for(let o=3;o<a.length;o+=4)if(a[o]<255)return!0;return!1}function ya(e){if(!e)return;const t=e.map&&va(e.map)||e.alphaMap&&va(e.alphaMap)||e.transparentMap&&va(e.transparentMap);t&&(e.transparent=!0,e.alphaTest=.5,e.side=ca["U"],e.needsUpdate=!0)}function wa(e){e.isMesh&&e.material&&(Array.isArray(e.material)?e.material.forEach(e=>ya(e)):ya(e.material)),e.children&&e.children.forEach(e=>wa(e))}var xa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",style:{position:"relative",width:"100%",height:"100%",margin:0,border:0,padding:0}},[!1===e.progress.isComplete?e._t("progress-bar",(function(){return[s("div",{staticStyle:{position:"absolute","z-index":"2",height:"3px",width:"100%","background-color":"rgba(0, 0, 0, 0.04)"}},[s("div",{style:{width:e.loadProgressPercentage+"%",height:"100%",backgroundColor:"#1890ff",transition:"width .2s"}})])]}),{progress:e.progress}):e._e(),!1===e.progress.isComplete?s("div",{staticStyle:{position:"absolute","z-index":"1",width:"100%",height:"100%"}},[e._t("poster")],2):e._e(),s("canvas",{ref:"canvas",staticStyle:{width:"100%",height:"100%",display:"block"}})],2)},Ca=[],ja=s("8bc7"),Oa=s("e2a2");const ka={antialias:!0,alpha:!0};var Aa,Sa,_a,Ia,$a,Ma,Ta,Ea,La,Da,Pa,Ba,Ra,za,Na={props:{src:{type:String},width:{type:Number},height:{type:Number},position:{type:Object,default:()=>({x:0,y:0,z:0})},rotation:{type:Object,default:()=>({x:0,y:0,z:0,order:"XYZ"})},scale:{type:Object,default:()=>({x:1,y:1,z:1})},lights:{type:Array,default:()=>[]},cameraPosition:{type:Object,default:()=>({x:0,y:0,z:0})},cameraRotation:{type:Object,default:()=>({x:0,y:0,z:0})},cameraUp:{type:Object},cameraLookAt:{type:Object},backgroundColor:{default:16777215},backgroundAlpha:{type:Number,default:1},controlsOptions:{type:Object},crossOrigin:{type:String,default:"anonymous"},requestHeader:{type:Object,default:()=>{}},outputEncoding:{type:Number,default:ja["LinearEncoding"]},glOptions:{type:Object},zip:Object,isNgonWireframe:{type:Boolean,default:!1},fileSize:{type:Number,default:0},fileType:{type:String,default:""}},data(){const e=new ca["Qb"];return e.onLoad=()=>{this.isAllLoadersDone=!0},{size:{width:this.width,height:this.height},progress:{isComplete:!1,lengthComputable:!1,loaded:0,total:0},object:null,raycaster:new ca["Hd"],mouse:new ca["ye"],camera:new ca["Lc"](45,1,.1,1e5),scene:new ca["Rd"],wrapper:new ca["yc"],userTransform:new ca["yc"],renderer:null,controls:null,allLights:[],clock:"undefined"===typeof performance?Date:performance,reqId:null,loader:null,loadingManager:e,isAllLoadersDone:!1,blobUrls:[]}},computed:{loadProgressPercentage(){return this.progress.total?this.progress.isComplete?100:this.progress.lengthComputable?100*Math.min(.92,this.progress.loaded/(3*this.progress.total)):100*Math.min(1,this.progress.loaded/this.progress.total):0}},watch:{src(){this.load()},rotation:{deep:!0,handler(e){this.object&&this.userTransform.rotation.set(e.x,e.y,e.z,"XYZ")}},position:{deep:!0,handler(e){this.object&&this.userTransform.position.set(e.x,e.y,e.z)}},scale:{deep:!0,handler(e){this.object&&this.userTransform.scale.set(e.x,e.y,e.z,"XYZ")}},lights:{deep:!0,handler(){this.updateLights()}},size:{deep:!0,handler(){this.updateCamera(),this.updateRenderer()}},controlsOptions:{deep:!0,handler(){this.updateControls()}},backgroundAlpha(){this.updateRenderer()},backgroundColor(){this.updateRenderer()}},mounted(){var e;void 0!==this.width&&void 0!==this.height||(this.size={width:this.$refs.container.offsetWidth,height:this.$refs.container.offsetHeight});const t=Object.assign({},ka,this.glOptions,{canvas:this.$refs.canvas});this.renderer=new ja["b"](t),this.renderer.shadowMap.enabled=!0,this.renderer.outputEncoding=this.outputEncoding,this.controls=new Oa["a"](this.camera,this.$refs.container),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.screenSpacePanning=!1,this.controls.minDistance=.01,this.controls.maxDistance=5e4,this.controls.maxPolarAngle=Math.PI,this.controls.enableZoom=!1!==(null===(e=this.controlsOptions)||void 0===e?void 0:e.enableZoom),this.controls.zoomSpeed=1.2,this.controls.panSpeed=1,this.controls.rotateSpeed=1,this.scene.add(this.userTransform),this.userTransform.add(this.wrapper),this.load(),this.update();const s=this.$refs.container;s.addEventListener("mousedown",this.onMouseDown,!1),s.addEventListener("mousemove",this.onMouseMove,!1),s.addEventListener("mouseup",this.onMouseUp,!1),s.addEventListener("click",this.onClick,!1),s.addEventListener("dblclick",this.onDblclick,!1),window.addEventListener("resize",this.onResize,!1),this.onResize(),this.animate()},beforeDestroy(){cancelAnimationFrame(this.reqId),this.renderer.dispose(),this.clearScene(),this.controls&&this.controls.dispose();const e=this.$refs.container;e.removeEventListener("mousedown",this.onMouseDown,!1),e.removeEventListener("mousemove",this.onMouseMove,!1),e.removeEventListener("mouseup",this.onMouseUp,!1),e.removeEventListener("click",this.onClick,!1),e.removeEventListener("dblclick",this.onDblclick,!1),window.removeEventListener("resize",this.onResize,!1),this.blobUrls.forEach(e=>URL.revokeObjectURL(e)),this.blobUrls=[]},methods:{onResize(){void 0!==this.width&&void 0!==this.height||this.$nextTick(()=>{const{width:e,height:t}=this.$refs.container.getBoundingClientRect();this.size={width:e,height:t}})},onMouseDown(e){if(!this.$attrs.onMousedown)return;const t=this.pick(e.clientX,e.clientY);this.$emit("mousedown",e,t)},onMouseMove(e){if(!this.$attrs.onMousemove)return;const t=this.pick(e.clientX,e.clientY);this.$emit("mousemove",e,t)},onMouseUp(e){if(!this.$attrs.onMouseup)return;const t=this.pick(e.clientX,e.clientY);this.$emit("mouseup",e,t)},onClick(e){if(!this.$attrs.onClick)return;const t=this.pick(e.clientX,e.clientY);this.$emit("click",e,t)},onDblclick(e){if(!this.$attrs.onDblclick)return;const t=this.pick(e.clientX,e.clientY);this.$emit("dblclick",e,t)},pick(e,t){if(!this.object)return null;if(!this.$refs.container)return;const s=this.$refs.container.getBoundingClientRect();e-=s.left,t-=s.top,this.mouse.x=e/this.size.width*2-1,this.mouse.y=-t/this.size.height*2+1,this.raycaster.setFromCamera(this.mouse,this.camera);const i=this.raycaster.intersectObject(this.object,!0);return(i&&i.length)>0?i[0]:null},update(){this.updateRenderer(),this.updateCamera(),this.updateLights(),this.updateControls()},updateModel(){const{wrapper:e}=this;if(!e)return;const{position:t}=this,{rotation:s}=this,{scale:i}=this;e.position.set(t.x,t.y,t.z),e.rotation.set(s.x,s.y,s.z),e.scale.set(i.x,i.y,i.z)},updateRenderer(){const{renderer:e}=this;e.setSize(this.size.width,this.size.height),e.setPixelRatio(window.devicePixelRatio||1),e.setClearColor(new ca["v"](this.backgroundColor).getHex()),e.setClearAlpha(this.backgroundAlpha)},updateCamera(){const{camera:e}=this,{object:t}=this;if(this.isNgonWireframe)return e.aspect=this.size.width/this.size.height,void e.updateProjectionMatrix();if(e.aspect=this.size.width/this.size.height,e.updateProjectionMatrix(),this.cameraLookAt&&this.cameraUp)e.position.set(this.cameraPosition.x,this.cameraPosition.y,this.cameraPosition.z),e.rotation.set(this.cameraRotation.x,this.cameraRotation.y,this.cameraRotation.z),e.up.set(this.cameraUp.x,this.cameraUp.y,this.cameraUp.z),e.lookAt(new ca["ze"](this.cameraLookAt.x,this.cameraLookAt.y,this.cameraLookAt.z));else{if(!t)return;const s=ma(t).length();if(e.position.set(this.cameraPosition.x,this.cameraPosition.y,this.cameraPosition.z),e.rotation.set(this.cameraRotation.x,this.cameraRotation.y,this.cameraRotation.z),0===this.cameraPosition.x&&0===this.cameraPosition.y&&0===this.cameraPosition.z){const t=Math.max(1.5*s,5),i=Math.max(3*s,30);e.position.z=Math.max(t,Math.min(i,1.2*s))}e.lookAt(new ca["ze"])}},updateLights(){this.scene.remove(...this.allLights),this.allLights=[],this.lights.forEach(e=>{if(!e.type)return;const t=e.type.toLowerCase();let s=null;if("ambient"===t||"ambientlight"===t){const t=0===e.color?e.color:e.color||4210752,i=0===e.intensity?e.intensity:e.intensity||1;s=new ca["i"](t,i)}else if("point"===t||"pointlight"===t){const t=0===e.color?e.color:e.color||16777215,i=0===e.intensity?e.intensity:e.intensity||1,a=e.distance||0,o=0===e.decay?e.decay:e.decay||1;s=new ca["Oc"](t,i,a,o),e.position&&s.position.copy(e.position)}else if("directional"===t||"directionallight"===t){const t=0===e.color?e.color:e.color||16777215,i=0===e.intensity?e.intensity:e.intensity||1;s=new ca["T"](t,i),e.position&&s.position.copy(e.position),e.target&&s.target.copy(e.target)}else if("hemisphere"===t||"hemispherelight"===t){const t=0===e.skyColor?e.skyColor:e.skyColor||16777215,i=0===e.groundColor?e.groundColor:e.groundColor||16777215,a=0===e.intensity?e.intensity:e.intensity||1;s=new ca["pb"](t,i,a),e.position&&s.position.copy(e.position)}s&&(this.allLights.push(s),this.scene.add(s))})},updateControls(){this.controlsOptions&&(void 0!==this.controlsOptions.enableZoom&&(this.controls.enableZoom=this.controlsOptions.enableZoom),Object.assign(this.controls,this.controlsOptions),this.controls.update())},reportProgress(e,t){if("start"===e)this.progress.isComplete=!1,this.progress.startedAt=Date.now(),this.progress.loaded=0,this.progress.total=0;else if("end"===e)this.progress.isComplete=!0,this.progress.endedAt=Date.now();else{var s,i;this.progress.lengthComputable=null!==(s=null===t||void 0===t?void 0:t.lengthComputable)&&void 0!==s&&s,this.progress.loaded=null!==(i=null===t||void 0===t?void 0:t.loaded)&&void 0!==i?i:0,this.progress.total=(null===t||void 0===t?void 0:t.total)||this.fileSize}},load(){if(!this.src)return;if(this.object&&this.wrapper.remove(this.object),!this.createLoader)return;this.reportProgress("start");const e=this.createLoader(this.loadingManager);null!==e?(e.setRequestHeader(this.requestHeader),e.load(this.src,e=>{this.onLoad(e)},e=>{this.onProgress(e)},e=>{this.onError(e)})):this.onError()},onLoad(e){fa(()=>{if(this.isAllLoadersDone){const t=this.getObject(e);return this.process(t),this.addObject(t),this.reportProgress("end"),this.$emit("load"),!1}return!0})},onProgress(e){this.reportProgress("progress",e),this.$emit("progress",e)},onError(e){this.reportProgress("end"),this.$emit("error",e)},process(e){return e},getObject(e){return e},addObject(e){if(this.object=e,this.wrapper.add(e),!e.isNGonMesh){const t=ga(e),s=ma(e);console.log("Model loaded:",{center:t.toArray(),size:s.toArray(),maxDimension:Math.max(s.x,s.y,s.z),minDimension:Math.min(s.x,s.y,s.z)});const i=Math.max(s.x,s.y,s.z),a=Math.min(s.x,s.y,s.z);let o=!1,n=1;if(i>1e3?(o=!0,n=1e3/i):a<1&&(o=!0,n=a<.1?5/a:a<.5?2.5/a:1.5/a),o){const t=Math.max(1,Math.min(100,n));e.scale.setScalar(t),console.log("Model scaled:",{originalMaxDimension:i,originalMinDimension:a,scaleFactor:t,newSize:ma(e).toArray()});const s=ga(e);this.wrapper.position.copy(s.negate())}else this.wrapper.position.copy(t.negate());this.wrapper.rotation.set(0,0,0),this.wrapper.scale.set(1,1,1)}this.userTransform.position.copy(this.position),this.userTransform.rotation.set(this.rotation.x,this.rotation.y,this.rotation.z,this.rotation.order||"XYZ"),this.userTransform.scale.copy(this.scale),this.updateCamera()},animate(){this.reqId=requestAnimationFrame(this.animate),this.render()},render(){this.renderer.render(this.scene,this.camera)},clearScene(){this.scene.traverse(e=>{var t;e.isMesh&&(null===(t=e.geometry)||void 0===t||t.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()));e instanceof ca["ie"]&&e.dispose()}),this.scene.children=[]}}},Fa=Na,Va=Object(S["a"])(Fa,xa,Ca,!1,null,null,null),qa=Va.exports,Ha={name:"modelObj",mixins:[qa],props:{lights:{type:Array,default(){return[{type:"HemisphereLight",position:{x:0,y:1,z:0},intensity:1},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:1}]}},smoothing:{type:Boolean,default:!1}},data(){return{}},watch:{mtl(){this.load()}},methods:{process(e){this.smoothing&&e.traverse(e=>{e.geometry&&(e.geometry=ba(e.geometry),e.geometry.computeVertexNormals())})},createLoader(){const e=new ua["a"](this.loadingManager);return e.setRequestHeader(this.requestHeader),e},createMtlLoader(){const e=new ha["a"](this.loadingManager);return e.setCrossOrigin(this.crossOrigin),e.setRequestHeader(this.requestHeader),e},mapTypeToProp(e){const t={map_kd:"map",map_bump:"bumpMap",map_ns:"specularMap",map_ka:"lightMap",map_pr:"roughnessMap",map_pm:"metalnessMap"};return t[e]||e},async load(){if(this.src)if(this.object&&this.wrapper.remove(this.object),this.reportProgress("start"),this.zip)try{const{files:e}=this.zip,t={obj:null,mtl:new Map},s=new Map;let i;if(await Promise.all(Object.keys(e).map(async i=>{const a=e[i];if(a.dir)return;const o=i.split(".").pop().toLowerCase(),n=await a.async("blob"),r=URL.createObjectURL(n),l=i.toLowerCase();if("obj"===o)t.obj={url:r,filename:i};else if("mtl"===o)t.mtl.set(l,{url:r,filename:i});else if(["jpg","jpeg","png","bmp","tga"].includes(o)){const e=i.split("/").pop().toLowerCase();s.set(e,r)}})),t.obj){const e=await fetch(t.obj.url),a=await e.text(),o=[...a.matchAll(/^mtllib\s+(.+)$/gm)].flatMap(e=>e[1].split(/\s+/)).map(e=>e.toLowerCase()),n=Array.from(t.mtl.entries()).filter(([e,t])=>{const s=t.filename.split("/").pop().toLowerCase();return o.includes(e)||o.some(e=>e.split("/").pop().toLowerCase()===s)}).map(([,e])=>e.url);if(1===n.length){const[e]=n,t=this.createMtlLoader(),a=await(await fetch(e)).text(),o=a.replace(/(map_\w+)\s+(.*)/g,(e,t,s)=>{const i=s.split(/[/\\]/).pop().toLowerCase();return`${t} ${i}`});i=t.parse(o),i.preload();const r=new ca["je"];Object.entries(i.materialsInfo).forEach(([e,t])=>{["map_kd","map_bump","map_ns","map_pr","map_pm"].forEach(a=>{if(t[a]){const o=t[a].toLowerCase();if(s.has(o)){const t=r.load(s.get(o));t.colorSpace=ca["Pd"],i.materials[e][this.mapTypeToProp(a)]=t}}})})}}if(t.obj){const e=this.createLoader(this.loadingManager);i&&e.setMaterials(i),e.load(t.obj.url,this.onLoad,this.onProgress,this.onError)}this.blobUrls=[...t.obj?[t.obj.url]:[],...Array.from(t.mtl.values()).map(e=>e.url)]}catch(e){throw this.$emit("error"),new Error("ZIP加载失败: "+e.message)}else this.createLoader(this.loadingManager).load(this.src,this.onLoad,this.onProgress,this.onError)},getObject(e){return wa(e),e}}},Wa=Ha,Ua=Object(S["a"])(Wa,Aa,Sa,!1,null,null,null),Qa=Ua.exports,Ja=s("da5a"),Ga={name:"ModelFbx",mixins:[qa],props:{lights:{type:Array,default(){return[{type:"HemisphereLight",position:{x:0,y:1,z:0},skyColor:16777215,groundColor:16777215,intensity:.8},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:.8}]}}},data(){return{}},methods:{createLoader(e){return new Ja["a"](e)},getObject(e){return this.animations=e.animations,wa(e),e},async processZip(){const{files:e}=this.zip,t={};let s;return await Promise.all(Object.keys(e).map(async i=>{const a=e[i];if(a.dir)return;const o=i.split(".").pop().toLowerCase(),n=await a.async("blob"),r=URL.createObjectURL(n);if("fbx"===o)s=r;else if(["jpg","jpeg","png","bmp","tga"].includes(o)){const e=i.toLowerCase().split("/").pop();t[e]=r}})),{fbxUrl:s,textureMap:t}},patchTextureLoader(e){const t=ca["je"].prototype.load;ca["je"].prototype.load=function(s,i,a,o){let n=s;const r=s.replace(/\\/g,"/").toLowerCase().replace(/^\//,"");if(e[r]){n=e[r];const t=n.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i);t&&([n]=t)}return t.call(this,n,i,a,o)}},async load(){if(!this.src)return;this.object&&this.wrapper.remove(this.object),this.reportProgress("start");const e=this.createLoader(this.loadingManager);if(null!==e)if(e.setRequestHeader(this.requestHeader),this.zip){const{fbxUrl:t,textureMap:s}=await this.processZip();this.patchTextureLoader(s),e.load(t,this.onLoad,this.onProgress,this.onError),this.blobUrls=[...t?[t]:[],...Object.values(s)]}else e.load(this.src,this.onLoad,this.onProgress,this.onError);else this.$emit("error")}}},Ka=Ga,Ya=Object(S["a"])(Ka,_a,Ia,!1,null,null,null),Za=Ya.exports,Xa={name:"model-three",mixins:[qa],data(){return{}},methods:{createLoader(e){const t=new ca["zc"](e);t.setCrossOrigin(this.crossOrigin),t.setRequestHeader(this.requestHeader)}}},eo=Xa,to=Object(S["a"])(eo,$a,Ma,!1,null,null,null),so=to.exports,io=s("14f6"),ao={name:"model-stl",mixins:[qa],props:{lights:{type:Array,default(){return[{type:"HemisphereLight",position:{x:0,y:1,z:0},intensity:1},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:.8}]}}},data(){return{}},methods:{createLoader(e){return new io["a"](e)},getObject(e){return new ca["Xb"](e,new ca["dc"])}}},oo=ao,no=Object(S["a"])(oo,Ta,Ea,!1,null,null,null),ro=no.exports,lo=s("f874"),co={name:"model-ply",mixins:[qa],props:{lights:{type:Array,default:()=>[{type:"HemisphereLight",position:{x:0,y:1,z:0},intensity:1},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:.8}]}},data(){return{}},methods:{createLoader(e){return new lo["a"](e)},getObject(e){return e.computeVertexNormals(),new ca["Xb"](e,new ca["fc"]({vertexColors:!0}))}}},uo=co,ho=Object(S["a"])(uo,La,Da,!1,null,null,null),po=ho.exports,mo=s("e237"),go={name:"ModelCollada",mixins:[qa],props:{lights:{type:Array,default:()=>[{type:"HemisphereLight",position:{x:0,y:1,z:0},intensity:1},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:.8}]},smoothing:{type:Boolean,default:!1}},data(){return{}},methods:{createLoader(e){const t=new mo["a"](e);return t.setCrossOrigin(this.crossOrigin),t},getObject(e){return e.scene}}},bo=go,fo=Object(S["a"])(bo,Pa,Ba,!1,null,null,null),vo=fo.exports,yo=s("2f5b"),wo={name:"modelGltf",mixins:[qa],props:{lights:{type:Array,default:()=>[{type:"AmbientLight",color:16777215,intensity:2},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:2}]},gammaOutput:{type:Boolean,default:!0}},data(){return{}},methods:{createLoader(e){const t=new yo["a"](e);return t.setCrossOrigin(this.crossOrigin),t.setRequestHeader(this.requestHeader),t},load(){this.src&&(this.object&&this.wrapper.remove(this.object),this.reportProgress("start"),this.createLoader(this.loadingManager).load(this.src,e=>{this.reportProgress("end"),wa(e.scene),this.addObject(e.scene),this.$emit("load")},e=>{this.reportProgress("progress",e),this.$emit("progress",e)},e=>{this.reportProgress("end"),this.$emit("error",e)}))}}},xo=wo,Co=Object(S["a"])(xo,Ra,za,!1,null,null,null),jo=Co.exports;const Oo=(e,t="json")=>Object(Ws["c"])({timeout:3e5,url:"api/v3/blender/multi_3d",method:"post",data:e,responseType:t}).then(({data:e})=>e);var ko={multi3d:Oo},Ao=s("bb01"),So=s.n(Ao);const _o=(e,t)=>Object(a["isArray"])(e)?e.map(e=>t?t(e.clone()):e.clone()):t?t(e.clone()):e.clone(),Io=(e,t)=>{const s=[new ca["Yb"]({color:15066854,transparent:!1,depthTest:!0,depthWrite:!0,side:ca["U"],polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),new ca["Yb"]({color:0,wireframe:!0,wireframeLinewidth:2,depthTest:!0,depthWrite:!0,transparent:!1,side:ca["U"],polygonOffset:!0,polygonOffsetFactor:-2,polygonOffsetUnits:-1})];t.geometry.attributes.normal||t.geometry.computeVertexNormals(),t.geometry.normalizeNormals();const i={start:0,count:t.geometry.index?t.geometry.index.count:t.geometry.attributes.position.count};t.geometry.groups=[],t.geometry.addGroup(i.start,i.count,0),t.geometry.addGroup(i.start,i.count,1),t.geometry.groupsNeedUpdate=!0,t.geometry.attributes.position.needsUpdate=!0,t.geometry.index&&(t.geometry.index.needsUpdate=!0),t.material=s,s[1].renderOrder=1,t.material.needsUpdate=!0},$o=(e,t,s,i)=>{s?(t.geometry&&(t.geometry.attributes.normal||t.geometry.computeVertexNormals(),t.geometry.normalizeNormals()),t.material=_o(t.material,e=>{const t=new ca["cc"]({matcap:s,flatShading:!1,side:ca["U"],polygonOffset:!0,polygonOffsetFactor:1});return i&&(t.normalMap=e.normalMap,t.normalScale=new ca["ye"](.5,.5),t.bumpMap=e.bumpMap,t.bumpScale=.05),t.needsUpdate=!0,t}),e.scene.environment=s):console.warn("Matcap纹理尚未加载完成")},Mo=(e,t)=>{t.material=_o(t.material,e=>new ca["Yb"]({map:e.map,color:e.color,transparent:e.transparent,alphaTest:e.alphaTest,side:ca["U"],depthWrite:!0,depthTest:!0}))},To=(e,t)=>{t.material=_o(t.material,e=>{const t=new ca["Yb"]({map:e.metalnessMap,transparent:!1,fog:!1,depthWrite:!0,depthTest:!0});if(!t.map){const s=document.createElement("canvas");s.style="display:block;",s.width=512,s.height=512;const i=s.getContext("2d");if("number"===typeof e.metalness){const t=Math.floor(255*e.metalness);i.fillStyle=`rgb(0,0,${t})`}else i.fillStyle="#000000";i.fillRect(0,0,512,512),t.map=new ca["s"](s),t.map.needsUpdate=!0}return t.onBeforeCompile=t=>{t.vertexShader=t.vertexShader.replace("void main() {","\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n      "),t.fragmentShader=t.fragmentShader.replace("void main() {",`\n        varying vec2 vUv;\n        void main() {\n          // 优先使用贴图数据，其次使用数值参数\n          float metalnessFactor = 0.0;\n          #ifdef USE_MAP\n            vec4 texColor = texture2D(map, vUv);\n            metalnessFactor = texColor.b;\n          #else\n            metalnessFactor = ${void 0!==e.metalness?e.metalness.toFixed(3):"0.0"};\n          #endif\n\n          // 直接输出金属度值作为颜色（白色=金属，黑色=非金属）\n          gl_FragColor = vec4(vec3(metalnessFactor), 1.0);\n\n          // 跳过所有后续光照计算\n          return;\n        `)},t})},Eo=(e,t)=>{t.material=_o(t.material,e=>{const t=new ca["Yb"]({map:e.roughnessMap,transparent:!1,fog:!1,depthWrite:!0,depthTest:!0});if(!t.map){const s=document.createElement("canvas");s.width=512,s.height=512;const i=s.getContext("2d");if("number"===typeof e.roughness){const t=Math.floor(255*e.roughness);i.fillStyle=`rgb(${t},${t},${t})`}else i.fillStyle="#808080";i.fillRect(0,0,512,512),t.map=new ca["s"](s),t.map.needsUpdate=!0}return t.onBeforeCompile=t=>{t.vertexShader=t.vertexShader.replace("void main() {","\n        varying vec2 vUv;\n        void main() {\n          vUv = uv;\n      "),t.fragmentShader=t.fragmentShader.replace("void main() {",`\n        varying vec2 vUv;\n        void main() {\n          // 优先使用贴图数据，其次使用数值参数\n          float roughnessFactor = 0.5;\n          #ifdef USE_MAP\n            vec4 texColor = texture2D(map, vUv);\n            roughnessFactor = texColor.g;\n          #else\n            roughnessFactor = ${void 0!==e.roughness?e.roughness.toFixed(3):"0.5"};\n          #endif\n\n          // 直接输出处理后的粗糙度值作为颜色\n          gl_FragColor = vec4(vec3(roughnessFactor), 1.0);\n\n          // 跳过所有后续光照计算\n          return;\n        `)},t})},Lo=(e,t)=>{t.geometry&&!t.geometry.attributes.normal&&t.geometry.computeVertexNormals(),t.material=_o(t.material,e=>{const t=new ca["Yb"]({map:e.normalMap,onBeforeCompile:e=>{e.vertexShader=e.vertexShader.replace("void main() {","\n          varying vec2 myvUv;\n          varying vec3 vNormal;\n\n          void main() {\n            myvUv = uv;\n            // 计算世界空间法线和切线\n            vec3 worldNormal = normalize(mat3(modelMatrix) * normal);\n\n            // 传递世界空间位置\n            vNormal = worldNormal;\n          "),e.fragmentShader="\n          varying vec2 myvUv;\n          varying vec3 vNormal;\n\n          void main() {\n            // 直接使用几何法线（已经是世界空间）\n            vec3 worldNormal = normalize(vNormal);\n            // 统一转换到[0,1]范围用于可视化\n            vec3 visualNormal = worldNormal * 0.5 + 0.5;\n            gl_FragColor = vec4(visualNormal, 1.0);\n          }\n        "},side:ca["U"],depthTest:!0,depthWrite:!0});return t})},Do=(e,t)=>{t.material.emissiveMap||console.log("没有自发光贴图"),t.material=_o(t.material,e=>{const t=new ca["Yb"]({map:e.emissiveMap,color:e.emissive||new ca["v"](0),fog:!1,transparent:!!e.emissiveMap});return t}),e.renderer.toneMapping=ca["tc"],e.renderer.outputColorSpace=ca["Pd"],e.scene.environment=null},Po=(e,t,s)=>{const i=new ca["Yb"]({map:s,side:ca["U"],depthTest:!0,depthWrite:!0});t.material=i,t.material.needsUpdate=!0},Bo=(e,t)=>{const s=(e,t)=>{const s=e.getWorldPosition(new ca["ze"]),i=t.getWorldPosition(new ca["ze"]);return s.distanceTo(i)},i=e.parent?s(e.parent,e):.1,a=new ca["Yd"](.05*i,8,8),o=new ca["Xb"](a,t);return o.position.copy(e.getWorldPosition(new ca["ze"])),o},Ro=(e,t)=>{const s=e.parent.getWorldPosition(new ca["ze"]),i=e.getWorldPosition(new ca["ze"]),a=(new ca["ze"]).lerpVectors(s,i,.5),o=s.distanceTo(i),n=(new ca["ze"]).subVectors(i,s).normalize(),r=.2*o,l=new ca["x"](.3*r,o,8),c=new ca["Xb"](l,t);c.position.copy(a);const d=new ca["ze"](0,1,0),u=(new ca["Sc"]).setFromUnitVectors(d,n);return c.applyQuaternion(u),c},zo=(e,t)=>{const s=new ca["nb"];s.name="BONE_HELPER",t.forEach(e=>{const t=Bo(e,new ca["Yb"]({color:39423}));if(s.add(t),e.parent instanceof ca["m"]){const t=(new ca["q"]).setFromPoints([e.parent.getWorldPosition(new ca["ze"]),e.getWorldPosition(new ca["ze"])]),i=new ca["Eb"](t,new ca["Fb"]({color:0,linewidth:2}));s.add(i);const a=Ro(e,new ca["Yb"]({color:16753920,transparent:!0,opacity:.8}));s.add(a)}}),e.scene.add(s)},No=[new ca["v"](1,0,0),new ca["v"](0,.5,1),new ca["v"](1,.8,0),new ca["v"](0,.8,.2),new ca["v"](1,.4,0),new ca["v"](.6,0,1),new ca["v"](0,.9,.9),new ca["v"](1,0,.6),new ca["v"](.2,.7,.3),new ca["v"](1,.6,.8),new ca["v"](.8,.4,0),new ca["v"](0,.6,.8),new ca["v"](1,1,.4),new ca["v"](.5,0,.5),new ca["v"](.8,0,0),new ca["v"](0,.3,.7)],Fo=(e,t,s)=>{e.scene.children.filter(e=>"BONE_HELPER"===e.name).forEach(t=>e.scene.remove(t));const i=new ca["nb"];i.name="BONE_HELPER",i.renderOrder=999;const a=[];t.forEach(e=>{const t=e.userData.index===s,o=Bo(e,new ca["Yb"]({color:t?No[2]:No[1],depthTest:!1,transparent:!0,opacity:.8}));if(i.add(o),e.parent instanceof ca["m"]){const s=Ro(e,new ca["Yb"]({color:11184810,depthTest:!1,transparent:!0,opacity:.5}));a.push({bone:e,parent:e.parent,cone:s,isCurrent:t})}}),a.forEach(e=>{const t=e.parent&&e.parent.userData.index===s;e.cone.material=new ca["Yb"]({color:t?No[2]:11184810,depthTest:!1,transparent:!0,opacity:t?.9:.5}),i.add(e.cone)}),e.scene.add(i)},Vo=(e,t)=>{e.scene.children.filter(e=>"BONE_HELPER"===e.name).forEach(t=>e.scene.remove(t));const s=new ca["nb"];s.name="BONE_HELPER",s.renderOrder=999,t.forEach((e,t)=>{const i=Bo(e,new ca["Yb"]({color:No[t%No.length],depthTest:!1,transparent:!0,opacity:.8}));if(s.add(i),e.parent instanceof ca["m"]){const t=Ro(e,new ca["Yb"]({color:11184810,depthTest:!1,transparent:!0,opacity:.5}));s.add(t)}}),e.scene.add(s)},qo=(e,t)=>{const{geometry:s}=t,i=s.attributes.skinIndex.array,a=s.attributes.skinWeight.array,o=[];for(let r=0;r<i.length;r+=4){const e=new ca["v"](0);for(let t=0;t<4;t++){const s=i[r+t],o=a[r+t];if(-1!==s&&o>0){const t=No[s%No.length];e.add(t.clone().multiplyScalar(o))}}o.push(e.r,e.g,e.b)}s.setAttribute("color",new ca["eb"](o,3));const n=new ca["Yb"]({vertexColors:!0});t.material=n,t.material.needsUpdate=!0};function Ho(e,t){e.object.traverse(e=>{(e.isMesh&&e.uuid===t||"all"===t)&&e&&e.material&&Array.isArray(e.material)&&(e.material[1].color.set(No[4]),e.material[1].needsUpdate=!0)})}const Wo=(e,t,s)=>{const{geometry:i}=t,a=i.attributes.skinIndex.array,o=i.attributes.skinWeight.array,n=i.attributes.position.count,r=new Float32Array(3*n);function l(e){const t=120-120*e,s=.9,i=.5-.3*Math.pow(1-e,3);return c(t/360,s,i)}function c(e,t,s){let i,a,o;if(0===t)i=a=o=s;else{const n=(e,t,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+6*(t-e)*s:s<.5?t:s<2/3?e+(t-e)*(2/3-s)*6:e),r=s<.5?s*(1+t):s+t-s*t,l=2*s-r;i=n(l,r,e+1/3),a=n(l,r,e),o=n(l,r,e-1/3)}return[i,a,o]}for(let u=0;u<n;u++){const e=4*u;let t=0;for(let n=0;n<4;n++){const i=a[e+n],r=o[e+n];if(i===s&&r>0){t=r;break}}const i=3*u;if(t>.05){const[e,s,a]=l(t);r[i]=e,r[i+1]=s,r[i+2]=a}else r[i]=.05,r[i+1]=.05,r[i+2]=.05}i.setAttribute("color",new ca["eb"](r,3));const d=new ca["Yb"]({vertexColors:!0,transparent:!0,opacity:.95,depthTest:!0,depthWrite:!0,side:ca["gb"]});t.material=d,t.material.needsUpdate=!0,i.attributes.position.needsUpdate=!0,i.attributes.color.needsUpdate=!0},Uo={highlightMeshByUUID:Ho,wireframe:Io,matcap:$o,baseColor:Mo,metalness:To,roughness:Eo,normalMap:Lo,emission:Do,UVChecker:Po,getBones:zo,createInfluenceBones:Vo,createInfluence:qo,handleMaterial:_o,handleSkeletalHeatMapper:Wo,createHighLightBones:Fo},Qo=async e=>{const t=await fetch(e),s=await t.arrayBuffer(),i=await So.a.loadAsync(s);return i},Jo=e=>/^(https?:)?\/\//.test(e)?e.replace(/^https:\/\//,"http://"):`http://${window.location.host}/${e.replace(/^\/+/,"")}`;var Go,Ko,Yo,Zo,Xo={name:"ModelBlend",mixins:[qa],props:{lights:{type:Array,default(){return[{type:"HemisphereLight",position:{x:0,y:1,z:0},skyColor:16777215,groundColor:16777215,intensity:.8},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:.8}]}}},data(){return{}},methods:{createLoader(e){return new Ja["a"](e)},async load(){var e;if(!this.src)return;this.object&&this.wrapper.remove(this.object),this.reportProgress("start");const t=this.createLoader(this.loadingManager);if(null===t)return void this.$emit("error");t.setRequestHeader(this.requestHeader);const s=Jo(this.src),i=this.$loading({attach:null===(e=this.$refs)||void 0===e?void 0:e.container,showOverlay:!0}),a=await ko.multi3d({input_url:s,input_file_type:this.fileType,output_file_type:"fbx"},"blob").catch(()=>{i.hide()});let o;i.hide(),null!==a&&void 0!==a&&a.code?await this.$message.error((null===a||void 0===a?void 0:a.message)||"blender转fbx失败"):o=URL.createObjectURL(a),t.load(o,this.onLoad,this.onProgress,this.onError),this.blobUrls=[...o?[o]:[]]}}},en=Xo,tn=Object(S["a"])(en,Go,Ko,!1,null,null,null),sn=tn.exports,an={name:"ModelBlend",mixins:[qa],props:{lights:{type:Array,default(){return[{type:"HemisphereLight",position:{x:0,y:1,z:0},skyColor:16777215,groundColor:16777215,intensity:.8},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:.8}]}}},data(){return{}},methods:{createLoader(e){return new Ja["a"](e)},async load(){var e;if(!this.src)return;this.object&&this.wrapper.remove(this.object),this.reportProgress("start");const t=this.createLoader(this.loadingManager);if(null===t)return void this.$emit("error");t.setRequestHeader(this.requestHeader);const s=Jo(this.src),i=this.$loading({attach:null===(e=this.$refs)||void 0===e?void 0:e.container,showOverlay:!0}),a=await ko.multi3d({input_url:s,input_file_type:this.fileType,output_file_type:"fbx"},"blob").catch(()=>{i.hide()});let o;i.hide(),null!==a&&void 0!==a&&a.code?await this.$message.error((null===a||void 0===a?void 0:a.message)||"blender转fbx失败"):o=URL.createObjectURL(a),t.load(o,this.onLoad,this.onProgress,this.onError),this.blobUrls=[...o?[o]:[]]}}},on=an,nn=Object(S["a"])(on,Yo,Zo,!1,null,null,null),rn=nn.exports;const ln=da["default"].extend(so,{name:"model-json"}),cn=da["default"].extend(vo,{name:"model-dae"}),dn=[Qa,Za,so,ln,ro,po,vo,cn,jo,sn,rn],un=e=>{dn.forEach(t=>{e.component(t.name,t)})};"undefined"!==typeof window&&window.Vue&&un(window.Vue);var hn=s("8206"),pn=s.n(hn),mn=s("737f"),gn=s("5e8f");function bn(e,t={}){const s={backgroundColor:[.95,.95,1,1],pointColor:[.1,.6,.1,1],lineColor:[.2,.2,.7,1],pointSize:1,resolution:512,minZoom:.05,maxZoom:20,initialZoom:1,debugMode:!0,...t},i=document.createElement("canvas");i.width=s.resolution,i.height=s.resolution,i.style.backgroundColor=`rgb(${255*s.backgroundColor[0]}, ${255*s.backgroundColor[1]}, ${255*s.backgroundColor[2]})`;const a=i.getContext("webgl",{alpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"});if(!a)return console.error("WebGL not supported"),i;const o={zoom:s.initialZoom,pan:[0,0],isDragging:!1,lastX:0,lastY:0,points:null,edges:null,pointCount:0,edgeCount:0};return n(),r(e),h(i),i;function n(){const e=`\n        attribute vec2 aPosition;\n        uniform mat3 uTransform;\n        \n        void main() {\n            vec3 pos = vec3(aPosition, 1.0);\n            vec3 transformed = uTransform * pos;\n            gl_Position = vec4(transformed.x * 2.0 - 1.0, 1.0 - transformed.y * 2.0, 0.0, 1.0);\n            gl_PointSize = ${s.pointSize.toFixed(1)};\n        }\n    `,t="\n        precision mediump float;\n        uniform vec4 uColor;\n        \n        void main() {\n            gl_FragColor = uColor;\n        }\n    ",i=p(a,e,t);a.useProgram(i),o.attributes={position:a.getAttribLocation(i,"aPosition")},o.uniforms={transform:a.getUniformLocation(i,"uTransform"),color:a.getUniformLocation(i,"uColor")},a.viewport(0,0,a.canvas.width,a.canvas.height),a.enableVertexAttribArray(o.attributes.position)}function r(e){const t=[],i=[],n=new Set;e.traverse(e=>{const{geometry:a}=e;if(!e.isMesh||!e.geometry)return;if(s.currentSelectMesh&&s.currentSelectMesh!==e.uuid&&"all"!==s.currentSelectMesh)return;const o=a.attributes.uv;if(!o)return;const r=o.array,d=a.index?a.index.array:null;if(d)for(let s=0;s<d.length;s+=3){const e=d[s],a=d[s+1],o=d[s+2];l(r,e,t,n),l(r,a,t,n),l(r,o,t,n),c(r,e,a,i),c(r,a,o,i),c(r,o,e,i)}else{const{count:e}=o;for(let s=0;s<e;s+=3)l(r,s,t,n),l(r,s+1,t,n),l(r,s+2,t,n),c(r,s,s+1,i),c(r,s+1,s+2,i),c(r,s+2,s,i)}}),o.pointCount=t.length/2,o.edgeCount=i.length/4,o.pointCount>0&&(o.points=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,o.points),a.bufferData(a.ARRAY_BUFFER,new Float32Array(t),a.STATIC_DRAW)),o.edgeCount>0&&(o.edges=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,o.edges),a.bufferData(a.ARRAY_BUFFER,new Float32Array(i),a.STATIC_DRAW)),d()}function l(e,t,s,i){const a=e[2*t],o=e[2*t+1];if(a<0||o<0)return;const n=`${a.toFixed(4)},${o.toFixed(4)}`;i.has(n)||(i.add(n),s.push(a,o))}function c(e,t,s,i){const a=e[2*t],n=e[2*t+1],r=e[2*s],l=e[2*s+1];if(a<0||r<0||n<0||l<0)return;if(Math.abs(a-r)<1e-6&&Math.abs(n-l)<1e-6)return;const c=a<r?`${a}:${n}:${r}:${l}`:`${r}:${l}:${a}:${n}`;o.edgeSet||(o.edgeSet=new Set),o.edgeSet.has(c)||(o.edgeSet.add(c),i.push(a,n,r,l))}function d(){a.clearColor(...s.backgroundColor),a.clear(a.COLOR_BUFFER_BIT),u(),o.edges&&o.edgeCount>0&&(a.bindBuffer(a.ARRAY_BUFFER,o.edges),a.vertexAttribPointer(o.attributes.position,2,a.FLOAT,!1,0,0),a.uniform4fv(o.uniforms.color,s.lineColor),a.drawArrays(a.LINES,0,2*o.edgeCount)),o.points&&o.pointCount>0&&o.zoom>.3&&(a.bindBuffer(a.ARRAY_BUFFER,o.points),a.vertexAttribPointer(o.attributes.position,2,a.FLOAT,!1,0,0),a.uniform4fv(o.uniforms.color,s.pointColor),a.drawArrays(a.POINTS,0,o.pointCount)),s.debugMode&&console.log(`Rendered: ${o.pointCount} points, ${o.edgeCount} edges`)}function u(){const{zoom:e}=o,t=o.pan[0],s=-o.pan[1],i=new Float32Array([e,0,0,0,e,0,e*t,-e*s,1]);a.uniformMatrix3fv(o.uniforms.transform,!1,i)}function h(e){e.addEventListener("mousedown",t=>{o.isDragging=!0,o.lastX=t.clientX,o.lastY=t.clientY,e.style.cursor="grabbing"}),e.addEventListener("mousemove",t=>{if(!o.isDragging)return;const s=(t.clientX-o.lastX)/e.width/o.zoom,i=(t.clientY-o.lastY)/e.height/o.zoom;o.pan[0]+=s,o.pan[1]+=i,o.lastX=t.clientX,o.lastY=t.clientY,d()}),window.addEventListener("mouseup",()=>{o.isDragging=!1,e.style.cursor="default"});let t=null;function i(e){const t=Math.sign(e.deltaY),i=.02,a=t>0?1+i:1-i,n=Math.max(s.minZoom,Math.min(s.maxZoom,o.zoom*a));o.zoom=n,u(),d()}e.addEventListener("wheel",e=>{e.preventDefault(),t=e,i(t),t=null})}function p(e,t,s){const i=m(e,e.VERTEX_SHADER,t),a=m(e,e.FRAGMENT_SHADER,s);if(!i||!a)return null;const o=e.createProgram();return e.attachShader(o,i),e.attachShader(o,a),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(console.error("Program link error:",e.getProgramInfoLog(o)),null)}function m(e,t,s){const i=e.createShader(t);return e.shaderSource(i,s),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.error("Shader compile error:",e.getShaderInfoLog(i)),console.error("Shader source:",s),null)}}var fn=s("2f54");const vn=e=>{const t=[],s=[];return e.split("\n").forEach(e=>{const i=e.trim();if(i.startsWith("v ")){const[,e,s,a]=i.split(/\s+/);t.push(+e,+s,+a)}else if(i.startsWith("f ")){const e=i.slice(2).trim().split(/\s+/),t=e.map(e=>parseInt(e.split("/")[0],10)-1);t.length>=3&&s.push(t)}}),{positions:new Float32Array(t),faces:s}};class yn extends ca["nb"]{constructor(e,t,s={}){super(),Object(fn["a"])(this,"_positions",void 0),Object(fn["a"])(this,"_faces",void 0),this.isNGonMesh=!0;const i=[];t.forEach(e=>{for(let t=1;t<e.length-1;t++)i.push(e[0],e[t],e[t+1])});const a=new ca["q"];a.setAttribute("position",new ca["p"](e,3)),a.setIndex(i),a.computeVertexNormals();const o=[];t.forEach(e=>{for(let t=0;t<e.length;t++)o.push(e[t],e[(t+1)%e.length])});const n=new ca["q"];n.setAttribute("position",new ca["p"](e,3)),n.setIndex(o);const r=s.fillMaterial||new ca["Yb"]({color:15066854,transparent:!1,depthTest:!0,depthWrite:!0,side:ca["U"],polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),l=s.wireMaterial||new ca["Fb"]({color:3355443,linewidth:1.5,polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:-1}),c=new ca["Xb"](a,r),d=new ca["Hb"](n,l);d.renderOrder=1,this.add(c,d),this._positions=e,this._faces=t}getGeometricCenter(){const e=this._positions;let t=1/0,s=1/0,i=1/0,a=-1/0,o=-1/0,n=-1/0;for(let r=0;r<e.length;r+=3){const l=e[r],c=e[r+1],d=e[r+2];t=Math.min(t,l),s=Math.min(s,c),i=Math.min(i,d),a=Math.max(a,l),o=Math.max(o,c),n=Math.max(n,d)}return new ca["ze"]((t+a)/2,(s+o)/2,(i+n)/2)}getGeometricSize(){const e=this._positions;let t=1/0,s=1/0,i=1/0,a=-1/0,o=-1/0,n=-1/0;for(let r=0;r<e.length;r+=3){const l=e[r],c=e[r+1],d=e[r+2];t=Math.min(t,l),s=Math.min(s,c),i=Math.min(i,d),a=Math.max(a,l),o=Math.max(o,c),n=Math.max(n,d)}return new ca["ze"](a-t,o-s,n-i)}}const wn={MATCAP_TEXTURE_URL:"https://media.sketchfab.com/matcaps/43a40dd3e9c34fc0b7da9cbf07b82ac8/2c08715b53aa4d0184bd40589b88bb7a.jpeg",UV_CHECK_TEXTURE_URL:"https://static.sketchfab.com/static/builds/web/dist/static/assets/images/viewer/45755f41f22fab7274193ee039ee779e-v2.png",WIREFRAME_LINEWIDTH:1,DEFAULT_METALNESS:.5,DEFAULT_ROUGHNESS:.5,UV_SCALE:new ca["ye"](1,1)};var xn={name:"ModelViewer",components:{ModelObj:Qa,ModelFbx:Za,ModelThree:so,ModelStl:ro,ModelPly:po,ModelCollada:vo,ModelGltf:jo,ModelBlend:sn,ImageErrorIcon:mn["a"],DownloadIcon:gn["a"]},mixins:[Re["a"]],props:{url:{type:String,required:!0},modelConfig:{type:String,default:""},enabledFullscreen:{type:Boolean,default:!0},downloadEnabled:Boolean,isBasic:Boolean},data(){return{showConfig:"true"===localStorage.getItem("model-config-show"),showConfigContent:!0,formData:{renderMode:"finalRender",emissive:!1,emissiveMap:!1,rotation:!1,backgroundColor:"white",autoLights:!1,enableZoom:!0},originalMaterials:new WeakMap,rotation:{x:0,y:0,z:0},autoLights:[{type:"AmbientLight",color:16777215,intensity:1},{type:"DirectionalLight",position:{x:1,y:1,z:1},color:16777215,intensity:1},{type:"DirectionalLight",position:{x:-1,y:1,z:1},color:16777215,intensity:1},{type:"DirectionalLight",position:{x:1,y:1,z:-1},color:16777215,intensity:1},{type:"DirectionalLight",position:{x:-1,y:1,z:-1},color:16777215,intensity:1},{type:"DirectionalLight",position:{x:0,y:-1,z:0},color:16777215,intensity:1}],type:"",isError:!1,matcapTexture:null,uvMap:null,animationFrameId:null,zip:null,allBones:[],fileSize:0,FILE_MAX_SIZE:800,modelMeshes:[{name:"origin",id:null},{name:"all",id:"all"}],bonesTree:{},currentSelectBoneIndex:1,currentSelectMesh:null,fileContent:null,enableNgonType:["obj","fbx","dae","ply","blend","usdz"],ngonLoading:!1,ngonState:null,cHeight:Math.max(window.innerHeight-220,700)}},computed:{cFileSize(){return(this.fileSize/1024/1024).toFixed(0)},currentComponent(){switch(this.type){case"glb":case"gltf":return jo;case"obj":return Qa;case"fbx":return Za;case"stl":return ro;case"dae":return vo;case"ply":return po;case"json":return so;case"blend":case"usdz":return sn;default:return jo}},formDataHash(){return JSON.stringify(this.formData,Object.keys(this.formData).sort())},isNgonWireframe(){return"NgonWireframe"===this.formData.renderMode},sortedAllBones(){return[...this.allBones].sort((e,t)=>{var s;return null===(s=e.name)||void 0===s?void 0:s.localeCompare(t.name)})}},watch:{formDataHash:Object(a["debounce"])((function(e,t){if(e===t)return;const s=JSON.parse(e),i=JSON.parse(t);if(s.autoLights)Object.assign(this.formData,{lights:this.autoLights});else try{Object.assign(this.formData,{lights:s.lightsInput?JSON.parse(s.lightsInput):void 0})}catch(a){console.log(a),Object.assign(this.formData,{lights:void 0})}s.renderMode===i.renderMode&&s.emissiveMap===i.emissiveMap&&s.emissive===i.emissive||this.updateMaterials(),s.rotation&&this.rotate()}),500)},mounted(){!this.isBasic&&this.$optimus.$on("optimus:model-config:change",e=>{this.showConfig=e}),this.getType(),this.modelConfig&&this.setDefaultConfig(),this.preloadMatcapTexture(),this.createUVCheckerTexture(),this.getFileSize(),window.addEventListener("resize",this.onResize,!1)},beforeDestroy(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),[this.matcapTexture,this.uvMap].forEach(e=>{e&&(e.dispose(),e=null)}),window.removeEventListener("resize",this.onResize,!1)},methods:{onResize(){this.cHeight=Math.max(window.innerHeight-220,700)},tryRender(){this.fileSize=0},async getFileSize(){if(this.url){var e;const t=await pn.a.get(this.url,{headers:{Range:"bytes=0-0"}}),s=(null===t||void 0===t?void 0:t.headers["content-range"])||"";this.fileSize=parseInt((null===s||void 0===s||null===(e=s.split("/"))||void 0===e?void 0:e[1])||0,10)}else this.fileSize=0},preloadMatcapTexture(){return(new ca["je"]).setCrossOrigin("Anonymous").loadAsync(wn.MATCAP_TEXTURE_URL).then(e=>{e.colorSpace=ca["Pd"],this.matcapTexture=e}).catch(e=>{console.error("Matcap纹理加载失败:",e);const t=document.createElement("canvas");t.width=512,t.height=512;const s=t.getContext("2d"),i=s.createRadialGradient(256,256,0,256,256,256);i.addColorStop(0,"#ffffff"),i.addColorStop(1,"#888888"),s.fillStyle=i,s.fillRect(0,0,512,512),this.matcapTexture=new ca["s"](t)})},createUVCheckerTexture(){function e(e){e?(s.minFilter=ca["lc"],s.magFilter=ca["lc"],s.generateMipmaps=!1):(s.minFilter=ca["Ib"],s.magFilter=ca["Ib"],s.generateMipmaps=!0),s.needsUpdate=!0}const t=new ca["je"];t.crossOrigin="Anonymous";const s=t.load("https://static.sketchfab.com/static/builds/web/dist/static/assets/images/viewer/45755f41f22fab7274193ee039ee779e-v2.png",void 0,void 0,e=>{console.error("UV检查纹理加载失败:",e);const t=document.createElement("canvas");t.width=512,t.height=512;const s=t.getContext("2d"),i=32;for(let o=0;o<512;o+=i)for(let e=0;e<512;e+=i)s.fillStyle=(Math.floor(e/i)+Math.floor(o/i))%2===0?"#FF0000":"#00FF00",s.fillRect(e,o,i,i);s.strokeStyle="#0000FF",s.lineWidth=4,s.beginPath(),s.moveTo(256,0),s.lineTo(256,512),s.moveTo(0,256),s.lineTo(512,256),s.stroke();const a=new ca["s"](t);return a.wrapS=ca["Ld"],a.wrapT=ca["Ld"],a.needsUpdate=!0,a});return e(!0),s.wrapS=ca["Ld"],s.wrapT=ca["Ld"],s.repeat.set(1,1),s.anisotropy=16,s.generateMipmaps=!1,s.minFilter=ca["Ib"],s.generateMipmaps=!0,s.colorSpace=ca["Pd"],this.uvMap=s,s},async getType(){try{const e=this.url.match(/\.([a-zA-Z0-9]+)(\?.*)?$/);let t="";if(e)[,t]=e;else{const e=await pn.a.get(this.url,{headers:{Range:"bytes=0-0"}}),s=e.headers["content-disposition"];if(s){const e=/filename\*?=(?:UTF-8''|)([^;]+)/.exec(s)||/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(s);if(e){const s=decodeURIComponent(e[1].replace(/['"]/g,"")),i=s.split(".");t=i.length>1?i.pop():"",t||this.handleError()}}else this.handleError()}if("zip"===t){const e=await Qo(this.url);this.zip=e,e.forEach((e,s)=>{if(!s.dir){const s=e.split(".").pop().toLowerCase();["fbx","obj"].includes(s)&&(t=s)}})}this.type=t.toLowerCase(),await this.fetchFileContent()}catch(e){this.handleError()}},async fetchFileContent(){if(this.fileContent=null,this.url){if(this.ngonLoading=!0,"obj"===this.type){const e=await fetch(this.url).catch(()=>{this.ngonLoading=!1});this.fileContent=await(null===e||void 0===e?void 0:e.text())||null}else if(this.enableNgonType.includes(this.type)){const e=Jo(this.url),t=await ko.multi3d({input_url:e,input_file_type:this.type,output_file_type:"obj"}).catch(()=>{this.ngonLoading=!1});null!==t&&void 0!==t&&t.code?(await this.$message.error((null===t||void 0===t?void 0:t.message)||"布线服务异常"),this.fileContent=null):this.fileContent=t||null}this.ngonLoading=!1}},showConfigModal(){this.showConfig=!this.showConfig,this.showConfig&&(this.showConfigContent=!0),this.$emit("changeConfigModal",this.showConfig)},setDefaultConfig(){try{const e=JSON.parse(this.modelConfig),t=e.lights?JSON.stringify(e.lights):"";this.$set(this,"formData",{...this.formData,...e,lightsInput:t,lights:e.autoLights?this.autoLights:e.lights})}catch(e){console.error(e)}},rotate(){if(!this.animationFrameId&&this.formData.rotation){const e=()=>{this.formData.rotation?(this.rotation.y+=.01,this.animationFrameId=requestAnimationFrame(e)):(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)};e()}},handleLoad(){const e=this.$refs.modelViewer,{object:t}=e;t&&(t.traverse(e=>{e.isMesh&&this.modelMeshes.push({name:e.name,id:e.uuid}),e.isSkinnedMesh&&e.skeleton.bones.forEach((e,t)=>{e.userData.index=t,this.allBones.push(e)}),e.isBone&&(this.allBones.includes(e)||this.allBones.push(e)),e.isMesh&&!this.originalMaterials.has(e)&&(e.geometry&&(e.geometry.computeVertexNormals(),e.geometry.normalizeNormals(),e.geometry.attributes.tangent||(e.geometry.computeVertexNormals(),e.geometry.normalizeNormals())),this.originalMaterials.set(e,{material:e.material,geometry:e.geometry}))}),this.allBones=Object(a["uniqBy"])(this.allBones,"uuid"),this.$nextTick(()=>{e.updateCamera(),e.controls&&e.controls.update(),e.render()}),this.updateMaterials())},updateMaterials(){const e=this.$refs.modelViewer;if(null===e||void 0===e||!e.object)return;const{renderMode:t}=this.formData;"NgonWireframe"===t&&this.enableNgonType.includes(this.type)?this.handleNgonWireframeMode(e):(this.ngonState&&this.restoreFromNgonMode(e),this.handleBoneModes(e,t),this.handleUvMapMode(e,t),this.handleMaterialRenderModes(e,t))},handleNgonWireframeMode(e){const t=e.object,s=e.wrapper.position.clone(),i=e.wrapper.rotation.clone(),a=e.wrapper.scale.clone(),o=e.camera.position.clone(),n=e.camera.rotation.clone();e.wrapper.children.filter(e=>"NGON_MESH"!==e.name).forEach(t=>e.wrapper.remove(t));const{positions:r,faces:l}=vn(this.fileContent),c=new yn(r,l);c.name="NGON_MESH",e.wrapper.add(c),this.alignNgonMesh(c,t),this.restoreWrapperAndCamera(e,{originalWrapperPosition:s,originalWrapperRotation:i,originalWrapperScale:a,originalCameraPosition:o,originalCameraRotation:n}),this.ngonState={originalObject:t,originalWrapperPosition:s,originalWrapperRotation:i,originalWrapperScale:a,originalCameraPosition:o,originalCameraRotation:n}},alignNgonMesh(e,t){const s=(new ca["n"]).setFromObject(t),i=s.getSize(new ca["ze"]),a=Math.max(i.x,i.y,i.z),o=(new ca["n"]).setFromObject(e),n=o.getSize(new ca["ze"]),r=Math.max(n.x,n.y,n.z);console.log("originalMaxSize",a,"ngonMaxSize",r);let l=1;r>0&&a>0?(l=a/r,(l>1e3||l<.001)&&(l=1,console.warn("NgonWireframe scale extreme, fallback to 1")),e.scale.set(l,l,l),console.log("ngon final position",JSON.stringify(e.position),"scale",JSON.stringify(e.scale))):console.warn("NgonWireframe: invalid bounding box size",{originalMaxSize:a,ngonMaxSize:r})},restoreWrapperAndCamera(e,t){e.wrapper.position.copy(t.originalWrapperPosition),e.wrapper.rotation.copy(t.originalWrapperRotation),e.wrapper.scale.copy(t.originalWrapperScale),e.camera.position.copy(t.originalCameraPosition),e.camera.rotation.copy(t.originalCameraRotation),e.camera.updateProjectionMatrix()},restoreFromNgonMode(e){e.wrapper.children.filter(e=>"NGON_MESH"===e.name).forEach(t=>e.wrapper.remove(t)),this.ngonState.originalObject&&(e.wrapper.add(this.ngonState.originalObject),e.wrapper.position.copy(this.ngonState.originalWrapperPosition),e.wrapper.rotation.copy(this.ngonState.originalWrapperRotation),e.wrapper.scale.copy(this.ngonState.originalWrapperScale)),e.camera.position.copy(this.ngonState.originalCameraPosition),e.camera.rotation.copy(this.ngonState.originalCameraRotation),e.camera.updateProjectionMatrix(),this.ngonState=null},handleBoneModes(e,t){e.scene.children.filter(e=>"BONE_HELPER"===e.name).forEach(t=>e.scene.remove(t)),"bones"===t&&Uo.getBones(e,this.allBones),"bonesInfluence"!==t&&"skeletalHeatMapper"!==t||Uo.createInfluenceBones(e,this.allBones),"skeletalHeatMapper"===t&&Uo.createHighLightBones(e,this.allBones,this.currentSelectBoneIndex)},handleUvMapMode(e,t){if("uvMap"===t){const t=bn(e.object,{currentSelectMesh:this.currentSelectMesh});this.$refs.uvMap.hasChildNodes()&&this.$refs.uvMap.removeChild(this.$refs.uvMap.firstChild),this.$refs.uvMap.appendChild(t)}else this.$refs.uvMap.hasChildNodes()&&(this.$refs.uvMap.removeChild(this.$refs.uvMap.firstChild),this.currentSelectMesh=null)},handleMaterialRenderModes(e,t){e.object.traverse(s=>{this.restoreOriginalMaterial(s),this.handleLighting(s),this.handleSpecialModes(e,s,t),s.isMesh&&this.applyMaterialMode(e,s,t)})},restoreOriginalMaterial(e){const t=this.originalMaterials.get(e);t&&(e.material=Uo.handleMaterial(t.material),e.geometry=t.geometry.clone())},handleLighting(e){e.isLight&&(e.intensity=0)},handleSpecialModes(e,t,s){t.isMesh&&"uvMap"===s&&(Uo.wireframe(e,t),this.currentSelectMesh&&Uo.highlightMeshByUUID(e,this.currentSelectMesh)),t.isSkinnedMesh&&"bonesInfluence"===s&&Uo.createInfluence(e,t),t.isSkinnedMesh&&"skeletalHeatMapper"===s&&Uo.handleSkeletalHeatMapper(e,t,this.currentSelectBoneIndex)},applyMaterialMode(e,t,s){switch(s){case"finalRender":this.applyFinalRenderMode(t);break;case"wireframe":Uo.wireframe(e,t);break;case"matcap":Uo.matcap(e,t,this.matcapTexture,!1);break;case"matcap+surface":Uo.matcap(e,t,this.matcapTexture,!0);break;case"basecolor":Uo.baseColor(e,t);break;case"metalness":Uo.metalness(e,t);break;case"roughness":Uo.roughness(e,t);break;case"normalMap":Uo.normalMap(e,t);break;case"emission":Uo.emission(e,t);break;case"uv":Uo.UVChecker(e,t,this.uvMap);break;case"bones":this.applyBonesMode(t);break}},applyFinalRenderMode(e){e.material=Uo.handleMaterial(e.material,e=>(this.formData.emissive&&(e.emissive=e.color.clone(),e.map&&(e.emissiveMap=e.map)),e.side=ca["U"],e.shadowSide=ca["U"],e.map&&!e.map.image&&(e.map=null),e.needsUpdate=!0,e))},applyBonesMode(e){e.material=Uo.handleMaterial(e.material,e=>{const t=e.clone();return t.transparent=!0,t.opacity=.05,t.depthWrite=!1,t})},handleError(e){console.log(`${this.url}, ${this.type}加载出错`,e),this.isError=!0},zoom(e){const{controls:t}=this.$refs.modelViewer;switch(e){case"+":t.object.position.multiplyScalar(.9);break;case"-":t.object.position.multiplyScalar(1.1);break;default:break}},handleFullscreenPreview(){this.$emit("fullscreenPreview")},download(){window.open(this.url,"_blank")},handleUvMapSelect(e){this.currentSelectMesh=e,this.updateMaterials()},handleBoneSelect(e){this.currentSelectBoneIndex=e,this.updateMaterials()}}},Cn=xn,jn=(s("f041"),Object(S["a"])(Cn,ra,la,!1,null,"358ee0f1",null)),On=jn.exports,kn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("iframe",{staticStyle:{"background-color":"#fff","border-radius":"8px"},attrs:{src:e.url,frameborder:"0",width:"100%"}})},An=[],Sn={name:"defaultPreview",props:{url:{type:String,required:!0}}},_n=Sn,In=(s("9416"),Object(S["a"])(_n,kn,An,!1,null,"97e70c18",null)),$n=In.exports,Mn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[e.sourceUrl&&e.loading?s("Spin"):e.isError?s("div",{staticClass:"error"},[s("span",[e._v("文件预览有误，请点击")]),s("a",{attrs:{href:e.sourceUrl}},[e._v(" 下载 ")]),s("span",[e._v("后本地预览")])]):s("iframe",{attrs:{src:e.url,frameborder:"0"}})],1)},Tn=[];const En=e=>Object(Ws["a"])("api/attachment","addLink",e),Ln=e=>Object(Ws["a"])("api/attachment","addUpload",e),Dn=e=>Object(Ws["a"])("api/cos","getTmpSecret",e),Pn=e=>Object(Ws["a"])("api/attachment","getAttachmentUrl",e),Bn=e=>Object(Ws["a"])("api/attachment","listAttachments",e),Rn=e=>Object(Ws["a"])("api/attachment","completeUpload",e),zn=e=>Object(Ws["a"])("api/attachment","deleteAttachments",e),Nn=e=>Object(Ws["c"])({url:"file/checkDomainWhite",method:"post",data:e}),Fn=e=>Object(Ws["c"])({url:"file/proxy",responseType:"blob",method:"post",data:e});var Vn={name:"documentPreview",mixins:[x["a"]],props:{sourceUrl:String,previewUrl:String,filename:String,previewMode:{type:String,default:"modal"}},data(){return{loading:!1,url:this.previewUrl||this.sourceUrl,isError:!1}},mounted(){this.getPreviewUrl()},methods:{async getPreviewUrl(){if(!this.previewUrl)try{this.loading=!0,await En({obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_scene:"label",attach_path:this.sourceUrl,attach_name:this.filename,need_dump:!0});const e=await Pn({obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_path:this.sourceUrl,need_metadata:!1,need_preview:!0});console.log(e.preview_url),this.url=e.preview_url}catch(e){console.log(e),this.isError=!0}finally{this.loading=!1}}}},qn=Vn,Hn=(s("d1aa"),Object(S["a"])(qn,Mn,Tn,!1,null,"36fb9911",null)),Wn=Hn.exports,Un={components:{imagePreview:Ji,audioPreview:ea,videoPreview:na,modelPreview:On,defaultPreview:$n,documentPreview:Wn,safeImage:Bs},mixins:[x["a"]],props:{previewType:String,sourceUrl:String,previewUrl:String,filename:String,previewMode:{type:String,default:"curTab"},fileCopyable:{type:Boolean,default:!1},downloadEnabled:{type:Boolean,default:!1},imagStyle:Object},data(){return{visible:!1,url:this.previewUrl||this.sourceUrl,loading:!1}},computed:{tUrl(){return this.url?`${this.url}&_t=${(new Date).getTime()}`:this.url},currentComponent(){switch(this.previewType){case"image":return Ji;case"video":return na;case"audio":return ea;case"model":return On;case"cos":return $n;default:return $n}}},mounted(){document.body.appendChild(this.$refs.mask)},beforeDestroy(){document.body.removeChild(this.$refs.mask)},methods:{closeModal(){this.visible=!1},getAttachmentUrl(){return Pn({obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_path:this.sourceUrl,need_metadata:!1,need_preview:!0,copyable:this.fileCopyable})},async handleFullscreenPreview(){if("newTab"!==this.previewMode&&(this.visible=!0),!this.previewUrl)try{this.loading=!0;let t=null;try{t=await this.getAttachmentUrl()}catch(e){await En({obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_scene:"label",attach_path:this.sourceUrl,attach_name:this.filename,need_dump:!0}),t=await this.getAttachmentUrl()}finally{this.url="url"===this.previewType?this.sourceUrl:t.preview_url}"newTab"===this.previewMode&&(this.visible=!1,window.open(this.tUrl))}catch(e){this.visible=!1,window.open(this.tUrl),console.log(e)}finally{this.loading=!1}},handlePreview(){["model","image"].includes(this.previewType)||("undefined"!==this.previewType?this.handleFullscreenPreview():window.open(this.tUrl,"_blank"))}}},Qn=Un,Jn=(s("4d03"),Object(S["a"])(Qn,Fi,Vi,!1,null,"5f6e3ca2",null)),Gn=Jn.exports,Kn={name:"z-group",components:{Preview:Gn,WordCount:ue},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{name:String,label:String,objectType:String,isVisible:{type:Boolean,default:!0},isWebShow:{type:Boolean,default:!0},isTitleVisible:{type:Boolean,default:!0},required:{type:Boolean,default:!0},heightType:{type:String,default:"defalut"},height:{type:[Number,String]},objectSizeType:{type:String,default:"defalut"},objectWidth:{type:[Number,String]},objectHeight:{type:[Number,String]},isTiming:{type:Boolean,default:!1},isCount:{type:Boolean,default:!1},time:{type:Number},lockedName:{type:String},locked:{type:Object}},data(){const{objects:e}=this.$optimus,t=Object(a["cloneDeep"])(e).filter(e=>e.data.group===this.name).reduce((e,t)=>Object.assign(e,{[t.data.index]:{tags:t.tags}}),{});return{objectUrl:"object_url",objectName:"object_name",objectDesc:"object_desc",objectOrder:"object_order",objectIndexDesc:"object_index_desc",objectIndex:"object_index",selectIndex:null,objects:e,isCheck:!1,markAnswer:t,viewer:null,times:{},isLocked:!!this.locked}},computed:{objectItemStyle(){return{width:"custom"===this.objectSizeType?this.objectWidth+"px":"",height:"custom"===this.objectSizeType?this.objectHeight+"px":""}},labelObjectsFlatten(){let e=this.$optimus.context[this.name];if(!e)return[];if(Object(a["isString"])(e)){if(""===e)return[];try{e=JSON.parse(e)}catch(t){console.error(`[${this.name}] 配置出错`,{labelObjects:e})}}return e.some(e=>Object(a["isString"])(e))&&(e=Object(a["cloneDeep"])(e).map(e=>({[this.objectName]:"",[this.objectUrl]:e}))),Object(a["chain"])(e).cloneDeep().map(e=>Object.assign(e,{objectType:"mixed"===this.objectType?e.object_type:this.objectType,id:Object(Ve["a"])()})).orderBy([this.objectOrder],["asc"]).value()},myLabelObjects(){return Object(a["chain"])(this.labelObjectsFlatten).groupBy(e=>{var t;return null!==(t=e[this.objectIndex])&&void 0!==t?t:Object(Ve["a"])()}).values().value()},componentConfig(){const e=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t},group:s}=e;return t?"all"===t?s===this.name:s===this.name&&t===this.currentToolName:s===this.name});return{component:"z-form-stage",items:e}},currentTool(){const e=this.$optimus.renderedComponentConfig.$object_tools;return 0===e.length?{}:Object(a["head"])(e.filter(e=>e.group===this.name))},labeledLists(){var e;const t=null!==(e=Object(a["groupBy"])(this.objects,e=>e.data.group)[this.name])&&void 0!==e?e:[];return t.map(e=>this.getIndex(e.data.index))},isImageShown(){var e;return"image"===this.objectType&&(null===(e=this.viewer)||void 0===e?void 0:e.isShown)},isMultiObj(){return this.myLabelObjects.some(e=>e.length>1)}},mounted(){this.initObjects(),this.isTiming&&!this.$optimus.disabled&&setInterval(()=>{this.currentTiming===this.name&&(this.$set(this.times,this.name,this.times[this.name]+1),this.times[this.name]===this.time&&this.$optimus.$emit("optimus:group-unlock",this.lockedName))},1e3),this.$optimus.$on("optimus:group-unlock",e=>{e===this.name&&(this.isLocked=!1)}),this.$optimus.$on("optimus:multiple-groups-stage:edit-object",e=>{console.log("optimus:multiple-groups-stage:edit-object");const{data:{index:t,group:s}}=e;this.name===s?this.selectIndex=this.getIndex(t):this.selectIndex=null,this.isTiming&&(this.times[e.data.group]||this.$set(this.times,e.data.group,0),this.currentTiming=e.data.group)}),this.$optimus.$on("optimus:multiple-groups-stage:delete-object",e=>{console.log("optimus:multiple-groups-stage:delete-object"),e===this.name?this.deleteObjectByGroup(e):this.deleteObjectById(e)}),this.$optimus.$on("optimus:forms-stage:check",()=>{this.$optimus.$emit("optimus:optimus-engine:check",this.validate())}),this.$optimus.$on("optimus:multiple-groups-stage:hotKey",this.listenKeyboardEvent),Object(a["find"])(this.labelObjectsFlatten,{objectType:"image"})&&this.initViewer()},methods:{initObjects(){var e;if(!this.currentTool||0!==(null===(e=this.$parent)||void 0===e?void 0:e.objectsClone.length))return;const t=this.componentConfig.items.some(e=>{const{value:t}=e.attributes;return!Object(a["isNil"])(t)&&0!==t.length});t&&this.myLabelObjects.forEach((e,t)=>{const s=this.findObject(t);if(!s){const{type:e,name:s,label:i}=this.currentTool,a={type:e,data:{index:this.getObjectIndex(t),group:this.name},tags:this.$refs["form_"+t][0].tags,featureId:"feature-"+Object(n["j"])(8),name:s,label:i,extData:{}};this.objects.push(a)}})},listenKeyboardEvent(e){const{code:t,key:s,target:i}=e;"INPUT"===i.tagName&&"checkbox"!==i.getAttribute("type")||"TEXTAREA"===i.tagName||i.getAttribute("contenteditable")||("KeyQ"===t&&(this.isImageShown&&!this.isMultiObj?this.handleClickImgView(this.viewer.index):!Object(a["isNil"])(this.selectIndex)&&this.deleteObject(this.selectIndex)),["1","2","3","4","5","6","7","8","9"].includes(s)&&this.handleSingleSelect(Number(s)))},handleSingleSelect(e){const{items:t}=this.componentConfig,[{component:s,attributes:{name:i,options:o}}]=t;var n;1===t.length&&"z-single-select"===s&&!Object(a["isNil"])(this.selectIndex)&&o.length>=e&&(this.$refs["form_"+this.selectIndex][0].formData[i]=null===(n=o[e-1])||void 0===n?void 0:n.value)},getObjectIndex(e){var t,s;return(null===(t=this.myLabelObjects[e])||void 0===t||null===(s=t[0])||void 0===s?void 0:s[this.objectIndex])||e},getIndex(e){return this.myLabelObjects.findIndex((t,s)=>{var i;return((null===t||void 0===t||null===(i=t[0])||void 0===i?void 0:i[this.objectIndex])||s)===e})},findObject(e){return this.objects.find(t=>{const{data:{index:s,group:i}}=t;return this.name===i&&s===this.getObjectIndex(e)})},handleClickImgView(e){if(this.$optimus.disabled)return;const t=this.findObject(e);t?(this.deleteObject(e),document.getElementsByClassName("viewer-move")[0].style.border=""):(this.addObject(e),document.getElementsByClassName("viewer-move")[0].style.border="2px solid #19be6b")},addObject(e){if(this.selectIndex=e,!this.currentTool)return void this.$Message.warning({content:"当前容器还没配置工具，请先去配置工具哦"});const t=this.findObject(e);if(t)this.$optimus.$emit("optimus:multiple-groups-stage:select-object",t);else if(!t&&!this.$optimus.disabled){const{type:t,name:s,label:i}=this.currentTool,a={type:t,data:{index:this.getObjectIndex(e),group:this.name},tags:this.$refs["form_"+e][0].tags,featureId:"feature-"+Object(n["j"])(8),name:s,label:i,extData:{}};this.objects.push(a),this.isImageShown&&!this.isMultiObj&&(document.getElementsByClassName("viewer-move")[0].style.border="2px solid #19be6b"),this.$Message.success("已选中当前对象，再按Q可清空"),this.$optimus.$emit("optimus:multiple-groups-stage:select-object",a)}},updateObjTags(e){const t="form_"+e,s=Object(a["findIndex"])(this.objects,t=>{const{data:{index:s,group:i}}=t;return i===this.name&&s===this.getObjectIndex(e)});-1!==s&&(this.objects[s].tags=this.$refs[t][0].tags)},validate(){return this.isCheck=!0,!this.required||this.myLabelObjects.length===this.labeledLists.length},handleDeleteObject(e,t){null===e||void 0===e||e.stopPropagation(),this.deleteObject(t)},deleteObject(e){const t=this.findObject(e);t&&this.deleteObjectById(t),this.$Message.warning("已清空当前对象")},deleteObjectById(e){const{featureId:t,data:{group:s,index:i}}=e;if(this.name===s){const e=this.objects.findIndex(e=>e.featureId===t);-1!==e&&(this.objects.splice(e,1),this.selectIndex===this.getIndex(i)&&(this.selectIndex=null))}},deleteObjectByGroup(e){const t=this.objects.filter(t=>t.data.group===e);t.forEach(e=>{this.deleteObjectById(e)})},isNeedToLabel(e){return this.isCheck&&this.required&&!this.labeledLists.includes(e)},handlePlay(e){e.stopPropagation()},initViewer(){const e=this;this.viewer=new Es.a(document.getElementById("group-container_"+this.name),{viewed(){if(!e.isMultiObj){const t=e.findObject(this.viewer.index);document.getElementsByClassName("viewer-move")[0].style.border=t?"2px solid #19be6b":""}this.viewer.image.addEventListener("contextmenu",e=>{e.preventDefault()}),this.viewer.image.addEventListener("click",t=>{t.preventDefault(),!e.isMultiObj&&e.addObject(this.viewer.index)})},play(){this.viewer.player.addEventListener("contextmenu",e=>{e.preventDefault()})},className:"custom-class",zIndex:"999"})},lanuchViewer(e){const t=Object(a["chain"])(this.labelObjectsFlatten).filter({objectType:"image"}).findIndex({id:e}).value();this.viewer.view(t),event.stopPropagation()}}},Yn=Kn,Zn=(s("b1db"),Object(S["a"])(Yn,zi,Ni,!1,null,"79b40a72",null)),Xn=Zn.exports,er=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,name:e.name}},[s("t-select",{attrs:{options:e.options,placeholder:"请选择需要配置的锚点",multiple:""},on:{change:e.handleChange},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}})],1):e._e()},tr=[],sr={label:"选项输入",icon:"ios-create-outline",name:"z-switch",attributes:[{name:"name",label:"字段标识",type:String,value(){return"switch_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"},{name:"disabled",label:"是否禁用",type:Boolean}]},ir={metadata:sr,name:"z-anchor-config",mixins:[x["a"]],props:{isVisible:{type:Boolean,default:!0}},data(){return{selectValue:[]}},computed:{options(){try{const e=this.$optimus.schema.filter(e=>e.display),t=Object(a["groupBy"])(e,e=>e.group||e.name),s=Object.keys(t).map(e=>{const[s]=t[e];return{label:s.group||s.name,value:s.key}});return[{label:"全选",checkAll:!0},...s]}catch(e){return[]}}},watch:{"$optimus.schema"(){this.selectValue=this.$optimus.formData[this.name].map(e=>null===e||void 0===e?void 0:e.value).filter(e=>e&&this.$optimus.schema.find(t=>t.key===e))}},created(){this.$optimus.formData[this.name]&&(this.selectValue=this.$optimus.formData[this.name].map(e=>null===e||void 0===e?void 0:e.value).filter(e=>e&&this.$optimus.schema.find(t=>t.key===e)))},methods:{handleChange(e){this.$optimus.formData[this.name]=e.map(e=>Object(a["find"])(this.options,{value:e}))}}},ar=ir,or=Object(S["a"])(ar,er,tr,!1,null,"4d2c1442",null),nr=or.exports,rr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("FormItem",{attrs:{label:e.label,prop:e.name,rules:{required:e.required,message:e.label+"未添加"}}},[s("InputNumber",{attrs:{max:10,min:1},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}}),s("span",{staticStyle:{"margin-left":"10px"}},[e._v("像素（范围为1-10）")])],1)},lr=[],cr={label:"像素输入",icon:"ios-create-outline",name:"z-pixel-input",attributes:[{name:"name",label:"字段标识",type:String,value(){return"pixel_input_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"}]},dr={metadata:cr,name:"z-pixel-input",mixins:[x["a"]]},ur=dr,hr=Object(S["a"])(ur,rr,lr,!1,null,"48759f87",null),pr=hr.exports,mr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,name:e.name}},[s("small",{staticClass:"help"},[s("p",[e._v("说明："),s("span",[e._v("支持引入多个")]),s("b",[e._v("标签集")]),s("span",[e._v("作为关键词检索；")]),s("span",[e._v("检索范围为")]),s("b",[e._v("<标注文本区>")]),s("span",[e._v("和")]),s("b",[e._v("<标注辅助信息区>；")]),s("span",[e._v("暂仅对")]),s("b",[e._v("“实体词/长文本划词场景”")]),s("span",[e._v("生效，请先在元素标签配置内确认模板场景；")]),s("span",[e._v("更改配置需要保存模板之后才能查看对应效果。")])])]),e.relation.length?[s("List",{staticClass:"list",attrs:{size:"small"}},e._l(e.relation,(function(t,i){return s("ListItem",{key:t.tagset},[s("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("div",{staticClass:"left"},[s("div",{staticClass:"tagset-color",class:!t.color&&"tagset-random-color",style:{backgroundColor:t.color}}),s("div",{staticClass:"tagset-name"},[e._v(e._s(t.tagset))])]),s("div",{staticClass:"right"},[s("Icon",{staticClass:"pointer mlm",attrs:{type:"ios-trash-outline"},on:{click:function(s){return e.onDeleteRelation(t,i)}}}),s("Icon",{staticClass:"pointer mlm",attrs:{type:"ios-create-outline"},on:{click:function(s){return e.onEditRelation(t,i)}}})],1)])],1)})),1),s("Divider",{staticClass:"divider"})]:e._e(),s("Button",{staticClass:"mtm",attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onOpen("new")}}},[e._v("添加标签集")]),s("Modal",{scopedSlots:e._u([{key:"header",fn:function(){return[s("h3",[e._v(e._s("new"===e.modal.type?"新建关键词标签集":"编辑关键词标签集"))])]},proxy:!0},{key:"footer",fn:function(){return[s("Button",{on:{click:e.onClose}},[e._v("取消")]),s("Button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确定")])]},proxy:!0}],null,!1,2562144884),model:{value:e.modal.visible,callback:function(t){e.$set(e.modal,"visible",t)},expression:"modal.visible"}},[s("Form",{ref:"formData",attrs:{model:e.formData,"label-position":"top"}},[s("FormItem",e._b({attrs:{name:"tagset",rules:e.emptyValidator}},"FormItem",e.tagsetProps,!1),[s("Select",{attrs:{"not-found-text":"无匹配数据，请先到模板的标签集配置中添加标签集"},model:{value:e.formData.tagset,callback:function(t){e.$set(e.formData,"tagset",t)},expression:"formData.tagset"}},e._l(e.tagsetOptions,(function(t){return s("Option",e._b({key:t.tagset},"Option",t,!1))})),1)],1),s("FormItem",e._b({attrs:{name:"color",rules:e.emptyValidator}},"FormItem",e.colorProps,!1),[s("ColorPicker",{attrs:{recommend:"",alpha:""},model:{value:e.formData.color,callback:function(t){e.$set(e.formData,"color",t)},expression:"formData.color"}})],1)],1)],1)],2):e._e()},gr=[],br=(s("0f30"),{name:"z-keyword-highlight-config",mixins:[x["a"]],props:{isVisible:{type:Boolean,default:!0}},data(){const e={required:!0,message:"此项必填"};return{selectValue:[],tagset:{},visible:!1,emptyValidator:e,tagsetProps:{label:"标签集",prop:"tagset",rules:e},colorProps:{label:"标签集颜色",prop:"color",rules:e},modal:{visible:!1,type:"new",index:-1},formData:{tagset:"",color:""}}},computed:{relation(){var e;return(null===(e=this.$optimus.formData)||void 0===e?void 0:e.keywordHighlightRelation)||[]},tagsetOptions(){try{return[...Object.keys(this.tagset).map(e=>({label:e,value:e,disabled:this.relation.map(e=>e.tagset).includes(e)}))]}catch(e){return[]}}},mounted(){const{context:e,schema:t}=this.$optimus;this.tagset=e,t.forEach(e=>{Object.hasOwn(this.tagset,e.key)&&this.$delete(this.tagset,e.key)})},methods:{onDeleteRelation(e,t){this.$Modal.confirm({title:"提醒",content:"确定删除该关键词标签集？",onOk:()=>{try{var e,s;null===(e=this.$optimus.formData)||void 0===e||null===(s=e.keywordHighlightRelation)||void 0===s||s.splice(t,1)}catch(i){console.log(i)}}})},onEditRelation(e,t){this.onOpen("edit",e,t)},onSubmit(){const{type:e,index:t}=this.modal;this.$refs.formData.validate(s=>{var i,a;if(s)try{switch(e){case"new":null===(i=this.$optimus.formData)||void 0===i||null===(a=i.keywordHighlightRelation)||void 0===a||a.push({...this.formData});break;case"edit":this.relation&&void 0!==t&&Object.keys(this.relation[t]).forEach(e=>{this.$set(this.$optimus.formData.keywordHighlightRelation[t],e,this.formData[e])})}this.$delete(this.$optimus.formData,"keywordHighlightConfig"),this.onClose()}catch(o){console.log(o)}else this.$Message.error("提交失败，请检查表单是否有遗漏")})},onOpen(e,t,s){this.$set(this,"modal",{visible:!0,type:e||"new",index:void 0!==s?s:-1}),t&&Object.keys(this.formData).forEach(e=>{this.$set(this.formData,e,t[e])})},onClose(){this.$set(this,"modal",{visible:!1,type:"new",index:-1}),this.$refs.formData.resetFields()}}}),fr=br,vr=(s("5e15"),Object(S["a"])(fr,mr,gr,!1,null,"1f895758",null)),yr=vr.exports,wr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,name:e.name}},[s("t-row",{attrs:{justify:"space-between",align:"center"}},[s("small",{staticClass:"help",domProps:{innerHTML:e._s(e.help)}}),s("t-button",{attrs:{size:"small"},on:{click:e.handleAdd}},[e._v("添加")])],1),e._l(e.$optimus.formData[e.name],(function(t,i){return s("t-row",{staticClass:"mtm nowrap",attrs:{justify:"space-between",align:"center"}},[s("t-tooltip",{staticClass:"tooltip",attrs:{content:t.tagset}},[s("span",{staticClass:"color-box",style:{backgroundColor:t.color}}),s("span",{staticClass:"ellipsis"},[e._v(e._s(t.tagset))])]),s("div",{staticStyle:{display:"flex","flex-wrap":"nowrap"}},[s("t-button",{attrs:{size:"small",variant:"text"},on:{click:function(t){return e.handleEdit(i)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"edit-2"}})]},proxy:!0}],null,!0)}),s("t-popconfirm",{attrs:{content:"确认删除吗"},on:{confirm:function(t){return e.handleDelete(i)}}},[s("t-button",{attrs:{size:"small",variant:"text"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"delete"}})]},proxy:!0}],null,!0)})],1)],1)],1)})),s("div",[s("t-dialog",{attrs:{visible:e.modal.visible,header:"new"===e.modal.type?"添加关键词高亮":"编辑关键词高亮"},on:{close:e.handleClose,confirm:e.handleConfirm}},[s("t-form",{ref:"form",staticClass:"mbm",attrs:{data:e.formData,rules:e.rules,"label-align":"top"}},[s("t-form-item",{attrs:{label:"配置关键词",name:"tagset"},scopedSlots:e._u(["固定值"===e.typeMode?{key:"help",fn:function(){return[s("span",[e._v("请输入关键词，多个词之间以")]),s("span",{staticClass:"help"},[e._v("空格")]),s("span",[e._v("分隔")])]},proxy:!0}:null],null,!0)},[s("t-dropdown",{staticClass:"dropdown",attrs:{options:e.options},on:{click:e.updateTypeMode}},[s("t-button",{attrs:{variant:"text",size:"small"},scopedSlots:e._u([{key:"suffix",fn:function(){return[s("t-icon",{attrs:{name:"chevron-down"}})]},proxy:!0}],null,!1,594707762)},[s("span",[e._v(e._s(e.typeMode))])])],1),s("t-textarea",{model:{value:e.formData.tagset,callback:function(t){e.$set(e.formData,"tagset",t)},expression:"formData.tagset"}})],1),s("t-form-item",{attrs:{label:"配置关键词高亮颜色",name:"color"}},[s("t-color-picker",{attrs:{size:"small","enable-alpha":!0,format:"RGBA","color-modes":["monochrome"]},model:{value:e.formData.color,callback:function(t){e.$set(e.formData,"color",t)},expression:"formData.color"}})],1)],1)],1)],1)],2):e._e()},xr=[],Cr={name:"z-mark-config",components:{ExpressionDropdown:R["a"]},mixins:[x["a"]],props:{historyValue:{type:Array}},data(){return{help:"说明：支持添加多个关键词检索，保存后生效。",modal:{visible:!1,type:"new",index:-1},formData:{tagset:"",color:""},rules:{tagset:[{required:!0,message:"请输入关键词"}],color:[{required:!0,message:"请选择高亮颜色"}]},options:[{content:"固定值",value:"固定值"},{content:"表达式",value:"表达式"}],typeMode:"固定值"}},computed:{},mounted(){},created(){var e;!this.historyValue||null!==(e=this.$optimus.formData[this.name])&&void 0!==e&&e.length||(this.$optimus.formData[this.name]=this.historyValue.map(e=>({tagset:`\${input.${e.tagset}}`,color:e.color})),this.$optimus.formData.keywordHighlightRelation=[])},methods:{handleAdd(){this.modal.visible=!0,this.modal.type="new",this.$refs.form.reset()},handleClose(){this.modal.visible=!1},async handleConfirm(){const e=await this.$refs.form.validate();!0===e?("new"===this.modal.type?this.$optimus.formData[this.name].push(Object(a["cloneDeep"])(this.formData)):(this.$optimus.formData[this.name][this.modal.index].color=this.formData.color,this.$optimus.formData[this.name][this.modal.index].tagset=this.formData.tagset),this.modal.visible=!1):this.$message.error("请检查表单填写是否正确")},handleEdit(e){this.typeMode=this.$optimus.formData[this.name][e].tagset.match(/^\$\{.*\}$/)?"表达式":"固定值",this.modal.visible=!0,this.modal.type="edit",this.modal.index=e,this.formData.tagset=this.$optimus.formData[this.name][e].tagset,this.formData.color=this.$optimus.formData[this.name][e].color},handleDelete(e){this.$optimus.formData[this.name].splice(e,1)},updateTypeMode({value:e}){this.typeMode=e,this.formData.tagset="表达式"===e?"${}":""}}},jr=Cr,Or=(s("8393"),Object(S["a"])(jr,wr,xr,!1,null,"0877ffb0",null)),kr=Or.exports,Ar=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{staticClass:"group-select",attrs:{label:e.label,prop:e.name,rules:e.required&&!e.isDisabled?{required:e.required,validator:e.required&&e.validateRequired,trigger:"blur",message:" "}:[]}},[s("Row",{staticClass:"search-icon",attrs:{type:"flex",align:"middle"},nativeOn:{click:function(t){return e.addGroup.apply(null,arguments)}}},[s("Icon",{attrs:{type:"ios-add-circle",size:"18",color:"#2d8cf0"}}),e._v("新增")],1),s("div",{staticClass:"group-container"},e._l(e.groupList,(function(t,i){return s("div",{staticClass:"list"},[s("t-select",{attrs:{multiple:"",disabled:e.isDisabled,transfer:"",filterable:"",options:e.myOptions},model:{value:t.value,callback:function(s){e.$set(t,"value",s)},expression:"item.value"}}),s("Icon",{staticStyle:{cursor:"pointer","margin-left":"10px"},attrs:{type:"ios-trash",size:"20"},on:{click:function(t){return e.deleteGroup(i)}}})],1)})),0),s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}})],2):e._e()},Sr=[],_r={label:"动态分组",icon:"ios-arrow-down",name:"z-group-select",attributes:[{name:"name",label:"字段标识",type:String,value(){return"group-select_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"动态分组"},{name:"required",label:"是否必填",component:"z-switch",type:Boolean,value:!0},{name:"isVisible",label:"是否显示",component:"z-switch",type:Boolean,value:!0},{name:"options",label:"选项",component:"z-options-input",type:String,required:!0,value:""},{name:"value",label:"默认值",component:"z-group-select",type:String,attributes:{isVisible:!1,options:"${output.options}"},required:!1,value:[]}],answerJson:{type:"object",properties:{name:{type:"string"},label:{type:"string"},value:{description:"多选",type:["array","null"]}},required:["name","label"]}},Ir={metadata:_r,components:{multipleSelect:dt,Fitting:B["a"],AISuggest:fe["a"]},mixins:[x["a"]],props:{options:[Array,String]},data(){const e=this.$optimus.formData[this.name];return{groupList:null!==e&&void 0!==e&&e.length?e:[{label:"",value:[]}]}},computed:{isObjectsOption(){return"${optimus.objects}"===this.options},myOptions(){let e=[];if(Object(a["isString"])(this.options)){if(this.isObjectsOption)return this.$optimus.objects.map(e=>({label:this.$optimus.getObjectLabel?""+this.$optimus.getObjectLabel(e):""+e.label,value:e.featureId}));if(""===this.options||this.options.match(/^\${(.+)}$/))return[];try{e=this.options.includes("@_@")?Object(n["q"])(this.options):JSON.parse(this.options)}catch(t){console.info(this.options+" 解析失败")}}else e=this.options;return Object(a["uniqBy"])(e,"value")}},watch:{"$optimus.objects":{handler(){this.isObjectsOption&&this.groupList.forEach(e=>{Object.assign(e,{value:e.value.filter(e=>Object(a["find"])(this.$optimus.objects,t=>e===t.featureId))})})}},groupList:{deep:!0,handler(e){this.$optimus.formData[this.name]=e.filter(e=>e.value.length>0)}}},methods:{addGroup(){this.isDisabled?this.$Notice.warning({title:"当前状态下无法操作哦！"}):this.groupList.unshift({label:"",value:[]})},deleteGroup(e){this.isDisabled?this.$Notice.warning({title:"当前状态下无法操作哦！"}):this.groupList.length>1?this.groupList.splice(e,1):this.$Notice.warning({title:"最后一条不能删除哦！"})},validateRequired(e,t,s){console.log("validateRequired",t),(t.find(e=>0===e.value.length)||0===t.length)&&s(new Error("")),s()}}},$r=Ir,Mr=(s("3eeb"),Object(S["a"])($r,Ar,Sr,!1,null,"59e55cbe",null)),Tr=Mr.exports,Er=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-label-container",style:{height:e.item.height?"100%":"auto"}},[e.isComment?s("text-comment",{key:e.group,ref:"textComment",attrs:{text:e.text,fontFamily:e.fontFamily,currentObject:e.currentObject,$renderedComponentConfig:e.config,defaultStringType:e.defaultStringType,markdownConfig:e.markdownConfig,textPageStepLength:e.textPageStepLength,group:e.group}}):s("text-annotation",{key:e.group,ref:"textAnnotation",attrs:{text:e.text,fontFamily:e.fontFamily,currentObject:e.currentObject,$renderedComponentConfig:e.config,defaultStringType:e.defaultStringType,group:e.group,markdownConfig:e.markdownConfig,highlightKeywords:e.highlightKeywords}})],1)},Lr=[],Dr={label:"文本标注",name:"z-text-stage",repeatable:!0,attributes:[{label:"标注的文本内容",name:"text",type:String,required:!0,value:"",vType:["string"]},{label:"标注的文本字体",name:"fontFamily",type:String,required:!0,value:"默认字体",vType:["string"],component:"z-single-select",attributes:{basicMode:!0,options:[{label:"默认字体",value:"默认字体"},{label:"哈语(ALKATIP Asliya.ttf)",value:"哈语(ALKATIP Asliya.ttf)"},{label:"维语(ALKATIP-Basma-Tom.ttf)",value:"维语(ALKATIP-Basma-Tom.ttf)"},{label:"藏语(microsoft-himalaya.ttf)",value:"藏语(microsoft-himalaya.ttf)"}],exhibit:"dropdown"}},{label:"场景类型",name:"scene",type:String,component:"z-single-select",value:"",vType:["string"],attributes:{options:[{label:"批注",value:"批注"},{label:"实体词",value:"实体词"}]}},{name:"highlightKeywords",label:"文本关键词高亮",value:[],type:Array,component:"z-mark-config",attributes:{historyValue:"${output.isKeywordHighlight?output.keywordHighlightRelation:[]}"}},{label:"Markdown配置",name:"markdownConfig",type:String,value:""},{label:"文本分页字符数（默认5000）",name:"textPageStepLength",type:Number,component:"z-input-number"}],tools:[{type:"text/ner",label:"内容标记",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`text_ner_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]},{type:"text/relationship",label:"内容标记关系",attributes:[{label:"关系名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`text_relationship_${(new Date).getTime()}${Math.floor(100*Math.random())}`}}]}],objectAnswerJson:{description:"文本标注",type:"array",items:{type:"object",properties:{featureId:{type:"string"},type:{type:"string",enum:["text/ner","text/relationship"]},name:{type:"string",enum:[]},label:{description:"可选字段，工具对应的名称",type:"string"},color:{description:"可选字段，工具对应的颜色",type:"string"},tags:{description:"二级标签",type:"array",items:{anyOf:[]}}},if:{properties:{type:{const:"text/ner"}}},then:{properties:{data:{description:"实体词",type:"object",properties:{location:{type:"object",properties:{startIndex:{description:"必须字段，起始位置",type:"integer"},endIndex:{description:"必须字段，结束位置",type:"integer"}},required:["startIndex","endIndex"]},text:{description:"非必需字段，文字内容",type:"string"}},required:["location"]}}},else:{properties:{data:{description:"实体词关系",type:"object",properties:{startFeatureId:{description:"必须字段，起始id",type:"string"},endFeatureId:{description:"必须字段，结束id",type:"string"}},required:["startFeatureId","endFeatureId"]}}},required:["featureId","type","name","label","data","tags"]}}},Pr={...Dr,label:"文本实体词标注",name:"z-text-tool",type:"container_component",scene:"文本"},Br=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"web-viewer"},[e.toolList.length>0?s("div",{staticClass:"tools"},[s("Input",{attrs:{placeholder:"输入关键词搜索工具"},model:{value:e.toolSearchVal,callback:function(t){e.toolSearchVal=t},expression:"toolSearchVal"}}),s("div",{staticClass:"content",staticStyle:{"margin-top":"10px"}},[s("RadioGroup",{staticClass:"toolGroup",attrs:{vertical:!1},model:{value:e.currentToolName,callback:function(t){e.currentToolName=t},expression:"currentToolName"}},[e._l(e.toolShowLists,(function(t,i){return["text/ner"===t.type?s("Radio",{key:t.name,attrs:{label:t.name,disabled:e.radioDisabled}},[s("span",{attrs:{title:t.label}},[e._v(e._s(t.label))]),s("div",{staticClass:"color",style:{backgroundColor:t.color}})]):e._e()]}))],2)],1)],1):e._e(),s("div",{staticStyle:{flex:"1",position:"relative",width:"0"}},["markdown"===e.stringType&&e.toolList.length>0?s("Alert",{staticClass:"alert",attrs:{"show-icon":""}},[e._v("markdown格式下暂不支持操作/查看标注")]):e._e(),s("Row",{staticClass:"operations"},[e.highlightKeywords.length>0?s("t-space",{attrs:{size:"4px"}},[s("span",[e._v("高亮")]),s("t-switch",{attrs:{size:"small"},on:{change:e.handleHighlight},model:{value:e.highlightEnabled,callback:function(t){e.highlightEnabled=t},expression:"highlightEnabled"}})],1):e._e(),"text"===e.stringType?s("TextFont",{attrs:{fontSize:e.fontSize},on:{"update:fontSize":function(t){e.fontSize=t},"update:font-size":function(t){e.fontSize=t}}}):e._e(),s("RadioGroup",{staticStyle:{display:"flex"},attrs:{type:"button",size:"small"},model:{value:e.stringType,callback:function(t){e.stringType=t},expression:"stringType"}},[s("Radio",{attrs:{label:"markdown"}},[e._v("MD")]),s("Radio",{attrs:{label:"text"}})],1),s("copyBtn",{attrs:{text:e.text}})],1),e.toolList.length>0?[s("div",{directives:[{name:"show",rawName:"v-show",value:"markdown"===e.stringType,expression:"stringType==='markdown'"}],staticClass:"mark_content"},[s("CherryMarkdown",{staticClass:"markdown",class:"font-size"+e.fontSize,attrs:{content:e.text,name:e.group,markdownConfig:e.markdownConfig}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"markdown"!==e.stringType,expression:"stringType!=='markdown'"}],ref:"mark_content",staticClass:"mark_content",attrs:{id:"mark_content_"+e.group},on:{mouseup:e.handleSelectMouseUp}})]:"html"===e.stringType?s("div",{staticClass:"mark_content_text",class:"font-size"+e.fontSize,domProps:{innerHTML:e._s(e.text)}}):"markdown"===e.stringType?s("div",{staticClass:"mark_content_text",class:"font-size"+e.fontSize},[s("CherryMarkdown",{staticClass:"markdown",class:"font-size"+e.fontSize,attrs:{content:e.text,name:e.group,markdownConfig:e.markdownConfig}})],1):s("div",{staticClass:"mark_content_text text-render-container",class:"font-size"+e.fontSize,domProps:{textContent:e._s(e.text)}}),s("Modal",{attrs:{width:508,closable:!1,draggable:"",sticky:"",scrollable:"",mask:!1},model:{value:e.objectModal.showSelectMarkModel,callback:function(t){e.$set(e.objectModal,"showSelectMarkModel",t)},expression:"objectModal.showSelectMarkModel"}},[s("div",{attrs:{slot:"header"},slot:"header"},["text/ner_default"===e.currentTool.name?[s("span",[e._v("（请选择标注工具）")])]:s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("div",{staticClass:"color",style:{backgroundColor:e.currentTool.color}}),s("b",[e._v(e._s(e.currentTool.label))]),s("Col",{attrs:{flex:"auto"}},[e.currentTool.wordCount?s("div",{staticClass:"word-count"},[e._v("字数："+e._s(e.selectWords.length))]):e._e()])],1),s("Row",{staticClass:"mtm",staticStyle:{"line-height":"normal"},attrs:{align:"middle"}},[s("Col",[e._v(e._s(e.selectWords))])],1)],2),s("div",{staticClass:"modal-content",staticStyle:{"max-height":"500px","overflow-y":"auto"}},[[s("Form",{attrs:{"label-position":"top"}},[e.currentTool.searchTool?s("FormItem",{attrs:{label:"搜索引擎"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("搜索引擎")]),s("div",{staticClass:"tips",staticStyle:{display:"inline-block",color:"red",padding:"0 10px"}},[e._v(" 此项为快捷搜索引擎（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.search},model:{value:e.objectModal.searchVal,callback:function(t){e.$set(e.objectModal,"searchVal",t)},expression:"objectModal.searchVal"}},e._l(e.searchOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e(),e.currentTool.translateTool?s("FormItem",{attrs:{label:"翻译工具"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("翻译工具")]),s("div",{staticClass:"tips",staticStyle:{display:"inline-block",color:"red",padding:"0 10px"}},[e._v(" 此项为快捷翻译工具（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.translate},model:{value:e.objectModal.translateVal,callback:function(t){e.$set(e.objectModal,"translateVal",t)},expression:"objectModal.translateVal"}},e._l(e.translateOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e()],1),e.objectModal.showSelectMarkModel?s("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.objectModal.editAnswer[e.currentToolName],disabled:e.$optimus.disabled}}):e._e()]],2),s("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:e.handleLabelUpdateCancel}},[e._v("取消")]),s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.handleLabelUpdate}},[e._v("确认")])],1)]),s("Modal",{attrs:{closable:!1,draggable:"",sticky:"",scrollable:"",mask:!1},model:{value:e.showConnectMarkModel,callback:function(t){e.showConnectMarkModel=t},expression:"showConnectMarkModel"}},[s("div",{staticClass:"modal-title",attrs:{slot:"header"},slot:"header"},[s("span",{staticStyle:{"font-weight":"500","font-size":"16px",color:"#17233d"}},[e._v("请选择实体关系")])]),s("div",{staticClass:"modal-content",staticStyle:{"max-height":"500px","overflow-y":"auto"}},[s("div",{staticClass:"label-items"},e._l(e.currentConnectionWithLabels(),(function(t){return s("div",{key:t.startWith,staticClass:"label-item",style:{color:t.color||"#000000"},attrs:{title:t.data&&t.data.text}},[e._v(e._s(t.startWith)+e._s(t.data&&t.data.text))])})),0),s("RadioGroup",{staticClass:"toolGroup",attrs:{vertical:!1},model:{value:e.currentConnectionCategoryId,callback:function(t){e.currentConnectionCategoryId=t},expression:"currentConnectionCategoryId"}},e._l(e.connectionCategories,(function(t){return s("Radio",{key:t.id,attrs:{label:t.id,disabled:e.$optimus.disabled}},[s("span",[e._v(e._s(t.text))])])})),1)],1),s("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:e.handleConnectionUpdateCancel}},[e._v("取消")]),s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.handleConnectionUpdate}},[e._v("确认")])],1)])],2)])},Rr=[],zr=s("f323"),Nr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Dropdown",{staticClass:"select",attrs:{trigger:"click"},on:{"on-click":e.handleSelectSize}},[s("p",[e._v("字号: "+e._s(e.fontSize)+"px"),s("Icon",{attrs:{type:"ios-arrow-down"}})],1),s("DropdownMenu",{staticClass:"select-content",attrs:{slot:"list"},slot:"list"},e._l(e.fontSizeList,(function(t){return s("DropdownItem",{key:t,staticClass:"select-option",attrs:{selected:e.fontSize===t,name:t}},[e._v(e._s(t)+"px")])})),1)],1)},Fr=[],Vr={name:"TextFont",props:{fontSize:{type:Number,default:14}},data(){return{fontSizeList:[8,10,12,14,16,18,24,30]}},mounted(){},created(){const e=localStorage.getItem("optimus-text-stage-fontsize")||14;this.handleSelectSize(Number(e))},methods:{handleSelectSize(e){localStorage.setItem("optimus-text-stage-fontsize",e),this.$emit("update:fontSize",e)}}},qr=Vr,Hr=(s("91a2"),Object(S["a"])(qr,Nr,Fr,!1,null,"551605f0",null)),Wr=Hr.exports,Ur=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.content?s("div",{staticClass:"cherry-container"},[e.chunks.length>1?s("t-row",{staticStyle:{"justify-content":"flex-end"}},[s("t-pagination",{staticStyle:{width:"auto"},attrs:{size:"small",theme:"simple",total:e.chunks.length,"show-page-size":!1,"default-page-size":1,"total-content":!1},on:{change:e.handlePageChange},model:{value:e.chunkIndex,callback:function(t){e.chunkIndex=t},expression:"chunkIndex"}}),s("CopyBtn",{attrs:{content:e.currentText}})],1):e._e(),s("div",{staticClass:"cherry-markdown",attrs:{id:""+e.markdownID}}),e.chunks.length>1?s("t-pagination",{attrs:{size:"small",theme:"simple",total:e.chunks.length,"show-page-size":!1,"default-page-size":1,"total-content":!1},on:{change:e.handlePageChange},model:{value:e.chunkIndex,callback:function(t){e.chunkIndex=t},expression:"chunkIndex"}}):e._e()],1):e._e()},Qr=[],Jr=s("a410"),Gr=s.n(Jr),Kr=(s("5fbc"),s("8dc3")),Yr={components:{CopyBtn:Kr["a"]},props:{content:String,name:{String:String,default:""},markdownConfig:String},data(){return{cherryIns:"",markdownID:"",chunkIndex:1}},computed:{mdConfig(){if(this.markdownConfig)try{return Object(a["isString"])(this.markdownConfig)?JSON.parse(this.markdownConfig):this.markdownConfig}catch(e){return{}}return{}},chunks(){return this.mdConfig.page?this.splitMarkdown(this.content,this.mdConfig.pageSize):[this.content]},currentText(){return this.chunks.length?this.chunks[this.chunkIndex-1]:""}},mounted(){this.markdownID=`cherry-markdown-${this.name}-${Object(Ve["a"])()}`,this.$nextTick(()=>{this.currentText&&this.initCherryMD()})},destroyed(){this.cherryIns&&this.cherryIns.destroy(),this.$nextTick(()=>{var e;null===(e=document.getElementById(this.markdownID))||void 0===e||e.remove()})},methods:{initCherryMD(){const e=Gr.a.createSyntaxHook("ref",Gr.a.constants.HOOKS_TYPE_LIST.SEN,{makeHtml(e){return e.replace(this.RULE.reg,(e,t)=>{const s=t.split(",").map(e=>`<span class="sup">${e.trim()}</span>`);return s.join("")})},rule(){return{reg:/\[([\d\s*,]+)\]\(@ref\)/g}}}),t={externals:{katex:window.katex,MathJax:window.MathJax},toolbars:{toc:{updateLocationHash:!1}},engine:{global:{htmlBlackList:!1===this.mdConfig.html?"*":""},syntax:{mathBlock:{engine:"MathJax",plugins:!0},inlineMath:{engine:"MathJax"},header:{anchorStyle:"none"},link:{target:"_blank"},fontEmphasis:{allowWhitespace:!0},frontMatter:!1},customSyntax:{importHook:{syntaxClass:e,before:"link"}}}},s=Object(a["merge"])(t,this.mdConfig);this.cherryIns=new Gr.a({id:""+this.markdownID,value:this.currentText,editor:{defaultModel:"previewOnly"},...s})},handlePageChange(){this.cherryIns.setMarkdown(this.currentText)},splitMarkdown(e,t=1e5){const s=[];let i="",a=!1;return e.split("\n").forEach(e=>{e.includes("$$")&&(a=!a),i.length+e.length>t&&!a&&i&&(s.push(i),i=""),i+=(i?"\n":"")+e}),i&&s.push(i),s}}},Zr=Yr,Xr=(s("da81"),Object(S["a"])(Zr,Ur,Qr,!1,null,"4f042dc8",null)),el=Xr.exports,tl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.content?s("div",{staticClass:"markdown-body",domProps:{innerHTML:e._s(e.html)}}):e._e()},sl=[],il=s("83cc"),al=s.n(il),ol=s("3d94"),nl=s.n(ol),rl=s("5e96"),ll=s.n(rl),cl=(s("ee72"),s("68b1"),s("7466"),s("a8ae")),dl=s.n(cl),ul={props:{content:String,markdownConfig:String},data(){return{html:"",md:void 0,defaultConfig:{html:!0}}},computed:{mdConfig(){if(this.markdownConfig)try{return Object(a["isString"])(this.markdownConfig)?JSON.parse(this.markdownConfig):this.markdownConfig}catch(e){return{}}return{}}},mounted(){const e={...this.defaultConfig,...this.mdConfig},t=new nl.a({html:e.html,breaks:!0,highlight:(e,t)=>{if(!["xml","html"].includes(t)&&al.a.getLanguage(t))try{const s=al.a.highlight(e,{language:t,ignoreIllegals:!0}).value,i=new RegExp("&lt;response\\|([\\s\\S]*?)\\|response&gt;","g");return s.replace(i,(e,t)=>`<span style="color: red"><strong>${t}</strong></span>`)}catch(s){return""}return""}});t.use(dl.a),t.renderer.rules.ref_open=()=>'<span class="ref-list">',t.renderer.rules.ref_item=(e,s)=>{const i=t.utils.escapeHtml(e[s].content);return`<span class="ref">${i}</span>`},t.renderer.rules.ref_close=()=>"</span>";const s=(e,t)=>{const s=e[t];if(["math_inline","math_block"].includes(s.type)){const e=Object(n["l"])(s.content);try{const t=ll.a.renderToString(e,{displayMode:"math_block"===s.type});return"math_block"===s.type?`<div>${t}</div>`:t}catch(i){const t=ll.a.renderToString(e,{throwOnError:!1,displayMode:!0});return`<span class="katex-${"math_block"===s.type?"block":"inline"}">${t}</span>`}}return s.content};t.renderer.rules.math_inline=s,t.renderer.rules.math_block=s;const i=t.renderer.rules.link_open||((e,t,s,i,a)=>a.renderToken(e,t,s)),a=(e,t,s,a,o)=>{const n=e[t].attrIndex("target");return n<0&&(e[t].attrPush(["target","_blank"]),e[t].attrPush(["rel","noopener noreferrer"])),i(e,t,s,a,o)};t.renderer.rules.link_open=a,this.html=t.render(Object(n["c"])(this.content))}},hl=ul,pl=(s("e69a"),Object(S["a"])(hl,tl,sl,!1,null,null,null)),ml=pl.exports,gl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.text,expression:"text",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:function(){return e.$Message.success("已复制到剪贴板")},expression:"() => $Message.success('已复制到剪贴板')",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:function(){return e.$Message.error("复制失败")},expression:"() => $Message.error('复制失败')",arg:"error"}],staticClass:"icon-btn"},[s("Icon",{attrs:{type:"md-copy",size:16}}),e.showText?s("div",{staticClass:"icon-btn-content"},[e._v("复制")]):e._e()],1)},bl=[],fl={props:{text:String,showText:{type:Boolean,default:!1}}},vl=fl,yl=(s("6eba"),s("17e7"),Object(S["a"])(vl,gl,bl,!1,null,"ed0ce41a",null)),wl=yl.exports;class xl{constructor(e,t){this.el=e,this.id=(new Date).getTime().toString()+Math.random().toString(36).substring(2),this.preprocessKeywords(t)}preprocessKeywords(e){this.keywords=e.map(e=>{const{tagset:t,color:s}=e;let i;if(Object(a["isString"])(t))try{i=JSON.parse(t).map(e=>e.value||e)}catch(o){i=t.split(" ")}else i=t.map(e=>e.value||e).filter(e=>!!e);return{tagset:i,color:s}})}getTextNodes(){const e=[],t=document.createTreeWalker(this.el,NodeFilter.SHOW_TEXT);let s=t.nextNode();while(s)e.push(s),s=t.nextNode();return e}highlight(){if(!CSS.highlights)return void console.warn("浏览器不支持 CSS Custom Highlight API");const e=this.getTextNodes();this.keywords.forEach(({tagset:t,color:s},i)=>{const a=[];if(t.forEach(t=>{const s=t.toLowerCase();e.forEach(e=>{const t=e.textContent.toLowerCase();let i=0;while(i<t.length){const o=t.indexOf(s,i);if(-1===o)break;const n=new Range;n.setStart(e,o),n.setEnd(e,o+s.length),a.push(n),i=o+s.length}})}),a.length>0){const e=new Highlight(...a);CSS.highlights.set(`highlight_${this.id}_${i}`,e)}const o=`highlight-style-${this.id}-${i}`;let n=document.getElementById(o);n||(n=document.createElement("style"),n.id=o,this.el.appendChild(n)),n.textContent=`\n        ::highlight(highlight_${this.id}_${i}) {\n          background-color: ${s};\n        }\n      `})}updatedKeywords(e){this.keywords=this.preprocessKeywords(e),this.highlight()}clear(){document.querySelectorAll(`style[id^="highlight-style-${this.id}-"]`).forEach(e=>{e.remove()})}}var Cl=xl,jl={components:{TextFont:Wr,copyBtn:wl,CherryMarkdown:el,Markdown:ml},directives:{highlight:{inserted(e){const t=e.querySelectorAll("pre code");t.forEach(e=>{Highlight.highlightBlock(e)})}}},mixins:[Re["a"]],props:{text:{type:[String,Number],default:""},currentObject:{type:Object,default:null},group:{type:String,default:""},defaultStringType:{type:String,default:"text"},markdownConfig:String,highlightKeywords:{type:Array,default:()=>[]}},data(){return{commonLabelCategories:[],startIndex:0,endIndex:0,selectWords:"",labelIdMap:{},connectionIdMap:{},objectModal:{showSelectMarkModel:!1,searchVal:"",editAnswer:{}},markPosition:{top:"",left:"",margin:"0"},stringType:this.defaultStringType,currentToolName:"",toolSearchVal:"",annotator:null,action:"add",fromId:"",toId:"",showConnectMarkModel:!1,currentConnectionCategoryId:"",isConnectUpdate:!1,connectUpdateId:null,objects:this.$optimus.objects,searchOption:n["s"],translateOption:n["u"],fontSize:14,textHighlighter:null,highlightEnabled:!0}},computed:{getContent(){return this.text.toString().replace(/&/g,"＆").replace(/</g,"＜").replace(/>/g,"＞").replace(/(?<=[0-9]|[a-zA-Z]|[\u4e00-\u9fa5])\n(?=[0-9]|[a-zA-Z]|[\u4e00-\u9fa5])/g,"↵")},toolShowLists(){return this.toolList.filter(e=>e.label.includes(this.toolSearchVal))},componentConfig(){const e=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return!t||("all"===t||t===this.currentToolName)});return{component:"z-form-stage",items:e}},toolList(){return this.$renderedComponentConfig.$object_tools},toolListWithDefault(){return this.isToolSelected?this.$renderedComponentConfig.$object_tools:[{color:"#c2c2c2",label:"请选择标注工具",name:"text/ner_default",type:"text/ner"},...this.$renderedComponentConfig.$object_tools]},isToolSelected(){var e,t,s,i;return Object(a["isUndefined"])(null===(e=this.$renderedComponentConfig)||void 0===e||null===(t=e.extra_attributes)||void 0===t?void 0:t.isToolSelected)||(null===(s=this.$renderedComponentConfig)||void 0===s||null===(i=s.extra_attributes)||void 0===i?void 0:i.isToolSelected)},connectionCategories(){return Object(a["cloneDeep"])(this.toolListWithDefault).filter(e=>"text/relationship"===e.type).map(e=>({id:e.name,text:e.label}))},currentTool(){return this.currentToolName&&this.toolList&&0!==this.toolList.length?Object(a["find"])(this.toolListWithDefault,{name:this.currentToolName}):{}},currentConnectionCategory(){return this.currentConnectionCategoryId&&this.connectionCategories&&0!==this.connectionCategories.length?Object(a["find"])(this.toolListWithDefault,{name:this.currentConnectionCategoryId}):{}},radioDisabled(){return this.$optimus.disabled||!this.isToolSelected&&!this.objectModal.showSelectMarkModel}},watch:{fontSize:{deep:!0,handler(e){e&&this.renderByObjects()}},"currentObject.featureId":{immediate:!0,deep:!0,handler(e){e&&this.renderByObjects()}}},mounted(){var e,t;this.textHighlighter=new Cl(this.$el,this.highlightKeywords),this.handleHighlight(this.highlightEnabled),null===(e=this.$refs.mark_content)||void 0===e||e.addEventListener("scroll",this.handleScroll,!0),this.$on("delete-object",e=>{this.removeItem(e)}),this.$optimus.$on("optimus:text-stage:edit-object",e=>{this.editObject(e)});const s=null===(t=this.toolListWithDefault)||void 0===t?void 0:t.filter(e=>"text/ner"===e.type);s&&s.length&&(s.forEach((e,t)=>{0===t&&(this.currentToolName=e.name);const{translateOpacity:s}=n["b"],i=s(e.color,.3),a={id:e.name,text:e.label,color:i,borderColor:i},o={id:e.name+"-selected",text:e.label,color:e.color,borderColor:"rgb(0,0,0)"};this.commonLabelCategories.push(a),this.commonLabelCategories.push(o)}),this.renderByObjects(),this.$optimus.$on("default-stage:highlight-change",e=>{this.highlightEnabled=e,this.handleHighlight(e)}))},destroy(){var e;null===(e=this.$refs.mark_content)||void 0===e||e.removeEventListener("scroll",this.handleScroll),sessionStorage.removeItem("scroll")},methods:{handleHighlight(e){e?this.$nextTick(()=>{this.textHighlighter.highlight(this.highlightKeywords)}):this.textHighlighter.clear()},handleScroll(e){sessionStorage.setItem("scroll",e.target.scrollTop)},handleTextSelected(e,t){const{annotator:s}=this,{content:i}=s.store.json;if(this.startIndex=e,this.endIndex=t,this.selectWords=i.slice(e,t),!(this.selectWords.indexOf("\n")>-1))return this.isToolSelected?void(this.componentConfig.items&&this.componentConfig.items.length>0?(this.objectModal.showSelectMarkModel=!0,this.showConnectMarkModel=!1,this.objectModal.editAnswer={},this.action="add"):(this.addObject([]),(this.currentTool.translateTool||this.currentTool.searchTool)&&(this.objectModal.showSelectMarkModel=!0,this.action="update"))):(this.addObject([]),this.objectModal.showSelectMarkModel=!0,this.showConnectMarkModel=!1,this.objectModal.editAnswer={},void(this.action="add"));this.$Message.warning({content:"划词含有换行符，请分段标注!",duration:3})},handleSelectMouseUp(){const e=window.getSelection();if(e.toString().length>0&&Object(n["i"])()){const{startIndex:e,endIndex:t}=Object(n["i"])();this.handleTextSelected(e,t)}},handleEventListener(){const{annotator:e}=this;e.on("labelDoubleClicked",e=>{const t=Object.keys(this.labelIdMap).find(t=>this.labelIdMap[t]===e),s=this.objects.find(e=>e.featureId===t);this.editObject(s)}),e.on("connectionDoubleClicked",e=>{const t=Object.keys(this.connectionIdMap).find(t=>this.connectionIdMap[t]===e),s=this.objects.find(e=>e.featureId===t),{startFeatureId:i,endFeatureId:a}=s.data||{};this.fromId=this.labelIdMap[i],this.toId=this.labelIdMap[a],this.editObject(s)}),this.$optimus.disabled||(e.on("textSelected",(e,t)=>{this.handleTextSelected(e,t)}),e.on("labelRightClicked",e=>{const t=Object.keys(this.labelIdMap).find(t=>this.labelIdMap[t]===e);this.$Modal.confirm({title:"确定要删除当前标签？",content:t,onOk:()=>{this.$emit("delete-object",t)}})}),e.on("connectionRightClicked",e=>{const t=Object.keys(this.connectionIdMap).find(t=>this.connectionIdMap[t]===e);this.$Modal.confirm({title:"确定要删除当前实体词关系？",content:t,onOk:()=>{this.$emit("delete-object",t)}})}),e.on("twoLabelsClicked",(e,t)=>{e!==t&&(this.fromId=e,this.toId=t,1===this.connectionCategories.length?(this.currentConnectionCategoryId=this.connectionCategories[0].id,this.handleConnectionUpdate()):this.connectionCategories.length>1&&(this.action="add",this.showConnectMarkModel=!0,this.objectModal.showSelectMarkModel=!1,this.currentConnectionCategoryId||(this.currentConnectionCategoryId=this.connectionCategories[0].id)))}))},hasSameRelationship(e,t){return this.objects.some(s=>{if("text/relationship"===s.type){const i=Object.keys(this.labelIdMap).find(t=>this.labelIdMap[t]===e),a=Object.keys(this.labelIdMap).find(e=>this.labelIdMap[e]===t);if(s.data.startFeatureId===i&&s.data.endFeatureId===a&&s.name===this.currentConnectionCategoryId)return!0}return!1})},addObject(e){this.group&&this.$EventBus.$emit("default-stage-item-click",this.group,this.$optimus.$attrs.name);const{type:t,color:s,name:i,label:a,wordCount:o}=this.currentTool,r={location:{startIndex:this.startIndex,endIndex:this.endIndex},text:this.selectWords};this.group&&(r.group=this.group),o&&(r.textLength=this.selectWords.length);const l={type:t,featureId:"feature-"+Object(n["j"])(8),label:a,name:i,color:s,tags:e,data:r};this.isExistSameObject(l)?this.$Message.warning({content:"当前位置已存在相同实体词！",duration:3}):(this.objects.push(l),this.$optimus.$emit("optimus:text-stage:selectObj",l,this.group))},isExistSameObject(e){return this.objects.find(t=>{var s;const{startIndex:i,endIndex:a}=e.data.location||{},{startIndex:o,endIndex:n}=(null===(s=t.data)||void 0===s?void 0:s.location)||{};return"text/ner"===t.type&&i===o&&a===n&&e.name===t.name&&e.featureId!==t.featureId})},getLabelCategoryTextByTags(e){let t="";return this.$renderedComponentConfig.$object_items.forEach(s=>{s.isShow&&e.tags.forEach(e=>{if(e.name===s.attributes.name&&e.value){const s=Object(a["isArray"])(e.value)?e.value.join(",").trim():e.value.trim();t=t?`${t}/${s}`:s}})}),t},removeAnnotatorLabel(e){delete this.labelIdMap[e.featureId],Object(a["cloneDeep"])(this.objects).forEach(t=>{"text/relationship"!==t.type||e.featureId!==t.data.startFeatureId&&e.featureId!==t.data.endFeatureId||this.removeItem(t.featureId)})},removeRelationship(e){delete this.connectionIdMap[e.featureId]},editObject(e){const{type:t,name:s,tags:i,data:a}=e;this.$optimus.$emit("optimus:text-stage:selectObj",e,this.group),e.tags.length&&(this.action="update","text/ner"===t?(this.objectModal.editAnswer={},this.objectModal.editAnswer[s]={tags:i},this.objectModal.showSelectMarkModel=!0,this.showConnectMarkModel=!1,this.selectWords=a.text,this.currentToolName=s):"text/relationship"===t&&(this.showConnectMarkModel=!0,this.objectModal.showSelectMarkModel=!1,this.currentConnectionCategoryId=s))},removeItem(e){const t=this.objects.find(t=>t.featureId===e);this.objects.splice(Object(a["findIndex"])(this.objects,{featureId:e}),1),"text/ner"===(null===t||void 0===t?void 0:t.type)?(this.removeAnnotatorLabel(t),this.handleLabelUpdateCancel()):"text/relationship"===(null===t||void 0===t?void 0:t.type)&&(this.removeRelationship(t),this.handleConnectionUpdateCancel()),this.$optimus.$emit("optimus:text-stage:selectObj",null,this.group),this.renderByObjects()},renderByObjects(){if("markdown"===this.stringType)return;if(0===this.toolList.length)return;const e=Object(a["cloneDeep"])(this.commonLabelCategories),t=[],s=[];this.objects.forEach(i=>{if(!this.group||i.data.group===this.group)if("text/ner"===i.type){const s=this.getLabelCategoryTextByTags(i),{translateOpacity:a}=n["b"],o=a(i.color,.3),r={id:i.name,color:o,borderColor:o},l={id:i.name+"-selected",color:i.color,borderColor:"rgb(0,0,0)"};s&&(r.id=i.featureId,r.text=s,l.id=i.featureId+"-selected",l.text=s,e.push(r),e.push(l));const c={startIndex:i.data.location.startIndex,endIndex:i.data.location.endIndex,featureId:i.featureId,categoryId:r.id};t.push(c)}else"text/relationship"===i.type&&s.push({featureId:i.featureId,categoryId:i.name,fromId:i.data.startFeatureId,toId:i.data.endFeatureId})});const i={content:this.getContent,labelCategories:e,labels:[],connectionCategories:this.connectionCategories,connections:[]};this.$nextTick(()=>{const e={contentEditable:!1,allowMultipleLabel:"allowed",allowMultipleConnection:"allowed",contentClasses:["poplar-annotation-content","font-size"+this.fontSize]};if((this.connectionCategories.length<=0||this.$optimus.disabled)&&(e.unconnectedLineStyle="none"),this.annotator&&(this.annotator.remove(),this.annotator=null),!this.$refs.mark_content)return;this.annotator=new zr["Annotator"](JSON.stringify(i),this.$refs.mark_content,e);const{store:{labelRepo:a,connectionRepo:o}}=this.annotator;t.forEach(e=>{var t,s,i;const{categoryId:o,featureId:n,startIndex:r,endIndex:l}=e,c=a.nextId;let d=o;"text/ner"===(null===(t=this.currentObject)||void 0===t?void 0:t.type)&&n===(null===(s=this.currentObject)||void 0===s?void 0:s.featureId)&&(d=o+"-selected"),"text/relationship"===(null===(i=this.currentObject)||void 0===i?void 0:i.type)&&Object.values(this.currentObject.data).includes(n)&&(d=o+"-selected"),this.annotator.applyAction(zr["Action"].Label.Create(d,r,l)),this.labelIdMap[n]=c}),s.forEach(e=>{const t=o.nextId;e.fromId&&e.toId&&this.annotator.applyAction(zr["Action"].Connection.Create(e.categoryId,this.labelIdMap[e.fromId],this.labelIdMap[e.toId])),this.connectionIdMap[e.featureId]=t}),this.handleEventListener(this.annotator),sessionStorage.getItem("scroll")&&(this.$refs.mark_content.scrollTop=sessionStorage.getItem("scroll"))}),this.handleHighlight(this.highlightEnabled)},handleLabelUpdate(){const{object:e,object:{tags:t}}=this.$refs,s=this.objects.find(e=>{var t;return e.featureId===(null===(t=this.currentObject)||void 0===t?void 0:t.featureId)});if(e.validate(),e.isValid)if("text/ner_default"!==this.currentToolName){if("update"===this.action){const{color:e,name:i,label:o}=this.currentTool,n=Object(a["cloneDeep"])(s);if(this.isExistSameObject({...n,name:i}))return void this.$Message.warning({content:"当前位置已存在相同实体词！",duration:3});s.tags=t,s.name=i,s.label=o,s.color=e,this.renderByObjects()}else this.addObject(t);this.handleLabelUpdateCancel()}else this.$Message.error("请选择标注工具!");else this.$Notice.error({title:"",desc:"",render:e=>e("span",["请完善必填项 "])})},handleLabelUpdateCancel(){if(this.objectModal.showSelectMarkModel=!1,this.action="add",this.objectModal.searchVal="",this.objectModal.selectWords="",!this.isToolSelected){var e;this.currentToolName="text/ner_default";const t=null===(e=this.objects.find(e=>"text/ner_default"===e.name))||void 0===e?void 0:e.featureId;t&&this.removeItem(t)}},handleConnectionUpdate(){if(this.hasSameRelationship(this.fromId,this.toId))return this.$Message.warning({content:"当前选中的两个标签已存在相同关系！",duration:3}),void this.handleConnectionUpdateCancel();const e=this.objects.find(e=>{var t;return e.featureId===(null===(t=this.currentObject)||void 0===t?void 0:t.featureId)});if("update"===this.action){const{name:t,label:s}=this.currentConnectionCategory;e.name=t,e.label=s,this.renderByObjects()}else{const{type:e,name:t,label:s}=this.currentConnectionCategory,i=Object.keys(this.labelIdMap).find(e=>this.labelIdMap[e]===this.fromId),a=Object.keys(this.labelIdMap).find(e=>this.labelIdMap[e]===this.toId);if(!i||!a)return void this.handleConnectionUpdateCancel();const o={startFeatureId:i,endFeatureId:a},r={type:e,featureId:"feature-"+Object(n["j"])(8),label:s,name:t,tags:[],data:o};this.objects.push(r),this.$optimus.$emit("optimus:text-stage:selectObj",r,this.group),this.showConnectMarkModel=!1,this.action="add"}this.handleConnectionUpdateCancel()},handleConnectionUpdateCancel(){this.showConnectMarkModel=!1,this.action="add"},search(e){Object(n["r"])(e,this.selectWords),this.$nextTick(()=>{this.objectModal.searchVal=""})},translate(e){Object(n["t"])(e,this.selectWords),this.$nextTick(()=>{this.objectModal.translateVal=""})},currentConnectionWithLabels(){let[e,t]=["",""];var s,i,a,o;"add"===this.action?(e=Object.keys(this.labelIdMap).find(e=>this.labelIdMap[e]===this.fromId),t=Object.keys(this.labelIdMap).find(e=>this.labelIdMap[e]===this.toId)):(e=null===(s=this.currentObject)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.startFeatureId,t=null===(a=this.currentObject)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.endFeatureId);const n=this.objects.find(t=>t.featureId===e)||{},r=this.objects.find(e=>e.featureId===t)||{};return[{...n,startWith:"实体（首）："},{...r,startWith:"实体（尾）："}]}}},Ol=jl,kl=(s("0d8d"),s("8841"),Object(S["a"])(Ol,Br,Rr,!1,null,"dfd9bae6",null)),Al=kl.exports,Sl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"web-viewer"},[s("text-comment-tools",{attrs:{currentToolName:e.currentToolName,toolList:e.toolList},on:{"update:currentToolName":function(t){e.currentToolName=t},"update:current-tool-name":function(t){e.currentToolName=t}}}),s("div",{staticClass:"text-container"},[s("Row",{staticClass:"operations"},["markdown"===e.stringType&&e.toolList.length>0?s("Alert",{staticClass:"alert",attrs:{"show-icon":""}},[e._v("markdown格式下暂不支持操作/查看标注")]):e._e(),"text"===e.stringType?s("TextFont",{attrs:{fontSize:e.fontSize},on:{"update:fontSize":function(t){e.fontSize=t},"update:font-size":function(t){e.fontSize=t}}}):e._e(),s("RadioGroup",{staticStyle:{display:"flex"},attrs:{type:"button",size:"small"},model:{value:e.stringType,callback:function(t){e.stringType=t},expression:"stringType"}},[s("Radio",{attrs:{label:"markdown"}},[e._v("MD")]),s("Radio",{attrs:{label:"text"}})],1),s("copyBtn",{attrs:{text:e.text}})],1),s("div",{staticClass:"comment-content"},["markdown"===e.stringType?s("cherryMarkdown",{staticClass:"markdown",attrs:{content:e.text,name:e.group,markdownConfig:e.markdownConfig}}):e._e(),s("text-comment-content",{directives:[{name:"show",rawName:"v-show",value:"text"===e.stringType,expression:"stringType === 'text'"}],ref:"textCommentContent",attrs:{currentToolName:e.currentToolName,toolList:e.toolList,text:e.text,currentObject:e.currentObject,textSelectedData:e.textSelectedData,objectsCollection:e.objectsCollection,fontSize:e.fontSize,fontFamily:e.fontFamily,maxLength:e.maxLength,group:e.group},on:{"update:textSelectedData":function(t){e.textSelectedData=t},"update:text-selected-data":function(t){e.textSelectedData=t}}})],1)],1),s("text-comment-modal",{attrs:{modalCollection:e.modalCollection,textSelectedData:e.textSelectedData,currentTool:e.currentTool,fontFamily:e.fontFamily,currentFeatureId:e.currentFeatureId,componentConfig:e.componentConfig,objectsCollection:e.objectsCollection}})],1)},_l=[],Il=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[e.text.length>e.maxLength?s("div",{staticClass:"page"},[s("Page",{attrs:{total:e.textChunks.length,size:"small","page-size":1,current:e.currentPage},on:{"on-change":e.handleChangePage}}),s("CopyBtn",{attrs:{content:e.textChunks[e.currentPage-1]}})],1):e._e(),s("div",{ref:"mark-layout-"+e.paragraph,staticClass:"mark-layout",style:"height: "+(e.text.length>e.maxLength?"calc(100% - 60px)":"100%")},[s("div",{staticClass:"mark-container",attrs:{id:"mark-layout"}},[s("canvas",{ref:"mark_content"})])]),e.text.length>e.maxLength?s("div",{staticClass:"page"},[s("Page",{attrs:{total:e.textChunks.length,size:"small","page-size":1,current:e.currentPage},on:{"on-change":e.handleChangePage}})],1):e._e()])},$l=[],Ml=s("d37d"),Tl=s("c057");const El={lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockMovementX:!0,lockMovementY:!0,lockScalingFlip:!0,hasBorders:!1,hasControls:!1},Ll='<svg t="1648110207426" class="icon" viewBox="0 0 1024 1024" version="1.1"\nxmlns="http://www.w3.org/2000/svg" p-id="1791" width="20" height="20"><path d="M832 128c53.12 0 96 42.88 96 96v384c0\n53.12-42.88 96-96 96h-149.76l-273.28 192-37.12-51.84L661.76 640H832c17.92 0 32-14.08 32-32V224c0-17.92-14.08-32-32-32H192c-17.92\n0-32 14.08-32 32v384c0 17.92 14.08 32 32 32h192v64H192c-53.12 0-96-43.52-96-96V224c0-53.12 42.88-96 96-96z m-288\n172.8v89.6h89.6v64H544V544h-64v-89.6h-89.6v-64H480V300.8h64z" p-id="1792" fill="orange"></path></svg>',Dl='<svg t="1648552328688" class="icon" viewBox="0 0 1024 1024" version="1.1"\nxmlns="http://www.w3.org/2000/svg" p-id="2473" width="20" height="20"><path d="M511.913993 63.989249C317.882076 63.989249\n 159.973123 221.898203 159.973123 415.930119c0 187.323366 315.473879 519.998656 328.890979 534.103813 6.020494 6.364522 14.449185\n  9.976818 23.221905 9.976818 0.172014 0 0.516042 0 0.688056 0 8.944734 0 17.545439-4.128339\n  23.393919-11.008903l109.22896-125.054258c145.179909-177.690576 218.629934-314.957836 218.629934-407.845456C864.026877\n   221.898203 706.117924 63.989249 511.913993 63.989249zM511.913993 575.903242c-88.415253 0-159.973123-71.55787-159.973123-159.973123s71.55787-159.973123 159.973123-159.973123\n   159.973123 71.55787 159.973123 159.973123S600.329246 575.903242 511.913993 575.903242z" p-id="2474"></path></svg>',Pl=(e,t)=>{const{lineIndex:s,charIndex:i}=e.get2DCursorLocation(t,!1),a=e.getCompleteStyleDeclaration(s,i),o=e.getHeightOfLine(s),n=Bl(e.textLines[s],0,i),r=o*s,l=Rl(n,a)+20;return{top:r,left:l}},Bl=(e,t,s)=>{const i=Array.from(e),a=i.slice(t,s);return a.join("")},Rl=(e,t)=>{const{fontSize:s,fontFamily:i}=t,a=new Tl["fabric"].Text(e,{fontSize:s,fontFamily:i});return console.log(e,a.getScaledWidth()),a.getScaledWidth()},zl=e=>{let t=null;return Tl["fabric"].loadSVGFromString(e,(e,s)=>{t=Tl["fabric"].util.groupSVGElements(e,s),t.set({...El,hoverCursor:"pointer"})}),t};var Nl={name:"MarkContent",components:{CopyBtn:Kr["a"]},mixins:[Re["a"]],props:{currentToolName:{type:String,default:""},toolList:{type:Array},text:{type:String,default:""},currentObject:{type:Object,default:null},paragraph:{type:String,default:null},textSelectedData:{type:Object},objectsCollection:{type:Object},fontSize:{type:Number,default:14},fontFamily:{type:String,default:"默认字体"},maxLength:{type:Number,default:5e3},lineHeight:{type:Number,default:2.5},group:{type:String,default:""}},data(){return{textChunks:[],canvas:null,textObject:null,addIcon:null,positionIcons:[],currentPage:1}},computed:{},watch:{"objectsCollection.objects":{immediate:!0,deep:!0,handler(){this.canvas&&this.textObject&&this.renderByObjects()}},"currentObject.featureId":{immediate:!0,deep:!0,handler(){this.canvas&&this.textObject&&this.renderByObjects()}},fontSize:{deep:!0,handler(){this.canvas&&this.textObject&&(this.renderText(),this.renderByObjects())}},lineHeight:{deep:!0,handler(){this.canvas&&this.textObject&&(this.renderText(),this.renderByObjects())}},currentPage:{deep:!0,handler(){this.canvas&&this.textObject&&(this.renderText(),this.renderByObjects(),this.group||(this.paragraph?this.$refs["mark-layout-"+this.paragraph].scrollIntoView():document.getElementById("mark-layout").scrollIntoView()))}},text:"computeTextChunks",maxLength:{deep:!0,handler(){this.computeTextChunks(),this.rebuildCanvas()}}},mounted(){this.computeTextChunks(),this.resizeCanvas(),this.initCanvas(),window.addEventListener("resize",Object(a["debounce"])(()=>{this.resizeCanvas(),this.initCanvas()},500))},methods:{computeTextChunks(){const e=Array.from(this.text),t=[];for(let s=0;s<e.length;s+=this.maxLength)t.push(e.slice(s,s+this.maxLength).join(""));this.textChunks=t},rebuildCanvas(){this.destroyCanvas(),this.$nextTick(()=>{this.resizeCanvas(),this.initCanvas()})},destroyCanvas(){this.canvas&&(this.canvas.dispose(),this.canvas=null,this.textObject=null,this.positionIcons=[],this.addIcon=null,this.currentPage=1)},handleChangePage(e){this.currentPage=e},initCanvas(){this.canvas||(this.canvas=new Ml["fabric"].Canvas(this.$refs.mark_content,{preserveObjectStacking:!0,fireRightClick:!0,fireMiddleClick:!0,stopContextMenu:!0})),this.renderText(),this.handleEventListener("canvas"),document.oncontextmenu=function(e){e.preventDefault()},this.renderByObjects()},resizeCanvas(){const e=this.$refs.mark_content;if(e){const t=window.getComputedStyle(null===e||void 0===e?void 0:e.parentNode);e.width=parseInt(null===t||void 0===t?void 0:t.width,0)}},handleEventListener(e,t){const{addObjectBefore:s,deleteObjectBefore:i}=this.objectsCollection,a={canvas:()=>{this.canvas.on("mouse:down",e=>{var t,s,a,o;("addIcon"!==(null===(t=e.target)||void 0===t?void 0:t.id)&&(this.removeAddIcon(),this.renderByObjects()),3===e.button&&null!==(s=e.target)&&void 0!==s&&null!==(a=s.id)&&void 0!==a&&a.startsWith("feature"))&&(e.e.preventDefault(),i(null===(o=e.target)||void 0===o?void 0:o.id))}),this.canvas.on("mouse:move",e=>{var t,s;"text"===(null===(t=e.target)||void 0===t?void 0:t.id)&&(this.canvas.setActiveObject(this.textObject),this.textObject.enterEditing()),"addIcon"===(null===(s=e.target)||void 0===s?void 0:s.id)&&this.canvas.setActiveObject(this.addIcon)})},text:()=>{this.textObject.on("mouseup",this.handleTextSelected)},addIcon:()=>{var e;null===(e=this.addIcon)||void 0===e||e.on("mousedown",()=>{s(this.paragraph,this.currentPage),this.removeAddIcon()})},positionIcon:e=>{const{updateObjectBefore:t}=this.objectsCollection;e.on("mouseover",()=>{this.canvas.setActiveObject(e)}),e.on("mousedown",e=>{if(1===e.button){var s;const i=null===(s=e.target)||void 0===s?void 0:s.id;t(i)}})}};a[e](t)},loadFontFamily(e){const t=s("f805"),i=new t(e);i.load().then(()=>{this.textObject.set("fontFamily",e),this.canvas.requestRenderAll()}).catch(e=>{console.log("OPTIMUS-textcomment加载字体错误:",e)})},renderText(){this.textObject&&this.canvas.remove(this.textObject),this.textObject=new Ml["fabric"].Textbox(this.textChunks[this.currentPage-1],{...El,width:this.canvas.getWidth()-40,fontSize:this.fontSize,splitByGrapheme:!0,hoverCursor:"text",lineHeight:this.lineHeight||"normal",top:20,id:"text",fontFamily:"Monaco",onInput:()=>!1,objectCaching:!1}),"默认字体"!==this.fontFamily&&this.loadFontFamily(J(this.fontFamily)),this.canvas.add(this.textObject),this.textObject.centerH(),this.canvas.setHeight(this.textObject.height+40),this.handleEventListener("text")},generatePositionIcon(e){var t;const{color:s,featureId:i,data:{location:{endIndex:a}}}=e;if(this.positionIcons.find(e=>e.id===i))return;const o=i===(null===(t=this.currentObject)||void 0===t?void 0:t.featureId)?s:n["b"].translateOpacity(s,.3),{top:r,left:l}=Pl(this.textObject,a-(this.currentPage-1)*this.maxLength),c=zl(Dl);c.set({top:r,left:l-6,fill:o,id:i}),this.positionIcons.push(c),this.canvas.add(c),this.handleEventListener("positionIcon",c)},removeAddIcon(){this.canvas&&this.addIcon&&(this.addIcon.off("mousedown"),this.canvas.remove(this.addIcon),this.addIcon=null)},checkObject(e){const{data:{location:{startIndex:t,endIndex:s}}}=e;return t>=(this.currentPage-1)*this.maxLength&&t<=this.currentPage*this.maxLength&&s>=(this.currentPage-1)*this.maxLength&&s<=this.currentPage*this.maxLength},renderByObjects(){var e,t;null===(e=this.textObject)||void 0===e||e.removeStyle("textBackgroundColor"),Object(a["forEach"])(this.positionIcons,e=>{this.canvas.remove(e)}),this.positionIcons=[],Object(a["forEach"])(this.paragraph?this.objectsCollection.objects.filter(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.paragraph)===this.paragraph&&this.checkObject(e)}):this.objectsCollection.objects.filter(e=>this.checkObject(e)),e=>{var t;const{color:s,data:{location:{startIndex:i,endIndex:a}},featureId:o}=e,r=o===(null===(t=this.currentObject)||void 0===t?void 0:t.featureId)?s:n["b"].translateOpacity(s,.5);this.textObject.setSelectionStyles({textBackgroundColor:r},i-(this.currentPage-1)*this.maxLength,a-(this.currentPage-1)*this.maxLength),this.generatePositionIcon(e)}),null===(t=this.canvas)||void 0===t||t.renderAll()},handleTextSelected(e){var t;const{selectionStart:s,selectionEnd:i,text:o}=e.target||{};if(console.log(`startIndex:${s}, endIndex:${i}`),Object(a["isUndefined"])(s)||Object(a["isUndefined"])(i)||null!==(t=this.$optimus)&&void 0!==t&&t.disabled)return;i>s&&this.textObject.setSelectionStyles({textBackgroundColor:"rgba(194, 194, 194, 0.7)"},s,i);const n=Bl(o,s,i);this.$emit("update:textSelectedData",{startIndex:s,endIndex:i,selectedWords:n}),this.textObject.setCursorByClick(e.e);const{top:r,left:l}=Pl(this.textObject,i);this.addIcon=zl(Ll),this.addIcon.set({top:r,left:l,id:"addIcon"}),this.canvas.add(this.addIcon),this.handleEventListener("addIcon")}}},Fl=Nl,Vl=(s("000e"),Object(S["a"])(Fl,Il,$l,!1,null,"94fca214",null)),ql=Vl.exports,Hl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.toolList.length>0?s("div",{staticClass:"tools"},[s("Input",{attrs:{placeholder:"输入关键词搜索工具"},model:{value:e.toolSearchVal,callback:function(t){e.toolSearchVal=t},expression:"toolSearchVal"}}),s("div",{staticClass:"content"},[s("RadioGroup",{staticClass:"toolGroup",attrs:{vertical:!1},model:{value:e.currentName,callback:function(t){e.currentName=t},expression:"currentName"}},e._l(e.toolSearchList,(function(t){return s("Radio",{key:t.name,attrs:{label:t.name,disabled:e.radioDisabled}},[s("span",{attrs:{title:t.label}},[e._v(e._s(t.label))]),s("div",{staticClass:"color",style:{backgroundColor:t.color}})])})),1)],1)],1):e._e()},Wl=[],Ul={name:"Tools",mixins:[Re["a"]],props:{currentToolName:{type:String,default:""},toolList:{type:Array}},data(){return{toolSearchVal:"",currentName:this.currentToolName}},computed:{toolSearchList(){return this.toolList.filter(e=>e.label.includes(this.toolSearchVal))},radioDisabled(){return this.$optimus.disabled}},watch:{currentName(e){this.$emit("update:currentToolName",e)},currentToolName(e){this.currentName=e}},mounted(){var e;(null===(e=this.toolList)||void 0===e?void 0:e.length)>0&&(this.currentName=this.toolList[0].name)},methods:{}},Ql=Ul,Jl=(s("aeb7"),Object(S["a"])(Ql,Hl,Wl,!1,null,"94414e3e",null)),Gl=Jl.exports,Kl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{closable:!1,draggable:"",sticky:"",scrollable:"",mask:!1},model:{value:e.modalCollection.objectModal.showModal,callback:function(t){e.$set(e.modalCollection.objectModal,"showModal",t)},expression:"modalCollection.objectModal.showModal"}},[s("div",{staticClass:"modal-title",attrs:{slot:"header"},slot:"header"},[s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("div",{staticClass:"color",style:{backgroundColor:e.currentTool.color}}),s("b",{staticClass:"label"},[e._v(e._s(e.currentTool.label))]),s("Col",{attrs:{flex:"auto"}},[e.currentTool.wordCount?s("div",{staticClass:"word-count"},[e._v("字数："+e._s(e.textSelectedData.selectedWords.length))]):e._e()])],1),s("Row",{staticClass:"mtm",staticStyle:{"line-height":"normal"},attrs:{align:"middle"}},[s("Col",{staticClass:"content",style:e.myFontFamily,attrs:{title:e.textSelectedData.selectedWords}},[e._v(e._s(e.textSelectedData.selectedWords))])],1)],1),s("div",{staticClass:"modal-content"},[[s("Form",{attrs:{"label-position":"top"}},[e.currentTool.searchTool?s("FormItem",{attrs:{label:"搜索引擎"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("搜索引擎")]),s("div",{staticClass:"tips"},[e._v("此项为快捷搜索引擎（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.search},model:{value:e.modalCollection.objectModal.searchVal,callback:function(t){e.$set(e.modalCollection.objectModal,"searchVal",t)},expression:"modalCollection.objectModal.searchVal"}},e._l(e.searchOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e(),e.currentTool.translateTool?s("FormItem",{attrs:{label:"翻译工具"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("翻译工具")]),s("div",{staticClass:"tips",staticStyle:{display:"inline-block",color:"red",padding:"0 10px"}},[e._v(" 此项为快捷翻译工具（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.translate},model:{value:e.modalCollection.objectModal.translateVal,callback:function(t){e.$set(e.modalCollection.objectModal,"translateVal",t)},expression:"modalCollection.objectModal.translateVal"}},e._l(e.translateOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e()],1),e.modalCollection.objectModal.showModal?s("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.modalCollection.objectModal.answer,disabled:e.$optimus.disabled}}):e._e()]],2),s("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:e.handleLabelUpdateCancel}},[e._v("取消")]),s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.handleLabelUpdate}},[e._v("确认")])],1)])},Yl=[],Zl={name:"TextCommentModal",mixins:[Re["a"]],props:{modalCollection:{type:Object},currentTool:{type:Object},textSelectedData:{type:Object},componentConfig:{type:Object},objectsCollection:{type:Object},currentFeatureId:{type:String},fontFamily:{type:String,default:"默认字体"}},data(){return{searchOption:n["s"],translateOption:n["u"]}},computed:{myFontFamily(){return"默认字体"===this.fontFamily?{}:{fontFamily:J(this.fontFamily),fontSize:"20px"}}},methods:{search(e){Object(n["r"])(e,this.textSelectedData.selectedWords),this.$nextTick(()=>{this.modalCollection.objectModal.searchVal=""})},translate(e){Object(n["t"])(e,this.textSelectedData.selectedWords),this.$nextTick(()=>{this.modalCollection.objectModal.translateVal=""})},handleLabelUpdate(){const{object:e,object:{tags:t}}=this.$refs,{action:s}=this.modalCollection.objectModal;if(e.validate(),!e.isValid)return void this.$Notice.error({title:"",desc:"",render:e=>e("span",["请完善必填项 "])});if("text/ner_default"===this.currentToolName)return void this.$Message.error("请选择标注工具!");const{addObject:i,generateObject:a,updateObject:o,objects:n}=this.objectsCollection;if("add"===s)i(a(t));else{const e=null===n||void 0===n?void 0:n.find(e=>e.featureId===this.currentFeatureId);o({...e,tags:t})}this.handleLabelUpdateCancel()},handleLabelUpdateCancel(){this.modalCollection.objectModal.showModal=!1,this.modalCollection.resetObjectModal()}}},Xl=Zl,ec=(s("487d"),Object(S["a"])(Xl,Kl,Yl,!1,null,"bd8348b4",null)),tc=ec.exports;const sc={searchVal:void 0,translateVal:void 0,showModal:!1,answer:{},action:"add"};var ic={name:"TextComment",components:{TextCommentContent:ql,TextCommentTools:Gl,TextCommentModal:tc,TextFont:Wr,copyBtn:wl,Markdown:ml,cherryMarkdown:el},mixins:[Re["a"]],props:{text:{type:String,default:""},currentObject:{type:Object,default:null},fontFamily:{type:String,default:"默认字体"},group:{type:String,default:""},defaultStringType:{type:String,default:"text"},markdownConfig:String,textPageStepLength:{type:Number,default:5e3}},data(){return{currentToolName:"",currentFeatureId:"",objectModal:sc,objects:this.$optimus.objects||[],textSelectedData:{startIndex:0,endIndex:0,selectedWords:""},fontSize:14,currentPage:1,maxLength:5e3,stringType:this.defaultStringType}},computed:{objectsCollection(){return{objects:this.objects.filter(e=>{var t;return!this.group||(null===(t=e.data)||void 0===t?void 0:t.group)===this.group}),generateObject:this.generateObject,addObjectBefore:this.addObjectBefore,addObject:this.addObject,updateObjectBefore:this.updateObjectBefore,updateObject:this.updateObject,deleteObjectBefore:this.deleteObjectBefore,deleteObject:this.deleteObject}},modalCollection(){return{objectModal:this.objectModal,resetObjectModal:this.resetObjectModal}},toolList(){var e;return null===(e=this.$renderedComponentConfig.$object_tools)||void 0===e?void 0:e.filter(e=>"text/ner"===(null===e||void 0===e?void 0:e.type))},currentTool(){return this.toolList.find(e=>(null===e||void 0===e?void 0:e.name)===(null===this||void 0===this?void 0:this.currentToolName))||{}},componentConfig(){const e=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return!t||("all"===t||t===this.currentToolName)});return{component:"z-form-stage",items:e}}},mounted(){this.$on("delete-object",e=>{this.deleteObject(e)}),this.$optimus.$on("optimus:text-stage:edit-object",e=>{this.updateObjectBefore(e.featureId)}),this.maxLength=Number(this.textPageStepLength||5e3)||5e3},methods:{renderByObjects(){var e;null===(e=this.$refs.textCommentContent)||void 0===e||e.renderByObjects()},resetObjectModal(){this.objectModal=sc},isExistSameObject(e){return this.objects.find(t=>{var s;const{startIndex:i,endIndex:a}=e.data.location||{},{startIndex:o,endIndex:n}=(null===(s=t.data)||void 0===s?void 0:s.location)||{};return"text/ner"===t.type&&i===o&&a===n&&e.name===t.name&&e.featureId!==t.featureId})},generateObject(e){const{type:t,color:s,name:i,label:a,wordCount:o}=this.currentTool,{startIndex:r,endIndex:l,selectedWords:c}=this.textSelectedData,d={location:{startIndex:r+this.maxLength*(this.currentPage-1),endIndex:l+this.maxLength*(this.currentPage-1)},text:c};o&&(d.textLength=c.length),this.group&&(d.group=this.group);const u="feature-"+Object(n["j"])(8);return{type:t,featureId:u,label:a,name:i,color:s,tags:e,data:d}},addObjectBefore(e,t){var s;this.currentPage=t,(null===(s=this.componentConfig.items)||void 0===s?void 0:s.length)>0?this.objectModal={...this.objectModal,showModal:!0,action:"add"}:(this.addObject(this.generateObject([])),(this.currentTool.searchTool||this.currentTool.translateTool)&&(this.objectModal.showModal=!0,this.objectModal.action="update"))},addObject(e){this.isExistSameObject(e)?this.$Message.warning({content:"当前位置已存在相同批注！",duration:3}):(this.objects.push(e),this.$optimus.$emit("optimus:text-stage:selectObj",e,this.group),this.currentFeatureId=e.featureId)},updateObjectBefore(e){this.currentFeatureId=e;const t=this.objects.find(t=>(null===t||void 0===t?void 0:t.featureId)===e),{location:{startIndex:s,endIndex:i},text:a}=null===t||void 0===t?void 0:t.data;this.currentToolName=t.name,this.textSelectedData={startIndex:s,endIndex:i,selectedWords:a},this.$optimus.$emit("optimus:text-stage:selectObj",t,this.group),t.tags.length&&(this.objectModal={...this.objectModal,showModal:!0,action:"update",answer:{tags:null===t||void 0===t?void 0:t.tags}})},updateObject(e){if(this.isExistSameObject({...e,...this.currentTool}))return void this.$Message.warning({content:"当前位置已存在相同批注！",duration:3});const t=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.featureId)===(null===e||void 0===e?void 0:e.featureId));this.objects.splice(t,1,{...e,...this.currentTool})},deleteObjectBefore(e){this.$Modal.confirm({title:"确定要删除当前标签？",content:e,onOk:()=>{this.deleteObject(e),this.$optimus.$emit("optimus:text-stage:selectObj",null,this.group)}})},deleteObject(e){const t=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.featureId)===e);this.objects.splice(t,1)}}},ac=ic,oc=(s("83bf"),Object(S["a"])(ac,Sl,_l,!1,null,"09a1332e",null)),nc=oc.exports,rc={name:"z-text-tool",metadata:Pr,components:{textAnnotation:Al,TextComment:nc},mixins:[Re["a"]],props:{text:{type:[String,Number]},group:{type:String,default:""},scene:{type:String,default:""},fontFamily:String,markdownConfig:String,textPageStepLength:{type:Number,default:5e3},item:Object,highlightKeywords:{type:Array,default:()=>[]}},data(){var e,t,s;const i=null===(e=this.$optimus.component.attributes)||void 0===e||null===(t=e.groupConfig)||void 0===t||null===(s=t[this.group])||void 0===s?void 0:s.attributes.text,a=i&&i.match(/^\${(.+)}$/);let o="text";if(a){const[,e]=a,t=e.replace("input.",""),s=this.$optimus.schema.find(e=>e.key===t);o=(null===s||void 0===s?void 0:s.string_type)||"text"}return{currentObject:null,defaultStringType:o}},computed:{isComment(){var e;return"批注"===this.scene||"批注"===(null===(e=this.$renderedComponentConfig.extra_attributes)||void 0===e?void 0:e.scene)&&this.$renderedComponentConfig.$object_tools.length>0},config(){return this.$renderedComponentConfig}},mounted(){this.$optimus.$on("optimus:default-stage:clear-selectObj",e=>{if(e!==this.group){var t,s;if(this.currentObject=null,this.isComment)null===(t=this.$refs.textComment)||void 0===t||t.renderByObjects();else null===(s=this.$refs.textAnnotation)||void 0===s||s.renderByObjects();this.$optimus.$emit("optimus:default-stage:selectObj",null,e)}}),this.$optimus.$on("optimus:text-stage:selectObj",(e,t)=>{t===this.group&&e&&(this.currentObject=e,this.$optimus.$emit("optimus:default-stage:selectObj",e,t))}),this.$optimus.$on("optimus:default-stage:edit-object",(e,t)=>{if(e!==this.group)return;this.isComment?this.$refs.textComment.updateObjectBefore(t.featureId):this.$refs.textAnnotation.editObject(t);const s=document.getElementById(`${this.$optimus.$attrs.name||""}_default_item_${e}`);s.scrollIntoView({behavior:"smooth"})}),this.$optimus.$on("optimus:default-stage:delete-object",(e,t)=>{if(e===this.group)if(t)this.isComment?this.$refs.textComment.$emit("delete-object",t.featureId):this.$refs.textAnnotation.removeItem(t.featureId);else{const e=Object(a["cloneDeep"])(this.$optimus.objects);e.forEach(e=>{e.data.group===this.group&&(this.isComment?this.$refs.textComment.$emit("delete-object",e.featureId):this.$refs.textAnnotation.removeItem(e.featureId))})}})},methods:{}},lc=rc,cc=(s("4f56"),Object(S["a"])(lc,Er,Lr,!1,null,"07f6b924",null)),dc=cc.exports,uc=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"audio-label-container"},[s("audio-annotation",{ref:"audioAnnotation",attrs:{src:e.src,$renderedComponentConfig:e.$renderedComponentConfig,group:e.group,shortCutEnabled:e.group===e.activeGroup}})],1)},hc=[],pc={label:"语音标注/单音轨",icon:"ios-image-outline",name:"z-audio-stage",attributes:[{name:"src",label:"音频地址",value:"",type:String,vType:["url"]}],tools:[{type:"audio/segment",label:"标注段",attributes:[{label:"标注段名称",name:"label",type:String,value:""},{label:"标注段标识",name:"name",type:String,required:!1,value(){return"audio_segment_"+(new Date).getTime()}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}},{label:"是否允许动态添加",name:"dynamic",type:Boolean,component:"z-switch",value:!1}],helps:[]}],defaultTools:[{id:"default_audio",type:"audio/segment",label:"默认",name:"default",color:"random_audio",dynamic:!1,helps:[{asrLang:"汉语",desc:"框选音频内容，单击“智能识别”可识别文本并生成文字；音频资源需配置为url类型",enable:!1,id:"1000000000",label:"ASR辅助标注"}]}],shortCuts:[{label:"播放",attributes:[{name:["Tab"],keys:[9],label:"播放/暂停",global:!0},{name:["esc"],keys:[27],label:"播放选中段",global:!0},{name:["h"],keys:[72],label:"隐藏/展示切分段",global:!0},{name:["ALT","->"],keys:[39],label:"快进",global:!0},{name:["ALT","<-"],keys:[37],label:"快退",global:!0},{name:["ALT","w"],keys:[18,87],label:"频谱放大",global:!0},{name:["ALT","q"],keys:[18,81],label:"频谱缩小",global:!0}]},{label:"语音切分",attributes:[{name:["ALT","s"],keys:[83],label:"切分起点"},{name:["ALT","x"],keys:[88],label:"切分终点"},{name:["ALT","d"],keys:[68],label:"音频段切割"},{name:["ALT","m"],keys:[77],label:"音频段合并"},{name:["shift","标注对象"],keys:[16],label:"多选"},{name:["backspace"],keys:[8],label:"删除选中段"}]},{label:"语音转写",attributes:[{name:["ALT","enter"],keys:[13],label:"上一段",global:!0},{name:["shift","enter"],keys:[16,13],label:"下一段",global:!0},{name:["ALT","z"],label:"智能识别"},{name:["ALT","a"],label:"应用智能识别"}]}],objectAnswerJson:{description:"语音标注/单音轨",type:"array",items:{type:"object",properties:{featureId:{type:"string"},type:{type:"string",const:"audio/segment"},name:{type:"string",enum:["default"]},label:{description:"可选字段，工具对应的名称",type:"string"},color:{description:"可选字段，工具对应的颜色",type:"string"},data:{type:"object",properties:{start:{description:"必须字段，起始位置",type:"string",pattern:"^([01][0-9]|2[0-3])(:[0-5][0-9]){2}:[0-9]{1,3}$"},end:{description:"必须字段，结束位置",type:"string",pattern:"^([01][0-9]|2[0-3])(:[0-5][0-9]){2}:[0-9]{1,3}$"}},required:["start","end"]},tags:{description:"二级标签",type:"array",items:{anyOf:[]}}},required:["featureId","type","name","label","color","data","tags"]}}},mc={...pc,label:"语音切分转写/单音轨",name:"z-audio-tool",type:"container_component",scene:"语音"},gc=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"z-audio-annotation",style:{minHeight:e.groupObjects.length>0?"500px":"300px"}},[i("Split",{attrs:{mode:"vertical",min:"10px"},scopedSlots:e._u([{key:"trigger",fn:function(){return[e.groupObjects.length?e._e():i("div")]},proxy:!0}]),model:{value:e.splitValue,callback:function(t){e.splitValue=t},expression:"splitValue"}},[i("timeline",{staticClass:"split-top",attrs:{slot:"top"},slot:"top"},[i("div",{staticClass:"wrapper"},[e.src&&"video"===e.type?i("div",{staticClass:"video-box mbm"},[e.isVideoOk?i("div",{staticStyle:{position:"absolute","z-index":"3",margin:"5px",right:"0"}},[e.videoHeight<500?i("img",{staticClass:"hover-hand",attrs:{src:s("912b"),height:"20px",width:"20px"},on:{click:function(t){return e.getCurrentHeight("enlarge")}}}):e._e(),e.videoHeight>200?i("img",{staticClass:"hover-hand",attrs:{src:s("28af"),height:"20px",width:"20px"},on:{click:function(t){return e.getCurrentHeight("reduce")}}}):e._e()]):e._e(),i("videoPreview",{ref:"videoRef",attrs:{url:e.src,height:e.videoHeight}})],1):e._e()]),i("div",{staticClass:"wave_box"},[e.isShowActive?i("Row",{staticClass:"mbs"},[i("Col",{staticClass:"height-center",attrs:{span:"8"}},[i("t-button",{staticClass:"icon-button",attrs:{variant:"text",size:"small",disabled:100===e.curZoomSpeed},on:{click:function(t){return e.chengeZoom(1)}}},[i("t-icon",{attrs:{name:"expand-horizontal",size:"17"}})],1),i("t-button",{staticClass:"icon-button",attrs:{variant:"text",size:"small",disabled:0===e.curZoomSpeed},on:{click:function(t){return e.chengeZoom(0)}}},[i("t-icon",{attrs:{name:"shrink-horizontal",size:"17"}})],1),i("t-button",{staticClass:"icon-button",attrs:{variant:"text",size:"small",disabled:0===e.curZoomSpeed},on:{click:function(t){return e.chengeZoom(2)}}},[i("t-icon",{attrs:{name:"fullscreen-1",size:"17"}})],1),i("t-button",{staticClass:"icon-button",attrs:{variant:"text",size:"small"},on:{click:function(t){return e.changeHeight(1)}}},[i("t-icon",{attrs:{name:"expand-vertical",size:"17"}})],1),i("t-button",{staticClass:"icon-button",attrs:{variant:"text",size:"small"},on:{click:function(t){return e.changeHeight(-1)}}},[i("t-icon",{attrs:{name:"shrink-vertical",size:"17"}})],1),i("a",{staticClass:"mlm",attrs:{href:e.href,target:"_blank"}},[e._v("无法加载波形？")])],1),i("Col",{attrs:{span:"8"}},[i("div",{staticClass:"center height-center"},[i("Icon",{staticClass:"mrm hover-hand",attrs:{type:"ios-rewind",size:"20",id:"sb"},on:{click:e.skipBackward}}),e.isplaying?e._e():i("Icon",{staticClass:"mrm hover-hand",attrs:{type:"ios-play",size:"20",id:"pp"},on:{click:e.playPause}}),e.isplaying?i("Icon",{staticClass:"mrm hover-hand",attrs:{type:"ios-pause",size:"20",id:"pp"},on:{click:e.playPause}}):e._e(),i("Icon",{staticClass:"hover-hand",attrs:{type:"ios-fastforward",size:"20",id:"sf"},on:{click:e.skipForward}})],1)]),i("Col",{attrs:{span:"8"}},[i("div",{staticClass:"right"},[i("Button",{staticClass:"mrm",attrs:{type:"warning",size:"small",shape:"circle",disabled:e.$optimus.disabled},on:{click:e.cutDoubleObj}},[e._v("段切割")]),i("Button",{staticClass:"mrm",attrs:{type:"primary",size:"small",shape:"circle",disabled:e.$optimus.disabled},on:{click:function(t){return e.createObject(e.currentObjectTool,t)}}},[e._v("切分段")]),i("t-dropdown",{attrs:{options:e.timelineIntervalOptions},on:{click:e.changeInterval}},[i("t-button",{attrs:{size:"small",variant:"text"}},[i("t-space",{attrs:{align:"center",size:"0"}},[i("span",[e._v(e._s(e.timelineInterval))]),i("t-icon",{attrs:{name:"chevron-down"}})],1)],1)],1),i("t-dropdown",{staticClass:"mrs",attrs:{options:e.speedNums},on:{click:e.changeSpeed}},[i("t-button",{attrs:{size:"small",variant:"text"}},[i("t-space",{attrs:{align:"center",size:"0"}},[i("span",[e._v(e._s(e.curSpeedNum)+"x")]),i("t-icon",{attrs:{name:"chevron-down"}})],1)],1)],1),e.showBackend?[i("Dropdown",{attrs:{transfer:""},on:{"on-click":e.onChangeBackend}},[i("Tooltip",{attrs:{content:"倍速声调异常？试试切换配置",disabled:!e.showBackendTip,always:e.showBackendTip,placement:"top",theme:"light",transfer:""}},[i("div",{staticClass:"hover-hand",staticStyle:{color:"#888","font-size":"12px"}},[i("Tag",{staticStyle:{margin:"0"}},[e._v(e._s(e.currentBackend.substr(0,1)))])],1)]),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.backendOptions,(function(t,s){return i("DropdownItem",{key:s,attrs:{name:s,selected:s===e.currentBackend}},[i("span",[e._v(e._s(s)+" ")]),i("Tooltip",{attrs:{content:t,"max-width":240,placement:"top",transfer:""}},[i("Icon",{attrs:{type:"ios-help-circle-outline"}})],1)],1)})),1)],1)]:e._e()],2)])],1):e._e(),100!==e.percent&&e.src?i("a",{staticClass:"mts",staticStyle:{position:"absolute",left:"45%","z-index":"3"}},[e.isShowActive?i("span",[e._v("波形加载中"+e._s(e.percent)+"%，可正常播放和切分")]):i("span",[e._v("音频加载中"+e._s(e.percent)+"%")])]):e._e(),i("div",{staticClass:"waveform_class",attrs:{id:"waveform_"+(e.$optimus.$attrs.name||"")+"_"+e.group}}),i("div",{attrs:{id:"wave-timeline_"+(e.$optimus.$attrs.name||"")+"_"+e.group}}),i("audio-timer",{staticClass:"center mtm",attrs:{time:e.time}})],1),i("div",{staticClass:"left mtm mbm"},[i("t-button",{attrs:{size:"small",variant:"outline"},on:{click:e.handleLoad}},[e._v(e._s(e.progress?"暂停展开表单":"展开全部表单"))])],1),i("div",{staticClass:"right mtm mbm tags-radius"},[e._l(e.objectTools,(function(t,s){return i("Tag",{key:s,staticClass:"hover-hand mrm",class:{fontcolor:"random_audio"!==t.color},style:t.isChecked?{background:e.getObjectToolColor(t),"border-color":e.getObjectToolColor(t)}:{background:e.getObjectToolColor(t),opacity:.4},attrs:{type:"random_audio"===t.color?"border":null,checked:t.isChecked,checkable:"",closable:!e.$optimus.disabled&&t.isClosable,name:""+t.name+t.label,color:e.getObjectToolColor(t)},on:{"on-change":e.changeTag,"on-close":e.closeTag}},[e._v(e._s(t.label))])})),!e.$optimus.disabled&&e.dynamicTools.length>0?i("Dropdown",{attrs:{transfer:!0},on:{"on-click":e.addObjectTool}},[i("icon",{staticClass:"hover-hand",attrs:{type:"ios-add"}}),i("icon",{staticClass:"hover-hand",attrs:{type:"ios-arrow-down"}}),i("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.dynamicTools,(function(t,s){return t.dynamic?i("DropdownItem",{key:t.name,attrs:{name:t.name}},[e._v('新增"'+e._s(t.label)+'"')]):e._e()})),1)],1):e._e()],2)]),i("timeline",{directives:[{name:"show",rawName:"v-show",value:e.groupObjects.length>0,expression:"groupObjects.length > 0"}],staticClass:"split-bottom",attrs:{slot:"bottom"},slot:"bottom"},[i("Select",{staticClass:"mbm",staticStyle:{width:"150px"},model:{value:e.currentTagTool,callback:function(t){e.currentTagTool=t},expression:"currentTagTool"}},[i("Option",{key:"*",attrs:{value:"*"}},[e._v("全部")]),e._l(e.objectTools,(function(t,s){return i("Option",{key:""+t.label+t.name,attrs:{value:""+t.label+t.name}},[e._v(e._s(t.label))])}))],2),e._l(e.groupObjects,(function(t,s){return i("div",{directives:[{name:"show",rawName:"v-show",value:e.currentTagTool===""+t.label+t.name||"*"===e.currentTagTool,expression:"currentTagTool === `${obj.label}${obj.name}` || currentTagTool === '*'"}],key:t.featureId,staticClass:"z-stage__objects",attrs:{id:t.featureId},on:{click:function(s){return e.selectObject(t,!0)}}},[i("Row",{staticClass:"mbm"},[i("Col",{attrs:{span:"21"}},[i("span",{staticClass:"mts mrm"},[i("div",{staticClass:"mrs regionblock",style:{backgroundColor:t.color}}),i("span",[e._v("段落"+e._s(s+1)+"（"+e._s(t.label)+"）")])]),i("span",[e._v("标注时间段：")]),i("Input",{staticClass:"mrm",staticStyle:{width:"20%"},attrs:{disabled:e.$optimus.disabled},on:{"on-blur":function(s){return e.updateRegionTime(t,0)}},model:{value:t.data.start,callback:function(s){e.$set(t.data,"start",s)},expression:"obj.data.start"}}),i("span",[e._v("-")]),i("Input",{staticClass:"mlm mrm",staticStyle:{width:"20%"},attrs:{disabled:e.$optimus.disabled},on:{"on-blur":function(s){return e.updateRegionTime(t,1)}},model:{value:t.data.end,callback:function(s){e.$set(t.data,"end",s)},expression:"obj.data.end"}}),i("span",{staticClass:"mlm"},[e._v("时长："+e._s(e.getTimePeriod(t.data.start,t.data.end))+"s")])],1),i("Col",{staticClass:"mts",attrs:{span:"3"}},[i("div",{staticClass:"right"},[i("icon",{staticClass:"mrs hover-hand",attrs:{type:e.regionLists[t.featureId]?"ios-eye-outline":"ios-eye-off-outline",size:"20"},on:{click:function(s){return e.disableRegion(t)}}}),i("icon",{staticClass:"mrs hover-hand",attrs:{type:"md-arrow-dropright-circle",size:"20"},on:{click:function(s){return s.stopPropagation(),e.playTagging(t.featureId)}}}),e.$optimus.disabled?e._e():i("icon",{staticClass:"hover-hand",attrs:{type:"ios-trash-outline",size:"20"},on:{click:function(i){return i.stopPropagation(),e.deleteSubmit([t.featureId],"【段落"+(s+1)+"】")}}}),i("icon",{staticClass:"mls hover-hand",attrs:{type:e.visibleObjects[t.featureId]?"ios-arrow-up":"ios-arrow-down",size:"20"},on:{click:function(s){return s.stopPropagation(),e.handleExpand(t)}}})],1)])],1),i("optimus-engine",{directives:[{name:"show",rawName:"v-show",value:e.visibleObjects[t.featureId],expression:"visibleObjects[obj.featureId]"},{name:"collectTags",rawName:"v-collectTags",value:t,expression:"obj"}],ref:"form_"+t.featureId,refInFor:!0,attrs:{component:e.componentConfig[t.name],context:e.$optimus.context,objectContext:e.objectContext[t.featureId],answer:e.initAnswer[t.featureId],disabled:e.$optimus.disabled}})],1)}))],2)],1)],1)},bc=[];function fc(e){return void 0===e&&(e="wavesurfer_"),e+Math.random().toString(32).substring(2)}function vc(e){let t=-1/0;return Object.keys(e).forEach(s=>{e[s]>t&&(t=e[s])}),t}function yc(e){let t=Number(1/0);return Object.keys(e).forEach(s=>{e[s]<t&&(t=e[s])}),t}function wc(e){const t=vc(e),s=yc(e);return-s>t?-s:t}class xc{constructor(){this._disabledEventEmissions=[],this.handlers=null}on(e,t){this.handlers||(this.handlers={});let s=this.handlers[e];return s||(s=this.handlers[e]=[]),s.push(t),{name:e,callback:t,un:(e,t)=>this.un(e,t)}}un(e,t){if(!this.handlers)return;const s=this.handlers[e];let i;if(s)if(t)for(i=s.length-1;i>=0;i--)s[i]==t&&s.splice(i,1);else s.length=0}unAll(){this.handlers=null}once(e,t){const s=(...i)=>{t.apply(this,i),setTimeout(()=>{this.un(e,s)},0)};return this.on(e,s)}setDisabledEventEmissions(e){this._disabledEventEmissions=e}_isDisabledEventEmission(e){return this._disabledEventEmissions&&this._disabledEventEmissions.includes(e)}fireEvent(e,...t){if(!this.handlers||this._isDisabledEventEmission(e))return;const s=this.handlers[e];s&&s.forEach(e=>{e(...t)})}}function Cc(e,t){return Object.keys(t).forEach(s=>{e.style[s]!==t[s]&&(e.style[s]=t[s])}),e}var jc=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||((e,t)=>setTimeout(e,1e3/60))).bind(window);function Oc(e){return(...t)=>jc(()=>e(...t))}var kc=s("06a6"),Ac=s.n(kc);function Sc(e){e.stopPropagation(),document.body.removeEventListener("click",Sc,!0)}function _c(e){document.body.addEventListener("click",Sc,!0)}class Ic{constructor(e,t,s){this.instance=e,this.instance._reader=s.body.getReader(),this.total=parseInt(t,10),this.loaded=0}start(e){const t=()=>{this.instance._reader.read().then(({done:s,value:i})=>{if(s)return 0===this.total&&this.instance.onProgress.call(this.instance,{loaded:this.loaded,total:this.total,lengthComputable:!1}),void e.close();this.loaded+=i.byteLength,this.instance.onProgress.call(this.instance,{loaded:this.loaded,total:this.total,lengthComputable:!(0===this.total)}),e.enqueue(i),t()}).catch(t=>{e.error(t)})};t()}}function $c(e){if(!e)throw new Error("fetch options missing");if(!e.url)throw new Error("fetch url missing");const t=new xc,s=new Headers,i=new Request(`${e.url+(e.url.indexOf("?")>-1?"&":"?")}r=${Math.random()}`);t.controller=new AbortController,e&&e.requestHeaders&&e.requestHeaders.forEach(e=>{s.append(e.key,e.value)});const a=e.responseType||"json",o={method:e.method||"GET",headers:s,mode:e.mode||"cors",credentials:e.credentials||"same-origin",cache:e.cache||"default",redirect:e.redirect||"follow",referrer:e.referrer||"client",signal:t.controller.signal};return fetch(i,o).then(e=>{t.response=e;let s=!0;e.body||(s=!1);const i=e.headers.get("content-length");return null===i&&(s=!1),s?(t.onProgress=e=>{t.fireEvent("progress",e)},new Response(new ReadableStream(new Ic(t,i,e)),o)):e}).then(e=>{let t;if(e.ok)switch(a){case"arraybuffer":return e.arrayBuffer();case"json":return e.json();case"blob":return e.blob();case"text":return e.text();default:t="Unknown responseType: "+a;break}throw t||(t="HTTP error status: "+e.status),new Error(t)}).then(e=>{t.fireEvent("success",e)}).catch(e=>{t.fireEvent("error",e)}),t.fetchRequest=i,t}function Mc(e,t,s){return Math.min(Math.max(t,e),s)}const Tc={width:"height",height:"width",overflowX:"overflowY",overflowY:"overflowX",clientWidth:"clientHeight",clientHeight:"clientWidth",clientX:"clientY",clientY:"clientX",scrollWidth:"scrollHeight",scrollLeft:"scrollTop",offsetLeft:"offsetTop",offsetTop:"offsetLeft",offsetHeight:"offsetWidth",offsetWidth:"offsetHeight",left:"top",right:"bottom",top:"left",bottom:"right",borderRightStyle:"borderBottomStyle",borderRightWidth:"borderBottomWidth",borderRightColor:"borderBottomColor"};function Ec(e,t){return Object.prototype.hasOwnProperty.call(Tc,e)&&t?Tc[e]:e}const Lc=Symbol("isProxy");function Dc(e,t){return e[Lc]?e:new Proxy(e,{get(e,s,i){if(s===Lc)return!0;if("domElement"===s)return e;if("style"===s)return Dc(e.style,t);if("canvas"===s)return Dc(e.canvas,t);if("getBoundingClientRect"===s)return function(...s){return Dc(e.getBoundingClientRect(...s),t)};if("getContext"===s)return function(...s){return Dc(e.getContext(...s),t)};const a=e[Ec(s,t)];return"function"===typeof a?a.bind(e):a},set(e,s,i){return e[Ec(s,t)]=i,!0}})}function Pc(){const e="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",t=document.createElement("div");t.innerHTML='<audio x-webkit-airplay="deny"></audio>';const s=t.children.item(0);s.src=e,s.preload="auto",s.type="audio/mpeg",s.disableRemotePlayback=!0,s.play(),s.remove(),t.remove()}class Bc extends xc{constructor(e,t){super(),this.container=Dc(e,t.vertical),this.params=t,this.width=0,this.height=t.height*this.params.pixelRatio,this.lastPos=0,this.wrapper=null}style(e,t){return Cc(e,t)}createWrapper(){this.wrapper=Dc(this.container.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}handleEvent(e,t){!t&&e.preventDefault();const{clientX:s}=Dc(e.targetTouches?e.targetTouches[0]:e,this.params.vertical),i=this.wrapper.getBoundingClientRect(),a=this.width,o=this.getWidth(),n=this.getProgressPixels(i,s);let r;return r=!this.params.fillParent&&a<o?n*(this.params.pixelRatio/a)||0:(n+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,Mc(r,0,1)}getProgressPixels(e,t){return this.params.rtl?e.right-t:t-e.left}setupWrapperEvents(){this.wrapper.addEventListener("click",e=>{const t=Dc(e,this.params.vertical),s=this.wrapper.offsetHeight-this.wrapper.clientHeight;if(0!==s){const e=this.wrapper.getBoundingClientRect();if(t.clientY>=e.bottom-s)return}this.params.interact&&this.fireEvent("click",e,this.handleEvent(e))}),this.wrapper.addEventListener("dblclick",e=>{this.params.interact&&this.fireEvent("dblclick",e,this.handleEvent(e))}),this.wrapper.addEventListener("scroll",e=>this.fireEvent("scroll",e))}drawPeaks(e,t,s,i){this.setWidth(t)||this.clearWave(),this.params.barWidth?this.drawBars(e,0,s,i):this.drawWave(e,0,s,i)}resetScroll(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}recenter(e){const t=this.wrapper.scrollWidth*e;this.recenterOnPosition(t,!0)}recenterOnPosition(e,t){const{scrollLeft:s}=this.wrapper,i=~~(this.wrapper.clientWidth/2),a=this.wrapper.scrollWidth-this.wrapper.clientWidth;let o=e-i,n=o-s;if(0!=a){if(!t&&-i<=n&&n<i){let e=this.params.autoCenterRate;e/=i,e*=a,n=Math.max(-e,Math.min(e,n)),o=s+n}o=Math.max(0,Math.min(a,o)),o!=s&&(this.wrapper.scrollLeft=o)}}getScrollX(){let e=0;if(this.wrapper){const{pixelRatio:t}=this.params;if(e=Math.round(this.wrapper.scrollLeft*t),this.params.scrollParent){const s=~~(this.wrapper.scrollWidth*t-this.getWidth());e=Math.min(s,Math.max(0,e))}}return e}getWidth(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}setWidth(e){if(this.width==e)return!1;if(this.width=e,this.params.fillParent||this.params.scrollParent)this.style(this.wrapper,{width:""});else{const e=~~(this.width/this.params.pixelRatio)+"px";this.style(this.wrapper,{width:e})}return this.updateSize(),!0}setHeight(e){return e!=this.height&&(this.height=e,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}progress(e){const t=1/this.params.pixelRatio,s=Math.round(e*this.width)*t;if(s<this.lastPos||s-this.lastPos>=t){if(this.lastPos=s,this.params.scrollParent&&this.params.autoCenter){const t=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(t,this.params.autoCenterImmediately)}this.updateProgress(s)}}destroy(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container.domElement&&this.container.removeChild(this.wrapper.domElement),this.wrapper=null)}updateCursor(){}updateSize(){}drawBars(e,t,s,i){}drawWave(e,t,s,i){}clearWave(){}updateProgress(e){}}class Rc{constructor(){this.wave=null,this.waveCtx=null,this.progress=null,this.progressCtx=null,this.start=0,this.end=1,this.id=fc("undefined"!==typeof this.constructor.name?this.constructor.name.toLowerCase()+"_":"canvasentry_"),this.canvasContextAttributes={}}initWave(e){this.wave=e,this.waveCtx=this.wave.getContext("2d",this.canvasContextAttributes)}initProgress(e){this.progress=e,this.progressCtx=this.progress.getContext("2d",this.canvasContextAttributes)}updateDimensions(e,t,s,i){this.start=this.wave.offsetLeft/t||0,this.end=this.start+e/t,this.wave.width=s,this.wave.height=i;const a={width:e+"px"};Cc(this.wave,a),this.hasProgressCanvas&&(this.progress.width=s,this.progress.height=i,Cc(this.progress,a))}clearWave(){this.waveCtx.clearRect(0,0,this.waveCtx.canvas.width,this.waveCtx.canvas.height),this.hasProgressCanvas&&this.progressCtx.clearRect(0,0,this.progressCtx.canvas.width,this.progressCtx.canvas.height)}setFillStyles(e,t){this.waveCtx.fillStyle=e,this.hasProgressCanvas&&(this.progressCtx.fillStyle=t)}applyCanvasTransforms(e){e&&(this.waveCtx.setTransform(0,1,1,0,0,0),this.hasProgressCanvas&&this.progressCtx.setTransform(0,1,1,0,0,0))}fillRects(e,t,s,i,a){this.fillRectToContext(this.waveCtx,e,t,s,i,a),this.hasProgressCanvas&&this.fillRectToContext(this.progressCtx,e,t,s,i,a)}fillRectToContext(e,t,s,i,a,o){e&&(o?this.drawRoundedRect(e,t,s,i,a,o):e.fillRect(t,s,i,a))}drawRoundedRect(e,t,s,i,a,o){0!==a&&(a<0&&(a*=-1,s-=a),e.beginPath(),e.moveTo(t+o,s),e.lineTo(t+i-o,s),e.quadraticCurveTo(t+i,s,t+i,s+o),e.lineTo(t+i,s+a-o),e.quadraticCurveTo(t+i,s+a,t+i-o,s+a),e.lineTo(t+o,s+a),e.quadraticCurveTo(t,s+a,t,s+a-o),e.lineTo(t,s+o),e.quadraticCurveTo(t,s,t+o,s),e.closePath(),e.fill())}drawLines(e,t,s,i,a,o){this.drawLineToContext(this.waveCtx,e,t,s,i,a,o),this.hasProgressCanvas&&this.drawLineToContext(this.progressCtx,e,t,s,i,a,o)}drawLineToContext(e,t,s,i,a,o,n){if(!e)return;const r=t.length/2,l=Math.round(r*this.start),c=Math.round(r*this.end)+1,d=l,u=c,h=this.wave.width/(u-d-1),p=i+a,m=s/i;let g,b,f;for(e.beginPath(),e.moveTo((d-l)*h,p),e.lineTo((d-l)*h,p-Math.round((t[2*d]||0)/m)),g=d;g<u;g++)b=t[2*g]||0,f=Math.round(b/m),e.lineTo((g-l)*h+this.halfPixel,p-f);let v=u-1;for(v;v>=d;v--)b=t[2*v+1]||0,f=Math.round(b/m),e.lineTo((v-l)*h+this.halfPixel,p-f);e.lineTo((d-l)*h,p-Math.round((t[2*d+1]||0)/m)),e.closePath(),e.fill()}destroy(){this.waveCtx=null,this.wave=null,this.progressCtx=null,this.progress=null}getImage(e,t,s){return"blob"===s?new Promise(s=>{this.wave.toBlob(s,e,t)}):"dataURL"===s?this.wave.toDataURL(e,t):void 0}}class zc extends Bc{constructor(e,t){super(e,t),this.maxCanvasWidth=t.maxCanvasWidth,this.maxCanvasElementWidth=Math.round(t.maxCanvasWidth/t.pixelRatio),this.hasProgressCanvas=t.waveColor!=t.progressColor,this.halfPixel=.5/t.pixelRatio,this.canvases=[],this.progressWave=null,this.EntryClass=Rc,this.canvasContextAttributes=t.drawingContextAttributes,this.overlap=2*Math.ceil(t.pixelRatio/2),this.barRadius=t.barRadius||0,this.vertical=t.vertical}init(){this.createWrapper(),this.createElements()}createElements(){this.progressWave=Dc(this.wrapper.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.progressWave,{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}),this.addCanvas(),this.updateCursor()}updateCursor(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}updateSize(){const e=Math.round(this.width/this.params.pixelRatio),t=Math.ceil(e/(this.maxCanvasElementWidth+this.overlap));while(this.canvases.length<t)this.addCanvas();while(this.canvases.length>t)this.removeCanvas();let s=this.maxCanvasWidth+this.overlap;const i=this.canvases.length-1;this.canvases.forEach((e,t)=>{t==i&&(s=this.width-this.maxCanvasWidth*i),this.updateDimensions(e,s,this.height),e.clearWave()})}addCanvas(){const e=new this.EntryClass;e.canvasContextAttributes=this.canvasContextAttributes,e.hasProgressCanvas=this.hasProgressCanvas,e.halfPixel=this.halfPixel;const t=this.maxCanvasElementWidth*this.canvases.length,s=Dc(this.wrapper.appendChild(document.createElement("canvas")),this.params.vertical);if(this.style(s,{position:"absolute",zIndex:2,left:t+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}),e.initWave(s),this.hasProgressCanvas){const s=Dc(this.progressWave.appendChild(document.createElement("canvas")),this.params.vertical);this.style(s,{position:"absolute",left:t+"px",top:0,bottom:0,height:"100%"}),e.initProgress(s)}this.canvases.push(e)}removeCanvas(){let e=this.canvases[this.canvases.length-1];e.wave.parentElement.removeChild(e.wave.domElement),this.hasProgressCanvas&&e.progress.parentElement.removeChild(e.progress.domElement),e&&(e.destroy(),e=null),this.canvases.pop()}updateDimensions(e,t,s){const i=Math.round(t/this.params.pixelRatio),a=Math.round(this.width/this.params.pixelRatio);e.updateDimensions(i,a,t,s),this.style(this.progressWave,{display:"block"})}clearWave(){Oc(()=>{this.canvases.forEach(e=>e.clearWave())})()}drawBars(e,t,s,i){return this.prepareDraw(e,t,s,i,({absmax:e,hasMinVals:t,height:a,offsetY:o,halfH:n,peaks:r,channelIndex:l})=>{if(void 0===s)return;const c=t?2:1,d=r.length/c,u=this.params.barWidth*this.params.pixelRatio,h=null===this.params.barGap?Math.max(this.params.pixelRatio,~~(u/2)):Math.max(this.params.pixelRatio,this.params.barGap*this.params.pixelRatio),p=u+h,m=d/this.width,g=s,b=i;let f=g;for(f;f<b;f+=p){const t=r[Math.floor(f*m*c)]||0;let s=Math.round(t/e*n);0==s&&this.params.barMinHeight&&(s=this.params.barMinHeight),this.fillRect(f+this.halfPixel,n-s+o,u+this.halfPixel,2*s,this.barRadius,l)}})}drawWave(e,t,s,i){return this.prepareDraw(e,t,s,i,({absmax:e,hasMinVals:t,height:a,offsetY:o,halfH:n,peaks:r,channelIndex:l})=>{if(!t){const e=[],t=r.length;let s=0;for(s;s<t;s++)e[2*s]=r[s],e[2*s+1]=-r[s];r=e}void 0!==s&&this.drawLine(r,e,n,o,s,i,l),this.fillRect(0,n+o-this.halfPixel,this.width,this.halfPixel,this.barRadius,l)})}drawLine(e,t,s,i,a,o,n){const{waveColor:r,progressColor:l}=this.params.splitChannelsOptions.channelColors[n]||{};this.canvases.forEach((n,c)=>{this.setFillStyles(n,r,l),this.applyCanvasTransforms(n,this.params.vertical),n.drawLines(e,t,s,i,a,o)})}fillRect(e,t,s,i,a,o){const n=Math.floor(e/this.maxCanvasWidth),r=Math.min(Math.ceil((e+s)/this.maxCanvasWidth)+1,this.canvases.length);let l=n;for(l;l<r;l++){const n=this.canvases[l],r=l*this.maxCanvasWidth,c={x1:Math.max(e,l*this.maxCanvasWidth),y1:t,x2:Math.min(e+s,l*this.maxCanvasWidth+n.wave.width),y2:t+i};if(c.x1<c.x2){const{waveColor:e,progressColor:t}=this.params.splitChannelsOptions.channelColors[o]||{};this.setFillStyles(n,e,t),this.applyCanvasTransforms(n,this.params.vertical),n.fillRects(c.x1-r,c.y1,c.x2-c.x1,c.y2-c.y1,a)}}}hideChannel(e){return this.params.splitChannels&&this.params.splitChannelsOptions.filterChannels.includes(e)}prepareDraw(e,t,s,i,a,o,n){return Oc(()=>{if(e[0]instanceof Array){const t=e;if(this.params.splitChannels){const e=t.filter((e,t)=>!this.hideChannel(t));let o;return this.params.splitChannelsOptions.overlay||this.setHeight(Math.max(e.length,1)*this.params.height*this.params.pixelRatio),this.params.splitChannelsOptions&&this.params.splitChannelsOptions.relativeNormalization&&(o=vc(t.map(e=>wc(e)))),t.forEach((t,n)=>this.prepareDraw(t,n,s,i,a,e.indexOf(t),o))}e=t[0]}if(this.hideChannel(t))return;let r=1/this.params.barHeight;this.params.normalize&&(r=void 0===n?wc(e):n);const l=[].some.call(e,e=>e<0),c=this.params.height*this.params.pixelRatio,d=c/2;let u=c*o||0;return this.params.splitChannelsOptions&&this.params.splitChannelsOptions.overlay&&(u=0),a({absmax:r,hasMinVals:l,height:c,offsetY:u,halfH:d,peaks:e,channelIndex:t})})()}setFillStyles(e,t=this.params.waveColor,s=this.params.progressColor){e.setFillStyles(t,s)}applyCanvasTransforms(e,t=!1){e.applyCanvasTransforms(t)}getImage(e,t,s){if("blob"===s)return Promise.all(this.canvases.map(i=>i.getImage(e,t,s)));if("dataURL"===s){const i=this.canvases.map(i=>i.getImage(e,t,s));return i.length>1?i:i[0]}}updateProgress(e){this.style(this.progressWave,{width:e+"px"})}}const Nc="playing",Fc="paused",Vc="finished";class qc extends xc{supportsWebAudio(){return!(!window.AudioContext&&!window.webkitAudioContext)}getAudioContext(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}getOfflineAudioContext(e){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),window.WaveSurferOfflineAudioContext}constructor(e){super(),Object(fn["a"])(this,"audioContext",null),Object(fn["a"])(this,"offlineAudioContext",null),Object(fn["a"])(this,"stateBehaviors",{[Nc]:{init(){this.addOnAudioProcess()},getPlayedPercents(){const e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime(){return this.startPosition+this.getPlayedTime()}},[Fc]:{init(){this.removeOnAudioProcess()},getPlayedPercents(){const e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime(){return this.startPosition}},[Vc]:{init(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents(){return 1},getCurrentTime(){return this.getDuration()}}}),this.params=e,this.ac=e.audioContext||(this.supportsWebAudio()?this.getAudioContext():{}),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states={[Nc]:Object.create(this.stateBehaviors[Nc]),[Fc]:Object.create(this.stateBehaviors[Fc]),[Vc]:Object.create(this.stateBehaviors[Vc])},this.buffer=null,this.filters=[],this.gainNode=null,this.mergedPeaks=null,this.offlineAc=null,this.peaks=null,this.playbackRate=1,this.analyser=null,this.scriptNode=null,this.source=null,this.splitPeaks=[],this.state=null,this.explicitDuration=e.duration,this.destroyed=!1}init(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(Fc),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}disconnectFilters(){this.filters&&(this.filters.forEach(e=>{e&&e.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))}setState(e){this.state!==this.states[e]&&(this.state=this.states[e],this.state.init.call(this))}setFilter(...e){this.setFilters(e)}setFilters(e){this.disconnectFilters(),e&&e.length&&(this.filters=e,this.analyser.disconnect(),e.reduce((e,t)=>(e.connect(t),t),this.analyser).connect(this.gainNode))}createScriptNode(){this.params.audioScriptProcessor?this.scriptNode=this.params.audioScriptProcessor:this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(qc.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(qc.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}addOnAudioProcess(){this.scriptNode.onaudioprocess=()=>{const e=this.getCurrentTime();e>=this.getDuration()?(this.setState(Vc),this.fireEvent("pause")):e>=this.scheduledPause?this.pause():this.state===this.states[Nc]&&this.fireEvent("audioprocess",e)}}removeOnAudioProcess(){this.scriptNode.onaudioprocess=null}createAnalyserNode(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}createVolumeNode(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}setSinkId(e){if(e){const t=new window.Audio;if(!t.setSinkId)return Promise.reject(new Error("setSinkId is not supported in your browser"));t.autoplay=!0;const s=this.ac.createMediaStreamDestination();return this.gainNode.disconnect(),this.gainNode.connect(s),t.srcObject=s.stream,t.setSinkId(e)}return Promise.reject(new Error("Invalid deviceId: "+e))}setVolume(e){this.gainNode.gain.setValueAtTime(e,this.ac.currentTime)}getVolume(){return this.gainNode.gain.value}decodeArrayBuffer(e,t,s){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),"webkitAudioContext"in window?this.offlineAc.decodeAudioData(e,e=>t(e),s):this.offlineAc.decodeAudioData(e).then(e=>t(e)).catch(e=>s(e))}setPeaks(e,t){null!==t&&(this.explicitDuration=t),this.peaks=e}setLength(e){if(this.mergedPeaks&&e==2*this.mergedPeaks.length-1+2)return;this.splitPeaks=[],this.mergedPeaks=[];const t=this.buffer?this.buffer.numberOfChannels:1;let s;for(s=0;s<t;s++)this.splitPeaks[s]=[],this.splitPeaks[s][2*(e-1)]=0,this.splitPeaks[s][2*(e-1)+1]=0;this.mergedPeaks[2*(e-1)]=0,this.mergedPeaks[2*(e-1)+1]=0}getPeaks(e,t,s){if(this.peaks)return this.peaks;if(!this.buffer)return[];if(t=t||0,s=s||e-1,this.setLength(e),!this.buffer)return this.params.splitChannels?this.splitPeaks:this.mergedPeaks;if(!this.buffer.length){const e=this.createBuffer(1,4096,this.sampleRate);this.buffer=e.buffer}const i=this.buffer.length/e,a=~~(i/10)||1,o=this.buffer.numberOfChannels;let n;for(n=0;n<o;n++){const e=this.splitPeaks[n],o=this.buffer.getChannelData(n);let r;for(r=t;r<=s;r++){const t=~~(r*i),s=~~(t+i);let l,c=o[t],d=c;for(l=t;l<s;l+=a){const e=o[l];e>d&&(d=e),e<c&&(c=e)}e[2*r]=d,e[2*r+1]=c,(0==n||d>this.mergedPeaks[2*r])&&(this.mergedPeaks[2*r]=d),(0==n||c<this.mergedPeaks[2*r+1])&&(this.mergedPeaks[2*r+1]=c)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}getPlayedPercents(){return this.state.getPlayedPercents.call(this)}disconnectSource(){this.source&&this.source.disconnect()}destroyWebAudio(){this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"===typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null)}destroy(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.destroyed=!0,this.destroyWebAudio()}load(e){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=e,this.createSource()}createSource(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.setPlaybackRate(this.playbackRate),this.source.buffer=this.buffer,this.source.connect(this.analyser)}resumeAudioContext(){"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume()}isPaused(){return this.state!==this.states[Nc]}getDuration(){return this.explicitDuration?this.explicitDuration:this.buffer?this.buffer.duration:0}seekTo(e,t){if(this.buffer)return this.scheduledPause=null,null==e&&(e=this.getCurrentTime(),e>=this.getDuration()&&(e=0)),null==t&&(t=this.getDuration()),this.startPosition=e,this.lastPlay=this.ac.currentTime,this.state===this.states[Vc]&&this.setState(Fc),{start:e,end:t}}getPlayedTime(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}play(e,t){if(!this.buffer)return;this.createSource();const s=this.seekTo(e,t);e=s.start,t=s.end,this.scheduledPause=t,this.source.start(0,e),this.resumeAudioContext(),this.setState(Nc),this.fireEvent("play")}pause(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime();try{this.source&&this.source.stop(0)}catch(e){}this.setState(Fc),this.fireEvent("pause")}getCurrentTime(){return this.state.getCurrentTime.call(this)}getPlaybackRate(){return this.playbackRate}setPlaybackRate(e){this.playbackRate=e||1,this.source&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime)}setPlayEnd(e){this.scheduledPause=e}}Object(fn["a"])(qc,"scriptBufferSize",256);class Hc extends qc{constructor(e){super(e),this.params=e,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play(){},pause(){},volume:0},this.mediaType=e.mediaType.toLowerCase(),this.elementPosition=e.elementPosition,this.peaks=null,this.playbackRate=1,this.volume=1,this.isMuted=!1,this.buffer=null,this.onPlayEnd=null,this.mediaListeners={}}init(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}_setupMediaListeners(){this.mediaListeners.error=()=>{this.fireEvent("error","Error loading media element")},this.mediaListeners.canplay=()=>{this.fireEvent("canplay")},this.mediaListeners.ended=()=>{this.fireEvent("finish")},this.mediaListeners.play=()=>{this.fireEvent("play")},this.mediaListeners.pause=()=>{this.fireEvent("pause")},this.mediaListeners.seeked=()=>{this.fireEvent("seek")},this.mediaListeners.volumechange=()=>{this.isMuted=this.media.muted,this.isMuted?this.volume=0:this.volume=this.media.volume,this.fireEvent("volume")},Object.keys(this.mediaListeners).forEach(e=>{this.media.removeEventListener(e,this.mediaListeners[e]),this.media.addEventListener(e,this.mediaListeners[e])})}createTimer(){const e=()=>{this.isPaused()||(this.fireEvent("audioprocess",this.getCurrentTime()),Oc(e)())};this.on("play",e),this.on("pause",()=>{this.fireEvent("audioprocess",this.getCurrentTime())})}load(e,t,s,i){const a=document.createElement(this.mediaType);a.controls=this.params.mediaControls,a.autoplay=this.params.autoplay||!1,a.preload=null==i?"auto":i,a.src=e,a.style.width="100%";const o=t.querySelector(this.mediaType);o&&t.removeChild(o),t.appendChild(a),this._load(a,s,i)}loadElt(e,t){e.controls=this.params.mediaControls,e.autoplay=this.params.autoplay||!1,this._load(e,t,e.preload)}_load(e,t,s){if(!(e instanceof HTMLMediaElement)||"undefined"===typeof e.addEventListener)throw new Error("media parameter is not a valid media element");"function"!==typeof e.load||t&&"none"==s||e.load(),this.media=e,this._setupMediaListeners(),this.peaks=t,this.onPlayEnd=null,this.buffer=null,this.isMuted=e.muted,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}isPaused(){return!this.media||this.media.paused}getDuration(){if(this.explicitDuration)return this.explicitDuration;let{duration:e}=this.buffer||this.media;return e>=1/0&&(e=this.media.seekable.end(0)),e}getCurrentTime(){return this.media&&this.media.currentTime}getPlayedPercents(){return this.getCurrentTime()/this.getDuration()||0}getPlaybackRate(){return this.playbackRate||this.media.playbackRate}setPlaybackRate(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate}seekTo(e){null!=e&&(this.media.currentTime=e),this.clearPlayEnd()}play(e,t){this.seekTo(e);const s=this.media.play();return t&&this.setPlayEnd(t),s}pause(){let e;return this.media&&(e=this.media.pause()),this.clearPlayEnd(),e}setPlayEnd(e){this.clearPlayEnd(),this._onPlayEnd=t=>{t>=e&&(this.pause(),this.seekTo(e))},this.on("audioprocess",this._onPlayEnd)}clearPlayEnd(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}getPeaks(e,t,s){return this.buffer?super.getPeaks(e,t,s):this.peaks||[]}setSinkId(e){return e?this.media.setSinkId?this.media.setSinkId(e):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+e))}getVolume(){return this.volume}setVolume(e){this.volume=e,this.media.volume!==this.volume&&(this.media.volume=this.volume)}setMute(e){this.isMuted=e,this.media.muted=e}destroy(){this.pause(),this.unAll(),this.destroyed=!0,Object.keys(this.mediaListeners).forEach(e=>{this.media&&this.media.removeEventListener(e,this.mediaListeners[e])}),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}class Wc{constructor(){this.clearPeakCache()}clearPeakCache(){this.peakCacheRanges=[],this.peakCacheLength=-1}addRangeToPeakCache(e,t,s){e!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=e);let i=[],a=0;while(a<this.peakCacheRanges.length&&this.peakCacheRanges[a]<t)a+=1;a%2==0&&i.push(t);while(a<this.peakCacheRanges.length&&this.peakCacheRanges[a]<=s)i.push(this.peakCacheRanges[a]),a+=1;a%2==0&&i.push(s),i=i.filter((e,t,s)=>0==t?e!=s[t+1]:t==s.length-1?e!=s[t-1]:e!=s[t-1]&&e!=s[t+1]),this.peakCacheRanges=this.peakCacheRanges.concat(i),this.peakCacheRanges=this.peakCacheRanges.sort((e,t)=>e-t).filter((e,t,s)=>0==t?e!=s[t+1]:t==s.length-1?e!=s[t-1]:e!=s[t-1]&&e!=s[t+1]);const o=[];for(a=0;a<i.length;a+=2)o.push([i[a],i[a+1]]);return o}getCacheRanges(){const e=[];let t;for(t=0;t<this.peakCacheRanges.length;t+=2)e.push([this.peakCacheRanges[t],this.peakCacheRanges[t+1]]);return e}}class Uc extends Hc{constructor(e){super(e),this.params=e,this.sourceMediaElement=null}init(){this.setPlaybackRate(this.params.audioRate),this.createTimer(),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode()}_load(e,t,s){super._load(e,t,s),this.createMediaElementSource(e)}createMediaElementSource(e){this.sourceMediaElement=this.ac.createMediaElementSource(e),this.sourceMediaElement.connect(this.analyser)}play(e,t){return this.resumeAudioContext(),super.play(e,t)}destroy(){super.destroy(),this.destroyWebAudio()}}class Qc extends xc{static create(e){const t=new Qc(e);return t.init()}constructor(e){if(super(),Object(fn["a"])(this,"defaultParams",{byteLength:20971520,audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:!0,autoCenterRate:5,autoCenterImmediately:!1,backend:"WebAudio",backgroundColor:null,barHeight:1,barRadius:0,barGap:null,barMinHeight:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,drawingContextAttributes:{desynchronized:!1},duration:null,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,ignoreSilenceMode:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:zc,responsive:!1,rtl:!1,scrollParent:!1,skipLength:2,splitChannels:!1,splitChannelsOptions:{overlay:!1,channelColors:{},filterChannels:[],relativeNormalization:!1},vertical:!1,waveColor:"#999",xhr:{}}),Object(fn["a"])(this,"backends",{MediaElement:Hc,WebAudio:qc,MediaElementWebAudio:Uc}),Object(fn["a"])(this,"util",i),this.params=Object.assign({},this.defaultParams,e),this.params.splitChannelsOptions=Object.assign({},this.defaultParams.splitChannelsOptions,e.splitChannelsOptions),this.container="string"===typeof e.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(null==this.params.mediaContainer?this.mediaContainer=this.container:"string"===typeof this.params.mediaContainer?this.mediaContainer=document.querySelector(this.params.mediaContainer):this.mediaContainer=this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");if(this.params.maxCanvasWidth<=1)throw new Error("maxCanvasWidth must be greater than 1");if(this.params.maxCanvasWidth%2==1)throw new Error("maxCanvasWidth must be an even number");if(!0===this.params.rtl&&(!0===this.params.vertical?Cc(this.container,{transform:"rotateX(180deg)"}):Cc(this.container,{transform:"rotateY(180deg)"})),this.params.backgroundColor&&this.setBackgroundColor(this.params.backgroundColor),this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.currentRequest=null,this.arraybuffer=null,this.drawer=null,this.backend=null,this.peakCache=null,"function"!==typeof this.params.renderer)throw new Error("Renderer parameter is invalid");this.Drawer=this.params.renderer,"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend&&"MediaElementWebAudio"!==this.params.backend||qc.prototype.supportsWebAudio.call(null)||(this.params.backend="MediaElement"),this.Backend=this.backends[this.params.backend],this.initialisedPluginList={},this.isDestroyed=!1,this.isReady=!1;let t=0;return this._onResize=Ac.a(()=>{t==this.drawer.wrapper.clientWidth||this.params.scrollParent||(t=this.drawer.wrapper.clientWidth,this.drawer.fireEvent("redraw"))},"number"===typeof this.params.responsive?this.params.responsive:100),this}init(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}registerPlugins(e){return e.forEach(e=>this.addPlugin(e)),e.forEach(e=>{e.deferInit||this.initPlugin(e.name)}),this.fireEvent("plugins-registered",e),this}getActivePlugins(){return this.initialisedPluginList}addPlugin(e){if(!e.name)throw new Error("Plugin does not have a name!");if(!e.instance)throw new Error(`Plugin ${e.name} does not have an instance property!`);e.staticProps&&Object.keys(e.staticProps).forEach(t=>{this[t]=e.staticProps[t]});const t=e.instance,s=Object.getOwnPropertyNames(xc.prototype);return s.forEach(e=>{t.prototype[e]=xc.prototype[e]}),this[e.name]=new t(e.params||{},this),this.fireEvent("plugin-added",e.name),this}initPlugin(e){if(!this[e])throw new Error(`Plugin ${e} has not been added yet!`);return this.initialisedPluginList[e]&&this.destroyPlugin(e),this[e].init(),this.initialisedPluginList[e]=!0,this.fireEvent("plugin-initialised",e),this}destroyPlugin(e){if(!this[e])throw new Error(`Plugin ${e} has not been added yet and cannot be destroyed!`);if(!this.initialisedPluginList[e])throw new Error(`Plugin ${e} is not active and cannot be destroyed!`);if("function"!==typeof this[e].destroy)throw new Error(`Plugin ${e} does not have a destroy function!`);return this[e].destroy(),delete this.initialisedPluginList[e],this.fireEvent("plugin-destroyed",e),this}destroyAllPlugins(){Object.keys(this.initialisedPluginList).forEach(e=>this.destroyPlugin(e))}createDrawer(){this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",()=>{this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents())}),this.drawer.on("click",(e,t)=>{setTimeout(()=>this.seekTo(t),0)}),this.drawer.on("scroll",e=>{this.params.partialRender&&this.drawBuffer(),this.fireEvent("scroll",e)})}createBackend(){this.backend&&this.backend.destroy(),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",()=>{this.drawer.progress(this.backend.getPlayedPercents()),this.fireEvent("finish")}),this.backend.on("play",()=>this.fireEvent("play")),this.backend.on("pause",()=>this.fireEvent("pause")),this.backend.on("audioprocess",e=>{this.drawer.progress(this.backend.getPlayedPercents()),this.fireEvent("audioprocess",e)}),"MediaElement"!==this.params.backend&&"MediaElementWebAudio"!==this.params.backend||(this.backend.on("seek",()=>{this.drawer.progress(this.backend.getPlayedPercents())}),this.backend.on("volume",()=>{const e=this.getVolume();this.fireEvent("volume",e),this.backend.isMuted!==this.isMuted&&(this.isMuted=this.backend.isMuted,this.fireEvent("mute",this.isMuted))}))}createPeakCache(){this.params.partialRender&&(this.peakCache=new Wc)}getDuration(){return this.backend.getDuration()}getCurrentTime(){return this.backend.getCurrentTime()}setCurrentTime(e){e>=this.getDuration()?this.seekTo(1):this.seekTo(e/this.getDuration())}updateTimeInterval(e){if(this.timeline&&this.timeline.params){const t=t=>e;this.timeline.params.timeInterval=t,this.timeline.render()}}play(e,t){return this.params.ignoreSilenceMode&&Pc(),this.fireEvent("interaction",()=>this.play(e,t)),this.backend.play(e,t)}setPlayEnd(e){this.backend.setPlayEnd(e)}pause(){if(!this.backend.isPaused())return this.backend.pause()}playPause(){return this.backend.isPaused()?this.play():this.pause()}isPlaying(){return!this.backend.isPaused()}skipBackward(e){this.skip(-e||-this.params.skipLength)}skipForward(e){this.skip(e||this.params.skipLength)}skip(e){const t=this.getDuration()||1;let s=this.getCurrentTime()||0;s=Math.max(0,Math.min(t,s+(e||0))),this.seekAndCenter(s/t)}seekAndCenter(e){this.seekTo(e),this.drawer.recenter(e)}seekTo(e){if("number"!==typeof e||!isFinite(e)||e<0||e>1)throw new Error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",()=>this.seekTo(e));const t="WebAudio"===this.params.backend,s=this.backend.isPaused();t&&!s&&this.backend.pause();const i=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(e*this.getDuration()),this.drawer.progress(e),t&&!s&&this.backend.play(),this.params.scrollParent=i,this.fireEvent("seek",e)}stop(){this.pause(),this.seekTo(0),this.drawer.progress(0)}setSinkId(e){return this.backend.setSinkId(e)}setVolume(e){this.backend.setVolume(e),this.fireEvent("volume",e)}getVolume(){return this.backend.getVolume()}setPlaybackRate(e){this.backend.setPlaybackRate(e)}getPlaybackRate(){return this.backend.getPlaybackRate()}toggleMute(){this.setMute(!this.isMuted)}setMute(e){e!==this.isMuted?(this.backend.setMute?(this.backend.setMute(e),this.isMuted=e):e?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted)):this.fireEvent("mute",this.isMuted)}getMute(){return this.isMuted}getFilters(){return this.backend.filters||[]}toggleScroll(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}toggleInteraction(){this.params.interact=!this.params.interact}getWaveColor(){return this.params.waveColor}setWaveColor(e){this.params.waveColor=e,this.drawBuffer()}getProgressColor(){return this.params.progressColor}setProgressColor(e){this.params.progressColor=e,this.drawBuffer()}getBackgroundColor(){return this.params.backgroundColor}setBackgroundColor(e){this.params.backgroundColor=e,Cc(this.container,{background:this.params.backgroundColor})}getCursorColor(){return this.params.cursorColor}setCursorColor(e){this.params.cursorColor=e,this.drawer.updateCursor()}getHeight(){return this.params.height}setHeight(e){this.params.height=e,this.drawer.setHeight(e*this.params.pixelRatio),this.drawBuffer()}setFilteredChannels(e){this.params.splitChannelsOptions.filterChannels=e,this.drawBuffer()}drawBuffer(){const e=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),t=this.drawer.getWidth();let s,i=e,a=0,o=Math.max(a+t,i);if(this.params.fillParent&&(!this.params.scrollParent||e<t)&&(i=t,a=0,o=i),this.params.partialRender){const e=this.peakCache.addRangeToPeakCache(i,a,o);let t;for(t=0;t<e.length;t++)s=this.backend.getPeaks(i,e[t][0],e[t][1]),this.drawer.drawPeaks(s,i,e[t][0],e[t][1])}else s=this.backend.getPeaks(i,a,o),this.drawer.drawPeaks(s,i,a,o);this.fireEvent("redraw",s,i)}zoom(e){e?(this.params.minPxPerSec=e,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",e)}loadArrayBuffer(e){this.decodeArrayBuffer(e,e=>{this.isDestroyed||this.loadDecodedBuffer(e)})}loadDecodedBuffer(e){this.backend.load(e),this.drawBuffer(),this.isReady=!0,this.fireEvent("ready")}loadBlob(e){const t=new FileReader;t.addEventListener("progress",e=>this.onProgress(e)),t.addEventListener("load",e=>this.loadArrayBuffer(e.target.result)),t.addEventListener("error",()=>this.fireEvent("error","Error reading file")),t.readAsArrayBuffer(e),this.empty()}load(e,t,s,i){if(!e)throw new Error("url parameter cannot be empty");if(this.empty(),s){const i={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(s),"Peaks are not provided":!t,"Backend is not of type 'MediaElement' or 'MediaElementWebAudio'":-1===["MediaElement","MediaElementWebAudio"].indexOf(this.params.backend),"Url is not of type string":"string"!==typeof e},a=Object.keys(i).filter(e=>i[e]);a.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+a.join("\n\t- ")),s=null)}switch("WebAudio"===this.params.backend&&e instanceof HTMLMediaElement&&(e=e.src),this.params.backend){case"WebAudio":return this.loadBuffer(e,t,i);case"MediaElement":case"MediaElementWebAudio":return this.loadMediaElement(e,t,s,i)}}loadBuffer(e,t,s){const i=t=>(t&&this.tmpEvents.push(this.once("ready",t)),this.getArrayBuffer(e,e=>this.loadArrayBuffer(e)));if(!t)return i();this.backend.setPeaks(t,s),this.drawBuffer(),this.fireEvent("waveform-ready"),this.tmpEvents.push(this.once("interaction",i))}loadMediaElement(e,t,s,i){let a=e;if("string"===typeof e)this.backend.load(a,this.mediaContainer,t,s);else{const s=e;this.backend.loadElt(s,t),a=s.src}this.tmpEvents.push(this.backend.once("canplay",()=>{this.backend.destroyed||(this.drawBuffer(),this.isReady=!0,this.fireEvent("ready"))}),this.backend.once("error",e=>this.fireEvent("error",e))),t&&(this.backend.setPeaks(t,i),this.drawBuffer(),this.fireEvent("waveform-ready")),t&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(a,e=>{console.log("设定资源大小",this.params.byteLength),console.log("实际资源大小",e.byteLength),e.byteLength>this.params.byteLength?console.log("资源过大，不展示波形"):(console.log(e),this.decodeArrayBuffer(e,e=>{console.log(e),this.backend.buffer=e,this.backend.setPeaks(null),this.drawBuffer(),this.fireEvent("waveform-ready")}))})}decodeArrayBuffer(e,t){this.isDestroyed||(this.arraybuffer=e,this.backend.decodeArrayBuffer(e,s=>{this.isDestroyed||this.arraybuffer!=e||(t(s),this.arraybuffer=null)},()=>this.fireEvent("error","Error decoding audiobuffer")))}getArrayBuffer(e,t){const s=Object.assign({url:e,responseType:"arraybuffer"},this.params.xhr),i=$c(s);return this.currentRequest=i,this.tmpEvents.push(i.on("progress",e=>{this.onProgress(e)}),i.on("success",e=>{t(e),this.currentRequest=null}),i.on("error",e=>{this.fireEvent("error",e),this.currentRequest=null})),i}onProgress(e){let t;t=e.lengthComputable?e.loaded/e.total:e.loaded/(e.loaded+1e6),this.fireEvent("loading",Math.round(100*t),e.target)}exportPCM(e,t,s,i,a){e=e||1024,i=i||0,t=t||1e4,s=s||!1;const o=this.backend.getPeaks(e,i,a),n=[].map.call(o,e=>Math.round(e*t)/t);return new Promise((e,t)=>{if(!s){const e=new Blob([JSON.stringify(n)],{type:"application/json;charset=utf-8"}),t=URL.createObjectURL(e);window.open(t),URL.revokeObjectURL(t)}e(n)})}exportImage(e,t,s){return e||(e="image/png"),t||(t=1),s||(s="dataURL"),this.drawer.getImage(e,t,s)}cancelAjax(){this.currentRequest&&this.currentRequest.controller&&(this.currentRequest._reader&&this.currentRequest._reader.cancel().catch(e=>{console.log(e)}),this.currentRequest.controller.abort(),this.currentRequest=null)}clearTmpEvents(){this.tmpEvents.forEach(e=>e.un())}empty(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}destroy(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend&&(this.backend.destroy(),this.backend=null),this.drawer&&this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}Object(fn["a"])(Qc,"util",i);class Jc{static create(e){return{name:"timeline",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,instance:Jc}}constructor(e,t){if(Object(fn["a"])(this,"_onScroll",()=>{this.wrapper&&this.drawer.wrapper&&(this.wrapper.scrollLeft=this.drawer.wrapper.scrollLeft)}),Object(fn["a"])(this,"_onRedraw",()=>this.render()),Object(fn["a"])(this,"_onReady",()=>{const e=this.wavesurfer;this.drawer=e.drawer,this.pixelRatio=e.drawer.params.pixelRatio,this.maxCanvasWidth=e.drawer.maxCanvasWidth||e.drawer.width,this.maxCanvasElementWidth=e.drawer.maxCanvasElementWidth||Math.round(this.maxCanvasWidth/this.pixelRatio),e.drawer.wrapper.addEventListener("scroll",this._onScroll),e.on("redraw",this._onRedraw),e.on("zoom",this._onZoom),this.render()}),Object(fn["a"])(this,"_onWrapperClick",e=>{e.preventDefault();const t="offsetX"in e?e.offsetX:e.layerX;this.fireEvent("click",t/this.wrapper.scrollWidth||0)}),this.container="string"===typeof e.container?document.querySelector(e.container):e.container,!this.container)throw new Error("No container for wavesurfer timeline");this.wavesurfer=t,this.util=t.util,this.params=Object.assign({},{height:20,notchPercentHeight:90,labelPadding:5,unlabeledNotchColor:"#c0c0c0",primaryColor:"#000",secondaryColor:"#c0c0c0",primaryFontColor:"#000",secondaryFontColor:"#000",fontFamily:"Arial",fontSize:10,duration:null,zoomDebounce:!1,formatTimeCallback:this.defaultFormatTimeCallback,timeInterval:this.defaultTimeInterval,primaryLabelInterval:this.defaultPrimaryLabelInterval,secondaryLabelInterval:this.defaultSecondaryLabelInterval,offset:0},e),this.canvases=[],this.wrapper=null,this.drawer=null,this.pixelRatio=null,this.maxCanvasWidth=null,this.maxCanvasElementWidth=null,this._onZoom=this.params.zoomDebounce?this.wavesurfer.util.debounce(()=>this.render(),this.params.zoomDebounce):()=>this.render()}init(){this.wavesurfer.isReady?this._onReady():this.wavesurfer.once("ready",this._onReady)}destroy(){this.unAll(),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.un("zoom",this._onZoom),this.wavesurfer.un("ready",this._onReady),this.wavesurfer.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wrapper&&this.wrapper.parentNode&&(this.wrapper.removeEventListener("click",this._onWrapperClick),this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}createWrapper(){const e=this.wavesurfer.params;this.container.innerHTML="",this.wrapper=this.container.appendChild(document.createElement("timeline")),this.util.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(e.fillParent||e.scrollParent)&&this.util.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.wrapper.addEventListener("click",this._onWrapperClick)}render(){this.wrapper||this.createWrapper(),this.updateCanvases(),this.updateCanvasesPositioning(),this.renderCanvases()}addCanvas(){const e=this.wrapper.appendChild(document.createElement("canvas"));this.canvases.push(e),this.util.style(e,{position:"absolute",zIndex:4})}removeCanvas(){const e=this.canvases.pop();e.parentElement.removeChild(e)}updateCanvases(){const e=Math.round(this.drawer.wrapper.scrollWidth),t=Math.ceil(e/this.maxCanvasElementWidth);while(this.canvases.length<t)this.addCanvas();while(this.canvases.length>t)this.removeCanvas()}updateCanvasesPositioning(){const e=this.canvases.length;this.canvases.forEach((t,s)=>{const i=s===e-1?this.drawer.wrapper.scrollWidth-this.maxCanvasElementWidth*(e-1):this.maxCanvasElementWidth;t.width=i*this.pixelRatio,t.height=(this.params.height+1)*this.pixelRatio,this.util.style(t,{width:i+"px",height:this.params.height+"px",left:s*this.maxCanvasElementWidth+"px"})})}renderCanvases(){const e=this.params.duration||this.wavesurfer.backend.getDuration();if(e<=0)return;const t=this.wavesurfer.params,s=this.params.fontSize*t.pixelRatio,i=parseInt(e,10)+1,a=t.fillParent&&!t.scrollParent?this.drawer.getWidth():this.drawer.wrapper.scrollWidth*t.pixelRatio,o=this.params.height*this.pixelRatio,n=this.params.height*(this.params.notchPercentHeight/100)*this.pixelRatio,r=a/e,l=this.params.formatTimeCallback,c=e=>"function"===typeof e?e(r):e,d=c(this.params.timeInterval),u=c(this.params.primaryLabelInterval),h=c(this.params.secondaryLabelInterval);let p,m=r*this.params.offset,g=0;const b=[];for(p=0;p<i/d;p++)b.push([p,g,m]),g+=d,m+=r*d;const f=e=>{b.forEach(t=>{e(t[0],t[1],t[2])})};this.setFillStyles(this.params.primaryColor),this.setFonts(`${s}px ${this.params.fontFamily}`),this.setFillStyles(this.params.primaryFontColor),f((e,t,s)=>{e%u===0&&(this.fillRect(s,0,1,o),this.fillText(l(t,r),s+this.params.labelPadding*this.pixelRatio,o))}),this.setFillStyles(this.params.secondaryColor),this.setFonts(`${s}px ${this.params.fontFamily}`),this.setFillStyles(this.params.secondaryFontColor),f((e,t,s)=>{e%h===0&&(this.fillRect(s,0,1,o),this.fillText(l(t,r),s+this.params.labelPadding*this.pixelRatio,o))}),this.setFillStyles(this.params.unlabeledNotchColor),f((e,t,s)=>{e%h!==0&&e%u!==0&&this.fillRect(s,0,1,n)})}setFillStyles(e){this.canvases.forEach(t=>{const s=t.getContext("2d");s&&(s.fillStyle=e)})}setFonts(e){this.canvases.forEach(t=>{const s=t.getContext("2d");s&&(s.font=e)})}fillRect(e,t,s,i){this.canvases.forEach((a,o)=>{const n=o*this.maxCanvasWidth,r={x1:Math.max(e,o*this.maxCanvasWidth),y1:t,x2:Math.min(e+s,o*this.maxCanvasWidth+a.width),y2:t+i};if(r.x1<r.x2){const e=a.getContext("2d");e&&e.fillRect(r.x1-n,r.y1,r.x2-r.x1,r.y2-r.y1)}})}fillText(e,t,s){let i,a=0;this.canvases.forEach(o=>{const n=o.getContext("2d"),r=n.canvas.width;a>t+i||(a+r>t&&n&&(i=n.measureText(e).width,n.fillText(e,t-a,s)),a+=r)})}defaultFormatTimeCallback(e,t){if(e/60>1){const t=parseInt(e/60,10);return e=parseInt(e%60,10),e=e<10?"0"+e:e,`${t}:${e}`}return Math.round(1e3*e)/1e3}defaultTimeInterval(e){return e>=25?1:5*e>=25?5:15*e>=25?15:60*Math.ceil(.5/e)}defaultPrimaryLabelInterval(e){return e>=25?10:5*e>=25?6:4}defaultSecondaryLabelInterval(e){return e>=25?5:2}}class Gc{constructor(e,t,s){var i;this.wavesurfer=s,this.wrapper=s.drawer.wrapper,this.util=s.util,this.style=this.util.style,this.regionsUtil=t,this.vertical=s.drawer.params.vertical,this.id=null==e.id?s.util.getId():e.id,this.start=Number(e.start)||0,this.end=null==e.end?this.start+4/this.wrapper.scrollWidth*this.wavesurfer.getDuration():Number(e.end),this.resize=void 0===e.resize||Boolean(e.resize),this.drag=void 0===e.drag||Boolean(e.drag),this.isResizing=!1,this.isDragging=!1,this.loop=Boolean(e.loop),this.color=e.color||"rgba(0, 0, 0, 0.1)",this.handleStyle=e.handleStyle||{left:{},right:{}},this.handleLeftEl=null,this.handleRightEl=null,this.data=e.data||{},this.attributes=e.attributes||{},this.showTooltip=null===(i=e.showTooltip)||void 0===i||i,this.maxLength=e.maxLength,this.minLength=e.minLength,this._onRedraw=()=>this.updateRender(),this.scroll=!1!==e.scroll&&s.params.scrollParent,this.scrollSpeed=e.scrollSpeed||1,this.scrollThreshold=e.scrollThreshold||10,this.preventContextMenu=void 0!==e.preventContextMenu&&Boolean(e.preventContextMenu);const a=null==e.channelIdx?-1:parseInt(e.channelIdx,10);if(this.regionHeight="100%",this.marginTop="0px",-1!==a){const e=null!=this.wavesurfer.backend.buffer?this.wavesurfer.backend.buffer.numberOfChannels:-1;e>=0&&a<e&&(this.regionHeight=Math.floor(1/e*100)+"%",this.marginTop=this.wavesurfer.getHeight()*a+"px")}this.formatTimeCallback=e.formatTimeCallback,this.edgeScrollWidth=e.edgeScrollWidth,this.bindInOut(),this.render(),this.wavesurfer.on("zoom",this._onRedraw),this.wavesurfer.on("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-created",this)}update(e){null!=e.start&&(this.start=Number(e.start)),null!=e.end&&(this.end=Number(e.end)),null!=e.loop&&(this.loop=Boolean(e.loop)),null!=e.color&&(this.color=e.color),null!=e.handleStyle&&(this.handleStyle=e.handleStyle),null!=e.data&&(this.data=e.data),null!=e.resize&&(this.resize=Boolean(e.resize),this.updateHandlesResize(this.resize)),null!=e.drag&&(this.drag=Boolean(e.drag)),null!=e.maxLength&&(this.maxLength=Number(e.maxLength)),null!=e.minLength&&(this.minLength=Number(e.minLength)),null!=e.attributes&&(this.attributes=e.attributes),this.updateRender(),this.fireEvent("update"),this.wavesurfer.fireEvent("region-updated",this)}remove(){this.element&&(this.wrapper.removeChild(this.element.domElement),this.element=null,this.fireEvent("remove"),this.wavesurfer.un("zoom",this._onRedraw),this.wavesurfer.un("redraw",this._onRedraw),this.wavesurfer.fireEvent("region-removed",this))}play(e){const t=e||this.start;this.wavesurfer.play(t,this.end),this.fireEvent("play"),this.wavesurfer.fireEvent("region-play",this)}playLoop(e){this.loop=!0,this.play(e)}setLoop(e){this.loop=e}render(){this.element=this.util.withOrientation(this.wrapper.appendChild(document.createElement("region")),this.vertical),this.element.className="wavesurfer-region",this.showTooltip&&(this.element.title=this.formatTime(this.start,this.end)),this.element.setAttribute("data-id",this.id);for(const e in this.attributes)this.element.setAttribute("data-region-"+e,this.attributes[e]);if(this.style(this.element,{position:"absolute",zIndex:2,height:this.regionHeight,top:this.marginTop}),this.resize){this.handleLeftEl=this.util.withOrientation(this.element.appendChild(document.createElement("handle")),this.vertical),this.handleRightEl=this.util.withOrientation(this.element.appendChild(document.createElement("handle")),this.vertical),this.handleLeftEl.className="wavesurfer-handle wavesurfer-handle-start",this.handleRightEl.className="wavesurfer-handle wavesurfer-handle-end";const e={cursor:this.vertical?"row-resize":"col-resize",position:"absolute",top:"0px",width:"2px",height:"100%",backgroundColor:"rgba(0, 0, 0, 1)"},t="none"!==this.handleStyle.left?Object.assign({left:"0px"},e,this.handleStyle.left):null,s="none"!==this.handleStyle.right?Object.assign({right:"0px"},e,this.handleStyle.right):null;t&&this.style(this.handleLeftEl,t),s&&this.style(this.handleRightEl,s)}this.updateRender(),this.bindEvents()}formatTime(e,t){return this.formatTimeCallback?this.formatTimeCallback(e,t):(e==t?[e]:[e,t]).map(e=>[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2)].join(":")).join("-")}getWidth(){return this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio}updateRender(){const e=this.wavesurfer.getDuration(),t=this.getWidth();let s=this.start,i=this.end;if(s<0&&(s=0,i-=s),i>e&&(i=e,s=e-(i-s)),null!=this.minLength&&(i=Math.max(s+this.minLength,i)),null!=this.maxLength&&(i=Math.min(s+this.maxLength,i)),null!=this.element){const a=Math.round(s/e*t),o=Math.round(i/e*t)-a;this.style(this.element,{left:a+"px",width:o+"px",backgroundColor:this.color,cursor:this.drag?"move":"default"});for(const e in this.attributes)this.element.setAttribute("data-region-"+e,this.attributes[e]);this.showTooltip&&(this.element.title=this.formatTime(this.start,this.end))}}bindInOut(){this.firedIn=!1,this.firedOut=!1;const e=e=>{const t=Math.round(10*this.start)/10,s=Math.round(10*this.end)/10;e=Math.round(10*e)/10,!this.firedOut&&this.firedIn&&(t>e||s<=e)&&(this.firedOut=!0,this.firedIn=!1,this.fireEvent("out"),this.wavesurfer.fireEvent("region-out",this)),!this.firedIn&&t<=e&&s>e&&(this.firedIn=!0,this.firedOut=!1,this.fireEvent("in"),this.wavesurfer.fireEvent("region-in",this))};this.wavesurfer.backend.on("audioprocess",e),this.on("remove",()=>{this.wavesurfer.backend.un("audioprocess",e)}),this.on("out",()=>{if(this.loop){const e=this.wavesurfer.getCurrentTime();e>=this.start&&e<=this.end&&this.wavesurfer.play(this.start)}})}bindEvents(){const{preventContextMenu:e}=this;this.element.addEventListener("mouseenter",e=>{this.fireEvent("mouseenter",e),this.wavesurfer.fireEvent("region-mouseenter",this,e)}),this.element.addEventListener("mouseleave",e=>{this.fireEvent("mouseleave",e),this.wavesurfer.fireEvent("region-mouseleave",this,e)}),this.element.addEventListener("click",e=>{e.preventDefault(),this.fireEvent("click",e),this.wavesurfer.fireEvent("region-click",this,e)}),this.element.addEventListener("dblclick",e=>{e.stopPropagation(),e.preventDefault(),this.fireEvent("dblclick",e),this.wavesurfer.fireEvent("region-dblclick",this,e)}),this.element.addEventListener("contextmenu",t=>{e&&t.preventDefault(),this.fireEvent("contextmenu",t),this.wavesurfer.fireEvent("region-contextmenu",this,t)}),(this.drag||this.resize)&&this.bindDragEvents()}bindDragEvents(){const{container:e}=this.wavesurfer.drawer,{scrollSpeed:t}=this,{scrollThreshold:s}=this;let i,a,o,n,r,l,c,d,u,h=!1;const p=e=>{const s=this.util.withOrientation(e,this.vertical),a=this.wavesurfer.getDuration();if(!l||!o&&!r)return;const h=s.clientX;let m=0,g=0,b=0,f=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(e)*a);if(o)-1===l?(g=d*this.wavesurfer.params.minPxPerSec,m=h-c.left):(g=u*this.wavesurfer.params.minPxPerSec,m=c.right-h);else{let{minLength:e}=this;e||(e=0),"start"===r?(f>this.end-e&&(f=this.end-e,b=t*l),f<0&&(f=0)):"end"===r&&(f<this.start+e&&(f=this.start+e,b=t*l),f>a&&(f=a))}const v=this.wrapper.scrollLeft;if(-1===l){if(0===Math.round(v))return;if(Math.round(v-g+m)<=0)return}else{if(Math.round(v)===n)return;if(Math.round(v+g-m)>=n)return}let y=v-b+t*l;if(-1===l){const e=Math.max(0+g-m,y);this.wrapper.scrollLeft=y=e}else{const e=Math.min(n-g+m,y);this.wrapper.scrollLeft=y=e}const w=f-i;i=f,o?this.onDrag(w):this.onResize(w,r),window.requestAnimationFrame(()=>{p(e)})},m=e=>{const t=this.wavesurfer.getDuration();e.touches&&e.touches.length>1||(a=e.targetTouches?e.targetTouches[0].identifier:null,(this.drag||this.resize)&&e.stopPropagation(),i=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(e,!0)*t),d=i-this.start,u=this.end-i,n=this.wrapper.scrollWidth-this.wrapper.clientWidth,c=this.util.withOrientation(this.wrapper.getBoundingClientRect(),this.vertical),this.isResizing=!1,this.isDragging=!1,"handle"===e.target.tagName.toLowerCase()?(this.isResizing=!0,r=e.target.classList.contains("wavesurfer-handle-start")?"start":"end"):(this.isDragging=!0,o=!0,r=!1))},g=e=>{e.touches&&e.touches.length>1||((o||r)&&(this.isDragging=!1,this.isResizing=!1,o=!1,l=null,r=!1),h&&(h=!1,this.util.preventClick(),this.fireEvent("update-end",e),this.wavesurfer.fireEvent("region-update-end",this,e)))},b=t=>{const s=this.wavesurfer.getDuration(),n=this.util.withOrientation(t,this.vertical);if(t.touches&&t.touches.length>1)return;if(t.targetTouches&&t.targetTouches[0].identifier!=a)return;if(!o&&!r)return;let m=this.regionsUtil.getRegionSnapToGridValue(this.wavesurfer.drawer.handleEvent(t)*s);if(o){const e=this.wavesurfer.getDuration();m>e-u&&(m=e-u),m-d<0&&(m=d)}if(r){let{minLength:e}=this;e||(e=0),"start"===r?(m>this.end-e&&(m=this.end-e),m<0&&(m=0)):"end"===r&&(m<this.start+e&&(m=this.start+e),m>s&&(m=s))}const g=m-i;if(i=m,this.drag&&o&&(h=h||!!g,this.onDrag(g)),this.resize&&r&&(h=h||!!g,this.onResize(g,r)),this.scroll&&e.clientWidth<this.wrapper.scrollWidth){const e=n.clientX;l=e<c.left+this.edgeScrollWidth?-1:e>c.right-this.edgeScrollWidth?1:null,l&&p(t)}};this.element.addEventListener("mousedown",m),this.element.addEventListener("touchstart",m),document.body.addEventListener("mousemove",b),document.body.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("mouseup",g),document.body.addEventListener("touchend",g),this.on("remove",()=>{document.removeEventListener("mouseup",g),document.body.removeEventListener("touchend",g),document.body.removeEventListener("mousemove",b),document.body.removeEventListener("touchmove",b)}),this.wavesurfer.on("destroy",()=>{document.removeEventListener("mouseup",g),document.body.removeEventListener("touchend",g)})}onDrag(e){const t=this.wavesurfer.getDuration();this.end+e>t&&(e=t-this.end),this.start+e<0&&(e=-1*this.start),this.update({start:this.start+e,end:this.end+e})}onResize(e,t){const s=this.wavesurfer.getDuration();"start"===t?(e>0&&this.end-(this.start+e)<this.minLength&&(e=this.end-this.minLength-this.start),e<0&&this.start+e<0&&(e=-1*this.start),this.update({start:Math.min(this.start+e,this.end),end:Math.max(this.start+e,this.end)})):(e<0&&this.end+e-this.start<this.minLength&&(e=this.start+this.minLength-this.end),e>0&&this.end+e>s&&(e=s-this.end),this.update({start:Math.min(this.end+e,this.start),end:Math.max(this.end+e,this.start)}))}updateHandlesResize(e){let t;t=e?this.vertical?"row-resize":"col-resize":"auto",this.handleLeftEl&&this.style(this.handleLeftEl,{cursor:t}),this.handleRightEl&&this.style(this.handleRightEl,{cursor:t})}}class Kc{static create(e){return{name:"regions",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{addRegion(e){return this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.add(e)},clearRegions(){this.regions&&this.regions.clear()},enableDragSelection(e){this.initialisedPluginList.regions||this.initPlugin("regions"),this.regions.enableDragSelection(e)},disableDragSelection(){this.regions.disableDragSelection()}},instance:Kc}}constructor(e,t){this.params=e,this.wavesurfer=t,this.util={...t.util,getRegionSnapToGridValue:t=>this.getRegionSnapToGridValue(t,e)},this.maxRegions=e.maxRegions,this.regionsMinLength=e.regionsMinLength||null;const s=Object.getOwnPropertyNames(this.util.Observer.prototype);s.forEach(e=>{Gc.prototype[e]=this.util.Observer.prototype[e]}),this.wavesurfer.Region=Gc;const i=.05;this._onBackendCreated=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.orientation=this.wavesurfer.drawer.orientation,this.params.regions&&this.params.regions.forEach(e=>{e.edgeScrollWidth=this.params.edgeScrollWidth||this.wrapper.clientWidth*i,this.add(e)})},this.list={},this._onReady=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.vertical=this.wavesurfer.drawer.params.vertical,this.params.dragSelection&&this.enableDragSelection(this.params),Object.keys(this.list).forEach(e=>{this.list[e].updateRender()})}}init(){this.wavesurfer.isReady?(this._onBackendCreated(),this._onReady()):(this.wavesurfer.once("ready",this._onReady),this.wavesurfer.once("backend-created",this._onBackendCreated))}destroy(){this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("backend-created",this._onBackendCreated),this.disableDragSelection(),this.clear()}wouldExceedMaxRegions(){return this.maxRegions&&Object.keys(this.list).length>=this.maxRegions}add(e){if(this.wouldExceedMaxRegions())return null;!e.minLength&&this.regionsMinLength&&(e={...e,minLength:this.regionsMinLength});const t=new this.wavesurfer.Region(e,this.util,this.wavesurfer);return this.list[t.id]=t,t.on("remove",()=>{delete this.list[t.id]}),t}clear(){Object.keys(this.list).forEach(e=>{this.list[e].remove()})}enableDragSelection(e){this.disableDragSelection();const t=e.slop||2,{container:s}=this.wavesurfer.drawer,i=!1!==e.scroll&&this.wavesurfer.params.scrollParent,a=e.scrollSpeed||1,o=e.scrollThreshold||10;let n,r,l,c,d,u,h,p=this.wavesurfer.getDuration(),m=0;const g=e=>{if(!c||!u)return;let t=this.wrapper.scrollLeft+a*u;this.wrapper.scrollLeft=t=Math.min(r,Math.max(0,t));const s=this.wavesurfer.drawer.handleEvent(e);c.update({start:Math.min(s*p,l*p),end:Math.max(s*p,l*p)}),t<r&&t>0&&window.requestAnimationFrame(()=>{g(e)})},b=e=>{e.touches&&e.touches.length>1||(p=this.wavesurfer.getDuration(),d=e.targetTouches?e.targetTouches[0].identifier:null,r=this.wrapper.scrollWidth-this.wrapper.clientWidth,h=this.util.withOrientation(this.wrapper.getBoundingClientRect(),this.vertical),n=!0,l=this.wavesurfer.drawer.handleEvent(e,!0),c=null,u=null)};this.wrapper.addEventListener("mousedown",b),this.wrapper.addEventListener("touchstart",b),this.on("disable-drag-selection",()=>{this.wrapper.removeEventListener("touchstart",b),this.wrapper.removeEventListener("mousedown",b)});const f=e=>{e.touches&&e.touches.length>1||(n=!1,m=0,u=null,c&&(this.util.preventClick(),c.fireEvent("update-end",e),this.wavesurfer.fireEvent("region-update-end",c,e)),c=null)};this.wrapper.addEventListener("mouseleave",f),this.wrapper.addEventListener("mouseup",f),this.wrapper.addEventListener("touchend",f),document.body.addEventListener("mouseup",f),document.body.addEventListener("touchend",f),this.on("disable-drag-selection",()=>{document.body.removeEventListener("mouseup",f),document.body.removeEventListener("touchend",f),this.wrapper.removeEventListener("touchend",f),this.wrapper.removeEventListener("mouseup",f),this.wrapper.removeEventListener("mouseleave",f)});const v=a=>{if(!n)return;if(++m<=t)return;if(a.touches&&a.touches.length>1)return;if(a.targetTouches&&a.targetTouches[0].identifier!=d)return;if(!c&&(c=this.add(e||{}),!c))return;const r=this.wavesurfer.drawer.handleEvent(a),b=this.wavesurfer.regions.util.getRegionSnapToGridValue(l*p),f=this.wavesurfer.regions.util.getRegionSnapToGridValue(r*p);c.update({start:Math.min(f,b),end:Math.max(f,b)});const v=this.util.withOrientation(a,this.vertical);if(i&&s.clientWidth<this.wrapper.scrollWidth){const e=v.clientX-h.left;u=e<=o?-1:e>=h.right-o?1:null,u&&g(a)}};this.wrapper.addEventListener("mousemove",v),this.wrapper.addEventListener("touchmove",v),this.on("disable-drag-selection",()=>{this.wrapper.removeEventListener("touchmove",v),this.wrapper.removeEventListener("mousemove",v)}),this.wavesurfer.on("region-created",e=>{this.regionsMinLength&&(e.minLength=this.regionsMinLength)})}disableDragSelection(){this.fireEvent("disable-drag-selection")}getCurrentRegion(){const e=this.wavesurfer.getCurrentTime();let t=null;return Object.keys(this.list).forEach(s=>{const i=this.list[s];i.start<=e&&i.end>=e&&(!t||i.end-i.start<t.end-t.start)&&(t=i)}),t}getRegionSnapToGridValue(e,t){if(t.snapToGridInterval){const s=t.snapToGridOffset||0;return Math.round((e-s)/t.snapToGridInterval)*t.snapToGridInterval+s}return e}}class Yc{static create(e){return{name:"cursor",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{},instance:Yc}}constructor(e,t){Object(fn["a"])(this,"defaultParams",{hideOnBlur:!0,width:"1px",color:"black",opacity:"0.25",style:"solid",zIndex:4,customStyle:{},customShowTimeStyle:{},showTime:!1,followCursorY:!1,formatTimeCallback:null}),Object(fn["a"])(this,"_onMousemove",e=>{const t=this.wavesurfer.container.getBoundingClientRect();let s=0;const i=e.clientX-t.left,a=t.right<e.clientX+this.outerWidth(this.displayTime);this.params.showTime&&this.params.followCursorY&&(s=e.clientY-(t.top+t.height/2)),this.updateCursorPosition(i,s,a)}),Object(fn["a"])(this,"_onMouseenter",()=>this.showCursor()),Object(fn["a"])(this,"_onMouseleave",()=>this.hideCursor()),this.wavesurfer=t,this.style=t.util.style,this.cursor=null,this.showTime=null,this.displayTime=null,this.params=Object.assign({},this.defaultParams,e)}init(){this.wrapper=this.wavesurfer.container,this.cursor=this.wrapper.appendChild(this.style(document.createElement("cursor"),Object.assign({position:"absolute",zIndex:this.params.zIndex,left:0,top:0,bottom:0,width:"0",display:"flex",borderRightStyle:this.params.style,borderRightWidth:this.params.width,borderRightColor:this.params.color,opacity:this.params.opacity,pointerEvents:"none"},this.params.customStyle))),this.params.showTime&&(this.showTime=this.wrapper.appendChild(this.style(document.createElement("showTitle"),Object.assign({position:"absolute",zIndex:this.params.zIndex,left:0,top:0,bottom:0,width:"auto",display:"flex",opacity:this.params.opacity,pointerEvents:"none",height:"100%"},this.params.customStyle))),this.displayTime=this.showTime.appendChild(this.style(document.createElement("div"),Object.assign({display:"inline",pointerEvents:"none",margin:"auto",visibility:"hidden"},this.params.customShowTimeStyle))),this.displayTime.innerHTML=this.formatTime(0)),this.wrapper.addEventListener("mousemove",this._onMousemove),this.params.hideOnBlur&&(this.hideCursor(),this.wrapper.addEventListener("mouseenter",this._onMouseenter),this.wrapper.addEventListener("mouseleave",this._onMouseleave))}destroy(){this.params.showTime&&this.cursor.parentNode.removeChild(this.showTime),this.cursor.parentNode.removeChild(this.cursor),this.wrapper.removeEventListener("mousemove",this._onMousemove),this.params.hideOnBlur&&(this.wrapper.removeEventListener("mouseenter",this._onMouseenter),this.wrapper.removeEventListener("mouseleave",this._onMouseleave))}updateCursorPosition(e,t,s=!1){if(this.style(this.cursor,{left:e+"px"}),this.params.showTime){const i=this.wavesurfer.getDuration(),a=this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio,o=this.wavesurfer.drawer.getScrollX(),n=i/this.wavesurfer.drawer.width*o,r=Math.max(0,e/a*i)+n,l=this.formatTime(r);if(s){const t=this.outerWidth(this.displayTime);e-=t}this.style(this.showTime,{left:e+"px",top:t+"px"}),this.style(this.displayTime,{visibility:"visible"}),this.displayTime.innerHTML=""+l}}showCursor(){this.style(this.cursor,{display:"flex"}),this.params.showTime&&this.style(this.showTime,{display:"flex"})}hideCursor(){this.style(this.cursor,{display:"none"}),this.params.showTime&&this.style(this.showTime,{display:"none"})}formatTime(e){return e=isNaN(e)?0:e,this.params.formatTimeCallback?this.params.formatTimeCallback(e):[e].map(e=>[Math.floor(e%3600/60),("00"+Math.floor(e%60)).slice(-2),("000"+Math.floor(e%1*1e3)).slice(-3)].join(":"))}outerWidth(e){if(!e)return 0;let t=e.offsetWidth;const s=getComputedStyle(e);return t+=parseInt(s.marginLeft+s.marginRight,10),t}}const Zc="#D8D8D8",Xc="bottom";class ed{static create(e){return{name:"markers",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{addMarker(e){return this.initialisedPluginList.markers||this.initPlugin("markers"),this.markers.add(e)},clearMarkers(){this.markers&&this.markers.clear()}},instance:ed}}constructor(e,t){this.params=e,this.wavesurfer=t,this.util=t.util,this.style=this.util.style,this.markerWidth=11,this.markerHeight=22,this._onResize=()=>{this._updateMarkerPositions()},this._onBackendCreated=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this.params.markers&&this.params.markers.forEach(e=>this.add(e)),window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0),this.wavesurfer.on("zoom",this._onResize)},this.markers=[],this._onReady=()=>{this.wrapper=this.wavesurfer.drawer.wrapper,this._updateMarkerPositions()}}init(){this.wavesurfer.isReady?(this._onBackendCreated(),this._onReady()):(this.wavesurfer.once("ready",this._onReady),this.wavesurfer.once("backend-created",this._onBackendCreated))}destroy(){this.wavesurfer.un("ready",this._onReady),this.wavesurfer.un("backend-created",this._onBackendCreated),this.wavesurfer.un("zoom",this._onResize),window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0),this.clear()}add(e){const t={time:e.time,label:e.label,color:e.color||Zc,position:e.position||Xc};return e.markerElement&&(this.markerWidth=e.markerElement.width,this.markerHeight=e.markerElement.height),t.el=this._createMarkerElement(t,e.markerElement),this.wrapper.appendChild(t.el),this.markers.push(t),this._updateMarkerPositions(),t}remove(e){const t=this.markers[e];t&&(this.wrapper.removeChild(t.el),this.markers.splice(e,1))}_createPointerSVG(e,t){const s="http://www.w3.org/2000/svg",i=document.createElementNS(s,"svg"),a=document.createElementNS(s,"polygon");return i.setAttribute("viewBox","0 0 40 80"),a.setAttribute("id","polygon"),a.setAttribute("stroke","#979797"),a.setAttribute("fill",e),a.setAttribute("points","20 0 40 30 40 80 0 80 0 30"),"top"==t&&a.setAttribute("transform","rotate(180, 20 40)"),i.appendChild(a),this.style(i,{width:this.markerWidth+"px",height:this.markerHeight+"px","min-width":this.markerWidth+"px","margin-right":"5px","z-index":4}),i}_createMarkerElement(e,t){const{label:s}=e,{time:i}=e,a=document.createElement("marker");a.className="wavesurfer-marker",this.style(a,{position:"absolute",height:"100%",display:"flex",overflow:"hidden","flex-direction":"top"==e.position?"column-reverse":"column"});const o=document.createElement("div");this.style(o,{"flex-grow":1,"margin-left":this.markerWidth/2-.5+"px",background:"black",width:"1px",opacity:.1}),a.appendChild(o);const n=document.createElement("div"),r=t||this._createPointerSVG(e.color,e.position);if(n.appendChild(r),s){const e=document.createElement("span");e.innerText=s,this.style(e,{"font-family":"monospace","font-size":"90%"}),n.appendChild(e)}return this.style(n,{display:"flex","align-items":"center",cursor:"pointer"}),a.appendChild(n),n.addEventListener("click",t=>{t.stopPropagation(),this.wavesurfer.setCurrentTime(i),this.wavesurfer.fireEvent("marker-click",e,t)}),a}_updateMarkerPositions(){const e=this.wavesurfer.getDuration();for(let t=0;t<this.markers.length;t++){const s=this.markers[t],i=this.wavesurfer.drawer.width/this.wavesurfer.params.pixelRatio,a=Math.min(s.time/e,1),o=i*a-this.markerWidth/2;this.style(s.el,{left:o+"px","max-width":i-o+"px"})}}clear(){while(this.markers.length>0)this.remove(0)}}var td=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._v(e._s(e.currentTime)+"/ "+e._s(e.time))])},sd=[],id={inject:["$optimus"],props:{time:String},data(){return{currentTime:"00:00:00:000"}},mounted(){this.$optimus.$on("audio:update-time",e=>{this.currentTime=e})}},ad=id,od=Object(S["a"])(ad,td,sd,!1,null,null,null),nd=od.exports;const rd="https://docs.qq.com/doc/DRGFLcm1oaFBkTHhi?newPad=1&newPadType=clone&u=1b3ce0c5c80f42bda631c47a96fc4c84";var ld={components:{AudioTimer:nd,videoPreview:na},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{src:{type:String},type:String,group:{type:String,default:""},shortCutEnabled:{type:Boolean,default:!0}},data(){let e="WebAudio";const t=localStorage.getItem("optimus-audio-wavesurfer-backend");return t&&(e=t),{href:rd,timelineInterval:"1s",timelineIntervalOptions:[{content:"50ms",value:.05},{content:"100ms",value:.1},{content:"200ms",value:.2},{content:"500ms",value:.5},{content:"1s",value:1}],selectObjects:{},isBatch:!1,isShowActive:!1,isVideoOk:!1,videoHeight:200,wavesurferHeight:120,initAnswer:{},componentConfig:{},startTime:null,percent:0,currentTagTool:"*",splitValue:1,oriZoomPx:20,curZoomPx:0,curZoomSpeed:0,speedNums:["0.25","0.5","0.75","1","1.25","1.5","1.75","2","2.5","3","5"].map(e=>({content:e+"x",value:e})),curSpeedNum:"1",objects:this.$optimus.objects,currentObject:{},tags:this.$optimus.tags,regionOptions:null,regionLists:{},wavesurfer:null,time:"00:00:00:000",duration:0,isplaying:!1,currentObjectTool:{id:"default_audio",type:"",label:"默认",name:"default",color:"random_audio",helps:[]},dynamicTools:[],objectTools:[],backendOptions:{WebAudio:"波形展示精确，倍速时声调会变化",MediaElement:"倍速时声调正常，波形可能偏移，不推荐切分时使用"},currentBackend:e,showBackendTip:!1,visibleObjects:{},progress:!1,DEFAULT_EXPAND_NUM:20,videoRef:null,isAudioAction:!1}},computed:{groupObjects(){return this.group?this.objects.filter(e=>e.data.group===this.group):this.objects},objectContext(){return 0===this.$renderedComponentConfig.$object_tools.length?{}:Object(a["cloneDeep"])(this.objects).reduce((e,t)=>{let s="汉语";const i=Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:t.name});if(i){const{helps:e}=i;e&&e.length>0&&(s=e[0].asrLang)}let o=Object(n["f"])(this.src);return location.origin.includes("woa.com")&&(o=o.replace("https","http")),Object.assign(e,{[t.featureId]:{audio_url:o,start_time:Number(this.conversionTime(t.data.start)),end_time:Number(this.conversionTime(t.data.end)),lan:s}})},{})},inputTags(){var e,t;return null===(e=this.$renderedComponentConfig)||void 0===e||null===(t=e.$object_items)||void 0===t?void 0:t.map(e=>"z-input"===e.component&&e.attributes.label)},showBackend(){return["template-edit","wb-task-label-detail","wb-task-review-detail"].includes(this.$route.name)}},watch:{currentObjectTool(){this.changeRegion()},curSpeedNum(e){"1"!==e&&"WebAudio"===this.currentBackend&&(this.showBackendTip=!0,setTimeout(()=>{this.showBackendTip=!1},3e3))},groupObjects(){this.groupObjects.length>0?this.splitValue=1===this.splitValue?(this.videoRef?this.videoHeight:0)+270+"px":this.splitValue:this.splitValue=1}},created(){this.initObjectTools(),this.initTagsComponent()},async mounted(){this.handleInitAudio(),(this.$optimus.active||this.group)&&document.addEventListener("keydown",e=>{this.shortCutEnabled&&this.listenKeyboardEvent(e)}),(this.$optimus.active||this.group)&&document.addEventListener("keyup",e=>{this.shortCutEnabled&&this.listenKeyupEvent(e)}),this.videoRef&&(this.getCurrentHeight(),this.videoRef.addEventListener("canplaythrough",()=>{this.isVideoOk=!0}),this.videoRef.addEventListener("play",()=>{if(!this.isAudioAction){const{currentTime:e,playbackRate:t}=this.videoRef;this.getSpeedNum(t),this.wavesurfer.play(e)}this.isAudioAction=!1}),this.videoRef.addEventListener("pause",()=>{this.isAudioAction||this.wavesurfer.pause(),this.isAudioAction=!1}),this.videoRef.addEventListener("ratechange",()=>{this.isAudioAction||this.getSpeedNum(this.videoRef.playbackRate),this.isAudioAction=!1})),this.groupObjects.length>0&&(this.splitValue="270px"),this.initExpand(),this.$optimus.initBeforeSubmitEvent(this.loadAll,{saveEnabled:!1})},beforeDestroy(){this.wavesurfer&&this.wavesurfer.destroy(),(this.$optimus.active||this.group)&&document.removeEventListener("keydown",this.listenKeyboardEvent),(this.$optimus.active||this.group)&&document.removeEventListener("keyup",this.listenKeyupEvent)},methods:{changeInterval({content:e,value:t}){this.timelineInterval=e,this.wavesurfer.updateTimeInterval(t),this.curZoomSpeed=1/t*5,this.curZoomPx=this.oriZoomPx*(1+this.curZoomSpeed/10),this.wavesurfer.zoom(this.curZoomPx)},initExpand(){for(let e=0;e<this.groupObjects.length;e++)this.$set(this.visibleObjects,this.groupObjects[e].featureId,e<this.DEFAULT_EXPAND_NUM)},handleExpand(e){this.$set(this.visibleObjects,e.featureId,!this.visibleObjects[e.featureId])},handleLoad(){this.progress=!this.progress,this.loadMore()},async loadAll(){await this.loadMore(!0)},loadMore(e=!1){return new Promise(t=>{const s=Object.keys(this.visibleObjects),i=s.find(e=>!this.visibleObjects[e]);(this.progress||e)&&i?(this.$set(this.visibleObjects,i,!0),requestAnimationFrame(()=>this.loadMore(e).then(t))):t()})},clearSelected(){this.selectObject(),this.currentObject={}},listenKeyboardEvent:Object(a["throttle"])((function(e){const{target:t,code:s,altKey:i,shiftKey:o}=e;if("Escape"===s){var n;e.preventDefault();const t=Object(a["findIndex"])(this.objects,this.currentObject);-1!==t&&this.playTagging(null===(n=this.objects[t])||void 0===n?void 0:n.featureId)}else if("Tab"===s)e.preventDefault(),this.playPause();else if("Enter"===s&&i){const e=Object(a["findIndex"])(this.objects,this.currentObject);-1!==e&&this.moveObject("down",e)}else"ArrowRight"===s&&i?this.skipForward():"ArrowLeft"===s&&i?this.skipBackward():o&&(this.isBatch=!0);if(!("INPUT"===t.tagName&&"checkbox"!==t.getAttribute("type")||"TEXTAREA"===t.tagName||t.getAttribute("contenteditable"))){if("Backspace"!==s||this.$optimus.disabled)if("KeyW"===s&&i)e.preventDefault(),this.chengeZoom(1);else if("KeyQ"===s&&i)e.preventDefault(),this.chengeZoom(0);else if("KeyS"===s&&i&&!this.$optimus.disabled)e.preventDefault(),this.startTime=this.wavesurfer.getCurrentTime().toFixed(3),this.wavesurfer.clearMarkers(),this.wavesurfer.addMarker({time:this.startTime,color:"#ff990a"});else if("KeyX"===s&&i&&!this.$optimus.disabled)e.preventDefault(),this.createObject(this.currentObjectTool);else if("KeyD"===s&&i&&!this.$optimus.disabled)e.preventDefault(),this.cutDoubleObj();else if("Enter"===s&&o){e.preventDefault();const t=Object(a["findIndex"])(this.objects,this.currentObject);-1!==t&&this.moveObject("up",t)}else"KeyH"===s?(e.preventDefault(),this.disableRegion(this.currentObject)):"KeyM"===s&&i&&(e.preventDefault(),Object.keys(this.selectObjects).length>1&&this.margeObjects());else this.deleteSubmit(Object.keys(this.selectObjects));if(i&&!this.$optimus.disabled){if("KeyZ"===s&&(e.preventDefault(),!Object(a["isEmpty"])(this.currentObject))){const{featureId:e}=this.currentObject,t=this.findAsrItem(e);t&&t.handleFetchAsrResult()}if("KeyA"===s&&(e.preventDefault(),!Object(a["isEmpty"])(this.currentObject))){const{featureId:e}=this.currentObject,t=this.findAsrItem(e);t&&t.applyAsrResult()}}}}),200),listenKeyupEvent(e){"Shift"===e.key&&(this.isBatch=!1)},initTagsComponent(){const{objects:e}=this;this.initAnswer=Object(a["cloneDeep"])(e).reduce((e,t)=>Object.assign(e,{[t.featureId]:{tags:t.tags}}),{}),0===this.$renderedComponentConfig.$object_tools.length?this.componentConfig.default={component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}:this.componentConfig=Object(a["cloneDeep"])(this.$renderedComponentConfig.$object_tools).reduce((e,t)=>{const s=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:s}}=e;return!s||("all"===s||s===t.name)});return Object.assign(e,{[t.name]:{component:"z-form-stage",items:s}})},{})},disableRegion(e){if(null===e||void 0===e||!e.featureId)return this.$Message.error({content:"请选中要隐藏或展示的标注段",duration:3}),0;const t=Object.assign({},this.regionLists),{name:s,label:i}=this.currentObjectTool;if(this.regionLists[e.featureId]){var a;null===(a=t[e.featureId])||void 0===a||a.remove(),delete t[e.featureId]}else{if(`${e.name}${e.label}`!==`${s}${i}`)return 0;this.regionOptions={id:"wavesurfer_"+e.featureId,start:this.conversionTime(e.data.start),end:this.conversionTime(e.data.end),loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled,color:e.color},t[e.featureId]=this.wavesurfer.addRegion(this.regionOptions)}this.regionLists=t},getObjectToolColor(e){return"random_audio"===e.color?"#333":e.color},getCurrentHeight(e){"enlarge"===e?this.videoHeight=500:"reduce"===e&&(this.videoHeight=200),this.$nextTick(()=>{this.splitValue=this.videoHeight+270+"px"})},moveObject(e,t){let s=t;const i=this.objects.length;s="up"===e?t===i-1?0:t+1:0===t?i-1:t-1,this.crollObject(this.objects[s].featureId),this.selectObject(this.objects[s],!0)},changeRegion(){const{name:e,label:t}=this.currentObjectTool,s=e?this.objects.filter(s=>`${e}${t}`===`${s.name}${s.label}`):this.objects;this.wavesurfer&&this.wavesurfer.clearRegions(),this.regionLists={},s.forEach(e=>{var t;const{start:s,end:i}=e.data,a={id:"wavesurfer_"+e.featureId,start:this.conversionTime(s),end:this.conversionTime(i),loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled,color:e.color};this.regionLists[e.featureId]=null===(t=this.wavesurfer)||void 0===t?void 0:t.addRegion(a)}),this.$nextTick(()=>{this.currentObject&&this.currentObject.featureId?this.selectObject(this.currentObject):this.selectObject()})},judgeTime(e){const t=/^([01][0-9]|2[0-3])(:[0-5][0-9]){2}:[0-9]{1,3}$/;return t.test(e)},conversionTime(e){if(void 0===e)return 0;const t=e.split(":");let s=0,i=!0;return Object(a["forEach"])(t,(e,t)=>{if(isNaN(Number(e)))return i=!1,!1;const a=3600/Math.pow(60,t);s=(3===t?e/1e3:Number(e)*a)+s}),!!i&&s},updateRegionTime(e,t){let s=!0;const i={};if(this.judgeTime(e.data.start)&&this.judgeTime(e.data.end)){const a=this.conversionTime(e.data.start),o=this.conversionTime(e.data.end),n=this.wavesurfer.getDuration();o>a&&o<n?t?(i.end=o,e.data.end=this.s_to_hs(o)):(i.start=a,e.data.start=this.s_to_hs(a)):o===a?(i.end=a+.1,e.data.end=this.s_to_hs(a+.1)):o<a?(this.$Message.error("标注段起始时间不能大于结束时间"),e.data.end=this.s_to_hs(this.regionLists[e.featureId].end),e.data.start=this.s_to_hs(this.regionLists[e.featureId].start)):o>n?(this.$Message.error("标注段结束时间不能大于音频总时间"),e.data.end=this.time,i.end=n):s=!1}else this.$Message.error({content:"修改失败，请确认时间格式为00:00:00:000",duration:3}),e.data.end=this.s_to_hs(this.regionLists[e.featureId].end),e.data.start=this.s_to_hs(this.regionLists[e.featureId].start);var a;s&&(null===(a=this.regionLists[e.featureId])||void 0===a||a.update(i),this.objects.sort(this.compare("data")),this.$nextTick(()=>{this.crollObject(e.featureId)}))},getTimePeriod(e,t){const s=this.conversionTime(e),i=this.conversionTime(t),a=i-s;return a.toFixed(3)},chengeZoom(e){0===e&&this.curZoomSpeed>0?this.curZoomSpeed=this.curZoomSpeed-1:1===e&&this.curZoomSpeed<100?this.curZoomSpeed=this.curZoomSpeed+1:2===e&&(this.curZoomSpeed=0,this.wavesurfer.params.minPxPerSec=this.oriZoomPx),this.curZoomPx=this.oriZoomPx*(1+this.curZoomSpeed/10),this.wavesurfer.zoom(this.curZoomPx)},changeHeight(e){const t=20;this.wavesurferHeight=this.wavesurferHeight+e*t,this.setHeight()},setHeight(){if(this.wavesurferHeight<=0)return;this.wavesurfer.setHeight(this.wavesurferHeight);const e=document.querySelector(`#waveform_${this.$optimus.$attrs.name||""}_${this.group}`);e.scrollTop=(e.scrollHeight-e.clientHeight)/2},addSelectObjects(e){const{name:t,label:s,featureId:i}=e,o=Object(a["cloneDeep"])(this.selectObjects);Object(a["forIn"])(o,(e,i)=>{`${t}_${s}`!==`${e.name}_${e.label}`&&delete this.selectObjects[i]}),this.selectObjects[i]?delete this.selectObjects[i]:this.selectObjects[i]=e},selectObject(e,t){e&&this.$set(this.visibleObjects,e.featureId,!0),this.group&&this.$optimus.$emit("optimus:audio-stage:selectObj",e,this.group);const s={},i=document.getElementsByClassName("z-stage__objects"),a=document.getElementsByClassName("wavesurfer-region");this.currentObject=e||{},t&&this.changeTag(!0,`${null===e||void 0===e?void 0:e.name}${null===e||void 0===e?void 0:e.label}`),e&&(s[e.featureId]=e),e&&this.isBatch?this.addSelectObjects(e):this.selectObjects=s,Array.prototype.forEach.call(i,e=>{let t="none",s="white";this.selectObjects[e.id]&&(t="2px solid #7cb5f1",s="rgb(183 218 255 / 21%)"),this.$set(e.style,"border",t),this.$set(e.style,"background",s)}),Array.prototype.forEach.call(a,e=>{var t,s;let i="none",a=3;this.selectObjects[null===(t=e.dataset)||void 0===t||null===(s=t.id)||void 0===s?void 0:s.replace("wavesurfer_","")]&&(i="2px solid red",a=4),this.$set(e.style,"border",i),this.$set(e.style,"border-right","1px solid #000"),this.$set(e.style,"zIndex",a)})},updateObjTags(e){const t="form_"+e.featureId,s=Object(a["findIndex"])(this.objects,t=>t.featureId===e.featureId);if(-1===s)return 0;this.objects[s].tags=this.$refs[t][0].tags},closeTag(e,t){const s=Object(a["cloneDeep"])(this.objectTools),i=Object(a["findIndex"])(s,e=>`${e.name}${e.label}`===t),o=Object(a["cloneDeep"])(s[i]),n=Object(a["findIndex"])(this.dynamicTools,e=>o.name===e.name);this.removeObject(t),s.forEach((e,t)=>{e.name===o.name&&-1!==n&&t>i&&(this.updateObjectsNum(e.name,e.label,this.dynamicTools[n].label,e.num-1),s[t].label=`${this.dynamicTools[n].label}${e.num-1}`,s[t].num=e.num-1)}),this.dynamicTools[n].num=this.dynamicTools[n].num-1,o.isChecked&&0!==i&&(s[0].isChecked=!0,this.currentObjectTool=s[0]),s.splice(i,1),this.objectTools=s},updateObjectsNum(e,t,s,i){this.objects.forEach((a,o)=>{a.name===e&&a.label===t&&(this.objects[o].label=`${s}${i}`)})},addObjectTool(e,t){const s=Object(a["cloneDeep"])(this.objectTools),i=Object(a["cloneDeep"])(this.dynamicTools),o=Object(a["findIndex"])(i,t=>t.name===e),n=Object(a["findIndex"])(s,s=>`${s.name}${s.label}`===`${e}${t}`),r=Object(a["cloneDeep"])(i[o]);if(-1===o||-1!==n)return 0;r.isChecked=0===s.length||!1,r.isClosable=!0,r.label=`${r.label}${r.num}`,0===s.length&&(this.currentObjectTool=r),s.push(r),i[o].num=1+i[o].num,this.objectTools=s,this.dynamicTools=i},changeTag(e,t){const s=Object(a["cloneDeep"])(this.objectTools);t!==`${this.currentObjectTool.name}${this.currentObjectTool.label}`&&(s.forEach((e,i)=>{const a=`${e.name}${e.label}`;a===t?(s[i].isChecked=!0,this.currentObjectTool=s[i]):s[i].isChecked=!1}),this.objectTools=s)},crollObject(e){const t=this.group?this.objects.filter(e=>e.data.group===this.group):this.objects,s=Object(a["findIndex"])(t,t=>t.featureId===e),i=this.group?document.getElementById(`${this.$optimus.$attrs.name||""}_default_item_${this.group}`):document,o=i.getElementsByClassName("z-stage__objects"),n=i.getElementsByClassName("bottom-pane");let r=0;Array.prototype.forEach.call(o,(e,t)=>{t<s&&(r=e.clientHeight+r+15)}),this.$nextTick(()=>{n[0]&&(n[0].scrollTop=r),n[0].scrollTop||n[1]&&(n[1].scrollTop=r)})},handleInitAudio(){const e=this;var t;this.wavesurfer&&(null===(t=document.querySelector("wave"))||void 0===t||t.remove(),this.wavesurfer.destroy());const s=20971520;let i=localStorage.getItem("optimus-audio-buffer-byte");i||(localStorage.setItem("optimus-audio-buffer-byte",s),i=s);const o=Qc.create({byteLength:i,container:`#waveform_${this.$optimus.$attrs.name||""}_${this.group}`,waveColor:"#888",progressColor:"#00ffff",interact:!0,height:120,normalize:!0,hideScrollbar:!1,scrollParent:!0,audioRate:this.curSpeedNum,fillParent:!0,backend:this.currentBackend,plugins:[Kc.create({}),Yc.create({opacity:.5,color:"red"}),Jc.create({container:`#wave-timeline_${this.$optimus.$attrs.name||""}_${this.group}`}),ed.create({})]});this.src?(this.time="00:00:00:000","video"===this.type?(this.videoRef=document.querySelector("video"),o.load(this.videoRef)):o.load(this.src),o.on("loading",e=>{this.percent=e}),o.on("ready",()=>{const e=document.getElementsByTagName("canvas");let t=0,s=0;Array.prototype.forEach.call(e,e=>{e.clientWidth&&"wave"===e.parentNode.localName&&e.clientWidth>t&&(t=e.clientWidth)}),this.duration=o.getDuration(),s=t/this.duration,this.oriZoomPx=o.params.minPxPerSec>s?o.params.minPxPerSec:s,o.params.minPxPerSec=this.oriZoomPx,this.time=this.s_to_hs(this.duration),this.changeRegion(),this.isShowActive=!0}),o.on("play",()=>{this.isplaying=!0}),o.on("pause",()=>{this.isplaying=!1}),o.on("audioprocess",()=>{this.$optimus.$emit("audio:update-time",this.s_to_hs(o.getCurrentTime()))}),o.on("region-update-end",t=>{if(this.group&&this.$EventBus.$emit("default-stage-item-click",this.group,this.$optimus.$attrs.name),!e.isShowActive)return;const s=Object(a["findIndex"])(this.objects,e=>"wavesurfer_"+e.featureId===t.id);if(-1===s){if(this.$optimus.disabled)return void(null===t||void 0===t||t.remove());this.currentObject={featureId:t.id.split("wavesurfer_")[1],type:"audio/segment",color:t.color,label:this.currentObjectTool.label,name:this.currentObjectTool.name,data:{start:this.s_to_hs(t.start),end:this.s_to_hs(t.end)},tags:[]},this.group&&(this.currentObject.data.group=this.group),this.objects.push(this.currentObject),this.regionLists[this.currentObject.featureId]=t,this.$nextTick(()=>{this.objects.sort(this.compare("data")),this.selectObject(this.currentObject),this.crollObject(this.currentObject.featureId)})}else{const e=this.regionLists.length,s=Object(a["findIndex"])(this.objects,e=>"wavesurfer_"+e.featureId===t.id),i=this.s_to_hs(t.start);if(this.objects[s].data.start=i,t.start.toFixed(3)===t.end.toFixed(3)?(this.objects[s].data.end=this.s_to_hs(t.end+.1),t.update({end:t.end+.1})):this.objects[s].data.end=this.s_to_hs(t.end),1===e)return 0;this.selectObject(this.objects[s]),this.objects.sort(this.compare("data")),this.crollObject(this.objects[s].featureId)}}),o.on("seek",()=>{this.$optimus.$emit("audio:update-time",this.s_to_hs(o.getCurrentTime())),this.videoRef&&(this.videoRef.currentTime=o.getCurrentTime())}),o.on("error",e=>{console.log(e)}),o.enableDragSelection({loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled}),o.on("region-created",e=>{const t=Object(a["findIndex"])(this.objects,t=>"wavesurfer_"+t.featureId===e.id);-1===t&&(e.color=this.getRegionColor(this.currentObjectTool))}),o.on("region-click",e=>{const t=Object(a["findIndex"])(this.objects,t=>"wavesurfer_"+t.featureId===e.id);this.selectObject(this.objects[t]),this.crollObject(this.objects[t].featureId)}),this.wavesurfer=o):console.log("未接收到音频地址")},onChangeBackend(e){const{currentBackend:t}=this;e!==t&&this.$Modal.confirm({title:`调整为${e}？`,content:"<p>确认调整将重新加载音频工具，请谨慎操作</p><p>请先确认标注结果已保存再继续进行</p>",okText:"确认调整",onOk:()=>{this.handlePause(),localStorage.setItem("optimus-audio-wavesurfer-backend",e),this.currentBackend=e,this.handleInitAudio()}})},compare(e){return(t,s)=>{let i=0,a=0;const o=this.conversionTime(t[e].start),n=this.conversionTime(s[e].start),r=this.conversionTime(t[e].end),l=this.conversionTime(s[e].end);return o===n?(i=r,a=l):(i=o,a=n),i-a}},initObjectTools(){this.$renderedComponentConfig.$object_tools&&(this.objectTools=Object(a["cloneDeep"])(this.$renderedComponentConfig.$object_tools),this.objectTools.forEach((e,t)=>{const s=this.objects.filter(t=>t.name===e.name&&t.label!==e.label);if(e.dynamic){const t=Object(a["cloneDeep"])(e);t.num=1,this.dynamicTools.push(t)}this.objectTools[t].isChecked=0===t,this.objectTools[t].isClosable=!1,0===t&&(this.currentObjectTool=e),s.forEach(e=>{this.addObjectTool(e.name,e.label)})}))},getRegionColor(e){let t=null;return t="default_audio"!==e.id||"random_audio"!==e.color&&"默认"!==e.label?e.color:"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6),t},createObject(e,t){var s;const{name:i,label:a}=e,o=i?this.objects.filter(e=>`${i}${a}`===`${e.name}${e.label}`):this.objects;let n=this.startTime?this.startTime:0,r=Number(this.wavesurfer.getCurrentTime()).toFixed(3),l=-1;if(null===t||void 0===t||null===(s=t.currentTarget)||void 0===s||s.blur(),this.handlePause(),o.forEach(e=>{const t=this.conversionTime(e.data.end);t<=r&&(t>l||-1===l)&&(l=t)}),n=this.startTime||-1===l?n:l,Number(r)===n)return this.$Message.error("切分时长为0"),0;if(Number(r)<n){const e=n;n=r,r=e}this.addRegionObject(e,n,r),this.startTime=null},margeObjects(){let e="",t="";const s=[];this.handlePause(),this.objects.forEach(i=>{const{start:a,end:o}=i.data;this.selectObjects[i.featureId]&&(!e&&(e=a),t=o,s.push(i.tags))}),this.removeObject(Object.keys(this.selectObjects)),this.addRegionObject(this.currentObjectTool,this.conversionTime(e),this.conversionTime(t),this.mergeTags(s))},mergeTags(e){let t=[];return e.forEach((e,s)=>{!t.length&&(t=e),s&&e.forEach((e,s)=>{var i;this.inputTags.includes(e.label)&&(t[s].value=`${(null===(i=t[s])||void 0===i?void 0:i.value)||""}${(null===e||void 0===e?void 0:e.value)||""}`)})}),t},cutDoubleObj(){var e;if(null===(e=this.currentObject)||void 0===e||!e.featureId)return this.$Message.error({content:"请选中要分隔的对象",duration:3}),0;const t=Number(this.wavesurfer.getCurrentTime()).toFixed(3),{start:s,end:i}=this.regionLists[this.currentObject.featureId];var a;s<t&&t<i?(this.removeObject([null===(a=this.currentObject)||void 0===a?void 0:a.featureId]),this.addRegionObject(this.currentObjectTool,s,t),this.addRegionObject(this.currentObjectTool,t,i)):this.$Message.error({content:"请将光标落在选中的分隔对象上",duration:3})},addRegionObject(e,t,s,i){const{label:o,name:r}=e,l=this.getRegionColor(e);this.currentObject={featureId:"feature_"+Object(n["j"])(8),type:"audio/segment",color:l,label:o,name:r,data:{start:this.s_to_hs(t),end:this.s_to_hs(s)},tags:Object(a["cloneDeep"])(i)||[]},this.group&&(this.currentObject.data.group=this.group),this.regionOptions={id:"wavesurfer_"+this.currentObject.featureId,start:t,end:s,loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled,color:l},this.objects.push(this.currentObject),this.regionLists[this.currentObject.featureId]=this.wavesurfer.addRegion(this.regionOptions),this.objects.sort(this.compare("data")),this.$nextTick(()=>{this.selectObject(this.currentObject)}),this.crollObject(this.currentObject.featureId),this.wavesurfer.clearMarkers(),i&&this.initTagsComponent()},deleteSubmit(e,t){this.$Modal.confirm({title:`确定要删除${t||"所选"}切分段吗？`,onOk:()=>{this.removeObject(e)}})},removeObject(e){const t=Object(a["cloneDeep"])(this.objects),s=t.length;let i=0;if("object"===typeof e)t.forEach((t,s)=>{const{featureId:a}=t;var o;e.includes(a)&&(this.objects.splice(s-i,1),null===(o=this.regionLists[a])||void 0===o||o.remove(),delete this.regionLists[a],i+=1)}),this.currentObject={};else{for(let n=0;n<s;n++){const t=Object(a["findIndex"])(this.objects,t=>`${t.name}${t.label}`===e);var o;if(-1!==t)null===(o=this.regionLists[this.objects[t].featureId])||void 0===o||o.remove(),delete this.regionLists[this.objects[t].featureId],this.objects.splice(t,1)}const{name:t,label:i}="{}"===JSON.stringify(this.currentObject)?this.currentObject:{};`${t}${i}`===e&&(this.currentObject={})}},skipBackward(){var e;null===(e=document.getElementById("sb"))||void 0===e||e.blur();const t=this.duration>120?30:10;this.wavesurfer.skipBackward(t),this.videoRef&&(this.videoRef.currentTime=this.videoRef.currentTime-t),this.handlePause()},skipForward(){var e;null===(e=document.getElementById("sf"))||void 0===e||e.blur(),this.wavesurfer.skipForward(this.duration>120?30:10),this.handlePause()},getSpeedNum(e){this.curSpeedNum=e,this.isplaying?(this.wavesurfer.pause(),this.wavesurfer.setPlaybackRate(e),this.wavesurfer.play()):this.wavesurfer.setPlaybackRate(e)},changeSpeed({value:e}){this.getSpeedNum(e),this.videoRef&&(this.isAudioAction=!0,this.videoRef.playbackRate=e)},handlePauseVideo(){this.videoRef&&(this.isAudioAction=!0,this.videoRef.pause())},handlePlayVideo(e,t){this.videoRef&&(this.isAudioAction=!0,!Object(a["isNil"])(e)&&(this.videoRef.currentTime=e),this.videoRef.playbackRate=this.curSpeedNum,this.videoRef.play(),t&&(this.videoRef.ontimeupdate=()=>{this.videoRef.currentTime>=t&&(this.videoRef.pause(),this.videoRef.ontimeupdate=null)}))},handlePlay(e,t){Object(a["isNil"])(e)||Object(a["isNil"])(t)?(this.wavesurfer.play(),this.handlePlayVideo()):(this.wavesurfer.play(e,t),this.handlePlayVideo(e,t))},handlePause(){this.isplaying&&(this.handlePauseVideo(),this.wavesurfer.pause())},playPause(){var e;null===(e=document.getElementById("pp"))||void 0===e||e.blur(),this.isplaying?this.handlePause():this.handlePlay()},playTagging(e){const t=this.regionLists[e];t?this.isplaying?this.handlePause():this.handlePlay(t.start,t.end):this.$Message.error("未发现标注段！")},s_to_hs(e){const t=Math.abs(e);let s=Math.floor(t),i=0,a=0,o=0,n=Math.round(1e3*(t-s));return 1e3===n?(n="000",s+=1):n<10?n="00"+n:n>9&&n<100&&(n="0"+n),i=Math.floor(s/3600),s-=3600*i,a=Math.floor(s/60),s-=60*a,o=Math.floor(s),s-=o,i<10&&(i="0"+i),a<10&&(a="0"+a),o<10&&(o="0"+o),`${i}:${a}:${o}:${n}`},findAsrItem(e){const t=this.$refs["form_"+e];if(t){const[e]=t[0].$children,{$refs:s,formRef:i}=e,a=s[i].$children,o=a.find(e=>e.aiHelp&&"asr"===e.aiHelp);return o}}}},cd=ld,dd=(s("65c9"),Object(S["a"])(cd,gc,bc,!1,null,"58cfcd42",null)),ud=dd.exports,hd={name:"z-audio-tool",metadata:mc,components:{AudioAnnotation:ud},mixins:[Re["a"]],props:{src:{type:String},group:{type:String,default:""},activeGroup:{type:String,default:""}},data(){return{}},computed:{config(){return this.$renderedComponentConfig}},mounted(){this.$optimus.$on("optimus:default-stage:clear-selectObj",e=>{var t;e!==this.group&&(null===(t=this.$refs.audioAnnotation)||void 0===t||t.clearSelected(),this.$optimus.$emit("optimus:default-stage:selectObj",null,e))}),this.$optimus.$on("optimus:audio-stage:selectObj",(e,t)=>{t===this.group&&e&&this.$optimus.$emit("optimus:default-stage:selectObj",e,t)}),this.$optimus.$on("optimus:default-stage:edit-object",(e,t)=>{if(e!==this.group)return;document.getElementById(`${this.$optimus.$attrs.name||""}_default_item_${e}`).scrollTo({top:0,behavior:"smooth"}),this.$refs.audioAnnotation.selectObject(t,!0),this.$refs.audioAnnotation.crollObject(t.featureId);const s=document.getElementById(`${this.$optimus.$attrs.name||""}_default_item_${e}`);s.scrollIntoView({behavior:"smooth"})}),this.$optimus.$on("optimus:default-stage:delete-object",(e,t)=>{if(e===this.group)if(t)this.$refs.audioAnnotation.removeObject([t.featureId]);else{const e=Object(a["cloneDeep"])(this.$optimus.objects).filter(e=>e.data.group===this.group).map(e=>e.featureId);this.$refs.audioAnnotation.removeObject(e)}})},methods:{}},pd=hd,md=(s("65c5"),Object(S["a"])(pd,uc,hc,!1,null,"0733d067",null)),gd=md.exports,bd=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("div",[s("t-divider"),e.title||e.tip?s("Row",{staticClass:"row"},[s("div",{staticClass:"title"},[e._v(e._s(e.title))]),s("div",{staticClass:"tip"},[e._v(e._s(e.tip))])]):e._e()],1):e._e()},fd=[],vd={label:"分隔符",icon:"ios-create-outline",name:"z-divider",attributes:[{name:"title",label:"标题",type:String,value:""},{name:"tip",label:"提示",type:String,value:""}]},yd={metadata:vd,props:{isVisible:{type:Boolean,default:!0},title:{type:String,default:""},tip:{type:String,default:""}}},wd=yd,xd=(s("43c9"),Object(S["a"])(wd,bd,fd,!1,null,"6ef870e1",null)),Cd=xd.exports,jd=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-item"},[s("TextContainer",{attrs:{content:e.item.value,wordCount:e.wordCount,defaultView:e.item.stringType,name:e.item.group,markdownConfig:e.markdownConfig,"highlight-enabled":e.highlightEnabled,"highlight-btn":e.highlightKeywords.length>0},on:{"update:highlight":e.handleHighlight}})],1)},Od=[],kd={label:"文本默认组件",name:"z-default-text",type:"container_component",scene:"文本",attributes:[{name:"markdownConfig",label:"Markdown默认配置",type:String,value:""},{name:"highlightKeywords",label:"文本关键词高亮",value:[],type:Array,component:"z-mark-config"}],tools:[{type:"text/addEndtag",label:"添加结束符",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"text_content_"+(new Date).getTime()}}]}]},Ad=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-container",class:{fullscreen:e.isFullscreen}},[s("t-row",{staticClass:"toolbar",attrs:{align:"center",justify:"end"}},[e.highlightBtn?s("t-space",{attrs:{size:"4px"}},[s("span",[e._v("高亮")]),s("t-switch",{attrs:{size:"small"},on:{change:e.handleHighlightChange},model:{value:e.highlight,callback:function(t){e.highlight=t},expression:"highlight"}})],1):e._e(),s("WordCount",{attrs:{content:e.customContent,defaultType:e.wordCount.type,defaultEnabled:e.wordCount.enabled}}),"markdown"!==e.currentView?s("t-input-number",{staticClass:"font-size",attrs:{size:"small",theme:"normal",min:8,max:32,step:2,allowInputOverLimit:!1,align:"right"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v("字号：")]},proxy:!0},{key:"suffix",fn:function(){return[e._v("px")]},proxy:!0}],null,!1,3087622762),model:{value:e.fontSize,callback:function(t){e.fontSize=t},expression:"fontSize"}}):e._e(),s("t-radio-group",{attrs:{size:"small"},on:{change:e.handleHighlightChange},model:{value:e.currentView,callback:function(t){e.currentView=t},expression:"currentView"}},[s("t-radio-button",{attrs:{value:"markdown"}},[e._v("MD")]),s("t-radio-button",{attrs:{value:"text"}},[e._v("text")]),s("t-radio-button",{attrs:{value:"html"}},[e._v("html")])],1),s("copyBtn",{attrs:{content:e.customContent}}),s("t-button",{attrs:{variant:"text",size:"small"},on:{click:e.toggleFullscreen},scopedSlots:e._u([{key:"icon",fn:function(){return[e.isFullscreen?s("t-icon",{attrs:{name:"fullscreen-exit-1",size:"14"}}):s("t-icon",{attrs:{name:"fullscreen-1",size:"14"}})]},proxy:!0}])})],1),s("TextMenu",{attrs:{name:e.name,handleUpdateCustomContent:e.handleUpdateCustomContent,markdownConfig:e.markdownConfig,content:e.content},scopedSlots:e._u([{key:"content",fn:function(){return[s(e.currentViewComponent,{tag:"component",attrs:{content:e.customContent,fontSize:e.fontSize,name:e.name,markdownConfig:e.markdownConfig}})]},proxy:!0}])})],1)},Sd=[],_d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("t-popup",{attrs:{visible:e.markToolEnabled&&e.visible,popperOptions:e.popperOptions,placement:"bottom-start",overlayInnerStyle:{backgroundColor:"#f2f2f2",padding:"4px"}},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"text-menu"},[s("t-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.selectedRange.text,expression:"selectedRange.text",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.copySuccessHandler,expression:"copySuccessHandler",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.copyErrorHandler,expression:"copyErrorHandler",arg:"error"}],attrs:{variant:"text"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"copy"}})]},proxy:!0}])},[e._v("复制")]),s("t-button",{attrs:{variant:"text"},on:{click:function(t){return e.handleSearch("baidu")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"search"}})]},proxy:!0}])},[e._v("百度搜索")]),s("t-button",{attrs:{variant:"text"},on:{click:function(t){return e.handleSearch("google")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"search"}})]},proxy:!0}])},[e._v("谷歌搜索")]),s("t-button",{attrs:{variant:"text"},on:{click:e.handleTranslate},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"translate"}})]},proxy:!0}])},[e._v("翻译")]),e.currentTool&&"text/addEndtag"===e.currentTool.type?s("t-button",{attrs:{variant:"text"},on:{click:e.handleInsertEndTag},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"edit-2"}})]},proxy:!0}],null,!1,3258574937)},[e._v("插入结束符")]):e._e(),s("t-button",{attrs:{variant:"text"},on:{click:e.handleClose},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"close"}})]},proxy:!0}])},[e._v("关闭")])],1)]},proxy:!0}])},[s("div",{staticClass:"text-content",attrs:{id:e.content_id},on:{mousedown:function(t){e.visible=!1},mouseup:e.handleSelected}},[e._t("content")],2)])},Id=[],$d={inject:["$optimus"],props:{name:{type:String,default:""},handleUpdateCustomContent:{type:Function},markdownConfig:{type:String},content:{type:String}},data(){const{objects:e}=this.$optimus;return{objects:e,visible:!1,markToolEnabled:"false"!==localStorage.getItem("mark-tool-enabled"),offset:[0,0],selectedRange:{},options:[],isMouseInPopup:!1,content_id:"content_"+Object(n["j"])(8)}},computed:{currentTool(){const e=this.$optimus.renderedComponentConfig.$object_tools;return 0===e.length?{}:Object(a["head"])(e.filter(e=>e.group===this.name))},popperOptions(){return{modifiers:[{name:"offset",options:{offset:this.offset}}]}}},watch:{},beforeDestroy(){},mounted(){this.$optimus.$on("optimus:mark-tool:change",e=>{this.markToolEnabled=e}),this.$optimus.$on("optimus:text-menu-visible:change",e=>{this.visible=e}),this.$optimus.$on("optimus:default-stage:delete-object",(e,t)=>{if(this.name!==e)return;let s;t?(s=this.objects.findIndex(s=>(null===s||void 0===s?void 0:s.data.group)===e&&s.featureId===t.featureId),this.objects.splice(s,1)):(s=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.data.group)===e),this.objects.splice(0,this.objects.length)),this.objects.length?this.handleUpdateCustomContent(this.objects[this.objects.length-1].data.content):this.handleUpdateCustomContent(this.content)}),window.addEventListener("mousedown",e=>{e.target.closest(".text-menu")||this.closeAllPopup(),e.target.closest(".model-select")||e.target.closest(".model-dropdown")||e.target.closest(".translate-modal .t-dialog")||this.$EventBus.$emit("optimus:translate-modal",!1)})},methods:{closeAllPopup(){this.selectedRange.text="",this.$optimus.$emit("optimus:text-menu-visible:change",!1)},handleClose(){this.visible=!1,this.$optimus.$emit("optimus:mark-tool:change",!1)},copySuccessHandler(){this.visible=!1,this.$Message.success("已复制到剪贴板")},copyErrorHandler(){this.$Message.error("复制失败")},handleInsertEndTag(){var e;let t={};try{t=JSON.parse(this.markdownConfig)}catch(a){this.$Message.error("JSON解析错误",a)}const s=null!==(e=t.endTag)&&void 0!==e?e:"End",i=document.createTextNode(s);this.selectedRange.range.insertNode(i),this.$nextTick(()=>{const e=document.getElementById(this.content_id),{type:t,name:s,label:i}=this.currentTool;this.handleUpdateCustomContent(""+e.innerText),this.objects.push({featureId:`'feature-${Object(n["j"])(8)}'`,color:"#33f412",tags:[],data:{content:e.innerText,group:this.name},type:t,name:s,label:i})}),this.visible=!1},handleSelected(e){var t;if(!this.markToolEnabled)return;const s=null!==(t=e.target.closest(".text-content"))&&void 0!==t?t:this.selectedRange.target,{clientX:i,clientY:a}=e,o=window.getSelection(),n=o.getRangeAt(0);if(this.selectedRange={range:n,text:o.toString().trim(),content:s.textContent},this.selectedRange.text){const e=s.getBoundingClientRect(),t=i-e.left,o=a-e.bottom;console.log("offset",t,o),this.offset=[t,o],this.visible=!0}},handleSearch(e){switch(e){case"baidu":window.open("https://www.baidu.com/s?wd="+this.selectedRange.text);break;case"google":window.open("https://www.google.com/search?q="+this.selectedRange.text);break}},handleTranslate(){this.$EventBus.$emit("optimus:translate-modal",!0,this.selectedRange.text),this.visible=!1},handleMark(){this.$EventBus.$emit("optimus:mark-tool-modal",!0,Object(a["cloneDeep"])(this.selectedRange)),this.visible=!1}}},Md=$d,Td=(s("9801"),Object(S["a"])(Md,_d,Id,!1,null,"03a022ed",null)),Ed=Td.exports,Ld=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("iframe",{key:e.iframeKey,ref:"iframeRef",staticClass:"iframe-view",style:{height:e.iframeHeight},attrs:{sandbox:"allow-scripts allow-same-origin",frameborder:"0",srcdoc:e.content},on:{load:e.onIframeLoad}})])},Dd=[],Pd={props:{content:String},data(){return{iframeKey:0,iframeHeight:"0px"}},watch:{content:{immediate:!0,handler(){this.iframeKey=Object(Ve["a"])(),this.iframeHeight="0px"}}},methods:{onIframeLoad(){const e=this.$refs.iframeRef;if(!e)return;const t=e.contentDocument||e.contentWindow.document;if(!t)return;const s=Math.max(t.body.scrollHeight,t.documentElement.scrollHeight)+10;this.iframeHeight=s+"px"}}},Bd=Pd,Rd=(s("8ad2"),Object(S["a"])(Bd,Ld,Dd,!1,null,"5d07f13c",null)),zd=Rd.exports,Nd=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{style:{fontSize:e.fontSize+"px"},domProps:{textContent:e._s(e.content)}})},Fd=[],Vd={props:{content:{type:String,default:""},fontSize:{type:Number,default:14}}},qd=Vd,Hd=Object(S["a"])(qd,Nd,Fd,!1,null,null,null),Wd=Hd.exports,Ud={name:"TextDefault",inject:["$optimus"],components:{CherryMarkdown:el,Markdown:ml,WordCount:ue,TextMenu:Ed,copyBtn:Kr["a"],TextView:Wd,HtmlView:{props:["content","fontSize"],template:'<div :style="{ fontSize: fontSize + \'px\' }" v-html="content" class="html-view"></div>',data(){return{styleId:"html-view-"+Date.now()}},mounted(){const e=document.createElement("style");e.id=this.styleId,e.innerHTML="\n          .html-view {\n            all: initial;\n            font-family: inherit;\n          }\n          .html-view * {\n            all: revert;\n          }\n        ",document.head.appendChild(e)},beforeDestroy(){var e;null===(e=document.getElementById(this.styleId))||void 0===e||e.remove()}},IframeView:zd},props:{name:{type:String,default:""},content:{type:String,default:""},defaultView:{type:String,default:"text"},defaultFontSize:{type:Number,default:14},wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},markdownConfig:{type:String},highlightEnabled:{type:Boolean,default:!1},highlightBtn:{type:Boolean,default:!1}},data(){return{customContent:this.content,currentView:this.defaultView||"text",fontSize:this.defaultFontSize,isFullscreen:!1,highlight:this.highlightEnabled}},computed:{currentViewComponent(){switch(this.currentView){case"markdown":return"Markdown";case"text":return"TextView";case"html":return"IframeView";default:return"TextView"}}},watch:{highlightEnabled(e){this.highlight=e}},methods:{handleUpdateCustomContent(e){this.customContent=e},handleHighlightChange(){this.$emit("update:highlight",this.highlight)},toggleFullscreen(){this.isFullscreen=!this.isFullscreen;const e=this.$el,t=e.closest(".z-stage__showing");if(this.isFullscreen)t.appendChild(e);else{const t=this.$parent.$el.querySelector(".text-item")||this.$parent.$el;t.appendChild(e)}}}},Qd=Ud,Jd=(s("2085"),Object(S["a"])(Qd,Ad,Sd,!1,null,"1bf00f36",null)),Gd=Jd.exports,Kd={metadata:kd,components:{TextContainer:Gd},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})},wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},markdownConfig:{type:String},highlightKeywords:{type:Array,default:()=>[]}},data(){return{textHighlighter:null,highlightEnabled:!0}},computed:{},mounted(){this.textHighlighter=new Cl(this.$el.querySelector(".text-content"),this.highlightKeywords),this.handleHighlight(!0),this.$optimus.$on("default-stage:highlight-change",e=>{this.highlightEnabled=e,this.handleHighlight(e)})},methods:{highlight(){this.$nextTick(()=>{this.textHighlighter.highlight()})},handleHighlight(e){e?this.$nextTick(()=>{this.textHighlighter.highlight()}):this.textHighlighter.clear()}}},Yd=Kd,Zd=(s("fe3d"),Object(S["a"])(Yd,jd,Od,!1,null,"5a7d0c74",null)),Xd=Zd.exports,eu=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"audio-item"},[s("audio",{attrs:{src:e.item.value,controls:"true",controlslist:"nodownload"}})])},tu=[],su={label:"音频默认组件",name:"z-default-audio",type:"container_component",scene:"语音",attributes:[]},iu={metadata:su,components:{},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})}}},au=iu,ou=Object(S["a"])(au,eu,tu,!1,null,"772461bc",null),nu=ou.exports,ru=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("upload-annotation",{ref:"uploadAnnotation",attrs:{$renderedComponentConfig:e.$renderedComponentConfig,group:e.group}},[s("safeImage",{staticClass:"image-item",attrs:{src:e.item.value,imgStyle:e.imageStyle,isCanvas:!1}})],1)},lu=[],cu={label:"图片默认组件",name:"z-default-image",type:"container_component",scene:"图片",attributes:[{name:"imageConfig",label:"图片配置",component:"z-input",type:String,value:""}],tools:[{type:"image/file",label:"图片上传",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"image_file_"+(new Date).getTime()}},{label:"是否支持上传多个图片",name:"multiple",type:Boolean,component:"z-switch",value:!1},{label:"允许上传的文件类型（如image/png,image/jpg，未配置时不校验）",name:"accept",type:String,value:"image/*",required:!1},{label:"图片上传说明",name:"description",type:String,required:!1,value:""}]}]},du=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"upload-annotation"},[e._t("default"),s("t-tabs",{model:{value:e.curToolName,callback:function(t){e.curToolName=t},expression:"curToolName"}},e._l(e.tools,(function(t){return s("t-tab-panel",{attrs:{value:t.name,label:t.label,destroyOnHide:!1}},[s("div",{staticClass:"tab-container"},[s("t-upload",{attrs:{accept:t.accept?t.accept.split(",").join():"*",requestMethod:function(s){return e.requestMethod(s,t)},allowUploadDuplicateFile:!0,multiple:t.multiple,disabled:e.$optimus.disabled,theme:"custom"}},[s("t-button",{attrs:{disabled:e.$optimus.disabled}},[s("t-icon",{attrs:{slot:"icon",name:"upload"},slot:"icon"}),e._v("上传图片")],1)],1),s("div",{staticClass:"tips"},[e._v(e._s(t.description)+" "+e._s(t.accept?"（支持格式为"+t.accept+"）":""))])],1)])})),1),s("div",{staticClass:"file-list"},e._l(e.files,(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.toolName===e.curToolName,expression:"file.toolName === curToolName"}],key:t.featureId,staticClass:"model-file-item",class:{"item-selected":e.curSelected===t.featureId},attrs:{id:t.featureId},on:{click:function(s){return e.selectFile(t)}}},[s("div",{staticStyle:{"margin-bottom":"16px"}},[s("div",{staticClass:"file-container",class:{"upload-failed":"fail"===t.status}},["fail"!==t.status&&e.fileSignMap[t.url]&&(e.fileSignMap[t.url].previewUrl||e.fileSignMap[t.url].downloadLink)?t.toolName===e.curToolName?s("preview",{attrs:{previewType:e.getPreviewType(t.format),filename:t.name,previewUrl:e.fileSignMap[t.url].previewUrl||"https://"+e.fileSignMap[t.url].downloadLink}},[["cos","undefined"].includes(e.getPreviewType(t.format))?s("t-icon",{staticClass:"file-content",staticStyle:{padding:"10px"},attrs:{name:"file-attachment",color:"#ddd"}}):e._e()],1):e._e():s("t-icon",{staticClass:"file-content",attrs:{name:"image-error-filled",color:"#e9e8e8"}}),s("div",{staticClass:"file-desc"},[s("div",[s("t-space",{attrs:{size:8,align:"center"}},[s("span",[e._v(e._s(t.name))]),"progress"===t.status?[s("t-loading",{attrs:{size:"14px"}}),s("t-link",{attrs:{hover:"color",theme:"primary"}},[e._v(e._s(100*t.progress)+"%")])]:"success"===t.status?s("t-icon",{attrs:{name:"check-circle-filled",color:"#2ba471"}}):"fail"===t.status?s("t-icon",{attrs:{name:"error-circle-filled",color:"#d54941"}}):e._e()],2),s("div",{staticClass:"file-properties"},[e._v("文件大小："+e._s((t.size/1048576).toFixed(2))+" MB")]),t.media_metadata?s("div",{staticClass:"file-properties"},[e._v("文件尺寸："+e._s(t.media_metadata.width)+" x "+e._s(t.media_metadata.height))]):e._e(),s("div",{staticClass:"file-properties"},[e._v("上传日期："+e._s(t.date))])],1),"progress"!==t.status?s("t-space",["success"===t.status?s("t-link",{attrs:{theme:"primary",hover:"color"},on:{click:function(s){return e.downloadFile(t)}}},[e._v("下载")]):e._e(),s("t-link",{attrs:{theme:"primary",hover:"color",disabled:e.$optimus.disabled},on:{click:function(s){return e.deleteFile(t)}}},[e._v("删除")])],1):e._e()],1)],1),"fail"===t.status?s("div",{staticStyle:{color:"#d54941"}},[e._v("上传失败")]):e._e()]),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:t,expression:"file"}],ref:"form_"+t.featureId,refInFor:!0,attrs:{component:e.componentConfigMap[t.toolName],context:e.$optimus.context,answer:e.initAnswer[t.featureId],disabled:e.$optimus.disabled}})],1)})),0)],2)},uu=[],hu=s("534e"),pu=s.n(hu);const mu={"qlabel.woa.com":"${Bucket}.cos.${Region}.myqcloud.com","qlabel.tencent.com":"${Bucket}.cos.${Region}.myqcloud.com"},gu=(e,t)=>{const{Scope:[{prefix:s}]}=e;Dn({prefix:s}).then(e=>{let s,i,a;try{({credentials:s,start_time:i,expired_time:a}=e)}catch(o){}if(!e||!s)return console.error("credentials invalid");t({TmpSecretId:s.tmp_secret_id,TmpSecretKey:s.tmp_secret_key,SecurityToken:s.session_token,StartTime:i,ExpiredTime:a})}).catch(e=>{da["default"].prototype.$Message.error("文件上传失败:"+e)})},bu=(e,t)=>{const s=Object(a["template"])(mu[location.hostname]||"${Bucket}.cos-internal.${Region}.tencentcos.cn");return new pu.a({getAuthorization:gu,ChunkSize:5242880,ProgressInterval:500,UploadCheckContentMd5:!0,Domain:s({Bucket:e,Region:t})})},fu=({id:e,Bucket:t,Region:s,Key:i,file:a,handleTaskReady:o,handleUploadSuccess:n,handleUploadFail:r})=>{const l=bu(t,s);return l.on("list-update",t=>{const[{state:s}]=(null===t||void 0===t?void 0:t.list)||[];"success"===s&&vu({id:e,handleUploadSuccess:n})}),l.sliceUploadFile({Bucket:t,Region:s,Key:i,Body:a,onTaskReady(e){o&&o(l,e)}},(e,t)=>{e&&(console.log("err",e),null===r||void 0===r||r()),console.log("data",t)}),l},vu=({id:e,handleUploadSuccess:t})=>{const s={attach_id:e};Rn(s).then(()=>{t()}).catch(e=>{da["default"].prototype.$Message.error(e.message)})},yu=async(e,t)=>new Promise(async(s,i)=>{try{const i=await Ln({...e,attach_name:t.name,attach_size:t.size}),[{attach_id:a,bucket:o,region:n,prefix:r,scene:l}]=i.data,c=bu(o,n);await c.uploadFile({Bucket:o,Region:n,Key:`${r}/${e.obj_id}/${l}/${t.name}`,Body:t.raw,SliceSize:5242880,onProgress(e){Object.assign(t,{progress:e.percent})}}),await Rn({attach_id:a});const d=await Pn({attach_id:a,need_metadata:!0,need_preview:!0});Object.assign(t,{...d,previewUrl:d.preview_url,attach_id:a,filename:t.name}),s({status:"success",response:{url:t.attach_path}})}catch(a){console.log("uploadError",a),Object.assign(t,{status:"fail"}),i({status:"fail",error:"上传失败"})}});var wu={components:{ModelPreview:On,preview:Gn,safeImage:Bs},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{group:{type:String,default:""}},data(){var e;const{objects:t}=this.$optimus,s=this.$renderedComponentConfig.$object_tools,i=Object(a["cloneDeep"])(t).reduce((e,t)=>Object.assign(e,{[t.featureId]:{tags:t.tags}}),{}),o=(this.group?t.filter(e=>e.data.group===this.group):t).map(e=>{const{url:t,filename:s,size:i,date:a,format:o,media_metadata:n}=e.data;return{url:t,name:s,status:"success",size:i,toolName:e.name,date:a,featureId:e.featureId,format:o,media_metadata:n}});return{tools:s,objects:t,initAnswer:i,files:o,curToolName:null===(e=s[0])||void 0===e?void 0:e.name,curSelected:"",fileSignMap:{},attachScene:"label"}},computed:{componentConfigMap(){const e={};return this.tools.forEach(t=>{const{name:s}=t,i=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{group:t,attributes:{reference:i}}=e;return(!this.group||this.group===t)&&("all"===i||i===s)});e[s]={component:"z-form-stage",items:i}}),e},groupObjects(){return this.group?this.objects.filter(e=>e.data.group===this.group):this.objects}},watch:{files:{handler(){this.files.forEach(e=>{e.url&&this.$set(this.fileSignMap,e.url,{previewUrl:e.preview_url,attachId:e.attach_id,downloadLink:e.download_link}),"success"===e.status&&this.addObject(e,e.toolName)})},deep:!0}},created(){this.fetchAttachments()},mounted(){this.$optimus.$on("optimus:default-stage:clear-selectObj",e=>{e!==this.group&&(this.clearSelected(),this.$optimus.$emit("optimus:default-stage:selectObj",null,e))}),this.$optimus.$on("optimus:model-stage:selectObj",(e,t)=>{console.log(e,t),t===this.group&&e&&this.$optimus.$emit("optimus:default-stage:selectObj",e,t)}),this.$optimus.$on("optimus:default-stage:edit-object",(e,t)=>{e===this.group&&(this.selectObject(t),this.scrollObject(t.featureId))}),this.$optimus.$on("optimus:default-stage:delete-object",(e,t)=>{if(e===this.group)if(t)this.removeObject([t.featureId]);else{const e=Object(a["cloneDeep"])(this.$optimus.objects).filter(e=>e.data.group===this.group).map(e=>e.featureId);this.removeObject(e)}})},methods:{async requestMethod(e,t){var s;const i=t.multiple?e[0]:e;return Object.assign(i,{toolName:t.name,date:(new Date).toLocaleString(),featureId:"feature-"+Object(n["j"])(8),format:null===(s=i.name.split("."))||void 0===s?void 0:s.pop(),status:"progress",progress:0}),null!==t&&void 0!==t&&t.multiple||this.files.filter(e=>e.toolName===i.toolName).forEach(e=>{this.removeObject([e.featureId])}),this.files.push(i),this.$nextTick(()=>{this.scrollObject(i.featureId)}),yu({obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_scene:this.attachScene},i)},addObject(e,t){const{type:s,name:i,label:o}=Object(a["find"])(this.tools,{name:t}),{size:n,url:r,featureId:l,filename:c,format:d,date:u,media_metadata:h}=e;if(Object(a["find"])(this.objects,{featureId:l}))return;const p={type:s,name:i,label:o,featureId:l,data:{group:this.group||void 0,url:r,filename:c,size:n,date:u,format:d,media_metadata:Object(a["cloneDeep"])(h)},tags:[]};this.objects.push(p)},async deleteFile(e){var t;const{url:s,name:i,status:o,featureId:n}=e;if("fail"===o||null===(t=this.fileSignMap[s])||void 0===t||!t.attachId){const e=this.files.findIndex(e=>e.featureId===n);return void(-1!==e&&this.files.splice(e,1))}const r=this.$dialog.confirm({header:"确定要删除？",body:i,onConfirm:()=>{zn({attach_id:this.fileSignMap[s].attachId}).then(()=>{const e=Object(a["find"])(this.objects,{featureId:n});this.handleDeleteObj(e),this.$Message.success("删除成功"),r.hide()}).catch(e=>{r.hide(),this.$Message.error("删除失败："+e.message)})}})},handleDeleteObj(e){const t=this.groupObjects.findIndex(t=>t.featureId===e.featureId);-1!==t&&this.objects.splice(t,1);const s=this.files.findIndex(t=>t.featureId===e.featureId);-1!==s&&this.files.splice(s,1)},removeObject(e){e.forEach(e=>{var t;const s=Object(a["find"])(this.objects,{featureId:e});(null===(t=this.fileSignMap[s.data.url])||void 0===t?void 0:t.attachId)&&zn({attach_id:this.fileSignMap[s.data.url].attachId}).then(()=>{this.handleDeleteObj(s)})})},downloadFile(e){window.open("https://"+this.fileSignMap[e.url].downloadLink,"_blank")},fetchAttachments(){const{objectId:e,objectType:t}=this.$optimus,s={obj_type:t,obj_id:e,attach_scene:this.attachScene};return Bn(s).then(e=>{e.data.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,{previewUrl:e.preview_url,attachId:e.attach_id,downloadLink:e.download_link})})})},updateObjTags(e){const t=Object(a["find"])(this.objects,t=>t.featureId===e.featureId);t&&this.$refs["form_"+e.featureId]&&(t.tags=this.$refs["form_"+e.featureId][0].tags)},clearSelected(){this.curSelected=""},selectFile(e){const t=Object(a["find"])(this.objects,t=>t.featureId===e.featureId);t&&"fail"!==e.status&&this.selectObject(t)},selectObject(e){this.curSelected=e.featureId,this.curToolName=e.name,this.group&&this.$optimus.$emit("optimus:model-stage:selectObj",e,this.group)},getPreviewType(e){const t=e.toLowerCase();return["glb","stl","blender","ply","usdz","dae","abc","max","fbx","obj","gltf","zip","blend","usdz"].includes(t)?"model":["jpg","jpeg","png","gif"].includes(t)?"image":["ppt","pdf","txt","csv","xls","xlsm","xlsx","doc","docx"].includes(t)?"cos":"undefined"},scrollObject(e){document.getElementById(e).scrollIntoView({behavior:"smooth"})}}},xu=wu,Cu=(s("60e1"),Object(S["a"])(xu,du,uu,!1,null,"dc3c3692",null)),ju=Cu.exports,Ou={metadata:cu,components:{uploadAnnotation:ju,safeImage:Bs},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})},imageConfig:[String,Object]},data(){return{}},computed:{group(){return this.item.group},imageStyle(){let e={};if(this.imageConfig&&Object(a["isString"])(this.imageConfig))try{e=JSON.parse(this.imageConfig)}catch(t){console.error(t)}else e=this.imageConfig||{};return e}}},ku=Ou,Au=(s("1a9c"),Object(S["a"])(ku,ru,lu,!1,null,"22733cc0",null)),Su=Au.exports,_u=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"video-container"},[s("video",{ref:"videoPlayer",staticClass:"video-js",attrs:{id:e.enginePrimaryKey}},[e.loading?s("div",{staticClass:"vjs-loading"},[e._v("加载中...")]):e._e()])])},Iu=[],$u={label:"视频默认组件",name:"z-default-video",type:"container_component",scene:"视频",attributes:[]},Mu=(s("f263"),s("7ac5"));const Tu={language:"zh-CN",controls:!0,preload:"auto",autoplay:!1,fluid:!0,aspectRatio:"16:9",responsive:!0,playbackRates:[.5,1,1.25,1.5,2]};var Eu={metadata:$u,components:{},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})}},data(){return{player:null,loading:!1}},computed:{enginePrimaryKey(){return this.$optimus.enginePrimaryKey||0},videoSrc(){return this.item.value}},watch:{videoSrc:{handler(e){this.player&&e&&(this.player.src([{src:e}]),this.error=null)},immediate:!1}},beforeDestroy(){this.destroyPlayer()},mounted(){this.initPlayer()},methods:{initPlayer(){this.player=Object(Mu["a"])(this.$refs.videoPlayer||this.enginePrimaryKey,{...Tu,sources:this.videoSrc?[{src:this.videoSrc}]:[]},()=>{this.setupEventListeners()})},setupEventListeners(){this.player&&(this.player.on("waiting",()=>{this.loading=!0}),this.player.on("playing",()=>{this.loading=!1}))},destroyPlayer(){var e;null===(e=this.player)||void 0===e||e.dispose(),this.player=null,this.loading=!1}}},Lu=Eu,Du=(s("13c2"),Object(S["a"])(Lu,_u,Iu,!1,null,"2979c7e8",null)),Pu=Du.exports,Bu=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"json-item"},[e.item.value?s("t-row",{staticClass:"operation",attrs:{align:"center"}},[e.highlightKeywords.length>0?s("t-space",{attrs:{size:"4px"}},[s("span",[e._v("高亮")]),s("t-switch",{attrs:{size:"small"},on:{change:e.handleHighlight},model:{value:e.highlightEnabled,callback:function(t){e.highlightEnabled=t},expression:"highlightEnabled"}})],1):e._e(),s("CopyBtn",{attrs:{content:e.jsonStr}})],1):e._e(),s("div",{staticClass:"json-content"},[e._v(e._s(e.jsonStr))])],1)},Ru=[],zu={label:"JSON默认组件",name:"z-default-json",type:"container_component",scene:"文本",attributes:[{name:"highlightKeywords",label:"文本关键词高亮",value:[],type:Array,component:"z-mark-config"}]},Nu={metadata:zu,components:{CopyBtn:Kr["a"]},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})},highlightKeywords:{type:Array,default:()=>[]}},data(){return{jsonStr:"",textHighlighter:null,highlightEnabled:!!this.highlightKeywords.length}},mounted(){this.jsonStr=this.getJsonView(this.item.value),this.textHighlighter=new Cl(this.$el.querySelector(".json-content"),this.highlightKeywords),this.handleHighlight(this.highlightEnabled),this.$optimus.$on("default-stage:highlight-change",e=>{this.highlightEnabled=e,this.handleHighlight(e)})},methods:{getJsonView(e){try{return Object(a["isString"])(e)?JSON.stringify(JSON.parse(e),null,"\t"):JSON.stringify(e,null,"\t")}catch(t){return e}},handleHighlight(e){e?this.$nextTick(()=>{this.textHighlighter.highlight()}):this.textHighlighter.clear()}}},Fu=Nu,Vu=(s("25df"),Object(S["a"])(Fu,Bu,Ru,!1,null,"25c3924c",null)),qu=Vu.exports,Hu=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"model-item"},[s("modelAnnotation",{ref:"modelAnnotation",attrs:{url:e.tUrl,$renderedComponentConfig:e.$renderedComponentConfig,group:e.group,downloadEnabled:e.item.attributes.downloadEnabled,modelConfig:e.modelConfig}})],1)},Wu=[],Uu={label:"3D模型默认组件",name:"z-default-model",type:"container_component",scene:"3D模型",attributes:[{name:"modelConfig",label:"3D模型默认配置",component:"z-input",type:String,value:""},{label:"是否允许文件下载",name:"downloadEnabled",type:Boolean,component:"z-switch",value:!1}],tools:[{type:"model/file",label:"文件上传",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"model_file_"+(new Date).getTime()}},{label:"是否支持上传多个文件",name:"multiple",type:Boolean,component:"z-switch",value:!0},{label:"允许上传的文件类型（如.glb,.fbx，未配置时不校验）",name:"accept",type:String,value:!1,required:!1},{label:"文件上传说明",name:"description",type:String,required:!1,value:""}]}]},Qu=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"model-annotation"},[s("ModelPreview",{attrs:{url:e.url,downloadEnabled:e.downloadEnabled,enabledFullscreen:!1,modelConfig:e.modelConfig}}),s("t-tabs",{model:{value:e.curToolName,callback:function(t){e.curToolName=t},expression:"curToolName"}},e._l(e.tools,(function(t){return s("t-tab-panel",{attrs:{value:t.name,label:t.label,destroyOnHide:!1}},[s("div",{staticClass:"tab-container"},[s("t-upload",{attrs:{accept:t.accept?t.accept.split(",").join():"*",requestMethod:function(s){return e.requestMethod(s,t)},allowUploadDuplicateFile:!0,multiple:t.multiple,disabled:e.$optimus.disabled,theme:"custom"}},[s("t-button",{attrs:{disabled:e.$optimus.disabled}},[s("t-icon",{attrs:{slot:"icon",name:"upload"},slot:"icon"}),e._v("上传文件")],1)],1),s("div",{staticClass:"tips"},[e._v(e._s(t.description)+" "+e._s(t.accept?"（支持格式为"+t.accept+"）":""))])],1)])})),1),s("div",{staticClass:"file-list"},e._l(e.files,(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.toolName===e.curToolName,expression:"file.toolName === curToolName"}],key:t.featureId,staticClass:"model-file-item",class:{"item-selected":e.curSelected===t.featureId},attrs:{id:t.featureId},on:{click:function(s){return e.selectFile(t)}}},[s("div",{staticStyle:{"margin-bottom":"16px"}},[s("div",{staticClass:"file-container",class:{"upload-failed":"fail"===t.status}},["fail"!==t.status&&e.fileSignMap[t.url]&&(e.fileSignMap[t.url].previewUrl||e.fileSignMap[t.url].downloadLink)?t.toolName===e.curToolName?s("preview",{attrs:{previewType:e.getPreviewType(t.format),filename:t.name,previewUrl:e.fileSignMap[t.url].previewUrl||"https://"+e.fileSignMap[t.url].downloadLink}},[["cos","undefined"].includes(e.getPreviewType(t.format))?s("t-icon",{staticClass:"file-content",staticStyle:{padding:"10px"},attrs:{name:"file-attachment",color:"#ddd"}}):e._e()],1):e._e():s("t-icon",{staticClass:"file-content",attrs:{name:"image-error-filled",color:"#e9e8e8"}}),s("div",{staticClass:"file-desc"},[s("div",[s("t-space",{attrs:{size:8,align:"center"}},[s("span",[e._v(e._s(t.name))]),"progress"===t.status?[s("t-loading",{attrs:{size:"14px"}}),s("t-link",{attrs:{hover:"color",theme:"primary"}},[e._v(e._s(100*t.progress)+"%")])]:"success"===t.status?s("t-icon",{attrs:{name:"check-circle-filled",color:"#2ba471"}}):"fail"===t.status?s("t-icon",{attrs:{name:"error-circle-filled",color:"#d54941"}}):e._e()],2),s("div",{staticClass:"file-properties"},[e._v("文件大小："+e._s((t.size/1048576).toFixed(2))+" MB")]),s("div",{staticClass:"file-properties"},[e._v("上传日期："+e._s(t.date))])],1),"progress"!==t.status?s("t-space",["success"===t.status?s("t-link",{attrs:{theme:"primary",hover:"color"},on:{click:function(s){return e.downloadFile(t)}}},[e._v("下载")]):e._e(),s("t-link",{attrs:{theme:"primary",hover:"color",disabled:e.$optimus.disabled},on:{click:function(s){return e.deleteFile(t)}}},[e._v("删除")])],1):e._e()],1)],1),"fail"===t.status?s("div",{staticStyle:{color:"#d54941"}},[e._v("上传失败")]):e._e()]),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:t,expression:"file"}],ref:"form_"+t.featureId,refInFor:!0,attrs:{component:e.componentConfigMap[t.toolName],context:e.$optimus.context,answer:e.initAnswer[t.featureId],disabled:e.$optimus.disabled}})],1)})),0)],1)},Ju=[],Gu={components:{ModelPreview:On,preview:Gn,safeImage:Bs},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{url:{type:String,required:!0},modelConfig:{type:String,default:""},downloadEnabled:Boolean,group:{type:String,default:""}},data(){var e;const{objects:t}=this.$optimus,s=this.$renderedComponentConfig.$object_tools,i=Object(a["cloneDeep"])(t).reduce((e,t)=>Object.assign(e,{[t.featureId]:{tags:t.tags}}),{}),o=(this.group?t.filter(e=>e.data.group===this.group):t).map(e=>{const{url:t,filename:s,size:i,date:a,format:o}=e.data;return{url:t,name:s,status:"success",size:i,toolName:e.name,date:a,featureId:e.featureId,format:o}});return{tools:s,objects:t,initAnswer:i,files:o,curToolName:null===(e=s[0])||void 0===e?void 0:e.name,curSelected:"",fileSignMap:{},attachScene:"label"}},computed:{componentConfigMap(){const e={};return this.tools.forEach(t=>{const{name:s}=t,i=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{group:t,attributes:{reference:i}}=e;return(!this.group||this.group===t)&&("all"===i||i===s)});e[s]={component:"z-form-stage",items:i}}),e},groupObjects(){return this.group?this.objects.filter(e=>e.data.group===this.group):this.objects}},watch:{files:{handler(){this.files.forEach(e=>{e.url&&this.$set(this.fileSignMap,e.url,{previewUrl:e.preview_url,attachId:e.attach_id,downloadLink:e.download_link}),"success"===e.status&&this.addObject(e,e.toolName)})},deep:!0}},created(){this.fetchAttachments()},methods:{async requestMethod(e,t){var s;const i=t.multiple?e[0]:e;if(Object.assign(i,{toolName:t.name,date:(new Date).toLocaleString(),featureId:"feature-"+Object(n["j"])(8),format:null===(s=i.name.split("."))||void 0===s?void 0:s.pop(),status:"progress",progress:0}),t.multiple)this.files.push(i);else{if(this.files.length>0){const[{featureId:e}]=this.files,t=Object(a["find"])(this.objects,{featureId:e});t&&this.removeObject([e])}this.files=[i]}return this.$nextTick(()=>{this.scrollObject(i.featureId)}),yu({obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_scene:this.attachScene},i)},addObject(e,t){const{type:s,name:i,label:o}=Object(a["find"])(this.tools,{name:t}),{size:n,url:r,featureId:l,filename:c,format:d,date:u}=e;if(Object(a["find"])(this.objects,{featureId:l}))return;const h={type:s,name:i,label:o,featureId:l,data:{group:this.group||void 0,url:r,filename:c,size:n,date:u,format:d},tags:[]};this.objects.push(h)},async deleteFile(e){var t;const{url:s,name:i,status:o,featureId:n}=e;if("fail"===o||null===(t=this.fileSignMap[s])||void 0===t||!t.attachId){const e=this.files.findIndex(e=>e.featureId===n);return void(-1!==e&&this.files.splice(e,1))}const r=this.$dialog.confirm({header:"确定要删除？",body:i,onConfirm:()=>{zn({attach_id:this.fileSignMap[s].attachId}).then(()=>{const e=Object(a["find"])(this.objects,{featureId:n});this.handleDeleteObj(e),this.$Message.success("删除成功"),r.hide()}).catch(e=>{r.hide(),this.$Message.error("删除失败："+e.message)})}})},handleDeleteObj(e){const t=this.groupObjects.findIndex(t=>t.featureId===e.featureId);-1!==t&&this.objects.splice(t,1);const s=this.files.findIndex(t=>t.featureId===e.featureId);-1!==s&&this.files.splice(s,1)},removeObject(e){e.forEach(e=>{var t;const s=Object(a["find"])(this.objects,{featureId:e});this.fileSignMap.length||this.handleDeleteObj(s),(null===(t=this.fileSignMap[s.data.url])||void 0===t?void 0:t.attachId)&&zn({attach_id:this.fileSignMap[s.data.url].attachId}).then(()=>{this.handleDeleteObj(s)})})},downloadFile(e){window.open("https://"+this.fileSignMap[e.url].downloadLink,"_blank")},fetchAttachments(){const{objectId:e,objectType:t}=this.$optimus,s={obj_type:t,obj_id:e,attach_scene:this.attachScene};return Bn(s).then(e=>{e.data.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,{previewUrl:e.preview_url,attachId:e.attach_id,downloadLink:e.download_link})})})},updateObjTags(e){const t=Object(a["find"])(this.objects,t=>t.featureId===e.featureId);t&&this.$refs["form_"+e.featureId]&&(t.tags=this.$refs["form_"+e.featureId][0].tags)},clearSelected(){this.curSelected=""},selectFile(e){const t=Object(a["find"])(this.objects,t=>t.featureId===e.featureId);t&&"fail"!==e.status&&this.selectObject(t)},selectObject(e){this.curSelected=e.featureId,this.curToolName=e.name,this.group&&this.$optimus.$emit("optimus:model-stage:selectObj",e,this.group)},getPreviewType(e){const t=e.toLowerCase();return["glb","stl","blender","ply","usdz","dae","abc","max","fbx","obj","gltf","zip","blend","usdz"].includes(t)?"model":["jpg","jpeg","png","gif"].includes(t)?"image":["ppt","pdf","txt","csv","xls","xlsm","xlsx","doc","docx"].includes(t)?"cos":"undefined"},scrollObject(e){document.getElementById(e).scrollIntoView({behavior:"smooth"})}}},Ku=Gu,Yu=(s("5692"),Object(S["a"])(Ku,Qu,Ju,!1,null,"31b7a91c",null)),Zu=Yu.exports,Xu={metadata:Uu,components:{modelAnnotation:Zu},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})},modelConfig:String},computed:{tUrl(){return this.item.value?`${this.item.value}&_t=${(new Date).getTime()}`:this.item.value},group(){return this.item.group}},mounted(){this.$optimus.$on("optimus:default-stage:clear-selectObj",e=>{var t;e!==this.group&&(null===(t=this.$refs.modelAnnotation)||void 0===t||t.clearSelected(),this.$optimus.$emit("optimus:default-stage:selectObj",null,e))}),this.$optimus.$on("optimus:model-stage:selectObj",(e,t)=>{console.log(e,t),t===this.group&&e&&this.$optimus.$emit("optimus:default-stage:selectObj",e,t)}),this.$optimus.$on("optimus:default-stage:edit-object",(e,t)=>{e===this.group&&(this.$refs.modelAnnotation.selectObject(t),this.$refs.modelAnnotation.scrollObject(t.featureId))}),this.$optimus.$on("optimus:default-stage:delete-object",(e,t)=>{if(e===this.group)if(t)this.$refs.modelAnnotation.removeObject([t.featureId]);else{const e=Object(a["cloneDeep"])(this.$optimus.objects).filter(e=>e.data.group===this.group).map(e=>e.featureId);this.$refs.modelAnnotation.removeObject(e)}})}},eh=Xu,th=(s("bec9"),Object(S["a"])(eh,Hu,Wu,!1,null,"fd4e88e6",null)),sh=th.exports,ih=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"image-lists"},e._l(e.item.value,(function(t){return s("div",{staticClass:"image-lists-item"},[s("safeImage",{key:t.file_name,attrs:{src:t.file_url,isCanvas:!1}}),s("span",[e._v(e._s(t.file_name))])],1)})),0)},ah=[],oh={label:"图片组默认组件",name:"z-default-image-list",type:"container_component",scene:"图片",attributes:[]},nh={metadata:oh,components:{safeImage:Bs},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})}}},rh=nh,lh=(s("84c8"),Object(S["a"])(rh,ih,ah,!1,null,"36904970",null)),ch=lh.exports,dh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"iframe-item"},["web"===e.item.urlType?s("a",{attrs:{href:e.item.value,target:"_blank"}},[s("Icon",{attrs:{type:"ios-link-outline"}}),s("span",{staticClass:"mls"},[e._v("新窗口打开")])],1):e._e(),s("iframe",{style:{height:e.item.height?"100%":"500px"},attrs:{autoplay:"false",src:e.item.value,sandbox:e.isSandbox?"allow-scripts allow-same-origin allow-forms":""}})])},uh=[],hh={label:"网页默认组件",name:"z-default-web",type:"container_component",scene:"网页",attributes:[{name:"isSandbox",label:"是否启用sandbox模式",component:"z-switch",type:Boolean,value:!0}]},ph={metadata:hh,components:{},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})},isSandbox:{type:Boolean,default:!1}}},mh=ph,gh=(s("301b"),Object(S["a"])(mh,dh,uh,!1,null,"32b9ee60",null)),bh=gh.exports,fh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{name:e.name},scopedSlots:e._u([{key:"label",fn:function(){return[s("t-row",{staticStyle:{color:"inherit"},attrs:{justify:"space-between",align:"center"}},[s("span",[e._v(e._s(e.label))]),s("t-popup",{attrs:{placement:"right","overlay-inner-style":{maxWidth:"500px",maxHeight:"500px",padding:"12px",overflow:"auto"}},scopedSlots:e._u([{key:"content",fn:function(){return[s("grid-renderer",{attrs:{data:e.layout}})]},proxy:!0}],null,!1,1891248175)},[s("t-button",{attrs:{size:"small",variant:"text"}},[e._v("预览")])],1)],1)]},proxy:!0}],null,!1,1395235849)},[s("t-textarea",{attrs:{autosize:{maxRows:5}},model:{value:e.$optimus.formData[e.name],callback:function(t){e.$set(e.$optimus.formData,e.name,t)},expression:"$optimus.formData[name]"}})],1):e._e()},vh=[],yh={label:"选项输入",icon:"ios-create-outline",name:"z-layout-config",attributes:[{name:"name",label:"字段标识",type:String,value(){return"switch_"+(new Date).getTime()}},{name:"label",label:"字段名称",type:String,value:"字段名称"}]},wh={metadata:yh,name:"z-layout-config",components:{gridRenderer:{functional:!0,props:["data","attrs"],render(e,{props:t}){const{data:s,attrs:i}=t,a={align:"stretch",gutter:[8,8]},o={...a,...null!==i&&void 0!==i?i:{}},n=s.map(t=>t.children&&t.children.length?e("t-col",{props:t.attrs},[e("div",{class:"grid-container"},[e("grid-renderer",{props:{data:t.children,attrs:t.attrs}})])]):e("t-col",{props:t.attrs},[e("div",{class:"grid-item"},t.group)]));return e("t-row",{props:o,class:"container"},n)}}},mixins:[x["a"]],props:{},data(){return{}},computed:{layout(){let e=[];try{e=JSON.parse(this.$optimus.formData[this.name])}catch(t){console.log(t)}return e},defaultLayout(){const e=Object(a["groupBy"])(this.$optimus.schema,e=>e.group||e.name);return Object.keys(e).filter(t=>e[t].find(e=>e.display)).map(t=>{const[s]=e[t];return{group:t||s.name||s.key,attrs:{span:12}}})}},created(){this.$optimus.formData[this.name]||(this.$optimus.formData[this.name]=JSON.stringify(this.defaultLayout))},methods:{}},xh=wh,Ch=(s("f05f"),Object(S["a"])(xh,fh,vh,!1,null,"5ff99c45",null)),jh=Ch.exports,Oh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("panoramaImage",{staticClass:"image-item",style:e.imageStyle,attrs:{src:e.item.value}})},kh=[],Ah={label:"全景图默认组件",name:"z-default-image-panorama",type:"container_component",scene:"图片",attributes:[{name:"imageConfig",label:"图片配置",component:"z-input",type:String,value:""}]},Sh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"panorama-container"})},_h=[],Ih={props:{src:{type:String,required:!0},autoRotate:{type:Boolean,default:!1},autoRotateSpeed:{type:Number,default:.5}},data(){return{scene:null,camera:null,renderer:null,controls:null,sphere:null,animationId:null}},mounted(){this.init(),this.animate(),window.addEventListener("resize",this.onWindowResize)},beforeDestroy(){this.cleanup()},methods:{init(){this.scene=new ca["Rd"],this.camera=new ca["Lc"](75,this.$refs.container.clientWidth/this.$refs.container.clientHeight,.1,1e3),this.camera.position.set(0,0,.1),this.renderer=new ja["b"]({antialias:!0,alpha:!0}),this.renderer.setSize(this.$refs.container.clientWidth,this.$refs.container.clientHeight),this.renderer.setPixelRatio(window.devicePixelRatio),this.$refs.container.appendChild(this.renderer.domElement);const e=new ca["Yd"](500,60,40);e.scale(-1,1,1);const t=(new ca["je"]).load(this.src);t.colorSpace=ca["Pd"];const s=new ca["Yb"]({map:t});this.sphere=new ca["Xb"](e,s),this.scene.add(this.sphere),this.controls=new Oa["a"](this.camera,this.renderer.domElement),this.controls.enableZoom=!1,this.renderer.domElement.addEventListener("wheel",e=>{e.preventDefault();const t=this.camera.fov+.05*e.deltaY;this.camera.fov=ca["Tb"].clamp(t,10,90),this.camera.updateProjectionMatrix()}),this.controls.enablePan=!1,this.controls.rotateSpeed=-.25,this.controls.enableDamping=!0,this.controls.dampingFactor=.05},animate(){this.animationId=requestAnimationFrame(this.animate),this.autoRotate?(this.controls.autoRotate=!0,this.controls.autoRotateSpeed=this.autoRotateSpeed):this.controls.autoRotate=!1,this.controls.update(),this.renderer.render(this.scene,this.camera)},onWindowResize(){this.camera.aspect=this.$refs.container.clientWidth/this.$refs.container.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.$refs.container.clientWidth,this.$refs.container.clientHeight)},cleanup(){window.removeEventListener("resize",this.onWindowResize),cancelAnimationFrame(this.animationId),this.renderer&&this.renderer.dispose(),this.controls&&this.controls.dispose(),this.sphere&&this.sphere.material&&this.sphere.material.dispose(),this.sphere&&this.sphere.geometry&&this.sphere.geometry.dispose()}}},$h=Ih,Mh=(s("b209"),Object(S["a"])($h,Sh,_h,!1,null,"377f1d32",null)),Th=Mh.exports,Eh={metadata:Ah,components:{panoramaImage:Th},mixins:[Re["a"]],props:{item:{type:Object,default:()=>({})},imageConfig:[String,Object]},data(){return{}},computed:{imageStyle(){let e={};if(this.imageConfig&&Object(a["isString"])(this.imageConfig))try{const t=JSON.parse(this.imageConfig);e=t}catch(t){console.error(t)}else e=this.imageConfig||{};return e}}},Lh=Eh,Dh=(s("bd97"),Object(S["a"])(Lh,Oh,kh,!1,null,"aa9bc2c0",null)),Ph=Dh.exports,Bh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isVisible?s("FormItem",{attrs:{label:e.label,prop:e.name}},[s("div",[s("t-space",[s("t-button",{attrs:{theme:"default",size:"small"},on:{click:function(t){e.visible=!0}}},[e._v("查看配置")]),s("t-button",{attrs:{theme:"primary",size:"small",loading:e.loading,disabled:e.isDisabled},on:{click:e.sendApi}},[e._v("发送请求")])],1)],1),s(e.help,{tag:"component"}),"name"===e.name?s("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(e.label)),s("span",{staticClass:"tips"},[e._v("(由字母、数字、下划线、$组成并不能以数字开头)")])]):s("template",{slot:"label"},[e._v(e._s(e.label)),s("Fitting",{attrs:{answer:e.$optimus.answer,name:e.name}})],1),s("AISuggest",{attrs:{value:e.autoLabelSuggestEnabled&&e.autoLabelObj?e.autoLabelObj:void 0,validator:e.showAutoValidator?e.autoValidatorObj:void 0}}),s("Payload",{attrs:{visible:e.visible,httpConf:e.httpConf},on:{"update:visible":function(t){e.visible=t}}})],2):e._e()},Rh=[],zh=s("c4f6"),Nh=zh["a"],Fh=(s("ed33"),Object(S["a"])(Nh,Bh,Rh,!1,null,"4b6c32b2",null)),Vh=Fh.exports,qh={components:Object(n["n"])([Mi,hs,Ye,it,E,V,xe,_e,De,dt,ft,is,ys,As,Fs,Ys,fi,Oi,Xn,nr,pr,Cd,yr,ai,Tr,Ri,jh,kr,Vh]),metadata:Object(n["p"])([xe,_e,E,V,dt,ft,is,Fs,Ys,fi,Oi,De,ai,Tr,dc,gd,Xd,nu,Su,Ph,Pu,qu,sh,ch,bh,Vh])},Hh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Form",{staticClass:"z-stage-default"},[s("div",{staticClass:"z-stage__content"},[s("div",{staticClass:"z-stage__showing"},[s("div",{staticClass:"detailinfo"},[s("Strong",[e._v("选择工具：")]),s("RadioGroup",{attrs:{type:"button"},model:{value:e.tool,callback:function(t){e.tool=t},expression:"tool"}},e._l(e.$renderedComponentConfig.$object_tools,(function(t){return s("Radio",{key:t.label,attrs:{label:t.label}},[s("span",{style:"color:"+t.color},[e._v(e._s(t.label)+"("+e._s(t.type)+")")])])})),1),s("Divider"),s("table",{on:{click:e.addObject}},[s("tbody",e._l(e.contextInfo,(function(t,i){return s("tr",{key:i},[s("th",[e._v(e._s(t.key))]),s("td",[s("div",{staticClass:"txt-viewer"},[e._v(e._s(t.value))])])])})),0)]),s("br"),s("h3",[e._v("点击表格")]),s("br"),e.objects.length?s("ul",{staticStyle:{background:"#fff",padding:"30px","list-style":"none"}},e._l(e.objects,(function(t){return s("li",{style:"color:"+t.color},[e._v("点击： "+e._s(t.value)+" "+e._s(t.featureId)),s("a",{staticStyle:{"margin-left":"50px"},attrs:{href:"javascript:;"},on:{click:function(s){return e.removeObject(t)}}},[e._v("删除")])])})),0):s("p",[e._v(" 未点击")])],1)]),s("Form",{staticClass:"z-stage__annotation",attrs:{model:e.$optimus.formData}},[s("FormItem",{attrs:{label:"是否有效"}},[s("i-switch",{attrs:{size:"large",disabled:e.$optimus.disabled},model:{value:e.$optimus.validFormData.isValid,callback:function(t){e.$set(e.$optimus.validFormData,"isValid",t)},expression:"$optimus.validFormData.isValid"}},[s("span",{attrs:{slot:"open"},slot:"open"},[e._v("有效")]),s("span",{attrs:{slot:"close"},slot:"close"},[e._v("无效")])])],1),e.$optimus.validFormData.isValid?[s("Tabs",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[s("TabPane",{attrs:{label:"全局标签",name:"global"}},[e._t("default")],2),s("TabPane",{attrs:{label:"元素标签",name:"objects"}},[s("div",{staticClass:"z-stage__objects"},[e.objects.length>0?s("Collapse",e._l(e.objects,(function(t){return s("Panel",{key:t.featureId},[s("div",{staticStyle:{float:"right"}},[s("Button",{attrs:{icon:"ios-create-outline"},on:{click:function(s){return s.stopPropagation(),e.showModal("objectModal",t)}}}),e._v(" "),s("Button",{attrs:{icon:"ios-trash-outline"},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1),e._v(e._s(t.value)),s("p",{attrs:{slot:"content"},slot:"content"},[e._v(" "+e._s(JSON.stringify(t,null,"\t")))])])})),1):e._e(),s("Modal",{attrs:{draggable:""},on:{"on-ok":function(t){return e.save(e.objectModal.model)}},model:{value:e.objectModal.visible,callback:function(t){e.$set(e.objectModal,"visible",t)},expression:"objectModal.visible "}},[e.objectModal.model?[s("div",{attrs:{slot:"header"},slot:"header"},[e._v("标注对象: "+e._s(e.objectModal.model.title))]),s("optimus-engine",{ref:"object",attrs:{component:e.objectFormComponent,context:e.$optimus.context,answer:e.objectModal.model}})]:e._e()],2)],1)])],1)]:s("FormItem",{attrs:{label:"无效原因"}},[s("Input",{attrs:{type:"textarea",disabled:e.$optimus.disabled},model:{value:e.$optimus.validFormData.invalidRemark,callback:function(t){e.$set(e.$optimus.validFormData,"invalidRemark",t)},expression:"$optimus.validFormData.invalidRemark"}})],1)],2)],1)])},Wh=[],Uh={label:"DEMO组件",name:"z-demo-stage",attributes:[{name:"src",label:"网页地址",type:String,value:""}],tools:[{type:"click",label:"点击"}]},Qh={metadata:Uh,mixins:[Re["a"]],data(){return console.log("demo-stage data",this.$optimus.context),{tab:"global",tool:null,objects:this.$optimus.objects,objectFormComponent:{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items},objectModal:{visible:!1,model:null}}},computed:{contextInfo(){return Object(a["chain"])(this.$optimus.context).toPairs().map(([e,t])=>{const s={key:e,value:t};return Object(a["isString"])(t)&&t.startsWith("https://")&&(s.isURL=!0),s}).value()},toolInfo(){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{label:this.tool})}},methods:{showModal(e,t){this[e].visible=!1,this[e].model=null,Promise.resolve().then(()=>{this[e].visible=!0,this[e].model=t})},save(e){if(e.featureId){const t=Object(a["findIndex"])(this.objects,{featureId:e.featureId});this.objects.splice(t,1,Object(a["cloneDeep"])(Object.assign(e,{tags:this.$refs.object.tags})))}else this.objects.push(Object(a["cloneDeep"])(Object.assign(e,{featureId:Math.random(),tags:this.$refs.object.tags})))},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.title,onOk:()=>{this.objects=Object(a["filter"])(this.objects,t=>t.featureId!==e.featureId)}})},addObject(){this.tool?(console.log(this.toolInfo),this.showModal("objectModal",{...this.toolInfo,data:{rand:Math.random()},tags:[]})):alert("请选择工具")}}},Jh=Qh,Gh=(s("66e3"),Object(S["a"])(Jh,Hh,Wh,!1,null,"554209ec",null)),Kh=Gh.exports,Yh=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Form",{ref:e.formRef,attrs:{model:e.$optimus.formData,"label-position":e.positionStyle,"label-colon":""}},[e._t("default")],2)},Zh=[],Xh={name:"z-form-stage",mixins:[Re["a"]],props:{positionStyle:{type:String,default:"top"}},data(){return{formRef:"optimus:base-layout:ref-"+Object(n["j"])(8)}},mounted(){this.$optimus.$on("optimus:forms-stage:check",()=>{this.formsCheck()})},methods:{formsCheck(){this.$refs[this.formRef]&&this.$refs[this.formRef].validate(e=>{this.$optimus.$emit("optimus:optimus-engine:check",e)})}}},ep=Xh,tp=Object(S["a"])(ep,Yh,Zh,!1,null,null,null),sp=tp.exports,ip=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showAttribute:!1,showObjects:!0},scopedSlots:e._u([{key:"operation",fn:function(){return[e.isShowTableTitle&&"horizontal"!==e.tableLayout?s("span",[s("t-popup",{scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"txt-muted mlm mts"},[e._v("请选择要配置为锚点的字段")]),s("t-checkbox-group",{staticClass:"anchor-list",attrs:{options:e.anchorOptions},model:{value:e.anchor.fields,callback:function(t){e.$set(e.anchor,"fields",t)},expression:"anchor.fields"}})]},proxy:!0}],null,!1,4175250046)},[s("t-button",{staticStyle:{padding:"4px"},attrs:{variant:"text",id:"anchor-btn"}},[s("span",{staticClass:"text"},[e._v("字段导航")]),s("t-icon",{attrs:{slot:"suffix",name:"chevron-down",size:"14"},slot:"suffix"})],1)],1),s("t-switch",{attrs:{size:"small"},on:{change:e.handleAnchorChange},model:{value:e.anchor.enabled,callback:function(t){e.$set(e.anchor,"enabled",t)},expression:"anchor.enabled"}})],1):e._e(),e.showHighlight?s("t-space",{attrs:{size:"small"}},[s("span",{staticClass:"text"},[e._v("关键词高亮")]),s("t-switch",{attrs:{size:"small"},on:{change:e.handleHighlightChange},model:{value:e.highlight,callback:function(t){e.highlight=t},expression:"highlight"}})],1):e._e()]},proxy:!0},{key:"component",fn:function(t){var i=t.wordCount;return[s("defaultAnnotation",{attrs:{isShowTableTitle:e.isShowTableTitle,isSandbox:e.isSandbox,isShowRandom:e.isShowRandom,isShowOrderNumber:e.isShowOrderNumber,anchorConfig:e.anchorFields,isAnchor:e.anchor.enabled,tableLayout:e.tableLayout,wordCount:i,imageConfig:e.imageConfig,modelConfig:e.modelConfig,highlightKeywords:e.highlightKeywords,groupConfig:e.groupConfig,customTableLayout:e.customTableLayout,$renderedComponentConfig:e.$renderedComponentConfig}})]}},{key:"objects",fn:function(){return[s("defaultObject",{attrs:{$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},ap=[],op=function(){var e,t=this,i=t.$createElement,a=t._self._c||i;return a("div",{ref:"annotation-container",staticClass:"z-stage-default",class:(e={},e["font-size"+this.fontSize]=!0,e["vertical-layout"]="vertical"===t.layout,e["horizontal-layout"]="horizontal"===t.layout,e)},[a("div",{staticClass:"z-stage__content"},[a("div",{ref:"annotation-content",staticClass:"z-stage__template",style:t.showingStyle},[t.showOperation?a("div",{staticClass:"z-stage__operation"},[t.showWordCount?a("div",{staticClass:"operation__item"},[a("WordCount",{attrs:{controlled:""},on:{change:t.handleWordCountChange}})],1):t._e(),t.showMarkTool?a("div",{staticClass:"operation__item"},[a("span",{staticClass:"text"},[t._v("划词工具")]),a("t-switch",{attrs:{size:"small"},on:{change:t.handleMarkToolChange},model:{value:t.markToolEnabled,callback:function(e){t.markToolEnabled=e},expression:"markToolEnabled"}})],1):t._e(),t.showCodeRunner?a("div",{staticClass:"operation__item"},[a("t-link",{class:t.codeModalVisible?"active":"",attrs:{type:"primary",hover:"color"},on:{click:function(e){t.codeModalVisible=!0}}},[a("span",{staticClass:"mrs blod"},[t._v("运行代码")]),a("t-icon",{attrs:{name:"code"}})],1)],1):t._e(),t._t("operation"),t.showModelConfig?a("div",{staticClass:"operation__item"},[a("span",{staticClass:"text"},[t._v("展开3D配置")]),a("t-switch",{attrs:{size:"small"},on:{change:t.handleModelConfigChange},model:{value:t.modelConfigShow,callback:function(e){t.modelConfigShow=e},expression:"modelConfigShow"}})],1):t._e(),"horizontal"===t.layout?a("div",{staticClass:"operation__item",staticStyle:{"margin-left":"auto"}},[t._t("operation-left"),a("Tooltip",{directives:[{name:"show",rawName:"v-show",value:t.showRightSider&&!t.isExpand,expression:"showRightSider && !isExpand"}],staticStyle:{"margin-left":"auto"},attrs:{content:"展开侧边栏",placement:"bottom-end"}},[a("img",{staticStyle:{cursor:"pointer","vertical-align":"middle"},attrs:{src:s("7e82"),name:"chevron-right",size:"24px"},on:{click:t.changeShwoRightSider}})])],2):t._e()],2):t._e(),a("div",{staticClass:"z-stage__showing"},[t._t("component",null,{wordCount:t.wordCount})],2)]),t.showRightSider?a("Form",{directives:[{name:"show",rawName:"v-show",value:t.isExpand,expression:"isExpand"}],ref:t.formRef,staticClass:"z-stage__annotation",style:{width:t.showDragBar?t.rightSiderWidth:"23%"},attrs:{"label-position":"top",model:t.$optimus.formData}},[t.showDragBar?a("div",{staticClass:"drag-bar",on:{mousedown:t.startDrag}}):t._e(),"horizontal"===t.layout?a("div",{staticClass:"expand-icon"},[a("Tooltip",{attrs:{content:"收起侧边栏",placement:"bottom-end"}},[a("img",{staticStyle:{cursor:"pointer"},attrs:{src:s("7e82"),name:"chevron-left",size:"24px"},on:{click:t.changeShwoRightSider}})])],1):t._e(),[t.showAttribute&&t.attDatas.length>0?a("Card",{attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-bulb-outline"}}),a("span",{staticClass:"mls"},[t._v("标注辅助信息")])],1),a("Table",{staticClass:"base_attribute_table",attrs:{columns:t.attColumns,data:t.attDatas,"show-header":!1,border:"",size:"small"}})],1):t._e(),t.showGlobalTag&&t.tags.length>0?a("Card",{attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-pricetags-outline"}}),a("span",{staticClass:"mls"},[t._v("全局标签")])],1),t._t("global")],2):t._e(),t.objects.length>0&&t.showObjects?t._t("objects",(function(){return[a("Card",{attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"ios-albums-outline"}}),a("span",{staticClass:"mls"},[t._v("元素标签")])],1),a("div",{staticClass:"z-stage__objects"},[a("Collapse",t._l(t.objects,(function(e){return a("Panel",{key:e.featureId},[a("div",{staticClass:"header"},[a("div",{staticClass:"header-left"},[a("div",{staticClass:"feature-id"},[t._v(t._s(e.featureId))]),e.color?a("div",{staticClass:"color",style:{backgroundColor:e.color}}):t._e()]),a("div",{staticClass:"header-right"},[a("Button",{attrs:{icon:"ios-create-outline",disabled:t.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),t.showModal("objectModal",e)}}}),t._v(" "),a("Button",{attrs:{icon:"ios-trash-outline",disabled:t.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),t.removeObject(e)}}})],1)]),a("p",{attrs:{slot:"content"},slot:"content"},[a("pre",{staticStyle:{"word-break":"break-all","white-space":"pre-wrap"}},[t._v(t._s(JSON.stringify(e,null,"\t")))])])])})),1),a("Modal",{attrs:{draggable:""},on:{"on-ok":function(e){return t.save(t.objectModal.model)}},model:{value:t.objectModal.visible,callback:function(e){t.$set(t.objectModal,"visible",e)},expression:"objectModal.visible "}},[a("div",{attrs:{slot:"header"},slot:"header"},[t._v("标注对象: "+t._s(t.objectModal.model?t.objectModal.model.featureId:""))]),t.objectModal.model?[a("optimus-engine",{ref:"object",attrs:{component:t.objectFormComponent,context:t.$optimus.context,answer:t.objectModal.model}})]:t._e()],2)],1)])]})):t._e()]],2):t._e()],1),a("CodeRunnerModal",{model:{value:t.codeModalVisible,callback:function(e){t.codeModalVisible=e},expression:"codeModalVisible"}}),a("TranslateModal",{attrs:{visible:t.translateToolConfig.visible,text:t.selectedRange.text,pin:t.translateToolConfig.pin},on:{"update:pin":function(e){t.translateToolConfig.pin=e}}}),a("MarkModal",{attrs:{visible:t.markToolConfig.visible,range:t.selectedRange,pin:t.markToolConfig.pin},on:{"update:pin":function(e){t.markToolConfig.pin=e},close:function(e){t.markToolConfig.visible=!1},"update:style":t.handleMarkUpdate}})],1)},np=[],rp=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{value:e.value,draggable:"",scrollable:"",mask:!1,"footer-hide":"",fullscreen:e.fullscreen,title:"运行代码",transfer:"",width:"800"},on:{"on-visible-change":e.handleVisibleChange}},[s("Row",{staticClass:"mbs",attrs:{justify:"space-between",align:"middle"}},[s("Select",{staticStyle:{width:"100px"},attrs:{value:e.mode,size:"small",filterable:""},on:{"on-change":e.handleLangChange}},e._l(e.langList,(function(t){return s("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1),s("Row",[s("Icon",{staticClass:"icon-btn",attrs:{type:"md-trash",size:16},on:{click:function(t){e.code=""}}}),s("copyBtn",{attrs:{text:e.code,"show-text":!1}}),s("Icon",{staticClass:"icon-btn",attrs:{type:e.fullscreen?"md-contract":"md-expand",size:16},on:{click:function(t){e.fullscreen=!e.fullscreen}}})],1)],1),s("editor",{key:"code-"+e.fullscreen,attrs:{lang:e.mode},on:{init:e.initEditor},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}}),s("Row",{attrs:{justify:"end"}},[s("Button",{staticClass:"mts",attrs:{type:"primary"},on:{click:e.runCode}},[e._v("运行代码")])],1),e.result||e.loading?[s("Row",{staticClass:"code-result mbs",attrs:{justify:"space-between",align:"middle"}},[s("h4",[e._v("运行结果")]),s("b",{class:e.result},[e._v(e._s(e.resultMap[e.result]||e.result))])]),s("div",{staticClass:"code-detail"},[e.loading?s("Spin",{attrs:{size:"small",fix:""}}):e._e(),e.isIframe?s("iframe",{ref:"codeIframe",staticStyle:{border:"none",width:"100%"}}):s("div",[e._v(e._s(e.detail))])],1)]:e._e()],2)},lp=[],cp=s("0d75"),dp=s.n(cp),up=(s("e45e"),s("2b16"),s("c04f"),s("1bb4"),s("2265"),s("b50c"),s("82aa"),s("4c86"),s("06da"),s("b8eb"),{name:"ModelCodeBar",components:{copyBtn:wl,editor:dp.a},props:{defaultLang:{type:String,default:""},defaultCode:{type:String,default:""},value:{type:Boolean,default:!1}},data(){return{langMap:{cpp:"c_cpp","c++":"c_cpp",go:"golang",golang:"golang",js:"javascript",javascript:"javascript",py:"python",python:"python",java:"java",html:"html",xml:"xml",svg:"svg"},code:this.defaultCode,lang:this.defaultLang,detail:"",result:"",fullscreen:!1,loading:!1,langList:[{label:"c_cpp",value:"c_cpp"},{label:"golang",value:"golang"},{label:"html",value:"html"},{label:"java",value:"java"},{label:"javascript",value:"javascript"},{label:"python",value:"python"},{label:"xml",value:"xml"},{label:"svg",value:"svg"}],resultMap:{passed:"通过",failed:"未通过",error:"异常"}}},computed:{mode(){const e={cpp:"c_cpp",c_cpp:"c_cpp","c++":"c_cpp",go:"golang",golang:"golang",js:"javascript",javascript:"javascript",py:"python",python:"python",java:"java",html:"html",svg:"svg",xml:"xml"};return e[this.lang.toLowerCase()]||""},isIframe(){return["html","svg","xml"].includes(this.mode)}},mounted(){},methods:{initEditor(e){e.getSession().on("change",()=>{this.$emit("change",e.getValue())})},async runCode(){const e={javascript:"js",c_cpp:"cpp",golang:"go"},t=e[this.mode]||this.mode||this.lang;if(["html","svg","xml"].includes(t))this.loading=!0,this.$nextTick(()=>{const e=this.$refs.codeIframe;if(e){const t=e.contentDocument||e.contentWindow.document;e.onload=()=>{this.loading=!1,this.result="passed"},e.onerror=()=>{this.loading=!1,this.result="failed"},t.open(),t.write(this.code),t.close()}else this.loading=!1,this.result="failed"});else{const e={code:this.code,lang:t,timeout:50};try{this.loading=!0;const{res:{detail:t,result:s}}=await Y["a"].sandboxRun(e);this.detail=t,this.result=s}catch(s){this.result="error",console.log(s),this.detail=s.message}finally{this.loading=!1}}},handleVisibleChange(e){this.$emit("input",e)},handleLangChange(e){this.lang=e}}}),hp=up,pp=(s("6255"),Object(S["a"])(hp,rp,lp,!1,null,"b8e54eaa",null)),mp=pp.exports,gp=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.visible?s("t-dialog",{staticClass:"translate-modal",attrs:{visible:e.visible,mode:"modeless",draggable:"",footer:!1,width:"600px",closeBtn:null},scopedSlots:e._u([{key:"header",fn:function(){return[s("t-row",{staticStyle:{width:"100%"},attrs:{align:"center",justify:"space-between"}},[s("div",{staticClass:"t-dialog__header"},[s("t-icon",{attrs:{name:"translate",size:"15"}}),s("span",[e._v("翻译")])],1),s("span",{staticClass:"t-dialog__close",class:e.pin?"pin-active":"",on:{click:e.handlePin}},[s("t-icon",{ref:"pin",attrs:{name:"pin",size:"14"}})],1)])]},proxy:!0}],null,!1,1687530123)},[s("t-row",{attrs:{align:"center"}},[s("div",{staticClass:"col"},[s("t-select",{attrs:{placeholder:"自动检测",disabled:""}})],1),s("div",{staticClass:"arrow"},[s("t-row",{attrs:{justify:"center"}},[s("t-icon",{attrs:{name:"arrow-right",size:"24"}})],1)],1),s("div",{staticClass:"col"},[s("t-select",{attrs:{placeholder:"翻译语言",options:e.languages,popupProps:{overlayClassName:"model-select"}},model:{value:e.language,callback:function(t){e.language=t},expression:"language"}})],1)]),s("t-loading",{attrs:{loading:e.loading,size:"small"}},[s("t-row",{staticClass:"text-content",attrs:{justify:"space-between"}},[s("span",[e._v(e._s(e.originText))]),s("div",{staticClass:"divider"}),e.errorText?s("span",{staticClass:"t-is-error"},[e._v(e._s(e.errorText))]):s("span",[e._v(e._s(e.translateText))])])],1),s("t-row",{staticClass:"operate-btns",attrs:{justify:"space-between",align:"center"}},[s("div",[s("t-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.translateText||e.originText,expression:"translateText||originText",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.copySuccessHandler,expression:"copySuccessHandler",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:e.copyErrorHandler,expression:"copyErrorHandler",arg:"error"}],attrs:{variant:"text",size:"small"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"file-copy"}})]},proxy:!0}],null,!1,4190866036)},[e._v("复制")]),s("t-button",{attrs:{variant:"text",size:"small"},on:{click:function(t){return e.handleTranslate("baidu")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"link"}})]},proxy:!0}],null,!1,550827290)},[e._v("百度翻译")]),s("t-button",{attrs:{variant:"text",size:"small"},on:{click:function(t){return e.handleTranslate("google")}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"link"}})]},proxy:!0}],null,!1,550827290)},[e._v("google翻译")])],1),s("t-dropdown",{attrs:{placement:"bottom-right",minColumnWidth:120,popupProps:{overlayClassName:"model-dropdown"}}},[s("t-row",{attrs:{align:"center"}},[s("span",{staticClass:"small-font"},[e._v("翻译模型：")]),s("t-button",{staticStyle:{padding:"4px"},attrs:{variant:"text",size:"small"}},[s("span",[e._v(e._s(e.model))]),s("t-icon",{attrs:{slot:"suffix",name:"chevron-down",size:"14"},slot:"suffix"})],1)],1),s("t-dropdown-menu",e._l(e.models,(function(t){return s("t-dropdown-item",{key:t.value,attrs:{value:t.value,active:e.model===t.value},on:{click:function(s){e.model=t.value}}},[s("span",[e._v(e._s(t.label))])])})),1)],1)],1)],1):e._e()},bp=[],fp=s("6f1e"),vp={inject:["$optimus"],props:{visible:{type:Boolean,default:!1},text:{type:String,default:""},pin:{type:Boolean,default:!1}},data(){return{language:"",languages:[{label:"中文",value:"中文"},{label:"English - 英文",value:"英文"}],models:[{label:"hunyuan-turbo",value:"hunyuan-turbo"},{label:"hunyuan-large",value:"hunyuan-large"},{label:"gpt-4o",value:"gpt-4o"},{label:"gpt-4o-mini",value:"gpt-4o-mini"}],model:"hunyuan-large",translateText:"",loading:!1,errorText:"",originText:""}},watch:{model(){this.getTranslate()},language(){this.getTranslate()},text(){if(this.text){this.originText=this.text;const e=/[\u4e00-\u9fa5]/.test(this.text),t=e?"英文":"中文";t!==this.language?this.language=t:this.getTranslate()}}},methods:{handleTranslate(e){switch(e){case"baidu":window.open("https://fanyi.baidu.com/#zh/en/"+this.originText);break;case"google":window.open(`https://translate.google.com/?sl=auto&tl=${"中文"===this.language?"zh-CN":"en"}&op=translate&text=${this.originText}%0A`);break;default:break}},copySuccessHandler(){this.$Message.success("已复制到剪贴板")},copyErrorHandler(){this.$Message.error("复制失败")},handlePin(){this.$emit("update:pin",!this.pin)},async getTranslate(){this.loading=!0;const e={text:this.originText,llm:this.model,target_language:this.language};try{var t;const{data:s}=await fp["a"].translate(e);s.error?this.errorText=s.error.message:null!==(t=s.data)&&void 0!==t&&t.result&&(this.translateText=s.data.result,this.errorText="")}catch(s){this.errorText=s}finally{this.loading=!1}}}},yp=vp,wp=(s("9917"),s("ce0d"),Object(S["a"])(yp,gp,bp,!1,null,"1fdf4510",null)),xp=wp.exports,Cp=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.visible?s("t-dialog",{attrs:{visible:e.visible,mode:"modeless",draggable:"",width:"600px",closeBtn:null},on:{cancel:e.handleCancel,confirm:e.handleConfirm},scopedSlots:e._u([{key:"header",fn:function(){return[s("t-row",{staticStyle:{width:"100%"},attrs:{align:"center",justify:"space-between"}},[s("div",{staticClass:"t-dialog__header"},[s("t-icon",{attrs:{name:"edit-2",size:"15"}}),s("span",[e._v("标记")])],1),s("span",{staticClass:"t-dialog__close",class:e.pin?"pin-active":"",on:{click:e.handlePin}},[s("t-icon",{ref:"pin",attrs:{name:"pin",size:"14"}})],1)])]},proxy:!0}],null,!1,1741525203)},[s("t-row",[s("span",[e._v("预览：")]),s("span",{style:{backgroundColor:e.backgroundColor,color:e.color}},[e._v(e._s(e.range.text))])]),s("t-row",{staticClass:"mtm"},[s("span",[e._v("标记样式：")]),s("t-popup",{attrs:{overlayInnerClassName:"color-popup",trigger:"click"},scopedSlots:e._u([{key:"content",fn:function(){return[s("t-color-picker-panel",{attrs:{"color-modes":["monochrome"],"enable-alpha":!0,format:"RGBA"},model:{value:e.backgroundColor,callback:function(t){e.backgroundColor=t},expression:"backgroundColor"}})]},proxy:!0}],null,!1,407674758)},[s("t-button",{attrs:{variant:"text",size:"small"}},[s("div",{staticClass:"color-box",style:{backgroundColor:e.backgroundColor}}),s("div",{staticClass:"label-text"},[e._v("背景色")]),s("t-icon",{attrs:{slot:"suffix",name:"chevron-down",size:"14"},slot:"suffix"})],1)],1),s("t-popup",{attrs:{overlayInnerClassName:"color-popup",trigger:"click"},scopedSlots:e._u([{key:"content",fn:function(){return[s("t-color-picker-panel",{attrs:{"color-modes":["monochrome"]},model:{value:e.color,callback:function(t){e.color=t},expression:"color"}})]},proxy:!0}],null,!1,2537031347)},[s("t-button",{attrs:{variant:"text",size:"small"}},[s("div",{staticClass:"color-box",style:{backgroundColor:e.color}}),s("div",{staticClass:"label-text"},[e._v("文字色")]),s("t-icon",{attrs:{slot:"suffix",name:"chevron-down",size:"14"},slot:"suffix"})],1)],1)],1),s("t-textarea",{staticClass:"mtm",attrs:{placeholder:"写批注（非必填）",autosize:{minRows:3,maxRows:3}},model:{value:e.markContent,callback:function(t){e.markContent=t},expression:"markContent"}})],1):e._e()},jp=[],Op={inject:["$optimus"],props:{visible:{type:Boolean,default:!1},range:{type:Object,default:()=>({})},pin:{type:Boolean,default:!1}},data(){return{color:void 0,backgroundColor:void 0,markContent:""}},computed:{},watch:{},methods:{handlePin(){this.$emit("update:pin",!this.pin)},handleCancel(){this.$emit("close")},handleConfirm(){this.$emit("update:style",{color:this.color,backgroundColor:this.backgroundColor}),this.handleCancel()}}},kp=Op,Ap=(s("12f7"),s("2a0e"),Object(S["a"])(kp,Cp,jp,!1,null,"47bdd643",null)),Sp=Ap.exports;function _p({container:e=document.body,width:t="300px",height:s="100px",textAlign:i="center",textBaseline:a="middle",font:o="18px Microsoft Yahei",fillStyle:n="rgba(184, 184, 184, 0.2)",content:r="",rotate:l=-10,zIndex:c=1e4,excludeElement:d=null}={}){if(!r)return;const u=e.querySelector("#warterMK");if(u)return;const h=document.createElement("canvas");h.setAttribute("width",t),h.setAttribute("height",s);const p=h.getContext("2d");p.textAlign=i,p.textBaseline=a,p.font=o,p.fillStyle=n,p.rotate(Math.PI/180*l),p.fillText(r,parseFloat(t)/2,parseFloat(s)/2);const m=h.toDataURL(),g=document.createElement("div");let b=`\n    position:absolute;\n    top:0;\n    left:0;\n    bottom:0;\n    right:0;\n    width:100%;\n    height:100%;\n    z-index:${c};\n    pointer-events:none;\n    background-repeat:repeat;\n    background-size: 150px;\n    background-image:url('${m}');`;if(d){const t=e.getBoundingClientRect(),s=d.getBoundingClientRect(),i=s.left-t.left,a=s.top-t.top;console.log(s),b+=`\n  --clip-path: polygon(0px 0px, 0px 100%,\n    ${i}px 100%,\n    ${i}px ${a}px,\n    ${i+s.width}px ${a}px,\n    ${i+s.width}px ${a+s.height}px,\n    ${i}px ${a+s.height}px,\n    ${i}px 100%, 100% 100%, 100% 0px);\n  -webkit-clip-path: var(--clip-path);\n  clip-path: var(--clip-path);`}g.setAttribute("style",b),g.setAttribute("id","warterMK"),e.appendChild(g)}function Ip(){const e=document.querySelectorAll("#warterMK");e.forEach(e=>{const t=e.parentNode;t.removeChild(e)})}var $p={loadWaterMark:_p,removeWaterMark:Ip},Mp={components:{CodeRunnerModal:mp,WordCount:ue,TranslateModal:xp,Markdown:ml,MarkModal:Sp},mixins:[Re["a"]],props:{showGlobalTag:{type:Boolean,default:!0},showObjects:{type:Boolean,default:!1},showAttribute:{type:Boolean,default:!0},showingStyle:{type:Object,default:()=>{}},layout:{type:String,default:"horizontal"},fontSize:{type:String,default:"14"},isWatermarkEnabled:{type:Boolean,default:!0}},data(){return{attColumns:[{align:"center",key:"name",className:"attribute-table-name",maxWidth:60},{key:"value",className:"attribute-table-value",render:(e,t)=>"markdown"===t.row.stringType?e(ml,{props:{content:t.row.value},style:{fontSize:"1em",padding:"8px 0",backgroundColor:"transparent"}}):e("pre",{style:{wordWrap:"break-word",whiteSpace:"pre-wrap"},domProps:{innerHTML:"html"===t.row.stringType?t.row.value:void 0}},t.row.value)}],attDatas:[],objects:this.$optimus.objects,tags:this.$optimus.tags,objectFormComponent:{component:"z-form-stage",items:this.$parent.$renderedComponentConfig.$object_items},objectModal:{visible:!1,model:null},formRef:"optimus:base-layout:ref-"+Object(n["j"])(8),wordCount:{enabled:!0,type:"字数"},markToolEnabled:"false"!==localStorage.getItem("mark-tool-enabled"),modelConfigShow:"true"===localStorage.getItem("model-config-show"),isExpand:!0,codeModalVisible:!1,form:{errorMsgDesc:""},selectedRange:{},translateToolConfig:{visible:!1,pin:!1},markToolConfig:{visible:!1,pin:!1},rightSiderWidth:localStorage.getItem("optimus-base-layout-z-stage__annotation")||"23%"}},computed:{showRightSider(){const e=this.$optimus.renderedComponentConfig.items.find(e=>!e.attributes.hidden);return this.showGlobalTag&&this.tags.length>0&&e||this.showObjects&&this.objects.length>0||this.showAttribute&&this.attDatas.length>0},showWordCount(){return["z-default-stage","z-ai-history-chat-stage","z-ai-reinforcement-learning-stage"].includes(this.$optimus.renderedComponentConfig.component)},showCodeRunner(){return["z-default-stage","z-ai-history-chat-stage","z-ai-reinforcement-learning-stage"].includes(this.$optimus.renderedComponentConfig.component)},showMarkTool(){return["z-default-stage","z-ai-history-chat-stage","z-ai-reinforcement-learning-stage"].includes(this.$optimus.renderedComponentConfig.component)},showModelConfig(){const e=this.$optimus.schema.find(e=>"model"===e.url_type&&e.display);return["z-default-stage","z-multiple-groups-stage"].includes(this.$optimus.renderedComponentConfig.component)&&e},showOperation(){return this.showRightSider&&!this.isExpand||this.showWordCount||this.showCodeRunner},showDragBar(){var e;return"horizontal"===this.layout&&!(null!==(e=this.showingStyle)&&void 0!==e&&e.flex)},watermarkContent(){var e;return this.isWatermarkEnabled&&(null===(e=this.$optimus.reference)||void 0===e?void 0:e.watermarkContent)||""}},created(){this.$optimus.schema.forEach(e=>{if(e.display){let t,s;this.$optimus.context?Object(a["isObject"])(this.$optimus.context[e.key])?t=JSON.stringify(this.$optimus.context[e.key],null,2):(t=this.$optimus.context[e.key],s=e.string_type):t="",this.attDatas.push({name:e.name,value:t,stringType:s})}})},mounted(){this.showRightSider&&this.$optimus.$on("optimus:forms-stage:check",()=>{this.$refs[this.formRef].validate(e=>{this.$optimus.$emit("optimus:optimus-engine:check",e)})}),this.$optimus.$on("optimus:mark-tool:change",e=>{this.markToolEnabled=e,localStorage.setItem("mark-tool-enabled",this.markToolEnabled)}),this.$EventBus.$on("optimus:translate-modal",(e,t="")=>{this.translateToolConfig.pin||(this.translateToolConfig.visible=e),t&&(this.selectedRange={text:t})}),this.$EventBus.$on("optimus:mark-tool-modal",(e,t)=>{this.markToolConfig.visible=e,t.text&&(this.selectedRange=t)}),this.renderWatermark(),this.handleResize=Object(a["debounce"])(()=>{this.renderWatermark()},100),!this.isWatermarkEnabled&&window.addEventListener("resize",this.handleResize)},beforeDestroy(){$p.removeWaterMark(),this.handleResize&&window.removeEventListener("resize",this.handleResize)},methods:{renderWatermark(){var e;$p.loadWaterMark({container:this.$refs["annotation-container"],content:null===(e=this.$optimus.reference)||void 0===e?void 0:e.watermarkContent,excludeElement:this.isWatermarkEnabled?null:this.$refs["annotation-content"]})},changeShwoRightSider(){this.isExpand=!this.isExpand,this.$nextTick(()=>{!this.isWatermarkEnabled&&this.renderWatermark()})},showModal(e,t){this[e].visible=!1,this[e].model=null,Promise.resolve().then(()=>{this[e].visible=!0,this[e].model=t})},save(e){if(e.featureId){const t=Object(a["findIndex"])(this.objects,{featureId:e.featureId});this.objects.splice(t,1,Object(a["cloneDeep"])(Object.assign(e,{tags:this.$refs.object.tags})))}},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})},handleWordCountChange(e,t){this.$EventBus.$emit("optimus:word-count:change",e,t),"word-count"===e?this.wordCount.enabled=t:"word-count-type"===e&&(this.wordCount.type=t)},handleMarkToolChange(){this.$optimus.$emit("optimus:mark-tool:change",this.markToolEnabled)},handleModelConfigChange(){localStorage.setItem("model-config-show",this.modelConfigShow),this.$optimus.$emit("optimus:model-config:change",this.modelConfigShow)},handleMarkUpdate(e){const t=document.createElement("span");t.style.backgroundColor=e.backgroundColor,t.style.color=e.color,this.selectedRange.range.surroundContents(t)},startDrag(e){const t=this.$refs["annotation-container"],s=.15*t.offsetWidth,i=.7*t.offsetWidth,a=this.$refs[this.formRef].$el||this.$refs[this.formRef],o=e.clientX,n=a.offsetWidth,r=e=>{const a=e.clientX-o;let r=n-a;r=Math.max(s,Math.min(i,r));const l=r/t.offsetWidth*100;this.rightSiderWidth=l.toFixed(2)+"%",localStorage.setItem("optimus-base-layout-z-stage__annotation",this.rightSiderWidth)},l=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",l)}},asyncMethods:{}},Tp=Mp,Ep=(s("3b7e"),Object(S["a"])(Tp,op,np,!1,null,"3ff29041",null)),Lp=Ep.exports,Dp={label:"多URl通用模板标注",icon:"ios-image-outline",name:"z-default-stage",repeatable:!0,attributes:[{name:"tableLayout",label:"页面布局",type:String,value:"vertical",component:"z-single-select",attributes:{options:[{label:"纵向",value:"vertical"},{label:"横向",value:"horizontal"},{label:"自定义",value:"custom"}]}},{name:"customTableLayout",label:"自定义布局",type:String,value:"",component:"z-layout-config",attributes:{isVisible:'${output.tableLayout === "custom"}'}},{name:"isShowTableTitle",label:"是否显示容器名称",component:"z-switch",type:Boolean,value:!0},{name:"isShowOrderNumber",label:"是否显示容器序号",component:"z-switch",type:Boolean,value:!1,isNeedDisabled:!0},{name:"isShowRandom",label:"容器是否随机展示",component:"z-switch",type:Boolean,value:!1,isNeedDisabled:!0},{name:"isAnchor",label:"容器是否配置锚点",component:"z-switch",type:Boolean,value:!1},{name:"anchorConfig",label:"锚点配置",component:"z-anchor-config",type:Array,value:[],attributes:{isVisible:"${!!output.isAnchor}"}},{component:"z-divider",attributes:{title:"标注组件默认配置",tip:"统一设置容器内标注组件默认配置"}},{name:"isSandbox",label:"iframe是否启用sandbox模式",component:"z-switch",type:Boolean,value:!0},{name:"imageConfig",label:"图片配置",component:"z-input",type:String,value:""},{name:"modelConfig",label:"3D模型默认配置",component:"z-input",type:String,value:""},{name:"highlightKeywords",label:"文本关键词高亮",value:[],type:Array,component:"z-mark-config"},{name:"groupConfig",label:"组配置",type:Object,value:"",attributes:{isVisible:!1}}]},Pp=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"detailinfo"},[e.isAnchor&&e.anchorConfig.length&&"horizontal"!==e.tableLayout?s("t-anchor",{staticClass:"anchor",attrs:{container:"#anchor-container_"+(e.$optimus.$attrs.name||""),size:"small"},on:{click:e.handleAnchorClick}},e._l(e.anchors,(function(t){return s("t-anchor-item",{key:t.value,attrs:{title:t.label,href:"#content_"+(e.$optimus.$attrs.name||"")+"_"+t.value}})})),1):e._e(),s("grid-renderer",{attrs:{data:e.layout,root:!0,extra:{tableLayout:e.tableLayout,info:e.info,$renderedComponentConfig:e.$renderedComponentConfig,activeGroup:e.activeGroup,wordCount:e.wordCount,engineName:e.$optimus.$attrs.name||"",isShowOrderNumber:e.isShowOrderNumber,isShowTableTitle:e.isShowTableTitle}},on:{click:e.handleGroupUpdate}})],1)},Bp=[],Rp=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"item-container",style:{height:e.item.height?e.item.height:"100%"}},[s("t-row",{attrs:{justify:e.title?"space-between":"end",align:"center"}},[e.title?s("div",{staticClass:"item-title"},[e._v(e._s(e.title))]):e._e(),e.item.shortCuts?s("div",{staticClass:"shortCuts"},[e.item.group&&e.activeGroup===e.item.group?s("t-popup",{attrs:{placement:"bottom-end",overlayInnerStyle:{maxHeight:"500px",overflow:"auto"}},scopedSlots:e._u([{key:"content",fn:function(){return[s("h3",[e._v("快捷键")]),e._l(e.item.shortCuts,(function(t){return s("div",[s("h4",{staticClass:"mbm"},[e._v(e._s(t.label))]),e._l(t.attributes,(function(t){return s("t-row",{staticClass:"mbm",staticStyle:{gap:"4px"},attrs:{align:"center"}},[e._l(t.name,(function(i,a){return s("span",[s("t-button",{staticStyle:{width:"85px"},attrs:{size:"small",variant:"outline",disabled:!t.global&&e.$optimus.disabled}},[e._v(e._s(i))]),a<t.name.length-1?[t.connection?s("span",[e._v(e._s(t.connection))]):s("span",{staticClass:"mrm mlm"},[e._v("+")])]:e._e()],2)})),s("span",[e._v(e._s(t.label))])],2)}))],2)}))]},proxy:!0}],null,!1,2726169727)},[s("t-button",{attrs:{size:"small",variant:"text"},scopedSlots:e._u([{key:"icon",fn:function(){return[s("t-icon",{attrs:{name:"keyboard"}})]},proxy:!0}],null,!1,2854963543)})],1):e._e()],1):e._e()]),s("div",{staticClass:"item-component"},[s(e.item.component,e._b({key:e.item.group,tag:"component",attrs:{$renderedComponentConfig:e.itemComponentConfig,group:e.item.group,activeGroup:e.activeGroup,item:e.item,wordCount:e.wordCount}},"component",e.item.attributes,!1))],1)],1)},zp=[],Np={components:{"z-text-tool":dc,"z-audio-tool":gd,"z-default-text":Xd,"z-default-model":sh,"z-default-image":Su,"z-default-image-list":ch,"z-default-json":qu,"z-default-audio":nu,"z-default-video":Pu,"z-default-web":bh,"z-default-image-panorama":Ph},mixins:[Re["a"]],props:{item:Object,wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},activeGroup:{type:String,default:""},title:String},data(){return{isFullscreen:!1}},computed:{itemComponentConfig(){const e=this.$renderedComponentConfig.$object_tools.filter(e=>e.group===this.item.group),t=this.$renderedComponentConfig.$object_items.filter(e=>e.group===this.item.group),s={...this.$renderedComponentConfig,$object_tools:e,$object_items:t,attributes:this.item.attributes};return s}},mounted(){},methods:{}},Fp=Np,Vp=(s("e634"),Object(S["a"])(Fp,Rp,zp,!1,null,"1674d836",null)),qp=Vp.exports,Hp=s("7b40"),Wp={components:{DefaultAnnotationItem:qp,gridRenderer:{functional:!0,props:["data","attrs","extra"],render(e,{props:t,listeners:s}){const{data:i,attrs:a,extra:o}=t,{info:n,$renderedComponentConfig:r,tableLayout:l,activeGroup:c,wordCount:d,engineName:u,isShowOrderNumber:h,isShowTableTitle:p}=o,m={align:"stretch",gutter:[8,8]},g={...m,...null!==a&&void 0!==a?a:{}},b=e=>{s.click&&s.click(e)},f=i.map(t=>{if(t.children&&t.children.length)return e("t-col",{props:t.attrs,style:t.style},[e("div",{class:"grid-container"},[e("grid-renderer",{props:{data:t.children,attrs:t.attrs,extra:o},on:{click:e=>b(e)}})])]);const s=n.findIndex(e=>t.group===(e.group||e.name)),i=-1===s?{}:n[s],a=`${h?s+1:""}${p&&h?": ":""}${p?t.group:""}`;return e("t-col",{props:t.attrs,style:t.style},[e("div",{class:["grid-item",c===t.group?"active":""],on:{click:()=>b(t.group)},domProps:{id:`content_${u}_${i.key}`}},[e("default-annotation-item",{props:{item:i,$renderedComponentConfig:r,wordCount:d,title:a,activeGroup:c},domProps:{id:`${u}_default_item_${t.group}`}})])])});return e("t-row",{props:g,style:{flex:1,height:"100%"},class:["grid",l],domProps:{id:"anchor-container_"+u}},f)}}},mixins:[Re["a"]],props:{isShowTableTitle:{type:Boolean,default:!0},isSandbox:{type:Boolean,default:!0},isShowOrderNumber:{type:Boolean,default:!1},isShowRandom:{type:Boolean,default:!1},isAnchor:{type:Boolean,default:!1},anchorConfig:{type:Array,default:()=>[]},tableLayout:{type:String,default:"vertical"},wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},imageConfig:{type:String,default:""},modelConfig:{type:String,default:""},highlightKeywords:{type:Array,default:()=>[]},customTableLayout:String,groupConfig:Object},data(){let e=Object(a["chain"])(this.$optimus.schema).filter(e=>e.display).value();if(this.$optimus.extData){const t=Object(a["cloneDeep"])(e);e=this.$optimus.extData.filter(e=>{var t;return null===(t=Object(a["find"])(this.$optimus.schema,{key:e.key}))||void 0===t?void 0:t.display}).map(e=>Object(a["find"])(t,{key:e.key}))}else this.isShowRandom&&(e=Object(a["shuffle"])(e),this.$optimus.extData=e.map((e,t)=>{const{key:s,name:i}=e;return{key:s,name:i,display:t+1}}));const t=Object(a["groupBy"])(e,e=>e.group||e.name),s=Object.keys(t).map(e=>{var s,i,o,n,r;const[l]=t[e],c=null===(s=this.groupConfig)||void 0===s?void 0:s[e],{key:d,name:u,type:h}=l;let p=this.$optimus.context?this.$optimus.context[d]:"";try{"array"===h&&Object(a["isString"])(p)&&(p=JSON.parse(p)),"array"===h&&Object(a["isArray"])(p)&&p.some(e=>Object(a["isString"])(e))&&(p=p.map(e=>({file_url:e}))),"string"!==h||Object(a["isString"])(p)||(p=JSON.stringify(p))}catch(y){console.error("value出错",{value:p})}const m=c&&c.component&&"default"!==(null===c||void 0===c?void 0:c.component)?null===c||void 0===c?void 0:c.component:Hp["a"].getDefaultComponent(l.type,l.url_type),g=this.$OptimusComponentMetadata.find(e=>e.name===m),b=(null===c||void 0===c||null===(i=c.attributes)||void 0===i?void 0:i.height)||l.height||"",f=["z-text-tool","z-default-text","z-default-json"].includes(m),v={..."image"===l.url_type&&{imageConfig:this.imageConfig},..."model"===l.url_type&&{modelConfig:this.modelConfig},...["web","mixed"].includes(l.url_type)&&{isSandbox:this.isSandbox},...(null===c||void 0===c?void 0:c.attributes)||{},...f&&{highlightKeywords:null!==c&&void 0!==c&&null!==(o=c.attributes)&&void 0!==o&&null!==(n=o.highlightKeywords)&&void 0!==n&&n.length?null===c||void 0===c||null===(r=c.attributes)||void 0===r?void 0:r.highlightKeywords:this.highlightKeywords}};return{key:d,name:u,value:p,group:e,component:m,attributes:v,shortCuts:null===g||void 0===g?void 0:g.shortCuts,type:h,urlType:l.url_type?l.url_type:"",stringType:l.string_type||"text",height:b?b+"px":""}});return{info:s,curAnchor:"",activeGroup:""}},computed:{layout(){if("custom"===this.tableLayout)try{return JSON.parse(this.customTableLayout)}catch(t){return console.log(t),[]}const e=Object(a["groupBy"])(this.$optimus.schema,e=>e.group||e.name);return Object.keys(e).filter(t=>e[t].find(e=>e.display)).map(t=>{const[s]=e[t];return{group:t||s.name||s.key,attrs:"vertical"===this.tableLayout?{span:12}:{},style:"horizontal"===this.tableLayout?{width:"100%"}:{}}})},anchors(){return this.info.filter(e=>this.anchorConfig.find(t=>t.value===e.key)).map(e=>({label:e.group||e.name,value:e.key}))}},mounted(){this.$EventBus.$on("default-stage-item-click",(e,t)=>{this.$optimus.$attrs.name===t?(this.activeGroup!==e&&this.$optimus.$emit("optimus:default-stage:clear-selectObj",e),this.activeGroup=e):this.activeGroup=""})},methods:{handleGroupUpdate(e){this.$EventBus.$emit("default-stage-item-click",e,this.$optimus.$attrs.name)},handleAnchorClick({e:e}){e.preventDefault()},getAttrValue(e,t){var s;return void 0!==(null===(s=t.attributes)||void 0===s?void 0:s[e])?t.attributes[e]:this[e]}}},Up=Wp,Qp=(s("f19c"),Object(S["a"])(Up,Pp,Bp,!1,null,"116c6914",null)),Jp=Qp.exports,Gp=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.isEmpty(e.objectsGroupMap)?e._e():s("Collapse",{staticClass:"container_collapse",attrs:{value:e.openAll}},e._l(e.objectsGroupMap,(function(t,i){return s("Panel",{key:i,attrs:{name:i},scopedSlots:e._u([{key:"content",fn:function(){return[s("Collapse",{staticClass:"object_collapse",attrs:{value:e.getOpenAll(t)}},e._l(t,(function(t,a){return s("Panel",{key:a,attrs:{name:a},scopedSlots:e._u([{key:"content",fn:function(){return[e._l(t,(function(t,a){return[s("CellGroup",[s("Cell",{key:t.featureId,attrs:{selected:e.activeItem&&e.activeItem.featureId===t.featureId,id:t.featureId,name:t.featureId},nativeOn:{click:function(s){return e.selectObject(i,t)}}},[s("Row",{attrs:{type:"flex",justify:"start",align:"middle",wrap:!1}},[t.color?s("div",{staticClass:"color",style:{backgroundColor:t.color}}):e._e(),s("div",{staticClass:"title"},[e._v(e._s(e.getLabel(t,a)))])]),s("div",{staticClass:"ellipsis"},[e.getLocalVal(t)?s("span",[e._v(e._s(e.getLocalVal(t)))]):e._e()]),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.selectObject(i,t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(i,t)}}})],1)],2)],1)]}))]},proxy:!0}],null,!0)},[s("span",[e._v(e._s(a))]),t.length?s("span",[e._v("("+e._s(t.length)+")")]):e._e()])})),1)]},proxy:!0}],null,!0)},[s("b",[e._v(e._s(e.getGroupTitle(i)))]),s("span",{staticStyle:{float:"right","margin-right":"16px"},on:{click:function(t){return e.handleDeleteGroup(t,i)}}},[e._v("清空")])])})),1)],1)])},Kp=[],Yp={mixins:[Re["a"]],data(){return{isEmpty:a["isEmpty"],activeItem:null,objects:this.$optimus.objects}},computed:{componentConfig(){return Object(a["groupBy"])(this.$renderedComponentConfig.$object_items,e=>e.group)},objectsGroupMap(){const e=Object(a["groupBy"])(this.objects.filter(e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.group}),e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.group}),t={};return Object.keys(e).forEach(s=>{const i=e[s];t[s]=Object(a["groupBy"])(i,"label")}),t},openAll(){return Object.keys(this.objectsGroupMap).map(e=>e)}},mounted(){this.$optimus.$on("optimus:default-stage:selectObj",(e,t)=>{var s;e?(this.activeItem=e,this.$EventBus.$emit("default-stage-item-click",e.data.group,this.$optimus.$attrs.name)):(null===(s=this.activeItem)||void 0===s?void 0:s.data.group)!==t&&(this.activeItem=null)})},methods:{getOpenAll(e){return Object.keys(e)},getLabel(e,t){const{label:s,data:{index:i}}=e,a=void 0!==i?i:t;return`${s}-${a+1}`},getLocalVal(e){var t;return(null===(t=e.tags[0])||void 0===t?void 0:t.value)||e.data.text},getGroupTitle(e){const t=Object(a["findIndex"])(this.$optimus.schema,t=>[t.group,t.name].includes(e)),s=this.$optimus.schema[t];return`容器${t+1}: ${s.group||s.name}`},selectObject(e,t){this.activeItem=t,this.$optimus.$emit("optimus:default-stage:edit-object",e,t)},handleDeleteGroup(e,t){e.stopPropagation(),this.$Modal.confirm({title:"确定要删除当前容器内所有选项？",content:this.getGroupTitle(t),onOk:()=>{this.$optimus.$emit("optimus:default-stage:delete-object",t)}})},removeObject(e,t){this.$Modal.confirm({title:"确定要删除？",content:t.featureId,onOk:()=>{this.$optimus.$emit("optimus:default-stage:delete-object",e,t)}})}}},Zp=Yp,Xp=(s("ce3b"),Object(S["a"])(Zp,Gp,Kp,!1,null,"6b590132",null)),em=Xp.exports,tm={metadata:Dp,components:{BaseLayout:Lp,defaultAnnotation:Jp,defaultObject:em},mixins:[Re["a"]],props:{isShowTableTitle:{type:Boolean,default:!0},isSandbox:{type:Boolean,default:!0},isShowOrderNumber:{type:Boolean,default:!1},isShowRandom:{type:Boolean,default:!1},isAnchor:{type:Boolean,default:!1},anchorConfig:{type:Array,default:()=>[]},tableLayout:{type:String,default:"vertical"},imageConfig:{type:String,default:""},modelConfig:{type:String,default:""},highlightKeywords:{type:Array,default:()=>[]},groupConfig:Object,customTableLayout:String},data(){return{anchor:{enabled:this.isShowTableTitle&&"false"!==localStorage.getItem("anchor-enabled"),fields:[]},highlight:!0}},computed:{anchorOptions(){const e=Object(a["chain"])(this.$optimus.schema).filter(e=>e.display).map(e=>({label:e.group||e.name,value:e.key})).unshift({label:"全选",checkAll:!0}).value();return e},anchorFields(){return this.anchorOptions.filter(e=>this.anchor.fields.includes(e.value))},showHighlight(){return this.groupConfig&&Object.keys(this.groupConfig).find(e=>{var t;return null===(t=this.groupConfig[e].attributes.highlightKeywords)||void 0===t?void 0:t.length})}},mounted(){this.setDefaultAnchor()},methods:{handleAnchorChange(){localStorage.setItem("anchor-enabled",this.anchor.enabled)},setDefaultAnchor(){this.isAnchor?this.anchor.fields=this.anchorConfig.filter(e=>null===e||void 0===e?void 0:e.value).map(e=>e.value):this.anchor.fields=this.anchorOptions.map(e=>e.value)},handleHighlightChange(){this.$optimus.$emit("default-stage:highlight-change",this.highlight)}}},sm=tm,im=(s("f1ee"),Object(S["a"])(sm,ip,ap,!1,null,"66db40ba",null)),am=im.exports,om=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[s("image-annotation",{ref:"imageAnnotation",attrs:{src:e.src,$renderedComponentConfig:e.$renderedComponentConfig},on:{"image:select-object":e.selectObject}})]},proxy:!0},{key:"objects",fn:function(){return[s("image-objects",{ref:"imageObjects",attrs:{objects:e.$optimus.objects,$renderedComponentConfig:e.$renderedComponentConfig},on:{"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},nm=[],rm=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"z-image__wrapper"},[i("div",{staticClass:"z-image__tools"},[i("ul",{staticClass:"z-image__tools-inner"},[i("li",{on:{click:e.setZoom}},[i("img",{attrs:{src:s("094d")}}),i("div",{staticClass:"label"},[e._v(e._s("origin"===e.displayMode?"原图":"铺满"))])]),i("li",{on:{click:e.setCenter}},[i("img",{attrs:{src:s("a3f0")}}),i("div",{staticClass:"label"},[e._v("居中")])]),i("li",{directives:[{name:"show",rawName:"v-show",value:!e.gridOn,expression:"!gridOn"}],on:{click:e.setGrid}},[i("img",{attrs:{src:s("d521")}}),i("div",{staticClass:"label"},[e._v("网格")])]),i("li",{directives:[{name:"show",rawName:"v-show",value:e.gridOn,expression:"gridOn"}],on:{click:e.setGrid}},[i("img",{attrs:{src:s("b706")}}),i("div",{staticClass:"label"},[e._v("网格")])]),i("li",{class:"pan"===e.name?"seleted":"",on:{click:function(t){return e.setMode("pan")}}},[i("img",{attrs:{src:s("0d58")}}),i("div",{staticClass:"label"},[e._v("移动")])]),i("li",{attrs:{title:"当前仅方框和不规则框带有坐标显示"},on:{click:e.setPoint}},[i("img",{directives:[{name:"show",rawName:"v-show",value:e.pointOn,expression:"pointOn"}],attrs:{src:s("01a1")}}),i("img",{directives:[{name:"show",rawName:"v-show",value:!e.pointOn,expression:"!pointOn"}],attrs:{src:s("ed85")}}),i("div",{staticClass:"label"},[e._v("坐标")]),i("div",{staticClass:"label"},[e._v("("+e._s(e.pointOn?"显示":"隐藏")+")")])]),e._m(0),e._l(e.toolsConfig,(function(t){return i("li",{key:t.name,class:e.name===t.name?"seleted":"",on:{click:function(s){return e.setMode(t.type,t.name)}}},[i("img",{directives:[{name:"show",rawName:"v-show",value:"image/rect"==t.type,expression:'tool.type=="image/rect"'}],attrs:{src:s("d5a3")}}),i("img",{directives:[{name:"show",rawName:"v-show",value:"image/polygon"==t.type,expression:'tool.type=="image/polygon"'}],attrs:{src:s("c83a")}}),i("img",{directives:[{name:"show",rawName:"v-show",value:"image/polyline"==t.type,expression:'tool.type=="image/polyline"'}],attrs:{src:s("8673")}}),i("img",{directives:[{name:"show",rawName:"v-show",value:"image/point"==t.type,expression:'tool.type=="image/point"'}],attrs:{src:s("c979")}}),i("div",{staticClass:"label"},[e._v(e._s(t.label))])])}))],2)]),i("div",{staticClass:"z-image__map",attrs:{id:"map"}})])},lm=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticStyle:{"pointer-events":"none"}},[s("div",{staticClass:"label"},[e._v("...")])])}],cm=s("830a"),dm=s.n(cm),um={mixins:[Re["a"]],props:{src:String},data(){const e=this.$renderedComponentConfig.$object_tools||[];let t=!0;const s=localStorage.getItem("optimus-image-stage-grid"),i=localStorage.getItem("optimus-image-stage-point");return s&&(t=JSON.parse(s)),{tab:"global",selectIndex:0,toolsConfig:e,Mode:"pan",gFeatureLayer:null,gTextLayer:null,gMap:"",gridOn:t,pointOn:!!i&&JSON.parse(i),name:"pan",displayMode:localStorage.getItem("optimus-image-stage-displayMode")||"origin",img:{},grid:{rowCount:4,columnCount:4},mapWidth:0,objects:this.$optimus.objects,tags:this.$optimus.tags,editObject:{},editModal:!1,mappingStyles:{pan:{drawStyle:{},featureStyle:{}}},gTextStyle:new dm.a.Style({fontColor:"#FF0000",fontSize:"12",bgColor:"transparent",opacity:0})}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},gPointStyle(){return function(e){return new dm.a.Style({fontColor:e,fontSize:"12",bgColor:"transparent",opacity:0})}}},watch:{},mounted(){this.$on("delete-object",e=>{this.deleteObj(e)}),this.setStyles();const e=new Image;e.src=this.src,e.onerror=()=>{this.$Message.error("图片加载失败")},e.onload=()=>{this.img=e,this.mapWidth=document.getElementById("map").offsetWidth,this.gMap=new dm.a.Map("map",{zoom:"origin"===this.displayMode?this.mapWidth:this.img.width,cx:0,cy:0,zoomMax:10*this.mapWidth,zoomMin:this.mapWidth/10}),this.setMode("pan");const t=new dm.a.Control.Scale("scale-control-id",{postion:{left:10,top:10}});this.gMap.addControl(t),this.gImageLayer=new dm.a.Layer.Image("img",this.img.src,{w:this.img.width,h:this.img.height},{zIndex:1,grid:this.gridOn?this.grid:{rowCount:0,columnCount:0}}),this.gMap.addLayer(this.gImageLayer),this.gFeatureLayer=new dm.a.Layer.Feature("featureLayer",{zIndex:3,transparent:!1}),this.gMap.addLayer(this.gFeatureLayer),this.gTextLayer=new dm.a.Layer.Text("textLayer",{zIndex:3}),this.gMap.addLayer(this.gTextLayer),this.renderObjects(),this.gMap.events.on("geometryDrawDone",(e,t)=>{const s=this.guid(8),{featureStyle:i}=this.mappingStyles[this.name];let a,o;if(a="point"===e?this.generateText("feature-"+s,t.x,t.y):this.generateText("feature-"+s,t[0].x,t[0].y),"point"===e&&(o=new dm.a.Feature.Point("feature-"+s,t,{tags:[],name:this.name,text:a},i)),"rect"===e?o=new dm.a.Feature.Rect("feature-"+s,t,{tags:[],name:this.name,text:a},i,{activeColor:"#000"}):"polygon"===e?o=new dm.a.Feature.Polygon("feature-"+s,t,{tags:[],name:this.name,text:a},i):"polyline"===e&&(o=new dm.a.Feature.Polyline("feature-"+s,t,{tags:[],name:this.name,text:a},i,{activeColor:"#000"})),this.gFeatureLayer.addFeature(o),this.gTextLayer.addText(a),this.addObject(o),["rect","polygon"].includes(e)){const e={x:0,y:0};t.forEach(t=>{e.x+=t.x,e.y+=t.y}),e.x/=t.length,e.y/=t.length,t.forEach((t,a)=>{const o=this.generatePointText("feature-"+s,a.toString(),t.x,t.y,e,i);this.gTextLayer.addText(o),this.pointOn?o.show():o.hide()})}}),this.gMap.events.on("geometryEditDone",(e,t,s)=>{"rect"!==e&&"polygon"!==e&&"polyline"!==e||(t.update({points:s}),t.data.text.setPosition(s[0].x,s[0].y),this.updatePoints(t))}),this.gMap.events.on("featureSelected",e=>{const t=this.objects.find(t=>t.featureId===e.id);this.selectObject(t)})}},methods:{setStyles(){for(let e=0;e<this.toolsConfig.length;e++){const t=this.toolsConfig[e];switch(t.type){case"image/rect":this.mappingStyles[t.name]={drawStyle:{strokeColor:"#FF0000",opacity:1,lineWeight:1},featureStyle:{strokeColor:"#00FF00",fillColor:t.color,opacity:.3,lineWeight:t.labelPixel||1}};break;case"image/point":this.mappingStyles[t.name]={drawStyle:{pointRadius:5},featureStyle:{strokeColor:"#0000FF",fillColor:t.color,opacity:1,pointRadius:5}};break;case"image/polygon":this.mappingStyles[t.name]={drawStyle:{strokeColor:"#00FF00",opacity:1,lineWeight:1},featureStyle:{strokeColor:"#0000FF",fillColor:t.color,opacity:.3,lineWeight:t.labelPixel||1}};break;case"image/polyline":this.mappingStyles[t.name]={drawStyle:{strokeColor:"#FF0000",fillColor:"#0000FF",opacity:1,lineWeight:3},featureStyle:{strokeColor:t.color,fillColor:t.color,opacity:1,lineWeight:3}};break}}},renderObjects(){if(this.objects&&this.objects.length>0)for(let e=0;e<this.objects.length;e++){const t=this.objects[e],s=[];for(let e=0;e<t.data.length;e++){const i=t.data[e],a=Math.floor(100*(i.x-this.img.width/2))/100,o=Math.floor(100*(this.img.height/2-i.y))/100;s.push({x:a,y:o})}let i="Rect";switch(t.type){case"image/rect":i="Rect";break;case"image/point":i="Point";break;case"image/polygon":i="Polygon";break;case"image/polyline":i="Polyline";break}const{featureStyle:a}=this.mappingStyles[t.name];let o;o="point"===i?this.generateText(t.featureId,s.x,s.y):this.generateText(t.featureId,s[0].x,s[0].y);const n=new dm.a.Feature[i](t.featureId,s,{tags:t.tags,name:t.name,text:o},a);if(this.gFeatureLayer.addFeature(n),this.gTextLayer.addText(o),["Rect","Polygon"].includes(i)){const e={x:0,y:0};s.forEach(t=>{e.x+=t.x,e.y+=t.y}),e.x/=s.length,e.y/=s.length,s.forEach((s,i)=>{const o=this.generatePointText(t.featureId,i.toString(),s.x,s.y,e,a);this.gTextLayer.addText(o),this.pointOn?o.show():o.hide()})}}},generateText(e,t,s){return new dm.a.Text("text-"+e,{pos:{x:t,y:s},offset:{x:-5,y:-20},maxWidth:200,text:e},this.gTextStyle)},generatePointText(e,t,s,i,a,o){return new dm.a.Text(`text-${e}-${t}`,{pos:{x:s,y:i},offset:{x:s<a.x?-10:0,y:i<a.y?0:-10},maxWidth:200,text:t},this.gPointStyle(o.fillColor))},selectObject(e){this.$emit("image:select-object",e)},updatePoints(e){const t=[];e.points.forEach(e=>{const s=Math.floor(100*(this.img.width/2+e.x))/100,i=Math.floor(100*(this.img.height/2-e.y))/100;t.push({x:s,y:i})});const s=this.objects.find(t=>t.featureId===e.id);s?(s.data=t,["rect","polygon"].includes(e.type)&&e.points.forEach((t,s)=>{const i=this.gTextLayer.getTextById(`text-${e.id}-${s}`);i.update({pos:t})})):this.$Message.error("对象不存在")},addObject(e){const t={type:"image/"+e.type,data:[],tags:[],featureId:e.id,color:e.gStyle.fillColor,name:this.name,label:Object(a["find"])(this.toolsConfig,{name:this.name}).label};e.points.forEach(e=>{const s=Math.floor(100*(this.img.width/2+e.x))/100,i=Math.floor(100*(this.img.height/2-e.y))/100;t.data.push({x:s,y:i})}),this.objects.push(t),this.$nextTick(()=>{this.selectObject(t)})},deleteObj(e){const{featureId:t,type:s}=e,i=this.gFeatureLayer.getFeatureById(t);this.gTextLayer.removeTextById(i.data.text.id),this.gFeatureLayer.removeFeatureById(t);const o=Object(a["findIndex"])(this.objects,e=>e.featureId===t);if(-1!==o&&this.objects.splice(o,1),["image/rect","image/polygon"].includes(s))for(let a=0;a<i.points.length;a++)this.gTextLayer.removeTextById(`${i.data.text.id}-${a}`)},setMode(e,t="pan"){if(this.$optimus.disabled)return;let s="pan";switch(e){case"image/rect":s="drawRect";break;case"image/point":s="drawPoint";break;case"image/polyline":s="drawPolyline";break;case"image/polygon":s="drawPolygon";break}this.name=t;const{drawStyle:i}=this.mappingStyles[t];this.Mode=s,this.gMap&&this.gMap.setMode(s,new dm.a.Style(i))},setCenter(){this.gMap&&this.gMap.setCenter(0,0)},setZoom(){"origin"===this.displayMode?(this.gMap&&this.gMap.setZoom(this.img.width),this.displayMode="fit"):(this.gMap&&this.gMap.setZoom(this.mapWidth),this.displayMode="origin"),localStorage.setItem("optimus-image-stage-displayMode",this.displayMode)},setGrid(){this.gridOn?(this.gImageLayer.update({grid:{rowCount:0,columnCount:0}}),this.gridOn=!1):(this.gImageLayer.update({grid:this.grid}),this.gridOn=!0),localStorage.setItem("optimus-image-stage-grid",this.gridOn)},setPoint(){const{pointOn:e,objects:t}=this;t.forEach(t=>{const s=this.gFeatureLayer.getFeatureById(t.featureId);for(let i=0;i<s.points.length;i++){const t=this.gTextLayer.getTextById(`${s.data.text.id}-${i}`);t&&(e?t.hide():t.show())}}),this.pointOn=!e,localStorage.setItem("optimus-image-stage-point",this.pointOn)},guid(e){const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let s="";for(let i=e;i>0;--i)s+=t[Math.floor(Math.random()*t.length)];return s}}},hm=um,pm=(s("b042"),Object(S["a"])(hm,rm,lm,!1,null,"78fe3628",null)),mm=pm.exports,gm=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.objects.length>0?s("Collapse",{attrs:{value:e.openAll}},e._l(e.objects,(function(t){return s("Panel",{key:t.featureId,class:{activeObj:e.activeItem===t.featureId},attrs:{id:t.featureId,name:t.featureId}},[s("div",{staticClass:"header"},[s("div",{staticClass:"header-left"},[s("div",{staticClass:"feature-id"},[e._v(e._s(e.toolLabelMap[t.name])+"-"+e._s(t.featureId))]),t.color?s("div",{staticClass:"color",style:{backgroundColor:t.color}}):e._e()]),s("div",{staticClass:"header-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)]),s("p",{attrs:{slot:"content"},slot:"content"},[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:t,expression:"obj"}],ref:"form_"+t.featureId,refInFor:!0,attrs:{component:e.componentConfig[t.name],context:e.$optimus.context,answer:e.initAnswer[t.featureId],disabled:e.$optimus.disabled}})],1)])})),1):e._e()],1)])},bm=[],fm={directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],data(){const{objects:e}=this.$optimus,t=Object(a["cloneDeep"])(e).reduce((e,t)=>Object.assign(e,{[t.featureId]:{tags:t.tags}}),{}),s=Object(a["cloneDeep"])(this.$renderedComponentConfig.$object_tools).reduce((e,t)=>{const s=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:s}}=e;return!s||("all"===s||s===t.name)});return Object.assign(e,{[t.name]:{component:"z-form-stage",items:s}})},{});return{activeItem:null,objects:e,initAnswer:t,componentConfig:s,openAll:e.map(e=>e.featureId),cacheOpenIds:e.map(e=>e.featureId)}},computed:{toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]=t.label}),e}},watch:{objects(e){if(0===e.length)return;const t=Object(a["last"])(e);this.cacheOpenIds.find(e=>e===t.featureId)||(this.cacheOpenIds.push(t.featureId),this.openAll.push(t.featureId))}},mounted(){this.$optimus.disabled||document.addEventListener("keydown",this.listenKeyboardEvent)},destroy(){document.removeEventListener("keydown",this.listenKeyboardEvent)},methods:{listenKeyboardEvent:Object(a["debounce"])((function(e){const{code:t,ctrlKey:s}=e;s&&"KeyD"===t&&this.deleteActiveObj()}),200),deleteActiveObj(){if(this.activeItem){const e=this.objects.find(e=>e.featureId===this.activeItem);this.removeObject(e)}},selectObject(e){Object(a["includes"])(this.openAll,e.featureId)||this.openAll.push(e.featureId),this.activeItem=e.featureId,document.getElementById(this.activeItem).scrollIntoView()},updateObjTags(e){const t="form_"+e.featureId,s=Object(a["findIndex"])(this.objects,t=>t.featureId===e.featureId);if(-1===s)return 0;this.objects[s].tags=this.$refs[t][0].tags},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})}}},vm=fm,ym=(s("f6a5"),Object(S["a"])(vm,gm,bm,!1,null,"1e79bcaa",null)),wm=ym.exports,xm={label:"图片标注",icon:"ios-image-outline",name:"z-image-stage",attributes:[{name:"src",label:"图片地址",value:"",vType:["url"]}],tools:[{type:"image/rect",label:"方框",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_rect_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"边框大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]},{type:"image/point",label:"点",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_point_${(new Date).getTime()}${Math.floor(100*Math.random())}`}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]},{type:"image/polyline",label:"线段",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_polyline_${(new Date).getTime()}${Math.floor(100*Math.random())}`}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]},{type:"image/polygon",label:"不规则",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_polygon_${(new Date).getTime()}${Math.floor(100*Math.random())}`}},{label:"边框大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]}]},Cm={metadata:xm,components:{BaseLayout:Lp,ImageAnnotation:mm,ImageObjects:wm},mixins:[Re["a"]],props:{src:String},methods:{deleteObject(e){this.$refs.imageAnnotation.$emit("delete-object",e)},selectObject(e){this.$refs.imageObjects.selectObject(e)}}},jm=Cm,Om=Object(S["a"])(jm,om,nm,!1,null,null,null),km=Om.exports,Am=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("BaseLayout",{attrs:{showObjects:!0,isWatermarkEnabled:e.isWatermarkEnabled},scopedSlots:e._u([{key:"component",fn:function(){return[e.videoSrc?i("Split",{attrs:{mode:"vertical",min:"10px"},model:{value:e.splitValue,callback:function(t){e.splitValue=t},expression:"splitValue"}},[i("div",{staticClass:"video-container",attrs:{slot:"top"},slot:"top"},[i("div",{staticStyle:{position:"relative"}},[i("div",{staticStyle:{position:"absolute","z-index":"1",margin:"5px",right:"0"}},[e.videoHeight<500?i("img",{staticClass:"hover-hand",attrs:{src:s("912b"),height:"20px",width:"20px"},on:{click:function(t){return e.getCurrentHeight("enlarge")}}}):e._e(),e.videoHeight>200?i("img",{staticClass:"hover-hand",attrs:{src:s("28af"),height:"20px",width:"20px"},on:{click:function(t){return e.getCurrentHeight("reduce")}}}):e._e()]),i("videoPreview",{attrs:{url:e.videoSrc,height:e.videoHeight}})],1)]),i("div",{staticStyle:{height:"100%","min-height":"800px"},attrs:{slot:"bottom"},slot:"bottom"},[i("image-annotation",{ref:"imageAnnotation",attrs:{src:e.src,videoSrc:e.videoSrc,$renderedComponentConfig:e.$renderedComponentConfig},on:{"image:change-object-show":e.changeObjectShowByImage,"image:select-feature":e.selectFeature,"hot-key:select":e.selectObjByHotKey}})],1)]):i("image-annotation",{ref:"imageAnnotation",attrs:{src:e.src,videoSrc:e.videoSrc,$renderedComponentConfig:e.$renderedComponentConfig},on:{"image:change-object-show":e.changeObjectShowByImage,"image:select-feature":e.selectFeature,"hot-key:select":e.selectObjByHotKey}})]},proxy:!0},{key:"objects",fn:function(){return[i("image-objects",{ref:"imageObjects",attrs:{objDisplays:e.objDisplays,isShowElementIndex:e.isShowElementIndex,$renderedComponentConfig:e.$renderedComponentConfig},on:{"objects:select-object":e.selectObject,"objects:select-object-group":e.selectObjectGroup,"objects:edit-object":e.editObject,"objects:change-object-show":e.changeObjectShowByObjects,"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Sm=[],_m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"z-image-v2"},[i("div",{staticClass:"header-menu"},[i("div",{staticClass:"item"},[i("div",[e.isHasPencilBrush?e._e():i("t-row",{staticStyle:{"margin-bottom":"5px",color:"white"},attrs:{align:"center"}},[i("t-col",{attrs:{span:6}},[i("span",[e._v("图片旋转")])]),i("t-col",{attrs:{span:6}},[i("t-input-number",{staticStyle:{width:"90px"},attrs:{min:-180,max:180,size:"small",suffix:"度",theme:"column"},on:{change:e.rotateLabel},model:{value:e.labelAngle,callback:function(t){e.labelAngle=t},expression:"labelAngle"}})],1)],1),i("t-row",{staticStyle:{color:"white"},attrs:{align:"center"}},[i("t-col",{attrs:{span:6}},[i("span",[e._v("图片透明度")])]),i("t-col",{attrs:{span:6}},[i("t-input-number",{staticStyle:{width:"90px"},attrs:{min:0,max:100,size:"small",suffix:"%",theme:"column"},on:{change:e.changeLabelTargetOpacity},model:{value:e.targetLabelOpacity,callback:function(t){e.targetLabelOpacity=t},expression:"targetLabelOpacity"}})],1)],1)],1)]),i("div",{staticClass:"item"},[i("span",[e._v("图片模式")]),i("t-radio-group",{attrs:{variant:"default-filled",size:"small"},on:{change:e.switchZoomType},model:{value:e.displayMode,callback:function(t){e.displayMode=t},expression:"displayMode"}},[i("t-radio-button",{attrs:{value:"none"}},[e._v("原图")]),i("t-radio-button",{attrs:{value:"cover"}},[e._v("铺满")]),i("t-radio-button",{attrs:{value:"scaleDown"}},[e._v("自适应")])],1)],1),i("t-divider",{attrs:{layout:"vertical"}}),i("div",{staticClass:"item",class:{selected:"pan"===e.mode},on:{click:function(t){return e.setLabelMode({type:"pan"})}}},[i("img",{attrs:{src:s("476b")}}),i("div",{staticClass:"label"},[e._v("移动")])]),i("div",{staticClass:"item",on:{click:e.centerWorkspace}},[i("img",{attrs:{src:s("f0dd")}}),i("div",{staticClass:"label"},[e._v("居中")])]),i("div",{staticClass:"item",on:{click:e.switchGrid}},[i("img",{attrs:{src:s("c800")}}),i("div",{staticClass:"label"},[e._v(e._s(e.gridOn?"关闭":"开启")+"网格")])]),i("div",{staticClass:"item",on:{click:e.switchCross}},[i("img",{attrs:{src:s("5482")}}),i("div",{staticClass:"label"},[e._v(e._s(e.crossOn?"关闭":"开启")+"十字线")])]),i("t-divider",{attrs:{layout:"vertical"}}),i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[e._v("图形角标显示")]),i("CheckboxGroup",{staticClass:"mts",on:{"on-change":e.switchTipType},model:{value:e.tipType,callback:function(t){e.tipType=t},expression:"tipType"}},[i("Checkbox",{attrs:{label:"showTool",value:"showTool"}},[e._v("工具序号")]),i("Checkbox",{attrs:{label:"showLabel",value:"showLabel"}},[e._v("标签值")])],1)],1),i("div",{staticClass:"item",on:{click:e.switchPoint}},[e.pointOn?i("img",{attrs:{src:s("0738")}}):i("img",{attrs:{src:s("9e01")}}),i("div",{staticClass:"label"},[e._v(e._s(e.pointOn?"隐藏":"显示")+"坐标顺序")])]),i("div",{staticClass:"item",on:{click:e.switchNodeShow}},[i("img",{attrs:{src:s("c156")}}),i("div",{staticClass:"label"},[e._v(e._s(e.nodeOn?"隐藏":"显示")+"图形节点")])]),e.isShowSwitchPixel?i("div",{staticClass:"item",on:{click:e.switchPixelShow}},[i("Icon",{attrs:{type:"ios-keypad",size:"25"}}),i("div",{staticClass:"label"},[e._v(e._s(e.isPixelShow?"隐藏":"显示")+"拉框像素")])],1):e._e(),e.isHasPencilBrush?i("div",{staticClass:"item",class:{selected:"maskPreview"===e.mode},on:{click:e.switchImagePreview}},[i("img",{attrs:{src:s("0747")}}),i("div",{staticClass:"label"},[e._v(e._s(e.isMaskPreview?"查看原始图片":"查看蒙版效果"))])]):e._e(),i("t-divider",{attrs:{layout:"vertical"}}),e.isHasPencilBrush?i("div",{staticClass:"item",class:{selected:"eraserBrush"===e.mode},on:{click:function(t){return e.setLabelMode({type:"image/eraserBrush"})}}},[i("Tooltip",{attrs:{disabled:"image/eraserBrush"!==e.currentTool.type,transfer:""}},[i("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center"}},[i("img",{attrs:{src:s("c189")}}),i("div",{staticClass:"label"},[e._v("橡皮擦")])]),i("Slider",{staticClass:"angle-input",staticStyle:{width:"100px"},attrs:{slot:"content",min:1,max:100},on:{"on-change":e.changeEraserBrushWidth},slot:"content",model:{value:e.eraserBrushWidth,callback:function(t){e.eraserBrushWidth=t},expression:"eraserBrushWidth"}})],1)],1):e._e(),i("div",{staticClass:"item",class:{"cursor-not-allowed":e.$optimus.disabled},on:{click:e.undo}},[i("img",{attrs:{src:s("434d")}}),i("div",{staticClass:"label"},[e._v("撤销")])]),i("div",{staticClass:"item",on:{click:e.redo}},[i("img",{class:{"cursor-not-allowed":e.$optimus.disabled},attrs:{src:s("ecf8")}}),i("div",{staticClass:"label"},[e._v("重做")])]),i("div",{staticClass:"item",class:{"cursor-not-allowed":e.$optimus.disabled},on:{click:e.deleteAll}},[i("img",{attrs:{src:s("efb2")}}),i("div",{staticClass:"label"},[e._v("清空")])])],1),i("Row",{staticStyle:{flex:"auto","flex-wrap":"nowrap",overflow:"hidden"}},[i("Col",{staticClass:"side-menu"},e._l(e.toolsConfig,(function(t){return i("div",{key:t.name,staticClass:"tool",class:e.toolMenuStyle(t),on:{click:function(s){!e.toolMenuStyle(t).disabled&&e.setLabelMode(t)}}},[e.currentEditFeature?i("Radio",{attrs:{value:t.name===e.currentTool.name,disabled:e.currentTool&&t.type!==e.currentTool.type}}):e._e(),"image/point"===t.type?i("div",{staticClass:"prefixPoint"},[i("div",{staticClass:"circle",style:{backgroundColor:e.toolColor(t)}})]):e._e(),"image/polyline"===t.type?i("div",{staticClass:"prefixPolyline",style:{borderColor:e.toolColor(t)}},[i("div",{staticClass:"polyline"},[i("div",{staticClass:"midLine",style:{borderColor:e.toolColor(t)}}),i("div",{staticClass:"leftCorner",style:{backgroundColor:e.toolColor(t)}}),i("div",{staticClass:"rightCorner",style:{backgroundColor:e.toolColor(t)}})])]):e._e(),"image/rect"===t.type?i("div",{staticClass:"prefixRect"},[i("div",{staticClass:"rect",class:{hasAI:t.hasEnableAIHelp},style:{borderColor:e.toolColor(t)}})]):e._e(),"image/polygon"===t.type?i("div",{staticClass:"prefixPolygon"},[i("div",{staticClass:"polygon",class:{hasAI:t.hasEnableAIHelp}},[i("div",{staticClass:"one",style:{borderColor:e.toolColor(t)}}),i("div",{staticClass:"two",style:{borderColor:e.toolColor(t)}}),i("div",{staticClass:"three",style:{borderColor:e.toolColor(t)}})])]):e._e(),"image/pencilBrush"===t.type?i("Tooltip",{staticStyle:{width:"100%"},attrs:{disabled:"image/pencilBrush"!==e.currentTool.type,transfer:""}},[i("div",{staticStyle:{display:"flex","align-items":"center","flex-wrap":"nowrap"}},[i("Icon",{staticStyle:{"margin-right":"10px"},attrs:{type:"ios-brush",size:"30",color:e.toolColor(t)}}),i("span",[e._v(e._s(t.label))])],1),i("Slider",{staticClass:"angle-input",staticStyle:{width:"100px"},attrs:{slot:"content",min:1,max:100},on:{"on-change":e.changePencilBrushWidth},slot:"content",model:{value:e.pencilBrushWidth,callback:function(t){e.pencilBrushWidth=t},expression:"pencilBrushWidth"}})],1):i("span",[e._v(e._s(t.label))])],1)})),0),i("Col",{staticClass:"label-workspcae",attrs:{flex:"auto"}},[i("canvas",{ref:"workspace"}),i("div",{ref:"zoomTooltip",staticClass:"zoom-tooltip"},[e._v(e._s(e.zoom))])])],1),i("modal",{attrs:{draggable:!0,mask:!1,styles:{top:"70px",left:"600px"}},on:{"on-cancel":e.cancelMark},scopedSlots:e._u([{key:"header",fn:function(){return[e.currentEditFeature?i("h4",[e._v(e._s(e.currentTool.label)+": "+e._s(e.currentEditFeature.featureId))]):i("h4",[e._v(e._s(e.markModal.title))])]},proxy:!0}]),model:{value:e.markModal.showModal,callback:function(t){e.$set(e.markModal,"showModal",t)},expression:"markModal.showModal"}},[i("div",{staticClass:"modal-content"},[e.markModal.needDrawScreenShot?i("div",{staticClass:"screenShot",staticStyle:{display:"flex","justify-content":"center",cursor:"pointer"},on:{click:e.lanuchViewer}},[i("canvas",{ref:"formContent",attrs:{width:"200",height:"200"}})]):e._e(),e.currentTool?[e.markModal.showModal?i("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,objectContext:e.objectContext,answer:e.markModal.objAnswer,disabled:e.$optimus.disabled}}):e._e()]:e._e()],2),i("template",{slot:"footer"},[i("Button",{on:{click:e.cancelMark}},[e._v("取消")]),i("Button",{on:{click:e.confirmMark}},[e._v("确认")])],1)],2)],1)},Im=[],$m=s("af6a");s("adb7");function Mm(e,t){e.Object.prototype.transparentCorners=!1,e.Object.prototype.cornerColor="white",e.Object.prototype.cornerStrokeColor="black",e.Object.prototype.cornerStyle="circle",e.Object.prototype.cornerSize=11;const{controls:s}=e.Object.prototype;Object.keys(s).forEach(e=>{s[e].name=e}),e.controlsUtils.renderCircleControl=function(e,s,i,o,n){var r,l;o=o||{};const c=this.sizeX||o.cornerSize||n.cornerSize,d=this.sizeY||o.cornerSize||n.cornerSize,u="undefined"!==typeof o.transparentCorners?o.transparentCorners:n.transparentCorners,h=u?"stroke":"fill",p=!u&&(o.cornerStrokeColor||n.cornerStrokeColor);let m,g=s,b=i;e.save();const f=null===(r=t.getFeatureById(n.id))||void 0===r||null===(l=r.shape)||void 0===l?void 0:l.getLabelPosition();if(f&&"rect"!==n.type){const s=t.getAllFeaturesVisible().filter(e=>e.featureId!==n.id),i=[...s.map(e=>Object(a["uniqBy"])(e.getPoints(),e=>`${e.x}_${e.y}`)),f],o=Object(a["countBy"])(Object(a["flatten"])(i),e=>`${e.x}_${e.y}`);o[`${f[this.pointIndex].x}_${f[this.pointIndex].y}`]>1&&(e.fillStyle="red")}else n.startPoint&&n.startPoint===this.name||0===this.pointIndex?e.fillStyle=n.startPointColor||"#2d8cf0":e.fillStyle=o.cornerColor||n.cornerColor;e.strokeStyle=o.cornerStrokeColor||n.cornerStrokeColor,c>d?(m=c,e.scale(1,d/c),b=i*c/d):d>c?(m=d,e.scale(c/d,1),g=s*d/c):m=c,e.lineWidth=1,e.beginPath(),e.arc(g,b,m/2,0,2*Math.PI,!1),e[h](),p&&e.stroke(),e.restore()}}const Tm={default:"default",pan:"pointer",label:"crosshair",move:"move",none:"none"},Em=1,Lm=new Set(["pan","drawRect","drawPoint","drawPolyline","drawPolygon","pencilBrush","eraserBrush","maskPreview"]);function Dm(e,t){const s={};return Object.keys(t).forEach(i=>{s[i]=void 0!==e[i]?e[i]:t[i]}),s}function Pm(e,t){const{x:s,y:i}=e,{x:a,y:o}=t,n=s-a,r=i-o;return Math.sqrt(n*n+r*r)}function Bm(e,t){const{x:s,y:i}=e,{x:a,y:o}=t,n=a-s,r=o-i;return{x:n,y:r}}function Rm(e,t){const{points:s,type:i}=e;let a=!1;const o="polyline"===i?s.length-1:s.length;for(let n=0,r=o;n<r;n++){const e=s[n],o=s["polyline"===i?n+1:(n+1)%r],l=Bm(e,o),c=Bm(e,t),d=l.x*c.y-l.y*c.x;if(Math.abs(d)<100){const s=Pm(t,e),i=Pm(t,o),r=Pm(o,e);if(s>5&&i>5){const t={x:l.x/r,y:l.y/r},s=(c.x*l.x+c.y*l.y)/r,i={x:t.x*s,y:t.y*s},d={x:e.x+i.x,y:e.y+i.y};Pm(e,d)+Pm(o,d)-r<10&&(a={point:d,index:n})}}}return a}function zm(e){if(4!==e.length)return;const t=[],s=[],i=Object(a["orderBy"])(e,["x"],["asc"]);i[0].y<i[1].y?t.splice(0,0,i[1],i[0]):t.splice(0,0,i[0],i[1]),i[2].y<i[3].y?s.splice(0,0,i[2],i[3]):s.splice(0,0,i[3],i[2]);const o=[...t,...s],[{x:n,y:r}]=e,l=Object(a["findIndex"])(o,{x:n,y:r}),c=o.slice(l),d=o.slice(0,l);return[...c,...d]}function Nm(e,t,s){try{const i=zm(t),[a]=i,o=(a.x+i[2].x)/2,n=(a.y+i[2].y)/2,r=a.x-o,l=a.y-n,c=a.y-i[1].y,d=a.x-i[1].x;let u,h,p,m,g,b;r<0&&l<0?(u="tl",h="left",p="top"):r>0&&l<0?(u="tr",h="right",p="top"):r>0&&l>0?(u="br",h="right",p="bottom"):(u="bl",h="left",p="bottom"),"tl"===u||"br"===u?(g=Pm(a,i[1]),b=Pm(a,i[3]),m=180/Math.PI*Math.atan(c/d),m=m<0?m+360:m):"tr"!==u&&"bl"!==u||(g=Pm(a,i[3]),b=Pm(a,i[1]),m=180/Math.PI*Math.atan(d/c),m=m<0?Math.abs(m):360-m);const{aCoords:{tl:f},angle:v}=e,y=Hm(e,f),w={x:y.x+a.x,y:y.y+a.y},x=Hm(e,w,!1),C=Math.sqrt(s*s*2),j=m+v+45,O=C*Math.cos(j*Math.PI/180),k=C*Math.sin(j*Math.PI/180);let A,S;switch(u){case"tl":A=x.x-O,S=x.y-k;break;case"bl":A=x.x-O,S=x.y+k;break;case"tr":A=x.x+O,S=x.y-k;break;case"br":A=x.x+O,S=x.y+k;break}return{startPoint:u,left:A,top:S,angle:m+v,originX:h,originY:p,width:g+s,height:b+s}}catch(i){console.log(i)}}function Fm(e,t){const{startPoint:s,strokeWidth:i,aCoords:{tl:a,tr:o,bl:n,br:r}}=t,l={x:a.x+i,y:a.y+i},c={x:o.x-i,y:o.y+i},d={x:n.x+i,y:n.y-i},u={x:r.x-i,y:r.y-i};let h=[];switch(s){case"tl":h=[l,c,u,d];break;case"tr":h=[c,u,d,l];break;case"bl":h=[d,l,c,u];break;case"br":h=[u,d,l,c];break}return Vm(e,h)}function Vm(e,t){const{aCoords:{tl:s}}=e,i=Hm(e,s);return t.map(t=>{const s=Hm(e,t);return{x:Object(a["round"])(s.x-i.x,2),y:Object(a["round"])(s.y-i.y,2)}})}function qm(e,t){const{aCoords:{tl:s}}=e,i=Hm(e,s);return t.map(t=>{const s={x:Object(a["round"])(t.x+i.x,2),y:Object(a["round"])(t.y+i.y,2)};return Hm(e,s,!1)})}function Hm(e,t,s=!0){const{angle:i}=e,a=Tl["fabric"].util.degreesToRadians(i);return Tl["fabric"].util.rotatePoint(t,e.getCenterPoint(),s?-a:a)}function Wm(e,t){function s(e,t,s){const i=s.points[this.pointIndex].x-s.pathOffset.x,a=s.points[this.pointIndex].y-s.pathOffset.y;return Tl["fabric"].util.transformPoint({x:i,y:a},Tl["fabric"].util.multiplyTransformMatrices(s.canvas.viewportTransform,s.calcTransformMatrix()))}function i(s,i,a,o){const{target:n}=i,{point:r,distance:l}=e.getClosestPoint({x:a,y:o},t.id);e.isPointMerge&&r&&l<e.getPointMergeDistance()?(n.left=r.x,n.top=r.y):(n.left=a,n.top=o);const c=Vm(e.view.labelTarget,[{x:n.left,y:n.top}]);return Qm(e,t,c),!0}function a(e){return function(t,s,i,a){const o=e(t,s,i,a);return o}}t.controls=t.points.reduce((e,t,o)=>(e["p"+o]=new Tl["fabric"].Control({positionHandler:s,actionHandler:a(i),actionName:"modifyPoint",pointIndex:o,cursorStyle:"move"}),e),{})}function Um(e,t){function s(e,t,s){if(!s.canvas)return!1;const i=s.points[this.pointIndex].x-s.pathOffset.x,a=s.points[this.pointIndex].y-s.pathOffset.y;return Tl["fabric"].util.transformPoint({x:i,y:a},Tl["fabric"].util.multiplyTransformMatrices(s.canvas.viewportTransform,s.calcTransformMatrix()))}function i(s,i,a,o){const{point:n,distance:r}=e.getClosestPoint({x:a,y:o},t.id),l=i.target,c=l.controls[l.__corner],d=l._getNonTransformedDimensions(),u=l._getTransformedDimensions(0,0),h=e.isPointMerge&&n&&r<e.getPointMergeDistance()?n:{x:a,y:o},p=l.toLocalPoint(new Tl["fabric"].Point(h.x,h.y),"center","center");l.points[c.pointIndex]={x:p.x*d.x/u.x+l.pathOffset.x,y:p.y*d.y/u.y+l.pathOffset.y};const m=l.points.map(t=>Vm(e.view.labelTarget,[t])[0]);return Qm(e,t,m),!0}function a(e,t){return function(s,i,a,o){const n=i.target,r=Tl["fabric"].util.transformPoint({x:n.points[e].x-n.pathOffset.x,y:n.points[e].y-n.pathOffset.y},n.calcTransformMatrix()),l=t(s,i,a,o);n._setPositionDimensions({});const c=n._getNonTransformedDimensions(),d=(n.points[e].x-n.pathOffset.x)/c.x,u=(n.points[e].y-n.pathOffset.y)/c.y;return n.setPositionByOrigin(r,d+.5,u+.5),l}}const o=t.points.length-1;t.controls=t.points.reduce((e,n,r)=>(e["p"+r]=new Tl["fabric"].Control({positionHandler:s,actionHandler:a(r>0?r-1:o,i),actionName:"polygon"===t.type?"modifyPolygon":"modifyPolyline",pointIndex:r,cursorStyle:"pointer"}),e),{})}function Qm(e,t,s){e.view.canvasCtx.getObjects().filter(e=>"activeMergePoint"===e.id).forEach(t=>e.view.canvasCtx.remove(t));const i=e.getAllFeaturesVisible().filter(e=>e.featureId!==t.id),o=[...i.map(e=>Object(a["uniqBy"])(e.getPoints(),e=>`${e.x}_${e.y}`)),s],n=Object(a["countBy"])(Object(a["flatten"])(o),e=>`${e.x}_${e.y}`);e.view.renderMergePoint(n)}function Jm(e,t,s){const{aCoords:{tl:i,tr:a,bl:o}}=t,n=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),r=Math.sqrt((a.x-s.x)**2+(a.y-s.y)**2),l=Math.sqrt((i.x-a.x)**2+(i.y-a.y)**2),c=(n+r+l)/2,d=Math.sqrt(Math.abs(c*(c-n)*(c-r)*(c-l))),u=2*d/l,h=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),p=Math.sqrt((o.x-s.x)**2+(o.y-s.y)**2),m=Math.sqrt((i.x-o.x)**2+(i.y-o.y)**2),g=(h+p+m)/2,b=Math.sqrt(Math.abs(g*(g-h)*(g-p)*(g-m))),f=2*b/m;switch(e){case"tl":return{x:f,y:u};case"tr":return{x:u,y:Math.abs(l-f)};case"bl":return{x:Math.abs(o.y-i.y)-u,y:f};case"br":return{x:Math.abs(l-f),y:Math.abs(o.y-i.y)-u}}}function Gm(e,t,s){const{canvasObj:i}=e,[a]=t;if(4===t.length)a.x<t[2].x?((a.x<t[1].x&&a.y<t[3].y||a.x<t[3].x&&a.y<t[1].y)&&(i.startPoint="tl"),(a.x<t[1].x&&a.y>t[3].y||a.x<t[3].x&&a.y>t[1].y)&&(i.startPoint="bl")):((a.x>t[1].x&&a.y<t[3].y||a.x>t[3].x&&a.y<t[1].y)&&(i.startPoint="tr"),(a.y>t[1].y&&a.x>t[3].x||a.y>t[3].y&&a.x>t[1].x)&&(i.startPoint="br"));else{const{aCoords:{tl:e,tr:t,bl:o}}=i,n=Hm(s,e),r=Hm(s,t),l=Hm(s,o),c=(n.x+r.x)/2,d=(n.y+l.y)/2;a.x<c&&a.y<d?i.startPoint="tl":a.x>c&&a.y<d?i.startPoint="tr":a.x<c&&a.y>d?i.startPoint="bl":a.x>c&&a.y>d&&(i.startPoint="br")}}function Km(e,t=1){e=e.replace("#",""),3===e.length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);const s=parseInt(e.slice(0,2),16),i=parseInt(e.slice(2,4),16),a=parseInt(e.slice(4,6),16);return t=Math.max(0,Math.min(1,t)),`rgba(${s}, ${i}, ${a}, ${t})`}function Ym(e,t=!1){let s=!1;return{start(i){const{button:a,e:o,e:{altKey:n},target:r}=i,{canvasCtx:l}=e;if(1===a&&(t||n)&&r!==l.getActiveObject())return s=!0,l.lastPosX=o.clientX,l.lastPosY=o.clientY,!0},update(t){if(s){const{e:s}=t,{canvasCtx:i,canvasCtx:{viewportTransform:a}}=e;return a[4]+=s.clientX-i.lastPosX,a[5]+=s.clientY-i.lastPosY,i.requestRenderAll(),i.lastPosX=s.clientX,i.lastPosY=s.clientY,!0}},end(){if(s){const{canvasCtx:t,canvasCtx:{viewportTransform:i}}=e;return t.setViewportTransform(i),s=!1,!0}},reset(){s=!1}}}function Zm(e,t){let s=!1;const{absolutePointer:i}=e;return t.labelTarget.containsPoint(i,null,!0)||(t.root.emit("outsideLabelRange"),s=!0),s}function Xm(e,t){let s=null;const i=t.canvasCtx.getPointer(e),o=t.root.getAllFeatures(),n=o.filter(e=>{const{shape:{canvasObj:t}}=e;return t.containsPoint(i,null,!0)});return 0===n.length||(n.length>1?s=n.reduce((e,t)=>{const s=e.shape.canvasObj.getCenterPoint(),o=t.shape.canvasObj.getCenterPoint();let n=Math.sqrt((s.x-i.x)**2+(s.y-i.y)**2),r=Math.sqrt((o.x-i.x)**2+(o.y-i.y)**2);const l=(e,t)=>{const{shape:{canvasObj:s,view:o,points:n}}=e;if("polyline"===s.type){const e=qm(o.labelTarget,n);let s=t;return Object(a["forEach"])(e,e=>{const t=Pm(e,i);s=t<s?t:s}),s}return t};return n=l(e,n),r=l(t,r),n<r?e:t}):[s]=n),s}function eg(e){return{select(t){const{e:s}=t,i=Xm(s,e);i&&e.root.editFeature(i)}}}function tg(e){function t(t){const{e:i,e:{shiftKey:a,ctrlKey:o}}=t;if(a){const t=Xm(i,e);return null===t||e.root.emit("featureMultipleSelected",{feature:t}),!0}if(o){const t=Xm(i,e);return null===t||e.root.emit("featurePixelShow",{feature:t}),!0}s()}function s(){e.root.emit("featureMultipleSelectCleared"),e.canvasCtx.requestRenderAll()}return{changeSelect:t,reset:s}}class sg{constructor(e){this.view=e,this.modeType="label",this.panHandle=Ym(e),this.singleSelectHandle=eg(e),this.multipleSelectHandle=tg(e)}beforeLoad(){}load(e){this.beforeLoad(e),this.view.setGlobalCursorType(this.modeType)}beforeunload(){}unload(){this.beforeunload(),this.panHandle&&this.panHandle.reset(),this.multipleSelectHandle&&this.multipleSelectHandle.reset()}mouseClickOnCanvas(){}mouseDbClickOnCanvas(){}mouseMoveOnCanvas(){}mouseUpOnCanvas(){}mouseLeaveOnContainer(){}keyDownOnDocument(e){const{code:t}=e;this.view.activeKeyboard=t}keyUpOnDocument(){this.view.activeKeyboard=""}}class ig extends sg{constructor(e){super(e),this.modeType="pan",this.defaultConfig={multiple:!0},this.config=null,this.panHandle=Ym(this.view,!0)}beforeLoad(e){this.config=Object(a["assign"])(this.defaultConfig,e||{})}mouseClickOnCanvas(e){this.panHandle.start(e),this.config.multiple&&!this.view.ban&&this.multipleSelectHandle.changeSelect(e)}mouseDbClickOnCanvas(e){this.singleSelectHandle.select(e)}mouseMoveOnCanvas(e){this.panHandle.update(e)}mouseUpOnCanvas(){this.panHandle.end()}}function ag(e,t,...s){return clearTimeout(e),setTimeout(()=>{t.apply(this,s)},200)}class og extends sg{constructor(e){super(e),this.clickTimeId=null}mouseClickOnCanvas(e){const{button:t,target:s}=e;if(1===t){if(Zm(e,this.view))return;if(this.panHandle.start(e))return;if(this.multipleSelectHandle.changeSelect(e))return;if(s===this.view.canvasCtx.getActiveObject())return;this.clickTimeId=ag.call(this,this.clickTimeId,this.drawPointShape,e)}}mouseDbClickOnCanvas(e){clearTimeout(this.clickTimeId),this.singleSelectHandle.select(e)}mouseMoveOnCanvas(e){this.panHandle.update(e);const{absolutePointer:t}=e,s=this.view.getActualPoint(t);this.view.createMergePoint([s])}mouseUpOnCanvas(){this.panHandle.end()}drawPointShape(e){const{absolutePointer:t}=e,s=this.view.getActualPoint(t),{labelTarget:i}=this.view,a=Vm(i,[s]);this.view.root.emit("featureDrawDone",{type:"point",points:a}),this.view.renderMergePoint()}}class ng extends sg{constructor(e){super(e),this.defaultDrawStyle={color:"rgba(255, 255, 255, 0.3)",strokeWidth:1},this.drawStyle=null,this.drawingRect=null,this.startPoint=null}beforeLoad(e){this.drawStyle={...this.defaultDrawStyle,...Object(a["pickBy"])(e,e=>!Object(a["isUndefined"])(e))}}beforeunload(){this.drawingRect=null,this.startPoint=null}mouseClickOnCanvas(e){const{button:t,absolutePointer:s,target:i}=e;if(1===t){if(0!==this.view.labelTarget.angle&&Zm(e,this.view))return;if(this.panHandle.start(e))return;if(this.multipleSelectHandle.changeSelect(e))return;if(i&&i===this.view.canvasCtx.getActiveObject())return;this.startPoint=s,this.drawingRect=new Tl["fabric"].Rect({left:this.startPoint.x,top:this.startPoint.y,opacity:.3,fill:this.drawStyle.color,stroke:this.drawStyle.color,strokeWidth:0}),this.view.canvasCtx.add(this.drawingRect)}}mouseDbClickOnCanvas(e){this.singleSelectHandle.select(e)}mouseMoveOnCanvas(e){const{absolutePointer:{x:t,y:s}}=e;if(!this.panHandle.update(e)&&this.drawingRect){const e=Math.abs(this.startPoint.x-t),i=Math.abs(this.startPoint.y-s);this.drawingRect.set({width:e,height:i,originX:this.startPoint.x-t<0?"left":"right",originY:this.startPoint.y-s<0?"top":"bottom"}),this.drawingRect.setCoords(),this.view.canvasCtx.requestRenderAll()}}mouseUpOnCanvas(){if(!this.panHandle.end()&&this.drawingRect){const{labelTarget:e,canvasCtx:t}=this.view;this.checkValidRect(this.drawingRect)?this.drawingRect.clone(s=>{t.remove(this.drawingRect);const{originX:i,originY:a,width:o,height:n}=s,r=this.getStartPoint(i,a);if(this.view.labelTarget.isContainedWithinObject(this.drawingRect)){console.log("完全包住");const{width:e,height:t,top:i,left:a}=this.view.labelTarget;s.set({width:e,height:t,startPoint:r,top:i,left:a,strokeUniform:!0})}else{if(!this.drawingRect.isContainedWithinObject(this.view.labelTarget))return console.log("方框部分超出图片"),t.remove(this.drawingRect),this.drawingRect=null,void(this.startPoint=null);s.set({width:o,height:n,startPoint:r,strokeUniform:!0})}t.add(s);const l=Fm(e,s);t.remove(s),this.view.root.emit("featureDrawDone",{type:"rect",points:l})}):t.remove(this.drawingRect),this.drawingRect=null,this.startPoint=null}}checkValidRect(e){return!!e&&(e.width>5&&e.height>5)}getStartPoint(e,t){let s="tl";return"left"===e&&(s="top"===t?"tl":"bl"),"right"===e&&(s="top"===t?"tr":"br"),s}}class rg extends sg{constructor(e,t){super(e),this.type=t,this.activePoints=[],this.activeLines=[],this.activeShape=null,this.activeLine=null,this.defaultDrawStyle={color:"red",strokeWidth:1},this.drawStyle=null}beforeLoad(e){this.drawStyle={...this.defaultDrawStyle,...Object(a["pickBy"])(e,e=>!Object(a["isUndefined"])(e))}}beforeunload(){this.activePoints=[],this.activeLines=[],this.activeShape=null,this.activeLine=null}mouseClickOnCanvas(e){const{button:t,target:s}=e;if(1===t){if(Zm(e,this.view))return;if(this.panHandle.start(e))return;if(0===this.activePoints.length&&this.multipleSelectHandle.changeSelect(e))return;if(s===this.view.canvasCtx.getActiveObject())return;this.activePoints.length>1&&s&&s.id===this.activePoints[0].id?this.completeDrawShape():this.addActivePoints(e)}}mouseDbClickOnCanvas(e){this.activePoints.length>1?this.completeDrawShape():(1===this.activePoints.length&&this.clearActiveShapes(),this.singleSelectHandle.select(e))}mouseMoveOnCanvas(e){if(this.panHandle.update(e))return;const{absolutePointer:t}=e;this.updateActiveShape(t),this.updateTipText(t)}mouseUpOnCanvas(){this.panHandle.end()}mouseLeaveOnContainer(){this.leaveView()}keyDownOnDocument(e){const{code:t,ctrlKey:s}=e;this.view.activeKeyboard=t,s&&"KeyZ"===t&&this.stepBack()}clearActiveShapes(){this.activePoints.forEach(e=>{this.view.canvasCtx.remove(e)}),this.activeLines.forEach(e=>{this.view.canvasCtx.remove(e)}),this.view.canvasCtx.remove(this.activeShape).remove(this.activeLine),this.activePoints.length=0,this.activeLines.length=0,this.activeShape=null,this.activeLine=null,this.view.canvasCtx.getObjects().filter(e=>"activeMergePoint"===e.id).forEach(e=>this.view.canvasCtx.remove(e))}completeDrawShape(){const e=[],{labelTarget:t}=this.view;if("polygon"===this.type){if(this.activePoints.length<3)return;this.activePoints.forEach(t=>{e.push({x:t.left,y:t.top})})}if("polyline"===this.type){if(this.activePoints.length<2)return;this.activePoints.forEach(t=>{e.push({x:t.left,y:t.top})})}this.clearActiveShapes();const s=Vm(t,e);this.view.root.emit("featureDrawDone",{type:this.type,points:s}),this.view.renderMergePoint()}addActivePoints(e){const t=this.view.getActualPoint(e.absolutePointer);if(this.activeShape){const e=Object(a["last"])(this.activePoints),s=Math.abs(e.getCenterPoint().x-t.x),i=Math.abs(e.getCenterPoint().y-t.y);if(s<3&&i<3)return;const o=this.activeShape.get("points");o.push({x:t.x,y:t.y}),this.activeShape.set({points:o}),this.view.canvasCtx.requestRenderAll()}else{const e=[{x:t.x,y:t.y},{x:t.x,y:t.y}],s={stroke:this.drawStyle.color,strokeWidth:this.drawStyle.strokeWidth,fill:"polygon"===this.type?"rgba(100, 100, 255, 0.3)":"#fff",opacity:"polygon"===this.type?.3:0,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1};"polygon"===this.type&&(this.activeShape=new Tl["fabric"].Polygon(e,s)),"polyline"===this.type&&(this.activeShape=new Tl["fabric"].Polyline(e,s)),this.view.canvasCtx.add(this.activeShape)}const s=Math.floor(1e4*Math.random()),i=(new Date).getTime()+s,o=this.view.root.getAllPointsCountMap(),[n]=Vm(this.view.labelTarget,[t]),r=o[`${n.x}_${n.y}`]>0?"red":"#ffffff",l=new Tl["fabric"].Circle({id:i,left:t.x,top:t.y,originX:"center",originY:"center",fill:r,stroke:"black",strokeWidth:this.drawStyle.strokeWidth,radius:2,hasControls:!1,hasBorders:!1,selectable:!1,objectCaching:!1});0===this.activePoints.length&&(l.set({fill:this.color}),l.on("mousemove",e=>{const{target:t}=e;t.hoverCursor=Tm.default})),this.activePoints.push(l),this.view.canvasCtx.add(l);const c=[t.x,t.y,t.x,t.y];this.activeLine=new Tl["fabric"].Line(c,{strokeWidth:this.drawStyle.strokeWidth,fill:this.drawStyle.color,stroke:this.drawStyle.color,originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1}),this.activeLines.push(this.activeLine),this.view.canvasCtx.add(this.activeLine)}updateActiveShape(e){const t=this.view.getActualPoint(e);if(this.activePoints.length>0){const e=this.activeShape.get("points");this.activeLine.set({x2:t.x,y2:t.y}),e[e.length-1]={x:t.x,y:t.y,zIndex:1},this.activeShape.set({points:e}),this.view.createMergePoint(e),this.view.canvasCtx.requestRenderAll()}}updateTipText(e){let t="";this.activePoints.length>0&&("polygon"===this.type&&(t=1===this.activePoints.length?"ctrl+z 撤销":"双击闭合/ctrl+z 撤销"),"polyline"===this.type&&(t="双击结束绘制/ctrl+z 撤销"),this.view.updateGlobalTip(t,e))}stepBack(){if(0===this.activePoints.length)return;const e=this.activeLine.get("x2"),t=this.activeLine.get("y2");this.view.canvasCtx.remove(Object(a["last"])(this.activePoints)),this.view.canvasCtx.remove(Object(a["last"])(this.activeLines)),this.activePoints.pop(),this.activeLines.pop();let s=[];if(this.activePoints.length>0){const i=Object(a["last"])(this.activeShape.get("points")),o=this.activePoints.map(e=>({x:e.left,y:e.top}));s=o.concat(i),this.activeShape.set({points:s}),this.activeLine=Object(a["last"])(this.activeLines),this.activeLine.set({x2:e,y2:t})}else this.view.canvasCtx.remove(this.activeLine),this.view.canvasCtx.remove(this.activeShape),this.activeLine=null,this.activeShape=null;this.view.createMergePoint(s),this.updateTipText()}leaveView(){this.activePoints.length>0&&this.clearActiveShapes()}}class lg extends sg{constructor(e){super(e),this.defaultConfig={multiple:!0},this.config=null,this.panHandle=Ym(this.view,!0)}initBrushClip(){const{left:e,top:t,width:s,height:i}=this.view.labelTarget,a=new Tl["fabric"].Rect({left:e,top:t,width:s,height:i});this.view.canvasCtx.clipPath=a}isInDrawArea(e,t){const{left:s,top:i,width:a,height:o}=this.view.labelTarget;return e>=s&&e<=s+a&&t>=i&&t<=i+o}beforeLoad(e){this.view.canvasCtx.isDrawingMode=!0,this.view.canvasCtx.freeDrawingBrush=new Tl["fabric"].PencilBrush(this.view.canvasCtx),this.view.canvasCtx.freeDrawingBrush.width=this.view.root.pencilBrushWidth,this.view.canvasCtx.freeDrawingBrush.color=Km(e.color,.3),this.config=Object(a["assign"])(this.defaultConfig,e||{})}unload(){this.view.canvasCtx.isDrawingMode=!1}pathCreated(e){const{left:t,top:s,width:i,height:a,angle:o}=this.view.labelTarget,{x:n,y:r}=e.path.getCenterPoint(),l=new Tl["fabric"].Rect({left:t-n,top:s-r,width:i,height:a,angle:o});e.path.set({selectable:!1,id:"freeDrawPath",clipPath:l})}}class cg extends sg{constructor(e){super(e),this.defaultConfig={multiple:!0},this.config=null,this.panHandle=Ym(this.view,!0)}beforeLoad(e){this.view.canvasCtx.isDrawingMode=!0,this.view.canvasCtx.freeDrawingBrush=new Tl["fabric"].EraserBrush(this.view.canvasCtx),this.view.canvasCtx.freeDrawingBrush.width=this.view.root.eraserBrushWidth,this.config=Object(a["assign"])(this.defaultConfig,e||{})}unload(){this.view.canvasCtx.isDrawingMode=!1}pathCreated(){}}class dg extends ig{constructor(e){super(e),this.defaultConfig={multiple:!0},this.config=null,this.panHandle=Ym(this.view,!0)}beforeLoad(e){this.config=Object(a["assign"])(this.defaultConfig,e||{}),this.view.getFreeDrawMask()}unload(){this.view.removeFreeDrawMask()}}class ug{constructor(e,t){this.view=e,this.bindGlobalEvent(),this.modeMap=new Map([["pan",new ig(e)],["drawPoint",new og(e)],["drawRect",new ng(e)],["drawPolyline",new rg(e,"polyline")],["drawPolygon",new rg(e,"polygon")],["pencilBrush",new lg(e)],["eraserBrush",new cg(e)],["maskPreview",new dg(e)]]),this.currentMode=null,this.currentModeName=t,this.setCurrentMode(this.currentModeName),this.bindModeEvent()}setCurrentMode(e,t){this.currentMode&&this.currentMode.unload(),this.currentModeName=e,this.currentMode=this.modeMap.get(this.currentModeName),this.currentMode.load(t)}addCanvasEvent(e,t){this.view.canvasCtx.on(e,e=>{t.call(this,e)})}addCommonEvent(e,t,s){e.addEventListener(t,e=>{s.call(this,e)})}deleteCanvasEvent(e,t){this.view.canvasCtx.off(e,t)}deleteCommonEvent(e,t,s){e.removeEventListener(t,s)}bindGlobalEvent(){function e(e){const{e:{altKey:t,deltaY:s}}=e,{canvasCtx:i}=this.view;if(!t){let t=i.getZoom();t*=.999**s,t>20&&(t=20),t<.1&&(t=.1),i.zoomToPoint({x:e.e.offsetX,y:e.e.offsetY},t),this.view.root.emit("mouse:wheel",e)}e.e.preventDefault(),e.e.stopPropagation()}function t(e){const{transform:{action:t,target:s}}=e,{shape:i}=this.view.root.getFeatureById(s.id);if(i)if((["drag","rotate","modifyPolygon","modifyPolyline","modifyPoint"].includes(t)||t.startsWith("scale"))&&this.view.isOutOfLabelTarget(i)){if(t.startsWith("scale")&&s.angle===this.view.labelTarget.angle){const e=i.getBoundingPoints(),{aCoords:{tl:t,br:s}}=this.view.labelTarget,a=e.map(e=>{let{x:i,y:a}=e;return this.view.labelTarget.containsPoint(e,null,!0)||(i-t.x<0&&(console.log("超出左边"),i=t.x),i-s.x>0&&(console.log("超出右边"),i=s.x),a-t.y<0&&(console.log("超出上边"),a=t.y),a-s.y>0&&(console.log("超出下边"),a=s.y)),Vm(this.view.labelTarget,[{x:i,y:a}])[0]});return i.update({points:a}),void i.noticeEditDone()}i.update({points:i.points})}else i.noticeEditDone(),this.view.renderMergePoint()}this.addCanvasEvent("object:modified",t),this.addCanvasEvent("mouse:wheel",e)}bindModeEvent(){this.addCanvasEvent("mouse:down",e=>{this.currentMode.mouseClickOnCanvas(e)}),this.addCanvasEvent("mouse:dblclick",e=>{this.currentMode.mouseDbClickOnCanvas(e)}),this.addCanvasEvent("mouse:move",e=>{this.view.root.emit("mouse:move",e),this.currentMode.mouseMoveOnCanvas(e)}),this.addCanvasEvent("mouse:up",e=>{this.currentMode.mouseUpOnCanvas(e)}),this.addCommonEvent(this.view.containerElement.parentElement,"mouseleave",e=>{this.currentMode.mouseLeaveOnContainer(e)}),this.addCommonEvent(document,"keydown",e=>{this.currentMode.keyDownOnDocument(e)}),this.addCommonEvent(document,"keyup",e=>{this.currentMode.keyUpOnDocument(e)}),this.addCanvasEvent("path:created",e=>{var t;null===(t=this.currentMode)||void 0===t||t.pathCreated(e),this.view.root.emit("path:created",e)})}}class hg{constructor(e){Mm(Tl["fabric"],e),this.root=e,this.containerElement=e.containerElement,this.canvasCtx=null,this.image=e.image,this.ban=e.options.ban,this.workMode=e.options.toolMode,this.scaleMode=e.options.scaleMode,this.globalTip=null,this.labelTarget=null,this.labelTargetDegrees=0,this.isInit=!0,this.activeObjectId=null,this.drawObjects=[];const t=new ResizeObserver(e=>{const[{contentRect:{width:t,height:s}}]=e;if(this.canvasCtx){const e=this.getActiveObject();this.activeObjectId=e?e.id:null,this.drawObjects=this.root.getAllDrawObjects(),this.canvasCtx.clear(),this.canvasCtx.setDimensions({width:t,height:s})}else this.createCanvasCtx(this.containerElement,t,s);t>0&&s>0&&this.renderWorkSpace()}),s=this.containerElement.parentElement;t.observe(s)}createCanvasCtx(e,t,s){this.canvasCtx=new Tl["fabric"].Canvas(e,{defaultCursor:Tm.pan,hoverCursor:Tm.pan,selection:!1,fireRightClick:!0,stopContextMenu:!0,width:t,height:s}),this.interaction=new ug(this,this.workMode),this.setScaleModel(this.scaleMode)}renderWorkSpace(){console.log("renderWorkSpace"),this.createLabelTarget(),this.renderShapes(),this.renderDrawObject(this.drawObjects),this.createGlobalTip(),this.switchGrid(this.root.gridOn),this.initCross(),this.renderMergePoint(),this.canvasCtx.requestRenderAll()}setWorkMode(e,t){Lm.has(e)&&(this.workMode=e,this.interaction.setCurrentMode(this.workMode,t))}setScaleModel(e){if(["none","scaleDown","cover"].includes(e))switch(this.scaleMode=e,e){case"none":this.originZoom();break;case"scaleDown":this.zoomToMaxWidthOrHeight();break;case"cover":this.zoomToMaxWidth();break}}zoomIn(){const e=this.canvasCtx.getCenter(),t=this.canvasCtx.getZoom();this.canvasCtx.zoomToPoint({x:e.left,y:e.top},t+.5)}zoomOut(){const e=this.canvasCtx.getCenter(),t=this.canvasCtx.getZoom();this.canvasCtx.zoomToPoint({x:e.left,y:e.top},t-.5)}center(){const e=this.canvasCtx.getCenter(),t=this.canvasCtx.getZoom();this.canvasCtx.setViewportTransform(Tl["fabric"].iMatrix.concat()),this.canvasCtx.zoomToPoint({x:e.left,y:e.top},t)}originZoom(){this.canvasCtx.setViewportTransform(Tl["fabric"].iMatrix.concat())}zoomToMaxWidthOrHeight(){console.log("画布大小:",this.canvasCtx.width,this.canvasCtx.height);const e=this.canvasCtx.getCenter(),t=this.canvasCtx.width/this.image.width,s=this.canvasCtx.height/this.image.height;let i;i=t>1&&s>1?1:Math.min(t,s),this.canvasCtx.setViewportTransform(Tl["fabric"].iMatrix.concat()),this.canvasCtx.zoomToPoint({x:e.left,y:e.top},i)}zoomToMaxWidth(){const e=this.canvasCtx.getCenter(),t=this.canvasCtx.width/this.image.width;this.canvasCtx.setViewportTransform(Tl["fabric"].iMatrix.concat()),this.canvasCtx.zoomToPoint({x:e.left,y:e.top},t)}switchGrid(e){if(e){const e=100,t=10,{width:s,height:i,aCoords:{tl:a}}=this.labelTarget,o=Hm(this.labelTarget,a),{x:n,y:r}=o,l=[];for(let c=0;c<=Math.floor(i/e);c++){const t=new Tl["fabric"].Line([n,r+c*e,n+s,r+c*e],{stroke:"#b3b3b4",selectable:!1,id:"grid"});this.canvasCtx.add(t),l.push(t)}for(let c=0;c<=Math.floor(s/e);c++){const t=new Tl["fabric"].Line([n+c*e,r,n+c*e,r+i],{stroke:"#b3b3b4",selectable:!1,id:"grid"});this.canvasCtx.add(t),l.push(t)}for(let c=1;c<=Math.floor(i/t);c++){const e=new Tl["fabric"].Line([n,r+c*t,n+s,r+c*t],{stroke:"#d9d9d9",strokeWidth:.5,opacity:.5,selectable:!1,id:"grid"});this.canvasCtx.add(e),l.push(e)}for(let c=1;c<=Math.floor(s/t);c++){const e=new Tl["fabric"].Line([n+c*t,r,n+c*t,r+i],{stroke:"#d9d9d9",strokeWidth:.5,opacity:.5,selectable:!1,id:"grid"});this.canvasCtx.add(e),l.push(e)}0!==this.labelTargetDegrees&&this.rotateGrids(this.labelTargetDegrees),l.forEach(e=>{this.canvasCtx.sendToBack(e)}),this.canvasCtx.sendToBack(this.labelTarget)}else{const e=this.canvasCtx.getObjects().filter(e=>"grid"===e.id);e.forEach(e=>this.canvasCtx.remove(e))}}rotateGrids(e){const t=this.canvasCtx.getObjects().filter(e=>"grid"===e.id);t.forEach(t=>this.rotateCommonTarget(t,e))}initCross(){const e=function(e){const{absolutePointer:t,absolutePointer:{x:s,y:i}}=e,a=this.canvasCtx.getObjects().filter(e=>"crossLine"===e.id);if(a.forEach(e=>this.canvasCtx.remove(e)),this.root.crossOn&&this.labelTarget.containsPoint(t,null,!0)){const{width:e,height:t,left:a,top:o}=this.labelTarget.getBoundingRect(!0,!0),n=new Tl["fabric"].Line([a,i,a+e,i],{stroke:"#4d4e53",selectable:!1,id:"crossLine"}),r=new Tl["fabric"].Line([s,o,s,o+t],{stroke:"#4d4e53",selectable:!1,id:"crossLine"});this.canvasCtx.add(n),this.canvasCtx.add(r);const l=[n,r];l.forEach(e=>{this.canvasCtx.sendToBack(e)}),this.canvasCtx.sendToBack(this.labelTarget)}this.canvasCtx.requestRenderAll()}.bind(this);this.interaction.addCanvasEvent("mouse:move",e)}rotateView(e){this.labelTargetDegrees!==e&&(this.labelTargetDegrees=e,this.canvasCtx.clear(),this.renderWorkSpace())}rotateCommonTarget(e,t){const s=this.labelTarget.getCenterPoint(),i=Tl["fabric"].util.degreesToRadians(t),a=new Tl["fabric"].Point(e.left,e.top),o=Tl["fabric"].util.rotatePoint(a,s,i);e.set({left:o.x,top:o.y,angle:e.angle+t}),e.setCoords()}setGlobalCursorType(e){if(Object.keys(Tm).includes(e)){this.canvasCtx.defaultCursor=Tm[e],this.canvasCtx.hoverCursor=Tm[e];const t=this.root.getAllFeatures();t.forEach(t=>{const{shape:s}=t;s.hoverCursor=e,s.setHoverCursor(e)})}}selectShape(e){this.canvasCtx.setActiveObject(e.canvasObj),this.canvasCtx.requestRenderAll()}getActiveObject(){return this.canvasCtx.getActiveObject()}discardActiveObject(){this.getActiveObject()&&(this.canvasCtx.discardActiveObject(),this.canvasCtx.requestRenderAll())}addShape(e){e.addToView(this)}removeShape(e){e.removeFromView()}changeLabelTargetOpacity(e){this.labelTarget.set({opacity:e}),this.canvasCtx.requestRenderAll()}renderShapes(){const e=this.root.getAllFeatures();e.forEach(e=>{e.shape.isExsitInView()||this.addShape(e.shape),this.activeObjectId===e.featureId&&this.selectShape(e.shape)})}renderMergePoint(e){this.canvasCtx.getObjects().filter(e=>"mergePoint"===e.id).forEach(e=>this.canvasCtx.remove(e));const t=this.root.getAllFeaturesPoints(),s=e||this.root.getAllPointsCountMap();t.forEach(e=>{const[t]=qm(this.labelTarget,[e]);if(s[`${e.x}_${e.y}`]>1){const e=new Tl["fabric"].Circle({id:"mergePoint",radius:2,originX:"center",originY:"center",fill:"red",stroke:null,selectable:!1,left:t.x,top:t.y,zIndex:3});this.canvasCtx.add(e)}})}createMergePoint(e){this.canvasCtx.getObjects().filter(e=>"activeMergePoint"===e.id).forEach(e=>this.canvasCtx.remove(e));const t=this.root.getAllPointsCountMap();e.forEach(e=>{const[s]=Vm(this.labelTarget,[e]);if(t[`${s.x}_${s.y}`]&&t[`${s.x}_${s.y}`]<2){const t=this.root.getClosestPoint(e);if(t.point&&t.distance<this.root.getPointMergeDistance()){const t=new Tl["fabric"].Circle({id:"activeMergePoint",radius:2,originX:"center",originY:"center",fill:"red",stroke:null,selectable:!1,left:e.x,top:e.y,zIndex:3});this.canvasCtx.add(t)}}})}getActualPoint(e){const t=this.root.getClosestPoint(e);return this.root.isPointMerge&&t.point&&t.distance<this.root.getPointMergeDistance()?t.point:e}createLabelTarget(){this.labelTarget=new Tl["fabric"].Image(this.image,{selectable:!1,erasable:!1}),this.canvasCtx.add(this.labelTarget),this.labelTarget.center(),this.rotateCommonTarget(this.labelTarget,this.labelTargetDegrees),this.isInit&&(this.isInit=!1,this.root.emit("onload"))}isOutOfLabelTarget(e){const t=e.getLabelPosition(),{width:s,height:i}=this.labelTarget;return!t.every(e=>{const{x:t,y:a}=e;return t>=0&&t<=s&&a>=0&&a<=i})}createGlobalTip(){this.globalTip=new Tl["fabric"].Text("",{fontSize:15,selectable:!1,evented:!1}),this.canvasCtx.add(this.globalTip)}updateGlobalTip(e,t){const s={};Object(a["isString"])(e)&&(s.text=e),Object(a["isNumber"])(null===t||void 0===t?void 0:t.x)&&(s.left=t.x+5),Object(a["isNumber"])(null===t||void 0===t?void 0:t.y)&&(s.top=t.y-5),this.globalTip.set(s),this.canvasCtx.requestRenderAll()}getScreenShot(e,t,s=520,i=320){const{aCoords:{tl:o},angle:n}=this.labelTarget;let{canvasObj:r}=e,l=o;if(0!==n||-0!==n){l=Hm(this.labelTarget,o);const t=new Tl["fabric"].Point(r.left,r.top),s=Hm(this.labelTarget,t);if(r.set({left:s.x,top:s.y,angle:r.angle-n}),"polygon"===r.type){const t=e.updatePoints();e.update({points:t}),({canvasObj:r}=e)}}const c=r.getBoundingRect(!0,!0),d=Math.abs(Object(a["round"])(c.left-l.x,2)),u=Math.abs(Object(a["round"])(c.top-l.y,2)),h=new Tl["fabric"].StaticCanvas(document.createElement("canvas"),{width:this.image.width,height:this.image.height}),p=new Tl["fabric"].Image(this.image,{cropX:d,cropY:u,angle:-r.angle,width:c.width,height:c.height});h.add(p),p.center();const m=p.getCenterPoint();let g,b;if("rect"===r.type&&(g=r.width*r.scaleX,b=r.height*r.scaleY),"polygon"===r.type){g=c.width,b=c.height,r.setCoords();const t=qm(this.labelTarget,e.getLabelPosition());Gm(e,t,this.labelTarget)}const{startPoint:f}=r,v=m.x-g/2,y=m.y-b/2,w=new Tl["fabric"].StaticCanvas(t,{width:["tr","bl"].includes(f)?b:g,height:["tr","bl"].includes(f)?g:b});if("polygon"===r.type){const t=qm(this.labelTarget,e.getLabelPosition()),s=t.map(e=>Jm(f,r,e));w.clipPath=new Tl["fabric"].Polygon(s)}if(l!==o){const t=new Tl["fabric"].Point(r.left,r.top),s=Hm(this.labelTarget,t,!1);if(r.set({left:s.x,top:s.y,angle:r.angle+n}),"polygon"===r.type){const t=e.updatePoints();e.update({points:t}),({canvasObj:r}=e)}}return new Promise(e=>{Tl["fabric"].Image.fromURL(h.toDataURL(),t=>{let a;switch(f){case"tl":a=0;break;case"tr":a=-90;break;case"bl":a=90;break;case"br":a=180;break}t.set({cropX:v,cropY:y,width:g,height:b,angle:a}),w.add(t),t.center();const o=w.toDataURL();w.add(t);const n=s,r=i;let l=1,c=1;w.width>n&&(l=n/w.width),w.height>r&&(c=r/w.height);const d=Math.min(l,c);w.setWidth(Math.min(n,w.width*d)),w.setHeight(Math.min(r,w.height*d)),w.setZoom(d),e(o)})})}getFreeDrawMask(){const{left:e,top:t,width:s,height:i}=this.labelTarget,a=new Tl["fabric"].Rect({left:e,top:t,width:s,height:i});this.canvasCtx.clipPath=a;const o=new Tl["fabric"].Rect({left:e,top:t,width:s,height:i,fill:"black",selectable:!1,id:"freeDrawMask"});this.canvasCtx.add(o),o.bringToFront();const n=this.root.getAllDrawObjects();Tl["fabric"].util.enlivenObjects(n.map(e=>e.toJSON()),e=>{e.forEach(e=>{e.set({stroke:"white",selectable:!1,id:"freeDrawMask",opacity:1}),this.canvasCtx.add(e)}),this.canvasCtx.renderAll()})}removeFreeDrawMask(){this.canvasCtx.getObjects().filter(e=>"freeDrawMask"===e.id).forEach(e=>{this.canvasCtx.remove(e)}),this.canvasCtx.clipPath=null}async getFreeDrawMaskImg(){return new Promise(e=>{this.canvasCtx.clone(t=>{const{width:s,height:i,left:a,top:o}=this.labelTarget;t.set({width:s,height:i,clipPath:null}),t.clear();const n=new Tl["fabric"].Rect({left:0,top:0,width:s,height:i,fill:"black",selectable:!1,id:"freeDrawMask"});t.add(n);const r=this.root.getAllDrawObjects();Tl["fabric"].util.enlivenObjects(r.map(e=>e.toJSON()),e=>{e.forEach(e=>{e.set({stroke:"white",selectable:!1,id:"freeDrawMask",opacity:1,left:e.left-a,top:e.top-o}),t.add(e)})});const l=t.toDataURL({format:"jpeg",quality:1}),c=atob(l.split(",")[1]),d=new Uint8Array(c.length);for(let e=0;e<c.length;e++)d[e]=c.charCodeAt(e);const[,u]=l.match(/data:([^;]+);base64/);e(new Blob([d],{type:u}))})})}renderDrawObject(e){const{left:t,top:s}=this.labelTarget;e.forEach(e=>{const{targetLeft:i,targetTop:a}=e;e.set({left:i+t,top:a+s,angle:this.labelTargetDegrees,selectable:!1}),this.canvasCtx.add(e)})}}var pg=hg;class mg{constructor(e,t,s){this.view=null,this.id=e,this.points=t.points,this.style=s,this.color=s.color,this.backgroundColor=s.backgroundColor||"transparent",this.opacity=s.opacity||1,this.visible=!0,this.isFill=!1,this.tipOn=!0,this.tipText="",this.featureTip=null,this.pointOn=!0,this.nodeOn=!1,this.isPointMerge=!1,this.pointTips=[],this.pointNodes=[],this.hoverCursor=null,this.hoverTipText="双击选择编辑",this.elementType="label",this.canvasObj=null}addToView(e){this.view=e,this.pointOn=e.root.pointOn,this.nodeOn=e.root.nodeOn,this.isPointMerge=e.root.isPointMerge;const t=this.getCanvasPosition();this.createCanvasObj(t),this.addToCanvas()}createCanvasObj(){throw"未正确创建canvasObj"}updateCanvasObj(e){this.canvasObj.set(e),this.refreshCanvasCtx()}removeFromView(){this.view.canvasCtx.remove(this.canvasObj),this.canvasObj=null,this.featureTip&&this.featureTip.removeFromView(),this.pointTips.length&&this.pointTips.forEach(e=>{e.removeFromView()}),this.pointNodes.length&&(this.pointNodes.forEach(e=>{this.view.canvasCtx.remove(e)}),this.pointNodes=[])}isExsitInView(){return this.canvasObj&&this.view.canvasCtx.getObjects().includes(this.canvasObj)}update(e,t){const s=this.updateCommonProps(e),i=this.updateStyle(t),a=this.updatePrivateProps(e),o=this.updatePosition(null===e||void 0===e?void 0:e.points);if(o){const e=this.view.getActiveObject()===this.canvasObj;this.removeFromView(),this.addToView(this.view),e&&this.view.selectShape(this)}else this.updateCanvasObj({...s,...i,...a})}updateCommonProps(e){const t={};return Object(a["isBoolean"])(null===e||void 0===e?void 0:e.visible)&&(e.visible||this.view.canvasCtx.getActiveObject()!==this.canvasObj||this.view.canvasCtx.discardActiveObject(),this.visible=e.visible,t.visible=e.visible,this.featureTip&&this.updateFeatureTip({visible:e.visible}),this.pointTips&&this.pointTips.length&&this.updatePointTips({visible:e.visible}),this.pointNodes&&this.pointNodes.length&&this.updatePointNodes()),t}updateStyle(){}updatePrivateProps(){}updatePosition(e){if(Object(a["isNil"])(e))return null;if(!Object(a["isArray"])(e))throw"未传入坐标数组";return this.points=e,this.getCanvasPosition()}getCanvasPosition(){}getLabelPosition(){}getBoundingPoints(){}addCommenEvent(){this.view.ban||(this.canvasObj.on("mousemove",e=>{const{target:t,absolutePointer:s}=e,i=this.view.root.getMergePoint(s),a=i.feature.length>0;a||(t!==this.view.canvasCtx.getActiveObject()?(this.setHoverCursor(this.hoverCursor),this.view.updateGlobalTip(this.hoverTipText,e.absolutePointer)):(this.setHoverCursor("move"),this.view.updateGlobalTip("")))}),this.canvasObj.on("mouseout",()=>{this.view.updateGlobalTip("")}))}addFeatureTip(){if(this.tipOn){const e=this.getTipPositon();this.createFeatureTip(e)}}getTipPositon(){const[{x:e,y:t}]=this.points;return[{x:e,y:t-18}]}addPointTips(){const e=this.getPointTipPosition();this.createPointTips(e)}addPointNodes(){this.pointNodes=[],this.points.forEach((e,t)=>{const s=this.pointNodes.find(e=>e.id===`node-${this.id}-${t}`),[{x:i,y:a}]=qm(this.view.labelTarget,[e]),o=new Tl["fabric"].Circle({id:`node-${this.id}-${t}`,left:i,top:a,stroke:"white",fill:"black",originX:"center",originY:"center",radius:5,strokeWidth:1,selectable:!1,objectCaching:!1,erasable:!1,zIndex:99});s||(this.pointNodes.push(o),this.view.canvasCtx.add(o))}),this.updatePointNodes()}getPointTipPosition(){var e;const{points:t}=this,s={x:0,y:0};t.forEach(e=>{s.x+=e.x,s.y+=e.y}),s.x/=t.length,s.y/=t.length;const i=(null===(e=this.style)||void 0===e?void 0:e.strokeWidth)||0;return t.map(({x:e,y:t})=>({x:e<s.x?e-8-i:e+i,y:t<s.y?t-16-i:t+i}))}beforeAddToCanvas(){}addToCanvas(){this.beforeAddToCanvas(),this.view.canvasCtx.add(this.canvasObj),"label"===this.elementType&&(this.addCommenEvent(),this.addFeatureTip(),this.addPointTips(),this.addPointNodes())}updatePoints(){return this.points=this.getLabelPosition(),this.points}noticeEditDone(){this.updatePoints();const e=this.getTipPositon();this.updateFeatureTip({points:e});const t=this.getPointTipPosition();this.updatePointTips({points:t}),this.updatePointNodes({points:this.points}),this.view.root.emit("featureEditDone",{featureId:this.canvasObj.id,points:this.points}),this.refreshCanvasCtx()}createFeatureTip(e){this.featureTip=new fg("tip-"+this.id,{text:this.tipText,points:e},{color:"white",backgroundColor:this.color,opacity:.5}),this.view.addShape(this.featureTip)}createPointTips(e){e.length<this.pointTips.length&&(this.pointTips=this.pointTips.slice(0,e.length));for(let t=0;t<e.length;t++){const s=this.pointTips.find(e=>e.id===`tip-${this.id}-${t}`);if(s)s.update({text:t.toString(),points:[e[t]]},{color:this.color});else{const s=new fg(`tip-${this.id}-${t}`,{text:t.toString(),points:[e[t]]},{color:this.color});this.pointTips.push(s),this.view.addShape(s)}}this.updatePointTips({visible:!(!this.pointOn||!this.visible)})}updatePointTips(e,t){for(let s=0;s<this.pointTips.length;s++){const i=this.pointTips[s];null!==e&&void 0!==e&&e.points?i.update({points:[e.points[s]]},t):i.update(e,t),i.update({visible:!(!this.pointOn||!this.visible)})}}updatePointNodes(e){for(let t=0;t<this.pointNodes.length;t++){const s=this.pointNodes[t];if(null!==e&&void 0!==e&&e.points){const[{x:i,y:a}]=qm(this.view.labelTarget,[e.points[t]]);s.set({left:i,top:a})}s.set({visible:!(!this.nodeOn||!this.visible)})}this.refreshCanvasCtx()}updateFeatureTip(e,t){Object(a["isString"])(null===e||void 0===e?void 0:e.text)&&(this.tipText=e.text),this.featureTip.update(e,t)}removeFeatureTip(){this.featureTip=null,this.view.removeShape(this.featureTip)}setHoverCursor(e){this.canvasObj.hoverCursor=Tm[e],this.featureTip&&(this.featureTip.hoverCursor=e,this.featureTip.setHoverCursor(e))}refreshCanvasCtx(){this.view.canvasCtx.requestRenderAll()}}var gg=mg;class bg extends gg{constructor(e,t,s){super(e,t,s),this.text=t.text,this.tipOn=!1,this.elementType="normal"}createCanvasObj(e){this.canvasObj=new Tl["fabric"].Text(this.text,{id:this.id,...e,fill:this.color,backgroundColor:this.backgroundColor,opacity:this.opacity,fontSize:15,selectable:!1,evented:!1,erasable:!1})}updateStyle(e){const t={};return null!==e&&void 0!==e&&e.color&&(this.color=e.color,t.fill=this.color),null!==e&&void 0!==e&&e.backgroundColor&&(this.backgroundColor=e.backgroundColor,t.backgroundColor=this.backgroundColor),null!==e&&void 0!==e&&e.opacity&&(this.opacity=e.opacity,t.opacity=this.opacity),t}updatePrivateProps(e){const t={};return Object(a["isString"])(null===e||void 0===e?void 0:e.text)&&(this.text=e.text,t.text=e.text),t}getCanvasPosition(){const[{x:e,y:t}]=qm(this.view.labelTarget,this.points);return{left:e,top:t}}getLabelPosition(){const e=this.canvasObj.get("left"),t=this.canvasObj.get("top"),s=[{x:e,y:t}];return Vm(this.view.labelTarget,s)}}var fg=bg;class vg extends gg{constructor(e,t,s){super(e,t,s),this.isFill=!0,this.hoverTipText="双击编辑/右键删除",this.style=s}createCanvasObj(e){this.canvasObj=new Tl["fabric"].Circle({...e,id:this.id,strokeWidth:Em,stroke:this.color,fill:this.color,originX:"center",originY:"center",radius:this.style.radius||5,strokeUniform:!0,hasControls:!0,hasBorders:!1,lockScalingX:!0,lockScalingY:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,selectable:!1,objectCaching:!1,erasable:!1})}updateStyle(e){const t={};return null!==e&&void 0!==e&&e.color&&(this.color=e.color,t.stroke=this.color,t.fill=this.color),null!==e&&void 0!==e&&e.radius&&(t.radius=e.radius),t}getCanvasPosition(){const[{x:e,y:t}]=qm(this.view.labelTarget,this.points);return{left:e,top:t}}getLabelPosition(){const e=this.canvasObj.get("left"),t=this.canvasObj.get("top"),s=[{x:e,y:t}];return Vm(this.view.labelTarget,s)}getBoundingPoints(){return qm(this.view.labelTarget,this.getLabelPosition())}beforeAddToCanvas(){this.view.ban||(this.canvasObj.on("mousemove",e=>{const t=this.view.canvasCtx.getActiveObject(),s=this.view.root.getMergePoint(e.absolutePointer),i=s.feature.length>0;i||(t===this.canvasObj?this.view.updateGlobalTip("按下拖动",e.absolutePointer):this.view.updateGlobalTip(this.hoverTipText,e.absolutePointer))}),this.canvasObj.on("mousedown",e=>{3===e.button&&this.view.root.emit("featureDelete",{featureId:this.id})})),this.canvasObj.pathOffset={x:this.canvasObj.get("left"),y:this.canvasObj.get("top")},this.canvasObj.points=this.getBoundingPoints(),Wm(this.view.root,this.canvasObj)}}var yg=vg;class wg extends gg{constructor(e,t,s){super(e,t,s),this.style=s}createCanvasObj(e){this.canvasObj=new Tl["fabric"].Rect({...e,id:this.id,strokeWidth:this.style.strokeWidth||Em,fill:"rgba(0,0,0,0)",stroke:this.color,borderColor:this.color,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,selectable:!1,erasable:!1})}updateStyle(e){const t={};return null!==e&&void 0!==e&&e.color&&(this.color=e.color,t.stroke=this.color,t.borderColor=this.color),null!==e&&void 0!==e&&e.strokeWidth&&(t.strokeWidth=e.strokeWidth),t}getCanvasPosition(){return Nm(this.view.labelTarget,this.points,this.style.strokeWidth)}getLabelPosition(){return Fm(this.view.labelTarget,this.canvasObj)}getBoundingPoints(){const{aCoords:{tl:e,tr:t,bl:s,br:i}}=this.canvasObj;return[e,t,s,i]}getTipPositon(){var e;const t=(null===(e=this.style)||void 0===e?void 0:e.strokeWidth)||0;let s;const[i,a,o,n]=this.points;switch(this.canvasObj.startPoint){case"tl":s=[{x:i.x-t,y:i.y-18-t}];break;case"tr":s=[{x:n.x-t,y:n.y-18-t}];break;case"bl":s=[{x:a.x-t,y:a.y-18-t}];break;case"br":s=[{x:o.x-t,y:o.y-18-t}];break}return s}beforeAddToCanvas(){this.view.ban||this.canvasObj.on("mousewheel",e=>{const{e:{altKey:t,deltaY:s}}=e,i=this.view.canvasCtx.getActiveObject();if(t&&i===this.canvasObj){const e=this.canvasObj.angle-s/5,t=this.canvasObj.angle;if(this.canvasObj.rotate(e),this.canvasObj.setCoords(),this.view.isOutOfLabelTarget(this))return this.canvasObj.rotate(t),void this.canvasObj.setCoords();this.view.canvasCtx.requestRenderAll(),this.noticeEditDone()}e.e.preventDefault(),e.e.stopPropagation()})}}var xg=wg;function Cg(e){const t=e.calcTransformMatrix();return e.get("points").map(t=>new Tl["fabric"].Point(t.x-e.pathOffset.x,t.y-e.pathOffset.y)).map(e=>Tl["fabric"].util.transformPoint(e,t))}class jg extends gg{constructor(e,t,s){super(e,t,s),this.style=s}createCanvasObj(e){this.canvasObj=new Tl["fabric"].Polyline(e,{id:this.id,strokeWidth:this.style.strokeWidth||Em,stroke:this.color,fill:"rgba(0,0,0,0)",opacity:1,hasBorders:!1,transparentCorners:!1,objectCaching:!1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,selectable:!1,erasable:!1})}updateStyle(e){const t={};return null!==e&&void 0!==e&&e.color&&(this.color=e.color,t.stroke=this.color),null!==e&&void 0!==e&&e.strokeWidth&&(t.strokeWidth=e.strokeWidth),t}updatePrivateProps(){}getCanvasPosition(){return qm(this.view.labelTarget,this.points)}getLabelPosition(){const e=Cg(this.canvasObj);return Vm(this.view.labelTarget,e)}getBoundingPoints(){return qm(this.view.labelTarget,this.getLabelPosition())}beforeAddToCanvas(){this.view.ban||(this.canvasObj.on("mousemove",e=>{const{absolutePointer:t}=e,s=this.view.canvasCtx.getActiveObject(),i=this.view.root.getMergePoint(e.absolutePointer),a=i.feature.length>0;a||s!==this.canvasObj||kg(this,t,{eventType:"move"})}),this.canvasObj.on("mousedown",e=>{const{button:t,absolutePointer:s}=e,i=this.view.canvasCtx.getActiveObject();1===t&&i===this.canvasObj&&kg(this,s,{eventType:"click"}),3===t&&i===this.canvasObj&&kg(this,s,{eventType:"rightClick"})}),this.canvasObj.on("mouseout",()=>{Ag(this.view),this.view.setGlobalCursorType("move"),this.view.updateGlobalTip("")})),Um(this.view.root,this.canvasObj)}}var Og=jg;function kg(e,t,s){let i=!1;const{canvasObj:o,view:n,points:r}=e,l=qm(n.labelTarget,r);Object(a["forEach"])(l,(a,l)=>{const c=Pm(a,t);let d;if("polygon"===o.type&&(d=3),"polyline"===o.type&&(d=2),c<=5){const a=r.length>d?"/右键删除":"";if(i=!0,n.updateGlobalTip("按下拖动"+a,t),"rightClick"===(null===s||void 0===s?void 0:s.eventType)&&r.length>d)return r.splice(l,1),n.root.emit("featureEditDone",{featureId:o.id,points:r}),e.update({points:r}),n.renderMergePoint(),!1}}),Ag(n);const c=Rm({points:l,type:o.type},t);if(c){if(n.updateGlobalTip("按x键添加点",t),"KeyX"===n.activeKeyboard){n.updateGlobalTip("点击添加点",t);let e=n.canvasCtx.getObjects().filter(e=>"sidePoint"===e.id);0===e.length?(e=new Tl["fabric"].Circle({id:"sidePoint",radius:5/n.canvasCtx.getZoom(),originX:"center",originY:"center",fill:"white",stroke:"#2d8cf0",strokeWidth:1/n.canvasCtx.getZoom(),selectable:!1,left:c.point.x,top:c.point.y,zIndex:3}),n.canvasCtx.add(e)):(e[0].left=c.point.x,e[0].top=c.point.y),n.setGlobalCursorType("none")}return"click"===(null===s||void 0===s?void 0:s.eventType)&&"KeyX"===n.activeKeyboard&&(r.splice(c.index+1,0,Vm(n.labelTarget,[c.point])[0]),n.root.emit("featureEditDone",{featureId:o.id,points:r}),e.update({points:r})),!1}n.setGlobalCursorType("move"),i||n.updateGlobalTip("",t)}function Ag(e){const t=e.canvasCtx.getObjects().filter(e=>"sidePoint"===e.id);t.forEach(t=>e.canvasCtx.remove(t))}class Sg extends Og{constructor(e,t,s){super(e,t,s),this.style=s}createCanvasObj(e){this.canvasObj=new Tl["fabric"].Polygon(e,{id:this.id,strokeWidth:this.style.strokeWidth||Em,stroke:this.color,fill:"rgba(0,0,0,0)",hasBorders:!1,transparentCorners:!1,objectCaching:!1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,selectable:!1,erasable:!1})}}var _g=Sg,Ig={Text:fg,Point:yg,Rect:xg,Polyline:Og,Polygon:_g},$g={View:pg,...Ig};class Mg extends $m["EventEmitter"]{constructor(e,t,s){super(),this.containerElement=t,this.options=Dm(s||{},{tipOn:!0,gridOn:!0,crossOn:!1,pointOn:!0,nodeOn:!1,isPointMerge:!1,scaleMode:"normal",toolMode:"pan",ban:!1,pencilBrushWidth:10,eraserBrushWidth:10}),this.image=null,this.view=null,this.features=[],this.pencilBrushWidth=this.options.pencilBrushWidth,this.eraserBrushWidth=this.options.eraserBrushWidth,this.ban=this.options.ban,this.gridOn=this.options.gridOn,this.tipOn=this.options.tipOn,this.crossOn=this.options.crossOn,this.pointOn=this.options.pointOn,this.nodeOn=this.options.nodeOn,this.isPointMerge=this.options.isPointMerge,this.pointMergeDistance=20,this.setImage(e)}setImage(e){this.image=new Image,this.image.setAttribute("crossorigin","anonymous"),this.image.src=e,this.image.onerror=()=>{throw this.emit("onerror"),new Error("图片加载失败")},this.image.onload=()=>{this.view=new $g.View(this)}}setToolModel(e,t){this.view.setWorkMode(e,t)}setScaleModel(e){this.view.setScaleModel(e)}rotateLabel(e){this.view.rotateView(e)}getZoom(){const{canvasCtx:e}=this.view;return e.getZoom()}zoomIn(){this.view.zoomIn()}zoomOut(){this.view.zoomOut()}center(){this.view.center()}switchGrid(e){e!==this.gridOn&&(this.gridOn=e,this.view.switchGrid(e))}switchCross(e){e!==this.crossOn&&(this.crossOn=e)}switchPoints(e){e!==this.pointOn&&(this.pointOn=e,this.features.forEach(t=>{t.switchPointOn(e)}))}switchNodes(e){e!==this.nodeOn&&(this.nodeOn=e,this.features.forEach(t=>{t.switchNodeOn(e)}))}switchPointMerge(e){e!==this.isPointMerge&&(this.isPointMerge=e)}switchTipText(e){e!==this.tipOn&&(this.tipOn=e,this.features.forEach(t=>{t.switchTipOn(e)}))}addFeature(e){this.features.push(e),this.view.addShape(e.shape)}selectFeature(e){e&&(e.setVisible(!0),this.ban||this.view.selectShape(e.shape),this.emit("featureSelected",{feature:e}))}editFeature(e){e&&(e.setVisible(!0),this.ban||this.view.selectShape(e.shape),this.emit("featureSelected",{feature:e,editable:!0}))}discardActiveFeature(){this.view.discardActiveObject()}getActiveFeature(){const e=this.view.getActiveObject();if(e){const{id:t}=e;return this.getFeatureById(t)}return null}getFeatureById(e){return Object(a["find"])(this.features,{featureId:e})}removeFeatureById(e){const t=Object(a["findIndex"])(this.features,{featureId:e});-1!==t&&(this.view.removeShape(this.features[t].shape),this.features.splice(t,1),this.view.renderMergePoint())}getAllFeatures(){return this.features}getAllDrawObjects(){const{left:e,top:t}=this.view.labelTarget;return this.view.canvasCtx.getObjects().filter(e=>"freeDrawPath"===e.id).map(s=>(s.set({targetLeft:s.left-e,targetTop:s.top-t}),s))}async getTranslateDrawObjects(e){return await new Promise(t=>Tl["fabric"].util.enlivenObjects(e,e=>{t(e)}))}renderDrawObject(e){this.view.renderDrawObject(e)}changePencilBrushWidth(e){e&&(this.pencilBrushWidth=e,this.view.canvasCtx.freeDrawingBrush.width=e)}changeEraserBrushWidth(e){e&&(this.eraserBrushWidth=e,this.view.canvasCtx.freeDrawingBrush.width=e)}changeLabelTargetOpacity(e){this.view.changeLabelTargetOpacity(e)}getAllFeaturesVisible(){return this.features.filter(e=>e.shape.visible)}getAllFeaturesPoints(){return Object(a["uniqBy"])(Object(a["flatten"])(this.getAllFeaturesVisible().map(e=>e.getPoints())),e=>`${e.x}_${e.y}`)}getAllPointsCountMap(){return Object(a["countBy"])(Object(a["flatten"])(this.getAllFeaturesVisible().map(e=>Object(a["uniqBy"])(e.getPoints(),e=>`${e.x}_${e.y}`))),e=>`${e.x}_${e.y}`)}getPointMergeDistance(){return this.pointMergeDistance/this.view.canvasCtx.getZoom()}getMergePoint(e){const t={foint:{},feature:[]},s=this.getAllFeaturesVisible(),i=this.getAllPointsCountMap(),[o]=Vm(this.view.labelTarget,[e]);return s.forEach(e=>{const s=Object(a["uniqBy"])(e.getPoints(),e=>`${e.x}_${e.y}`);s.forEach(s=>{Pm(s,o)<5&&i[`${s.x}_${s.y}`]>1&&!Object(a["find"])(t.feature,{featureId:e.featureId})&&(t.point=s,t.feature.push(e))})}),t}updateGlobalTip(e,t){this.view.updateGlobalTip(e,t)}removeAllFeatures(){this.features.forEach(e=>{this.view.removeShape(e.shape)}),this.getAllDrawObjects().forEach(e=>{this.view.canvasCtx.remove(e)}),this.features=[]}drawScreenShot(e,t,s,i){return this.view.getScreenShot(e.shape,t,s,i)}async getFreeDrawMaskImg(){return await this.view.getFreeDrawMaskImg()}getClosestPoint(e,t){const s=this.getAllFeaturesVisible().filter(e=>e.featureId!==t),i=Object(a["uniqBy"])(Object(a["flatten"])(s.map(e=>e.getPoints())),e=>`${e.x},${e.y}`).map(e=>qm(this.view.labelTarget,[e])[0]);if(!i.length)return{point:null,distance:null};const o=Object(a["minBy"])(i,t=>Pm(t,e)),n=Pm(e,o);return{point:o,distance:n}}}var Tg=Mg;class Eg{constructor(e,t,s,i){this.featureId=e,this.props=s,this.tipText="",this.shape=null,this.visible=!0,this.createShape(t,i)}createShape(){throw"未正确创建shape"}getPoints(){var e;return null===(e=this.shape)||void 0===e?void 0:e.points}getEdgePixel(){const e=this.getPoints();if(!(e.length<3))return e.map((t,s)=>{const i=t,a=e[(s+1)%e.length];return Number(Pm(i,a).toFixed(1))})}switchTipOn(e){e!==this.shape.tipOn&&(this.shape.tipOn=e,e?(this.shape.createFeatureTip(),this.setTip(this.tipText)):this.shape.removeFeatureTip())}switchPointOn(e){e!==this.shape.pointOn&&(this.shape.pointOn=e,this.shape.updatePointTips({visible:e}))}switchNodeOn(e){e!==this.shape.nodeOn&&(this.shape.nodeOn=e,this.shape.updatePointNodes({visible:e}))}setTip(e,t){Object(a["isString"])(e)&&this.shape.featureTip&&(""!==e?(this.tipText=e,this.shape.updateFeatureTip({text:e},(null===t||void 0===t?void 0:t.featureStyle)||{backgroundColor:this.shape.color}),this.shape.updatePointTips({},null===t||void 0===t?void 0:t.pointStyle)):this.shape.updateFeatureTip({text:e},{backgroundColor:"transparent"}))}setVisible(e){e!==this.visible&&(this.visible=e,this.shape.update({visible:e}),this.shape.view.renderMergePoint())}update(e,t,s){this.updateProps(t),this.shape.update(e,s)}updateProps(e){Object(a["isEmpty"])(e)||Object(a["assign"])(this.props,e)}setSelectAttr(e){const{canvasObj:t,color:s,isFill:i,view:a}=this.shape;"add"===e&&t.set({fill:"#f2f2f24d",stroke:"red"}),"remove"===e&&t.set({fill:i?s:"rgba(0,0,0,0)",stroke:s}),a.canvasCtx.requestRenderAll()}}var Lg=Eg;class Dg extends Lg{createShape(e,t){this.shape=new $g.Point(this.featureId,e,t)}}var Pg=Dg;class Bg extends Lg{createShape(e,t){this.shape=new $g.Rect(this.featureId,e,t)}}var Rg=Bg;class zg extends Lg{createShape(e,t){this.shape=new $g.Polyline(this.featureId,e,t)}}var Ng=zg;class Fg extends Lg{createShape(e,t){this.shape=new $g.Polygon(this.featureId,e,t)}getPolygonArea(){let e=0;const{points:t}=this.shape,s=t.length;for(let i=0;i<s;i++){const a=(i+1)%s;e+=t[i].x*t[a].y,e-=t[i].y*t[a].x}return Number(Math.abs(e/2).toFixed(1))}}var Vg=Fg,qg={Point:Pg,Rect:Rg,Polyline:Ng,Polygon:Vg};const Hg={Label:Tg,Feature:qg};var Wg=s("ffd0"),Ug={directives:{showTip:{inserted(e,t,s){const i=e.offsetWidth,{context:a}=s,{componentInstance:{$refs:{reference:{children:[o]}}}}=s;o.offsetWidth>i&&(a.tipDisabledMap[t.value]=!1)}}},components:{safeImage:Bs},mixins:[Re["a"]],props:{src:String},data(){let e=!1;const t=localStorage.getItem("optimus-image-stage-gridOn");t&&(e=JSON.parse(t));let s=!1;const i=localStorage.getItem("optimus-image-stage-crossOn");i&&(s=JSON.parse(i));let o=!1;const n=localStorage.getItem("optimus-image-stage-pointOn");n&&(o=JSON.parse(n));let r=!1;const l=localStorage.getItem("optimus-image-stage-nodeOn");l&&(r=JSON.parse(l));let c=!1;const d=localStorage.getItem("optimus-image-stage-isPixelShow");d&&(c=JSON.parse(d));let u=[];const h=localStorage.getItem("optimus-image-ocr-stage-tipMode");if(h)switch(h){case"":u=[];break;case"showAll":case"showIndex":u=["showTool"];break;default:u=Object.keys(JSON.parse(h));break}let p=this.$renderedComponentConfig.$object_tools||[];p=p.map(e=>{const{helps:t}=e;let s;return s=!(!t||0===t.length)&&t.some(e=>e.enable),{...e,hasEnableAIHelp:s}});const m=p.length>0?Object(a["first"])(p):null,g={};return p.forEach(e=>{g[e.name]=!0}),{objects:this.$optimus.objects,tags:this.$optimus.tags,toolsConfig:p,tipDisabledMap:g,currentTool:m,imageLabel:null,drawTypeMap:{"image/point":"point","image/rect":"rect","image/polygon":"polygon","image/polyline":"polyline","image/pencilBrush":"pencilBrush","image/eraserBrush":"eraserBrush"},mode:"pan",labelAngle:0,targetLabelOpacity:100,crossOn:s,gridOn:e,pointOn:o,nodeOn:r,isPixelShow:c,pixelShowMap:{},tipType:u,displayMode:localStorage.getItem("optimus-image-ocr-stage-displayMode")||"scaleDown",objDisplays:{},markModal:{showModal:!1,feature:null,updateObj:null,title:"",componentConfig:{},objAnswer:{},needDrawScreenShot:!1},objectContext:{},activeFeature:null,selectFeatures:[],clipBoard:{},screenShot:null,zoom:"",pencilBrushWidth:Number(localStorage.getItem("optimus-image-stage-pencilBrushWidth")||10),eraserBrushWidth:Number(localStorage.getItem("optimus-image-stage-eraserBrushWidth")||10),isMaskPreview:!1,drawnObjects:[],maskModalVisible:!1,history:[],index:-1}},computed:{componentConfig(){return this.getComponentConfig({props:{name:this.currentTool.name}})},isShowSwitchPixel(){return this.toolsConfig.some(e=>["image/rect","image/polygon"].includes(e.type))},isHasPencilBrush(){return this.toolsConfig.some(e=>["image/pencilBrush"].includes(e.type))},currentEditFeature(){return this.markModal.showModal&&this.markModal.feature},toolMenuStyle(){return function(e){const{mode:t,currentTool:s,currentEditFeature:i}=this,a={selected:!("pan"===t||!s||s.name!==e.name),disabled:!(!i||!s||e.type===s.type)};return a}},toolColor(){return function(e){return this.toolMenuStyle(e).disabled?"#888":e.color}},toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]={label:t.label,color:t.color,type:t.type}}),e},objectItemMap(){const e=new Map;return this.objects.forEach(t=>{if(e.has(t.name)){const s=e.get(t.name);s.push(t)}else{const s=[t];e.set(t.name,s)}}),e}},watch:{objDisplays:{handler(e){this.$emit("image:change-object-show",e)},deep:!0},drawnObjects:{async handler(){this.$optimus.extData={drawnObjects:this.drawnObjects.map(e=>(console.log(),e.toJSON(["id","targetLeft","targetTop"])))},console.log(this.$optimus.result)}}},async mounted(){this.isHasPencilBrush&&this.$optimus.initBeforeSubmitEvent(this.uploaMask),this.$optimus.$on("optimus:image-stage:dragObj",e=>{this.handleDrag(e)}),this.$optimus.active&&(document.addEventListener("keydown",this.listenKeyboardEvent),document.addEventListener("keyup",this.listenKeyupEvent)),this.initImageLabel(),this.$optimus.extData&&(this.drawnObjects=await this.imageLabel.getTranslateDrawObjects(this.$optimus.extData.drawnObjects||[])),this.saveState()},destroy(){this.$optimus.active&&(document.removeEventListener("keydown",this.listenKeyboardEvent),document.removeEventListener("keyup",this.listenKeyupEvent))},methods:{listenKeyboardEvent(e){const{code:t,ctrlKey:s,altKey:i,shiftKey:a,target:o}=e;if("Enter"===t){if(a)return void this.$emit("hot-key:select","prev");if(i)return void this.$emit("hot-key:select","next");if(this.markModal.showModal&&!this.$optimus.disabled)if(s)this.confirmMark();else{const t=this.findOcrItem();t&&document.activeElement!==t.$refs.ocrInput.$refs.input&&(t.$refs.ocrInput.focus(),e.preventDefault())}}if(s&&("Equal"===t&&this.setZoomByHotKey("increase"),"Minus"===t&&this.setZoomByHotKey("reduce"),"KeyS"===t&&(e.preventDefault(),this.objects.forEach(e=>{this.changeObjectShow({featureId:e.featureId,type:"show"})})),"KeyD"===t&&(e.preventDefault(),this.objects.forEach(e=>{this.changeObjectShow({featureId:e.featureId,type:"hidden"})}))),!("INPUT"===o.tagName&&"checkbox"!==o.getAttribute("type")||"TEXTAREA"===o.tagName||o.getAttribute("contenteditable")))if("Backspace"!==t||this.$optimus.disabled||this.deleteSelectFeatures(),s&&!this.$optimus.disabled)"KeyC"===t&&(e.preventDefault(),this.handleCopyObj()),"KeyV"===t&&(e.preventDefault(),this.handlePasteObj()),"KeyG"===t&&(e.preventDefault(),this.handleGroupObj());else if(i&&!this.$optimus.disabled&&this.markModal.showModal){if("KeyZ"===t){e.preventDefault();const t=this.findOcrItem();t&&t.handleFetchOcrResult()}if("KeyA"===t){e.preventDefault();const t=this.findOcrItem();t&&t.applyOcrResult()}}else if(!i&&!s&&!a)switch(t){case"KeyC":this.switchCross();break;case"KeyQ":this.switchPixelShow();break;case"KeyA":this.switchPointMerge(!0);break}},listenKeyupEvent:Object(a["debounce"])((function(e){const{code:t}=e;switch(t){case"KeyA":this.switchPointMerge(!1);break}})),async uploaMask(){const e=await this.imageLabel.getFreeDrawMaskImg();return new Promise(async(t,s)=>{try{const s=this,i="蒙版图片.jpeg",a={obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_scene:"label",attach_name:i,attach_size:e.size},{data:[{attach_id:o,bucket:n,region:r,prefix:l,scene:c}]}=await Object(Wg["b"])(a),d={id:o,type:"attachment",Bucket:n,Region:r,Key:`${l}/${this.$optimus.objectId}/${c}/${i}`,file:e,handleTaskReady(){},async handleUploadSuccess(){const e=await Object(Wg["f"])({attach_id:o,need_preview:!0});s.$optimus.formData.imgMask=e.attach_path,t(e)},handleUploadFail(){s.$Message.error("文件上传出错，请联系任务负责人解决"),s.loading=!1}};fu(d)}catch(i){console.log(123,i),s(i)}})},switchImagePreview(){this.isMaskPreview=!this.isMaskPreview,this.isMaskPreview?this.setLabelMode({type:"maskPreview"}):this.setLabelMode({type:"pan"})},changePencilBrushWidth(e){localStorage.setItem("optimus-image-stage-pencilBrushWidth",e),this.imageLabel.changePencilBrushWidth(e)},changeEraserBrushWidth(e){localStorage.setItem("optimus-image-stage-eraserBrushWidth",e),this.imageLabel.changeEraserBrushWidth(e)},async clonePaths(e){const t=e.map(e=>new Promise(t=>{const{id:s,targetLeft:i,targetTop:a}=e;e.clone(e=>{e.set({id:s,targetLeft:i,targetTop:a}),t(e)})}));return await Promise.all(t)},async saveState(){this.index=this.index+1,this.history.splice(this.index,this.history.length-this.index,{objects:Object(a["cloneDeep"])(this.objects),drawnObjects:await this.clonePaths(this.drawnObjects)})},async loadState(e){this.imageLabel.removeAllFeatures();const{objects:t,drawnObjects:s}=this.history[e];this.objects.splice(0,this.objects.length,...Object(a["cloneDeep"])(t)),this.drawnObjects=await this.clonePaths(s),this.renderObjects()},undo(){this.index>0&&(this.index=this.index-1,this.loadState(this.index))},redo(){this.index<this.history.length-1&&(this.index=this.index+1,this.loadState(this.index))},deleteAll(){this.$optimus.disabled||(this.objects.length||this.drawnObjects.length?this.$Modal.confirm({title:"确认清空当前全部绘制内容？",onOk:()=>{this.imageLabel.removeAllFeatures(),this.objects.splice(0,this.objects.length),this.drawnObjects=[]}}):this.$Message.info({content:"暂无绘制内容"}))},initImageLabel(){this.imageLabel=new Hg.Label(this.src,this.$refs.workspace,{gridOn:this.gridOn,crossOn:this.crossOn,pointOn:this.pointOn,nodeOn:this.nodeOn,toolMode:this.mode,scaleMode:this.displayMode,ban:this.$optimus.disabled,pencilBrushWidth:this.pencilBrushWidth,eraserBrushWidth:this.eraserBrushWidth}),this.imageLabel.on("onload",()=>{this.addLabelEvent(),this.currentTool&&this.setLabelMode(this.currentTool),this.renderObjects()}),this.imageLabel.on("onerror",()=>{this.$Message.error("图片加载失败")})},addLabelEvent(){this.imageLabel.on("outsideLabelRange",()=>{this.$Message.warning("请在图片区域内进行标注")}),this.imageLabel.on("featureDrawDone",({type:e,points:t})=>{const{color:s,name:i}=this.currentTool,a="feature-"+Object(n["j"])(8),o=this.addFeature(a,e,{points:t},{name:i},{color:s}),{items:r}=this.getComponentConfig(o);null!==r&&void 0!==r&&r.length?this.editFeature(a):(this.addObject(o,[]),this.selectFeature(a)),this.saveState()}),this.imageLabel.on("featureEditDone",({featureId:e})=>{const t=this.imageLabel.getFeatureById(e);this.updatePoints(t),this.saveState()}),this.imageLabel.on("featureDelete",({featureId:e})=>{this.$Modal.confirm({title:"确定要删除？",content:e,onOk:()=>{this.deleteObj(e),this.saveState()}})}),this.imageLabel.on("featureSelected",({feature:e,editable:t})=>{this.objects.some(t=>t.featureId===e.featureId)&&(this.removeFeaturesSelect(),this.$emit("image:select-feature",e.featureId),this.activeFeature=e,t&&this.triggerMarkModal(e))}),this.imageLabel.on("featureMultipleSelected",({feature:e})=>{this.selectFeatures.includes(e)?(e.setSelectAttr("remove"),Object(a["remove"])(this.selectFeatures,e)):(e.setSelectAttr("add"),this.selectFeatures.push(e))}),this.imageLabel.on("featureMultipleSelectCleared",()=>{this.removeFeaturesSelect()}),this.imageLabel.on("featurePixelShow",({feature:e})=>{const{featureId:t}=e,s=Object(a["find"])(this.objects,{featureId:t});["image/rect","image/polygon"].includes(s.type)&&(this.pixelShowMap[t]=!this.pixelShowMap[t],s&&e.setTip(this.getFeatureTip(s,this.pixelShowMap[t])))}),this.imageLabel.on("mouse:move",e=>{const t=this.$refs.zoomTooltip;"none"!==t.style.display&&Object.assign(t.style,{display:"none"});const{absolutePointer:s}=e,i=this.imageLabel.getMergePoint(s);if(0===i.feature.length)return void this.imageLabel.updateGlobalTip("");const o=[];i.feature.forEach(e=>{const t=Object(a["find"])(this.objects,{featureId:e.featureId});t&&o.push(this.getFeatureTip(t))}),this.imageLabel.updateGlobalTip("吸附标签："+o.join(";"),s)}),this.imageLabel.on("path:created",()=>{this.drawnObjects=this.imageLabel.getAllDrawObjects(),this.saveState()});let e=null;this.imageLabel.on("mouse:wheel",()=>{this.zoom=parseInt(100*this.imageLabel.getZoom(),10)+"%";const t=this.$refs.zoomTooltip;Object.assign(t.style,{display:"block"}),e&&clearTimeout(e),e=setTimeout(()=>{Object.assign(t.style,{display:"none"})},1e3)})},setLabelMode(e){var t,s,i,a;if(this.$optimus.disabled&&!["maskPreview","pan"].includes(e.type))return;this.markModal.showModal&&null!==(t=this.$refs.object)&&void 0!==t&&null!==(s=t.tags)&&void 0!==s&&s.length&&(this.markModal.objAnswer={tags:this.$refs.object.tags.filter(e=>e.name&&e.label)});let o="";switch(e.type){case"pan":o="pan";break;case"image/rect":o="drawRect";break;case"image/point":o="drawPoint";break;case"image/polyline":o="drawPolyline";break;case"image/polygon":o="drawPolygon";break;case"image/pencilBrush":o="pencilBrush";break;case"image/eraserBrush":o="eraserBrush";break;case"maskPreview":o="maskPreview"}this.mode=o,this.currentTool=e,this.imageLabel.setToolModel(this.mode,{color:null===(i=this.currentTool)||void 0===i?void 0:i.color,strokeWidth:null===(a=this.currentTool)||void 0===a?void 0:a.labelPixel}),this.imageLabel.discardActiveFeature()},setEraserBrush(){this.imageLabel.setEraserBrush()},centerWorkspace(){this.imageLabel.center()},switchZoomType(){this.imageLabel.setScaleModel(this.displayMode),localStorage.setItem("optimus-image-ocr-stage-displayMode",this.displayMode)},setZoomByHotKey(e){"increase"===e&&this.imageLabel.zoomOut(),"reduce"===e&&this.imageLabel.zoomIn()},switchGrid(){this.gridOn=!this.gridOn,this.imageLabel.switchGrid(this.gridOn),localStorage.setItem("optimus-image-stage-gridOn",this.gridOn)},switchCross(){this.crossOn=!this.crossOn,this.imageLabel.switchCross(this.crossOn),localStorage.setItem("optimus-image-stage-crossOn",this.crossOn)},switchPoint(){this.pointOn=!this.pointOn,this.imageLabel.switchPoints(this.pointOn),localStorage.setItem("optimus-image-stage-pointOn",this.pointOn)},switchNodeShow(){this.nodeOn=!this.nodeOn,this.imageLabel.switchNodes(this.nodeOn),localStorage.setItem("optimus-image-stage-nodeOn",this.nodeOn)},switchPointMerge(e){this.imageLabel.switchPointMerge(e)},switchPixelShow(){this.isPixelShow=!this.isPixelShow,this.objects.forEach(e=>{this.setFeatureTip(e)}),localStorage.setItem("optimus-image-stage-isPixelShow",this.isPixelShow)},switchTipType(){if(!this.tipType)return;const e=this.tipType.map(e=>({[e]:!0})).reduce((e,t)=>Object.assign(e,t),{});localStorage.setItem("optimus-image-ocr-stage-tipMode",JSON.stringify(e)),this.objects.forEach(e=>{this.setFeatureTip(e)})},rotateLabel(){this.imageLabel.rotateLabel(this.labelAngle)},changeLabelTargetOpacity(){this.imageLabel.changeLabelTargetOpacity(this.targetLabelOpacity/100)},getObjectLabel(e){let t="";try{this.$renderedComponentConfig.$object_items.map(s=>{const i=Object(a["find"])(e.tags,{name:s.attributes.name});if(i&&(s.attributes.reference===e.name||"all"===s.attributes.reference)){if(Object(a["isString"])(i.value)&&i.value)return t+=`${t?"|":""}${i.value}`,!0;if(Object(a["isArray"])(i.value)&&i.value.length>0&&i.value.every(e=>"string"===typeof e))return t+=`${t?"|":""}${i.value.join(",")}`,!0}return!1})}catch(s){console.log(s)}return t?""+t:""},getFeatureTip(e,t){const{featureId:s,label:i,type:o}=e,n=this.objectItemMap.get(e.name),r=Object(a["findIndex"])(n,{featureId:s}),l=this.imageLabel.getFeatureById(s);let c="";const{tipType:d}=this;if(d&&(d.includes("showTool")&&(c=`${i}-${r+1}`),d.includes("showLabel")&&(c=`${c}${c&&this.getObjectLabel(e)?": ":""}${this.getObjectLabel(e)}`)),null!==t&&void 0!==t?t:this.isPixelShow)switch(o){case"image/rect":{const e=l.getEdgePixel();c=`${c}【${e[0]}*${e[1]}】`;break}case"image/polygon":{const e=l.getPolygonArea();c=`${c}【${e}】`;break}}return c},setFeatureTip(e){this.pixelShowMap[e.featureId]=this.isPixelShow;const t=this.imageLabel.getFeatureById(e.featureId);t&&t.setTip(this.getFeatureTip(e))},renderObjects(){if(this.objects&&this.objects.length>0)for(let e=0;e<this.objects.length;e++){const t=this.objects[e],{type:s,color:i,featureId:a,data:o,name:n}=t;this.addFeature(a,this.drawTypeMap[s],{points:o},{name:n},{color:i}),this.setFeatureTip(t)}this.drawnObjects&&this.drawnObjects.length>0&&this.imageLabel.renderDrawObject(this.drawnObjects)},addFeature(e,t,s,i,o){let n;const r=Object(a["find"])(this.toolsConfig,{name:i.name});switch(t){case"point":n=new Hg.Feature.Point(e,s,i,{...o,radius:(null===r||void 0===r?void 0:r.labelPixel)||5});break;case"rect":n=new Hg.Feature.Rect(e,s,i,{...o,strokeWidth:(null===r||void 0===r?void 0:r.labelPixel)||1});break;case"polygon":n=new Hg.Feature.Polygon(e,s,i,{...o,strokeWidth:(null===r||void 0===r?void 0:r.labelPixel)||1});break;case"polyline":n=new Hg.Feature.Polyline(e,s,i,{...o,strokeWidth:(null===r||void 0===r?void 0:r.labelPixel)||1});break}return this.imageLabel.addFeature(n),this.$set(this.objDisplays,e,!0),n},addObject(e,t,s){const{type:i,color:a,name:o,label:n}=null!==s&&void 0!==s?s:this.currentTool,r={type:i,data:e.getPoints(),tags:t,featureId:e.featureId,color:a,name:o,label:n,group:""};this.objects.push(r),this.setFeatureTip(r),this.$nextTick(()=>{this.$emit("image:select-feature",e.featureId)})},updatePoints(e){const{featureId:t}=e,s=this.objects.find(e=>e.featureId===t);s&&(s.data=e.getPoints(),this.setFeatureTip(s)),this.markModal.showModal&&this.markModal.needDrawScreenShot&&this.drawScreenShot(e)},deleteObj(e){var t;const s=this.objects.findIndex(t=>t.featureId===e),i=null===(t=this.objects[s])||void 0===t?void 0:t.name;this.objects.splice(s,1),this.imageLabel.removeFeatureById(e),delete this.objDisplays[e],this.handleDrag(i),this.markModal.showModal&&(this.markModal.showModal=!1)},selectFeature(e){this.removeFeaturesSelect();const t=this.imageLabel.getFeatureById(e);this.imageLabel.selectFeature(t),this.objDisplays[e]=!0},selectFeatureGroup(e){this.imageLabel.discardActiveFeature(),this.selectFeatures=this.objects.filter(t=>e.includes(t.group)||e.includes(t.featureId)).map(e=>this.imageLabel.getFeatureById(e.featureId)),this.objects.forEach(e=>{const t=this.imageLabel.getFeatureById(e.featureId);Object(a["find"])(this.selectFeatures,{featureId:e.featureId})?(t.setSelectAttr("add"),this.selectFeatures.push(t),t.setVisible(!0),this.objDisplays[t.featureId]=!0):(t.setSelectAttr("remove"),Object(a["remove"])(this.selectFeatures,t))})},editFeature(e){const t=this.imageLabel.getFeatureById(e);this.imageLabel.selectFeature(t),this.objDisplays[e]=!0,this.triggerMarkModal(t)},judgeDrawScreenShot(e){const{props:{name:t}}=e;this.markModal.needDrawScreenShot=["image/rect","image/polygon"].includes(this.toolLabelMap[t].type)},getComponentConfig(e){const{props:{name:t}}=e,s=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:s}}=e;return!s||("all"===s||s===t)});return{component:"z-form-stage",items:s}},triggerMarkModal(e){const{feature:t}=this.markModal;if(t){if(t===e)return;-1===Object(a["findIndex"])(this.objects,{featureId:t.featureId})&&this.imageLabel.removeFeatureById(t.featureId)}this.markModal.componentConfig=this.getComponentConfig(e),this.markModal.componentConfig.items.length>0&&this.judgeDrawScreenShot(e),this.markModal.showModal=!0,this.imageLabel.setToolModel("pan",{multiple:!1});const{props:{name:s},featureId:i}=e;return this.markModal.title=`${this.toolLabelMap[s].label}: ${i}`,this.markModal.feature=e,this.markModal.needDrawScreenShot&&this.$nextTick(()=>{this.drawScreenShot(e)}),this.markModal.updateObj=this.objects.find(e=>e.featureId===i),this.markModal.updateObj?this.markModal.objAnswer={tags:this.markModal.updateObj.tags}:this.markModal.objAnswer={},this.currentTool=Object(a["find"])(this.toolsConfig,{name:s}),!0},confirmMark(){const{currentTool:e}=this;if(this.$refs.object.validate(),this.$refs.object.isValid){var t;const s=this.$refs.object.tags,{feature:i}=this.markModal;if((null===e||void 0===e?void 0:e.name)!==(null===i||void 0===i||null===(t=i.props)||void 0===t?void 0:t.name)&&i.update(i,{name:e.name},{color:e.color,strokeWidth:e.labelPixel}),this.markModal.updateObj){if(this.markModal.updateObj.tags=s.filter(e=>e.name&&e.label),(null===e||void 0===e?void 0:e.name)!==this.markModal.updateObj.name){const{name:t,color:s,label:a}=e;Object.assign(this.markModal.updateObj,{name:t,color:s,label:a}),i.setTip(this.getFeatureTip(this.markModal.updateObj),{featureStyle:{backgroundColor:s},pointStyle:{color:s}})}}else this.addObject(this.markModal.feature,s.filter(e=>e.name&&e.label)),this.objects.forEach(t=>{t.featureId===this.markModal.feature.featureId&&i.setTip(this.getFeatureTip(t),{featureStyle:{backgroundColor:e.color},pointStyle:{color:e.color}})});this.markModal.updateObj=null,this.markModal.showModal=!1,this.markModal.feature=null,this.imageLabel.discardActiveFeature();const{color:a,labelPixel:o}=e;this.imageLabel.setToolModel(this.mode,{color:a,strokeWidth:o})}else this.markModal.showModal=!0},cancelMark(){this.markModal.updateObj||(this.imageLabel.removeFeatureById(this.markModal.feature.featureId),this.markModal.feature=null),this.markModal.updateObj=null,this.markModal.showModal=!1,this.markModal.feature=null,this.imageLabel.discardActiveFeature();const{color:e,labelPixel:t}=this.currentTool;this.imageLabel.setToolModel(this.mode,{color:e,strokeWidth:t})},drawScreenShot(e){this.imageLabel.drawScreenShot(e,this.$refs.formContent).then(e=>{this.$set(this.objectContext,"imageStr",e),this.screenShot=new Image,this.screenShot.src=e})},findOcrItem(){const[e]=this.$refs.object.$children,{$refs:t,formRef:s}=e,i=t[s].$children;return i.find(e=>e.aiHelp&&"ocr"===e.aiHelp)},handleCopyObj(){const e=this.imageLabel.getActiveFeature();if(e){const t=Object(a["find"])(this.objects,{featureId:e.featureId});t?(this.$Message.success({content:"成功复制当前对象, 使用组合键 control + v 去黏贴吧",duration:3}),this.clipBoard={feature:e,obj:t}):this.$Message.warning({content:"当前对象不可复制",duration:3})}},handlePasteObj(){const{feature:e,obj:t}=this.clipBoard;if(!e)return;const{shape:{points:s}}=e,{type:i,color:o,name:r,tags:l}=t,c="feature-"+Object(n["j"])(8),d=s.map(e=>({x:e.x+10,y:e.y+10})),u=this.addFeature(c,this.drawTypeMap[i],{points:d},{name:r},{color:o}),h=Object(a["find"])(this.toolsConfig,{name:r});this.addObject(u,l,h),this.selectFeature(c)},handleGroupObj(){const e=this.imageLabel.getActiveFeature();let t=[];if(this.selectFeatures.length>0)t=this.selectFeatures;else{if(!this.activeFeature||!e)return;t=[this.activeFeature]}if(t.length>0){const e="group-"+Object(n["j"])(8);t.forEach(t=>{const s=Object(a["findIndex"])(this.objects,{featureId:t.featureId});-1!==s&&(this.objects[s].group=e)}),this.activeFeature=null,this.$Message.success(`已将选中的${t.length}个元素进行分组`);let s=Object(a["findIndex"])(this.objects,{group:e});if(s)for(let t=0;t<this.objects.length;t++)if(this.objects[t].group===e&&t>s){const e=this.objects[t];this.objects.splice(t,1),this.objects.splice(s+1,0,e),s+=1}this.objects.forEach(e=>{this.setFeatureTip(e)})}},deleteSelectFeatures(){var e;const t=this.imageLabel.getActiveFeature();let s=[];if(this.selectFeatures.length>0)s=this.selectFeatures;else if(this.activeFeature&&t)s=[this.activeFeature];else{if(null===(e=this.objects)||void 0===e||!e.length)return;s=[this.objects[this.objects.length-1]]}s.length>0&&this.$Modal.confirm({title:"确定要删除？",content:`已选择${s.length}项`,onOk:()=>{s.forEach(e=>{this.deleteObj(e.featureId)}),this.activeFeature=null,this.selectFeatures=[],this.saveState()}})},changeObjectShow({featureId:e,type:t}){const s=this.imageLabel.getFeatureById(e),i="show"===t;s.setVisible(i),this.objDisplays[e]=s.visible},handleDrag(e){const t=this.objectItemMap.get(e);null!==t&&void 0!==t&&t.length&&t.forEach(e=>{this.setFeatureTip(e)})},lanuchViewer(){const e=new Es.a(this.screenShot,{title:!1,navbar:!1,viewed(){e.image.addEventListener("contextmenu",e=>{e.preventDefault()})},play(){e.player.addEventListener("contextmenu",e=>{e.preventDefault()})},hidden(){e.destroy()}});e.show()},removeFeaturesSelect(){this.selectFeatures.forEach(e=>{e.setSelectAttr("remove")}),this.selectFeatures=[]}}},Qg=Ug,Jg=(s("1f41"),Object(S["a"])(Qg,_m,Im,!1,null,"487dca2b",null)),Gg=Jg.exports,Kg=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("div",[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")]),e.objects.length?s("span",[e._v("（"+e._s(e.objects.length)+"）")]):e._e()],1),s("div",[s("a",{staticClass:"mlm",on:{click:function(t){return e.changeAllShow("show")}}},[s("small",[e._v("显示全部(ctrl+s)")])]),s("a",{staticClass:"mlm",on:{click:function(t){return e.changeAllShow("hidden")}}},[s("small",[e._v("隐藏全部(ctrl+d)")])])])])],1),s("div",{staticClass:"z-stage__objects"},[e.objectsGroup.length>0?s("CellGroup",[s("draggable",{attrs:{list:e.objectsGroup},on:{end:e.handleDrag}},e._l(e.objectsGroup,(function(t){return s("div",{attrs:{id:(e.$optimus.$attrs.name||"")+"_"+t.id,name:t.name}},[t&&t.group?s("Cell",{key:t.id,staticStyle:{"border-top":"1px solid #eee","border-bottom":"1px solid #eee"},attrs:{selected:e.activeObjects.includes(t.group)}},[s("Collapse",{staticClass:"objects-group",attrs:{value:t.id,simple:""}},[s("Panel",{attrs:{name:t.id},scopedSlots:e._u([{key:"content",fn:function(){return[s("CellGroup",[s("draggable",{attrs:{list:t.objects},on:{end:function(s){return e.handleDrag(s,t.id)}}},e._l(t.objects,(function(i){return s("Cell",{key:i.featureId,staticClass:"group-item",attrs:{id:(e.$optimus.$attrs.name||"")+"_"+i.id,name:i.name,selected:e.activeObjects.includes(i.featureId)||e.activeObjects.includes(t.group)},nativeOn:{click:function(t){return e.selectObject(t,i.featureId)},dblclick:function(t){return t.stopPropagation(),e.editObject(i.featureId)}}},[s("div",{staticClass:"title"},[e.isShowElementIndex?s("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getIndex(i.featureId)))]):e._e(),i.color?s("div",{staticClass:"color",style:{backgroundColor:i.color}}):e._e(),s("div",{staticClass:"ellipsis"},[s("span",[e._v(e._s(e.getLabel(i)))]),s("span",{class:e.getLocalVal(t).hilight?"hilightText":""},[e._v(e._s(e.getLocalVal(i).text))])])]),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:"",content:"移出组"}},[s("Button",{attrs:{icon:"ios-log-out",disabled:e.$optimus.disabled},on:{click:function(t){return t.stopPropagation(),e.moveOutGroup(i.featureId)}}})],1),s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(i,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline"},on:{click:function(t){return t.stopPropagation(),e.editObject(i.featureId)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(t){return t.stopPropagation(),e.removeObject(i.featureId)}}}),e.objDisplays[i.featureId]?s("Button",{attrs:{icon:"ios-eye-off-outline"},on:{click:function(t){return t.stopPropagation(),e.changeShow(i.featureId,"hidden")}}}):s("Button",{attrs:{icon:"ios-eye-outline",disabled:!e.groupDisplays[t.id]},on:{click:function(t){return t.stopPropagation(),e.changeShow(i.featureId,"show")}}})],1)],2)})),1)],1)]},proxy:!0}],null,!0)},[s("div",{staticClass:"group-title",on:{click:function(s){return s.stopPropagation(),e.handleSelectGroup(s,t.id)}}},[s("Row",{attrs:{type:"flex",justify:"space-between",align:"top"}},[s("span",[e._v(e._s(e.getGroupLabel(t))+"（"+e._s(e.getLabel(t.objects[0]))+"）")]),s("div",[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:"",content:"解散组"}},[s("Button",{attrs:{icon:"md-link",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.disbandGroup(t.id)}}})],1),e.groupDisplays[t.id]?s("Button",{attrs:{icon:"ios-eye-off-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.changeGroupShow(t.id,"hidden")}}}):s("Button",{attrs:{icon:"ios-eye-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.changeGroupShow(t.id,"show")}}})],1)])],1)])],1)],1):e._e(),t&&!t.group?s("Cell",{key:t.featureId,attrs:{id:(e.$optimus.$attrs.name||"")+"_"+t.id,name:t.name,selected:e.activeObjects.includes(t.featureId)},nativeOn:{click:function(s){return e.selectObject(s,t.featureId)},dblclick:function(s){return s.stopPropagation(),e.editObject(t.featureId)}}},[s("div",{staticClass:"title"},[e.isShowElementIndex?s("span",{staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.getIndex(t.featureId)))]):e._e(),t.color?s("div",{staticClass:"color",style:{backgroundColor:t.color}}):e._e(),s("div",{staticClass:"ellipsis"},[s("span",[e._v(e._s(e.getLabel(t)))]),s("span",{class:e.getLocalVal(t).hilight?"hilightText":""},[e._v(e._s(e.getLocalVal(t).text))])])]),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"info-tooltip-content"},[e._v(e._s(JSON.stringify(t,null,"\t")))])]},proxy:!0}],null,!0)},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline"},on:{click:function(s){return s.stopPropagation(),e.editObject(t.featureId)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t.featureId)}}}),e.objDisplays[t.featureId]?s("Button",{attrs:{icon:"ios-eye-off-outline"},on:{click:function(s){return s.stopPropagation(),e.changeShow(t.featureId,"hidden")}}}):s("Button",{attrs:{icon:"ios-eye-outline"},on:{click:function(s){return s.stopPropagation(),e.changeShow(t.featureId,"show")}}})],1)],2):e._e()],1)})),0)],1):e._e()],1)])},Yg=[],Zg={components:{draggable:ls.a},mixins:[Re["a"]],props:{objDisplays:{type:Object,default:()=>({})},isShowElementIndex:{type:Boolean,default:!1}},data(){const{objects:e,answer:t}=this.$optimus;return{answer:t,activeObjects:[],objects:e,groupDisplays:{}}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]=t.label}),e},objectsGroup(){const e=[];return this.objects.forEach(t=>{if(!t.group)return void e.push({...t,id:t.featureId});const s=e.find(e=>e.id===t.group);s?s.objects.push({...t,id:t.featureId}):e.push({id:t.group,group:t.group,objects:[{...t,id:t.featureId}]})}),e},isAllShow(){let e=!0;return this.objects.forEach(t=>{this.objDisplays[t.featureId]||(e=!1)}),e}},watch:{objects(){this.$optimus.objects=this.objects},objectsGroup(e){Object(a["forEach"])(e,e=>{e.group&&!Object.hasOwn(this.groupDisplays,e.group)&&this.$set(this.groupDisplays,e.group,!0)})}},mounted(){this.$optimus.getObjectLabel=this.getObjectLabel,Object(a["forEach"])(this.objects,(e,t)=>{Object.hasOwn(e,"group")?e.group&&!Object.hasOwn(this.groupDisplays,e.group)&&this.$set(this.groupDisplays,e.group,!0):this.objects[t].group=""})},methods:{getObjectLabel(e){return`${this.getLabel(e)}${this.getLocalVal(e)}${this.getLocalVal(e)?"）":""}`},getLabel(e){const{name:t,featureId:s}=e,i=this.objects.filter(e=>e.name===t),a=i.findIndex(e=>s&&e.featureId&&e.featureId===s)+1;return`${this.toolLabelMap[t]}-${a}`},getGroupLabel(e){const t=this.objectsGroup.filter(e=>e.id.includes("group")),s=t.findIndex(t=>t.id===e.id)+1;return"组-"+s},getIndex(e){return Object(a["findIndex"])(this.objects,{featureId:e})+1},getLocalVal(e){var t,s,i,o,n;let r="",l=!1;try{this.componentConfig.items.map(t=>{const s=Object(a["find"])(e.tags,{name:t.attributes.name});if(s&&(t.attributes.reference===e.name||"all"===t.attributes.reference)){if(Object(a["isString"])(s.value)&&s.value)return r+=`${r?"|":""}${s.value}`,!0;if(Object(a["isArray"])(s.value)&&s.value.length>0&&s.value.every(e=>"string"===typeof e))return r+=`${r?"|":""}${s.value.join(",")}`,!0}return!1})}catch(c){console.log(c)}return null===this||void 0===this||null===(t=this.answer)||void 0===t||null===(s=t.tags[0])||void 0===s||!s.value||null!==this&&void 0!==this&&null!==(i=this.answer)&&void 0!==i&&null!==(o=i.tags[0])&&void 0!==o&&null!==(n=o.value)&&void 0!==n&&n.includes(r)||(l=!0),{text:r?`（${r}）`:"",hilight:l}},handleDrag({oldIndex:e,newIndex:t},s){const i=this.objectsGroup.map(e=>e.group?e.objects:e);if(this.objects.splice(0,this.objects.length),this.objects.push(...i.flat()),s){const i=this.objects.filter(e=>e.group===s);i[e].name===i[t].name&&this.$optimus.$emit("optimus:image-stage:dragObj",i[t].name)}else this.objectsGroup[t].group?this.objectsGroup[t].objects.forEach(e=>{this.$optimus.$emit("optimus:image-stage:dragObj",e.name)}):this.$optimus.$emit("optimus:image-stage:dragObj",this.objectsGroup[t].name)},selectActiveObject(e){var t;this.activeObjects=[e];const s=`${this.$optimus.$attrs.name||""}_${this.activeObjects[0]||""}`;null===(t=document.getElementById(s))||void 0===t||t.scrollIntoViewIfNeeded()},multipleSelectObject(e){if(this.activeObjects.includes(e)){const t=e.startsWith("group")?this.objects.filter(t=>t.group===e).map(e=>e.featureId):null;this.activeObjects=this.activeObjects.filter(s=>t?s!==e&&!t.includes(s):s!==e)}else this.activeObjects.push(e)},selectByHotKey(e){if(0!==this.objects.length){if("next"===e){0===this.activeObjects.length&&(this.activeObjects=[this.objects[0].featureId]);const e=this.objects.findIndex(e=>e.featureId===this.activeObjects[0]),t=e+1;if(t>this.objects.length-1)return;const{featureId:s}=this.objects[t];this.selectObject(null,s)}if("prev"===e){if(0===this.activeObjects.length)return;const e=this.objects.findIndex(e=>e.featureId===this.activeObjects[0]),t=e-1;if(t<0)return;const{featureId:s}=this.objects[t];this.selectObject(null,s)}}},handleSelectGroup(e,t){const{shiftKey:s}=e;s?this.multipleSelectObject(t):this.activeObjects=[t],this.$emit("objects:select-object-group",this.activeObjects)},selectObject(e,t){const{shiftKey:s}=e;s?(this.multipleSelectObject(t),this.$emit("objects:select-object-group",this.activeObjects)):(this.activeObjects=[t],this.$emit("objects:select-object",t))},editObject(e){this.$emit("objects:edit-object",e)},changeShow(e,t){this.$emit("objects:change-object-show",{featureId:e,type:t})},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e,onOk:()=>{this.$emit("delete-object",e)}})},changeGroupShow(e,t){this.$set(this.groupDisplays,e,!("show"!==t)),this.objects.forEach(s=>{s.group===e&&this.changeShow(s.featureId,t)})},changeAllShow(e){this.objects.forEach(t=>{this.changeShow(t.featureId,e)})},moveOutGroup(e){this.$Modal.confirm({title:"确定要移出组？",content:e,onOk:()=>{const t=this.objects.findIndex(t=>t.featureId===e);t&&(this.objects[t].group="")}})},disbandGroup(e){this.$Modal.confirm({title:"确定要解散组？",content:"解散后，组内所有元素将移出组",onOk:()=>{this.objects.forEach((t,s)=>{t.group===e&&(this.objects[s].group="")})}})}}},Xg=Zg,eb=(s("0c36"),Object(S["a"])(Xg,Kg,Yg,!1,null,"6e852524",null)),tb=eb.exports,sb={label:"图片标注v2",icon:"ios-image-outline",name:"z-image-stage-v2",repeatable:!0,attributes:[{name:"src",label:"图片地址",value:"",vType:["url"]},{name:"videoSrc",label:"辅助视频地址",value:"",vType:["url"]},{name:"isWatermarkEnabled",label:"图片水印",component:"z-switch",type:Boolean,value:!0,attributes:{description:"关闭水印可能导致数据泄露无法追溯，请谨慎操作",openLabel:"开",closeLabel:"关"}},{name:"isShowElementIndex",label:"显示元素标签序号",component:"z-switch",type:Boolean,value:!1,attributes:{openLabel:"开",closeLabel:"关"}}],tools:[{type:"image/point",label:"点",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_point_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"标签大小",name:"labelPixel",type:String,component:"z-pixel-input",value:5},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]},{type:"image/rect",label:"方框",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_rect_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"边框大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}],helps:[]},{type:"image/polyline",label:"线段",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_polyline_${(new Date).getTime()}${Math.floor(100*Math.random())}`}},{label:"线段大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]},{type:"image/polygon",label:"多边形框",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_polygon_${(new Date).getTime()}${Math.floor(100*Math.random())}`}},{label:"边框大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}],helps:[]},{type:"image/pencilBrush",label:"笔刷",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_pencil_brush_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]}],hiddenItems:[{component:"z-input",attributes:{label:"imgMask",name:"imgMask",hidden:!0}}],shortCuts:[{label:"图片操作",attributes:[{name:["CTRL","+"],label:"图片放大",global:!0},{name:["CTRL","-"],label:"图片缩小",global:!0},{name:["Alt"],label:"长按移动",global:!0}]},{label:"绘制",attributes:[{name:["shift","标注对象"],label:"多选"},{name:["backspace"],label:"删除"},{name:["c"],label:"开关十字准线",global:!0},{name:["a"],label:"长按坐标点自动吸附",global:!0},{name:["q"],label:"显示/隐藏像素大小",global:!0},{name:["ctrl","标注对象"],label:"显示/隐藏标注对象像素大小",global:!0},{name:["Alt","鼠标滚轮"],label:"旋转方框"},{name:["CTRL","c"],label:"复制对象"},{name:["CTRL","v"],label:"黏贴对象"},{name:["CTRL","g"],label:"创建分组"},{name:["CTRL","s"],label:"显示全部元素"},{name:["CTRL","d"],label:"隐藏全部元素"}]},{label:"转写",attributes:[{name:["ALT","enter"],label:"下一个",global:!0},{name:["shift","enter"],label:"上一个",global:!0},{name:["enter"],label:"转写框编辑"},{name:["CTRL","enter"],label:"保存"},{name:["ALT","z"],label:"智能识别"},{name:["ALT","a"],label:"应用智能识别"}]}],objectAnswerJson:{description:"图片标注v2",type:"array",items:{type:"object",properties:{featureId:{type:"string"},type:{type:"string",enum:["image/point","image/rect","image/polyline","image/polygon"]},name:{type:"string",enum:[]},label:{description:"可选字段，工具对应的名称",type:"string"},color:{description:"可选字段，工具对应的颜色",type:"string"},tags:{description:"二级标签",type:"array",items:{anyOf:[]}},data:{description:"坐标集合",type:"array",items:{type:"object",properties:{x:{type:"number"},y:{type:"number"}},required:["x","y"]}}},allOf:[{if:{properties:{type:{const:"image/point"}}},then:{properties:{data:{minItems:1,maxItems:1}}}},{if:{properties:{type:{const:"image/rect"}}},then:{properties:{data:{minItems:4,maxItems:4}}}},{if:{properties:{type:{const:"image/polyline"}}},then:{properties:{data:{minItems:2}}}},{if:{properties:{type:{const:"image/polygon"}}},then:{properties:{data:{minItems:3}}}}],required:["featureId","type","name","label","color","data","tags"]}}},ib={metadata:sb,components:{BaseLayout:Lp,ImageAnnotation:Gg,ImageObjects:tb,videoPreview:na},mixins:[Re["a"]],props:{src:String,videoSrc:String,isWatermarkEnabled:{type:Boolean,default:!0},isShowElementIndex:Boolean},data(){return{objDisplays:{},splitValue:"200px",videoHeight:200}},methods:{selectFeature(e){this.$nextTick(()=>{var t;null===(t=this.$refs.imageObjects)||void 0===t||t.selectActiveObject(e)})},selectObjByHotKey(e){this.$nextTick(()=>{this.$refs.imageObjects.selectByHotKey(e)})},selectObject(e){this.$refs.imageAnnotation.selectFeature(e)},selectObjectGroup(e){this.$refs.imageAnnotation.selectFeatureGroup(e)},editObject(e){this.$refs.imageAnnotation.editFeature(e)},changeObjectShowByImage(e){this.objDisplays=e},changeObjectShowByObjects(e){this.$refs.imageAnnotation.changeObjectShow(e)},deleteObject(e){this.$refs.imageAnnotation.deleteObj(e)},getCurrentHeight(e){"enlarge"===e?this.videoHeight=500:"reduce"===e&&(this.videoHeight=200),this.$nextTick(()=>{this.splitValue=this.videoHeight+"px"})}}},ab=ib,ob=(s("ea17"),Object(S["a"])(ab,Am,Sm,!1,null,"9399cc04",null)),nb=ob.exports,rb=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[s("image-ocr-annotation",{ref:"imageOcrAnnotation",attrs:{src:e.src,direction:e.direction,$renderedComponentConfig:e.$renderedComponentConfig},on:{"image:change-object-show":e.changeObjectShowByImage,"image:select-object":e.selectObjByImage,"hot-key:select":e.selectObjByHotKey}})]},proxy:!0},{key:"objects",fn:function(){return[s("image-ocr-objects",{ref:"imageOcrObjects",attrs:{objDisplays:e.objDisplays,$renderedComponentConfig:e.$renderedComponentConfig},on:{"objects:select-object":e.selectObjByObjects,"objects:change-object-show":e.changeObjectShowByObjects,"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},lb=[],cb=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"z-image-ocr"},[i("Row",[i("Col",{staticClass:"header-menu",attrs:{span:"24"}},[i("ul",{staticClass:"header-tools"},[i("li",{on:{click:e.switchCross}},[i("img",{attrs:{src:s("a457")}}),i("div",{staticClass:"label"},[e._v("十字准线("+e._s("isOpen"===e.crossOn?"开":"关")+")")])]),"isTrue"===e.isHideLabel?i("li",{on:{click:e.setChangeShow}},[i("img",{attrs:{src:s("4ea8")}}),i("div",{staticClass:"label"},[e._v("工具名称(隐藏)")])]):i("li",{on:{click:e.setChangeShow}},[i("img",{attrs:{src:s("dc9f")}}),i("div",{staticClass:"label"},[e._v("工具名称(展示)")])]),e.pointOn?i("li",{on:{click:e.switchPointOn}},[i("img",{attrs:{src:s("9abe")}}),i("div",{staticClass:"label"},[e._v("坐标顺序(显示)")])]):e._e(),e.pointOn?e._e():i("li",{on:{click:e.switchPointOn}},[i("img",{attrs:{src:s("88b7")}}),i("div",{staticClass:"label"},[e._v("坐标顺序(隐藏)")])]),i("li",{on:{click:e.switchZoomType}},[i("img",{attrs:{src:s("028d")}}),i("div",{staticClass:"label"},[e._v(e._s("scaleDown"===e.displayMode?"自适应":"cover"===e.displayMode?"铺满":"原图"))])]),i("li",{on:{click:e.centerWorkspace}},[i("img",{attrs:{src:s("b5ef")}}),i("div",{staticClass:"label"},[e._v("居中")])]),i("li",{on:{click:e.switchGrid}},[i("img",{attrs:{src:s("64bd")}}),i("div",{staticClass:"label"},[e._v("网格("+e._s(e.gridOn?"开":"关")+")")])]),i("li",{class:{selected:"pan"===e.mode},on:{click:e.setMode}},[i("img",{attrs:{src:s("44cc")}}),i("div",{staticClass:"label"},[e._v("移动")])])])])],1),i("Row",{staticStyle:{flex:"1","flex-wrap":"nowrap",overflow:"hidden"}},[i("Col",{staticClass:"side-menu",attrs:{flex:"200px"}},[i("div",{staticClass:"menu-title"},[e._v("标注工具")]),e._l(e.toolsConfig,(function(t){return i("div",{key:t.name,staticClass:"tool",class:{selected:"pan"!==e.mode&&e.currentTool&&e.currentTool.name===t.name},on:{click:function(s){return e.setDrawTool(t)}}},["image/rect_ocr"===t.type?i("div",{staticClass:"prefixRect",style:{borderColor:t.color}}):e._e(),"image/polygon"===t.type?i("div",{staticClass:"prefixPolygon",style:{borderColor:t.color}},[i("div",{staticClass:"item"})]):e._e(),i("Tooltip",{directives:[{name:"showTip",rawName:"v-showTip",value:t.name,expression:"tool.name"}],staticClass:"contentCls",attrs:{theme:"light",disabled:e.tipDisabledMap[t.name],transfer:"",content:t.label}},[i("span",[e._v(e._s(t.label))])])],1)}))],2),i("Col",{staticClass:"label-workspcae",attrs:{flex:"auto"}},[i("canvas",{ref:"workspace"})])],1),i("modal",{attrs:{title:e.markModalTitle,draggable:!0,"reset-drag-position":!0,mask:!1},on:{"on-cancel":e.cancelMark},model:{value:e.showMarkModal,callback:function(t){e.showMarkModal=t},expression:"showMarkModal"}},[i("div",{staticClass:"modal-content"},[i("div",{staticClass:"screenShot",staticStyle:{display:"flex","justify-content":"center"}},[i("canvas",{ref:"formContent",attrs:{width:"200",height:"200"}})]),[e.showMarkModal?i("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,objectContext:e.objectContext,answer:e.objAnswer,disabled:e.$optimus.disabled}}):e._e()]],2),i("template",{slot:"footer"},[i("Button",{on:{click:e.cancelMark}},[e._v("取消")]),i("Button",{on:{click:e.confirmMark}},[e._v("确认")])],1)],2)],1)},db=[];const ub={distance:(e,t)=>{const{x:s,y:i}=e,{x:a,y:o}=t,n=s-a,r=i-o;return Math.sqrt(n*n+r*r)}};var hb=ub,pb={directives:{showTip:{inserted(e,t,s){const i=e.offsetWidth,{context:a}=s,{componentInstance:{$refs:{reference:{children:[o]}}}}=s;o.offsetWidth>i&&(a.tipDisabledMap[t.value]=!1)}}},mixins:[Re["a"]],props:{src:String},data(){let e=!1;const t=localStorage.getItem("optimus-image-ocr-stage-grid");t&&(e=JSON.parse(t));let s=!1;const i=localStorage.getItem("optimus-image-ocr-stage-pointOn");i&&(s=JSON.parse(i));const a=this.$renderedComponentConfig.$object_tools||[],o={};a.forEach(e=>{o[e.name]=!0});const n={default:"default",pan:"pointer",label:"crosshair",move:"move"};return{toolsConfig:a,tipDisabledMap:o,currentTool:null,cursorType:n,objAnswer:{},mode:"pan",tempPan:!1,crossOn:localStorage.getItem("optimus-image-ocr-stage-crossOn")||"isOpen",isHideLabel:localStorage.getItem("optimus-image-ocr-stage-isHideLabel")||"isFalse",displayMode:localStorage.getItem("optimus-image-ocr-stage-displayMode")||"origin",gridOn:e,pointOn:s,canvas:null,backImg:null,drawingLabel:null,showMarkModal:!1,markModalTitle:"OCR转写",clipboard:null,clip_board:{},curPointPosition:{},objects:this.$optimus.objects,tags:this.$optimus.tags,objectContext:{},markLable:null,activeObj:null,updateObj:null,newLabels:[],selectObjects:[],tipText:new Ml["fabric"].Text("",{isTip:!0,fontSize:15,selectable:!1,evented:!1}),polygonMsg:{pointArray:[],lineArray:[],line:{},activeShape:"",activeLine:"",curPoint:null},mouseDownLastTime:"",rectPointQueue:{tl:["tl","tr","br","bl"],tr:["tr","br","bl","tl"],bl:["bl","tl","tr","br"],br:["br","bl","tl","tr"]}}},computed:{toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]={label:t.label,color:t.color}}),e},componentConfig(){if(!this.currentTool)return{component:"z-form-stage",items:[]};const{name:e}=this.currentTool,t=this.$renderedComponentConfig.$object_items.filter(t=>{const{attributes:{reference:s}}=t;return!s||("all"===s||s===e)});return{component:"z-form-stage",items:t}}},watch:{mode(e){if(!this.canvas)return;const t=this.canvas.getObjects();"pan"===e?(this.canvas.defaultCursor=this.cursorType.pan,this.canvas.hoverCursor=this.cursorType.pan,t.forEach(e=>{e.set({hoverCursor:this.cursorType.pan})})):(this.canvas.defaultCursor=this.cursorType.label,this.canvas.hoverCursor=this.cursorType.label,t.forEach(e=>{e.set({hoverCursor:this.cursorType.label})})),"drawPolygon"===e&&(this.polygonMsg.pointArray=[],this.polygonMsg.lineArray=[])},tempPan(e){if(!this.canvas||"pan"===this.mode)return;const t=this.canvas.getObjects();e?(this.canvas.defaultCursor=this.cursorType.pan,this.canvas.hoverCursor=this.cursorType.pan,t.forEach(e=>{e.set({hoverCursor:this.cursorType.pan})})):(this.canvas.defaultCursor=this.cursorType.label,this.canvas.hoverCursor=this.cursorType.label,t.forEach(e=>{e.set({hoverCursor:this.cursorType.label})}))}},mounted(){this.$optimus.$on("optimus:img-stage:dragObj",e=>{this.handleDrag(e)});const e=this;this.$optimus.active&&document.addEventListener("keydown",this.listenKeyboardEvent),this.$optimus.active&&document.addEventListener("keyup",this.listenKeyUpEvent),this.customFabriControlsRender(),this.backImg=new Image,this.backImg.setAttribute("crossorigin","anonymous"),this.backImg.src=this.src,this.backImg.onerror=()=>{this.$Message.error("图片加载失败")},this.backImg.onload=()=>{const t=this.$refs.workspace.parentElement,{width:s,height:i}=window.getComputedStyle(t);this.canvas=new Ml["fabric"].Canvas(this.$refs.workspace,{defaultCursor:e.cursorType.pan,hoverCursor:e.cursorType.pan,selection:!1,fireRightClick:!0,stopContextMenu:!0,width:+s.replace("px",""),height:+i.replace("px","")});const o=new Ml["fabric"].Image(this.backImg,{selectable:!1});this.canvas.add(o),this.canvas.add(this.tipText),o.center(),this.initRenderConfig(),this.renderObjects(o),this.canvas.on("mouse:down",(function(t){const{e:s,absolutePointer:i,target:a}=t,{altKey:o,shiftKey:n}=s;if(1===t.button&&(("pan"===e.mode||o)&&(this.isDragging=!0,this.lastPosX=s.clientX,this.lastPosY=s.clientY),!e.$optimus.disabled)){const o=this.getActiveObject();if(!o&&this.lastActiveObject&&(this.lastActiveObject.hoverCursor="pan"===e.mode?e.cursorType.pan:e.cursorType.label,this.lastActiveObject=null),e.showMarkModal)return;const r=e.findTarget(s);if(n)e.multipleSelect(r);else{if(e.clearMultipleSelect(),null===a)return void e.$Message.warning("请在图片区域内进行标注");const s=(new Date).getTime();if(e.mouseDownLastTime&&s-e.mouseDownLastTime<500)return void(e.mouseDownLastTime=s);e.mouseDownLastTime=s,"drawRect"!==e.mode||o?"drawPolygon"!==e.mode||o||this.isDragging||(e.polygonMsg.pointArray.length>1&&t.target&&t.target.id===e.polygonMsg.pointArray[0].id?e.generatePolygon():e.addPoint(t)):(e.rectStartPoint=i,e.drawingLabel=new Ml["fabric"].Rect({left:e.rectStartPoint.x,top:e.rectStartPoint.y,fill:"rgba(100, 100, 255, 0.3)",stroke:"rgba(255, 255, 255, 0.3)",strokeWidth:1}),this.add(e.drawingLabel))}}if(2===t.button&&console.log("middle click"),3===t.button){const t=this.getActiveObject();t&&"polygon"===t.type&&e.handleMouseHoverPolygon(t,i,!0)}})),this.canvas.on("mouse:move",(function(t){const{e:s,absolutePointer:i,target:a}=t;if(e.curPointPosition=i,this.isDragging&&!this.lastActiveObject){const e=this.viewportTransform;return e[4]+=s.clientX-this.lastPosX,e[5]+=s.clientY-this.lastPosY,this.requestRenderAll(),this.lastPosX=s.clientX,void(this.lastPosY=s.clientY)}if(e.drawCrossLine(i,a),a&&a.isLabelElement?e.$optimus.disabled?!e.showMarkModal&&e.updateTipPosition("双击查看",i):a!==this.getActiveObject()?e.updateTipPosition("双击选择编辑",i):"polygon"===a.type&&e.handleMouseHoverPolygon(a,i,!1):e.updateTipPosition("",i),e.polygonDrawingTipText(a,i),"drawRect"===e.mode&&e.drawingLabel){const[{aCoords:{tl:t,br:s}}]=e.canvas.getObjects();let a=i.x,o=i.y;a<t.x?a=t.x:a>s.x&&(a=s.x),o<t.y?o=t.y:o>s.y&&(o=s.y);const n=Math.abs(e.rectStartPoint.x-a),r=Math.abs(e.rectStartPoint.y-o);e.drawingLabel.set({width:n,height:r,originX:e.rectStartPoint.x-a<0?"left":"right",originY:e.rectStartPoint.y-o<0?"top":"bottom"}),this.requestRenderAll()}else if("drawPolygon"===e.mode&&e.polygonMsg.pointArray.length>0&&(e.polygonMsg.curPoint=i,e.polygonMsg.activeLine&&"line"===e.polygonMsg.activeLine.class)){e.polygonMsg.activeLine.set({x2:i.x,y2:i.y});const t=e.polygonMsg.activeShape.get("points");t[t.length-1]={x:i.x,y:i.y,zIndex:1},e.polygonMsg.activeShape.set({points:t}),this.requestRenderAll()}})),this.canvas.on("mouse:up",(function(){this.isDragging&&(this.setViewportTransform(this.viewportTransform),this.isDragging=!1),"drawRect"===e.mode&&(e.drawingLabel&&e.drawingLabel.width>0&&e.drawingLabel.height>0&&e.drawingLabel.clone(t=>{const{originX:s,originY:i,width:o,height:r}=t,l=1,c=e.getStartPoint(s,i);t.set({width:o-l,height:r-l,featureId:"feature-"+Object(n["j"])(8),toolName:e.currentTool.name,startPoint:c,isLabelElement:!0,stroke:e.currentTool.color,borderColor:e.currentTool.color,fill:"rgba(0,0,0,0)",strokeWidth:e.currentTool.labelPixel||1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,selectable:!1}),this.add(t);const d=e.setPointDatas(t);t.set("pointDatas",d);const u=e.addTextFlag(t,t.featureId,e.currentTool.label,e.currentTool.name,e.currentTool.color,"image"),h=e.addPointTextFlag(t,t.featureId,e.currentTool.color);e.newLabels=Object(a["flatten"])([t,u,h]),this.setActiveObject(t),e.triggerMarkModal(t)}),e.drawingLabel&&this.remove(e.drawingLabel),e.drawingLabel=null,e.rectStartPoint=null)})),this.canvas.on("mouse:wheel",(function(t){const{e:{altKey:s,deltaY:i}}=t;if(s)e.handleRotateObject(i);else{let e=this.getZoom();e*=.999**i,e>20&&(e=20),e<.1&&(e=.1),this.zoomToPoint({x:t.e.offsetX,y:t.e.offsetY},e)}t.e.preventDefault(),t.e.stopPropagation()})),this.canvas.on("mouse:dblclick",(function(t){const{e:s,absolutePointer:i}=t;e.updateTipPosition("",i),"drawPolygon"===e.mode&&(1===e.polygonMsg.pointArray.length?(e.polygonMsg.pointArray.forEach(e=>{this.remove(e)}),e.polygonMsg.lineArray.forEach(e=>{this.remove(e)}),this.remove(e.polygonMsg.activeShape).remove(e.polygonMsg.activeLine),e.polygonMsg.pointArray=[],e.polygonMsg.lineArray=[],e.polygonMsg.activeShape=null,e.polygonMsg.activeLine=null):e.polygonMsg.pointArray.length>2&&(e.addPoint(t),e.generatePolygon()));const a=e.findTarget(s);a&&(a.hoverCursor=e.cursorType.move,!e.$optimus.disabled&&(this.lastActiveObject=a),e.selectObject(a.featureId))})),this.canvas.on("object:moving",e=>{const{target:t}=e;if(t.isLabelElement&&("rect"===t.type||"polygon"===t.type)){t.setCoords();let{left:e,top:s}=t;const i=t.getBoundingRect(!0),[{aCoords:{tl:a,br:o}}]=this.canvas.getObjects();(i.left<a.x||i.top<a.y)&&(i.left<a.x&&(e=e+a.x-i.left),i.top<a.y&&(s=s+a.y-i.top),t.set({left:e,top:s})),(i.left+i.width>o.x||i.top+i.height>o.y)&&(i.left+i.width>o.x&&(e-=i.left+i.width-o.x),i.top+i.height>o.y&&(s-=i.top+i.height-o.y),t.set({left:e,top:s}))}}),this.canvas.on("object:modified",t=>{const{target:s}=t;this.limitsScope(t),s.setCoords(),e.updateTextLabel(s),e.updatePointTextFlag(s),e.updateDatas(s.featureId,s)}),this.canvas.on("mouse:out",(function(t){const{target:s}=t;s&&s.isLabelElement&&s!==this.getActiveObject()&&e.updateTipPosition("",{x:0,y:0})}))}},destroy(){this.$optimus.active&&document.removeEventListener("keydown",this.listenKeyboardEvent),this.$optimus.active&&document.removeEventListener("keyup",this.listenKeyUpEvent)},methods:{listenKeyboardEvent:Object(a["throttle"])((function(e){const{target:t,code:s,ctrlKey:i,altKey:a,shiftKey:o}=e;if("Enter"===s){if(o){if(0===this.objects.length)return;return void this.$emit("hot-key:select","prev")}if(a){if(0===this.objects.length)return;return void this.$emit("hot-key:select","next")}if(this.showMarkModal&&!this.$optimus.disabled)if(i)this.confirmMark();else{const t=this.findOcrItem();t&&document.activeElement!==t.$refs.ocrInput.$refs.input&&(t.$refs.ocrInput.focus(),e.preventDefault())}}if(i&&("Equal"===s&&this.setZoomByHotKey("increase"),"Minus"===s&&this.setZoomByHotKey("reduce"),"KeyZ"!==s||this.$optimus.disabled||"drawPolygon"===this.mode&&this.polygonMsg.pointArray.length>0&&this.backoutPolygon()),!("INPUT"===t.tagName&&"checkbox"!==t.getAttribute("type")||"TEXTAREA"===t.tagName||t.getAttribute("contenteditable")))if("Backspace"!==s||this.$optimus.disabled||this.deleteSelectObjs(),i&&!this.$optimus.disabled)"KeyC"===s&&(e.preventDefault(),this.handleCopyObj()),"KeyV"===s&&(e.preventDefault(),this.handlePasteObj());else if(a&&!this.$optimus.disabled){if(this.tempPan=!0,"KeyZ"===s&&(e.preventDefault(),this.showMarkModal)){const e=this.findOcrItem();e&&e.handleFetchOcrResult()}if("KeyA"===s&&(e.preventDefault(),this.showMarkModal)){const e=this.findOcrItem();e&&e.applyOcrResult()}}else"KeyC"===s&&(this.switchCross(),this.drawCrossLine({},null))}),200),listenKeyUpEvent:Object(a["throttle"])((function(e){const{key:t}=e;"Alt"===t&&(this.tempPan=!1)}),200),handleCopyObj(){const e=this.canvas.getActiveObject();if(e){const t=Object(a["find"])(this.objects,{featureId:e.featureId});t&&(this.$Message.success({content:"成功复制当前对象, 使用组合键 control + v 去黏贴吧",duration:3}),this.clip_board={target:e,tags:t.tags},e.clone(e=>{this.clipboard=e}))}},handlePasteObj(){const{target:e,tags:t}=this.clip_board;if(!e||this.newLabels.length>0||this.polygonMsg.pointArray.length>0)return;const{startPoint:s,toolName:i,isLabelElement:a,stroke:o,borderColor:r,fill:l,strokeWidth:c}=e;this.currentTool&&this.currentTool.name===i||(this.currentTool=this.toolsConfig.find(e=>e.name===i),this.setDrawTool(this.currentTool,!0)),this.clipboard.setCoords();const{tl:{x:d,y:u}}=this.clipboard.aCoords;this.clipboard.clone(e=>{if(this.canvas.discardActiveObject(),e.set({left:e.left+(this.curPointPosition.x-d),top:e.top+(this.curPointPosition.y-u),evented:!0,startPoint:s,featureId:"feature-"+Object(n["j"])(8),toolName:i,isLabelElement:a,stroke:o,borderColor:r,fill:l,strokeWidth:c,selectable:!1}),e.setCoords(),"polygon"===e.type?(this.modifiedPolygon(e),e.set({hasBorders:!1,transparentCorners:!1,objectCaching:!1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,pointDatas:this.setPolygonDatas(e.curPoints)}),this.polygonCustomControl(e)):"rect"===e.type&&e.set("pointDatas",this.setPointDatas(e)),this.isOutOfImg(e))return void this.$Message.warning({content:"请在图片内黏贴对象"});this.canvas.add(e);const{label:h,name:p,color:m}=this.currentTool,g=this.addTextFlag(e,e.featureId,h,p,m,"image");this.canvas.add(g),this.showMarkModal=!1,this.canvas.setActiveObject(e),this.canvas.requestRenderAll(),this.addObject(e,t)})},findOcrItem(){const[e]=this.$refs.object.$children,{$refs:t,formRef:s}=e,i=t[s].$children;return i.find(e=>e.aiHelp&&"ocr"===e.aiHelp)},initRenderConfig(){this.gridOn=!this.gridOn,this.switchGrid(),"scaleDown"===this.displayMode?this.zoomToMaxWidthOrHeight():"cover"===this.displayMode?this.zoomToMaxWidth():this.originZoom()},polygonDrawingTipText(e,t){this.polygonMsg.pointArray.length>2?e.isPolygonStartPoint?(e.hoverCursor="default",this.updateTipPosition("点击闭合/ctrl+z 撤销",t)):this.updateTipPosition("双击闭合/ctrl+z 撤销",t):this.polygonMsg.pointArray.length>1?this.updateTipPosition("双击闭合/ctrl+z 撤销",t):1===this.polygonMsg.pointArray.length&&this.updateTipPosition("ctrl+z 撤销",t)},handleMouseHoverPolygon(e,t,s){let i=!1;const o=e.points.length;Object(a["forEach"])(e.curPoints,(a,n)=>{const r=hb.distance(a,t);if(r<=5){const a=o>3?"/右键删除":"";if(i=!0,this.updateTipPosition("按下拖动"+a,t),s&&o>3)return this.handleDeletePoint(e,n),!1}}),i||this.updateTipPosition("",t)},handleDeletePoint(e,t){this.$Modal.confirm({title:"确定要删除该点？",onOk:()=>{e.curPoints.splice(t,1),this.reRenderPolygon(e)}})},reRenderPolygon(e){this.canvas.remove(e);const{stroke:t,toolName:s,featureId:i}=e,o=new Ml["fabric"].Polygon(e.curPoints,{stroke:t,strokeWidth:1,fill:"rgba(255, 255, 255, 0)",opacity:1,hasBorders:!1,transparentCorners:!1,objectCaching:!1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,isLabelElement:!0,featureId:i,toolName:s,curPoints:Object(a["cloneDeep"])(e.curPoints),selectable:!1});this.canvas.add(o),this.tipText.set({text:""}),this.polygonMsg.pointArray.length>0&&(this.newLabels[0]=o),this.polygonCustomControl(o),this.canvas.setActiveObject(o),this.markLable=o,this.updateDatas(o.featureId,o),this.updateTextLabel(o),this.updatePointTextFlag(o)},addPoint(e){const{absolutePointer:t}=e,s=Math.floor(1e4*Math.random()),i=(new Date).getTime()+s,{color:o}=this.currentTool,n=new Ml["fabric"].Circle({id:i,left:t.x,top:t.y,originX:"center",originY:"center",fill:"#ffffff",stroke:"black",strokeWidth:1,radius:2,hasControls:!1,hasBorders:!1,selectable:!1,objectCaching:!1});0===this.polygonMsg.pointArray.length&&n.set({fill:o,isPolygonStartPoint:!0});const r=[t.x,t.y,t.x,t.y];if(this.polygonMsg.line=new Ml["fabric"].Line(r,{strokeWidth:2,fill:o,stroke:o,class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1}),this.polygonMsg.activeShape){const e=Object(a["last"])(this.polygonMsg.pointArray),s=Math.abs(e.getCenterPoint().x-t.x),i=Math.abs(e.getCenterPoint().y-t.y);if(s<3&&i<3)return;const n=this.polygonMsg.activeShape.get("points");n.push({x:t.x,y:t.y});const r=new Ml["fabric"].Polygon(n,{stroke:o,strokeWidth:1,fill:"rgba(100, 100, 255, 0.3)",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});this.canvas.remove(this.polygonMsg.activeShape),this.polygonMsg.activeShape=r,this.canvas.add(r)}else{const e=[{x:t.x,y:t.y},{x:t.x,y:t.y}],s=new Ml["fabric"].Polygon(e,{stroke:"#333333",strokeWidth:1,fill:"#cccccc",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});this.polygonMsg.activeShape=s,this.canvas.add(s)}this.polygonMsg.activeLine=this.polygonMsg.line,this.polygonMsg.pointArray.push(n),this.polygonMsg.lineArray.push(this.polygonMsg.line),this.canvas.add(this.polygonMsg.line),this.canvas.add(n)},backoutPolygon(){const{color:e}=this.currentTool,t=Object(a["last"])(this.polygonMsg.pointArray);if(this.canvas.remove(t).remove(this.polygonMsg.activeLine).remove(this.polygonMsg.activeShape),this.polygonMsg.pointArray.pop(),this.polygonMsg.lineArray.pop(),this.polygonMsg.lineArray.length>0&&(this.canvas.remove(Object(a["last"])(this.polygonMsg.lineArray)),this.polygonMsg.lineArray.pop()),this.polygonMsg.pointArray.length>0){const t=this.polygonMsg.activeShape.get("points");if(t.length>2?t.splice(-2,1):t.splice(0,1),t.length>0){this.polygonMsg.activeShape=new Ml["fabric"].Polygon(t,{stroke:e,strokeWidth:1,fill:"rgba(100, 100, 255, 0.3)",opacity:.3,selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1});const[s]=t.slice(-2,-1),i=[s.x,s.y,this.polygonMsg.curPoint.x,this.polygonMsg.curPoint.y];this.polygonMsg.activeLine=new Ml["fabric"].Line(i,{strokeWidth:2,fill:e,stroke:e,class:"line",originX:"center",originY:"center",selectable:!1,hasBorders:!1,hasControls:!1,evented:!1,objectCaching:!1}),this.polygonMsg.lineArray.push(this.polygonMsg.activeLine),this.canvas.add(this.polygonMsg.activeShape),this.canvas.add(this.polygonMsg.activeLine)}}else this.polygonMsg.activeShape=null;const s=this.polygonMsg.pointArray.length;let i;i=s>1?"双击闭合/ctrl+z 撤销":1===s?"ctrl+z 撤销":"",this.tipText.set({text:i}),this.canvas.requestRenderAll()},generatePolygon(){const e=[];this.polygonMsg.pointArray.forEach(t=>{e.push({x:t.left,y:t.top}),this.canvas.remove(t)}),this.polygonMsg.lineArray.forEach(e=>{this.canvas.remove(e)}),this.canvas.remove(this.polygonMsg.activeShape).remove(this.polygonMsg.activeLine);const t=new Ml["fabric"].Polygon(e,{stroke:this.currentTool.color,strokeWidth:this.currentTool.labelPixel||1,fill:"rgba(255, 255, 255, 0)",opacity:1,hasBorders:!1,transparentCorners:!1,objectCaching:!1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,isLabelElement:!0,featureId:"feature-"+Object(n["j"])(8),toolName:this.currentTool.name,curPoints:Object(a["cloneDeep"])(e),pointDatas:this.setPolygonDatas(e),selectable:!1});this.canvas.add(t);const s=this.addTextFlag(t,t.featureId,this.currentTool.label,this.currentTool.name,this.currentTool.color,"image"),i=this.addPointTextFlag(t,t.featureId,this.currentTool.color);this.newLabels=Object(a["flatten"])([t,s,i]),this.canvas.setActiveObject(t),this.triggerMarkModal(t),this.polygonMsg.activeLine=null,this.polygonMsg.activeShape=null,this.polygonMsg.pointArray=[],this.polygonMsg.lineArray=[],this.polygonCustomControl(t)},modifiedPolygon(e){const t=e.calcTransformMatrix(),s=e.get("points").map(t=>new Ml["fabric"].Point(t.x-e.pathOffset.x,t.y-e.pathOffset.y)).map(e=>Ml["fabric"].util.transformPoint(e,t));e.set("curPoints",s)},polygonCustomControl(e){function t(e,t,s){const i=s.points[this.pointIndex].x-s.pathOffset.x,a=s.points[this.pointIndex].y-s.pathOffset.y;return Ml["fabric"].util.transformPoint({x:i,y:a},Ml["fabric"].util.multiplyTransformMatrices(s.canvas.viewportTransform,s.calcTransformMatrix()))}function s(e,t,s,i){const a=t.target,o=a.controls[a.__corner],n=a.toLocalPoint(new Ml["fabric"].Point(s,i),"center","center"),r=a._getNonTransformedDimensions(),l=a._getTransformedDimensions(0,0);return a.points[o.pointIndex]={x:n.x*r.x/l.x+a.pathOffset.x,y:n.y*r.y/l.y+a.pathOffset.y},!0}function i(e,t){return function(s,i,a,o){const n=i.target,r=Ml["fabric"].util.transformPoint({x:n.points[e].x-n.pathOffset.x,y:n.points[e].y-n.pathOffset.y},n.calcTransformMatrix()),l=t(s,i,a,o);n._setPositionDimensions({});const c=n._getNonTransformedDimensions(),d=(n.points[e].x-n.pathOffset.x)/c.x,u=(n.points[e].y-n.pathOffset.y)/c.y;return n.setPositionByOrigin(r,d+.5,u+.5),l}}const a=e.points.length-1;e.controls=e.points.reduce((e,o,n)=>(e["p"+n]=new Ml["fabric"].Control({positionHandler:t,actionHandler:i(n>0?n-1:a,s),actionName:"modifyPolygon",pointIndex:n,cursorStyle:"pointer"}),e),{})},renderObjects(e){const{aCoords:{tl:t}}=e,{objects:s}=this;if(s&&s.length>0){for(let e=0;e<s.length;e++){const i=s[e],{type:o,color:n,name:r,featureId:l,data:c}=i;let d;switch(o){case"image/rect_ocr":{const{renderData:e,labelData:s}=c,[{x:i,y:a}]=s;d=new Ml["fabric"].Rect({...e,left:t.x+i,top:t.y+a,featureId:l,toolName:r,isLabelElement:!0,stroke:n,borderColor:n,fill:"rgba(0,0,0,0)",pointDatas:s,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,selectable:!1});break}case"image/polygon":{const{renderData:e,labelData:t}=c,s=this.setPolygonAbsolutePoint(t||c);d=new Ml["fabric"].Polygon(s,{...e,stroke:n,strokeWidth:(null===e||void 0===e?void 0:e.strokeWidth)||1,fill:"rgba(255, 255, 255, 0)",opacity:1,hasBorders:!1,transparentCorners:!1,objectCaching:!1,strokeUniform:!0,lockSkewingX:!0,lockSkewingY:!0,lockScalingFlip:!0,isLabelElement:!0,featureId:l,toolName:r,curPoints:Object(a["cloneDeep"])(s),pointDatas:t,selectable:!1}),this.polygonCustomControl(d);break}}this.canvas.add(d),this.addTextFlag(d,l,this.toolLabelMap[r].label,r,n,"objects"),["image/rect_ocr","image/polygon"].includes(o)&&this.addPointTextFlag(d,l,n)}this.updateDisplays()}},setChangeShow(){const e=this.canvas.getObjects().filter(e=>"text"===e.type&&e.isTextFlag);"isFalse"===this.isHideLabel?(this.isHideLabel="isTrue",e.forEach(e=>{e.set("text",""+e.labelIndex)})):(this.isHideLabel="isFalse",e.forEach(e=>{e.set("text",`${e.toolLabel}-${e.labelIndex}`)})),this.canvas.requestRenderAll(),localStorage.setItem("optimus-image-ocr-stage-isHideLabel",this.isHideLabel)},setMode(){this.mode="pan",this.currentTool=null,this.cancelMark()},setDrawTool(e,t){if(!e||this.$optimus.disabled||this.showMarkModal&&!t)return;const{type:s}=e;switch(s){case"image/rect_ocr":this.mode="drawRect";break;case"image/polygon":this.mode="drawPolygon";break}this.currentTool=e},centerWorkspace(){const e=this.canvas.getCenter(),t=this.canvas.getZoom();this.canvas.setViewportTransform(Ml["fabric"].iMatrix.concat()),this.canvas.zoomToPoint({x:e.left,y:e.top},t)},switchZoomType(){"scaleDown"===this.displayMode?(this.zoomToMaxWidth(),this.displayMode="cover"):"cover"===this.displayMode?(this.originZoom(),this.displayMode="none"):(this.zoomToMaxWidthOrHeight(),this.displayMode="scaleDown"),localStorage.setItem("optimus-image-ocr-stage-displayMode",this.displayMode)},setZoomByHotKey(e){const t=this.canvas.getCenter(),s=this.canvas.getZoom();"increase"===e&&this.canvas.zoomToPoint({x:t.left,y:t.top},s+.5),"reduce"===e&&this.canvas.zoomToPoint({x:t.left,y:t.top},s-.5)},originZoom(){this.canvas.setViewportTransform(Ml["fabric"].iMatrix.concat())},zoomToMaxWidthOrHeight(){const e=this.canvas.getCenter(),t=this.canvas.width/this.backImg.width,s=this.canvas.height/this.backImg.height;let i;i=t>1&&s>1?1:Math.min(t,s),this.canvas.setViewportTransform(Ml["fabric"].iMatrix.concat()),this.canvas.zoomToPoint({x:e.left,y:e.top},i)},zoomToMaxWidth(){const e=this.canvas.getCenter(),t=this.canvas.width/this.backImg.width;this.canvas.setViewportTransform(Ml["fabric"].iMatrix.concat()),this.canvas.zoomToPoint({x:e.left,y:e.top},t)},switchGrid(){if(this.gridOn){const e=this.canvas.getObjects().filter(e=>"grid"===e.id);e.forEach(e=>this.canvas.remove(e)),this.gridOn=!1}else{const e=4,[t]=this.canvas.getObjects(),{width:s,height:i,left:a,top:o}=t,n=[];for(let r=0;r<=e;r++){const t=new Ml["fabric"].Line([a,o+r*(i/e),a+s,o+r*(i/e)],{stroke:"#4d4e53",selectable:!1,id:"grid"}),l=new Ml["fabric"].Line([a+r*(s/e),o,a+r*(s/e),o+i],{stroke:"#4d4e53",selectable:!1,id:"grid"});this.canvas.add(t),this.canvas.add(l),n.push(t,l)}n.forEach(e=>{this.canvas.sendToBack(e)}),this.canvas.sendToBack(t),this.gridOn=!0}localStorage.setItem("optimus-image-ocr-stage-grid",this.gridOn)},switchCross(){"isOpen"===this.crossOn?this.crossOn="isClose":this.crossOn="isOpen",localStorage.setItem("optimus-image-ocr-stage-crossOn",this.crossOn)},switchPointOn(){this.pointOn=!this.pointOn;const e=this.canvas.getObjects().filter(e=>"text"===e.type&&e.isPointTextFlag);this.pointOn?e.forEach(e=>{e.set("text",""+e.pointText)}):e.forEach(e=>{e.set("text","")}),this.canvas.requestRenderAll(),localStorage.setItem("optimus-image-ocr-stage-pointOn",this.pointOn)},drawCrossLine({x:e,y:t},s){const i=this.canvas.getObjects().filter(e=>"crossLine"===e.id);if(i.forEach(e=>this.canvas.remove(e)),"isOpen"===this.crossOn&&s){const[s]=this.canvas.getObjects(),{width:i,height:a,left:o,top:n}=s,r=new Ml["fabric"].Line([o,t,o+i,t],{stroke:"#4d4e53",selectable:!1,id:"crossLine"}),l=new Ml["fabric"].Line([e,n,e,n+a],{stroke:"#4d4e53",selectable:!1,id:"crossLine"});this.canvas.add(r),this.canvas.add(l);const c=[r,l];c.forEach(e=>{this.canvas.sendToBack(e)}),this.canvas.sendToBack(s)}this.canvas.requestRenderAll()},updateTipPosition(e,t){this.tipText.set({text:e,left:t.x+5,top:t.y-5}),this.canvas.requestRenderAll()},handleRotateObject(e){const t=this.canvas.getActiveObject();if(!t||"rect"!==t.type)return;const s=Object(a["cloneDeep"])(t.angle-e/5);this.rotateLimitScope(t,s)||(t.rotate(s),t.setCoords(),this.updateTextLabel(t),this.updatePointTextFlag(t),this.updateDatas(t.featureId,t),this.canvas.requestRenderAll())},rotateLimitScope(e,t){const s=e.angle;return e.rotate(t),e.setCoords(),!!this.isOutOfImg(e)&&(e.rotate(s),!0)},isOutOfImg(e){const t=e.getBoundingRect(!0),[{aCoords:{tl:s,br:i}}]=this.canvas.getObjects();return t.left<s.x||t.top<s.y||t.left+t.width>i.x||t.top+t.height>i.y},limitsScope(e){const{target:t,transform:s}=e,{action:i,original:a}=s;if("polygon"===t.type){const e=t.getBoundingRect(!0),[{aCoords:{tl:s,br:o}}]=this.canvas.getObjects();if(e.left<s.x||e.top<s.y||e.left+e.width>o.x||e.top+e.height>o.y)return void("rotate"===i?t.set({left:a.left,top:a.top,angle:a.angle}):"modifyPolygon"===i&&this.reRenderPolygon(t));this.modifiedPolygon(t)}if(i.startsWith("scale")){const e=t.getBoundingRect(!0),[{aCoords:{tl:s,br:i}}]=this.canvas.getObjects();(e.left<s.x||e.top<s.y)&&t.set({left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY}),(e.left+e.width>i.x||e.top+e.height>i.y)&&t.set({left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY})}if("rotate"===i){const e=t.getBoundingRect(!0),[{aCoords:{tl:s,br:i}}]=this.canvas.getObjects();(e.left<s.x||e.top<s.y)&&t.set({left:a.left,top:a.top,angle:a.angle}),(e.left+e.width>i.x||e.top+e.height>i.y)&&t.set({left:a.left,top:a.top,angle:a.angle})}},findTarget(e){let t=null;const s=this.canvas.getPointer(e),i=this.canvas.getObjects(),a=i.filter(e=>e.isLabelElement&&e.containsPoint(s,null,!0));return 0===a.length||(a.length>1?t=a.reduce((e,t)=>{const i=e.getCenterPoint(),a=t.getCenterPoint(),o=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),n=Math.sqrt((a.x-s.x)**2+(a.y-s.y)**2);return o<n?e:t}):[t]=a),t},setSelectAttr(e,t){if("add"===t&&e.set({fill:"#f2f2f24d",stroke:"red"}),"remove"===t){const{toolName:t}=e;e.set({fill:"rgba(0,0,0,0)",stroke:this.toolLabelMap[t].color})}this.canvas.requestRenderAll()},multipleSelect(e){null!==e&&(this.selectObjects.includes(e)?(this.setSelectAttr(e,"remove"),Object(a["remove"])(this.selectObjects,e)):(this.setSelectAttr(e,"add"),this.selectObjects.push(e)))},clearMultipleSelect(){this.selectObjects.forEach(e=>{const{toolName:t}=e;e.set({fill:"rgba(0,0,0,0)",stroke:this.toolLabelMap[t].color})}),this.canvas.requestRenderAll(),this.selectObjects=[]},getStartPoint(e,t){let s="tl";return"left"===e&&(s="top"===t?"tl":"bl"),"right"===e&&(s="top"===t?"tr":"br"),s},customFabriControlsRender(){Ml["fabric"].Object.prototype.transparentCorners=!1,Ml["fabric"].Object.prototype.cornerColor="white",Ml["fabric"].Object.prototype.cornerStrokeColor="black",Ml["fabric"].Object.prototype.cornerStyle="circle",Ml["fabric"].Object.prototype.cornerSize=11;const{controls:e}=Ml["fabric"].Object.prototype;Object.keys(e).forEach(t=>{e[t].name=t}),Ml["fabric"].controlsUtils.renderCircleControl=function(e,t,s,i,a){i=i||{};const o=this.sizeX||i.cornerSize||a.cornerSize,n=this.sizeY||i.cornerSize||a.cornerSize,r="undefined"!==typeof i.transparentCorners?i.transparentCorners:a.transparentCorners,l=r?"stroke":"fill",c=!r&&(i.cornerStrokeColor||a.cornerStrokeColor);let d,u=t,h=s;e.save(),a.startPoint&&a.startPoint===this.name||0===this.pointIndex?e.fillStyle=a.startPointColor||"#2d8cf0":e.fillStyle=i.cornerColor||a.cornerColor,e.strokeStyle=i.cornerStrokeColor||a.cornerStrokeColor,o>n?(d=o,e.scale(1,n/o),h=s*o/n):n>o?(d=n,e.scale(o/n,1),u=t*n/o):d=o,e.lineWidth=1,e.beginPath(),e.arc(u,h,d/2,0,2*Math.PI,!1),e[l](),c&&e.stroke(),e.restore()}},setPointDatas(e){const{startPoint:t,aCoords:s}=e,[{aCoords:{tl:i}}]=this.canvas.getObjects();let o=[];const n={tl:{x:Object(a["round"])(s.tl.x-i.x,2),y:Object(a["round"])(s.tl.y-i.y,2)},tr:{x:Object(a["round"])(s.tr.x-i.x,2),y:Object(a["round"])(s.tr.y-i.y,2)},bl:{x:Object(a["round"])(s.bl.x-i.x,2),y:Object(a["round"])(s.bl.y-i.y,2)},br:{x:Object(a["round"])(s.br.x-i.x,2),y:Object(a["round"])(s.br.y-i.y,2)}};switch(t){case"tl":o=[n.tl,n.tr,n.br,n.bl];break;case"tr":o=[n.tr,n.br,n.bl,n.tl];break;case"bl":o=[n.bl,n.tl,n.tr,n.br];break;case"br":o=[n.br,n.bl,n.tl,n.tr];break}return o},setPolygonDatas(e){const[{aCoords:{tl:t}}]=this.canvas.getObjects();return e.map(e=>({x:Object(a["round"])(e.x-t.x,2),y:Object(a["round"])(e.y-t.y,2)}))},setPolygonAbsolutePoint(e){const[{aCoords:{tl:t}}]=this.canvas.getObjects();return e.map(e=>({x:Object(a["round"])(e.x+t.x,2),y:Object(a["round"])(e.y+t.y,2)}))},triggerMarkModal(e){this.showMarkModal=!0,this.markLable=e,this.drawScreenShot(e),this.updateObj=this.objects.find(t=>t.featureId===e.featureId),this.updateObj?this.objAnswer={tags:this.updateObj.tags}:this.objAnswer={}},getCoords(e,t,s){const{aCoords:{tl:i,tr:a,bl:o}}=t,n=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),r=Math.sqrt((a.x-s.x)**2+(a.y-s.y)**2),l=Math.sqrt((i.x-a.x)**2+(i.y-a.y)**2),c=(n+r+l)/2,d=Math.sqrt(Math.abs(c*(c-n)*(c-r)*(c-l))),u=2*d/l,h=Math.sqrt((i.x-s.x)**2+(i.y-s.y)**2),p=Math.sqrt((o.x-s.x)**2+(o.y-s.y)**2),m=Math.sqrt((i.x-o.x)**2+(i.y-o.y)**2),g=(h+p+m)/2,b=Math.sqrt(Math.abs(g*(g-h)*(g-p)*(g-m))),f=2*b/m;switch(e){case"tl":return{x:f,y:u};case"tr":return{x:u,y:Math.abs(l-f)};case"bl":return{x:Math.abs(o.y-i.y)-u,y:f};case"br":return{x:Math.abs(l-f),y:Math.abs(o.y-i.y)-u}}},updatePolygonPoints(e){const t=Object(a["cloneDeep"])(e.calcTransformMatrix()),s=e.getCenterPoint();if(!e.oldCenterPoint)return void e.set({screenShotPoints:e.points});const i=s.x-e.oldCenterPoint.x,o=s.y-e.oldCenterPoint.y;t[4]=i,t[5]=o,e.set({oldCenterPoint:s,transformMatrix:t})},setPolygonStartDir(e){const{curPoints:t}=e,[s]=t;if(e.startPoint="tl",4===t.length)s.x<t[2].x?s.x<t[1].x&&s.y<t[3].y||s.x<t[3].x&&s.y<t[1].y?e.startPoint="tl":(s.x<t[1].x&&s.y>t[3].y||s.x<t[3].x&&s.y>t[1].y)&&(e.startPoint="bl"):s.x>t[1].x&&s.y<t[3].y||s.x>t[3].x&&s.y<t[1].y?e.startPoint="tr":(s.y>t[1].y&&s.x>t[3].x||s.y>t[3].y&&s.x>t[1].x)&&(e.startPoint="br");else{const{aCoords:{tl:t,tr:i,bl:a}}=e,o=(t.x+i.x)/2,n=(t.y+a.y)/2;s.x<o&&s.y<n?e.startPoint="tl":s.x>o&&s.y<n?e.startPoint="tr":s.x<o&&s.y>n?e.startPoint="bl":s.x>o&&s.y>n&&(e.startPoint="br")}},drawScreenShot(e){e.setCoords();const t=e.getBoundingRect(!0),[{aCoords:{tl:s}}]=this.canvas.getObjects(),i=Math.abs(Object(a["round"])(t.left-s.x,2)),o=Math.abs(Object(a["round"])(t.top-s.y,2)),n=new Ml["fabric"].StaticCanvas(document.createElement("canvas"),{width:this.backImg.width,height:this.backImg.height}),r=new Ml["fabric"].Image(this.backImg,{cropX:i,cropY:o,angle:-e.angle,width:t.width,height:t.height});n.add(r),r.center();const l=r.getCenterPoint(),c=e.width*e.scaleX,d=e.height*e.scaleY,u=l.x-c/2,h=l.y-d/2;"polygon"===e.type&&(e.setCoords(),this.setPolygonStartDir(e));const p=new Ml["fabric"].StaticCanvas(this.$refs.formContent,{width:["tr","bl"].includes(e.startPoint)?d:c,height:["tr","bl"].includes(e.startPoint)?c:d});Ml["fabric"].Image.fromURL(n.toDataURL(),t=>{let s;switch(e.startPoint){case"tl":s=0;break;case"tr":s=-90;break;case"bl":s=90;break;case"br":s=180;break}if(t.set({cropX:u,cropY:h,width:c,height:d,angle:s}),p.add(t),t.center(),"polygon"===e.type){const t=e.curPoints.map(t=>this.getCoords(e.startPoint,e,t));p.clipPath=new Ml["fabric"].Polygon(t)}const i=p.toDataURL();p.add(t);const a=520,o=320;let n=1,r=1;p.width>a&&(n=a/p.width),p.height>o&&(r=o/p.height);const l=Math.min(n,r);p.setWidth(Math.min(a,p.width*l)),p.setHeight(Math.min(o,p.height*l)),p.setZoom(l),this.$set(this.objectContext,"imageStr",i)})},confirmMark(){if(this.$refs.object.validate(),this.$refs.object.isValid){const e=this.$refs.object.tags;this.updateObj?this.updateObj.tags=e:(this.addObject(this.markLable,e),this.newLabels=[]),this.updateObj=null,this.showMarkModal=!1,this.clearActiveObj()}else this.showMarkModal=!0},cancelMark(){this.updateObj||(this.newLabels.forEach(e=>this.canvas.remove(e)),this.newLabels=[]),this.updateObj=null,this.showMarkModal=!1,this.clearActiveObj()},clearActiveObj(){this.canvas&&this.canvas.getActiveObject()&&(this.canvas.getActiveObject().hoverCursor="pan"===this.mode?this.cursorType.pan:this.cursorType.label,this.canvas.discardActiveObject(),this.canvas.requestRenderAll())},selectObject(e){this.newLabels.length>0&&this.newLabels.every(t=>t.featureId!==e)&&(this.newLabels.forEach(e=>this.canvas.remove(e)),this.newLabels=[]);const t=this.canvas.getObjects(),s=t.find(t=>t.featureId===e&&t.isLabelElement),i=t.filter(t=>t.featureId===e);if(i.forEach(e=>{e.set("visible",!0)}),this.canvas.requestRenderAll(),!this.$optimus.disabled){const e=this.canvas.getActiveObject();e&&e!==s&&(e.hoverCursor="pan"===this.mode?this.cursorType.pan:this.cursorType.label),this.canvas.setActiveObject(s)}const a=this.objects.find(t=>t.featureId===e);a&&(this.$emit("image:select-object",a),this.activeObj=a,this.currentTool&&this.currentTool.name===a.name||(this.currentTool=this.toolsConfig.find(e=>e.name===a.name),this.setDrawTool(this.currentTool,!0))),this.triggerMarkModal(s),this.updateDisplays()},addObject(e,t){const{type:s,color:i,name:a,label:o}=this.currentTool;let n;("rect"===e.type||"polygon"===e.type)&&(n={renderData:this.setRenderData(e),labelData:e.pointDatas});const r={type:s,data:n,tags:t,featureId:e.featureId,color:i,name:a,label:o};this.objects.push(r),this.$nextTick(()=>{this.$emit("image:select-object",r),this.activeObj=r}),this.updateDisplays()},setRenderData(e){switch(e.type){case"rect":{const{startPoint:t,angle:s,originX:i,originY:a,width:o,height:n,scaleX:r,scaleY:l,strokeWidth:c}=e.toObject(["startPoint"]);return{startPoint:t,angle:s,originX:i,originY:a,width:o,height:n,scaleX:r,scaleY:l,strokeWidth:c}}case"polygon":{const{strokeWidth:t}=e.toObject(["startPoint"]);return{strokeWidth:t}}}},updateDatas(e,t){const s=this.objects.find(t=>t.featureId===e);let i=[];"rect"===t.type?(i=this.setPointDatas(t),s&&(s.data={renderData:this.setRenderData(t),labelData:i})):"polygon"===t.type&&(i=this.setPolygonDatas(t.curPoints),s&&(s.data={renderData:this.setRenderData(t),labelData:i})),t.set("pointDatas",i),this.showMarkModal&&this.drawScreenShot(t)},deleteObj(e){const t=this.canvas.getObjects(),s=t.filter(t=>t.featureId===e);s.forEach(e=>{this.canvas.remove(e)}),this.canvas.requestRenderAll();const i=this.objects.findIndex(t=>t.featureId===e),{name:a}=this.objects[i];this.objects.splice(i,1);const o=t.filter(e=>e.toolName===a&&"text"===e.type);o.forEach(e=>{this.setTextLabel(e,"image")}),this.updateDisplays(),this.showMarkModal&&(this.showMarkModal=!1)},deleteSelectObjs(){let e=[];this.selectObjects.length>0?e=this.selectObjects:this.activeObj&&(e=[this.activeObj]),e.length>0&&this.$Modal.confirm({title:"确定要删除？",content:`已选择${e.length}项`,onOk:()=>{e.forEach(e=>{this.deleteObj(e.featureId)}),this.activeObj=null,this.selectObjects=[]}})},changeObjectShow({featureId:e,type:t}){const s=this.canvas.getObjects(),i=this.canvas.getActiveObject(),o=s.filter(t=>t.featureId===e);"hidden"===t&&o.forEach(t=>{if(i===t&&this.canvas.discardActiveObject(),this.showMarkModal&&this.updateObj.featureId===e&&(this.showMarkModal=!1),t.isLabelElement){const t=this.selectObjects.find(t=>t.featureId===e);t&&(this.setSelectAttr(t,"remove"),Object(a["remove"])(this.selectObjects,t))}t.set("visible",!1)}),"show"===t&&o.forEach(e=>{e.set("visible",!0)}),this.canvas.requestRenderAll(),this.updateDisplays()},updateDisplays(){const e={};this.canvas.getObjects().forEach(t=>{e[t.featureId]=t.visible}),this.$emit("image:change-object-show",e)},addTextFlag(e,t,s,i,a,o){let n;"rect"===e.type?n=e.aCoords.tl:"polygon"===e.type&&([n]=e.curPoints);const r=new Ml["fabric"].Text("",{featureId:t,toolLabel:s,toolName:i,fontSize:15,fill:"#FFFFFF",backgroundColor:"#696c70",padding:3,opacity:.7,isTextFlag:!0,left:n.x,top:n.y-18,selectable:!1,evented:!1});return this.setTextLabel(r,o),this.canvas.add(r),r},addPointTextFlag(e,t,s){const{rectPointQueue:i}=this,{aCoords:a,startPoint:o,curPoints:n}=e,r=[],l={x:0,y:0};return"rect"===e.type?(i[o].forEach(e=>{l.x+=a[e].x,l.y+=a[e].y}),l.x/=i[o].length,l.y/=i[o].length,i[o].forEach((e,i)=>{const o=new Ml["fabric"].Text("",{featureId:t,fontSize:15,fill:s,text:this.pointOn?i.toString():"",pointText:i.toString(),isPointTextFlag:!0,left:a[e].x<l.x?a[e].x-8:a[e].x,top:a[e].y<l.y?a[e].y-16:a[e].y,selectable:!1,evented:!1});r.push(o),this.canvas.add(o)})):"polygon"===e.type&&(n.forEach(e=>{l.x+=e.x,l.y+=e.y}),l.x/=n.length,l.y/=n.length,n.forEach((e,i)=>{const a=new Ml["fabric"].Text("",{featureId:t,fontSize:15,fill:s,text:this.pointOn?i.toString():"",pointText:i.toString(),isPointTextFlag:!0,left:e.x<l.x?e.x-8:e.x,top:e.y<l.y?e.y-16:e.y,selectable:!1,evented:!1});r.push(a),this.canvas.add(a)})),r},handleDrag(e){const t=this.canvas.getObjects().filter(t=>t.toolName===e&&"text"===t.type);t.forEach(e=>{this.setTextLabel(e,"objects")}),this.canvas.requestRenderAll()},setTextLabel(e,t){const{toolName:s,toolLabel:i,featureId:a}=e;let o;if("image"===t){const e=this.canvas.getObjects().filter(e=>e.toolName===s&&e.isLabelElement);o=e.findIndex(e=>e.featureId===a)+1}if("objects"===t){const e=this.objects.filter(e=>e.name===s);o=e.findIndex(e=>e.featureId===a)+1}"isTrue"===this.isHideLabel?e.set({text:""+o,labelIndex:o}):e.set({text:`${i}-${o}`,labelIndex:o})},updateTextLabel(e){let t;const{angle:s}=e;"rect"===e.type?t=e.aCoords.tl:"polygon"===e.type&&([t]=e.curPoints);const{featureId:i}=e,[a]=this.canvas.getObjects().filter(e=>"text"===e.type&&e.featureId===i);a&&a.set({left:t.x+18*Math.sin(s*(Math.PI/180)),top:t.y-18*Math.cos(s*(Math.PI/180))})},updatePointTextFlag(e){const{rectPointQueue:t}=this,{featureId:s,aCoords:i,startPoint:a,curPoints:o}=e,n={x:0,y:0};"rect"===e.type?(t[a].forEach(e=>{n.x+=i[e].x,n.y+=i[e].y}),n.x/=t[a].length,n.y/=t[a].length,t[a].forEach((e,t)=>{const[a]=this.canvas.getObjects().filter(e=>"text"===e.type&&e.featureId===s&&e.pointText===t.toString());a&&a.set({left:i[e].x<n.x?i[e].x-8:i[e].x,top:i[e].y<n.y?i[e].y-16:i[e].y})})):"polygon"===e.type&&(o.forEach(e=>{n.x+=e.x,n.y+=e.y}),n.x/=o.length,n.y/=o.length,o.forEach((e,t)=>{const[i]=this.canvas.getObjects().filter(e=>"text"===e.type&&e.featureId===s&&e.pointText===t.toString());i&&i.set({left:e.x<n.x?e.x-8:e.x,top:e.y<n.y?e.y-16:e.y})}))}}},mb=pb,gb=(s("f8a4"),Object(S["a"])(mb,cb,db,!1,null,"276d08d6",null)),bb=gb.exports,fb=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.objects.length>0?s("CellGroup",[s("draggable",{attrs:{list:e.objects},on:{end:e.handleDrag}},e._l(e.objects,(function(t){return s("Cell",{key:t.featureId,attrs:{selected:e.activeItem===t.featureId,id:t.featureId,name:t.featureId},nativeOn:{click:function(s){return e.selectObject(t.featureId)}}},[s("div",{staticClass:"title"},[t.color?s("div",{staticClass:"color",style:{backgroundColor:t.color}}):e._e(),s("div",{staticClass:"feature-id"},[e._v(e._s(e.getLable(t)))]),e.getLocalVal(t)?[s("span",{staticClass:"ellipsis"},[e._v("（"+e._s(e.getLocalVal(t)))]),s("span",[e._v("）")])]:e._e()],2),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t.featureId)}}}),e.objDisplays[t.featureId]?s("Button",{attrs:{icon:"ios-eye-off-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.changeShow(t.featureId,"hidden")}}}):s("Button",{attrs:{icon:"ios-eye-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.changeShow(t.featureId,"show")}}})],1)],2)})),1)],1):e._e()],1)])},vb=[],yb={components:{draggable:ls.a},mixins:[Re["a"]],props:["objDisplays"],data(){const{objects:e}=this.$optimus;return{activeItem:null,objects:e}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]=t.label}),e}},methods:{getLable(e){const{name:t,featureId:s}=e,i=this.objects.filter(e=>e.name===t),a=i.findIndex(e=>e.featureId===s)+1;return`${this.toolLabelMap[t]}-${a}`},getLocalVal(e){let t="";return e.tags.some(e=>!!e.value&&(t=e.value,!0)),t},handleDrag({oldIndex:e,newIndex:t}){this.objects[e].name===this.objects[t].name&&this.$optimus.$emit("optimus:img-stage:dragObj",this.objects[t].name)},selectActiveObject(e){this.activeItem=e.featureId,document.getElementById(this.activeItem).scrollIntoViewIfNeeded()},selectByHotKey(e){if(0!==this.objects.length){if("next"===e){null===this.activeItem&&(this.activeItem=this.objects[0].featureId);const e=this.objects.findIndex(e=>e.featureId===this.activeItem),t=e+1;if(t>this.objects.length-1)return;const{featureId:s}=this.objects[t];this.selectObject(s)}if("prev"===e){if(null===this.activeItem)return;const e=this.objects.findIndex(e=>e.featureId===this.activeItem),t=e-1;if(t<0)return;const{featureId:s}=this.objects[t];this.selectObject(s)}}},selectObject(e){this.$emit("objects:select-object",e)},changeShow(e,t){this.$emit("objects:change-object-show",{featureId:e,type:t})},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e,onOk:()=>{this.$emit("delete-object",e)}})}}},wb=yb,xb=(s("cf02"),Object(S["a"])(wb,fb,vb,!1,null,"dd353642",null)),Cb=xb.exports,jb={label:"图片标注-OCR",icon:"ios-image-outline",name:"z-image-ocr-stage",repeatable:!0,attributes:[{name:"src",label:"图片地址",value:"",vType:["url"]}],tools:[{type:"image/rect_ocr",label:"OCR方框(含转写框)",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_rect_ocr_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"边框大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}],helps:[]},{type:"image/polygon",label:"不规则",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`image_polygon_${(new Date).getTime()}${Math.floor(100*Math.random())}`}},{label:"边框大小",name:"labelPixel",type:String,component:"z-pixel-input",value:1},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}],helps:[]}],shortCuts:[{label:"图片操作",attributes:[{name:["CTRL","+"],label:"图片放大",global:!0},{name:["CTRL","-"],label:"图片缩小",global:!0},{name:["Alt"],label:"长按移动",global:!0}]},{label:"绘制",attributes:[{name:["shift","标注对象"],label:"多选"},{name:["backspace"],label:"删除"},{name:["c"],label:"开关十字准线",global:!0},{name:["Alt","鼠标滚轮"],label:"旋转方框"},{name:["CTRL","c"],label:"复制对象"},{name:["CTRL","v"],label:"黏贴对象"}]},{label:"转写",attributes:[{name:["ALT","enter"],label:"下一个",global:!0},{name:["shift","enter"],label:"上一个",global:!0},{name:["enter"],label:"转写框编辑"},{name:["CTRL","enter"],label:"保存"},{name:["ALT","z"],label:"智能识别"},{name:["ALT","a"],label:"应用智能识别"}]}]},Ob={metadata:jb,components:{BaseLayout:Lp,ImageOcrAnnotation:bb,ImageOcrObjects:Cb},mixins:[Re["a"]],props:{src:String,direction:{type:[String,Array],default:"横向(从左到右)"}},data(){return{objDisplays:{}}},methods:{selectObjByImage(e){this.$nextTick(()=>{this.$refs.imageOcrObjects.selectActiveObject(e)})},selectObjByHotKey(e){this.$nextTick(()=>{this.$refs.imageOcrObjects.selectByHotKey(e)})},selectObjByObjects(e){this.$refs.imageOcrAnnotation.selectObject(e)},changeObjectShowByImage(e){this.objDisplays=e},changeObjectShowByObjects(e){this.$refs.imageOcrAnnotation.changeObjectShow(e)},deleteObject(e){this.$refs.imageOcrAnnotation.deleteObj(e)}}},kb=Ob,Ab=Object(S["a"])(kb,rb,lb,!1,null,null,null),Sb=Ab.exports,_b=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{scopedSlots:e._u([{key:"component",fn:function(){return[s("ImageMultipleAnnotation",{attrs:{images:e.images,queryImages:e.queryImages,fileName:e.fileName,fileUrl:e.fileUrl,imgLists:e.imgLists}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Ib=[],$b={label:"图片批量标注(含辅助信息)",icon:"ios-image-outline",name:"z-image-multiple-stage",attributes:[{name:"images",label:"图片源(需包含file_name, file_url;增加group字段支持多组)",type:String,value:"",vType:["array","string"]},{name:"queryImages",label:"主图片源(需包含file_name, file_url;用于多组标注-主图参考)",type:String,value:"",vType:["array","string"]},{name:"fileUrl",label:"图片地址字段名",type:String,value:"file_url",vType:["string"]},{name:"fileName",label:"图片名称字段名",type:String,value:"file_name",vType:["string"]},{name:"imgLists",label:"选中图片列表字段名(输出字段)",type:String,value:"img_lists",vType:["string"]}],hiddenItems:[{component:"z-multiple-select",attributes:{label:"",name:"",type:Array,hidden:!0,required:!0,options:[]}}]},Mb=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("CheckboxGroup",{staticClass:"image-multiple-annotation",on:{"on-change":e.handleSelect},model:{value:e.$optimus.formData[e.imgLists],callback:function(t){e.$set(e.$optimus.formData,e.imgLists,t)},expression:"$optimus.formData[imgLists]"}},[e.myQueryImages.length>0?s("div",{staticClass:"query-image-lists"},[s("Button",{staticClass:"select-all-btn",attrs:{disabled:e.$optimus.disabled||0===e.myImages.length},on:{click:function(t){return e.selectAll(e.myQueryImages)}}},[e.isSelectAll.queryIsSelectAll?s("span",[e._v("取消全选")]):s("span",[e._v("全选")])]),s("div",{staticClass:"image-container"},e._l(e.myQueryImages,(function(t,i){return s("div",{staticClass:"image-item"},[s("div",{staticClass:"img-content",class:{MsgIsNull:e.isShowHelpeMsg[e.queryImgSrcString]}},[s("safeImage",{key:t[e.fileUrl],staticClass:"save-image",class:{isSelect:e.$optimus.formData[e.imgLists]&&-1!==e.$optimus.formData[e.imgLists].indexOf(t[e.fileName])},attrs:{src:t[e.fileUrl],width:200,height:200}}),s("Checkbox",{key:i,ref:i,refInFor:!0,staticClass:"img-checkbox",attrs:{label:t[e.fileName],disabled:e.$optimus.disabled}},[s("Tooltip",{staticClass:"img-tooltip",attrs:{"max-width":"200",content:t[e.fileName],placement:"bottom"}},[s("span",{staticClass:"name-box ellipsis"},[e._v(e._s(t[e.fileName]))])])],1)],1),e.isShowHelpeMsg[e.queryImgSrcString]?s("div",{staticClass:"help-msg"},[s("p",{staticClass:"title"},[s("Icon",{attrs:{type:"ios-bulb-outline"}}),s("span",[e._v("标注辅助信息")])],1),s("Divider"),s("div",{staticClass:"table-container"},[s("table",[s("tbody",e._l(e.helpMsgMap[e.queryImgSrcString],(function(i,a,o){return i?s("tr",[s("th",[e._v(e._s(a))]),s("td",[e._v(e._s(t[a]))])]):e._e()})),0)])])],1):e._e()])})),0)],1):e._e(),s("div",{staticClass:"image-group-container"},e._l(e.myImages,(function(t,i){return s("div",{staticClass:"image-group-item"},[s("Button",{staticClass:"select-all-btn",attrs:{disabled:e.$optimus.disabled||0===e.myImages.length},on:{click:function(s){return e.selectAll(t)}}},[e.isSelectAll[i+"IsSelectAll"]?s("span",[e._v("取消全选")]):s("span",[e._v("全选")])]),s("div",{staticClass:"image-container"},e._l(t,(function(t,i){return s("div",{staticClass:"image-item"},[s("div",{staticClass:"img-content",class:{MsgIsNull:e.isShowHelpeMsg[e.imgSrcString]}},[s("safeImage",{key:t[e.fileUrl],staticClass:"save-image",class:{isSelect:e.$optimus.formData[e.imgLists]&&-1!==e.$optimus.formData[e.imgLists].indexOf(t[e.fileName])},attrs:{src:t[e.fileUrl],width:200,height:200}}),s("Checkbox",{key:i,ref:i,refInFor:!0,staticClass:"img-checkbox",attrs:{label:t[e.fileName],disabled:e.$optimus.disabled}},[s("Tooltip",{staticClass:"img-tooltip",attrs:{"max-width":"200",content:t[e.fileName],placement:"bottom"}},[s("span",{staticClass:"name-box ellipsis"},[e._v(e._s(t[e.fileName]))])])],1)],1),e.isShowHelpeMsg[e.imgSrcString]?s("div",{staticClass:"help-msg"},[s("p",{staticClass:"title"},[s("Icon",{attrs:{type:"ios-bulb-outline"}}),s("span",[e._v("标注辅助信息")])],1),s("Divider"),s("div",{staticClass:"table-container"},[s("table",[s("tbody",e._l(e.helpMsgMap[e.imgSrcString],(function(i,a,o){return i?s("tr",[s("th",[e._v(e._s(a))]),s("td",[e._v(e._s(t[a]))])]):e._e()})),0)])])],1):e._e()])})),0)],1)})),0)])},Tb=[],Eb={components:{safeImage:Bs},mixins:[Re["a"]],props:{images:[Array,String],queryImages:[Array,String],fileName:{type:String},fileUrl:{type:String},imgLists:{type:String,default:"img_lists"}},data(){return{helpMsgMap:{},imgSrcString:"",queryImgSrcString:"",isShowHelpeMsg:{},isSelectAll:{queryIsSelectAll:!1}}},computed:{myImages(){const e=this.initImages(this.images),t={};return e.length>0&&!Object(a["head"])(e).group?t.group_1=e:Object(a["forEach"])(e,e=>{Object(a["has"])(t,e.group)?t[e.group].push(e):t[e.group]=[e]}),t},myQueryImages(){return this.initImages(this.queryImages)}},created(){this.$optimus.formData[this.imgLists]||this.$set(this.$optimus.formData,this.imgLists,[]);const{attributes:e}=this.$optimus.component;this.imgSrcString=e.images?e.images.slice(2,-1):"",this.queryImgSrcString=e.queryImages?e.queryImages.slice(2,-1):"",Object(a["forEach"])(this.$optimus.schema,e=>{if("array"===e.type){Object(a["has"])(this.helpMsgMap,e.key)||(this.helpMsgMap[e.key]={});const t=e.children?e.children:e.element_schema;t&&t.forEach(t=>{this.helpMsgMap[e.key][t.key]=t.display,this.imgSrcString===e.key&&t.display&&(this.isShowHelpeMsg[this.imgSrcString]=!0),this.queryImgSrcString===e.key&&t.display&&(this.isShowHelpeMsg[this.queryImgSrcString]=!0)})}})},methods:{initImages(e){if(!e)return[];let t=[];if(Object(a["isString"])(e)){if(""===e)return t;try{t=JSON.parse(e),t.some(e=>Object(a["isString"])(e))&&(t=t.map(e=>({[this.fileUrl]:e,[this.fileName]:e})))}catch(s){console.error("[images] images出错",{images:e})}}else try{t=e.map(e=>JSON.parse(e.value))}catch(s){console.error("[images] images出错",{images:e})}return t},handleSelect(){Object(a["forEach"])(this.myQueryImages,e=>{const t=Object(a["indexOf"])(this.$optimus.formData[this.imgLists],e[this.fileName]);if(-1===t)return this.isSelectAll.queryIsSelectAll=!1,!1;this.isSelectAll.queryIsSelectAll=!0}),Object(a["forIn"])(this.myImages,(e,t)=>{Object(a["forEach"])(e,e=>{const s=Object(a["indexOf"])(this.$optimus.formData[this.imgLists],e[this.fileName]);if(-1===s)return this.isSelectAll[t+"IsSelectAll"]=!1,!1;this.isSelectAll[t+"IsSelectAll"]=!0})})},selectAll(e){let t=0;e.forEach(e=>{const s=Object(a["indexOf"])(this.$optimus.formData[this.imgLists],e[this.fileName]);-1!==s&&(t+=1,this.$optimus.formData[this.imgLists].splice(s,1))}),t!==e.length&&e.forEach(e=>{this.$optimus.formData[this.imgLists].push(e[this.fileName])}),this.handleSelect()}}},Lb=Eb,Db=(s("234e"),Object(S["a"])(Lb,Mb,Tb,!1,null,"067cc0a7",null)),Pb=Db.exports,Bb={metadata:$b,components:{BaseLayout:Lp,ImageMultipleAnnotation:Pb},mixins:[Re["a"]],props:{images:[Array,String],queryImages:[Array,String],fileName:{type:String},fileUrl:{type:String},imgLists:{type:String,default:"img_lists"}}},Rb=Bb,zb=Object(S["a"])(Rb,_b,Ib,!1,null,"2cbacb40",null),Nb=zb.exports,Fb=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{scopedSlots:e._u([{key:"component",fn:function(){return[s("web-viewer",{attrs:{src:e.src||e.$optimus.context.url}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Vb=[],qb=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"web-viewer"},[s("div",{staticClass:"actions"},[s("a",{attrs:{href:e.src,target:"_blank"}},[s("Icon",{attrs:{type:"ios-link-outline"}}),s("span",{staticClass:"mls"},[e._v("新窗口打开")])],1)]),s("iframe",{attrs:{src:e.src}})])},Hb=[];const Wb=e=>Object(Ws["c"])({timeout:6e4,method:"post",url:"/api/helper/decryptWxLink",data:e}).then(e=>e).catch(e=>e);var Ub={props:{src:String},async mounted(){if(this.src&&this.src.includes("mp.weixin.qq.com")){var e,t,s;const i=await Wb({urls:[this.src]});this.src=null===(e=i.data)||void 0===e||null===(t=e.result)||void 0===t||null===(s=t.data)||void 0===s?void 0:s[0],this.$Message.error("此网页不支持嵌入，请在新窗口打开")}}},Qb=Ub,Jb=(s("6356"),Object(S["a"])(Qb,qb,Hb,!1,null,"e8813c8e",null)),Gb=Jb.exports,Kb={label:"网页标注",name:"z-information-flow-stage",repeatable:!0,attributes:[{name:"src",label:"网页地址",value:"${url}",vType:["url"]}]},Yb={metadata:Kb,components:{WebViewer:Gb,BaseLayout:Lp},mixins:[Re["a"]],props:{src:String}},Zb=Yb,Xb=Object(S["a"])(Zb,Fb,Vb,!1,null,null,null),ef=Xb.exports,tf=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{on:{"delete-object":e.deleteObject},scopedSlots:e._u([{key:"component",fn:function(){return[s("audio-annotation",{ref:"audioAnnotation",attrs:{src:e.src,$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},sf=[],af={metadata:pc,components:{BaseLayout:Lp,AudioAnnotation:ud},mixins:[Re["a"]],props:{src:String},methods:{deleteObject(e){this.$refs.audioAnnotation.$emit("delete-object",e)}}},of=af,nf=Object(S["a"])(of,tf,sf,!1,null,null,null),rf=nf.exports,lf=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0,showingStyle:{flex:"0 0 70%","min-height":"500px"}},scopedSlots:e._u([{key:"component",fn:function(){return[e.isComment?s("text-comment",{ref:"textComment",attrs:{text:e.text,fontFamily:e.fontFamily,currentObject:e.currentObject,defaultStringType:e.defaultStringType,markdownConfig:e.markdownConfig,textPageStepLength:e.textPageStepLength,$renderedComponentConfig:e.$renderedComponentConfig}}):s("text-annotation",{ref:"textAnnotation",attrs:{text:e.text,currentObject:e.currentObject,defaultStringType:e.defaultStringType,highlightKeywords:e.keywords,markdownConfig:e.markdownConfig,$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"objects",fn:function(){return[s("text-objects",{ref:"textObjects",attrs:{objects:e.$optimus.objects,fontFamily:e.fontFamily,currentObject:e.currentObject,$renderedComponentConfig:e.$renderedComponentConfig},on:{"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},cf=[],df=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.isEmpty(e.myObjects)?e._e():s("Collapse",{attrs:{value:e.openAll}},e._l(e.myObjects,(function(t,i){return s("Panel",{key:i,attrs:{name:i}},[e._v(e._s(t.label)+"("+e._s(t.objects.length)+")"),e._l(t.objects,(function(t,i){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.currentObject&&e.currentObject.featureId===t.featureId},attrs:{slot:"content",type:"flex",justify:"space-between",wrap:!1},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("Row",{attrs:{type:"flex",justify:"start",align:"middle",wrap:!1}},[t.color?s("div",{staticClass:"color",style:{backgroundColor:t.color}}):e._e(),s("div",{staticClass:"feature-title"},[s("span",[e._v(e._s(t.label)+e._s(i+1))])])]),s("Row",{staticClass:"feature-desc",attrs:{type:"flex",justify:"space-between",align:"middle",wrap:!1}},[s("Col",{staticClass:"sub",style:e.myFontFamily},[e._v(e._s(e.getText(t)))]),e.currentTool(t)&&e.currentTool(t)["wordCount"]?s("Col",{staticClass:"count"},[s("span",[e._v("字数："+e._s(e.getText(t).length))])]):e._e()],1)],1),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t,i)}}})],1)],1)}))],2)})),1)],1)])},uf=[],hf={mixins:[Re["a"]],props:{currentObject:{type:Object,default:null},fontFamily:{type:String,default:"默认字体"}},data(){const{objects:e}=this.$optimus;return{isEmpty:a["isEmpty"],objects:e,objectModal:{visible:!1,model:null},objectFormComponent:{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}}},computed:{myFontFamily(){return"默认字体"===this.fontFamily?{}:{fontFamily:J(this.fontFamily),fontSize:"20px"}},myObjects(){const e={};return this.objects.forEach(t=>{const{name:s,label:i}=t;e[t.name]?e[s].objects.push(t):e[s]={label:i,objects:[t]}}),e},openAll(){return Object.keys(this.myObjects).map(e=>e)},toolList(){var e;return null===(e=this.$renderedComponentConfig.$object_tools)||void 0===e?void 0:e.filter(e=>"text/ner"===(null===e||void 0===e?void 0:e.type))},currentTool(){return function(e){return this.toolList.find(t=>(null===t||void 0===t?void 0:t.name)===e.name)||{}}}},created(){this.objects.length>0&&this.selectObject(Object(a["head"])(this.objects))},mounted(){this.$optimus.disabled||document.addEventListener("keydown",this.listenKeyboardEvent)},destroy(){document.removeEventListener("keydown",this.listenKeyboardEvent)},methods:{getText(e){var t;return null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.text},editObject(e){this.selectObject(e),this.$optimus.$emit("optimus:text-stage:edit-object",e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e.featureId)}})},listenKeyboardEvent:Object(a["debounce"])((function(e){const{code:t,ctrlKey:s}=e;s&&"KeyD"===t&&this.deleteActiveObj()}),200),deleteActiveObj(){if(this.currentObject){const e=this.objects.find(e=>e.featureId===this.currentObject.featureId);this.removeObject(e)}},selectObject(e){this.$optimus.$emit("optimus:text-stage:selectObj",e)}}},pf=hf,mf=(s("91a7"),Object(S["a"])(pf,df,uf,!1,null,"77d52a81",null)),gf=mf.exports,bf={metadata:Dr,components:{TextAnnotation:Al,TextComment:nc,BaseLayout:Lp,TextObjects:gf},mixins:[Re["a"]],props:{text:{type:[String,Number]},fontFamily:{type:String},scene:{type:String,default:""},highlightKeywords:{type:Array,default:()=>[]},keywordHighlightRelation:{type:Array,default:()=>[]},markdownConfig:String,textPageStepLength:{type:Number,default:5e3}},data(){var e;const t=null===(e=this.$optimus.component.attributes)||void 0===e?void 0:e.text,s=t&&t.match(/^\${(.+)}$/);let i="text";if(s){const[,e]=s,t=e.replace("input.",""),a=this.$optimus.schema.find(e=>(console.log(e.key,t),e.key===t));i=null===a||void 0===a?void 0:a.string_type}return{currentObject:null,defaultStringType:i}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},isComment(){var e;return"批注"===this.scene||"批注"===(null===(e=this.$renderedComponentConfig.extra_attributes)||void 0===e?void 0:e.scene)&&this.$renderedComponentConfig.$object_tools.length>0},keywords(){return this.highlightKeywords.length?this.highlightKeywords:this.keywordHighlightRelation?this.keywordHighlightRelation.map(e=>({tagset:this.$optimus.context[e.tagset].map(e=>e.value),color:e.color})):[]}},mounted(){this.$optimus.$on("optimus:text-stage:selectObj",e=>{this.currentObject=e})},methods:{deleteObject(e){this.isComment?this.$refs.textComment.$emit("delete-object",e):this.$refs.textAnnotation.$emit("delete-object",e)}}},ff=bf,vf=Object(S["a"])(ff,lf,cf,!1,null,null,null),yf=vf.exports,wf=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showGlobalTag:!1},scopedSlots:e._u([{key:"component",fn:function(){return[s("div",{staticClass:"z-questionnaire-content"},[s("h2",{staticClass:"question-title"},[s("span",[e._v("题目名称: "+e._s(e.title))])])]),s("Form",{attrs:{"label-position":"top",model:e.$optimus.formData}},[e._t("default")],2)]},proxy:!0}],null,!0)})},xf=[],Cf={label:"问卷标注",name:"z-questionnaire-stage",attributes:[{name:"title",label:"问卷标题",value:""}]},jf={metadata:Cf,components:{BaseLayout:Lp},mixins:[Re["a"]],props:{title:{type:String}}},Of=jf,kf=(s("a1b2"),Object(S["a"])(Of,wf,xf,!1,null,"6bc36018",null)),Af=kf.exports,Sf=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showGlobalTag:!1},on:{"delete-object":e.deleteObject},scopedSlots:e._u([{key:"component",fn:function(){return[s("video-sort-annotation",{ref:"videoSortAnnotation",attrs:{name:e.name,videos:e.videos,orderingRule:e.orderingRule,orderingAttribute:e.orderingAttribute,$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},_f=[],If=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"z-video-sort-annotation"},[s("div",{staticClass:"question"},[s("h2",{staticClass:"title"},[e._v(e._s(e.historyIndex+1)+"、左边的视频"),e.$optimus.disabled?s("span",{staticClass:"left"},[e._v("("+e._s(e.videoArray[e.leftIndex]?e.videoArray[e.leftIndex].file_name:"")+")")]):e._e(),e._v(" 对比 右边的视频"),e.$optimus.disabled?s("span",{staticClass:"right"},[e._v("("+e._s(e.uniqueArray[e.rightIndex]?e.uniqueArray[e.rightIndex].file_name:"")+")")]):e._e(),e._v(":")]),s("Radio-group",{model:{value:e.choice,callback:function(t){e.choice=t},expression:"choice"}},[s("Radio",{staticClass:"radio",attrs:{label:">",disabled:e.disabledChoice||e.ended||e.$optimus.disabled}},[s("span",[e._v("左边的"+e._s(e.orderingAttribute)+"更好")])]),s("Radio",{staticClass:"radio",attrs:{label:"=",disabled:e.disabledChoice||e.ended||e.$optimus.disabled}},[s("span",[e._v("两边的"+e._s(e.orderingAttribute)+"一样好")])]),s("Radio",{staticClass:"radio",attrs:{label:"<",disabled:e.disabledChoice||e.ended||e.$optimus.disabled}},[s("span",[e._v("右边的"+e._s(e.orderingAttribute)+"更好")])])],1),s("div",{staticClass:"wrapper"},[s("p",[e._v("(共"+e._s(e.videoArray.length)+"个数据，已排序"+e._s(e.nowArray.length)+"个)")]),e.isAlter?e._e():s("Button",{attrs:{type:"primary",disabled:0===e.videoArray.length||e.ended||e.$optimus.disabled},on:{click:e.handleSort}},[e._v("确定，下一组")]),e.isAlter?s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.showModal}},[e._v("修改结果")]):e._e(),s("Modal",{attrs:{title:"警告！",closable:!1},on:{"on-ok":e.editResult},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[s("p",[e._v("修改当前结果将影响后续已排序数据，是否确定修改？")])]),s("Button",{on:{click:function(t){t.stopPropagation(),e.isShowRes=!0}}},[e._v("检查")])],1)],1),s("div",{staticClass:"contain"},[s("div",{staticClass:"toolBar"},[s("Button",{attrs:{type:"primary",loading:e.leftLoading||e.rightLoading},on:{click:e.play}},[e._v("播放")]),s("Button",{attrs:{loading:e.leftLoading||e.rightLoading},on:{click:e.pause}},[e._v("暂停")]),s("Button",{attrs:{loading:e.leftLoading||e.rightLoading},on:{click:e.replay}},[e._v("回放")]),s("Progress",{staticStyle:{width:"600px","margin-left":"30px"},attrs:{percent:e.videoPercent}},[s("span",[e._v(e._s(e.currentTime)+"/"+e._s(e.duration))])])],1),s("div",{staticClass:"content"},[s("div",{staticClass:"videoBar",on:{mousemove:e.move}},[s("div",{staticClass:"left",style:{width:e.leftWidth+"px"}},[s("video",{ref:"leftVideo",attrs:{src:e.videoArray[e.leftIndex]?e.videoArray[e.leftIndex].file_url:"",muted:"true",controlsList:"nodownload",oncontextmenu:"return false"},domProps:{muted:!0},on:{loadstart:function(t){return e.loadstart("leftLoading")},canplaythrough:function(t){return e.canplaythrough("leftLoading")},timeupdate:e.timeupdate}})]),s("div",{staticClass:"right"},[s("video",{ref:"rightVideo",attrs:{src:e.uniqueArray[e.rightIndex]?e.uniqueArray[e.rightIndex].file_url:"",muted:"true",controlsList:"nodownload",oncontextmenu:"return false"},domProps:{muted:!0},on:{loadstart:function(t){return e.loadstart("rightLoading")},canplaythrough:function(t){return e.canplaythrough("rightLoading")}}})]),e.leftLoading||e.rightLoading?s("Spin",{attrs:{size:"large",fix:""}},[s("Icon",{staticClass:"icon-load",attrs:{type:"ios-loading",size:"30"}}),e._v("视频加载中")],1):e._e()],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowRes,expression:"isShowRes"}],staticClass:"checkContent"},[s("Icon",{staticClass:"closeBtn",attrs:{type:"md-close"},on:{click:function(t){e.isShowRes=!1}}}),s("Tabs",[s("TabPane",{attrs:{label:"历史标注"}},e._l(e.historyChoice,(function(t,i){return s("div",{key:i,staticClass:"history center"},[s("Button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:t.btmType},on:{click:function(s){return e.rollback(t,i)}}},[e._v("第"+e._s(i+1)+"组")])],1)})),0),e.$optimus.disabled?s("TabPane",{attrs:{label:"当前排序"}},e._l(e.sortArray,(function(t,i){return s("p",{key:i,staticStyle:{display:"flex","justify-content":"space-between"}},[s("span",[e._v(e._s(t.index))]),s("span",[e._v(e._s(t.file_name))])])})),0):e._e()],1)],1)])])},$f=[],Mf={mixins:[Re["a"]],props:{name:String,videos:{type:[String,Array]},orderingRule:String,orderingAttribute:String},data(){return{orderingattribute:"",choice:"",isShowRes:!1,disabledChoice:!1,isAlter:!1,leftLoading:!0,rightLoading:!0,videoPercent:0,duration:"00:00:00",currentTime:"00:00:00",ended:!1,leftWidth:960,modal:!1,videoArray:[],nowArray:[],uniqueArray:[],leftIndex:1,rightIndex:0,left:0,right:0,historyChoice:[],historyIndex:0,lastChoice:{},isInit:!0,sortArray:[]}},computed:{},watch:{nowArray(){this.getSortArray()},historyChoice:{handler(){this.updateFormData()},deep:!0}},mounted(){const e=this;this.$optimus.$on("optimus:forms-stage:check",()=>{this.$optimus.$emit("optimus:optimus-engine:check",e.ended)})},created(){const e=this;this.updateFormData=Object(a["debounce"])(()=>{e.$optimus.formData[e.name]={historyChoice:e.historyChoice,lastChoice:e.lastChoice}},100),this.handleInit()},methods:{handleInit(){const{videos:e}=this;if("string"===typeof e)try{this.videoArray=JSON.parse(this.videos),console.log(this.videoArray)}catch(t){console.log("[video-sort]: invalid videos",this.videos)}if(this.videoArray.length>0&&this.nowArray.splice(0,0,this.videoArray[0]),this.uniqueArray=Object(a["cloneDeep"])(this.nowArray),this.right=this.uniqueArray.length,this.rightIndex=Math.floor((this.left+this.right)/2),this.isInit&&this.$optimus.formData[this.name]){const{historyChoice:e,lastChoice:t}=this.$optimus.formData[this.name];this.lastChoice=Object(a["cloneDeep"])(t),this.historyChoice=Object(a["cloneDeep"])(e);const s=this.historyChoice[e.length-1];this.uniqueArray=s.uniqueArray,this.nowArray=s.nowArray,this.choice=s.choice,this.left=s.left,this.leftIndex=s.leftIndex,this.right=s.right,this.rightIndex=s.rightIndex,this.historyIndex=this.historyChoice.length-1,this.ended=this.nowArray.length===this.videoArray.length,this.isInit=!1,this.ended&&(this.isAlter=!0),this.handleBtmType(s)}else this.getSortArray(),this.historyChoice.push({left:this.left,right:this.right,nowArray:Object(a["cloneDeep"])(this.nowArray),uniqueArray:Object(a["cloneDeep"])(this.uniqueArray),leftIndex:this.leftIndex,rightIndex:this.rightIndex,choice:"",btmType:"primary"})},move(e){this.leftWidth=e.offsetX},loadstart(e){this.videoPercent=0,this[e]=!0},canplaythrough(e){const t=this.$refs.leftVideo&&this.$refs.leftVideo.duration?parseInt(this.$refs.leftVideo.duration,10):0;this.duration=this.formatTime(t),this[e]=!1},timeupdate:Object(a["throttle"])((function(){const e=parseInt(this.$refs.leftVideo.currentTime,10),t=this.$refs.leftVideo?parseInt(this.$refs.leftVideo.duration,10):0;this.videoPercent=e/t*100,this.currentTime=this.formatTime(e)}),1e3),play(){this.$refs.leftVideo.play(),this.$refs.rightVideo.play()},pause(){this.$refs.leftVideo.pause(),this.$refs.rightVideo.pause()},replay(){this.pause(),this.$refs.leftVideo.currentTime=0,this.$refs.rightVideo.currentTime=0,this.videoPercent=0},getSortArray(){const e="升序"===this.orderingRule?[...this.uniqueArray]:[...this.uniqueArray].reverse(),t="升序"===this.orderingRule?[...this.nowArray]:[...this.nowArray].reverse();let s="升序"===this.orderingRule?0:1;const i=Object(a["map"])(t,(i,o)=>{let n;return"升序"===this.orderingRule?(Object(a["findIndex"])(t,e[0])===o&&(e.splice(0,1),s+=1),n=Object(a["cloneDeep"])(i),n.index=s):(n=Object(a["cloneDeep"])(i),n.index=s,Object(a["findIndex"])(t,e[0])===o&&(e.splice(0,1),s+=1)),n});this.sortArray=i},handleBtmType(e){Object(a["forEach"])(this.historyChoice,e=>{e.btmType="default"}),e.btmType="primary"},handleSort(){if(this.choice){let e=!1;if(">"===this.choice?this.left=this.rightIndex+1:"<"===this.choice?this.right=this.rightIndex:(this.left=this.rightIndex+1,e=!0),e||this.left===this.right){let t;e?t=Object(a["findIndex"])(this.nowArray,this.uniqueArray[this.rightIndex])+1:(t=this.uniqueArray[this.left]?Object(a["findIndex"])(this.nowArray,this.uniqueArray[this.left]):this.nowArray.length,this.uniqueArray.splice(this.left,0,this.videoArray[this.leftIndex])),this.nowArray.splice(t,0,this.videoArray[this.leftIndex]),this.leftIndex===this.videoArray.length-1?(this.ended=!0,this.isAlter=!0):this.leftIndex=this.leftIndex+1,this.right=this.uniqueArray.length,this.left=0}this.historyChoice.length&&(this.historyChoice[this.historyIndex].choice=this.choice),this.$nextTick(()=>{this.replay()}),this.ended?(this.lastChoice=Object(a["cloneDeep"])(this.historyChoice[this.historyChoice.length-1]),"<"===this.choice&&(this.rightIndex=this.rightIndex+1),this.historyChoice[this.historyIndex].nowArray=Object(a["cloneDeep"])(this.nowArray),this.historyChoice[this.historyIndex].rightIndex=this.rightIndex,this.historyChoice[this.historyIndex].uniqueArray=Object(a["cloneDeep"])(this.uniqueArray),this.historyChoice[this.historyIndex].left=this.left,this.historyChoice[this.historyIndex].right=this.right,this.$Message.success("全部数据已排序完成")):(this.choice="",this.rightIndex=Math.floor((this.left+this.right)/2),this.historyChoice.push({left:this.left,right:this.right,nowArray:Object(a["cloneDeep"])(this.nowArray),uniqueArray:Object(a["cloneDeep"])(this.uniqueArray),leftIndex:this.leftIndex,rightIndex:this.rightIndex,choice:this.choice,btmType:"primary"}),this.historyIndex=this.historyIndex+1,this.lastChoice={}),this.handleBtmType(this.historyChoice[this.historyChoice.length-1])}else this.$Message.warning("请选择答案再提交！")},rollback(e,t){e.choice?(this.disabledChoice=!0,this.isAlter=!0):(this.isAlter=!1,this.disabledChoice=!1),this.left=e.left,this.right=e.right,this.leftIndex=e.leftIndex,this.rightIndex=e.rightIndex,this.nowArray=e.nowArray.slice(),this.uniqueArray=e.uniqueArray.slice(),this.$nextTick(()=>{this.replay()}),this.choice=e.choice,this.historyIndex=t,this.handleBtmType(e)},showModal(){this.modal=!0},editResult(){this.choice&&(this.ended&&this.historyIndex===this.historyChoice.length-1&&(this.historyChoice[this.historyChoice.length-1]=Object(a["cloneDeep"])(this.lastChoice),this.left=this.lastChoice.left,this.right=this.lastChoice.right,this.nowArray=this.lastChoice.nowArray,this.uniqueArray=this.lastChoice.uniqueArray,this.leftIndex=this.lastChoice.leftIndex,this.rightIndex=this.lastChoice.rightIndex),this.lastChoice={},this.historyChoice.splice(this.historyIndex+1),this.historyChoice[this.historyIndex].choice="",this.disabledChoice=!1,this.isAlter=!1,this.modal=!1,this.ended=!1)},handleCloseRes(){this.isShowRes=!1},formatTime(e){let t;if(e>-1){const s=Math.floor(e/3600),i=Math.floor(e/60)%60,a=e%60;t=s<10?`0${s}:`:s+":",i<10&&(t+="0"),t+=i+":",a<10&&(t+="0"),t+=a}return t}}},Tf=Mf,Ef=(s("5605"),Object(S["a"])(Tf,If,$f,!1,null,null,null)),Lf=Ef.exports,Df={label:"视频排序标注",name:"z-video-sort-stage",disableGlobalTags:!0,attributes:[{name:"videos",label:"视频源(需要包含file_name, file_url)",value:[],type:Array,vType:["array","string"]},{name:"name",label:"输出字段标识",value:"",type:String},{name:"orderingRule",label:"排序规则",value:"升序",type:String},{name:"orderingAttribute",label:"排序属性",value:"",type:String}],tools:[]},Pf={metadata:Df,components:{BaseLayout:Lp,VideoSortAnnotation:Lf},mixins:[Re["a"]],props:{name:String,videos:{type:[String,Array]},orderingRule:String,orderingAttribute:String},methods:{deleteObject(e){this.$refs.videoSortAnnotation.$emit("delete-object",e)}}},Bf=Pf,Rf=Object(S["a"])(Bf,Sf,_f,!1,null,null,null),zf=Rf.exports,Nf=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showGlobalTag:!1},on:{"delete-object":e.deleteObject},scopedSlots:e._u([{key:"component",fn:function(){return[s("video-sort-annotation",{ref:"videoSortAnnotation",attrs:{name:e.name,fileName:e.fileName,fileUrl:e.fileUrl,videos:e.videos,orderingRule:e.orderingRule,orderingAttribute:e.orderingAttribute,$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Ff=[],Vf=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"z-video-sort-annotation"},[s("div",{staticClass:"question"},[s("h2",{staticClass:"title"},[e._v(e._s(e.historyIndex+1)+"、左边的视频"),e.$optimus.disabled?s("span",{staticClass:"left-title"},[e._v("("+e._s(e.currentSelect.leftObj?e.currentSelect.leftObj[e.fileName]:"")+")")]):e._e(),e._v(" 对比 右边的视频"),e.$optimus.disabled?s("span",{staticClass:"right-title"},[e._v("("+e._s(e.currentSelect.rightObj?e.currentSelect.rightObj[e.fileName]:"")+")")]):e._e(),e._v(":")]),s("Radio-group",{model:{value:e.currentSelect.choice,callback:function(t){e.$set(e.currentSelect,"choice",t)},expression:"currentSelect.choice"}},[s("Radio",{staticClass:"radio",attrs:{label:">",disabled:e.disabledChoice||e.ended||e.$optimus.disabled}},[s("span",[e._v("左边的"+e._s(e.orderingAttribute)+"更好")])]),s("Radio",{staticClass:"radio",attrs:{label:"=",disabled:e.disabledChoice||e.ended||e.$optimus.disabled}},[s("span",[e._v("两边的"+e._s(e.orderingAttribute)+"一样好")])]),s("Radio",{staticClass:"radio",attrs:{label:"<",disabled:e.disabledChoice||e.ended||e.$optimus.disabled}},[s("span",[e._v("右边的"+e._s(e.orderingAttribute)+"更好")])])],1),s("div",{staticClass:"wrapper"},[s("p",[e._v("(共"+e._s(e.videoArray.length)+"个数据，已排序"+e._s(e.sortedRes.length)+"个)")]),e.isAlter?e._e():s("Button",{attrs:{type:"primary",disabled:0===e.videoArray.length||e.ended||e.$optimus.disabled},on:{click:e.handleSort}},[e._v("确定，下一组")]),e.isAlter?s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.showModal}},[e._v("修改结果")]):e._e(),s("Modal",{attrs:{title:"警告！",closable:!1},on:{"on-ok":e.editResult},model:{value:e.modal,callback:function(t){e.modal=t},expression:"modal"}},[s("p",[e._v("修改当前结果将影响后续已排序数据，是否确定修改？")])]),s("Button",{on:{click:function(t){t.stopPropagation(),e.isShowRes=!0}}},[e._v("检查")])],1)],1),s("div",{staticClass:"contain"},[s("div",{staticClass:"toolBar"},[s("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.play}},[e._v("播放")]),s("Button",{attrs:{loading:e.loading},on:{click:e.pause}},[e._v("暂停")]),s("Button",{attrs:{loading:e.loading},on:{click:e.replay}},[e._v("回放")]),s("Progress",{staticStyle:{width:"600px","margin-left":"30px"},attrs:{percent:e.videoPercent}},[s("span",[e._v(e._s(e.currentTime)+"/"+e._s(e.duration))])])],1),s("div",{staticClass:"content"},[s("div",{staticClass:"videoBar",on:{mousemove:e.move}},[s("div",{staticClass:"left",style:{width:e.leftWidth+"px"}},[s("video",{ref:"leftVideo",attrs:{muted:"true",controlsList:"nodownload",oncontextmenu:"return false"},domProps:{muted:!0},on:{timeupdate:e.timeupdate,canplaythrough:e.canplaythrough,loadstart:e.loadstart}})]),s("div",{staticClass:"right"},[s("video",{ref:"rightVideo",attrs:{muted:"true",controlsList:"nodownload",oncontextmenu:"return false"},domProps:{muted:!0}})]),e.loading?s("Spin",{attrs:{size:"large",fix:""}},[s("Icon",{staticClass:"icon-load",attrs:{type:"ios-loading",size:"30"}}),s("p",[e._v("视频加载中")]),s("p",[e._v("左边视频"+e._s(e.leftLoadingProgress)+"%-右边视频"+e._s(e.rightLoadingProgress)+"%")])],1):e._e()],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowRes,expression:"isShowRes"}],staticClass:"checkContent"},[s("Icon",{staticClass:"closeBtn",attrs:{type:"md-close"},on:{click:function(t){e.isShowRes=!1}}}),s("Tabs",[s("TabPane",{attrs:{label:"历史标注"}},e._l(e.userSort,(function(t,i){return s("div",{key:i,staticClass:"history center"},[s("Button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:t.btnType},on:{click:function(s){return e.rollback(t,i)}}},[e._v("第"+e._s(i+1)+"组")])],1)})),0),e.$optimus.disabled?s("TabPane",{attrs:{label:"当前排序"}},e._l(e.sortedRes,(function(t,i){return s("p",{key:i,staticStyle:{display:"flex","justify-content":"space-between"}},[s("span",[e._v(e._s(t.index))]),s("span",[e._v(e._s(t[e.fileName]))])])})),0):e._e()],1)],1)])])},qf=[];function Hf({arr:e,userSort:t}){if(!(e instanceof Array))return[];if(e.length<=1)return e;let s,i,a,o,n;const r={};for(s=1;s<e.length;s++){a=0;const l=e.findIndex(e=>null===e);o=-1===l?s-1:l-1,i=e[s];let c=!1;while(a<=o){n=Math.floor((a+o)/2);let l=!1;if(!t.length)return{left:e[n],right:i,sorted:[],eqHash:r};{let s=0;for(;s<t.length&&!l;s++){const r=t[s];r.left===e[n]&&r.right===i&&(l=!0,"<"===r.choice?a=n+1:"="===r.choice?(c=!0,a=n+1,o=-1):o=n-1)}}if(!l)return{left:e[n],right:i,sorted:e.slice(0,s),eqHash:r}}c?(r[e[n]]?r[e[n]].push(i):r[e[n]]=[i],e.splice(s,1,null)):e.splice(a,0,e.splice(s,1)[0])}return{arr:e,sorted:e.slice(0,s),eqHash:r}}var Wf={mixins:[Re["a"]],props:{name:String,videos:{type:[String,Array]},fileName:{type:String,default:"file_name"},fileUrl:{type:String,default:"file_url"},orderingRule:String,orderingAttribute:String},data(){return{isShowRes:!1,modal:!1,disabledChoice:!1,isAlter:!1,ended:!1,loading:!1,loadingProgress:0,leftLoadingProgress:0,rightLoadingProgress:0,videoPercent:0,leftWidth:960,duration:"00:00:00",currentTime:"00:00:00",videoArray:[],videoFileNames:[],sorted:[],eqHash:{},historyIndex:0,currentSelect:{},userSort:[],sortInput:[],sortedRes:[]}},watch:{sorted:{handler(){this.getSortArray()},deep:!0},sortInput:{handler(){this.updateFormData()},deep:!0},currentSelect:{handler(e,t){Object(a["isEmpty"])(e)||Object(a["isEmpty"])(t)||e.leftObj[this.fileUrl]===t.leftObj[this.fileUrl]&&e.rightObj[this.fileUrl]===t.rightObj[this.fileUrl]||this.fetchVideos(),Object(a["isEmpty"])(t)&&!Object(a["isEmpty"])(e)&&this.fetchVideos()},deep:!0}},mounted(){const e=this;this.$optimus.$on("optimus:forms-stage:check",()=>{this.$optimus.$emit("optimus:optimus-engine:check",e.ended)})},created(){const e=this;this.updateFormData=Object(a["debounce"])(()=>{Object(a["forEach"])(e.sortInput,e=>{delete e.btnType}),e.$optimus.formData[e.name]={sortInput:e.sortInput,sortedRes:e.sortedRes},console.log("提交的标注结果：",e.$optimus.formData[e.name])},100),this.handleInit(),console.log(this.sortInput)},methods:{handleInit(){const{videos:e}=this;if("string"===typeof e)try{this.videoArray=JSON.parse(this.videos)}catch(s){console.log("[video-sort]: invalid videos",this.videos)}else"[object Array]"===Object.prototype.toString.call(e)&&(this.videoArray=this.videos);const{fileName:t}=this;if(this.videoFileNames=this.videoArray.map(e=>e[t]),this.$optimus.formData[this.name]){const{sortInput:e}=Object(a["cloneDeep"])(this.$optimus.formData[this.name]);this.sortInput=e}else this.sortInput=[];this.userSort=Object(a["cloneDeep"])(this.sortInput),this.sort(this.sortInput)},fetchVideos(){const e=[this.handleFetch(this.currentSelect.leftObj[this.fileUrl],"left"),this.handleFetch(this.currentSelect.rightObj[this.fileUrl],"right")];this.loading=!0,Promise.all(e).then(e=>{const[t,s]=e;this.loadVideo(t,this.$refs.leftVideo),this.loadVideo(s,this.$refs.rightVideo),this.loading=!1}).catch(e=>{console.log("视频加载出错:",e),this.$Message.error("全部数据已排序完成"),this.loading=!1})},handleFetch(e,t){return fetch(e).then(e=>(console.log(e),this.loadProgress(e.clone(),t))).catch(e=>{console.log(e)})},async loadProgress(e,t){const s=e.body.getReader(),i=+e.headers.get("Content-Length");let a=0;const o=[];while(1){const{done:e,value:n}=await s.read();if(e)break;o.push(n),a+=n.length;const r=parseInt(a/i*100,10);"left"===t?this.leftLoadingProgress=r:this.rightLoadingProgress=r}const n=new Blob(o);return n},loadVideo(e,t){console.log(e);const s=URL.createObjectURL(e);t.src=s,t.load()},sort(e){const{left:t,right:s,sorted:i,eqHash:o}=Hf({arr:Object(a["cloneDeep"])(this.videoFileNames),userSort:e});if(t)this.userSort.push({left:t,right:s,choice:"",btnType:"primary"}),this.currentSelect={leftObj:Object(a["find"])(this.videoArray,{[this.fileName]:t}),rightObj:Object(a["find"])(this.videoArray,{[this.fileName]:s}),choice:""};else{const{left:e,right:t,choice:s}=this.userSort[this.userSort.length-1];this.currentSelect={leftObj:Object(a["find"])(this.videoArray,{[this.fileName]:e}),rightObj:Object(a["find"])(this.videoArray,{[this.fileName]:t}),choice:s},this.ended=!0,this.isAlter=!0}this.sorted=i,this.eqHash=o,this.historyIndex=this.userSort.length-1,this.handleBtnType(),this.$nextTick(()=>{this.replay()})},handleSort(){this.currentSelect.choice?(this.userSort[this.historyIndex].choice=this.currentSelect.choice,this.sortInput.push({left:this.currentSelect.leftObj[this.fileName],right:this.currentSelect.rightObj[this.fileName],choice:this.currentSelect.choice}),this.sort(this.sortInput),this.ended&&this.$Message.success("全部数据已排序完成")):this.$Message.warning("请选择答案再提交！")},getSortArray(){const e=Object(a["compact"])(this.sorted),t="升序"===this.orderingRule?[...e]:[...e].reverse();this.sortedRes=[];let s=1;const i=this;t.forEach(e=>{const t={[this.fileName]:e,index:s};i.sortedRes.push(t),Object(a["chain"])(i.eqHash).keys().forEach(t=>{e===t&&Object(a["forEach"])(i.eqHash[t],e=>{i.sortedRes.push({[this.fileName]:e,index:s})})}).value(),s+=1})},handleBtnType(){Object(a["forEach"])(this.userSort,e=>{e.btnType="default"}),this.userSort[this.historyIndex].btnType="primary"},rollback(e,t){let s;this.currentSelect={leftObj:Object(a["find"])(this.videoArray,{[this.fileName]:e.left}),rightObj:Object(a["find"])(this.videoArray,{[this.fileName]:e.right}),choice:e.choice},e.choice?(s=this.userSort.slice(0,t+1),this.isAlter=!0,this.disabledChoice=!0):(s=this.userSort.slice(0,t),this.isAlter=!1,this.disabledChoice=!1);const{sorted:i,eqHash:o}=Hf({arr:Object(a["cloneDeep"])(this.videoFileNames),userSort:s});this.sorted=i,this.eqHash=o,this.historyIndex=t,this.handleBtnType()},editResult(){this.sortInput=this.userSort.slice(0,this.historyIndex),this.userSort.splice(this.historyIndex);const{left:e,right:t,sorted:s,eqHash:i}=Hf({arr:Object(a["cloneDeep"])(this.videoFileNames),userSort:this.sortInput});this.userSort.push({left:e,right:t,choice:""}),this.currentSelect={leftObj:Object(a["find"])(this.videoArray,{[this.fileName]:e}),rightObj:Object(a["find"])(this.videoArray,{[this.fileName]:t}),choice:""},this.historyIndex=this.userSort.length-1,this.sorted=s,this.eqHash=i,this.ended=!1,this.isAlter=!1,this.disabledChoice=!1,this.modal=!1,this.handleBtnType()},move(e){this.leftWidth=e.offsetX},loadstart(e){this.videoPercent=0,this[e]=!0},canplaythrough(e){const t=this.$refs.leftVideo&&this.$refs.leftVideo.duration?parseInt(this.$refs.leftVideo.duration,10):0;this.duration=this.formatTime(t),this[e]=!1},timeupdate:Object(a["throttle"])((function(){const e=parseInt(this.$refs.leftVideo.currentTime,10),t=this.$refs.leftVideo?parseInt(this.$refs.leftVideo.duration,10):0;this.videoPercent=e/t*100,this.currentTime=this.formatTime(e)}),1e3),play(){this.$refs.leftVideo.play(),this.$refs.rightVideo.play()},pause(){this.$refs.leftVideo.pause(),this.$refs.rightVideo.pause()},replay(){this.pause(),this.$refs.leftVideo.currentTime=0,this.$refs.rightVideo.currentTime=0,this.videoPercent=0},showModal(){this.modal=!0},handleCloseRes(){this.isShowRes=!1},formatTime(e){let t;if(e>-1){const s=Math.floor(e/3600),i=Math.floor(e/60)%60,a=e%60;t=s<10?`0${s}:`:s+":",i<10&&(t+="0"),t+=i+":",a<10&&(t+="0"),t+=a}return t}}},Uf=Wf,Qf=(s("f093"),Object(S["a"])(Uf,Vf,qf,!1,null,null,null)),Jf=Qf.exports,Gf={label:"视频排序标注v2",name:"z-video-sort-stage-v2",disableGlobalTags:!0,attributes:[{name:"videos",label:"视频源(需要包含file_name, file_url)",value:[],type:Array,vType:["array","string"]},{name:"fileName",label:"文件名字段名",value:"",type:String,vType:["string"]},{name:"fileUrl",label:"路径名字段名",value:"",type:String,vType:["string"]},{name:"name",label:"输出字段标识",value:"",type:String,vType:["string"]},{name:"orderingRule",label:"排序规则",value:"降序",component:"z-single-select",attributes:{options:[{label:"降序",value:"降序"},{label:"升序",value:"升序"}]},vType:["string"]},{name:"orderingAttribute",label:"排序属性",value:"",type:String,vType:["string"]}],tools:[]},Kf={metadata:Gf,components:{BaseLayout:Lp,VideoSortAnnotation:Jf},mixins:[Re["a"]],props:{name:String,videos:{type:[String,Array]},fileName:{type:String,default:"file_name"},fileUrl:{type:String,default:"file_url"},orderingRule:String,orderingAttribute:String},methods:{deleteObject(e){this.$refs.videoSortAnnotation.$emit("delete-object",e)}}},Yf=Kf,Zf=Object(S["a"])(Yf,Nf,Ff,!1,null,null,null),Xf=Zf.exports,ev=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{layout:e.layout,fontSize:e.fontSize},scopedSlots:e._u([{key:"component",fn:function(){return[s("video-annotation",{ref:"videoAnnotation",attrs:{src:e.src,myWidth:e.myWidth,myHeight:e.myHeight,myBackgroundColor:e.myBackgroundColor,myViewPortWidth:e.myViewPortWidth,$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},tv=[],sv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"video-container"},[s("video",{ref:"videoPlayer",staticClass:"video-js",attrs:{id:e.enginePrimaryKey}},[e.loading?s("div",{staticClass:"vjs-loading"},[e._v("加载中...")]):e._e()])])},iv=[];const av={language:"zh-CN",controls:!0,preload:"auto",autoplay:!1,fluid:!0,aspectRatio:"16:9",responsive:!0,playbackRates:[.5,1,1.25,1.5,2]};var ov={mixins:[Re["a"]],props:{src:String,myWidth:{type:String,default:"500"},myHeight:{type:String,default:"500"},myBackgroundColor:{type:String,default:"black"},myViewPortWidth:{type:String,default:"default"}},data(){return{player:null,loading:!1}},computed:{enginePrimaryKey(){return this.$optimus.enginePrimaryKey||0},videoSrc(){return this.src||this.$optimus.context.url}},watch:{videoSrc:{handler(e){this.player&&e&&this.player.src([{src:e}])},immediate:!1}},beforeDestroy(){this.destroyPlayer()},mounted(){this.initPlayer()},methods:{initPlayer(){this.player=Object(Mu["a"])(this.$refs.videoPlayer||this.enginePrimaryKey,{...av,sources:this.videoSrc?[{src:this.videoSrc}]:[]},()=>{this.setupEventListeners()})},setupEventListeners(){this.player&&(this.player.on("waiting",()=>{this.loading=!0}),this.player.on("playing",()=>{this.loading=!1}))},destroyPlayer(){var e;null===(e=this.player)||void 0===e||e.dispose(),this.player=null,this.loading=!1}}},nv=ov,rv=(s("c30b"),Object(S["a"])(nv,sv,iv,!1,null,"587fb64e",null)),lv=rv.exports,cv={label:"视频标注",name:"z-video-stage",repeatable:!0,attributes:[{name:"layout",label:"样式布局",value:"horizontal",type:String,component:"z-single-select",attributes:{options:[{label:"左右布局",value:"horizontal"},{label:"上下布局",value:"vertical"}]},vType:["string"]},{name:"fontSize",label:"字体大小（单位:px)",type:String,component:"z-single-select",value:"14",attributes:{basicMode:!0,exhibit:"dropdown",options:[{label:"14",value:"14"},{label:"16",value:"16"},{label:"18",value:"18"},{label:"20",value:"20"},{label:"24",value:"24"}]},vType:["string"]},{name:"src",label:"视频地址",value:"",type:String,vType:["url"]},{name:"myWidth",label:"视频宽度（单位:px)",value:"500",type:String,vType:["string"]},{name:"myHeight",label:"视频高度（单位:px)",value:"500",type:String,vType:["string"]},{name:"myViewPortWidth",label:"视频展示窗口大小",value:"default",type:String,component:"z-single-select",attributes:{options:[{label:"默认",value:"default"},{label:"720P",value:"720"},{label:"1080P",value:"1080"}]},vType:["string"]},{name:"myBackgroundColor",label:"视频背景颜色",value:"black",type:String,component:"z-single-select",attributes:{options:[{label:"黑色",value:"black"},{label:"白色",value:"white"}]},vType:["string"]}],tools:[]},dv={metadata:cv,components:{BaseLayout:Lp,VideoAnnotation:lv},mixins:[Re["a"]],props:{src:String,myWidth:String,myHeight:String,myBackgroundColor:String,myViewPortWidth:String,layout:String,fontSize:String}},uv=dv,hv=Object(S["a"])(uv,ev,tv,!1,null,null,null),pv=hv.exports,mv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{on:{"delete-object":e.deleteObject},scopedSlots:e._u([{key:"component",fn:function(){return[s("audio-annotation",{ref:"audioAnnotation",attrs:{src:e.src,$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},gv=[],bv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"z-audio-annotation"},[s("Split",{attrs:{mode:"vertical",min:"10px"},model:{value:e.splitValue,callback:function(t){e.splitValue=t},expression:"splitValue"}},[s("timeline",{staticClass:"split-top",attrs:{slot:"top"},slot:"top"},[e.src&&100!==e.percent?s("spin",{attrs:{fix:""}},[s("span",[e._v("波形加载中"+e._s(e.percent)+"%，请勿刷新页面")])]):e._e(),s("div",{staticClass:"wave_box"},[e.isShowActive?s("Row",{staticClass:"mbs"},[s("Col",{staticClass:"height-center",attrs:{span:"8"}},[s("Button",{staticClass:"icon-button",attrs:{type:"text",size:"small",disabled:10===e.curZoomSpeed}},[s("Icon",{attrs:{type:"ios-expand",size:"17"},on:{click:function(t){return e.chengeZoom(1)}}})],1),s("Button",{staticClass:"icon-button",attrs:{type:"text",size:"small",disabled:0===e.curZoomSpeed}},[s("Icon",{attrs:{type:"ios-contract",size:"18"},on:{click:function(t){return e.chengeZoom(0)}}})],1),s("Button",{staticClass:"icon-button",attrs:{type:"text",size:"small",disabled:0===e.curZoomSpeed}},[s("Icon",{attrs:{type:"md-expand",size:"17"},on:{click:function(t){return e.chengeZoom(2)}}})],1),s("a",{staticClass:"mlm",attrs:{href:e.href,target:"_blank"}},[e._v("无法加载波形？")])],1),s("Col",{attrs:{span:"8"}},[s("div",{staticClass:"center height-center"},[s("Icon",{staticClass:"mrm hover-hand",attrs:{type:"ios-rewind",size:"20",id:"sb"},on:{click:e.skipBackward}}),e.isplaying?e._e():s("Icon",{staticClass:"mrm hover-hand",attrs:{type:"ios-play",size:"20",id:"pp"},on:{click:e.playPause}}),e.isplaying?s("Icon",{staticClass:"mrm hover-hand",attrs:{type:"ios-pause",size:"20",id:"pp"},on:{click:e.playPause}}):e._e(),s("Icon",{staticClass:"hover-hand",attrs:{type:"ios-fastforward",size:"20",id:"sf"},on:{click:e.skipForward}})],1)]),s("Col",{attrs:{span:"8"}},[s("div",{staticClass:"right"},[s("Button",{staticClass:"mrm",attrs:{type:"warning",size:"small",shape:"circle",disabled:e.$optimus.disabled},on:{click:e.cutDoubleObj}},[e._v("段切割")]),s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"small",shape:"circle",disabled:e.$optimus.disabled||e.isDbChannels},on:{click:function(t){return e.createObject(e.currentObjectTool,t)}}},[e._v("切分段")])],1)])],1):e._e(),s("div",{staticClass:"waveform_class",attrs:{id:"waveform"}}),s("div",{attrs:{id:"wave-timeline"}}),s("audio-timer",{staticClass:"center mtm",attrs:{time:e.time}})],1),s("div",{staticClass:"right mtm mbm tags-radius"},e._l(e.objectTools,(function(t,i){return 0!==e.numberOfChannels?s("Tag",{key:i,staticClass:"hover-hand mrm",class:{fontcolor:!0},style:t.isChecked?{background:t.color,"border-color":t.color}:{background:t.color,opacity:.4},attrs:{checked:t.isChecked,checkable:"",name:""+t.name+t.label,color:t.color},on:{"on-change":e.changeTag}},[e._v(e._s(t.label))]):e._e()})),1)],1),s("timeline",{staticClass:"split-bottom",attrs:{slot:"bottom"},slot:"bottom"},[0!==e.numberOfChannels?s("Select",{staticClass:"mbm",staticStyle:{width:"150px"},model:{value:e.currentTagTool,callback:function(t){e.currentTagTool=t},expression:"currentTagTool"}},[s("Option",{key:"*",attrs:{value:"*"}},[e._v("全部")]),e._l(e.objectTools,(function(t,i){return s("Option",{directives:[{name:"show",rawName:"v-show",value:"双声道"!==t.label,expression:"objectTool.label !== '双声道'"}],key:""+t.label+t.name,attrs:{value:""+t.label+t.name}},[e._v(e._s(t.label))])}))],2):e._e(),e._l(e.objects,(function(t,i){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.currentTagTool===""+t.label+t.name||"*"===e.currentTagTool,expression:"currentTagTool === `${obj.label}${obj.name}` || currentTagTool === '*'"}],key:t.featureId,staticClass:"z-stage__objects",attrs:{id:t.featureId},on:{mousedown:function(s){return e.selectObject(t,!0)}}},[s("Row",{staticClass:"mbm"},[s("Col",{attrs:{span:"21"}},[s("span",{staticClass:"mts mrm"},[s("div",{staticClass:"mrs regionblock",style:{backgroundColor:t.color}}),s("span",[e._v("段落"+e._s(i+1)+"（"+e._s(t.label)+"）")])]),s("span",[e._v("标注时间段：")]),s("Input",{staticClass:"mrm",staticStyle:{width:"20%"},attrs:{disabled:e.$optimus.disabled},on:{"on-blur":function(s){return e.updateRegionTime(t,0)}},model:{value:t.data.start,callback:function(s){e.$set(t.data,"start",s)},expression:"obj.data.start"}}),s("span",[e._v("-")]),s("Input",{staticClass:"mlm mrm",staticStyle:{width:"20%"},attrs:{disabled:e.$optimus.disabled},on:{"on-blur":function(s){return e.updateRegionTime(t,1)}},model:{value:t.data.end,callback:function(s){e.$set(t.data,"end",s)},expression:"obj.data.end"}}),s("span",{staticClass:"mlm"},[e._v("时长："+e._s(e.getTimePeriod(t.data.start,t.data.end))+"s")])],1),s("Col",{staticClass:"mts",attrs:{span:"3"}},[s("div",{staticClass:"right"},[s("icon",{staticClass:"mrs hover-hand",attrs:{type:e.regionLists[t.featureId]?"ios-eye-outline":"ios-eye-off-outline",size:"20"},on:{click:function(s){return e.disableRegion(t)}}}),s("icon",{staticClass:"mrs hover-hand",attrs:{type:"md-arrow-dropright-circle",size:"20"},on:{click:function(t){return t.stopPropagation(),e.playTagging(i)}}}),e.$optimus.disabled?e._e():s("icon",{staticClass:"hover-hand",attrs:{type:"ios-trash-outline",size:"20"},on:{click:function(s){return s.stopPropagation(),e.deleteSubmit([t.featureId],"【段落"+(i+1)+"】")}}})],1)])],1),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:t,expression:"obj"}],ref:"form_"+t.featureId,refInFor:!0,attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.initAnswer[t.featureId],disabled:e.$optimus.disabled}})],1)}))],2)],1)],1)},fv=[],vv={components:{AudioTimer:nd},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{src:{type:String},type:String},data(){const{objects:e}=this.$optimus,t=this.getInitAnswer(e);return{href:rd,selectObjects:{},isBatch:!1,isShowActive:!1,numberOfChannels:0,splitValue:"250px",initAnswer:t,startTime:null,percent:0,currentTagTool:"*",oriZoomPx:20,curZoomPx:0,curZoomSpeed:0,speedNums:["0.25","0.5","0.75","1","1.25","1.5","1.75","2"],curSpeedNum:"1",objects:e,currentObject:{},tags:this.$optimus.tags,regionOptions:null,regionLists:{},wavesurfer:null,time:"00:00:00:000",duration:0,isplaying:!1,currentObjectTool:{type:"",label:"默认",name:"default",color:""},objectTools:[]}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},isDbChannels(){return"双声道"===this.currentObjectTool.label},inputTags(){var e,t;return null===(e=this.$renderedComponentConfig)||void 0===e||null===(t=e.$object_items)||void 0===t?void 0:t.map(e=>"z-input"===e.component&&e.attributes.label)}},watch:{currentObjectTool(){this.changeRegion()}},mounted(){this.handleInitAudio(),this.$optimus.active&&document.addEventListener("keydown",this.listenKeyboardEvent),this.$optimus.active&&document.addEventListener("keyup",this.listenKeyupEvent)},beforeDestroy(){this.wavesurfer&&this.wavesurfer.destroy(),this.$optimus.active&&document.removeEventListener("keydown",this.listenKeyboardEvent),this.$optimus.active&&document.removeEventListener("keyup",this.listenKeyupEvent)},methods:{listenKeyboardEvent:Object(a["throttle"])((function(e){const{target:t,code:s,altKey:i,shiftKey:o}=e;if("Escape"===s){e.preventDefault();const t=Object(a["findIndex"])(this.objects,this.currentObject);-1!==t&&this.playTagging(t)}else if("Tab"===s)e.preventDefault(),this.playPause();else if("Enter"===s&&i){const e=Object(a["findIndex"])(this.objects,this.currentObject);-1!==e&&this.moveObject("down",e)}else"ArrowRight"===s&&i?this.skipForward():"ArrowLeft"===s&&i?this.skipBackward():o&&!this.isDbChannels&&(this.isBatch=!0);if(!("INPUT"===t.tagName&&"checkbox"!==t.getAttribute("type")||"TEXTAREA"===t.tagName||t.getAttribute("contenteditable")))if("Backspace"!==s||this.$optimus.disabled||this.isDbChannels)if("KeyW"===s&&i)this.chengeZoom(1);else if("KeyQ"===s&&i)this.chengeZoom(0);else if("KeyS"!==s||!i||this.$optimus.disabled||this.isDbChannels)if("KeyX"!==s||!i||this.$optimus.disabled||this.isDbChannels)if("KeyH"===s)e.preventDefault(),this.disableRegion(this.currentObject);else if("Enter"===s&&o){const e=Object(a["findIndex"])(this.objects,this.currentObject);-1!==e&&this.moveObject("up",e)}else"KeyM"===s&&i&&!this.isDbChannels&&Object.keys(this.selectObjects).length>1&&(e.preventDefault(),this.margeObjects());else e.preventDefault(),this.createObject(this.currentObjectTool);else this.startTime=this.wavesurfer.getCurrentTime().toFixed(3),this.wavesurfer.clearMarkers(),this.wavesurfer.addMarker({time:this.startTime,color:"#ff990a"});else this.deleteSubmit(Object.keys(this.selectObjects))}),200),listenKeyupEvent(e){"Shift"===e.key&&(this.isBatch=!1)},disableRegion(e){if(null===e||void 0===e||!e.featureId)return this.$Message.error({content:"请选中要隐藏或展示的标注段",duration:3}),0;const{label:t}=this.currentObjectTool,s=Object.assign({},this.regionLists);if(this.regionLists[e.featureId]){var i;null===(i=s[e.featureId])||void 0===i||i.remove(),delete s[e.featureId]}else{if(e.label!==t)return 0;this.regionOptions={id:"wavesurfer_"+e.featureId,start:this.conversionTime(e.data.start),end:this.conversionTime(e.data.end),loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled,color:e.color},s[e.featureId]=this.wavesurfer.addRegion(this.regionOptions)}this.regionLists=s},getInitAnswer(e){return Object(a["cloneDeep"])(e).reduce((e,t)=>Object.assign(e,{[t.featureId]:{tags:t.tags}}),{})},moveObject(e,t){let s=t;const i=this.objects.length;s="up"===e?t===i-1?0:t+1:0===t?i-1:t-1,this.crollObject(s),this.selectObject(this.objects[s],!0)},changeRegion(){const{name:e,label:t}=this.currentObjectTool,s=this.isDbChannels?this.objects:this.objects.filter(s=>`${e}${t}`===`${s.name}${s.label}`);this.wavesurfer&&this.wavesurfer.clearRegions(),this.regionLists=[],s.forEach(e=>{const{start:t,end:s}=e.data,i={id:"wavesurfer_"+e.featureId,start:this.conversionTime(t),end:this.conversionTime(s),loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled,color:e.color};this.regionLists[e.featureId]=this.wavesurfer.addRegion(i)}),this.$nextTick(()=>{this.currentObject&&this.currentObject.featureId?this.selectObject(this.currentObject):this.selectObject()})},judgeTime(e){const t=/^([01][0-9]|2[0-3])(:[0-5][0-9]){2}:[0-9]{1,3}$/;return t.test(e)},conversionTime(e){const t=e.split(":");let s=0,i=!0;return Object(a["forEach"])(t,(e,t)=>{if(isNaN(Number(e)))return i=!1,!1;const a=3600/Math.pow(60,t);s=(3===t?e/1e3:Number(e)*a)+s}),!!i&&s},updateRegionTime(e,t){const s={};let i=!0;if(this.judgeTime(e.data.start)||this.judgeTime(e.data.end))this.$Message.error({content:"修改失败，请确认时间格式为00:00:00:000",duration:3}),e.data.end=this.s_to_hs(this.regionLists[e.featureId].end),e.data.start=this.s_to_hs(this.regionLists[e.featureId].start);else{const a=this.conversionTime(e.data.start),o=this.conversionTime(e.data.end),n=this.wavesurfer.getDuration();o>a&&o<n?t?(s.end=o,e.data.end=this.s_to_hs(o)):(s.start=a,e.data.start=this.s_to_hs(a)):o===a?(s.end=a+.1,e.data.end=this.s_to_hs(a+.1)):o<a?(this.$Message.error("标注段起始时间不能大于结束时间"),e.data.end=this.s_to_hs(this.regionLists[e.featureId].end),e.data.start=this.s_to_hs(this.regionLists[e.featureId].start)):o>n?(this.$Message.error("标注段结束时间不能大于音频总时间"),e.data.end=this.time,s.end=n):i=!1}var o;i&&(null===(o=this.regionLists[e.featureId])||void 0===o||o.update(s),this.objects.sort(this.compare("data")),this.$nextTick(()=>{const t=Object(a["findIndex"])(this.objects,t=>e.featureId===t.featureId);this.crollObject(t)}))},getTimePeriod(e,t){const s=this.conversionTime(e),i=this.conversionTime(t),a=i-s;return a.toFixed(3)},chengeZoom(e){0===e&&this.curZoomSpeed>0?this.curZoomSpeed=this.curZoomSpeed-1:1===e&&this.curZoomSpeed<10?this.curZoomSpeed=this.curZoomSpeed+1:2===e&&(this.curZoomSpeed=0,this.wavesurfer.params.minPxPerSec=this.oriZoomPx),this.curZoomPx=this.oriZoomPx*(1+this.curZoomSpeed/10),this.wavesurfer.zoom(this.curZoomPx)},getSpeedNum(e){this.curSpeedNum=e,this.wavesurfer.setPlaybackRate(e)},addSelectObjects(e){const{name:t,label:s,featureId:i}=e,o=Object(a["cloneDeep"])(this.selectObjects);Object(a["forIn"])(o,(e,i)=>{`${t}_${s}`!==`${e.name}_${e.label}`&&delete this.selectObjects[i]}),this.selectObjects[i]?delete this.selectObjects[i]:this.selectObjects[i]=e},selectObject(e,t){const s={},i=document.getElementsByClassName("z-stage__objects"),a=document.getElementsByClassName("wavesurfer-region");this.currentObject=e||{},t&&!this.isDbChannels&&this.changeTag(!0,`${e.name}${e.label}`),e&&(s[e.featureId]=e),e&&this.isBatch?this.addSelectObjects(e):this.selectObjects=s,Array.prototype.forEach.call(i,e=>{let t="none";this.selectObjects[e.id]&&(t="2px solid #7cb5f1"),this.$set(e.style,"border",t)}),Array.prototype.forEach.call(a,e=>{var t,s;let i="none",a=3;this.selectObjects[null===(t=e.dataset)||void 0===t||null===(s=t.id)||void 0===s?void 0:s.replace("wavesurfer_","")]&&(i="2px solid red",a=4),this.$set(e.style,"border",i),this.$set(e.style,"border-right","1px solid #000"),this.$set(e.style,"zIndex",a)})},updateObjTags(e){const t="form_"+e.featureId,s=Object(a["findIndex"])(this.objects,t=>t.featureId===e.featureId);if(-1===s)return 0;this.objects[s].tags=this.$refs[t][0].tags},changeTag(e,t){const s=Object(a["cloneDeep"])(this.objectTools);t!==`${this.currentObjectTool.name}${this.currentObjectTool.label}`&&(s.forEach((e,i)=>{const a=`${e.name}${e.label}`;a===t?(s[i].isChecked=!0,this.currentObjectTool=s[i]):s[i].isChecked=!1}),this.objectTools=s,"左声道"===this.currentObjectTool.label&&this.setAudioNode(1,0),"右声道"===this.currentObjectTool.label&&this.setAudioNode(0,1),this.isDbChannels&&this.setAudioNode())},crollObject(e){const t=document.getElementsByClassName("z-stage__objects"),s=document.getElementsByClassName("bottom-pane");let i=0;Array.prototype.forEach.call(t,(t,s)=>{s<e&&(i=t.clientHeight+i+15)}),this.$nextTick(()=>{s[0]&&(s[0].scrollTop=i)})},crollRegion(e){const t=document.getElementsByClassName("wavesurfer-region");let s=0;t.forEach((t,i)=>{i<e&&(s=t.clientWidth+s)}),document.getElementsByClassName("waveform_class")[0].scrollLeft=s},setAudioNode(e,t){if(void 0!==e){const{ac:s}=this.wavesurfer.backend,i=s.createGain(),a=s.createChannelSplitter(2),o=s.createChannelMerger(2);let n,r;this.wavesurfer.setFilteredChannels([e]),i.channelCountMode="explicit",s.createGain?(n=s.createGain(),r=s.createGain()):(n=s.createGainNode(),r=s.createGainNode()),r.gain.value=t,n.gain.value=e,a.connect(r,1),r.connect(o),r.connect(o,0,1),n.connect(o,0,1),this.wavesurfer.backend.setFilters([i,a,n,o]),this.numberOfChannels=1,this.splitValue="275px"}else this.wavesurfer.setFilteredChannels([2]),this.wavesurfer.backend.setFilters([]),this.numberOfChannels=2,this.splitValue="390px"},handleInitAudio(){const e=this;var t;this.wavesurfer&&(null===(t=document.querySelector("wave"))||void 0===t||t.remove(),this.wavesurfer.destroy());this.tags&&this.tags.forEach(e=>{this.$optimus.formData[e.name]=e.value});const s=Qc.create({container:"#waveform",waveColor:"#888",progressColor:"#00ffff",interact:!0,height:120,hideScrollbar:!1,scrollParent:!0,audioRate:this.curSpeedNum,fillParent:!0,splitChannels:!0,splitChannelsOptions:{overlay:!1,relativeNormalization:!0},plugins:[Kc.create({}),Yc.create({opacity:.5,color:"red"}),Jc.create({container:"#wave-timeline"}),ed.create({})]});this.src?(e.time="00:00:00:000",s.load(this.src),s.on("loading",e=>{this.percent=e}),s.on("ready",()=>{const e=document.getElementsByTagName("canvas");let t=0,i=0;Array.prototype.forEach.call(e,e=>{e.clientWidth&&"wave"===e.parentNode.localName&&e.clientWidth>t&&(t=e.clientWidth)}),this.duration=s.getDuration(),i=t/this.duration,this.oriZoomPx=s.params.minPxPerSec>i?s.params.minPxPerSec:i,s.params.minPxPerSec=this.oriZoomPx,this.time=this.s_to_hs(this.duration),this.changeRegion(),2===this.wavesurfer.backend.buffer.numberOfChannels&&(this.numberOfChannels=this.wavesurfer.backend.buffer.numberOfChannels,this.initObjectTools(),this.splitValue="390px"),this.isShowActive=!0}),s.on("play",()=>{this.isplaying=!0}),s.on("pause",()=>{this.isplaying=!1}),s.on("audioprocess",()=>{this.$optimus.$emit("audio:update-time",this.s_to_hs(s.getCurrentTime()))}),s.on("region-update-end",t=>{if(!e.isShowActive)return;const s=Object(a["findIndex"])(this.objects,e=>"wavesurfer_"+e.featureId===t.id);if(-1===s){if(this.isDbChannels||this.$optimus.disabled)return void(null===t||void 0===t||t.remove());this.currentObject={featureId:t.id.split("wavesurfer_")[1],type:"audio/segment",color:t.color,label:this.currentObjectTool.label,name:this.currentObjectTool.name,data:{start:this.s_to_hs(t.start),end:this.s_to_hs(t.end)},tags:[]},this.objects.push(this.currentObject),this.regionLists[this.currentObject.featureId]=t,this.$nextTick(()=>{this.objects.sort(this.compare("data")),this.selectObject(this.currentObject),this.crollObject(Object(a["findIndex"])(this.objects,e=>e.featureId===this.currentObject.featureId))})}else{const e=this.regionLists.length,i=this.s_to_hs(t.start);if(this.objects[s].data.start=i,t.start.toFixed(3)===t.end.toFixed(3)?(this.objects[s].data.end=this.s_to_hs(t.end+.1),t.update({end:t.end+.1})):this.objects[s].data.end=this.s_to_hs(t.end),1===e)return 0;this.selectObject(this.objects[s]),this.objects.sort(this.compare("data")),this.crollObject(s)}}),s.on("seek",()=>{this.$optimus.$emit("audio:update-time",this.s_to_hs(s.getCurrentTime()))}),s.on("error",e=>{console.log(e)}),s.enableDragSelection({loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled}),s.on("region-created",e=>{const t=Object(a["findIndex"])(this.objects,t=>"wavesurfer_"+t.featureId===e.id);!this.isDbChannels&&-1===t&&(e.color=this.getRegionColor(this.currentObjectTool))}),s.on("region-click",e=>{const t=Object(a["findIndex"])(this.objects,t=>"wavesurfer_"+t.featureId===e.id);this.selectObject(this.objects[t]),this.crollObject(t)}),this.wavesurfer=s):console.log("未接收到音频地址")},compare(e){return(t,s)=>{let i=0,a=0;const o=this.conversionTime(t[e].start),n=this.conversionTime(s[e].start),r=this.conversionTime(t[e].end),l=this.conversionTime(s[e].end);return o===n?(i=r,a=l):(i=o,a=n),i-a}},initObjectTools(){this.objectTools=[{color:"#696A6A",label:"双声道",name:"audio/segment_double",type:"audio/segment",isChecked:!0},{color:"#1E86F4",label:"左声道",name:"audio/segment_left",type:"audio/segment",isChecked:!1},{color:"#FF9900",label:"右声道",name:"audio/segment_rigth",type:"audio/segment",isChecked:!1}],this.currentObjectTool=this.objectTools[0]},getRegionColor(e){let t=null;return t="默认"===e.label?"#"+(15728639*Math.random()<<0).toString(16):e.color,t},createObject(e,t){var s;const{name:i,label:a}=this.currentObjectTool,o=this.objects.filter(e=>`${i}${a}`===`${e.name}${e.label}`);let n=this.startTime?this.startTime:0,r=Number(this.wavesurfer.getCurrentTime()).toFixed(3),l=-1;if(null===t||void 0===t||null===(s=t.currentTarget)||void 0===s||s.blur(),this.wavesurfer.pause(),o.forEach(e=>{const t=this.conversionTime(e.data.end);t<=r&&(t>l||-1===l)&&(l=t)}),n=this.startTime||-1===l?n:l,Number(r)===n)return this.$Message.error("切分时长为0"),0;if(Number(r)<n){const e=n;n=r,r=e}this.addRegionObject(this.currentObjectTool,n,r),this.startTime=null},margeObjects(){let e="",t="";const s=[];this.wavesurfer.pause(),this.objects.forEach(i=>{const{start:a,end:o}=i.data;this.selectObjects[i.featureId]&&(!e&&(e=a),t=o,s.push(i.tags))}),this.removeObject(Object.keys(this.selectObjects)),this.addRegionObject(this.currentObjectTool,this.conversionTime(e),this.conversionTime(t),this.mergeTags(s))},mergeTags(e){let t=[];return e.forEach((e,s)=>{!t.length&&(t=e),s&&e.forEach((e,s)=>{var i;this.inputTags.includes(e.label)&&(t[s].value=`${(null===(i=t[s])||void 0===i?void 0:i.value)||""}${(null===e||void 0===e?void 0:e.value)||""}`)})}),t},cutDoubleObj(){var e;if(null===(e=this.currentObject)||void 0===e||!e.featureId)return this.$Message.error({content:"请选中要分隔的对象",duration:3}),0;const t=Number(this.wavesurfer.getCurrentTime()).toFixed(3),{start:s,end:i}=this.regionLists[this.currentObject.featureId];s<t&&t<i?(this.removeObject([this.currentObject.featureId]),this.addRegionObject(this.currentObjectTool,s,t),this.addRegionObject(this.currentObjectTool,t,i)):this.$Message.error({content:"请将光标落在选中的分隔对象上",duration:3})},addRegionObject(e,t,s,i){const{label:o,name:r}=e,l=this.getRegionColor(e);this.currentObject={featureId:"feature_"+Object(n["j"])(8),type:"audio/segment",color:l,label:o,name:r,data:{start:this.s_to_hs(t),end:this.s_to_hs(s)},tags:Object(a["cloneDeep"])(i)||[]},this.regionOptions={id:"wavesurfer_"+this.currentObject.featureId,start:t,end:s,loop:!1,drag:!this.$optimus.disabled,resize:!this.$optimus.disabled,color:l},this.objects.push(this.currentObject),this.regionLists[this.currentObject.featureId]=this.wavesurfer.addRegion(this.regionOptions),this.objects.sort(this.compare("data")),this.$nextTick(()=>{this.selectObject(this.currentObject)}),this.crollObject(Object(a["findIndex"])(this.objects,e=>e.featureId===this.currentObject.featureId)),this.wavesurfer.clearMarkers(),i&&(this.initAnswer=this.getInitAnswer(this.objects))},deleteSubmit(e,t){this.$Modal.confirm({title:`确定要删除${t||"所选"}切分段吗？`,onOk:()=>{this.removeObject(e)}})},removeObject(e){const t=Object(a["cloneDeep"])(this.objects);let s=0;t.forEach((t,i)=>{const{featureId:a}=t;var o;e.includes(a)&&(this.objects.splice(i-s,1),null===(o=this.regionLists[a])||void 0===o||o.remove(),delete this.regionLists[a],s+=1)}),this.currentObject={}},skipBackward(){var e;null===(e=document.getElementById("sb"))||void 0===e||e.blur(),this.wavesurfer.skipBackward(this.duration>120?30:10),this.wavesurfer.pause()},skipForward(){var e;null===(e=document.getElementById("sf"))||void 0===e||e.blur(),this.wavesurfer.skipForward(this.duration>120?30:10),this.wavesurfer.pause()},playPause(){var e;null===(e=document.getElementById("pp"))||void 0===e||e.blur(),this.isplaying?this.wavesurfer.pause():this.wavesurfer.play()},playTagging(e){var t;const s=this.regionLists[null===(t=this.objects[e])||void 0===t?void 0:t.featureId];s?this.isplaying?this.wavesurfer.pause():this.wavesurfer.play(s.start,s.end):this.$Message.error("未发现标注段！")},s_to_hs(e){const t=Math.abs(e);let s=Math.floor(t),i=0,a=0,o=0,n=Math.round(1e3*(t-s));return 1e3===n?(n="000",s+=1):n<10?n="00"+n:n>9&&n<100&&(n="0"+n),i=Math.floor(s/3600),s-=3600*i,a=Math.floor(s/60),s-=60*a,o=Math.floor(s),s-=o,i<10&&(i="0"+i),a<10&&(a="0"+a),o<10&&(o="0"+o),`${i}:${a}:${o}:${n}`}}},yv=vv,wv=(s("885f"),Object(S["a"])(yv,bv,fv,!1,null,"af8b2aea",null)),xv=wv.exports,Cv={label:"语音标注/多音轨",icon:"ios-image-outline",name:"z-audio-mult-stage",attributes:[{name:"src",label:"音频地址",value:"",type:String,vType:["url"]}],tools:[{type:"unShow"}],shortCuts:[{label:"播放",attributes:[{name:["Tab"],keys:[9],label:"播放/暂停",global:!0},{name:["esc"],keys:[27],label:"播放选中段",global:!0},{name:["h"],keys:[72],label:"隐藏/展示切分段",global:!0},{name:["ALT","->"],keys:[39],label:"快进",global:!0},{name:["ALT","<-"],keys:[37],label:"快退",global:!0},{name:["ALT","w"],keys:[18,87],label:"频谱放大",global:!0},{name:["ALT","q"],keys:[18,81],label:"频谱缩小",global:!0}]},{label:"语音切分",attributes:[{name:["ALT","s"],keys:[83],label:"切分起点"},{name:["ALT","x"],keys:[88],label:"切分终点"},{name:["ALT","m"],keys:[77],label:"音频段合并"},{name:["shift","标注对象"],keys:[16],label:"多选"},{name:["backspace"],keys:[8],label:"删除选中段"}]},{label:"语音转写",attributes:[{name:["ALT","enter"],keys:[13],label:"上一段",global:!0},{name:["shift","enter"],keys:[16,13],label:"下一段",global:!0}]}]},jv={metadata:Cv,components:{BaseLayout:Lp,AudioAnnotation:xv},mixins:[Re["a"]],props:{src:String},methods:{deleteObject(e){this.$refs.audioAnnotation.$emit("delete-object",e)}}},Ov=jv,kv=Object(S["a"])(Ov,mv,gv,!1,null,null,null),Av=kv.exports,Sv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{on:{"delete-object":e.deleteObject},scopedSlots:e._u([{key:"component",fn:function(){return[s("audio-annotation",{ref:"audioAnnotation",attrs:{src:e.src,$renderedComponentConfig:e.$renderedComponentConfig,type:"video"}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},_v=[],Iv={label:"语音标注/单音轨/视频转写",icon:"ios-image-outline",name:"z-video-tran-stage",attributes:[{name:"src",label:"音频地址",value:"",type:String,vType:["url"]}],tools:[{type:"audio/segment",label:"标注段",attributes:[{label:"标注段名称",name:"label",type:String,value:""},{label:"标注段标识",name:"name",type:String,required:!1,value(){return"audio_segment_"+(new Date).getTime()}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}},{label:"是否允许动态添加",name:"dynamic",type:Boolean,component:"z-switch",value:!1}],helps:[]}],shortCuts:[{label:"播放",attributes:[{name:["Tab"],keys:[9],label:"播放/暂停",global:!0},{name:["esc"],keys:[27],label:"播放选中段",global:!0},{name:["h"],keys:[72],label:"隐藏/展示切分段",global:!0},{name:["ALT","->"],keys:[39],label:"快进",global:!0},{name:["ALT","<-"],keys:[37],label:"快退",global:!0},{name:["ALT","w"],keys:[18,87],label:"频谱放大",global:!0},{name:["ALT","q"],keys:[18,81],label:"频谱缩小",global:!0}]},{label:"语音切分",attributes:[{name:["ALT","s"],keys:[83],label:"切分起点"},{name:["ALT","x"],keys:[88],label:"切分终点"},{name:["ALT","d"],keys:[68],label:"音频段切割"},{name:["ALT","m"],keys:[77],label:"音频段合并"},{name:["shift","标注对象"],keys:[16],label:"多选"},{name:["backspace"],keys:[8],label:"删除选中段"}]},{label:"语音转写",attributes:[{name:["ALT","enter"],keys:[13],label:"上一段",global:!0},{name:["shift","enter"],keys:[16,13],label:"下一段",global:!0}]}],objectAnswerJson:{description:"语音标注/单音轨/视频转写",type:"array",items:{type:"object",properties:{featureId:{type:"string"},type:{type:"string",const:"audio/segment"},name:{type:"string",enum:["default"]},label:{description:"可选字段，工具对应的名称",type:"string"},color:{description:"可选字段，工具对应的颜色",type:"string"},data:{type:"object",properties:{start:{description:"必须字段，起始位置",type:"string",pattern:"^([01][0-9]|2[0-3])(:[0-5][0-9]){2}:[0-9]{1,3}$"},end:{description:"必须字段，结束位置",type:"string",pattern:"^([01][0-9]|2[0-3])(:[0-5][0-9]){2}:[0-9]{1,3}$"}},required:["start","end"]},tags:{description:"二级标签",type:"array",items:{anyOf:[]}}},required:["featureId","type","name","label","color","data","tags"]}}},$v={metadata:Iv,components:{BaseLayout:Lp,AudioAnnotation:ud},mixins:[Re["a"]],props:{src:String},methods:{deleteObject(e){this.$refs.audioAnnotation.$emit("delete-object",e)}}},Mv=$v,Tv=Object(S["a"])(Mv,Sv,_v,!1,null,null,null),Ev=Tv.exports,Lv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0,showingStyle:{flex:"0 0 70%"}},scopedSlots:e._u([{key:"component",fn:function(){return[e.isComment?s("text-multiple-comment",e._b({ref:"textMultipleComment",attrs:{currentObject:e.currentObject,$renderedComponentConfig:e.$renderedComponentConfig}},"text-multiple-comment",e.$attrs,!1)):e.isLongTextAnnotation?s("long-text-multiple-annotation",e._b({ref:"longTextMultipleAnnotation",attrs:{currentObject:e.currentObject,$renderedComponentConfig:e.$renderedComponentConfig}},"long-text-multiple-annotation",e.$attrs,!1)):s("text-multiple-annotation",e._b({ref:"textMultipleAnnotation",attrs:{currentObject:e.currentObject,$renderedComponentConfig:e.$renderedComponentConfig}},"text-multiple-annotation",e.$attrs,!1))]},proxy:!0},{key:"objects",fn:function(){return[s("text-multiple-objects",{attrs:{objects:e.$optimus.objects,currentObject:e.currentObject,$renderedComponentConfig:e.$renderedComponentConfig},on:{"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Dv=[],Pv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-multiple-annotation"},[e.toolList.length>0?[s("div",{staticClass:"tools"},[s("div",{staticClass:"title",staticStyle:{color:"#2d8cf0"}},[e._v("标注工具栏")]),s("Input",{attrs:{placeholder:"输入关键词搜索工具"},model:{value:e.toolSearchVal,callback:function(t){e.toolSearchVal=t},expression:"toolSearchVal"}}),s("div",{staticClass:"content",staticStyle:{"margin-top":"10px"}},[s("RadioGroup",{staticClass:"toolGroup",model:{value:e.currentToolName,callback:function(t){e.currentToolName=t},expression:"currentToolName"}},e._l(e.toolShowLists,(function(t,i){return s("Radio",{key:t.name,attrs:{label:t.name,disabled:e.radioDisabled}},[s("span",{attrs:{title:t.label}},[e._v(e._s(t.label))]),s("div",{staticClass:"color",style:{backgroundColor:t.color}})])})),1)],1)],1)]:e._e(),s("div",{staticClass:"text-container"},[s("div",{staticClass:"font-size"},[s("KeywordHighlight",{staticStyle:{"margin-right":"170px"},attrs:{config:e.$renderedComponentConfig,render:e.keywordHighlightRender}}),s("TextFont",{attrs:{fontSize:e.fontSize},on:{"update:fontSize":function(t){e.fontSize=t},"update:font-size":function(t){e.fontSize=t}}}),s("TextLineHeight",{staticStyle:{"margin-right":"90px"},attrs:{lineHeight:e.lineHeight},on:{"update:lineHeight":function(t){e.lineHeight=t},"update:line-height":function(t){e.lineHeight=t}}})],1),s("div",{ref:"text_list",staticClass:"text-list"},e._l(e.innerTextList,(function(t){return s("Row",{key:t.id},[s("Col",{attrs:{span:"4"}},[s("span",{staticClass:"title"},[e._v(e._s(t[e.textTitle]))])]),s("Col",{staticClass:"text-item",attrs:{span:"20"}},[t[e.textContent]?s("copyButton",{staticClass:"copy-btn",attrs:{text:t[e.textContent]}}):e._e(),e.toolList.length>0?s("Div",{class:["text-content-"+t.id,"mark-content"],on:{mouseup:function(s){return e.handleSelectMouseUp(t.id)}}}):"html"===e.schemaText.string_type?s("span",{staticClass:"mark-content-text",class:"font-size"+e.fontSize+" line-height"+10*e.lineHeight,domProps:{innerHTML:e._s(t[e.textContent])}}):s("span",{staticClass:"mark-content-text",class:"font-size"+e.fontSize+" line-height"+10*e.lineHeight,domProps:{textContent:e._s(t[e.textContent])}})],1)],1)})),1)]),s("Modal",{attrs:{draggable:"",sticky:"",scrollable:"",mask:!1,closable:!1},model:{value:e.objectModal.showSelectMarkModel,callback:function(t){e.$set(e.objectModal,"showSelectMarkModel",t)},expression:"objectModal.showSelectMarkModel"}},[s("div",{staticClass:"modal-title",staticStyle:{display:"block"},attrs:{slot:"header"},slot:"header"},["text/ner_default"===e.currentTool.name?[s("span",[e._v("（请选择标注工具）")])]:s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("div",{staticClass:"color",style:{backgroundColor:e.currentTool.color}}),s("b",[e._v(e._s(e.currentTool.label))]),s("Col",{attrs:{flex:"auto"}},[e.currentTool.wordCount?s("div",{staticClass:"word-count"},[e._v("字数："+e._s(e.selectWords.length))]):e._e()])],1),s("Row",{staticClass:"mtm",staticStyle:{"line-height":"normal"},attrs:{align:"middle"}},[s("Col",[e._v(e._s(e.selectWords))])],1)],2),s("div",{staticClass:"modal-content",staticStyle:{"max-height":"500px","overflow-y":"auto"}},[[s("Form",{attrs:{"label-position":"top"}},[e.currentTool.searchTool?s("FormItem",{attrs:{label:"搜索引擎"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("搜索引擎")]),s("div",{staticClass:"tips",staticStyle:{display:"inline-block",color:"red",padding:"0 10px"}},[e._v(" 此项为快捷搜索引擎（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.search},model:{value:e.objectModal.searchVal,callback:function(t){e.$set(e.objectModal,"searchVal",t)},expression:"objectModal.searchVal"}},e._l(e.searchOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e(),e.currentTool.translateTool?s("FormItem",{attrs:{label:"翻译工具"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("翻译工具")]),s("div",{staticClass:"tips",staticStyle:{display:"inline-block",color:"red",padding:"0 10px"}},[e._v(" 此项为快捷翻译工具（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.translate},model:{value:e.objectModal.translateVal,callback:function(t){e.$set(e.objectModal,"translateVal",t)},expression:"objectModal.translateVal"}},e._l(e.translateOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e()],1),e.objectModal.showSelectMarkModel?s("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.objectModal.editAnswer[e.currentToolName],disabled:e.$optimus.disabled}}):e._e()]],2),s("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:e.handleLabelUpdateCancel}},[e._v("取消")]),s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.handleLabelUpdate}},[e._v("确认")])],1)])],2)},Bv=[],Rv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Dropdown",{staticClass:"select",attrs:{trigger:"click"},on:{"on-click":e.handleSelectSize}},[s("p",[e._v("行距: "+e._s(e.lineHeight)),s("Icon",{attrs:{type:"ios-arrow-down"}})],1),s("DropdownMenu",{staticClass:"select-content",attrs:{slot:"list"},slot:"list"},e._l(e.lineHeightList,(function(t){return s("DropdownItem",{key:t,staticClass:"select-option",attrs:{selected:e.lineHeight===t,name:t}},[e._v(e._s(t))])})),1)],1)},zv=[],Nv={name:"TextLineHeight",props:{lineHeight:{type:Number,default:2.5}},data(){return{lineHeightList:[1,1.5,2,2.5]}},mounted(){},created(){const e=localStorage.getItem("optimus-text-stage-line-height")||2.5;this.handleSelectSize(Number(e))},methods:{handleSelectSize(e){localStorage.setItem("optimus-text-stage-line-height",e),this.$emit("update:lineHeight",e)}}},Fv=Nv,Vv=(s("3747"),Object(S["a"])(Fv,Rv,zv,!1,null,"380de641",null)),qv=Vv.exports,Hv=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isInitOk?s("div",{staticClass:"keyword-highlight",class:!e.visible&&"no-visible"},[e.visible?s("Row",{attrs:{type:"flex",align:"middle"}},[s("div",{staticClass:"mrm"},[e._v("关键词高亮")]),s("Tooltip",{attrs:{content:"未配置关键词",disabled:!!e.configRelation.length}},[s("i-switch",{attrs:{disabled:!e.configRelation.length||e.loading,loading:e.loading,size:"small"},on:{"on-change":e.onChangeKeywordHighlight},model:{value:e.isKeywordHighlight,callback:function(t){e.isKeywordHighlight=t},expression:"isKeywordHighlight"}})],1)],1):e._e()],1):e._e()},Wv=[];let Uv=null,Qv={},Jv=null,Gv=[],Kv=[],Yv=[],Zv=!1;const Xv={div:"div.mark-container .text-render-container",tspan:"text.poplar-annotation-content",pre:".base_attribute_table .attribute-table-value .ivu-table-cell"},ey=async(e,t,s)=>(Uv=e,await Uv.$nextTick(()=>{if(!CSS.highlights)return void Uv.$Message.error("浏览器版本不支持高亮");if(Jv=s.offsetParent,!Jv)return;const e=Jv.getAttribute("name");Uv.configOpen&&Uv.configRelation.length&&(console.log("——————"),oy(),Qv[e+".div"]=Jv.querySelectorAll(Xv.div),Qv[e+".tspan"]=Jv.querySelectorAll(Xv.tspan),Qv[e+".pre"]=Jv.querySelectorAll(Xv.pre),Object.entries(Qv).forEach(e=>{e[1].forEach(t=>{Gv.push(...ty(t,e[0]))})}),Kv=sy(t),iy())}),!0),ty=(e,t)=>{if(Zv=!0,!e)return[];const s=window.performance.now(),i=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),a=[];let o=i.nextNode();while(o)a.push({el:o,text:o.textContent}),o=i.nextNode();const n=window.performance.now();return console.log(`初始化节点${t}用时：${(n-s).toFixed(2)}毫秒`),Zv=!1,a},sy=e=>{Zv=!0;const t=window.performance.now(),s=[];Uv.configRelation.forEach(t=>{switch(typeof t){case"string":var i;if(null===(i=e[t])||void 0===i||!i.length)return void Uv.$Message.error(`未找到名为${t}的关键词集合，请刷新`);s.push(...e[t].map(e=>({word:e.value,color:"random"})));break;case"object":if(t.tagset){var a;if(null===(a=e[t.tagset])||void 0===a||!a.length)return void Uv.$Message.error(`未找到名为${t.tagset}的关键词集合，请刷新`);s.push(...e[t.tagset].map(e=>({word:e.value,color:t.color||"random"})))}break}});const i=window.performance.now();return console.log(`初始化关键词用时：${(i-t).toFixed(2)}毫秒`),Zv=!1,s},iy=()=>{Zv=!0;const e=window.performance.now();let t="";Kv.forEach((e,s)=>{const{word:i,color:a}=e;let o=Gv.map(({text:e,el:t})=>{const s=[];let a=0;while(a<e.length){const t=e.indexOf(i,a);if(-1===t)break;s.push(t),a=t+i.length}return s.map(e=>{const s=new Range;return s.setStart(t,e),s.setEnd(t,e+i.length),s})});o=o.flat(),o.length&&(t=`#${Math.floor(16777215*Math.random()).toString(16).padEnd(6,"0")}80`,Yv.push({index:s,ranges:o,backgroundColor:a&&"random"!==a?a:t}))});const s=window.performance.now();console.log(`搜索用时：${(s-e).toFixed(2)}毫秒`),Zv=!1},ay=()=>{Zv=!0;const e=window.performance.now();let t=document.getElementById("keyword-highlight");if(t||(t=document.createElement("style"),t.setAttribute("id","keyword-highlight"),document.head.appendChild(t),console.log(`正在注册高亮样式表……共${Yv.length}项`)),!Yv.length)return void(Zv=!1);const{sheet:s}=t;Yv.forEach(({index:e,ranges:t,backgroundColor:i})=>{const a=new Highlight(...t),o=`::highlight(keyword-highlight-${e})`,n=`{\n      background-color: ${i};\n    }`;Object.values(s.cssRules).find(e=>e.selectorText===o)||s.insertRule(`${o} ${n}`),CSS.highlights.set("keyword-highlight-"+e,a)});const i=window.performance.now();console.log(`高亮渲染用时：${(i-e).toFixed(2)}毫秒，共${Yv.length}项`),Zv=!1},oy=()=>{Gv=[],Kv=[],Yv=[]},ny=()=>{Zv=!0,CSS.highlights.clear(),Zv=!1},ry=()=>{Zv=!0,ny(),oy(),Qv={};const e=document.querySelector("style#keyword-highlight");e&&(e.remove(),console.log("正在卸载高亮样式表……"+(null!==e&&void 0!==e&&e.sheet?"未卸载":"已卸载"))),Zv=!1};var ly={init:ey,open:ay,empty:oy,close:ny,remove:ry,loading:Zv},cy={mixins:[Re["a"]],props:{config:Object,render:Number},data(){let e=!0;const t=localStorage.getItem("optimus-keyword-highlight");return t&&(e=JSON.parse(t)),{visible:!1,isKeywordHighlight:e,keywordHighlightReady:!1}},computed:{loading(){return ly.loading},isInitOk(){const{configOpen:e,configRelation:t}=this;return e&&!(null===t||void 0===t||!t.length)&&!("complete"!==document.readyState)},configOpen(){const{attributes:e,$keyword_highlight:t}=this.config;return!!(null!==e&&void 0!==e&&e.isKeywordHighlight||null!==t&&void 0!==t&&t.open)},configRelation(){const{attributes:e,$keyword_highlight:t}=this.config;return(null===e||void 0===e?void 0:e.keywordHighlightRelation)||(null===t||void 0===t?void 0:t.relation)}},watch:{render(){this.keywordHighlightReady&&(ly.empty(),this.onRender())}},mounted(){var e;this.visible=!("template-edit"!==(null===(e=this.$route)||void 0===e?void 0:e.name)),this.$EventBus.$on("optimus-keyword-highlight",e=>{this.onTriggerRenderEngine(e)}),this.isInitOk?this.$nextTick(()=>{this.onRender()}):ly.close()},beforeDestroy(){this.$EventBus.$off("optimus-keyword-highlight"),ly.remove()},methods:{async onRender(){this.keywordHighlightReady=await ly.init(this,this.$optimus.context,this.$el),this.keywordHighlightReady&&this.isKeywordHighlight&&ly.open()},onChangeKeywordHighlight(e){localStorage.setItem("optimus-keyword-highlight",e),this.onTriggerRenderEngine(e)},onTriggerRenderEngine(e){this.isKeywordHighlight=e,e?ly.open():ly.close()}}},dy=cy,uy=(s("6cc3"),Object(S["a"])(dy,Hv,Wv,!1,null,"5176b4c4",null)),hy=uy.exports,py={components:{TextFont:Wr,TextLineHeight:qv,KeywordHighlight:hy,copyButton:wl},mixins:[Re["a"]],props:{textList:{type:[String,Array],default:""},textTitle:{type:String,default:""},textContent:{type:String,default:""},currentObject:{type:Object,default:null},isKeywordHighlight:Boolean,keywordHighlightRelation:Array},data(){var e;const t=null===(e=this.$optimus.component.attributes)||void 0===e?void 0:e.textList,s=t&&t.match(/^\${(.+)}$/);let i={};if(s){var o;const[,e]=s,t=e.replace("input.",""),n=Object(a["find"])(this.$optimus.schema,{key:t}),r=null===(o=this.$optimus.component.attributes)||void 0===o?void 0:o.textContent;r&&null!==n&&void 0!==n&&n.children&&(i=Object(a["find"])(n.children,{key:r}))}return{commonLabelCategories:[{id:"invisible-"+Object(n["j"])(8),text:"一二三四五六七八九十一二三四五六七八九十",color:"#fff",borderColor:"#fff"}],selectWords:"",objectModal:{showSelectMarkModel:!1,searchVal:"",translateVal:"",editAnswer:{}},currentToolName:"",toolSearchVal:"",action:"add",annotators:[],currentEditAnnotator:null,labelIdMap:new Map,startIndex:0,endIndex:0,objects:this.$optimus.objects,searchOption:n["s"],translateOption:n["u"],fontSize:14,lineHeight:2.5,schemaText:i,keywordHighlightRender:0}},computed:{componentConfig(){const e=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return!t||("all"===t||t===this.currentToolName)});return{component:"z-form-stage",items:e}},toolList(){return this.$renderedComponentConfig.$object_tools},toolListWithDefault(){return this.isToolSelected?this.$renderedComponentConfig.$object_tools:[{color:"#c2c2c2",label:"请选择标注工具",name:"text/ner_default",type:"text/ner"},...this.$renderedComponentConfig.$object_tools]},isToolSelected(){var e,t,s,i;return Object(a["isUndefined"])(null===(e=this.$renderedComponentConfig)||void 0===e||null===(t=e.extra_attributes)||void 0===t?void 0:t.isToolSelected)||(null===(s=this.$renderedComponentConfig)||void 0===s||null===(i=s.extra_attributes)||void 0===i?void 0:i.isToolSelected)},currentTool(){return this.currentToolName&&this.toolListWithDefault&&0!==this.toolListWithDefault.length?Object(a["find"])(this.toolListWithDefault,{name:this.currentToolName}):{}},innerTextList(){let e=[];if(Object(a["isString"])(this.textList)){if(""===this.textList)return e;try{e=JSON.parse(this.textList)}catch(t){console.error("[text-multiple] options出错",{textList:this.textList,e:t})}}return e.map(e=>({...e,id:Object(n["j"])(8)}))},toolShowLists(){return this.toolList.filter(e=>e.label.includes(this.toolSearchVal))},radioDisabled(){return this.$optimus.disabled||!this.isToolSelected&&!this.objectModal.showSelectMarkModel}},watch:{fontSize:{deep:!0,handler(e){e&&this.renderByObjects()}},lineHeight:{deep:!0,handler(e){e&&this.renderByObjects()}},"currentObject.featureId":{immediate:!0,deep:!0,handler(e){e&&this.renderByObjects()}}},mounted(){this.$refs.text_list.addEventListener("scroll",this.handleScroll,!0),this.$on("delete-object",e=>{this.removeItem(e)}),this.$optimus.$on("optimus:text-multiple-stage:edit",e=>{this.currentEditAnnotator=this.annotators.find(t=>{var s;return t.textTitle===(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.paragraph)}),this.editObject(e)}),this.toolListWithDefault.length>0&&(this.toolListWithDefault.forEach((e,t)=>{0===t&&(this.currentToolName=e.name);const{translateOpacity:s}=n["b"],i=s(e.color,.3),a={id:e.name,text:e.label,color:i,borderColor:i},o={id:e.name+"-selected",text:e.label,color:e.color,borderColor:"rgb(0,0,0)"};this.commonLabelCategories.push(a),this.commonLabelCategories.push(o)}),this.renderByObjects())},destroy(){this.$refs.text_list.removeEventListener("scroll",this.handleScroll),sessionStorage.removeItem("scroll")},methods:{handleScroll(e){sessionStorage.setItem("scroll",e.target.scrollTop)},getContent(e){return e.replace(/&/g,"＆").replace(/</g,"＜").replace(/>/g,"＞").replace(/(?<=[0-9]|[a-zA-Z]|[\u4e00-\u9fa5])\n(?=[0-9]|[a-zA-Z]|[\u4e00-\u9fa5])/g,"↵")},handleTextSelected(e,t,s){if(e===t)return;const{content:i}=s.store.json;if(this.currentEditAnnotator=s,this.startIndex=e,this.endIndex=t,this.selectWords=i.slice(e,t),!(this.selectWords.indexOf("\n")>-1))return this.isToolSelected?void(this.componentConfig.items&&this.componentConfig.items.length>0?(this.objectModal.showSelectMarkModel=!0,this.objectModal.editAnswer={},this.action="add"):(this.addObject([]),(this.currentTool.translateTool||this.currentTool.searchTool)&&(this.objectModal.showSelectMarkModel=!0,this.action="update"))):(this.addObject([]),this.objectModal.showSelectMarkModel=!0,this.objectModal.editAnswer={},void(this.action="add"));this.$Message.warning({content:"划词含有换行符，请分段标注!",duration:3})},handleSelectMouseUp(e){const t=window.getSelection(),s=this.annotators.find(t=>t.id===e);if(t.toString().length>0&&Object(n["i"])()){const{startIndex:e,endIndex:t}=Object(n["i"])();this.handleTextSelected(e,t,s)}},handleEventListener(e){!this.$optimus.disabled&&e.on("textSelected",(t,s)=>{this.handleTextSelected(t,s,e)}),e.on("labelClicked",t=>{this.currentEditAnnotator=e;const s=this.labelIdMap.get(e.textTitle),i=Object.keys(s).find(e=>s[e]===t),a=this.objects.find(e=>e.featureId===i);this.editObject(a)}),!this.$optimus.disabled&&e.on("labelRightClicked",t=>{this.currentEditAnnotator=e;const s=this.labelIdMap.get(e.textTitle),i=Object.keys(s).find(e=>s[e]===t);this.$Modal.confirm({title:"确定要删除？",content:i,onOk:()=>{this.$emit("delete-object",i)}})})},editObject(e){this.action="update",this.$optimus.$emit("optimus:text-multiple-stage:selectObj",e);const{name:t,tags:s,data:i}=e;this.objectModal.editAnswer={},this.objectModal.editAnswer[t]={tags:s},this.objectModal.showSelectMarkModel=!0,this.selectWords=i.text,this.currentToolName=t},removeItem(e){this.objects.forEach((t,s)=>{t.featureId===e&&this.objects.splice(s,1)}),this.handleLabelUpdateCancel(),this.$optimus.$emit("optimus:text-multiple-stage:selectObj",null),this.renderByObjects()},renderByObjects(){this.$nextTick(()=>{0!==this.toolList.length&&(this.annotators.forEach(e=>{e.remove()}),this.annotators=[])}),this.innerTextList.forEach((e,t)=>{const s=e[this.textTitle],i=Object(a["cloneDeep"])(this.commonLabelCategories),o=[],r=this.objects.filter(e=>e.data.paragraph===s);r.forEach(e=>{const t=this.getLabelCategoryTextByTags(e),{translateOpacity:s}=n["b"],a=s(e.color,.3),r={id:e.name,color:a,borderColor:a},l={id:e.name+"-selected",color:e.color,borderColor:"rgb(0,0,0)"};t&&(r.id=e.featureId,r.text=t,l.id=e.featureId+"-selected",l.text=t,i.push(r),i.push(l));const c={startIndex:e.data.location.startIndex,endIndex:e.data.location.endIndex,featureId:e.featureId,categoryId:r.id};o.push(c)});const l={content:this.getContent(this.innerTextList[t][this.textContent]),labelCategories:i,labels:[],connectionCategories:[],connections:[]};this.$nextTick(()=>{const e=this.innerTextList[t],i=new zr["Annotator"](JSON.stringify(l),document.querySelector(".text-content-"+e.id),{unconnectedLineStyle:"none",contentEditable:!1,contentClasses:["poplar-annotation-content","font-size"+this.fontSize],lineHeight:this.lineHeight||"normal"});i.textTitle=this.innerTextList[t][this.textTitle];const a={},{store:{labelRepo:n}}=i;o.forEach(e=>{var t,s;const{categoryId:o,featureId:r,startIndex:l,endIndex:c}=e;let d=o;"text/ner"===(null===(t=this.currentObject)||void 0===t?void 0:t.type)&&r===(null===(s=this.currentObject)||void 0===s?void 0:s.featureId)&&(d=o+"-selected");const u=n.nextId;i.applyAction(zr["Action"].Label.Create(d,l,c)),a[r]=u}),this.labelIdMap.set(s,a),this.$set(this.annotators,t,i),i.id=e.id,this.handleEventListener(i)})}),this.$nextTick((function(){sessionStorage.getItem("scroll")&&(this.$refs.text_list.scrollTop=sessionStorage.getItem("scroll")),this.keywordHighlightRender++}))},getLabelCategoryTextByTags(e){let t="";return this.$renderedComponentConfig.$object_items.forEach(s=>{s.isShow&&e.tags.forEach(e=>{if(e.name===s.attributes.name&&e.value){const s=Object(a["isArray"])(e.value)?e.value.join(",").trim():e.value.trim();t=t?`${t}/${s}`:s}})}),t},addObject(e){const{type:t,color:s,name:i,label:a,wordCount:o}=this.currentTool,r={location:{startIndex:this.startIndex,endIndex:this.endIndex},text:this.selectWords,paragraph:this.currentEditAnnotator.textTitle};o&&(r.textLength=this.selectWords.length);const l={type:t,featureId:"feature-"+Object(n["j"])(8),label:a,name:i,color:s,tags:e,data:r};this.isExistSameObject(l)?this.$Message.warning({content:"当前位置已存在相同实体词！",duration:3}):(this.objects.push(l),this.$optimus.$emit("optimus:text-multiple-stage:selectObj",l))},isExistSameObject(e){return this.objects.find(t=>{var s,i;const{startIndex:a,endIndex:o}=e.data.location||{},{startIndex:n,endIndex:r}=(null===(s=t.data)||void 0===s?void 0:s.location)||{};return"text/ner"===t.type&&a===n&&o===r&&e.data.paragraph===(null===(i=t.data)||void 0===i?void 0:i.paragraph)&&e.name===t.name&&e.featureId!==t.featureId})},getLabelId(e){let t=null;const{featureId:s,data:{paragraph:i}}=e,a=this.labelIdMap.get(i);return a&&(t=a[s]),t},handleLabelUpdate(){const{object:e,object:{tags:t}}=this.$refs,s=this.objects.find(e=>{var t;return e.featureId===(null===(t=this.currentObject)||void 0===t?void 0:t.featureId)});if(e.validate(),e.isValid)if("text/ner_default"!==this.currentToolName){if("update"===this.action){const{color:e,name:i,label:o}=this.currentTool,n=Object(a["cloneDeep"])(s);if(this.isExistSameObject({...n,name:i}))return void this.$Message.warning({content:"当前位置已存在相同实体词！",duration:3});s.tags=t,s.label=o,s.name=i,s.color=e,this.renderByObjects()}else this.addObject(t);this.handleLabelUpdateCancel()}else this.$Message.error("请选择标注工具!");else this.$Notice.error({title:"",desc:"",render:e=>e("span",["请完善必填项 "])})},handleLabelUpdateCancel(){if(this.objectModal.showSelectMarkModel=!1,this.objectModal.searchVal="",this.action="add",!this.isToolSelected){var e;this.currentToolName="text/ner_default";const t=null===(e=this.objects.find(e=>"text/ner_default"===e.name))||void 0===e?void 0:e.featureId;t&&this.removeItem(t)}},search(e){Object(n["r"])(e,this.selectWords),this.$nextTick(()=>{this.objectModal.searchVal=""})},translate(e){Object(n["t"])(e,this.selectWords),this.$nextTick(()=>{this.objectModal.translateVal=""})}}},my=py,gy=(s("cf75"),Object(S["a"])(my,Pv,Bv,!1,null,"418085a5",null)),by=gy.exports,fy=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-multiple-annotation"},[s("text-comment-tools",{attrs:{currentToolName:e.currentToolName,toolList:e.toolList},on:{"update:currentToolName":function(t){e.currentToolName=t},"update:current-tool-name":function(t){e.currentToolName=t}}}),s("div",{staticClass:"text-container"},[s("div",{staticClass:"font-size"},[s("KeywordHighlight",{staticStyle:{"margin-right":"170px"},attrs:{config:e.$renderedComponentConfig,render:e.keywordHighlightRender}}),s("TextFont",{attrs:{fontSize:e.fontSize},on:{"update:fontSize":function(t){e.fontSize=t},"update:font-size":function(t){e.fontSize=t}}}),s("TextLineHeight",{staticStyle:{"margin-right":"90px"},attrs:{lineHeight:e.lineHeight},on:{"update:lineHeight":function(t){e.lineHeight=t},"update:line-height":function(t){e.lineHeight=t}}})],1),s("div",{staticClass:"text-list"},e._l(e.innerTextList,(function(t){return s("Row",{key:t.id},[e._l(t,(function(i,a){return["id"!==a&&e.schemaTypeMapKeys.includes(a)?[a===e.textContent?s("Col",{staticClass:"mark-container",attrs:{span:e.schemaTypeMapKeys.length>2?24-2*(e.schemaTypeMapKeys.length-1):20}},[t[e.textContent]?s("copyButton",{staticClass:"copy-btn",attrs:{text:t[e.textContent]}}):e._e(),e.toolList.length>0?s("LongTextAnnotation",{attrs:{paragraph:t[e.textTitle],currentToolName:e.currentToolName,toolList:e.toolList,text:t[e.textContent],currentObject:e.currentObject,textSelectedData:e.textSelectedData,objectsCollection:e.objectsCollection,fontSize:e.fontSize,lineHeight:e.lineHeight},on:{"update:textSelectedData":function(t){e.textSelectedData=t},"update:text-selected-data":function(t){e.textSelectedData=t}}}):e._e()],1):a===e.textTitle?s("Col",{attrs:{span:e.schemaTypeMapKeys.length>2?2:4}},[s("span",{staticClass:"title"},[e._v(e._s(i))])]):"url"===e.schemaTypeMap[a].type&&e.schemaTypeMap[a].isLabelDisplay?s("Col",{attrs:{span:2}},[s("a",{staticClass:"title",staticStyle:{"word-break":"break-all"},attrs:{href:i,target:"_blank"}},[e._v(e._s(i))])]):e.schemaTypeMap[a].isLabelDisplay?s("Col",{attrs:{span:e.schemaTypeMapKeys.length>2?2:4}},[s("span",{staticClass:"title"},[e._v(e._s(i))])]):e._e()]:e._e()]}))],2)})),1)]),s("LongTextAnnotationModal",{attrs:{modalCollection:e.modalCollection,textSelectedData:e.textSelectedData,currentTool:e.currentTool,currentFeatureId:e.currentFeatureId,componentConfig:e.componentConfig,objectsCollection:e.objectsCollection}})],1)},vy=[],yy=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-render-container"},[s("div",{ref:e.textContainerId,staticClass:"text",style:"font-size: "+e.fontSize+"px; line-height: "+e.lineHeight+";",attrs:{id:e.textContainerId},on:{mouseup:e.handleSelectText,click:e.handleClickHightLight}},[e._v(e._s(e.text))])])},wy=[];function xy(e){const t=document.getSelection(),s=t.getRangeAt(0);let i=s.startContainer,{startOffset:a}=s,o=t.anchorNode.parentElement.closest(e);if(o||(o=t.anchorNode.parentElement.querySelector(e),!o&&t.anchorNode.matches&&t.anchorNode.matches(e)&&(o=t.anchorNode),o&&(i=o.firstChild,i.textContent||(i=i.nextSibling),a=0)),!o)return null;let n=0;const r=function(e){const t=[...e.childNodes];t.some(e=>{var t,s,o;const l=e.textContent;return!!l&&(e===i?(n+=a,!0):i.parentNode===e||(null===(t=i.parentNode)||void 0===t?void 0:t.parentNode)===e||(null===(s=i.parentNode)||void 0===s||null===(o=s.parentNode)||void 0===o?void 0:o.parentNode)===e?(r(e),!0):(n+=e.textContent.length,!1))})};r(o);const l=t.toString(),c=n+l.length,d=Object.fromEntries(Object.entries({...o.dataset}).filter(([e])=>/id$/.test(e)));return{...d,startIndex:n,endIndex:c,selectContent:l}}function Cy(e,t=0,s=0){const i=[],a=function(e){[...e].forEach(e=>{"#text"===e.nodeName?i.push(e):e.textContent&&a(e.childNodes)})};a(e.childNodes);let o=null,n=0,r=null,l=0,c=n;return i.forEach(e=>{if(o&&r)return;const{length:i}=e.textContent,a=[c,c+i];!o&&t>=a[0]&&t<a[1]&&(o=e,n=t-c),!r&&s>a[0]&&s<=a[1]&&(r=e,l=s-a[0]),c+=i}),o&&r?[o,n,r,l]:null}var jy={mixins:[Re["a"]],props:{currentToolName:{type:String,default:""},toolList:{type:Array},text:{type:String,default:""},currentObject:{type:Object,default:null},paragraph:{type:String,default:null},textSelectedData:{type:Object},objectsCollection:{type:Object},fontSize:{type:Number,default:14},lineHeight:{type:Number,default:2.5}},data(){return{}},computed:{currentTool(){return this.toolList.find(e=>(null===e||void 0===e?void 0:e.name)===(null===this||void 0===this?void 0:this.currentToolName))||{}},textContainerId(){let e="";const t=(e,t)=>Math.round(Math.random()*(t-e)+e);for(let o=0;o<6;o++){const s=t(1,2);switch(s){case 1:e+=String.fromCharCode(t(48,57));break;case 2:e+=String.fromCharCode(t(97,122));break}}const s=/[\u4e00-\u9fa5a-zA-Z0-9]/g,i=this.paragraph.match(s),a=i?i.join(""):"";return`text-container-${a}${e}`}},watch:{"objectsCollection.objects":{deep:!0,handler(){this.renderByObjects()}}},mounted(){this.$optimus.$on("optimus:text-multiple-stage:renderByObjects",()=>{this.renderByObjects()}),this.$optimus.$on("optimus:text-multiple-stage:edit",e=>{const t=document.querySelector(`[featureId=${e.featureId}]`);if(!t)return;if(t.scrollIntoView({block:"center"}),t.classList.contains("active"))return;const s=document.querySelector(".word.active");s&&this.setDefault(s),this.setActive(t)}),this.renderByObjects()},methods:{renderByObjects(){const e=this.$refs[this.textContainerId];this.handleResetContainer(e),this.objectsCollection.objects.filter(e=>{var t;return(null===(t=e.data)||void 0===t?void 0:t.paragraph)===this.paragraph}).forEach(t=>{var s;const{featureId:i,data:{location:{startIndex:a,endIndex:o}},color:n}=t,r=document.createRange(),l=Cy(e,a,o);if(!l)return;r.setStart(l[0],l[1]),r.setEnd(l[2],l[3]);const c=document.createElement("span");c.setAttribute("featureId",t.featureId),c.setAttribute("color",n),this.setDefault(c),(null===(s=this.currentObject)||void 0===s?void 0:s.featureId)===i&&this.setActive(c);try{r.surroundContents(c)}catch(d){console.error("存在不可高亮的元素，多半由于选区交叉导致"),this.$Message.error("由于选区交叉，出现不可高亮的元素")}})},handleResetContainer(e){try{const t=document.createTextNode(this.text);if(!e)return;while(e.firstChild)e.removeChild(e.firstChild);e.appendChild(t)}catch(t){console.log(t)}},handleSelectText(){const e=document.getSelection().toString();if(!e.trim())return;const{startOffset:t,endOffset:s}=document.getSelection().getRangeAt(0);if(console.log(t,s),t===s)return;const i=xy("#"+this.textContainerId);if(!i)return void this.$Message.warning({content:"请在对应文本区域内标注！",duration:3});const{startIndex:a,endIndex:o,selectContent:n}=i;if(console.log(a,o,n),this.$emit("update:textSelectedData",{startIndex:a,endIndex:o,selectedWords:n}),!this.isNeedResetContainer({startIndex:a,endIndex:o,selectedWords:e})&&!this.doRangeWrapHighLight())return void this.$Message.warning({content:"选区不支持交叉覆盖！",duration:3});const{addObjectBefore:r}=this.objectsCollection;r(this.paragraph)},handleClickHightLight(e){const t=e.target;if(!t.classList.contains("word"))return;if(t.classList.contains("active"))return;const s=t.getAttribute("featureId"),i=Object(a["find"])(this.objectsCollection.objects,{featureId:s});this.$optimus.$emit("optimus:text-multiple-stage:selectObj",i);const o=document.querySelector(".word.active");o&&this.setDefault(o),this.setActive(t)},setActive(e){e.className="word active";const t=e.getAttribute("color");e.setAttribute("style","background-color: "+t)},setDefault(e){e.className="word";const t=e.getAttribute("color"),{translateOpacity:s}=n["b"];e.setAttribute("style",`background-color: ${s(t,.3)};background-color: ''`)},doRangeWrapHighLight(){const e=document.getSelection(),t=e.getRangeAt(0),s=document.createElement("span");s.setAttribute("style","background-color: rgba(194, 194, 194, 0.7)");try{return t.surroundContents(s),!0}catch(i){return console.error("选区不支持交叉覆盖"),!1}},isNeedResetContainer({startIndex:e,endIndex:t,selectedWords:s}){const i=Object(a["findIndex"])(this.objectsCollection.objects,i=>(i.data.location.startIndex===e||i.data.location.endIndex===t)&&s.length>i.data.text.length);return-1!==i}}},Oy=jy,ky=(s("7919"),Object(S["a"])(Oy,yy,wy,!1,null,"5271621a",null)),Ay=ky.exports,Sy=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{closable:!1,draggable:"",sticky:"",scrollable:"",mask:!1},model:{value:e.modalCollection.objectModal.showModal,callback:function(t){e.$set(e.modalCollection.objectModal,"showModal",t)},expression:"modalCollection.objectModal.showModal"}},[s("div",{staticClass:"modal-title",attrs:{slot:"header"},slot:"header"},[s("Row",{attrs:{type:"flex",align:"middle",justify:"space-between"}},[s("div",{staticClass:"color",style:{backgroundColor:e.currentTool.color}}),s("b",{staticClass:"label"},[e._v(e._s(e.currentTool.label))]),s("Col",{attrs:{flex:"auto"}},[e.currentTool.wordCount?s("div",{staticClass:"word-count"},[e._v("字数："+e._s(e.textSelectedData.selectedWords.length))]):e._e()])],1),s("Row",{staticClass:"mtm",staticStyle:{"line-height":"normal"},attrs:{align:"middle"}},[s("Col",{staticClass:"content",attrs:{title:e.textSelectedData.selectedWords}},[e._v(e._s(e.textSelectedData.selectedWords))])],1)],1),s("div",{staticClass:"modal-content"},[[s("Form",{attrs:{"label-position":"top"}},[e.currentTool.searchTool?s("FormItem",{attrs:{label:"搜索引擎"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("搜索引擎")]),s("div",{staticClass:"tips"},[e._v("此项为快捷搜索引擎（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.search},model:{value:e.modalCollection.objectModal.searchVal,callback:function(t){e.$set(e.modalCollection.objectModal,"searchVal",t)},expression:"modalCollection.objectModal.searchVal"}},e._l(e.searchOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e(),e.currentTool.translateTool?s("FormItem",{attrs:{label:"翻译工具"}},[s("div",{staticClass:"label",attrs:{slot:"label"},slot:"label"},[s("span",[e._v("翻译工具")]),s("div",{staticClass:"tips",staticStyle:{display:"inline-block",color:"red",padding:"0 10px"}},[e._v(" 此项为快捷翻译工具（非标注标签）")])]),s("RadioGroup",{attrs:{type:"button"},on:{"on-change":e.translate},model:{value:e.modalCollection.objectModal.translateVal,callback:function(t){e.$set(e.modalCollection.objectModal,"translateVal",t)},expression:"modalCollection.objectModal.translateVal"}},e._l(e.translateOption,(function(e){return s("Radio",{key:e.label,attrs:{label:e.label}})})),1)],1):e._e()],1),e.modalCollection.objectModal.showModal?s("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.modalCollection.objectModal.answer,disabled:e.$optimus.disabled}}):e._e()]],2),s("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:e.handleLabelUpdateCancel}},[e._v("取消")]),s("Button",{attrs:{type:"primary",disabled:e.$optimus.disabled},on:{click:e.handleLabelUpdate}},[e._v("确认")])],1)])},_y=[],Iy={name:"TextCommentModal",mixins:[Re["a"]],props:{modalCollection:{type:Object},currentTool:{type:Object},textSelectedData:{type:Object},componentConfig:{type:Object},objectsCollection:{type:Object},currentFeatureId:{type:String},fontFamily:{type:String,default:"默认字体"}},data(){return{searchOption:n["s"],translateOption:n["u"]}},computed:{},methods:{search(e){Object(n["r"])(e,this.textSelectedData.selectedWords),this.$nextTick(()=>{this.modalCollection.objectModal.searchVal=""})},translate(e){Object(n["t"])(e,this.textSelectedData.selectedWords),this.$nextTick(()=>{this.modalCollection.objectModal.translateVal=""})},handleLabelUpdate(){const{object:e,object:{tags:t}}=this.$refs,{action:s}=this.modalCollection.objectModal;if(e.validate(),!e.isValid)return void this.$Notice.error({title:"",desc:"",render:e=>e("span",["请完善必填项 "])});if("text/ner_default"===this.currentToolName)return void this.$Message.error("请选择标注工具!");const{addObject:i,generateObject:a,updateObject:o,objects:n}=this.objectsCollection;if("add"===s)i(a(t));else{const e=null===n||void 0===n?void 0:n.find(e=>e.featureId===this.currentFeatureId);o({...e,tags:t})}this.handleLabelUpdateCancel()},handleLabelUpdateCancel(){const{action:e}=this.modalCollection.objectModal;"add"===e&&this.$optimus.$emit("optimus:text-multiple-stage:renderByObjects"),this.modalCollection.objectModal.showModal=!1,this.modalCollection.resetObjectModal()}}},$y=Iy,My=(s("409a"),Object(S["a"])($y,Sy,_y,!1,null,"8aa52736",null)),Ty=My.exports;const Ey={searchVal:void 0,translateVal:void 0,showModal:!1,answer:{},action:"add"};var Ly={components:{LongTextAnnotation:Ay,TextCommentTools:Gl,LongTextAnnotationModal:Ty,TextFont:Wr,TextLineHeight:qv,KeywordHighlight:hy,copyButton:wl},mixins:[Re["a"]],props:{textTitle:{type:String,default:""},textContent:{type:String,default:""},textList:{type:[String,Array],default:""},currentObject:{type:Object,default:null}},data(){return{fontSize:14,lineHeight:2.5,paragraph:"",currentToolName:"",currentFeatureId:"",objectModal:Ey,objects:this.$optimus.objects||[],textSelectedData:{startIndex:0,endIndex:0,selectedWords:""},keywordHighlightRender:0}},computed:{schemaTypeMap(){const e=this.$optimus.schema.filter(e=>e.children&&e.children.length>0||e.element_schema&&e.element_schema.length>0),t={},s=e[0].children?e[0].children:e[0].element_schema;return null===s||void 0===s||s.forEach(e=>{const{key:s,isLabelDisplay:i,type:a}=e;t[s]={isLabelDisplay:null!==i&&void 0!==i&&i,type:a}}),t},schemaTypeMapKeys(){return Object.keys(this.schemaTypeMap)},objectsCollection(){return{objects:this.objects,generateObject:this.generateObject,addObjectBefore:this.addObjectBefore,addObject:this.addObject,updateObjectBefore:this.updateObjectBefore,updateObject:this.updateObject,deleteObject:this.deleteObject}},modalCollection(){return{objectModal:this.objectModal,resetObjectModal:this.resetObjectModal}},toolList(){var e;return null===(e=this.$renderedComponentConfig.$object_tools)||void 0===e?void 0:e.filter(e=>"text/ner"===(null===e||void 0===e?void 0:e.type))},currentTool(){return this.toolList.find(e=>(null===e||void 0===e?void 0:e.name)===(null===this||void 0===this?void 0:this.currentToolName))||{}},componentConfig(){const e=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return!t||("all"===t||t===this.currentToolName)});return{component:"z-form-stage",items:e}},innerTextList(){let e=[];if(Object(a["isString"])(this.textList)){if(""===this.textList)return e;try{e=JSON.parse(this.textList)}catch(t){console.error("[text-multiple] options出错",{textList:this.textList,e:t})}}return e.map(e=>({...e,id:Object(n["j"])(8)}))}},mounted(){this.$on("delete-object",e=>{this.deleteObject(e)}),this.$optimus.$on("optimus:text-multiple-stage:edit",e=>{this.updateObjectBefore(e.featureId)})},methods:{resetObjectModal(){this.objectModal=Ey},generateObject(e){const{type:t,color:s,name:i,label:a,wordCount:o}=this.currentTool,{startIndex:r,endIndex:l,selectedWords:c}=this.textSelectedData,d={location:{startIndex:r,endIndex:l},text:c,paragraph:this.paragraph};o&&(d.textLength=c.length);const u="feature-"+Object(n["j"])(8);return{type:t,featureId:u,label:a,name:i,color:s,tags:e,data:d}},addObjectBefore(e){var t;this.paragraph=e,(null===(t=this.componentConfig.items)||void 0===t?void 0:t.length)>0?this.objectModal={...this.objectModal,showModal:!0,action:"add"}:((this.currentTool.searchTool||this.currentTool.translateTool)&&(this.objectModal.showModal=!0,this.objectModal.action="update"),this.addObject(this.generateObject([])))},addObject(e){this.isExistSameObject(e)?this.$Message.warning({content:"当前位置已存在相同批注！",duration:3}):(this.handleSortObject(e),this.$optimus.$emit("optimus:text-multiple-stage:selectObj",e),this.currentFeatureId=e.featureId,this.keywordHighlightRender+=1)},handleSortObject(e){const{data:{text:t,location:{startIndex:s,endIndex:i}}}=e,o=Object(a["findIndex"])(this.objects,e=>(e.data.location.startIndex===s||e.data.location.endIndex===i)&&t.length>e.data.text.length);-1!==o?this.objects.splice(o,0,e):this.objects.push(e)},updateObjectBefore(e){this.currentFeatureId=e;const t=this.objects.find(t=>(null===t||void 0===t?void 0:t.featureId)===e),{location:{startIndex:s,endIndex:i},text:a}=null===t||void 0===t?void 0:t.data;this.currentToolName=t.name,this.textSelectedData={startIndex:s,endIndex:i,selectedWords:a},this.$optimus.$emit("optimus:text-multiple-stage:selectObj",t),this.objectModal={...this.objectModal,showModal:!0,action:"update",answer:{tags:null===t||void 0===t?void 0:t.tags}}},updateObject(e){if(this.isExistSameObject({...e,...this.currentTool}))return void this.$Message.warning({content:"当前位置已存在相同批注！",duration:3});const t=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.featureId)===(null===e||void 0===e?void 0:e.featureId));this.objects.splice(t,1,{...e,...this.currentTool}),this.keywordHighlightRender+=1},deleteObject(e){const t=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.featureId)===e);this.objects.splice(t,1),this.$optimus.$emit("optimus:text-multiple-stage:selectObj",null),this.keywordHighlightRender+=1},isExistSameObject(e){return this.objects.find(t=>{var s,i;const{startIndex:a,endIndex:o}=e.data.location||{},{startIndex:n,endIndex:r}=(null===(s=t.data)||void 0===s?void 0:s.location)||{};return"text/ner"===t.type&&a===n&&o===r&&e.data.paragraph===(null===(i=t.data)||void 0===i?void 0:i.paragraph)&&e.name===t.name&&e.featureId!==t.featureId})}}},Dy=Ly,Py=(s("6f05"),Object(S["a"])(Dy,fy,vy,!1,null,"2111df9c",null)),By=Py.exports,Ry=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-multiple-annotation"},[s("text-comment-tools",{attrs:{currentToolName:e.currentToolName,toolList:e.toolList},on:{"update:currentToolName":function(t){e.currentToolName=t},"update:current-tool-name":function(t){e.currentToolName=t}}}),s("div",{staticClass:"text-container"},[s("div",{staticClass:"font-size"},[s("TextFont",{attrs:{fontSize:e.fontSize},on:{"update:fontSize":function(t){e.fontSize=t},"update:font-size":function(t){e.fontSize=t}}}),s("TextLineHeight",{staticStyle:{"margin-right":"90px"},attrs:{lineHeight:e.lineHeight},on:{"update:lineHeight":function(t){e.lineHeight=t},"update:line-height":function(t){e.lineHeight=t}}})],1),s("div",{staticClass:"text-list"},e._l(e.innerTextList,(function(t){return s("Row",{key:t.id},[e._l(t,(function(i,a){return["id"!==a?[a===e.textContent?s("Col",{staticClass:"mark-container",attrs:{span:"20"}},[t[e.textContent]?s("copyButton",{staticClass:"copy-btn",attrs:{text:t[e.textContent]}}):e._e(),e.toolList.length>0?s("text-comment-content",{attrs:{paragraph:t[e.textTitle],currentToolName:e.currentToolName,toolList:e.toolList,text:t[e.textContent],currentObject:e.currentObject,textSelectedData:e.textSelectedData,objectsCollection:e.objectsCollection,fontSize:e.fontSize,fontFamily:e.fontFamily,maxLength:e.maxLength,lineHeight:e.lineHeight},on:{"update:textSelectedData":function(t){e.textSelectedData=t},"update:text-selected-data":function(t){e.textSelectedData=t}}}):e._e()],1):a===e.textTitle?s("Col",{attrs:{span:"4"}},[s("span",{staticClass:"title"},[e._v(e._s(i))])]):e.schemaTypeMap[a].isLabelDisplay&&"url"===e.schemaTypeMap[a].type?s("Col",{attrs:{span:"4"}},[s("a",{staticClass:"title",staticStyle:{"word-break":"break-all"},attrs:{href:i,target:"_blank"}},[e._v(e._s(i))])]):e.schemaTypeMap[a].isLabelDisplay?s("Col",{attrs:{span:"4"}},[s("span",{staticClass:"title"},[e._v(e._s(i))])]):e._e()]:e._e()]}))],2)})),1)]),s("text-comment-modal",{attrs:{modalCollection:e.modalCollection,textSelectedData:e.textSelectedData,currentTool:e.currentTool,currentFeatureId:e.currentFeatureId,componentConfig:e.componentConfig,objectsCollection:e.objectsCollection,fontFamily:e.fontFamily}})],1)},zy=[];const Ny={searchVal:void 0,translateVal:void 0,showModal:!1,answer:{},action:"add"};var Fy={name:"TextComment",components:{TextCommentContent:ql,TextCommentTools:Gl,TextCommentModal:tc,TextFont:Wr,TextLineHeight:qv,copyButton:wl},mixins:[Re["a"]],props:{textTitle:{type:String,default:""},textContent:{type:String,default:""},textList:{type:[String,Array],default:""},currentObject:{type:Object,default:null},fontFamily:{type:String,default:"默认字体"},pageMaxLength:{type:[Number,String],default:1e3}},data(){return{fontSize:14,lineHeight:2.5,paragraph:"",currentToolName:"",currentFeatureId:"",objectModal:Ny,objects:this.$optimus.objects||[],textSelectedData:{startIndex:0,endIndex:0,selectedWords:""},currentPage:1}},computed:{maxLength(){return Number(this.pageMaxLength)},schemaTypeMap(){const e=this.$optimus.schema.filter(e=>e.children&&e.children.length>0||e.element_schema&&e.element_schema.length>0),t={},s=e[0].children?e[0].children:e[0].element_schema;return null===s||void 0===s||s.forEach(e=>{const{key:s,isLabelDisplay:i,type:a}=e;t[s]={isLabelDisplay:i,type:a}}),t},objectsCollection(){return{objects:this.objects,generateObject:this.generateObject,addObjectBefore:this.addObjectBefore,addObject:this.addObject,updateObjectBefore:this.updateObjectBefore,updateObject:this.updateObject,deleteObjectBefore:this.deleteObjectBefore,deleteObject:this.deleteObject}},modalCollection(){return{objectModal:this.objectModal,resetObjectModal:this.resetObjectModal}},toolList(){var e;return null===(e=this.$renderedComponentConfig.$object_tools)||void 0===e?void 0:e.filter(e=>"text/ner"===(null===e||void 0===e?void 0:e.type))},currentTool(){return this.toolList.find(e=>(null===e||void 0===e?void 0:e.name)===(null===this||void 0===this?void 0:this.currentToolName))||{}},componentConfig(){const e=this.$renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return!t||("all"===t||t===this.currentToolName)});return{component:"z-form-stage",items:e}},innerTextList(){let e=[];if(Object(a["isString"])(this.textList)){if(""===this.textList)return e;try{e=JSON.parse(this.textList)}catch(t){console.error("[text-multiple] options出错",{textList:this.textList,e:t})}}return e.map(e=>({...e,id:Object(n["j"])(8)}))}},mounted(){this.$on("delete-object",e=>{this.deleteObject(e)}),this.$optimus.$on("optimus:text-multiple-stage:edit",e=>{this.updateObjectBefore(e.featureId)})},methods:{resetObjectModal(){this.objectModal=Ny},isExistSameObject(e){return this.objects.find(t=>{var s,i;const{startIndex:a,endIndex:o}=e.data.location||{},{startIndex:n,endIndex:r}=(null===(s=t.data)||void 0===s?void 0:s.location)||{};return"text/ner"===t.type&&a===n&&o===r&&e.data.paragraph===(null===(i=t.data)||void 0===i?void 0:i.paragraph)&&e.name===t.name&&e.featureId!==t.featureId})},generateObject(e){const{type:t,color:s,name:i,label:a,wordCount:o}=this.currentTool,{startIndex:r,endIndex:l,selectedWords:c}=this.textSelectedData,d={location:{startIndex:r+this.maxLength*(this.currentPage-1),endIndex:l+this.maxLength*(this.currentPage-1)},text:c,paragraph:this.paragraph};o&&(d.textLength=c.length);const u="feature-"+Object(n["j"])(8);return{type:t,featureId:u,label:a,name:i,color:s,tags:e,data:d}},addObjectBefore(e,t){var s;this.paragraph=e,this.currentPage=t,(null===(s=this.componentConfig.items)||void 0===s?void 0:s.length)>0?this.objectModal={...this.objectModal,showModal:!0,action:"add"}:(this.addObject(this.generateObject([])),(this.currentTool.searchTool||this.currentTool.translateTool)&&(this.objectModal.showModal=!0,this.objectModal.action="update"))},addObject(e){this.isExistSameObject(e)?this.$Message.warning({content:"当前位置已存在相同批注！",duration:3}):(this.objects.push(e),this.$optimus.$emit("optimus:text-multiple-stage:selectObj",e),this.currentFeatureId=e.featureId)},updateObjectBefore(e){this.currentFeatureId=e;const t=this.objects.find(t=>(null===t||void 0===t?void 0:t.featureId)===e),{location:{startIndex:s,endIndex:i},text:a}=null===t||void 0===t?void 0:t.data;this.currentToolName=t.name,this.textSelectedData={startIndex:s,endIndex:i,selectedWords:a},this.$optimus.$emit("optimus:text-multiple-stage:selectObj",t),this.objectModal={...this.objectModal,showModal:!0,action:"update",answer:{tags:null===t||void 0===t?void 0:t.tags}}},updateObject(e){if(this.isExistSameObject({...e,...this.currentTool}))return void this.$Message.warning({content:"当前位置已存在相同批注！",duration:3});const t=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.featureId)===(null===e||void 0===e?void 0:e.featureId));this.objects.splice(t,1,{...e,...this.currentTool})},deleteObjectBefore(e){this.$Modal.confirm({title:"确定要删除当前标签？",content:e,onOk:()=>{this.deleteObject(e),this.$optimus.$emit("optimus:text-multiple-stage:selectObj",null)}})},deleteObject(e){const t=this.objects.findIndex(t=>(null===t||void 0===t?void 0:t.featureId)===e);this.objects.splice(t,1)}}},Vy=Fy,qy=(s("fd0f"),Object(S["a"])(Vy,Ry,zy,!1,null,"677d530a",null)),Hy=qy.exports,Wy=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.isEmpty(e.myObjects)?e._e():s("Collapse",{attrs:{value:e.openAll}},e._l(e.myObjects,(function(t,i){return s("Panel",{key:i,attrs:{name:i}},[e._v(e._s(t.label)+"("+e._s(t.objects.length)+")"),e._l(t.objects,(function(t,i){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.currentObject&&e.currentObject.featureId===t.featureId},attrs:{slot:"content",type:"flex",justify:"space-between",wrap:!1},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("Row",{attrs:{type:"flex",justify:"start",align:"middle",wrap:!1}},[t.color?s("div",{staticClass:"color",style:{backgroundColor:t.color}}):e._e(),s("div",{staticClass:"feature-title"},[s("span",[e._v(e._s(t.label)+e._s(i+1))])])]),s("Row",{staticClass:"feature-desc",attrs:{type:"flex",justify:"space-between",align:"middle",wrap:!1}},[s("Col",{staticClass:"sub",style:e.myFontFamily},[e._v(e._s(e.getText(t)))]),e.currentTool(t)&&e.currentTool(t)["wordCount"]?s("Col",{staticClass:"count"},[s("span",[e._v("字数："+e._s(e.getText(t).length))])]):e._e()],1)],1),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t,i)}}})],1)],1)}))],2)})),1)],1)])},Uy=[],Qy={mixins:[Re["a"]],props:{currentObject:{type:Object,default:null},fontFamily:{type:String,default:"默认字体"}},data(){const{objects:e}=this.$optimus;return{isEmpty:a["isEmpty"],objects:e,objectModal:{visible:!1,model:null},objectFormComponent:{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}}},computed:{myFontFamily(){return"默认字体"===this.fontFamily?{}:{fontFamily:J(this.fontFamily),fontSize:"20px"}},myObjects(){const e={};return this.objects.forEach(t=>{const{name:s,label:i}=t;e[t.name]?e[s].objects.push(t):e[s]={label:i,objects:[t]}}),e},openAll(){return Object.keys(this.myObjects).map(e=>e)},toolList(){var e;return null===(e=this.$renderedComponentConfig.$object_tools)||void 0===e?void 0:e.filter(e=>"text/ner"===(null===e||void 0===e?void 0:e.type))},currentTool(){return function(e){return this.toolList.find(t=>(null===t||void 0===t?void 0:t.name)===e.name)||{}}}},created(){this.objects.length>0&&this.selectObject(Object(a["head"])(this.objects))},mounted(){this.$optimus.disabled||document.addEventListener("keydown",this.listenKeyboardEvent)},destroy(){document.removeEventListener("keydown",this.listenKeyboardEvent)},methods:{getText(e){var t;return null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.text},editObject(e){this.selectObject(e),this.$optimus.$emit("optimus:text-multiple-stage:edit",e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e.featureId)}})},listenKeyboardEvent:Object(a["debounce"])((function(e){const{code:t,ctrlKey:s}=e;s&&"KeyD"===t&&this.deleteActiveObj()}),200),deleteActiveObj(){if(this.currentObject){const e=this.objects.find(e=>e.featureId===this.currentObject.featureId);this.removeObject(e)}},selectObject(e){this.$optimus.$emit("optimus:text-multiple-stage:selectObj",e)}}},Jy=Qy,Gy=(s("462c"),Object(S["a"])(Jy,Wy,Uy,!1,null,"774f2d8c",null)),Ky=Gy.exports,Yy={label:"多段文本标注",name:"z-text-multiple-stage",repeatable:!0,attributes:[{label:"文本内容(需包含text_title, text_content)",name:"textList",type:String,required:!0,value:"",vType:["array","string"]},{name:"textTitle",label:"文本分段标题",type:String,value:"text_title",vType:["string"]},{name:"textContent",label:"文本分段内容",type:String,value:"text_content",vType:["string"]},{name:"pageMaxLength",label:"每段文本每页最大长度(仅批注场景有效)",type:Number,value:1e3,vType:["number"]},{label:"标注的文本字体",name:"fontFamily",type:String,required:!0,value:"默认字体",vType:["string"],component:"z-single-select",attributes:{basicMode:!0,options:[{label:"默认字体",value:"默认字体"},{label:"哈语(ALKATIP Asliya.ttf)",value:"哈语(ALKATIP Asliya.ttf)"},{label:"维语(ALKATIP-Basma-Tom.ttf)",value:"维语(ALKATIP-Basma-Tom.ttf)"},{label:"藏语(microsoft-himalaya.ttf)",value:"藏语(microsoft-himalaya.ttf)"}],exhibit:"dropdown"}},{label:"是否关键词高亮",name:"isKeywordHighlight",type:Boolean,component:"z-switch",value:!1,attributes:{enableExpression:!1}},{label:"高亮配置",name:"keywordHighlightRelation",type:Array,component:"z-keyword-highlight-config",value:[],attributes:{isVisible:"${!!output.isKeywordHighlight}"}}],tools:[{type:"text/ner",label:"内容标记",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return`text_ner_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"标签颜色",name:"color",type:String,component:"z-color-picker",value(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).substr(-6)}}]}],objectAnswerJson:{description:"多段文本标注",type:"array",items:{type:"object",properties:{featureId:{type:"string"},type:{type:"string",const:"text/ner"},name:{type:"string",enum:[]},label:{description:"可选字段，工具对应的名称",type:"string"},color:{description:"可选字段，工具对应的颜色",type:"string"},data:{type:"object",properties:{location:{type:"object",properties:{startIndex:{description:"必须字段，起始位置",type:"integer"},endIndex:{description:"必须字段，结束位置",type:"integer"}},required:["startIndex","endIndex"]},text:{description:"非必需字段，文字内容",type:"string"},paragraph:{description:"必需字段",type:"string"}},required:["location","paragraph"]},tags:{description:"二级标签",type:"array",items:{anyOf:[]}}},required:["featureId","type","name","label","data","tags"]}}},Zy={metadata:Yy,components:{TextMultipleAnnotation:by,LongTextMultipleAnnotation:By,TextMultipleComment:Hy,BaseLayout:Lp,TextMultipleObjects:Ky},mixins:[Re["a"]],inheritAttrs:!1,data(){return{currentObject:null}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},isComment(){var e;return"批注"===(null===(e=this.$renderedComponentConfig.extra_attributes)||void 0===e?void 0:e.scene)&&this.$renderedComponentConfig.$object_tools.length>0},isLongTextAnnotation(){var e;return"长文本划词"===(null===(e=this.$renderedComponentConfig.extra_attributes)||void 0===e?void 0:e.scene)&&this.$renderedComponentConfig.$object_tools.length>0}},mounted(){this.$optimus.$on("optimus:text-multiple-stage:selectObj",e=>{this.currentObject=e})},methods:{deleteObject(e){this.isComment?this.$refs.textMultipleComment.$emit("delete-object",e):this.isLongTextAnnotation?this.$refs.longTextMultipleAnnotation.$emit("delete-object",e):this.$refs.textMultipleAnnotation.$emit("delete-object",e)}}},Xy=Zy,ew=Object(S["a"])(Xy,Lv,Dv,!1,null,null,null),tw=ew.exports,sw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[s("MultipleAnnotation",{ref:"multipleAnnotation",attrs:{$renderedComponentConfig:e.$renderedComponentConfig,title:e.title,labelObjects:e.labelObjects,objectType:e.objectType,objectName:e.objectName,objectUrl:e.objectUrl},on:{"select-object":e.selectObjectByMultiple}})]},proxy:!0},{key:"objects",fn:function(){return[s("SelectObjects",{ref:"selectObjects",attrs:{$renderedComponentConfig:e.$renderedComponentConfig},on:{"edit-object":e.editObjectById,"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},iw=[],aw={label:"批量对象标注",icon:"ios-image-outline",name:"z-multiple-select-stage",attributes:[{name:"title",label:"题目名称",type:String,value:"",vType:["string"]},{name:"labelObjects",label:"数据源(需包含object_name, object_url)",type:String,value:"",vType:["array","string"]},{name:"objectType",label:"对象类型",value:"image",component:"z-single-select",attributes:{options:[{label:"图片",value:"image"}]}},{name:"objectUrl",label:"对象地址字段名",type:String,value:"object_url",vType:["string"]},{name:"objectName",label:"对象名称字段名",type:String,value:"object_name",vType:["string"]}],tools:[{type:"objects/object",label:"选择标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"objects_object_"+(new Date).getTime()}}]}]},ow=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"multiple-select-annotation"},[s("Row",[s("Col",{attrs:{span:"24"}},[s("h2",{staticClass:"question-title"},[s("span",[e._v("题目名称: "+e._s(e.title))])])])],1),s("Divider"),s("Row",{staticClass:"label-container"},[s("Col",{attrs:{span:"24"}},[s("div",{staticClass:"tool-container"},[s("div",{staticClass:"tool-item"},[s("div",{staticClass:"tool-title"},[e._v("标注结果展示")]),s("RadioGroup",{attrs:{type:"button","button-style":"solid"},on:{"on-change":e.toolLabelTypeChange},model:{value:e.objectLabelType,callback:function(t){e.objectLabelType=t},expression:"objectLabelType"}},[s("Radio",{attrs:{label:"modal"}},[e._v("弹窗")]),s("Radio",{attrs:{label:"expand"}},[e._v("平铺")])],1)],1),s("div",{staticClass:"tool-item"},[s("div",{staticClass:"tool-title"},[e._v("缩放图片大小")]),s("Slider",{staticClass:"scale-tool",attrs:{min:0,max:10,"show-tip":"never"},on:{"on-input":e.imageScaleInput,"on-change":e.imageScaleChange},model:{value:e.imageScale,callback:function(t){e.imageScale=t},expression:"imageScale"}})],1)]),s("div",{staticClass:"labelObjects-container"},e._l(e.myLabelObjects,(function(t,i){return s("div",{staticClass:"object-item",class:{isSelect:e.selectIndex===i},on:{click:function(t){return e.handleSelect(i)}}},[s("Tooltip",{staticClass:"object-tooltip",attrs:{"max-width":"200",content:t[e.objectName],placement:"bottom"}},[s("span",{staticClass:"name-box ellipsis"},[e._v(e._s(t[e.objectName]))])]),s("Divider",{staticClass:"label-divider"}),s("div",{staticClass:"object-content"},[s("safeImage",{key:t[e.objectUrl],staticClass:"image-item",attrs:{src:t[e.objectUrl],fit:"contain","show-viewer":!1}})],1),s("Divider",{staticClass:"label-divider"}),e.$optimus.disabled?[e.markedIndex.includes(i)?["modal"===e.objectLabelType?s("span",[e._v("查看标注")]):e._e(),"expand"===e.objectLabelType?s("div",{staticClass:"mark-content"},[s("optimus-engine",{attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.markAnswer[i],disabled:e.$optimus.disabled}})],1):e._e()]:e._e()]:[e.markedIndex.includes(i)?["modal"===e.objectLabelType?s("span",[e._v("编辑标注")]):e._e(),"expand"===e.objectLabelType?s("div",{staticClass:"mark-content"},[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:i,expression:"index"}],ref:"form_"+i,refInFor:!0,attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.markAnswer[i],disabled:e.$optimus.disabled}})],1):e._e()]:[s("span",{staticClass:"notMark"},[e._v("点击标注")])]]],2)})),0)])],1),s("Modal",{attrs:{draggable:"",sticky:"",scrollable:"",mask:!1,closable:!1,title:e.objectModal.title},model:{value:e.objectModal.showModal,callback:function(t){e.$set(e.objectModal,"showModal",t)},expression:"objectModal.showModal"}},[s("div",{staticClass:"modal-content",staticStyle:{"max-height":"500px","overflow-y":"scroll"}},[e.objectModal.showModal?[s("safeImage",{key:e.modalRenderCount,staticStyle:{"margin-bottom":"20px"},attrs:{src:e.objectModal.target,width:300}}),s("optimus-engine",{ref:"object",attrs:{component:e.componentConfig,context:e.$optimus.context,answer:e.objectModal.editAnswer,disabled:e.$optimus.disabled}})]:e._e()],2),s("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:e.cancleMark}},[e._v("取消")]),e.$optimus.disabled?e._e():s("Button",{attrs:{type:"primary"},on:{click:e.confirmMark}},[e._v("确认")])],1)])],1)},nw=[],rw={components:{safeImage:Bs},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{objectType:{type:String},title:{type:String},labelObjects:String,objectName:{type:String},objectUrl:{type:String}},data(){const{objects:e}=this.$optimus,t=Object(a["cloneDeep"])(e).reduce((e,t)=>Object.assign(e,{[t.data[0].index]:{tags:t.tags}}),{});let s=0;const i=localStorage.getItem("optimus-multiple-select-image-scale");return i&&(s=parseInt(i,10)),{markAnswer:t,objectLabelType:localStorage.getItem("optimus-multiple-select-object-label-type")||"modal",imageScale:s,objects:e,selectIndex:-1,objectModal:{title:"",showModal:!1,editAnswer:null,target:null},modalRenderCount:0}},computed:{myLabelObjects(){return this.initLabelObjects(this.labelObjects)},componentConfig(){var e;const t=null===(e=this.$renderedComponentConfig)||void 0===e?void 0:e.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return!t||("all"===t||t===this.currentToolName)});return{component:"z-form-stage",items:t}},currentTool(){var e;return 0===(null===(e=this.$renderedComponentConfig)||void 0===e?void 0:e.$object_tools.length)?{}:Object(a["head"])(this.$renderedComponentConfig.$object_tools)},markedIndex(){return this.objects.map(e=>{const{data:[{index:t}]}=e;return t})}},watch:{selectIndex:{handler(){this.modalRenderCount+=1}},objectLabelType:{handler(e){"modal"===e&&(this.modalRenderCount+=1)}}},mounted(){this.initImageWrapper()},methods:{initLabelObjects(e){if(!e)return[];let t=[];if(Object(a["isString"])(e)){if(""===e)return t;try{t=JSON.parse(e)}catch(s){console.error("[multiple-select-stage] objects出错",{labelObjects:e})}}return t},toolLabelTypeChange(e){"modal"!==e&&(this.objectModal.showModal&&this.cancleMark(),this.markAnswer=Object(a["cloneDeep"])(this.objects).reduce((e,t)=>Object.assign(e,{[t.data[0].index]:{tags:t.tags}}),{})),localStorage.setItem("optimus-multiple-select-object-label-type",e)},initImageWrapper(){const e=document.querySelectorAll(".image-item"),t=35*this.imageScale+200,s=3*t/2;e.forEach(e=>{const{style:i}=e;i.width=t+"px",i.height=s+"px"})},imageScaleInput(e){const t=document.querySelectorAll(".image-item"),s=parseInt(window.getComputedStyle(t[0]).width,10),i=35*e+200;if(s!==i){const e=3*i/2;t.forEach(t=>{const{style:s}=t;s.width=i+"px",s.height=e+"px"})}},imageScaleChange(e){localStorage.setItem("optimus-multiple-select-image-scale",e)},handleSelect(e){this.selectIndex=e;const t=this.objects.find(e=>{const{data:[{index:t}]}=e;return t===this.selectIndex});t&&this.$emit("select-object",t),"modal"===this.objectLabelType&&this.triggerMark(t),"expand"===this.objectLabelType&&(t||this.$optimus.disabled||this.addObject([]))},triggerMark(e){const t=this.myLabelObjects[this.selectIndex];this.objectModal.title=`${this.currentTool.label}: ${t[this.objectName]}`,this.objectModal.target=t[this.objectUrl],this.showMarkModal=!0,e?(this.updateObj=e,this.objectModal.editAnswer={tags:e.tags}):this.objectModal.editAnswer={},this.objectModal.showModal=!0},cancleMark(){this.selectIndex=-1,this.updateObj=null,this.objectModal.showModal=!1},confirmMark(){if(this.$refs.object.validate(),this.$refs.object.isValid){const e=this.$refs.object.tags;this.updateObj?this.updateObj.tags=e:this.addObject(e),this.updateObj=null,this.objectModal.showModal=!1,this.selectIndex=-1}else this.objectModal.showModal=!0},addObject(e){const{type:t,name:s,label:i}=this.currentTool,a=this.myLabelObjects[this.selectIndex],o={type:t,data:[{name:a[this.objectName],url:a[this.objectUrl],index:this.selectIndex}],tags:e,featureId:"feature-"+Object(n["j"])(8),name:s,label:i,extData:a};this.objects.push(o),this.$emit("select-object",o)},deleteObjectById(e){const t=this.objects.findIndex(t=>t.featureId===e);this.objects.splice(t,1)},editObjectById(e){const t=this.objects.find(t=>t.featureId===e);if(t){this.$emit("select-object",t);const{data:[{index:e}]}=t;this.selectIndex=e}"modal"===this.objectLabelType&&this.triggerMark(t)},updateObjTags(e){const t="form_"+e,s=Object(a["findIndex"])(this.objects,t=>{const{data:[{index:s}]}=t;return s===e});this.objects[s].tags=this.$refs[t][0].tags}}},lw=rw,cw=(s("a75f"),Object(S["a"])(lw,ow,nw,!1,null,"4491ea01",null)),dw=cw.exports,uw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.objects.length>0?s("CellGroup",e._l(e.objects,(function(t){return s("Cell",{key:t.featureId,attrs:{selected:e.activeItem===t.featureId,id:t.featureId,name:t.featureId},nativeOn:{click:function(s){return e.selectObject(t.featureId)}}},[s("div",{staticClass:"title"},[s("div",{staticClass:"feature-id"},[e._v(e._s(e.getLable(t)))])]),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.selectObject(t.featureId)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t.featureId)}}})],1)],2)})),1):e._e()],1)])},hw=[],pw={mixins:[Re["a"]],data(){const{objects:e}=this.$optimus;return{activeItem:null,objects:e}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]=t.label}),e}},methods:{getLable(e){const{name:t,data:[{name:s}]}=e;return`${this.toolLabelMap[t]}:${s}`},selectActiveObject(e){this.activeItem=e.featureId},selectObject(e){this.$emit("edit-object",e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e,onOk:()=>{this.$emit("delete-object",e)}})}}},mw=pw,gw=(s("d3bf"),Object(S["a"])(mw,uw,hw,!1,null,"2ae1c616",null)),bw=gw.exports,fw={metadata:aw,components:{BaseLayout:Lp,MultipleAnnotation:dw,SelectObjects:bw},mixins:[Re["a"]],props:{title:String,labelObjects:String,objectType:String,objectName:String,objectUrl:String},methods:{selectObjectByMultiple(e){this.$nextTick(()=>{this.$refs.selectObjects.selectActiveObject(e)})},editObjectById(e){this.$refs.multipleAnnotation.editObjectById(e)},deleteObject(e){this.$refs.multipleAnnotation.deleteObjectById(e)}}},vw=fw,yw=Object(S["a"])(vw,sw,iw,!1,null,"4ee00377",null),ww=yw.exports,xw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0,showingStyle:{flex:"0 0 70%"}},scopedSlots:e._u([{key:"component",fn:function(){return[s("text-compare-annotation",e._b({ref:"textMultipleAnnotation",attrs:{$renderedComponentConfig:e.$renderedComponentConfig}},"text-compare-annotation",e.$attrs,!1))]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Cw=[],jw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-container"},[s("div",{staticClass:"font-size"},[s("TextFont",{attrs:{fontSize:e.fontSize},on:{"update:fontSize":function(t){e.fontSize=t},"update:font-size":function(t){e.fontSize=t}}})],1),s("div",{staticClass:"text-compare-annotation"},[e.contentList.length>2?e._l(e.contentList,(function(t){return s("Row",{key:t.id},[s("Col",{attrs:{span:"24"}},[s("span",{ref:t.id,refInFor:!0,staticClass:"font-color",class:"pre-wrap font-size"+e.fontSize,domProps:{innerHTML:e._s(t.content)}})])],1)})):e.contentList.length>0?s("Row",e._l(e.contentList,(function(t,i){return s("Col",{key:t.id,attrs:{span:24/e.contentList.length}},[t.key&&"markdown"===e.schemaTypeMap[t.key].string_type?[s("Markdown",{directives:[{name:"highlight",rawName:"v-highlight"}],ref:t.id,refInFor:!0,staticClass:"markdown-body markdown-css",class:"font-size"+e.fontSize,attrs:{source:t.content}})]:[s("span",{ref:t.id,refInFor:!0,staticClass:"font-color",class:"pre-wrap font-size"+e.fontSize,domProps:{innerHTML:e._s(t.content)}})],0===i?s("div",{staticClass:"text-proportion"},[e._v(e._s(e.textProportion1))]):e._e(),1===i?s("div",{staticClass:"text-proportion"},[e._v(e._s(e.textProportion2))]):e._e()],2)})),1):s("div",{staticClass:"empty-info"},[e._v("暂无对比文本，请前往对应模版配置")])],2)])},Ow=[],kw=(s("e86f"),s("c53b")),Aw=s.n(kw),Sw={components:{TextFont:Wr,Markdown:Aw.a},directives:{highlight:{inserted(e){const t=e.querySelectorAll("pre code");t.forEach(e=>{al.a.highlightBlock(e)})}}},mixins:[Re["a"]],props:{textList:{type:[Array,String],default:()=>[]}},data(){return{textProportion1:"",textProportion2:"",fontSize:14}},computed:{contentList(){var e,t;const s=this.getCompareText(this.textList.map(e=>e.tag)),i=null===(e=this.$renderedComponentConfig.$rawConfig)||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.textList;return s.map((e,t)=>{var s,o,n;return{content:Object(a["isString"])(e)?e:"",id:"compare_stage_"+Math.random(),key:(null===(s=i[t])||void 0===s||null===(o=s.tag)||void 0===o||null===(n=o.replace("${input.",""))||void 0===n?void 0:n.replace("}",""))||""}})},schemaTypeMap(){var e;const t={};return null===(e=this.$optimus.schema)||void 0===e||e.forEach(e=>{const{key:s,isLabelDisplay:i,type:a,string_type:o}=e;t[s]={isLabelDisplay:i,type:a,string_type:o}}),t}},methods:{filterTxt(e){return e.replace(/<\s*b\s*>/g,"").replace(/<\s*\/b\s*>/g,"")},getPercentage(e,t){return t?Math.round(e/t*1e4)/100+"%":"0%"},translateXml(e){return e.includes("<?xml")||/<|>/.test(e)?e.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;"):e},getCompareText(e){var t,s;if(2!==e.length)return e;let i="",o="";const n=this.translateXml((null===(t=e[0])||void 0===t?void 0:t.toString())||""),r=this.translateXml((null===(s=e[1])||void 0===s?void 0:s.toString())||""),l=K.a.prototype.diff_main(Object(a["isString"])(r)?r:"",Object(a["isString"])(n)?n:"");let c=0,d=0,u=0,h=0;return l.forEach(e=>{const t=e[1].match(/\n/g),s=t?t.length:0,a=s>0?`<span style="color:#999">${"↵".repeat(s)}</span>`:"",n=/^[\n]*$/.test(e[1]);1===e[0]?(o=`${o}<span style='background: #c9f3f5;'>${n?a:""}${e[1]}${n?"":a}</span>`,d=this.filterTxt(e[1]).length+d):-1===e[0]?(i=`${i}<span style='background: #f5c9c9;'>${n?a:""}${e[1]}${n?"":a}</span>`,c=this.filterTxt(e[1]).length+c):0===e[0]&&(i+=e[1],u=this.filterTxt(e[1]).length+u,o+=e[1],h=this.filterTxt(e[1]).length+h)}),u=c+u,h=d+h,this.textProportion1=`${c}/${u}（${this.getPercentage(c,u)}）`,this.textProportion2=`${d}/${h}（${this.getPercentage(d,h)}）`,[i,o]}}},_w=Sw,Iw=(s("c787"),Object(S["a"])(_w,jw,Ow,!1,null,"771d19fe",null)),$w=Iw.exports,Mw={label:"文本对比标注",name:"z-text-compare-stage",repeatable:!0,attributes:[{name:"textList",label:"文本对比集",type:Array,value:[],component:"z-custom-input"}]},Tw={metadata:Mw,components:{TextCompareAnnotation:$w,BaseLayout:Lp},mixins:[Re["a"]],inheritAttrs:!1,computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}}}},Ew=Tw,Lw=Object(S["a"])(Ew,xw,Cw,!1,null,null,null),Dw=Lw.exports,Pw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[e._t("main")]},proxy:!0},{key:"objects",fn:function(){return[s("SelectObjects",{ref:"selectObjects",attrs:{$renderedComponentConfig:e.$renderedComponentConfig}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Bw=[],Rw={label:"多模态标注",icon:"ios-image-outline",name:"z-multiple-groups-stage",tools:[{type:"objects/object",label:"选择标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"objects_object_"+(new Date).getTime()}}]}],shortCuts:[{label:"",attributes:[{name:["Q"],label:"选中/取消选中当前对象"},{name:["1","9"],connection:"~",label:"选中指定单选选项"},{name:["<-","->"],connection:"&",label:"预览时切换图片",global:!0},{name:["鼠标滚轮"],label:"预览时缩放图片",global:!0},{name:["ESC"],label:"退出图片预览",global:!0}]}]},zw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},[e.isEmpty(e.objectsGroupMap)?e._e():s("Collapse",{attrs:{value:e.openAll}},e._l(e.objectsGroupMap,(function(t,i){return s("Panel",{key:i,attrs:{name:i}},[s("span",[e._v(e._s(e.getGroupTitle(i))+"  （已标注/总量："+e._s(t.length)+"/"+e._s(e.getGroupLabelCount(i))+"）")]),s("span",{staticStyle:{float:"right","margin-right":"16px"},on:{click:function(t){return e.handleDeleteGroup(t,i)}}},[e._v("清空")]),s("template",{slot:"content"},[t.length>0?s("CellGroup",e._l(t,(function(t){return s("Cell",{key:t.featureId,attrs:{selected:e.activeItem===t.featureId,id:t.featureId,name:t.featureId},nativeOn:{click:function(s){return e.selectObject(t)}}},[s("div",{staticClass:"title"},[s("div",{staticClass:"ellipsis"},[s("span",[e._v(e._s(e.getLable(t)))]),e.getLocalVal(t)?s("span",[e._v("（"+e._s(e.getLocalVal(t)))]):e._e()]),e.getLocalVal(t)?s("span",[e._v("）")]):e._e()]),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.selectObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)],2)})),1):e._e()],1)],2)})),1)],1)])},Nw=[],Fw={mixins:[Re["a"]],data(){return{isEmpty:a["isEmpty"],activeItem:null,activeGroup:null,objects:this.$optimus.objects}},computed:{componentConfig(){return Object(a["groupBy"])(this.$renderedComponentConfig.$object_items,e=>e.group)},toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]=t.label}),e},objectsGroupMap(){return Object(a["groupBy"])(this.objects,e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.group})},openAll(){return Object.keys(this.objectsGroupMap).map(e=>e)}},methods:{getGroupLabelCount(e){let t=this.$optimus.context[e];if(!t)return 0;if(Object(a["isString"])(t)){if(""===t)return 0;try{t=JSON.parse(t)}catch(s){console.error(`[${this.name}] 配置出错`,{labelObjects:t})}}return t.some(e=>Object(a["isString"])(e))&&(t=Object(a["cloneDeep"])(t).map(e=>({[this.objectName]:"",[this.objectUrl]:e}))),t.length},getLable(e){const{name:t,data:{index:s}}=e;return`${this.toolLabelMap[t]}:${s+1}`},getLocalVal(e){var t;return null===(t=e.tags[0])||void 0===t?void 0:t.value},getGroupTitle(e){const t=Object(a["findIndex"])(this.$optimus.schema,{key:e}),s=this.$optimus.schema[t];return`容器${t+1}: ${s.name}`},selectObject(e){this.selectActiveObject(e);const{data:{index:t,group:s}}=e;document.getElementById(`group-container_${s}_${t}`).scrollIntoViewIfNeeded()},selectActiveObject(e){const{featureId:t,data:{group:s}}=e;this.activeItem=t,this.activeGroup=s,this.$optimus.$emit("optimus:multiple-groups-stage:edit-object",e)},handleDeleteGroup(e,t){e.stopPropagation(),this.$Modal.confirm({title:"确定要删除当前容器内所有选项？",content:this.getGroupTitle(t),onOk:()=>{this.$optimus.$emit("optimus:multiple-groups-stage:delete-object",t)}})},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$optimus.$emit("optimus:multiple-groups-stage:delete-object",e)}})}}},Vw=Fw,qw=(s("7fc9"),Object(S["a"])(Vw,zw,Nw,!1,null,"427f7c64",null)),Hw=qw.exports,Ww={metadata:Rw,components:{BaseLayout:Lp,SelectObjects:Hw},mixins:[Re["a"]],props:{isShowTableTitle:{type:Boolean,default:!0},isSandbox:{type:Boolean,default:!0}},mounted(){!this.$optimus.disabled&&document.addEventListener("keydown",this.listenKeyboardEvent),this.$optimus.$on("optimus:multiple-groups-stage:select-object",e=>{this.$nextTick(()=>{this.$refs.selectObjects.selectActiveObject(e)})})},destroy(){!this.$optimus.disabled&&document.removeEventListener("keydown",this.listenKeyboardEvent)},methods:{listenKeyboardEvent:Object(a["throttle"])((function(e){this.$optimus.$emit("optimus:multiple-groups-stage:hotKey",e)}),200)}},Uw=Ww,Qw=Object(S["a"])(Uw,Pw,Bw,!1,null,"6c8d32aa",null),Jw=Qw.exports,Gw=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"main-container"},[e._t("default")],2)},Kw=[],Yw={name:"z-container-stage",mixins:[Re["a"]],data(){return{objectsClone:Object(a["cloneDeep"])(this.$optimus.objects)}}},Zw=Yw,Xw=Object(S["a"])(Zw,Gw,Kw,!1,null,null,null),ex=Xw.exports,tx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return["引文多列展示"===e.layout?s("text-compare-annotation",e._b({ref:"textMultipleAnnotation",attrs:{$renderedComponentConfig:e.$renderedComponentConfig}},"text-compare-annotation",e.$attrs,!1)):e._e(),"引文单独展示"===e.layout?s("text-compare-annotation2",e._b({ref:"textMultipleAnnotation2",attrs:{$renderedComponentConfig:e.$renderedComponentConfig}},"text-compare-annotation2",e.$attrs,!1)):e._e()]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},sx=[],ix=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-container"},[s("div",{staticClass:"text-compare-annotation"},[s("div",{staticClass:"query"},[e._v(e._s(e.query))]),s("Divider"),e.contentList.length>0?s("Row",{staticClass:"answer-list",attrs:{gutter:10}},e._l(e.contentList,(function(t,i){return s("Col",{key:t.id,attrs:{span:e.contentSpan}},[s("div",{staticClass:"answer-area",on:{drop:e.onDrop}},[s("div",{staticClass:"answer-item",class:e.enableDragAction&&"draggable",attrs:{sort:t.sort,draggable:e.enableDragAction},on:{dragstart:e.onDragStart,dragend:function(t){e.sortIndex=null},dragover:function(e){e.preventDefault()}}},[s("Card",[e.enableDragAction?s("Icon",{staticClass:"drag-btn",attrs:{type:"ios-move",size:"16"}}):e._e(),e.draggable?s("div",{staticClass:"title"},[e._v("答案"+e._s(e.getAlphabet(t.index)))]):s("div",{staticClass:"title"},[e._v("答案"+e._s(e.getAlphabet(i)))]),s("div",{staticClass:"answer"},[e._v(e._s(t.answer))]),s("div",{staticClass:"listContent"},[s("h4",[e._v("-引文列表:")]),e._l(t.quoteLists,(function(t,i){return s("div",{key:t.text,staticClass:"list"},[e._v("["+e._s(i+1)+"] "+e._s(t.text)),s("a",{staticClass:"url",attrs:{href:t.url,target:"_blank"}},[e._v("跳转原文")])])}))],2)],1)],1)])])})),1):s("div",{staticClass:"empty-info"},[e._v("暂无对比文本，请前往对应模版配置")])],1)])},ax=[],ox={components:{TextFont:Wr},mixins:[Re["a"]],props:{textList:{type:[Array,String],default:()=>[]},query:String,draggable:Boolean},data(){return{sortIndex:null}},computed:{contentList(){try{var e,t,s;return this.draggable&&null!==(e=this.$optimus)&&void 0!==e&&null!==(t=e.extData)&&void 0!==t&&t.sortTextList?null===(s=this.$optimus)||void 0===s?void 0:s.extData.sortTextList.map(e=>({id:Object(n["j"])(8),...JSON.parse(this.textList[e.index].tag),index:e.index,sort:e.sort})):this.textList.map(e=>({id:Object(n["j"])(8),...JSON.parse(e.tag)}))}catch(i){return console.log("文本对比集输入错误"+this.textList),[]}},contentSpan(){const{length:e}=this.contentList;return e<5?Math.floor(24/e):6},enableDragAction(){const{draggable:e,$optimus:t}=this;return e&&!t.disabled}},mounted(){const{draggable:e,textList:t}=this;var s;e&&(null!==(s=this.$optimus)&&void 0!==s&&s.extData||(this.$optimus.extData={sortTextList:t.map((e,t)=>({index:t,sort:t}))}))},methods:{getAlphabet:n["g"],onDragStart(e){this.enableDragAction&&(this.sortIndex=e.target.getAttribute("sort"))},onDrop(e){if(e.preventDefault(),!this.enableDragAction)return;const t=e.target.closest(".answer-area"),s=t.firstChild.getAttribute("sort");this.onSortSwap(this.sortIndex,s)},onSortSwap(e,t){const{sortTextList:s}=this.$optimus.extData;if(e===t)return;const i=[...s];[i[t],i[e]]=[i[e],i[t]],i[e].sort=Number(e),i[t].sort=Number(t),this.$optimus.extData.sortTextList=[...i],this.sortIndex=null}}},nx=ox,rx=(s("c280"),Object(S["a"])(nx,ix,ax,!1,null,"714b6ced",null)),lx=rx.exports,cx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-container"},[s("table",[s("tr",[s("th",[e._v("问题")]),s("td",[e._v(e._s(e.query))])]),s("tr",[s("th",[e._v("引文列表")]),s("td",{staticClass:"listContent"},e._l(e.myQuoteLists,(function(t,i){return s("div",{key:t.text,staticClass:"list"},[e._v("["+e._s(i+1)+"] "+e._s(t.text)),s("a",{staticClass:"url",attrs:{href:t.url,target:"_blank"}},[e._v("跳转原文")])])})),0)]),e._l(e.myAnswer,(function(t,i){return s("tr",{key:t.id},[s("th",[e._v("答案"+e._s(e.getAlphabet(i)))]),s("td",{staticClass:"answer"},[e._v(e._s(t))])])}))],2)])},dx=[],ux={components:{TextFont:Wr},mixins:[Re["a"]],props:{quoteLists:{type:[Array,String],default:()=>[]},query:String,answer:{type:[Array,String],default:()=>[]}},data(){return{}},computed:{myQuoteLists(){try{return Object(a["isString"])(this.quoteLists)?JSON.parse(this.quoteLists):this.quoteLists}catch(e){return console.log(e),[]}return[]},myAnswer(){try{return Object(a["isString"])(this.answer)?JSON.parse(this.answer):this.answer}catch(e){return console.log(e),[]}return[]}},methods:{getAlphabet:n["g"]}},hx=ux,px=(s("bd27"),Object(S["a"])(hx,cx,dx,!1,null,"167e161d",null)),mx=px.exports,gx={label:"多列文本对比标注",name:"z-multiple-text-compare-stage",repeatable:!0,attributes:[{name:"layout",label:"布局（选择对应布局并保存模板，切换展示）",type:String,component:"z-single-select",attributes:{clearable:!1,basicMode:!0,exhibit:"dropdown",options:[{label:"引文多列展示",value:"引文多列展示"},{label:"引文单独展示",value:"引文单独展示"}]},value:"引文多列展示"},{name:"query",label:"问题",type:String,value:""},{name:"quoteLists",label:"引文列表",type:String,value:"",attributes:{isVisible:"${output.layout === '引文单独展示'}"},vType:["array","string"]},{name:"answer",label:"答案",type:String,value:"",attributes:{isVisible:"${output.layout === '引文单独展示'}"},vType:["array","string"]},{name:"textList",label:"答案对比集(需包含answer、quoteLists字段)",type:Array,value:[],component:"z-custom-input",attributes:{isVisible:"${output.layout === '引文多列展示'}"}},{name:"draggable",label:"答案对比集是否可拖拽",type:Boolean,component:"z-switch",attributes:{isVisible:"${output.layout === '引文多列展示'}"}}]},bx={metadata:gx,components:{TextCompareAnnotation:lx,TextCompareAnnotation2:mx,BaseLayout:Lp},mixins:[Re["a"]],inheritAttrs:!1,props:{layout:{type:String,default:"引文多列展示"}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}}}},fx=bx,vx=Object(S["a"])(fx,tx,sx,!1,null,null,null),yx=vx.exports,wx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!1},scopedSlots:e._u([{key:"component",fn:function(){return[s("WujieVue",{attrs:{width:"100%",height:"100%",name:"wujie-optimus",url:e.url,fetch:e.wujieFetch,props:{$optimus:e.$optimus}}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},xx=[],Cx={label:"自定义标注工具",icon:"ios-image-outline",name:"z-wujie-stage",tools:[],attributes:[{name:"url",label:"嵌入工具的url",value:"",type:String,vType:["string"]},{name:"btnDisabled",label:"禁用按钮",value:[],type:Array,component:"z-multiple-select",attributes:{options:[{label:"标记无效",value:"invalid"}]}}],objectAnswerJson:{description:"自定义标注工具",type:"array"}},jx={metadata:Cx,components:{BaseLayout:Lp},mixins:[Re["a"]],props:{url:String},methods:{wujieFetch(e,t){const s=["//cdn-go.cn","//vfiles.gtimg.cn","//pingjs.qq.com"];return window.fetch(e,{...t,credentials:s.some(t=>"string"===typeof e&&e.includes(t))?"omit":"include"}).then(e=>e,e=>(console.error(e),{text:()=>""}))}}},Ox=jx,kx=Object(S["a"])(Ox,wx,xx,!1,null,null,null),Ax=kx.exports,Sx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!1},scopedSlots:e._u([{key:"component",fn:function(){return[e.model&&e.prompt?s("AiUserChat",{attrs:{model:e.model,role:e.role,prompt:e.prompt}}):s("span",[e._v("请选择模型并输入信息")])]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},_x=[],Ix={label:"用户大模型问答标注工具",icon:"ios-image-outline",name:"z-ai-user-model-stage",attributes:[{name:"model",label:"模型配置",type:String,value:"modelD",component:"z-single-select",attributes:{options:[{label:"modelD(hunyuan-character)",value:"modelD"}]}},{name:"role",label:"角色",type:String,value:""},{name:"prompt",label:"prompt",type:String,value:""}],tools:[],hiddenItems:[{component:"modelD",attributes:{label:"modelD",name:"modelD",type:Array,hidden:!0,required:!0}}]},$x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("h2",[e._v("对话")]),s("div",{staticClass:"txt"},[e._v("试试和我聊天吧～")]),s("div",{ref:"message",staticClass:"chat-box"},e._l(e.messages,(function(t,i){return s("div",{staticClass:"chat-item"},[s("modelMessage",{key:i+"-"+e.key,attrs:{message:Object.assign({},t,{content:t.newContent||t.content,roleLabel:"assistant"===t.role?e.role:void 0}),defaultTextType:"assistant"===t.role?"MD":"text"},scopedSlots:e._u([t.isEdit?{key:"content",fn:function(){return[s("Input",{attrs:{type:"textarea"},model:{value:t.newContent,callback:function(s){e.$set(t,"newContent",s)},expression:"message.newContent"}})]},proxy:!0}:null,"assistant"===t.role?{key:"optimus",fn:function(){return[s("Divider",{staticStyle:{margin:"8px 0 0 0"}}),s("div",{staticClass:"operation"},[s("div",{staticClass:"rate",attrs:{direction:"vertical"}},[s("div",{staticClass:"text"},[e._v("评分：")]),s("Rate",{on:{"on-change":e.handleMessageChange},model:{value:t.rate,callback:function(s){e.$set(t,"rate",s)},expression:"message.rate"}}),s("div",{staticClass:"text"},[e._v(e._s(t.rate)+" 分")])],1),s("span",[t.newContent&&!t.isEdit?s("Button",{staticClass:"ml8",attrs:{size:"small",icon:"md-refresh",type:"text"},on:{click:function(t){return e.handleBack(i)}}},[s("div",{staticClass:"text"},[e._v("撤回改写")])]):e._e(),s("Button",{staticClass:"ml8",attrs:{size:"small",icon:t.isEdit?"md-checkbox-outline":"md-create",type:"text"},on:{click:function(t){return e.handleEdit(i)}}},[s("div",{staticClass:"text"},[e._v(e._s(t.isEdit?"保存":"改写"))])])],1)])]},proxy:!0}:null],null,!0)})],1)})),0),s("div",{staticClass:"send-box"},[s("Input",{staticClass:"send-input",attrs:{type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:e.error?"请求错误，请重新提问":"请输入您的问题，回车发送",disabled:e.error},on:{"on-keydown":e.handleEnter},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),s("Button",{staticClass:"send-button",attrs:{type:"primary",loading:e.loading},on:{click:e.sendMessage}},[e._v(e._s(e.error?"重新":"")+"发送")])],1)])},Mx=[],Tx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-content"},[s("Row",{staticClass:"chat-bar",staticStyle:{margin:"8px 0"},attrs:{align:"middle",justify:"space-between"}},[s("div",[e._t("title",(function(){return[e.icon?s("Avatar",{staticClass:"avatar",style:{background:e.curConfig.avatarBg},attrs:{icon:e.curConfig.avatarIcon,size:"30"}}):e._e(),s("span",{style:{color:e.curConfig.avatarBg,fontWeight:"bold"}},[e._v(e._s(e.message.roleLabel||e.curConfig.defaultLabel))])]}))],2),e.operationEnabled?s("Row",{staticStyle:{gap:"8px"},attrs:{align:"middle"}},[s("WordCount",{attrs:{content:e.message.content,defaultType:e.wordCount.type,defaultEnabled:e.wordCount.enabled}}),e.toggleEnabled?s("RadioGroup",{staticClass:"radio",attrs:{type:"button",size:"small"},model:{value:e.textType,callback:function(t){e.textType=t},expression:"textType"}},[s("Radio",{attrs:{label:"MD"}}),s("Radio",{attrs:{label:"text"}})],1):e._e(),e.copyEnabled?s("copy-btn",{attrs:{text:e.message.content}}):e._e(),e._t("operation")],2):e._e()],1),e._t("divider"),e._t("content",(function(){return[s("div",{staticClass:"msg-content",style:{backgroundColor:e.curConfig.msgContentBg,maxHeight:e.contentHeight+"px"}},[e.message.extra?s("div",{staticClass:"extra-box"},[s("t-collapse",{attrs:{defaultExpandAll:""}},e._l(e.message.extra,(function(t,i){return s("t-collapse-panel",{key:i,attrs:{header:t.role}},[s("div",{staticClass:"extra-content"},[e._v(e._s(t.content))])])})),1)],1):e._e(),e.message.debug&&e.message.debug.length?s("Collapse",{staticClass:"debug"},[s("Panel",[e._v("找到了"+e._s(e.message.debug.length)+"篇资料"),s("template",{slot:"content"},e._l(e.message.debug,(function(t){return s("div",{key:t.index},[s("span",[e._v(e._s(t.index)+".")]),s("a",{attrs:{href:t.url,target:"_blank"}},[s("span",[e._v(e._s(t.title))]),s("Icon",{attrs:{type:"ios-link"}})],1)])})),0)],2)],1):e._e(),s("model-content",{attrs:{message:e.message,textType:e.textType}}),e.message.multimedias?s("div",{ref:"viewers",staticClass:"file-list"},e._l(e.message.multimedias,(function(t,i){return s("div",["image"===t.type?s("safeImage",{staticClass:"img",attrs:{src:e.urlProxyMap&&e.urlProxyMap[t.url]?e.urlProxyMap[t.url]:t.url,fit:"contain",parentRefs:e.$refs,isCanvas:!1,imageIndx:i}}):s("preview",{staticClass:"link",attrs:{previewType:["audio","video","url"].includes(t.type)?t.type:"cos",filename:t.filename||t.fileName,sourceUrl:t.url,previewMode:"newTab",fileCopyable:e.fileCopyable}},[s("Icon",{attrs:{type:"md-document",size:"18"}}),s("span",[e._v(e._s(t.filename||t.fileName))])],1)],1)})),0):e._e()],1)]})),e._t("optimus")],2)},Ex=[],Lx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.message?s("div",{staticClass:"model-container"},[e.content?s("textMenu",{scopedSlots:e._u([{key:"content",fn:function(){return["MD"===e.textType?s(e.dynamicComponent,{tag:"component",staticClass:"markdown-body"}):s("div",{staticClass:"pre-wrap markdown-body"},[e._v(e._s(e.content))])]},proxy:!0}],null,!1,3587716027)}):e._e()],1):e._e()},Dx=[],Px=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("t-popup",{staticClass:"custom-poptip",attrs:{placement:"bottom",trigger:"click","show-arrow":""},on:{"visible-change":e.handleVisibleChange},scopedSlots:e._u([{key:"content",fn:function(){return e._l(e.token.info,(function(t){return s("div",{key:t.index,ref:"poptipRef",refInFor:!0,staticClass:"poptip-sup"},[[s("span",{staticClass:"li"},[e._v(e._s(t.index)+".")]),s("a",{attrs:{href:t.url,target:"_blank"}},[s("span",[e._v(e._s(t.title))]),s("Icon",{staticClass:"icon",attrs:{type:"ios-link"}})],1)]],2)}))},proxy:!0}])},[s("div",{staticClass:"sup-list",attrs:{id:e.id}},e._l(e.sups,(function(t){return s("div",{key:t,staticClass:"sup",class:"sup-"+(e.actived?"actived":"normal")},[e._v(e._s(t))])})),0)])},Bx=[],Rx={name:"ModelSup",props:{token:{type:Object}},data(){return{actived:!1}},computed:{sups(){return this.token.content.split(",")},id(){return this.token.id}},mounted(){},methods:{handleVisibleChange(e){this.actived=e}}},zx=Rx,Nx=(s("b1f0"),Object(S["a"])(zx,Px,Bx,!1,null,"15bcef2e",null)),Fx=Nx.exports,Vx=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("Row",{staticClass:"code-title",attrs:{justify:"space-between",align:"middle"}},[s("div",{staticClass:"lang-label"},[e._v(e._s(e.lang))]),s("Row",{staticStyle:{gap:"4px"},attrs:{align:"middle"}},[s("copyBtn",{attrs:{text:e.content,"show-text":!1}}),s("div",{staticClass:"icon-btn",on:{click:e.showCodeRunnerModal}},[s("Icon",{attrs:{type:"md-code",size:16}})],1)],1)],1),s("codeRunnerModal",{attrs:{"default-lang":e.lang,"default-code":e.code},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}})],1)},qx=[],Hx={name:"ModelCodeBar",components:{copyBtn:wl,editor:dp.a,codeRunnerModal:mp},props:{language:String,content:String},data(){return{visible:!1,code:this.content,lang:this.language}},computed:{},mounted(){},methods:{showCodeRunnerModal(){this.visible=!0}}},Wx=Hx,Ux=(s("922f"),Object(S["a"])(Wx,Vx,qx,!1,null,"644179fa",null)),Qx=Ux.exports;const Jx=new nl.a({html:!0,breaks:!0,highlight:(e,t)=>{if(!["xml","html"].includes(t)&&al.a.getLanguage(t))try{return al.a.highlight(e,{language:t,ignoreIllegals:!0}).value}catch(s){return""}return""}});var Gx={name:"ModelContent",components:{ModelSup:Fx,textMenu:Ed,DefaultComponent:{template:"<span></span>"}},props:{message:{type:Object},textType:{type:String,default:"text"}},data(){return{dynamicComponent:this.DefaultComponent,html:""}},computed:{content(){return Object(a["isObject"])(this.message.content)?JSON.stringify(this.message.content):this.message.content}},watch:{textType(){this.render()}},mounted(){this.render()},methods:{isValidHtmlTag(e){const t=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"],s=/^<\/?([a-z][\w-]*)\s*\/?>$/i,i=e.match(s);if(i){const[,e]=i;return t.includes(e)}return!1},mdInit(){Jx.use(dl.a);const e=(e,t)=>{const{content:s}=e[t];return this.isValidHtmlTag(s)?s:s.replace(/<|>|{{|}}|"/g,this.formatContent)},t=(e,t)=>{const{content:s}=e[t],i=/<[^>]+>/g,a=s.match(i)||[];return a.every(this.isValidHtmlTag)?s:e[t].content.replace(/<|>|{{|}}|"/g,this.formatContent)};Jx.renderer.rules.ref_open=(e,t)=>{const s=[];let i=t+1;while(i<e.length&&"ref_close"!==e[i].type)"ref_item"===e[i].type&&s.push(e[i].content),i+=1;const a={content:s.join(","),info:this.message.debug?this.message.debug.filter(e=>s.includes(""+e.index)):[]};return`<model-sup :token='${JSON.stringify(a)}' />`},Jx.renderer.rules.ref_item=()=>"",Jx.renderer.rules.ref_close=()=>"";const s=(e,t)=>{const s=e[t],i=Object(n["l"])(s.content);if(["math_inline","math_block"].includes(s.type))try{const e=ll.a.renderToString(i);return"math_block"===s.type?`<div>${e}</div>`:e}catch(a){const e=ll.a.renderToString(i,{throwOnError:!1,displayMode:!0});return e}return s.content},i=Jx.renderer.rules.fence,a=(e,t,s,a,o)=>{const n=e[t],r=n.info.trim(),l=n.content.replace(/'/g,"&#39;"),c=i(e,t,s,a,o),d=`<model-code-bar language='${r}' content='${l}'/>`;return c.includes("model-code-bar")?c:d+c},o=Jx.renderer.rules.link_open||((e,t,s,i,a)=>a.renderToken(e,t,s)),r=(e,t,s,i,a)=>{const n=e[t].attrIndex("target");return n<0&&(e[t].attrPush(["target","_blank"]),e[t].attrPush(["rel","noopener noreferrer"])),o(e,t,s,i,a)};Jx.renderer.rules.link_open=r,Jx.renderer.rules.html_inline=e,Jx.renderer.rules.html_block=t,Jx.renderer.rules.math_inline=s,Jx.renderer.rules.math_block=s,Jx.renderer.rules.fence=a},render(){if("MD"===this.textType){this.mdInit(),this.html=Jx.render(Object(n["c"])(this.content));const e=`<div>${this.html.replace(/{{|}}|@{@{|@}@}/g,this.formatHtml)}</div>`;this.dynamicComponent={components:{ModelSup:Fx,modelCodeBar:Qx},template:e}}},formatContent(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"{{":return"@{@{";case"}}":return"@}@}"}},formatHtml(e){switch(e){case"{{":return"<span v-pre>{{</span>";case"}}":return"<span v-pre>}}</span>";case"@{@{":return"{{";case"@}@}":return"}}"}}}},Kx=Gx,Yx=(s("c5bd"),Object(S["a"])(Kx,Lx,Dx,!1,null,"3beb31f6",null)),Zx=Yx.exports,Xx={components:{copyBtn:wl,modelContent:Zx,safeImage:Bs,preview:Gn,WordCount:ue},props:{message:{type:Object,required:!0},urlMap:{type:Object},defaultTextType:{type:String,default:"text"},toggleEnabled:{type:Boolean,default:!0},copyEnabled:{type:Boolean,default:!0},contentHeight:{type:String,default:"500"},proxyEnabled:{type:Boolean,default:!0},icon:{type:Boolean,default:!0},wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},operationEnabled:{type:Boolean,default:!0},fileCopyable:{type:Boolean,default:!1}},data(){return{roleConfig:{user:{defaultLabel:"用户",avatarIcon:"ios-person",avatarBg:"#4399ED",msgContentBg:"#C7E3FF"},assistant:{defaultLabel:"助手",avatarIcon:"ios-cube-outline",avatarBg:"#4d4d4d",msgContentBg:"#f2f2f2"},tool:{defaultLabel:"Tool",avatarIcon:"md-build",avatarBg:"#4d4d4d",msgContentBg:"#f2f2f2"},planner:{defaultLabel:"Planner",avatarIcon:"md-bulb",avatarBg:"#4d4d4d",msgContentBg:"#f2f2f2"},system:{defaultLabel:"system prompt",label:"system prompt",avatarIcon:"ios-help-buoy-outline",avatarBg:"#f90",msgContentBg:"#fff"},default:{defaultLabel:"其他",msgContentBg:"#f2f2f2"}},textType:this.message.defaultTextType||this.defaultTextType||"text",urlProxyMap:this.urlMap||{}}},computed:{curConfig(){return this.roleConfig[this.message.role]||this.roleConfig.default}},mounted(){this.proxyEnabled&&this.getProcyUrl()},methods:{charCount:n["a"],getProcyUrl(){var e,t;null===(e=this.message)||void 0===e||null===(t=e.multimedias)||void 0===t||t.forEach(e=>{if(["image","audio","video"].includes(e.type))try{Nn({url:e.url.trim()}).then(t=>{t.data&&Fn({url:e.url.trim()}).then(t=>{const s=new Blob([t.data]),i=URL.createObjectURL(s);this.$set(this.urlProxyMap,e.url,i)})})}catch(t){console.log(t)}})}}},eC=Xx,tC=(s("f2cf"),Object(S["a"])(eC,Tx,Ex,!1,null,"8134fbd6",null)),sC=tC.exports,iC={components:{modelMessage:sC},mixins:[Re["a"]],props:{model:{type:String,required:!0},role:{type:String,required:!0},prompt:{type:String,required:!0}},data(){return{input:"",loading:!1,messages:[],error:!1,key:0}},watch:{messages(){this.handleMessageChange()}},mounted(){this.$optimus.formData[this.model]?this.messages=this.$optimus.formData[this.model]:this.$set(this.$optimus.formData,this.model,[]),this.$optimus.$on("optimus:forms-stage:check",()=>{const{isValid:e,msg:t}=this.validate();this.$optimus.$emit("optimus:optimus-engine:check",e,t)})},methods:{handleMessageChange(){this.$optimus.formData[this.model]=this.messages.map(e=>({role:e.role,content:e.content,rate:e.rate,newContent:"assistant"===e.role&&e.content!==e.newContent?e.newContent:void 0}))},handleEdit(e){if(this.messages[e].isEdit){if(!this.messages[e].newContent)return void this.$Message.error("请勿改写为空内容");this.messages[e].newContent===this.messages[e].content&&(this.messages[e].newContent=void 0),this.handleMessageChange()}else this.messages[e].newContent=this.messages[e].newContent||this.messages[e].content;this.messages[e].isEdit=!this.messages[e].isEdit,this.$set(this.messages,e,this.messages[e])},handleBack(e){this.messages[e].newContent=void 0,this.key+=1,this.handleMessageChange(),this.$set(this.messages,e,this.messages[e])},validate(){return this.messages.length&&this.messages.find(e=>e.isEdit)?{isValid:!1,msg:"存在对话改写未保存"}:{isValid:!0,msg:""}},handleEnter(e){const{shiftKey:t,key:s}=e;t&&"Enter"===s||"Enter"===s&&(e.preventDefault(),this.sendMessage())},moveToEnd(){this.$nextTick(()=>{const e=this.$refs.message;e.scrollTop=e.scrollHeight})},sendMessage(){this.error?this.fetchModelAnswer():this.loading?this.$Message.error("请等待回答"):this.input?this.messages.length&&this.messages.find(e=>e.isEdit)?this.$Message.error("请保存改写完成的答案再发送"):(this.messages.push({role:"user",content:this.input}),this.moveToEnd(),this.input="",this.fetchModelAnswer()):this.$Message.error("请输入内容")},async fetchModelAnswer(){const e={model_name:this.model,system_prompt:this.prompt,messages:this.messages.map(e=>({role:e.role,content:e.newContent||e.content}))};try{this.loading=!0;const t=await Y["a"].askGpt(e);return this.messages.push({role:"assistant",content:t.answer,rate:3,isEdit:!1}),this.moveToEnd(),this.error=!1,t}catch(t){this.$Message.error(`${this.model}：${t.message}`),this.error=!0}finally{this.loading=!1}}}},aC=iC,oC=(s("7eaf"),Object(S["a"])(aC,$x,Mx,!1,null,"a33114d4",null)),nC=oC.exports,rC={metadata:Ix,components:{BaseLayout:Lp,AiUserChat:nC},mixins:[Re["a"]],props:{model:String,role:String,prompt:String}},lC=rC,cC=Object(S["a"])(lC,Sx,_x,!1,null,null,null),dC=cC.exports,uC=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[s("ai-chat-compare-annotation",e._b({ref:"textMultipleAnnotation",attrs:{$renderedComponentConfig:e.$renderedComponentConfig}},"ai-chat-compare-annotation",e.$attrs,!1))]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},hC=[],pC=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"text-container"},[s("div",{staticClass:"chat-box"},[e.messages.length?[s("h2",[e._v("历史对话")]),e._l(e.messages,(function(e,t){return s("div",{key:e.content,staticClass:"chat-item"},[s("ModelMessage",{attrs:{message:e,"default-text-type":"assistant"===e.role?"MD":"text"}})],1)}))]:e._e(),s("h2",[e._v("当前对话")]),s("div",{staticClass:"chat-item"},[s("ModelMessage",{attrs:{message:{role:"user",content:e.query}}})],1),e.contentList.length?s("div",[s("ModelMessage",{attrs:{message:{role:"assistant"},"operation-enabled":!1},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"answer-list",on:{drop:e.onDrop}},e._l(e.contentList,(function(t,i){return s("div",{key:t.id,staticClass:"answer-item",attrs:{sort:t.sort,draggable:e.enableDragAction},on:{dragstart:e.onDragStart,dragend:function(t){e.sortIndex=null},dragover:function(e){e.preventDefault()}}},[s("ModelMessage",{attrs:{message:{role:"assistant",content:t.text,roleLabel:"答案"+e.getAlphabet(t.index)},"default-text-type":"MD",icon:!1},scopedSlots:e._u([e.enableDragAction?{key:"operation",fn:function(){return[s("Icon",{staticClass:"drag-btn",attrs:{type:"ios-move",size:"16"}})]},proxy:!0}:null,{key:"divider",fn:function(){return[s("Divider",{staticStyle:{margin:"4px 0"}})]},proxy:!0}],null,!0)})],1)})),0)]},proxy:!0}])})],1):s("div",{staticClass:"empty-info"},[e._v("暂无对比文本，请前往对应模版配置")])],2)])},mC=[],gC={components:{TextFont:Wr,ModelMessage:sC},directives:{},mixins:[Re["a"]],props:{textListKey:{type:[Array,String],default:()=>[]},queryKey:String,draggable:Boolean,chatKey:{type:[Array,String],default:()=>[]}},data(){return{sortIndex:null}},computed:{query(){return this.$optimus.context[this.queryKey]},contentList(){try{var e,t;const i=this.textListKey.map((e,t)=>({id:Object(n["j"])(8),key:e.tag,text:this.$optimus.context[e.tag],index:t}));var s;return this.draggable&&null!==(e=this.$optimus)&&void 0!==e&&null!==(t=e.extData)&&void 0!==t&&t.sortTextList?null===(s=this.$optimus)||void 0===s?void 0:s.extData.sortTextList.map(e=>({id:Object(n["j"])(8),key:i[e.index].key,text:i[e.index].text,index:e.index,sort:e.sort})):i}catch(i){return console.log("文本对比集输入错误"),[]}},messages(){const e=[];let t=this.$optimus.context[this.chatKey];if(!Object(a["isArray"])(t))try{t=JSON.parse(this.$optimus.context[this.chatKey])}catch(s){console.error(s),t=[]}return t.forEach(t=>{e.push({role:"user",content:t.prompt}),e.push({role:"assistant",content:t.output})}),e},enableDragAction(){const{draggable:e,$optimus:t}=this;return e&&!t.disabled}},mounted(){const{draggable:e,contentList:t}=this;var s;e&&(null!==(s=this.$optimus)&&void 0!==s&&s.extData||(this.$optimus.extData={sortTextList:t.map((e,t)=>({index:t,sort:t}))}))},methods:{getAlphabet:n["g"],onDragStart(e){this.enableDragAction&&(this.sortIndex=e.target.getAttribute("sort"))},onDrop(e){if(e.preventDefault(),!this.enableDragAction)return;const t=e.target.closest(".answer-list"),s=t.firstChild.getAttribute("sort");this.onSortSwap(this.sortIndex,s)},onSortSwap(e,t){const{sortTextList:s}=this.$optimus.extData;if(e===t)return;const i=[...s];[i[t],i[e]]=[i[e],i[t]],i[e].sort=Number(e),i[t].sort=Number(t),this.$optimus.extData.sortTextList=[...i],this.sortIndex=null}}},bC=gC,fC=(s("faa6"),Object(S["a"])(bC,pC,mC,!1,null,"02919ac7",null)),vC=fC.exports,yC={label:"模型问答多列比对模版",name:"z-ai-chat-compare-stage",repeatable:!0,attributes:[{name:"chatKey",label:"对话字段名（数组元素需包含prompt、output字段）",type:String,value:"",vType:["array","string"]},{name:"queryKey",label:"问题字段名",type:String,value:""},{name:"textListKey",label:"答案对比集字段名",type:Array,value:[],component:"z-custom-input"},{name:"draggable",label:"答案对比集是否可拖拽",type:Boolean,component:"z-switch"}]},wC={metadata:yC,components:{AiChatCompareAnnotation:vC,BaseLayout:Lp},mixins:[Re["a"]],inheritAttrs:!1,props:{},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}}}},xC=wC,CC=Object(S["a"])(xC,uC,hC,!1,null,null,null),jC=CC.exports,OC=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"operation-left",fn:function(){return[e.historyChat.length&&e.historyChat[e.historyChat.length-1].round>1?s("Row",{attrs:{justify:"end",align:"middle"}},[s("div",{staticStyle:{display:"flex","align-items":"center",gap:"4px"}},[s("Button",{attrs:{type:"text",icon:"ios-skip-backward",size:"small"},on:{click:function(t){return e.handleOperation("start")}}}),s("Button",{attrs:{type:"text",icon:"ios-arrow-back",size:"small"},on:{click:function(t){return e.handleOperation("-")}}}),s("span",[e._v("跳至")]),s("InputNumber",{attrs:{size:"small",max:e.historyChat[e.historyChat.length-1].round,min:1},model:{value:e.round,callback:function(t){e.round=t},expression:"round"}}),s("span",[e._v("/"+e._s(e.historyChat[e.historyChat.length-1].round)+" 轮")]),s("Button",{attrs:{type:"text",icon:"ios-arrow-forward",size:"small"},on:{click:function(t){return e.handleOperation("+")}}}),s("Button",{attrs:{type:"text",icon:"ios-skip-forward",size:"small"},on:{click:function(t){return e.handleOperation("end")}}})],1)]):e._e()]},proxy:!0},{key:"component",fn:function(t){var i=t.wordCount;return[s("Annotation",{key:JSON.stringify(e.$attrs),ref:"annotationRef",attrs:{prompt:e.prompt,"history-chat":e.historyChat,"current-chat":e.currentChat,"cur-question":e.curQuestion,"answer-list":e.answerList,$renderedComponentConfig:e.$renderedComponentConfig,"word-count":i,round:e.round,"file-copyable":e.$attrs.fileCopyable},on:{"select-msg":e.selectMsg,"update:round":e.updateRound}})]}},{key:"global",fn:function(){return[e._t("default")]},proxy:!0},{key:"objects",fn:function(){return[s("Objects",e._b({ref:"objectsRef",attrs:{"cur-question":e.curQuestion,"answer-list":e.answerList,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-object":e.selectObject,"delete-object":e.deleteObject}},"Objects",e.$attrs,!1))]},proxy:!0}],null,!0)})},kC=[],AC=(s("e91a"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{staticClass:"chat-container"},[s("div",{class:(e.isFixed?"fixed-":"")+"prompt"},[e.prompt?s("modelMessage",{staticStyle:{width:"100%"},attrs:{message:e.prompt,contentHeight:"300","word-count":e.wordCount,"file-copyable":e.fileCopyable},scopedSlots:e._u([{key:"operation",fn:function(){return[s("top-btn",{on:{change:e.handleChangeFix},model:{value:e.isFixed,callback:function(t){e.isFixed=t},expression:"isFixed"}})]},proxy:!0}],null,!1,3208518707)}):e._e()],1),s("div",{staticClass:"chat-list",class:{overflow:e.isFixed}},[e.curHistoryChat.length?s("div",{staticClass:"title"},[e._v("历史对话")]):e._e(),e._l(e.curHistoryChat,(function(t){return s("div",{staticClass:"chat-item",attrs:{id:"anchor-"+t.index}},[s("div",{staticClass:"round-index"},[e._v(e._s("user"===t.role?"Q":"A")+e._s(t.round))]),s("modelMessage",{key:t.index,attrs:{message:t,defaultTextType:"assistant"===t.role?"MD":"text","word-count":e.wordCount,"file-copyable":e.fileCopyable}})],1)})),e.currentChat.length||e.answerList.length||e.curQuestion?s("div",{staticClass:"title"},[e._v("当前对话")]):e._e(),e._l(e.currentChat,(function(t){return s("div",{staticClass:"chat-item",attrs:{id:"anchor-"+t.index}},[s("div",{staticClass:"round-index"},[e._v(e._s("user"===t.role?"Q":"A")+e._s(t.round))]),s("modelMessage",{key:t.index,attrs:{message:t,defaultTextType:"assistant"===t.role?"MD":"text","word-count":e.wordCount,"file-copyable":e.fileCopyable}})],1)})),e.curQuestion?s("div",{staticClass:"chat-item"},[s("div",{staticClass:"round-index"},[e._v("Q"+e._s(e.curQuestion.round))]),s("div",{staticClass:"chat-message",class:{isSelect:"chat/question_round"===e.curSelected},attrs:{id:"chat/question_round"},on:{click:function(t){return e.addObject("chat/question_round")}}},[s("modelMessage",{attrs:{message:e.curQuestion,"word-count":e.wordCount,"file-copyable":e.fileCopyable},scopedSlots:e._u([{key:"optimus",fn:function(){return[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{type:"chat/question_round"},expression:"{ type: 'chat/question_round' }"}],ref:"form_chat/question_round",staticClass:"optimus-engine",staticStyle:{"min-width":"300px"},attrs:{component:e.questionRoundComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:e.initAnswer["chat/question_round"],group:"query"}})]},proxy:!0}],null,!1,2394083402)})],1)]):e._e(),e.answerList.length?s("div",{staticClass:"chat-item"},[s("div",{staticClass:"round-index"},[e._v("A"+e._s(e.answerList[0].round))]),s("div",{staticClass:"chat-message",class:{isSelect:"chat/answer_round"===e.curSelected},attrs:{id:"chat/answer_round"},on:{click:function(t){return e.addObject("chat/answer_round")}}},[s("modelMessage",{attrs:{message:{role:"assistant"},"operation-enabled":!1,"word-count":e.wordCount,"file-copyable":e.fileCopyable},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"answer-list",style:{flexDirection:e.answerList.length>3?"column":"row"}},e._l(e.answerList,(function(t,i){return s("div",{staticClass:"chat-message",class:{isSelect:e.curSelected==="chat/answer_"+e.getModel(i)},style:{backgroundColor:"#f2f2f2",flex:e.answerList.length>3?"none":1,borderRadius:"5px"},attrs:{id:"chat/answer_"+e.getModel(i)},on:{click:function(t){return e.addObject("chat/answer",i,t)}}},[s("modelMessage",{attrs:{message:t,defaultTextType:"MD","word-count":e.wordCount,"file-copyable":e.fileCopyable},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"answer-top"},[s("div",{staticClass:"model-name"},[e._v(e._s(t.roleLabel?t.roleLabel:"答案"+e.getModel(i)))])])]},proxy:!0},{key:"divider",fn:function(){return[s("Divider",{staticClass:"divider"})]},proxy:!0},e.answerComponentConfig.items.length?{key:"optimus",fn:function(){return[s("Divider",{staticClass:"divider"}),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{type:"chat/answer",model:e.getModel(i),order:i},expression:"{ type: 'chat/answer', model: getModel(index), order: index }"}],ref:"form_chat/answer_"+e.getModel(i),refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.answerComponentConfig,context:e.contextList[i],disabled:e.$optimus.disabled,answer:e.initAnswer["chat/answer_"+e.getModel(i)],group:"answer_"+i}})]},proxy:!0}:null],null,!0)})],1)})),0)]},proxy:!0},{key:"optimus",fn:function(){return[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{type:"chat/answer_round"},expression:"{ type: 'chat/answer_round' }"}],ref:"form_chat/answer_round",staticClass:"optimus-engine",attrs:{component:e.answerRoundComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:e.initAnswer["chat/answer_round"],group:"answer"}})]},proxy:!0}],null,!1,2658811500)})],1)]):e._e()],2)])])}),SC=[],_C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"top",on:{click:e.handleChange}},[e.value?e._e():s("Icon",{attrs:{type:"md-arrow-round-up"}}),s("div",{staticClass:"copy-msg"},[e._v(e._s(e.value?"取消置顶":"置顶"))])],1)])},IC=[],$C={props:{value:Boolean},methods:{handleChange(){this.$emit("input",!this.value),this.$emit("change")}}},MC=$C,TC=(s("4668"),Object(S["a"])(MC,_C,IC,!1,null,"24b1d302",null)),EC=TC.exports,LC={components:{copyButton:wl,modelMessage:sC,TopBtn:EC},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",(e,i)=>{i&&s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{prompt:{type:Object},historyChat:{type:Array,default:()=>[]},currentChat:{type:Array,default:()=>[]},curQuestion:{type:Object},answerList:{type:Array,default:()=>[]},wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},round:{type:Number},fileCopyable:{type:Boolean,default:!1}},data(){const{objects:e}=this.$optimus,t=Object(a["cloneDeep"])(e).reduce((e,t)=>{const{type:s,data:i}=t,a="chat/answer"===s?`${s}_${i.model}`:s;return Object.assign(e,{[a]:{tags:t.tags}})},{}),s=this.answerList.map(e=>({...this.$optimus.context,$index:e.subIndex}));return{objects:e,curSelected:"",initAnswer:t,curHistoryChat:[],isBigData:!1,contextList:s,isFixed:/true/i.test(localStorage.getItem("optimus-ai-reinforcement-learning-stage-isFixed"))}},computed:{questionRoundComponentConfig(){return this.getComponentConfig("chat/question_round")},answerRoundComponentConfig(){return this.getComponentConfig("chat/answer_round")},answerComponentConfig(){return this.getComponentConfig("chat/answer")},enginePrimaryKey(){return this.$optimus.enginePrimaryKey||0}},watch:{round(){this.debouncedHandleChange()}},mounted(){if(this.$optimus.renderedComponentConfig.$object_tools.forEach(e=>{this.isHasDefaultValue(e.type)&&this.$nextTick(()=>{"chat/answer"===e.type?this.answerList.forEach((t,s)=>{this.addObject(e.type,s)}):this.addObject(e.type)})}),this.historyChat.length>2e3){this.isBigData=!0;const e=this.historyChat.findLastIndex(e=>1===e.round);this.curHistoryChat=this.historyChat.slice(0,e+1)}else this.curHistoryChat=this.historyChat;this.debouncedHandleChange=Object(a["debounce"])(this.handleChange,200)},methods:{handleChangeFix(){localStorage.setItem("optimus-ai-reinforcement-learning-stage-isFixed",this.isFixed)},getIndex(e){const t=this.historyChat.slice(0,e);return t.filter(e=>"user"===e.role).length+1},getModel:n["g"],getTags(e,t){return"chat/answer"===e?this.$refs[`form_${e}_${t}`][0].tags:this.$refs["form_"+e].tags},getComponentConfig(e){const{name:t}=this.getCurTool(e),s=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:s}}=e;return"all"===s||s===t});return{component:"z-form-stage",items:s}},updateObjTags(e){const t=Object(a["findIndex"])(this.objects,t=>{const{type:s,data:{model:i}}=t;return s===e.type&&("chat/answer"!==s||i===e.model)});-1!==t?this.objects[t].tags=this.getTags(e.type,e.model):this.addObject(e.type,e.order)},addObject(e,t,s){var i,o;const r=void 0!==t?this.answerList[t].subIndex:void 0;if(s&&"chat/answer"===e){if(!this.answerComponentConfig.items.length)return;s.stopPropagation()}const l=Object(a["isUndefined"])(t)?"":this.getModel(t);if(this.curSelected="chat/answer"===e?`${e}_${l}`:e,0===this.getComponentConfig(e).items.length)return;const c=Object(a["find"])(this.objects,t=>t.type===e&&("chat/answer"!==e||t.data.model===l));if(c)return void this.$emit("select-msg",c.featureId);const{type:d,label:u,name:h}=this.getCurTool(e),p="feature-"+Object(n["e"])({enginePrimaryKey:this.enginePrimaryKey,toolType:e,subIndex:r},8),m={index:0,subIndex:r};"chat/answer"===e&&Object.assign(m,{model:l,source:null!==(i=null===(o=this.answerList[t])||void 0===o?void 0:o.source)&&void 0!==i?i:""}),this.objects.push({type:d,data:m,tags:this.getTags(e,l),featureId:p,name:h,label:u,extData:{}}),this.$emit("select-msg",p)},getCurTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{type:e})},isHasDefaultValue(e){return this.getComponentConfig(e).items.some(e=>{const{value:t}=e.attributes;return!Object(a["isNil"])(t)&&0!==t.length})},selectMsg(e){const{type:t,data:s,featureId:i}=e;this.curSelected="chat/answer"===t?`${t}_${s.model}`:t,document.getElementById(i).scrollIntoViewIfNeeded()},deleteObj(e){const{featureId:t,type:s,data:{model:i}}=e,a=this.objects.findIndex(e=>e.featureId===t);if(-1!==a){this.objects.splice(a,1);const e="chat/answer"===s?`${s}_${i}`:s;this.curSelected===e&&(this.curSelected="")}},handleChange(){const e=this.historyChat.findIndex(e=>e.round===this.round);-1!==e?this.goToItem(e):this.goToItem(this.historyChat.length)},goToItem(e){if(this.isBigData){const t=this.historyChat.findLastIndex(e=>e.round===this.round);this.curHistoryChat=this.historyChat.slice(e,t+1)}else{const t=document.getElementById("anchor-"+e);t&&t.scrollIntoView()}},handleOperation(e){switch(e){case"+":this.round<this.historyChat[this.historyChat.length-1].round&&this.$emit("update:round",this.round+1);break;case"-":this.round>1&&this.$emit("update:round",this.round-1);break;case"start":1===this.round?this.handleChange():this.$emit("update:round",1);break;case"end":this.round===this.historyChat[this.historyChat.length-1].round?this.handleChange():this.$emit("update:round",this.historyChat[this.historyChat.length-1].round);break}}}},DC=LC,PC=(s("2a91"),Object(S["a"])(DC,AC,SC,!1,null,"35690ac0",null)),BC=PC.exports,RC={label:"文生文强化学习模板",name:"z-ai-reinforcement-learning-stage",repeatable:!0,toolReadonly:!0,attributes:[{name:"historyChatKey",label:"历史对话字段名（数组元素需包含role、content字段）",type:String,value:"",vType:["array","string"]},{name:"curChatKey",label:"当前对话字段名（数组元素需包含role、content字段）",type:String,value:"",vType:["array","string"]},{name:"curQuestionKey",label:"当前问题字段名（支持string、json类型）",type:String,value:""},{name:"answerListKey",label:"答案对比集字段名（数组元素需包含content字段）",type:Array,type:String,value:"",vType:["array","string"]},{name:"fileCopyable",label:"对话文件是否允许复制",component:"z-switch",type:Boolean,value:!1},{name:"isRandom",label:"答案对比集是否随机展示",component:"z-switch",type:Boolean,value:!1}],tools:[{type:"chat/question",label:"问题标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_"+(new Date).getTime()}}]},{type:"chat/answer",label:"答案标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer"+(new Date).getTime()}}]},{type:"chat/question_round",label:"问题轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_round_"+(new Date).getTime()}}]},{type:"chat/answer_round",label:"答案轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer_round"+(new Date).getTime()}}]}],defaultTools:[{type:"chat/question_round",label:"问题整体标注",name:"chat/question_round_1715152234924",color:"#4399ED"},{type:"chat/answer_round",label:"答案整体标注",name:"chat/answer_round_1715152314813",color:"#999999"},{type:"chat/answer",label:"单个答案标注",name:"chat/answer_1715152255523",color:"#999999"}],objectAnswerJson:{description:"文生文强化学习模板",type:"array",items:{type:"object",properties:{featureId:{type:"string"},type:{type:"string"},name:{type:"string",enum:["default"]},label:{description:"可选字段，工具对应的名称",type:"string"},color:{description:"可选字段，工具对应的颜色",type:"string"},data:{oneOf:[{type:"object",required:["index","subIndex","model","source"],properties:{index:{type:"integer",minimum:0},subIndex:{type:"integer",minimum:0},model:{type:"string"},source:{type:"string"}},description:"chat/answer;chat/question_round",additionalProperties:!1},{type:"object",required:["index"],properties:{index:{type:"integer",minimum:0}},description:"chat/answer_round",additionalProperties:!1}]},tags:{description:"二级标签",type:"array"}},required:["type","name","label","color","data","tags"]}}},zC=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},e._l(e.myObjects,(function(t){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.activeItem===t.featureId},attrs:{slot:"content",id:t.featureId,type:"flex",justify:"space-between",wrap:!1},nativeOn:{click:function(s){return e.editObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("div",{staticClass:"color",style:{backgroundColor:e.getTool(t.name).color}}),t.type.includes("question")?s("div",{staticClass:"feature-title"},[e._v("Q"+e._s(e.curQuestion.round))]):e.answerList.length?s("div",{staticClass:"feature-title"},[e._v("A"+e._s(e.answerList[0].round)+" "+e._s("chat/answer"===t.type?"-答案"+t.data.model:""))]):e._e()]),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t"),disabled:!e.$optimus.debug}},[s("Button",{attrs:{icon:"ios-information-circle-outline",disabled:!e.$optimus.debug},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)],1)})),1)])},NC=[],FC={mixins:[Re["a"]],props:{curQuestion:{type:Object,default:()=>({})},answerList:{type:Array,default:()=>[]}},data(){return{objects:this.$optimus.objects,activeItem:""}},computed:{myObjects(){const e=this.objects.filter(e=>"chat/question_round"===e.type),t=this.objects.filter(e=>"chat/answer_round"===e.type),s=this.objects.filter(e=>"chat/answer"===e.type);return[...e,...t,...s]}},methods:{editObject(e){this.selectObject(e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})},selectActiveObject(e){var t;this.activeItem=e,null===(t=document.getElementById(this.activeItem))||void 0===t||t.scrollIntoViewIfNeeded()},selectObject(e){this.selectActiveObject(e.featureId),this.$emit("select-object",e)},getTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:e})}}},VC=FC,qC=(s("0c3b"),Object(S["a"])(VC,zC,NC,!1,null,"887ab486",null)),HC=qC.exports,WC={metadata:RC,components:{Annotation:BC,BaseLayout:Lp,Objects:HC},mixins:[Re["a"]],inheritAttrs:!1,props:{},data(){const e=this.$optimus.context[this.$attrs.answerListKey]||[];let t=[];t=Object(a["isString"])(e)?JSON.parse(e):e;const s=!Object.values(this.$optimus.answer).find(e=>Object(a["isArray"])(e)?e.length:!!e);return{round:1,originAnswer:t,isNew:s}},computed:{originHistoryChat(){let e=[];const t=this.$optimus.context[this.$attrs.historyChatKey]||[];if(Object(a["isString"])(t))try{e=JSON.parse(t)}catch(s){console.error(s)}else e=t;return e},historyChat(){let e=0;return this.originHistoryChat.filter(e=>"system"!==e.role).map((t,s)=>("user"===t.role&&(e+=1),{...t,index:s,round:e}))},origincurrentChat(){let e=[];const t=this.$optimus.context[this.$attrs.curChatKey]||[];if(Object(a["isString"])(t))try{e=JSON.parse(t)}catch(s){console.error(s)}else e=t;return e},currentChat(){let e=this.historyChat.length?this.historyChat[this.historyChat.length-1].round:0;const t=this.historyChat.length?this.historyChat[this.historyChat.length-1].index+1:0;return this.origincurrentChat.filter(e=>"system"!==e.role).map((s,i)=>("user"===s.role&&(e+=1),{...s,index:t+i,round:e}))},curQuestion(){if(!this.$attrs.curQuestionKey||!this.$optimus.context[this.$attrs.curQuestionKey])return null;const e=this.$optimus.context[this.$attrs.curQuestionKey],t=[...this.historyChat,...this.currentChat],s=t.length?t[t.length-1].round+1:1,i=t.length?t[t.length-1].index+1:0;let o={};if(Object(a["isString"])(e))try{if(o=JSON.parse(e),void 0===o.role&&void 0===o.content&&void 0===o.multimedias)throw new Error("解析的json不是model message")}catch(n){console.log(n),o={content:e}}else o=e;return{...o,role:"user",round:s,index:i}},answerOrder(){var e,t,s,i;if(null!==(e=this.$optimus.extData)&&void 0!==e&&e.answerOrder)return null===(i=this.$optimus.extData)||void 0===i?void 0:i.answerOrder;if(!this.isNew&&!this.$optimus.answer.fitting||!this.$attrs.isRandom)return[];if(null===(t=this.originAnswer)||void 0===t||!t.length)return[];const[a]=Object(n["h"])(null===(s=this.$optimus.reference)||void 0===s?void 0:s.datasetItemId,1,this.originAnswer.length);return a},answerList(){let e=this.originAnswer;const t=[...this.historyChat,...this.currentChat];let s=1,i=0;return t.length&&(s=t[t.length-1].round+1,i=t[t.length-1].index+1),this.curQuestion&&(i+=1),e=e.map((e,t)=>{let o={};if(Object(a["isArray"])(e)){const t=e.findLastIndex(e=>"assistant"===e.role||!e.role);o={...e[t],extra:e.filter((e,s)=>s!==t)}}else o=Object(a["isString"])(e)?{content:e}:e;return{...o,role:"assistant",round:s,index:i,order:this.answerOrder.length?this.answerOrder[t]:t,subIndex:t}}),this.answerOrder.length&&e.sort((e,t)=>e.order-t.order),e},prompt(){const e=[...this.originHistoryChat,...this.originHistoryChat].find(e=>"system"===e.role);return e},key(){return JSON.stringify(this.$attrs)}},mounted(){var e;null!==(e=this.$optimus.extData)&&void 0!==e&&e.answerOrder||!this.answerOrder.length||(this.$optimus.extData={answerOrder:this.answerOrder})},methods:{selectMsg(e){this.$nextTick(()=>{this.$refs.objectsRef.selectActiveObject(e)})},selectObject(e){this.$refs.annotationRef.selectMsg(e)},deleteObject(e){this.$refs.annotationRef.deleteObj(e)},handleOperation(e){this.$refs.annotationRef.handleOperation(e)},updateRound(e){this.round=e}}},UC=WC,QC=Object(S["a"])(UC,OC,kC,!1,null,null,null),JC=QC.exports,GC=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"operation-left",fn:function(){return[e.totalRound>1?s("Row",{staticStyle:{"margin-left":"auto"},attrs:{justify:"end",align:"middle"}},[s("div",{staticStyle:{display:"flex","align-items":"center",gap:"4px"}},[s("Button",{attrs:{type:"text",icon:"ios-skip-backward",size:"small"},on:{click:function(t){return e.handleOperation("start")}}}),s("Button",{attrs:{type:"text",icon:"ios-arrow-back",size:"small"},on:{click:function(t){return e.handleOperation("-")}}}),s("span",[e._v("跳至")]),s("InputNumber",{attrs:{size:"small",max:e.totalRound,min:1},model:{value:e.round,callback:function(t){e.round=t},expression:"round"}}),s("span",[e._v("/"+e._s(e.totalRound)+" 轮")]),s("Button",{attrs:{type:"text",icon:"ios-arrow-forward",size:"small"},on:{click:function(t){return e.handleOperation("+")}}}),s("Button",{attrs:{type:"text",icon:"ios-skip-forward",size:"small"},on:{click:function(t){return e.handleOperation("end")}}})],1)]):e._e()]},proxy:!0},{key:"component",fn:function(t){var i=t.wordCount;return[e.errTip?s("Alert",{attrs:{type:"warning","show-icon":""}},[e._v(e._s(e.errTip))]):e._e(),s("Annotation",{ref:"annotationRef",attrs:{"origin-message-list":e.originMessageList,"base-message-list":e.baseMessageList,round:e.round,"total-round":e.totalRound,"word-count":i,"file-copyable":e.$attrs.fileCopyable,"is-random":e.$attrs.isRandom,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-msg":e.selectMsg,"update:round":e.updateRound}})]}},{key:"global",fn:function(){return[e._t("default")]},proxy:!0},{key:"objects",fn:function(){return[s("Objects",{ref:"objectsRef",attrs:{"base-message-list":e.baseMessageList,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-object":e.selectObject,"delete-object":e.deleteObject}})]},proxy:!0}],null,!0)})},KC=[],YC=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{staticClass:"chat-container"},[e.prompt?s("div",{staticClass:"chat-item",class:(e.isFixed?"fixed-":"")+"prompt"},[s("modelMessage",{attrs:{message:e.prompt,maxHeight:"300",wordCount:e.wordCount,fileCopyable:e.fileCopyable},scopedSlots:e._u([{key:"operation",fn:function(){return[s("top-btn",{on:{change:e.handleChangeFix},model:{value:e.isFixed,callback:function(t){e.isFixed=t},expression:"isFixed"}})]},proxy:!0}],null,!1,3208518707)})],1):e._e(),e.messageList[0]&&e.messageList[0][0]?s("div",{staticClass:"chat-list",class:e.isFixed?"overflow":""},e._l(e.messageList,(function(t){return s("div",{staticClass:"chat-item",attrs:{id:"anchor-"+t[0].index}},[e.showPagination(t)?s("t-pagination",{key:t[0].round,staticClass:"page",staticStyle:{width:"100%"},attrs:{"page-size":e.paginations[t[0].round].pageSize,current:e.paginations[t[0].round].current,total:e.getPageTotal(t),theme:"simple"},on:{"update:pageSize":function(s){return e.$set(e.paginations[t[0].round],"pageSize",s)},"update:page-size":function(s){return e.$set(e.paginations[t[0].round],"pageSize",s)},change:function(s){return e.handlePageChange(t,s)}}}):e._e(),s("div",{staticStyle:{"white-space":"nowrap","margin-right":"4px","min-width":"32px"}},[s("span",[e._v(e._s(e.getMsgRound(t)))]),t[0].subRound?s("span",[e._v("-"+e._s(t[0].subRound))]):e._e()]),s("div",{staticClass:"chat-item-container",class:{isSelect:e.selectedIndex===t[0].index&&null===e.selectedAnswerIndex},attrs:{id:"chat-"+t[0].index},on:{click:function(s){return e.addObject(t[0].index)}}},["assistant"===t[0].role?s("div",{staticClass:"message-container"},[s("div",[s("Avatar",{staticClass:"avatar",attrs:{icon:"ios-cube-outline",size:"30"}}),t.length>1?s("b",{staticStyle:{color:"#4d4d4d"}},[e._v("助手")]):e._e()],1),s("div",{style:{display:"flex",gap:"8px",flexDirection:t.length>3?"column":"row"}},e._l(t,(function(i,a){return s("div",{staticClass:"message-content",class:{isSelect:e.selectedIndex===i.index&&e.selectedAnswerIndex===a},style:{backgroundColor:e.roleConfig.assistant.msgContentBg,marginBottom:"8px"},attrs:{id:"chat-"+i.index+"-"+a},on:{click:function(t){return t.stopPropagation(),e.addObject(i.index,a)}}},[s("modelMessage",{key:"model-"+i.index+"-"+a,class:1===t.length?"single":"",attrs:{message:i.message,icon:!1,defaultTextType:"MD",wordCount:e.wordCount,fileCopyable:e.fileCopyable},scopedSlots:e._u([t.length>1?{key:"extra",fn:function(){return[s("Divider",{staticStyle:{margin:"8px 0"}})]},proxy:!0}:null,e.answerComponentConfig.items.length>0?{key:"optimus",fn:function(){return[s("Divider",{staticStyle:{margin:"8px 0"}}),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:[i.index,a],expression:"[chat.index, i]"}],key:"answer-"+i.index+"-"+a,ref:"form_"+i.index+"_"+a,refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.answerComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:i.answer,group:e.getMsgRound(t)+"_"+a}})]},proxy:!0}:null],null,!0)})],1)})),0)]):[s("modelMessage",{key:t[0].index,attrs:{message:t[0].message,wordCount:e.wordCount}})],e.roleConfig[t[0].role]&&e.roleConfig[t[0].role].toolType?s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:[t[0].index,null],expression:"[message[0].index, null]"}],key:"common-"+t[0].index,ref:"form_"+t[0].index,refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.componentConfigMap[e.roleConfig[t[0].role].toolType],context:e.$optimus.context,disabled:e.$optimus.disabled,answer:t[0].roundAnswer,group:e.getMsgRound(t)}}):e._e()],2)],1)})),0):e._e()])])},ZC=[],XC={components:{modelMessage:sC,TopBtn:EC},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",(e,i)=>{i&&s.context.updateObjTags(...t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{baseMessageList:{type:Array,default:()=>[]},originMessageList:{type:Array,default:()=>[]},round:{type:Number},totalRound:{type:Number},wordCount:{type:Object,default:()=>({enabled:!0,type:"字数"})},fileCopyable:{type:Boolean,default:!1}},data(){const{objects:e}=this.$optimus;return{objects:e,paginations:{},selectedIndex:null,selectedAnswerIndex:null,isFixed:/true/i.test(localStorage.getItem("optimus-ai-history-chat-stage-isFixed")),messageList:[],isBigData:!1,roleConfig:{user:{label:"用户",avatarIcon:"ios-person",avatarBg:"#4399ED",msgContentBg:"#C7E3FF",toolType:"chat/question_round"},assistant:{label:"助手",avatarIcon:"ios-cube-outline",avatarBg:"#4d4d4d",msgContentBg:"#f2f2f2",toolType:"chat/answer_round"},tool:{label:"Tool",avatarIcon:"md-build",avatarBg:"#4d4d4d",msgContentBg:"#f2f2f2",toolType:"chat/tool_round"},planner:{label:"Planner",avatarIcon:"md-bulb",avatarBg:"#4d4d4d",msgContentBg:"#f2f2f2",toolType:"chat/planner_round"},system:{label:"system prompt"},other:{label:"其他"}},currentLength:0}},computed:{prompt(){var e;return null!==(e=this.originMessageList[0])&&void 0!==e&&e.length&&"system"===this.originMessageList[0][0].role?this.originMessageList[0][0]:""},componentConfigMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{const{type:s,name:i}=t;e[s]={component:"z-form-stage",items:this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return"all"===t||t===i})}}),e},answerComponentConfig(){return this.getComponentConfig("chat/answer")}},watch:{round(){this.isBigData&&this.saveData2Base(),this.debouncedHandleChange()}},async mounted(){if(this.initPagination(),this.baseMessageList.length>2e3){this.isBigData=!0;const e=this.baseMessageList.findLastIndex(([e])=>1===e.round);this.messageList=this.baseMessageList.slice(0,e+1),this.setObjects()}else console.log("开始加载"),await this.loadMore(),console.log("加载完成"),this.$nextTick(()=>{this.baseMessageList.forEach(e=>{var t;const s=null===(t=this.roleConfig[e[0].role])||void 0===t?void 0:t.toolType;s&&this.isHasDefaultValue(s)&&this.addObject(e[0].index),e.forEach((e,t)=>{"assistant"===e.role&&this.isHasDefaultValue("chat/answer")&&this.addObject(e.index,t)})})});this.debouncedHandleChange=Object(a["debounce"])(this.handleRoundChange,200)},methods:{saveData2Base(){this.messageList.forEach(e=>{const t=this.objects.find(t=>t.data.index===e[0].index&&void 0===t.data.subIndex);t&&this.$set(this.baseMessageList[e[0].index],0,{...e[0],roundAnswer:{tags:t.tags}}),e.forEach((e,t)=>{if("assistant"===e.role){const s=this.objects.find(t=>t.data.subIndex===e.subIndex&&t.data.index===e.index);s&&this.$set(this.baseMessageList[e.index],t,{...e,answer:{tags:s.tags}})}})})},showPagination(e){const t=this.messageList.find(t=>t[0].round===e[0].round);return this.getPageTotal(e)>=10&&(null===t||void 0===t?void 0:t[0].index)===e[0].index},handlePageChange(e,t){const[{round:s}]=e;this.$delete(this.paginations,s),this.$set(this.paginations,s,{current:t.current,pageSize:t.pageSize}),this.saveData2Base();const i=this.baseMessageList.filter(e=>{const t=(this.paginations[e[0].round].current-1)*this.paginations[e[0].round].pageSize,i=this.paginations[e[0].round].current*this.paginations[e[0].round].pageSize;return e[0].round===s&&e[0].subRound>=t&&e[0].subRound<i}),a=this.messageList.findIndex(e=>e[0].round===s),o=this.messageList.findLastIndex(e=>e[0].round===s);this.messageList.splice(a,o-a+1,...i),this.setObjects()},initPagination(){this.baseMessageList.forEach(e=>{this.paginations[e[0].round]||(this.paginations[e[0].round]={current:1,pageSize:10})})},getPageTotal(e){let t=0;return this.baseMessageList.forEach(s=>{s[0].round===e[0].round&&(t+=1)}),t},getMsgRound(e){return`${"user"===e[0].role?"Q":"A"}${e[0].round}`},setObjects(){this.messageList.forEach(e=>{var t;const s=null===(t=this.roleConfig[e[0].role])||void 0===t?void 0:t.toolType;s&&this.isHasDefaultValue(s)&&this.addObject(e[0].index),e.forEach((e,t)=>{"assistant"===e.role&&this.isHasDefaultValue("chat/answer")&&this.addObject(e.index,t)})})},handleChangeFix(){localStorage.setItem("optimus-ai-history-chat-stage-isFixed",this.isFixed)},getComponentConfig(e){var t;const s=null===(t=this.getCurTool(e))||void 0===t?void 0:t.name;if(s){const e=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return"all"===t||t===s});return{component:"z-form-stage",items:e}}return{items:[]}},updateObjTags(e,t=null){const s=null===t?null:this.baseMessageList[e][t].subIndex,i=Object(a["findIndex"])(this.objects,t=>{const{data:{index:i,subIndex:a}}=t;return null===s?i===e&&void 0===a:i===e&&a===s});-1!==i?null===s?(this.$set(this.objects[i],"tags",this.$refs["form_"+e][0].tags),this.objects[i].tags=this.$refs["form_"+e][0].tags):this.$set(this.objects[i],"tags",this.$refs[`form_${e}_${t}`][0].tags):this.addObject(e,t)},addObject(e,t=null){var s;const i=null===t?null:this.baseMessageList[e][t].subIndex;this.selectedIndex=e,this.selectedAnswerIndex=t;const[{role:o}]=this.baseMessageList[e],r=null===i?null===(s=this.roleConfig[o])||void 0===s?void 0:s.toolType:"chat/answer";if(0===this.getComponentConfig(r).items.length)return;const l=Object(a["find"])(this.objects,t=>null===i?t.data.index===e&&void 0===t.data.subIndex:t.data.index===e&&t.data.subIndex===i);if(l)return void this.$emit("select-msg",l.featureId);const{type:c,label:d,name:u}=this.getCurTool(r),h="feature-"+Object(n["e"])({index:e,subIndex:i},8),p={type:c,data:{index:e},featureId:h,name:u,label:d,extData:{}};if(null!==i){const{roleLabel:s,source:a}=this.baseMessageList[e][t].message;p.data.subIndex=i,p.data.label=s,a&&(p.data.source=a),this.$refs[`form_${e}_${t}`]&&(p.tags=this.$refs[`form_${e}_${t}`][0].tags),this.objects.push(p),this.$emit("select-msg",h)}else this.$refs["form_"+e]&&(p.tags=this.$refs["form_"+e][0].tags),this.objects.push(p),this.$emit("select-msg",h)},getCurTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{type:e})},isHasDefaultValue(e){return this.getComponentConfig(e).items.some(e=>{const{value:t}=e.attributes;return!Object(a["isNil"])(t)&&0!==t.length})},selectMsg(e){var t,s;this.selectedIndex=e.data.index,this.selectedAnswerIndex=void 0===e.data.subIndex?null:null!==(t=null===(s=this.$optimus.extData)||void 0===s?void 0:s.roundOrders[e.data.index][e.data.subIndex])&&void 0!==t?t:e.data.subIndex;const[{round:i}]=this.baseMessageList[this.selectedIndex];this.$emit("update:round",i);const a=Math.floor(this.baseMessageList[this.selectedIndex][0].subRound/this.paginations[this.baseMessageList[this.selectedIndex][0].round].pageSize)+1;if(a>0&&a!==this.paginations[this.baseMessageList[this.selectedIndex][0].round].current)return this.handlePageChange(this.baseMessageList[this.selectedIndex],{current:a,pageSize:this.paginations[this.baseMessageList[this.selectedIndex][0].round].pageSize}),void this.$nextTick(()=>{this.scroll2Item()});this.scroll2Item()},scroll2Item(){null===this.selectedAnswerIndex?document.getElementById("chat-"+this.selectedIndex).scrollIntoViewIfNeeded():document.getElementById(`chat-${this.selectedIndex}-${this.selectedAnswerIndex}`).scrollIntoViewIfNeeded()},deleteObj(e){const{featureId:t,data:{index:s}}=e,i=this.objects.findIndex(e=>e.featureId===t);-1!==i&&(this.objects.splice(i,1),this.selectedIndex===s&&(this.selectedIndex=null))},loadMore(){return new Promise(e=>{if(this.currentLength<this.baseMessageList.length&&this.messageList.length<1e3){const t=Math.min(this.currentLength+20,this.baseMessageList.length),s=this.baseMessageList.slice(this.currentLength,t).filter(e=>{const t=this.getPageTotal(e),s=(this.paginations[e[0].round].current-1)*this.paginations[e[0].round].pageSize,i=this.paginations[e[0].round].current*this.paginations[e[0].round].pageSize;return t>=10?e[0].subRound>=s&&e[0].subRound<i:e});this.currentLength+=20,this.messageList.push(...s),requestAnimationFrame(()=>this.loadMore().then(e))}else e()})},handleOperation(e){switch(e){case"+":this.round<this.totalRound&&this.$emit("update:round",this.round+1);break;case"-":this.round>1&&this.$emit("update:round",this.round-1);break;case"start":1===this.round?this.handleRoundChange():this.$emit("update:round",1);break;case"end":this.round===this.totalRound?this.handleRoundChange():this.$emit("update:round",this.totalRound);break}},handleRoundChange(){const e=Object(a["findIndex"])(this.baseMessageList,([e])=>e.round===this.round);this.goToItem(this.baseMessageList[e][0].index)},goToItem(e){if(this.isBigData){const t=this.baseMessageList.findLastIndex(([e])=>e.round===this.round);this.messageList=this.baseMessageList.slice(e,t+1),this.setObjects()}else{const t=document.getElementById("anchor-"+e);t&&t.scrollIntoView()}}}},ej=XC,tj=(s("070c"),Object(S["a"])(ej,YC,ZC,!1,null,"1c306388",null)),sj=tj.exports,ij={label:"离线多轮图文对话标注",name:"z-ai-history-chat-stage",repeatable:!0,toolReadonly:!0,attributes:[{name:"historyChatKey",label:"历史对话字段名（数组元素需包含role、content字段）",type:String,value:"",vType:["array","string"]},{name:"fileCopyable",label:"对话文件是否允许复制",component:"z-switch",type:Boolean,value:!1},{name:"isRandom",label:"每轮对话是否随机展示",component:"z-switch",type:Boolean,value:!1}],tools:[{type:"chat/question",label:"问题标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_"+(new Date).getTime()}}]},{type:"chat/answer",label:"答案标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer"+(new Date).getTime()}}]},{type:"chat/question_round",label:"问题轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_round_"+(new Date).getTime()}}]},{type:"chat/answer_round",label:"答案轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer_round"+(new Date).getTime()}}]},{type:"chat/planner_round",label:"思考轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/planner_round"+(new Date).getTime()}}]},{type:"chat/tool_round",label:"工具轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/tool_round"+(new Date).getTime()}}]}],defaultTools:[{type:"chat/question_round",label:"问题整体标注",name:"chat/question_round_1715152234924",color:"#4399ED"},{type:"chat/answer_round",label:"答案整体标注",name:"chat/answer_round_1715152314813",color:"#999999"},{type:"chat/planner_round",label:"Planner整体标注",name:"chat/planner_round_1720682324144",color:"#999999"},{type:"chat/tool_round",label:"Tool整体标注",name:"chat/tool_round_1720682343308",color:"#999999"},{type:"chat/answer",label:"单个答案标注",name:"chat/answer_1715152255523",color:"#999999"}]},aj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},e._l(e.myObjects,(function(t,i){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.activeItem===t.featureId},attrs:{slot:"content",id:t.featureId,type:"flex",justify:"space-between",wrap:!1},nativeOn:{click:function(s){return e.editObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("div",{staticClass:"color",style:{backgroundColor:e.getTool(t.type).color}}),s("div",{staticClass:"feature-title"},[e._v(e._s(e.getObjectLabel(t)))])]),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t"),disabled:!e.$optimus.debug}},[s("Button",{attrs:{icon:"ios-information-circle-outline",disabled:!e.$optimus.debug}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)],1)})),1)])},oj=[],nj={mixins:[Re["a"]],props:{baseMessageList:{type:Array,default:()=>[]}},data(){return{objects:this.$optimus.objects,activeItem:""}},computed:{myObjects(){return Object(a["sortBy"])(this.objects,e=>e.data.index)}},mounted(){this.$optimus.getObjectLabel=this.getObjectLabel},methods:{getObjectLabel(e){const t=this.baseMessageList[e.data.index],s=t[0].subRound?"-"+t[0].subRound:"",i=void 0!==e.data.subIndex?"-"+(e.data.label||"答案"+Object(n["g"])(e.data.subIndex)):"";return`${"user"===t[0].role?"Q":"A"}${t[0].round}${s}${i}`},getIndex(e){const t=this.baseMessageList.slice(0,e);return t.filter(e=>"user"===e.role).length+1},editObject(e){this.selectObject(e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})},selectActiveObject(e){this.activeItem=e},selectObject(e){this.selectActiveObject(e.featureId),this.$emit("select-object",e)},getTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{type:e})},getRole(e){return this.baseMessageList[e][0].role}}},rj=nj,lj=(s("b8cf"),Object(S["a"])(rj,aj,oj,!1,null,"f5e70aea",null)),cj=lj.exports,dj={metadata:ij,components:{Annotation:sj,BaseLayout:Lp,Objects:cj},mixins:[Re["a"]],inheritAttrs:!1,props:{},data(){const e=!Object.values(this.$optimus.answer).find(e=>Object(a["isArray"])(e)?e.length:!!e);return{errors:{none:[],jsonError:[]},round:1,chatKeys:this.$attrs.historyChatKey?this.$attrs.historyChatKey.split(","):[],isNew:e}},computed:{errTip(){if(!this.errors.none.length&&!this.errors.jsonError.length)return"";let e="存在字段配置错误：";return this.errors.none.length&&(e+=this.errors.none.join("、")+"字段不存在，已剔除"),this.errors.jsonError.length&&(this.errors.none.length&&(e+="；"),e+=this.errors.jsonError.join("、")+"字段解析错误，已剔除"),e},originMessageList(){return this.chatKeys.length?this.chatKeys.map(e=>{const t=this.$optimus.context[e];let s=[];if(!t)return this.errors.none.push(e),null;if(Object(a["isString"])(t))try{s=JSON.parse(t)}catch(i){return console.log(t,i),this.errors.jsonError.push(e),null}else s=t;return s=s.map(e=>{const t=Object(a["isString"])(e.content)?e.content:JSON.stringify(e.content);return{...e,content:t}}),s}).filter(e=>!!e):[]},filterChat(){return this.originMessageList.map(e=>e.filter(e=>"system"!==e.role))},roundOrders(){var e,t,s;if(null!==(e=this.$optimus.extData)&&void 0!==e&&e.roundOrders)return null===(s=this.$optimus.extData)||void 0===s?void 0:s.roundOrders;if(!this.isNew&&!this.$optimus.answer.fitting||!this.$attrs.isRandom)return[];const{filterChat:i}=this;if(!i.length||!i[0].length)return[];const a=i.length,o=i[0].length,r=Object(n["h"])(null===(t=this.$optimus.reference)||void 0===t?void 0:t.datasetItemId,o,a);return r},baseMessageList(){if(this.originMessageList.length&&this.originMessageList[0]){const{filterChat:e}=this;let t=0,s=0;const i=e[0].reduce((i,a,o)=>{const n=[],{role:r}=a;"user"===r?(t+=1,s=0):(e[0][o+1]&&e[0][o-1]&&("user"!==e[0][o+1].role||"user"!==e[0][o-1].role)||!e[0][o+1]&&"user"!==e[0][o-1].role)&&(s+=1);const l=this.$optimus.objects.find(e=>e.data.index===o&&void 0===e.data.subIndex);for(let c=0;c<this.originMessageList.length;c++){const i=this.$optimus.objects.find(e=>e.data.index===o&&e.data.subIndex===c),a=this.roundOrders.length?this.roundOrders[o][c]:c;n.push({index:o,role:r,round:t,subRound:s,subIndex:c,order:a,roundAnswer:l?{tags:l.tags}:{},answer:i?{tags:i.tags}:{},message:{...e[c][o],roleLabel:this.getRoleLabel(r,a,e[c][o])}})}return i.push(n),i},[]);return this.roundOrders.length&&i.forEach(e=>{e.sort((e,t)=>e.order-t.order)}),i}return[]},totalRound(){const{length:e}=this.baseMessageList;return e&&this.baseMessageList[e-1]&&this.baseMessageList[e-1][0]?this.baseMessageList[e-1][0].round:0}},mounted(){!this.$optimus.extData&&this.roundOrders.length&&(this.$optimus.extData={roundOrders:this.roundOrders})},methods:{getRoleLabel(e,t,s){return null!==s&&void 0!==s&&s.roleLabel?s.roleLabel:"assistant"===e&&this.originMessageList.length>1?"答案"+Object(n["g"])(t):void 0},selectMsg(e){this.$nextTick(()=>{this.$refs.objectsRef.selectActiveObject(e)})},selectObject(e){this.$refs.annotationRef.selectMsg(e)},deleteObject(e){this.$refs.annotationRef.deleteObj(e)},handleOperation(e){this.$refs.annotationRef.handleOperation(e)},updateRound(e){this.round=e}}},uj=dj,hj=Object(S["a"])(uj,GC,KC,!1,null,null,null),pj=hj.exports,mj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[s("Annotation",e._b({ref:"annotationRef",attrs:{$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-msg":e.selectMsg}},"Annotation",e.$attrs,!1))]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0},{key:"objects",fn:function(){return[s("Objects",e._b({ref:"objectsRef",attrs:{$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-object":e.selectObject,"delete-object":e.deleteObject}},"Objects",e.$attrs,!1))]},proxy:!0}],null,!0)})},gj=[],bj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{staticClass:"title"},[e._v("历史对话")]),s("div",{staticClass:"chat-box"},e._l(e.historyChat,(function(t,i){return s("div",{staticClass:"chat-item"},[s("div",{staticClass:"chat-index"},[e._v(e._s("user"===t.role?"Q":"A")+e._s(e.getIndex("user"===t.role?i:i-1)))]),s("div",{staticClass:"chat-message"},[s("modelMessage",{attrs:{message:t,defaultTextType:"assistant"===t.role?"MD":"text"}})],1)])})),0),e.userPrompt?[s("Row",{attrs:{justify:"space-between",align:"middle"}},[s("div",{staticClass:"title"},[e._v("Query召回")]),s("div",{staticClass:"is-rewrite"},[s("Checkbox",{attrs:{disabled:e.$optimus.disabled},model:{value:e.$optimus.formData.isNotRewrite,callback:function(t){e.$set(e.$optimus.formData,"isNotRewrite",t)},expression:"$optimus.formData.isNotRewrite"}},[e._v("无需改写")])],1)]),s("Row",{staticClass:"row"},[e._l(e.modelList,(function(t){return["modelRewrite"===t&&e.$optimus.formData.isNotRewrite?e._e():s("div",{staticClass:"col"},[s("div",{staticClass:"chat-message",class:{isSelect:e.curSelected===t+"_0"},attrs:{id:"chat_"+t+"_0"},on:{click:function(s){return e.addObject({model:t,index:0,toolName:"model"===t?"chat/question_user_prompt":"chat/question_prompt_rewrite"})}}},[s("modelMessage",{attrs:{message:{content:e.userPrompt,role:"user",roleLabel:"model"===t?"用户指令":"指令改写"},"operation-enabled":"model"===t},scopedSlots:e._u(["model"!==t?{key:"content",fn:function(){return[s("Input",{attrs:{type:"textarea",rows:3,disabled:2===e.$optimus.formData.modelRewrite.length||"loading"===e.fetchStatusMap.modelRewrite||e.$optimus.disabled,placeholder:"输入需要改写的指令"},model:{value:e.rewriteInput,callback:function(t){e.rewriteInput=t},expression:"rewriteInput"}}),s("div",{staticClass:"search-btn"},[2===e.$optimus.formData.modelRewrite.length?s("Button",{attrs:{type:"primary",size:"small",disabled:e.$optimus.disabled},on:{click:e.handleRewrite}},[e._v("重写")]):s("Button",{attrs:{type:"primary",size:"small",loading:"loading"===e.fetchStatusMap.modelRewrite,disabled:e.$optimus.disabled},on:{click:e.handleSearch}},[e._v("搜索")])],1)]},proxy:!0}:null,{key:"optimus",fn:function(){return[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{model:t,index:0},expression:"{ model, index: 0 }"}],ref:"form_chat_"+t+"_0",refInFor:!0,staticClass:"optimus-engine",attrs:{component:"model"===t?e.userPromptComponentConfig:e.promptRewriteComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:e.initAnswer[t+"_0"]}})]},proxy:!0}],null,!0)})],1)])]}))],2),s("Row",{staticClass:"row",staticStyle:{margin:"8px 0"}},[e._l(e.modelList,(function(t){return["modelRewrite"===t&&e.$optimus.formData.isNotRewrite?e._e():s("div",{staticClass:"col"},[s("div",{staticClass:"chat-message",class:{isSelect:e.curSelected===t+"_1"},attrs:{id:"chat_"+t+"_1"},on:{click:function(s){return e.addObject({model:t,index:1,toolType:"chat/answer"})}}},[s("modelMessage",{attrs:{message:{role:"assistant",roleLabel:"搜索结果"},"operation-enabled":!1},scopedSlots:e._u([{key:"content",fn:function(){return["loading"===e.fetchStatusMap[t]?s("Spin",{staticClass:"spin"}):"rejected"===e.fetchStatusMap[t]?s("div",[e._v("请求出错")]):e.$optimus.formData[t][1]?s("div",{staticClass:"debug-list"},[e.$optimus.formData[t][1].content?s("div",{staticClass:"debug-message"},[s("modelMessage",{attrs:{message:{content:e.$optimus.formData[t][1].content,role:"assistant"},icon:!1}})],1):e._e(),e._l(e.$optimus.formData[t][1].debug,(function(i,a){return s("div",{staticClass:"debug-item",class:{isSelect:e.curSelected===t+"_1_"+a},attrs:{id:"chat_"+t+"_1_"+a},on:{click:function(s){return s.stopPropagation(),e.addObject({model:t,index:1,subIndex:a,toolType:"chat/sub_answer"})}}},[s("div",{staticStyle:{"font-weight":"bold"}},[s("span",[e._v("【"+e._s(i.index)+"】")]),s("a",{attrs:{href:i.url,target:"_blank"}},[e._v(e._s(i.title))])]),s("div",[s("span",[e._v(e._s(i.publish_time))]),s("span",{staticClass:"quote"},[e._v(e._s(i.quote))])]),s("Divider",{staticStyle:{margin:"8px 0"}}),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{model:t,index:1,subIndex:a},expression:"{ model, index: 1, subIndex}"}],ref:"form_chat_"+t+"_1_"+a,refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.subAnswerComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:e.initAnswer[t+"_1_"+a]}})],1)}))],2):s("div",[e._v("请先点击搜索")])]},proxy:!0},{key:"optimus",fn:function(){return[e.$optimus.formData[t][1]&&"loading"!==e.fetchStatusMap[t]?s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{model:t,index:1},expression:"{ model, index: 1}"}],ref:"form_chat_"+t+"_1",refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.answerComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:e.initAnswer[t+"_1"]}}):e._e()]},proxy:!0}],null,!0)})],1)])]}))],2)]:e._e()],2)},fj=[],vj={components:{modelMessage:sC},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{historyChatKey:{type:[Array,String],default:()=>[]},userPromptKey:String,searchTypeKey:String},data(){var e,t,s;return{initAnswer:this.getAnswer(),curSelected:"",rewriteInput:(null===(e=this.$optimus.formData)||void 0===e||null===(t=e.modelRewrite)||void 0===t||null===(s=t[0])||void 0===s?void 0:s.content)||"",modelList:["model","modelRewrite"],fetchStatusMap:{model:"",modelRewrite:""}}},computed:{userPromptComponentConfig(){return this.getComponentConfig({toolName:"chat/question_user_prompt"})},promptRewriteComponentConfig(){return this.getComponentConfig({toolName:"chat/question_prompt_rewrite"})},subAnswerComponentConfig(){return this.getComponentConfig({toolType:"chat/sub_answer"})},answerComponentConfig(){return this.getComponentConfig({toolType:"chat/answer"})},historyChat(){const e=this.$optimus.context[this.historyChatKey];return Object(a["isString"])(e)?JSON.parse(e):e},userPrompt(){return this.$optimus.context[this.userPromptKey]||""},searchType(){return this.$optimus.context[this.searchTypeKey]||""}},watch:{"$optimus.formData.isNotRewrite"(e){e?(this.$set(this.$optimus,"objects",this.$optimus.objects.filter(e=>"model"===e.data.model)),this.rewriteInput="",this.$optimus.formData.modelRewrite=[],this.initAnswer=this.getAnswer()):this.addDefaultObject({model:"modelRewrite",index:0,toolName:"chat/question_prompt_rewrite"})}},created(){this.modelList.forEach(e=>{Object(a["isUndefined"])(this.$optimus.formData.isNotRewrite)&&this.$set(this.$optimus.formData,"isNotRewrite",!1),this.$optimus.formData[e]||this.$set(this.$optimus.formData,e,[])})},mounted(){this.$optimus.$on("optimus:forms-stage:check",()=>{const{isValid:e,msg:t}=this.validate();this.$optimus.$emit("optimus:optimus-engine:check",e,t)}),this.addDefaultObject({model:"model",index:0,toolName:"chat/question_user_prompt"}),0===this.$optimus.formData.model.length&&this.fetchSearchEnhanceApi("model")},methods:{getAnswer(){return Object(a["cloneDeep"])(this.$optimus.objects).reduce((e,t)=>{const{data:{model:s,index:i,subIndex:o}}=t,n=Object(a["isUndefined"])(o)?`${s}_${i}`:`${s}_${i}_${o}`;return Object.assign(e,{[n]:{tags:t.tags}})},{})},handleSearch(){this.rewriteInput.trim()?this.fetchSearchEnhanceApi("modelRewrite"):this.$Message.warning("请先输入需要改写的指令")},handleRewrite(){this.$set(this.$optimus,"objects",this.$optimus.objects.filter(e=>!("modelRewrite"===e.data.model&&["chat/sub_answer","chat/answer"].includes(e.type)))),this.$optimus.formData.modelRewrite=[],this.initAnswer=this.getAnswer()},updateObjTags(e){const t=Object(a["findIndex"])(this.$optimus.objects,t=>{const{data:{model:s,index:i,subIndex:o}}=t;return s===e.model&&i===e.index&&(Object(a["isUndefined"])(e.subIndex)?Object(a["isUndefined"])(o):o===e.subIndex)});-1!==t&&(this.$optimus.objects[t].tags=this.getTags(e.model,e.index,e.subIndex))},addObject(e){const{model:t,index:s,subIndex:i,toolType:o,toolName:r}=e,l=this.getTags(t,s,i);if(0===this.getComponentConfig({toolType:o,toolName:r}).items.length||0===l.length)return;this.curSelected=Object(a["isUndefined"])(i)?`${t}_${s}`:`${t}_${s}_${i}`;const c=Object(a["find"])(this.$optimus.objects,e=>e.data.model===t&&e.data.index===s&&(Object(a["isUndefined"])(i)?Object(a["isUndefined"])(e.data.subIndex):e.data.subIndex===i));if(c)return void this.$emit("select-msg",c.featureId);const{type:d,label:u,name:h}=this.getCurTool({toolType:o,toolName:r}),p="feature-"+Object(n["j"])(8);this.$optimus.objects.push({type:d,data:{index:s,model:t,subIndex:i},tags:l,featureId:p,name:h,label:u,extData:{}}),this.$emit("select-msg",p)},getCurTool(e){const{toolType:t,toolName:s}=e;return Object(a["find"])(this.$renderedComponentConfig.$object_tools,e=>t&&e.type===t||s&&e.name===s)},getIndex(e){const t=this.historyChat.slice(0,e);return t.filter(e=>"user"===e.role).length+1},getTags(e,t,s){const i=Object(a["isUndefined"])(s)?this.$refs[`form_chat_${e}_${t}`]:this.$refs[`form_chat_${e}_${t}_${s}`];return i?i[0].tags:[]},getComponentConfig(e){const{name:t}=this.getCurTool(e),s=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:s}}=e;return"all"===s||s===t});return{component:"z-form-stage",items:s}},addDefaultObject(e){const{toolType:t,toolName:s}=e,i=this.getComponentConfig({toolType:t,toolName:s}).items.some(e=>{const{value:t}=e.attributes;return!Object(a["isNil"])(t)&&0!==t.length});i&&this.$nextTick(()=>{this.addObject(e)})},selectMsg(e){const{data:{subIndex:t,model:s,index:i}}=e;this.curSelected=Object(a["isUndefined"])(t)?`${s}_${i}`:`${s}_${i}_${t}`,document.getElementById("chat_"+this.curSelected).scrollIntoViewIfNeeded()},deleteObj(e){const{featureId:t,data:{subIndex:s,model:i,index:o}}=e,n=this.$optimus.objects.findIndex(e=>e.featureId===t);-1!==n&&(this.$optimus.objects.splice(n,1),(this.curSelected===Object(a["isUndefined"])(s)?`${i}_${o}`:`${i}_${o}_${s}`)&&(this.curSelected=""))},fetchSearchEnhanceApi(e){this.fetchStatusMap[e]="loading",this.$optimus.formData[e]=[{role:"user",content:"model"===e?this.userPrompt:this.rewriteInput}],Y["a"].searchEnhanceApi({query:"model"===e?this.userPrompt:this.rewriteInput,search_type:Number(this.searchType)}).then(t=>{this.fetchStatusMap[e]="success",console.log(t),this.$optimus.formData[e].push({role:"assistant",content:"",debug:t||[]}),this.addDefaultObject({model:e,index:1,toolType:"chat/answer"}),t.forEach((t,s)=>{this.addDefaultObject({model:e,index:1,subIndex:s,toolType:"chat/sub_answer"})})}).catch(t=>{this.fetchStatusMap[e]="rejected",this.$Message.error(t.message),this.$optimus.formData[e].push({role:"assistant",content:"请求出错"})})},validate(){if(!this.$optimus.formData.isNotRewrite){if(!this.rewriteInput.trim())return{isValid:!1,msg:"指令改写必填"};if(this.$optimus.formData.modelRewrite.length<2)return{isValid:!1,msg:"搜索结果未标注"}}return{isValid:!0,msg:""}}}},yj=vj,wj=(s("f618"),Object(S["a"])(yj,bj,fj,!1,null,"29ee5326",null)),xj=wj.exports,Cj={label:"AI搜索Query召回标注模板",name:"z-ai-query-recall-stage",repeatable:!0,toolReadonly:!0,attributes:[{name:"historyChatKey",label:"历史对话（数组元素，需包含role、content字段）",type:String,value:"",vType:["array","string"]},{name:"userPromptKey",label:"用户指令",type:String,value:""},{name:"searchTypeKey",label:"搜索类型（search_type）",type:String,value:""}],tools:[{type:"chat/question",label:"问题标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_"+(new Date).getTime()}}]},{type:"chat/answer",label:"答案标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer"+(new Date).getTime()}}]},{type:"chat/sub_answer",label:"答案元素标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/sub_answer"+(new Date).getTime()}}]},{type:"chat/question_round",label:"问题轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_round_"+(new Date).getTime()}}]},{type:"chat/answer_round",label:"答案轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer_round"+(new Date).getTime()}}]}],defaultTools:[{type:"chat/question",label:"用户指令标注",name:"chat/question_user_prompt",color:"#4399ED"},{type:"chat/question",label:"指令改写标注",name:"chat/question_prompt_rewrite",color:"#FF9900"},{type:"chat/answer",label:"搜索结果标注",name:"chat/answer_1715152314813",color:"#999999"},{type:"chat/sub_answer",label:"单条文章标注",name:"chat/sub_answer_1715152255523",color:"#EA1A1A"}],hiddenItems:[{component:"z-switch",attributes:{label:"是否无需改写",name:"isNotRewrite",type:Boolean,hidden:!0,required:!0}},{component:"model",attributes:{label:"改写前对话内容",name:"model",type:Array,hidden:!0,required:!0}},{component:"modelRewrite",attributes:{label:"改写后对话内容",name:"modelRewrite",type:Array,hidden:!0,required:!0}}]},jj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},e._l(this.$optimus.objects,(function(t){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.activeItem===t.featureId},attrs:{slot:"content",id:t.featureId,type:"flex",justify:"space-between",wrap:!1},nativeOn:{click:function(s){return e.selectObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("div",{staticClass:"color",style:{backgroundColor:e.getTool(t.name).color}}),s("div",{staticClass:"feature-title"},[e._v(e._s(t.label)+e._s("chat/answer"===t.type?"-"+t.data.model:"")+e._s("chat/sub_answer"===t.type?"-"+t.data.model+"-"+t.data.subIndex:""))])]),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t"),disabled:!e.$optimus.debug}},[s("Button",{attrs:{icon:"ios-information-circle-outline",disabled:!e.$optimus.debug},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.selectObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)],1)})),1)])},Oj=[],kj={mixins:[Re["a"]],props:{},data(){return{activeItem:""}},methods:{removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})},selectActiveObject(e){var t;this.activeItem=e,null===(t=document.getElementById(this.activeItem))||void 0===t||t.scrollIntoViewIfNeeded()},selectObject(e){this.selectActiveObject(e.featureId),this.$emit("select-object",e)},getTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:e})}}},Aj=kj,Sj=(s("7c9b"),Object(S["a"])(Aj,jj,Oj,!1,null,"294c6991",null)),_j=Sj.exports,Ij={metadata:Cj,components:{Annotation:xj,BaseLayout:Lp,Objects:_j},mixins:[Re["a"]],inheritAttrs:!1,props:{},methods:{selectMsg(e){this.$nextTick(()=>{this.$refs.objectsRef.selectActiveObject(e)})},selectObject(e){this.$refs.annotationRef.selectMsg(e)},deleteObject(e){this.$refs.annotationRef.deleteObj(e)}}},$j=Ij,Mj=Object(S["a"])($j,mj,gj,!1,null,null,null),Tj=Mj.exports,Ej=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return["single"===e.type?s("AiMultipleModalChat",{ref:"AiMultipleModalChatRef",attrs:{type:e.type,model:e.model,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-msg":e.selectMsg}}):s("div",{staticClass:"chat-list"},e._l(e.modelList,(function(t){return s("AiChat",{attrs:{model:t,question:e.question,round:e.roundNum,"model-num":e.modelList.length}})})),1)]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0},{key:"objects",fn:function(){return[s("AiMultipleChatObjects",{ref:"AiMultipleChatObjectsRef",attrs:{model:e.model,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-object":e.selectObject,"delete-object":e.deleteObject}})]},proxy:!0}],null,!0)})},Lj=[],Dj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-box"},[s("div",{staticClass:"bar"},[s("span",{staticClass:"title"},[e._v(e._s(e.model))]),e.round>0?[s("span",[e._v("（问答轮次：")]),s("span",{staticClass:"number"},[e._v(e._s(Math.floor(e.messages.length/2))+" / "+e._s(e.round))]),s("span",[e._v(" ）")])]:e._e()],2),s("div",{ref:"message",staticClass:"message-box"},[e._l(e.messages,(function(t){return s("div",{staticClass:"message-item"},[s("modelMessage",{attrs:{message:Object.assign({},t,{roleLabel:"assistant"===t.role?e.model:""}),defaultTextType:"assistant"===t.role?"MD":"text"}})],1)})),e.loading?s("div",{staticClass:"message-item"},[s("modelMessage",{attrs:{message:{role:"assistant"}},scopedSlots:e._u([{key:"content",fn:function(){return[s("Spin",[e._v("模型请求中...")])]},proxy:!0}],null,!1,2102164667)})],1):e._e()],2),s("div",{staticClass:"send-box"},[s("Input",{staticClass:"send-input",attrs:{type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:e.error?"请求错误，请重新提问":"请输入您的问题，shift+回车换行，回车发送",disabled:e.error},on:{"on-keydown":e.handleEnter},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),s("Button",{staticClass:"send-button",attrs:{type:"primary",loading:e.loading,disabled:e.disabled},on:{click:function(t){return e.sendMessage(!1)}}},[e._v(e._s(e.error?"重新":"")+"发送")])],1)])},Pj=[],Bj={components:{ModelContent:Zx,modelMessage:sC},mixins:[Re["a"]],props:{model:{type:String,required:!0},question:String,round:Number,modelNum:Number,isFree:{type:Boolean,default:!1}},data(){return{input:"",loading:!1,messages:[],error:!1}},computed:{disabled(){return this.round>0&&this.messages.length===2*this.round}},watch:{messages(){this.$optimus.formData[this.model]=this.messages}},mounted(){this.isFree||(this.$optimus.formData[this.model]?this.messages=this.$optimus.formData[this.model]:(this.$set(this.$optimus.formData,this.model,[]),this.sendMessage(!0)),this.$optimus.$on("optimus:forms-stage:check",()=>{const{isValid:e,msg:t}=this.validate();this.$optimus.$emit("optimus:optimus-engine:check",e,t)}))},methods:{validate(){return this.round>0&&this.messages.length<2*this.round?{isValid:!1,msg:this.model+"：问答轮次未达到指定轮次。"}:{isValid:!0,msg:""}},handleEnter(e){const{shiftKey:t,key:s}=e;t&&"Enter"===s||"Enter"===s&&(e.preventDefault(),this.sendMessage(!1))},moveToEnd(){this.$nextTick(()=>{const e=this.$refs.message;e.scrollTop=e.scrollHeight})},sendMessage(e=!1){this.error?this.fetchModelAnswer():this.loading?this.$Message.error("请等待回答"):this.disabled?this.$Message.error("问答轮次已结束"):!e&&!this.input||e&&!this.question?this.$Message.error("请输入内容"):(this.messages.push({role:"user",content:e?this.question:this.input}),this.moveToEnd(),this.input="",this.fetchModelAnswer())},async fetchModelAnswer(){const e={model_name:this.model,messages:this.messages};try{this.loading=!0;const t=await Y["a"].askGpt(e);return this.messages.push({role:"assistant",content:t.answer,debug:t.debug}),this.moveToEnd(),this.error=!1,t}catch(t){this.$Message.error(`${this.model}：${t.message}`),this.error=!0}finally{this.loading=!1}}}},Rj=Bj,zj=(s("9e66"),Object(S["a"])(Rj,Dj,Pj,!1,null,"4cd1c91a",null)),Nj=zj.exports,Fj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[e._m(0),s("div",{ref:"message",staticClass:"chat-box"},[e._l(e.messages,(function(t,i){return s("div",{key:t.content+"-"+i,staticClass:"chat-item",attrs:{id:"chat-"+(i+1)}},["user"===t.role?s("div",{staticClass:"chat-index"},[e._v("Q"+e._s(e.getIndex(i)))]):s("div",{staticClass:"chat-index"},[e._v("A"+e._s(e.getIndex(i-1)))]),s("div",{staticClass:"chat-message",class:{isSelect:e.selectedIndex===i+1},on:{click:function(t){return e.addObject(i)}}},[s("modelMessage",{attrs:{message:t,"url-map":e.fileSignMap},scopedSlots:e._u([{key:"optimus",fn:function(){return[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:i,expression:"index"}],ref:"form_"+i,refInFor:!0,staticClass:"optimus-engine",staticStyle:{"min-width":"300px"},attrs:{component:"user"===t.role?e.userComponentConfig:e.assistantComponentConfig,context:e.$optimus.context,answer:e.initAnswer[i+1],disabled:e.$optimus.disabled}})]},proxy:!0}],null,!0)})],1)])})),e.loading?s("div",{staticClass:"chat-item"},[s("div",{staticClass:"chat-index"},[e._v("A"+e._s(e.getIndex(e.messages.length-1)))]),s("div",{staticClass:"chat-message"},[s("modelMessage",{attrs:{message:{role:"assistant",roleLabel:e.model}},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"spin"},[s("Spin"),s("span",[e._v("模型请求中...")])],1)]},proxy:!0}],null,!1,58987445)})],1)]):e._e()],2),s("div",{staticClass:"send-box"},[s("Input",{staticClass:"send-input",attrs:{type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:"请输入您的问题，shift+回车换行，回车发送",disabled:e.loading||e.$optimus.disabled,autofocus:!0},on:{"on-keydown":e.handleEnter},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),s("div",{staticClass:"bottom"},[s("div",{staticClass:"file-list"},e._l(e.files,(function(t){return s("div",{key:t.attach_id.toString(),staticClass:"file-item"},[s("safeImage",{staticStyle:{width:"48px",height:"48px"},attrs:{src:e.fileSignMap[t.attach_path],fit:"contain"}}),s("Icon",{staticClass:"delete-icon",attrs:{type:"md-close-circle",size:"15",color:"#000c"},on:{click:function(s){return e.handleDeleteAttachments(t.attach_id)}}})],1)})),0),s("div",{staticClass:"operation"},[e.modelConfig[e.model].multimedias?s("Tooltip",{attrs:{content:"目前只支持图片上传",placement:"top"}},[s("Attachment",{attrs:{attachments:e.files,disabled:e.loading,objType:e.$optimus.objectType,objId:e.$optimus.objectId,attachScene:e.attachScene},on:{"update:attachments":function(t){e.files=t}}})],1):e._e(),s("Button",{staticClass:"send-button",attrs:{type:"primary",loading:e.loading,disabled:e.$optimus.disabled},on:{click:e.sendMessage}},[e._v("发送")])],1)])],1)])},Vj=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{padding:"10px 20px"}},[s("h2",[e._v("对话")]),s("div",[e._v("试试和我聊天吧～")])])}],qj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("t-upload",{staticClass:"center",attrs:{accept:e.accept,"before-upload":e.addFile,"show-upload-list":!1,multiple:e.multiple,disabled:e.isDisabled}},[s("div",["button"===e.labelMode?s("t-button",{attrs:{loading:e.loading,disabled:e.disabled}},[s("t-icon",{attrs:{slot:"icon",name:"upload"},slot:"icon"}),e._v(e._s(e.label))],1):s("t-row",{attrs:{align:"center"}},[e.loading?s("t-loading",{attrs:{size:"small"}}):e._e(),s("a",{attrs:{disabled:e.isDisabled}},[e._v(e._s(e.label))])],1)],1)])},Hj=[],Wj={props:{attachments:Array,disabled:Boolean,objId:String,objType:String,attachScene:String,label:{type:String,default:"文件上传"},multiple:{type:Boolean,default:!1},labelMode:{type:String,default:"button"},accept:{type:String,default:"image/*"},metadata:{type:Boolean,default:!1}},data(){return{files:[],loading:!1}},computed:{isDisabled(){return this.disabled||this.loading}},methods:{addFile(e){return e?(this.files.push(e.raw),this.loading=!0,this.debounce(this.files),!1):(this.$Message.error("文件不能为空"),!1)},debounce:Object(a["debounce"])((function(e){this.uploadFiles(e)}),500),async uploadFiles(e){try{const t=this,s=[];for(let i=0;i<e.length;i++){const a=e[i],o=await this.fetchAddUpload(a),{attach_id:n,bucket:r,region:l,prefix:c,scene:d}=o,u={id:n,type:"attachment",Bucket:r,Region:l,Key:`${c}/${this.objId}/${d}/${a.name}`,file:a,handleTaskReady(){t.$emit("handleTaskReady")},handleUploadSuccess(){Pn({attach_id:n,need_metadata:t.metadata||void 0,need_preview:!0}).then(e=>{s.push({...e,attach_id:n,filename:a.name})}).catch(e=>{console.log(e),t.$Message.error("文件上传出错，请重试")}).finally(()=>{s.length===e.length&&t.$emit("update:attachments",s),t.loading=!1})},handleUploadFail(){t.$Message.error("文件上传出错，请联系任务负责人解决"),t.loading=!1}};fu(u)}this.files=[]}catch(t){console.log(t),this.$Message.error("文件上传出错，请重试"),this.loading=!1}},fetchAddUpload(e){const{objId:t,objType:s,attachScene:i}=this,a={obj_type:s,obj_id:t,attach_scene:i,attach_name:e.name,attach_size:e.size};return Ln(a).then(e=>e.data[0]).catch(e=>{this.$Message.error("上传失败："+e.message)})}}},Uj=Wj,Qj=(s("b007"),Object(S["a"])(Uj,qj,Hj,!1,null,"95708c18",null)),Jj=Qj.exports,Gj={components:{safeImage:Bs,Attachment:Jj,modelMessage:sC},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{type:String,model:String},data(){var e;const{objects:t}=this.$optimus,s=Object(a["cloneDeep"])(t).reduce((e,t)=>Object.assign(e,{[t.data.index]:{tags:t.tags}}),{});return{cid:null!==(e=this.$optimus.formData[this.model+".cid"])&&void 0!==e?e:Object(n["j"])(8),initAnswer:s,objects:t,input:"",loading:!1,error:!1,files:[],messages:[],fileSignMap:{},USER_TOOL_NAME:"objects_object_user",ASSISTANT_TOOL_NAME:"objects_object_assistant",selectedIndex:null,attachScene:"label",modelConfig:{modelE:{multimedias:!0,cid:!0,prompt:!0},modelF:{messages:!0},modelG:{messages:!0},modelH:{messages:!0}}}},computed:{userComponentConfig(){return this.getComponentConfig(this.USER_TOOL_NAME)},assistantComponentConfig(){return this.getComponentConfig(this.ASSISTANT_TOOL_NAME)}},watch:{messages(){this.$optimus.formData[this.model]=this.messages},files(){this.files.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,"https://"+e.download_link)})}},mounted(){this.modelConfig[this.model].cid&&(this.$optimus.formData[this.model+".cid"]=this.cid),this.$optimus.formData[this.model]?this.messages=this.$optimus.formData[this.model].map(e=>({...e,roleLabel:"assistant"===e.role?this.model:"用户"})):this.$set(this.$optimus.formData,this.model,[]),this.messages.length>0&&this.fetchAttachments()},methods:{getComponentConfig(e){const t=this.$optimus.renderedComponentConfig.$object_items.filter(t=>{const{attributes:{reference:s}}=t;return"all"===s||s===e});return{component:"z-form-stage",items:t}},getIndex(e){const t=this.messages.slice(0,e);return t.filter(e=>"user"===e.role).length+1},isHasDefaultValue(e){return this.getComponentConfig(e).items.some(e=>{const{value:t}=e.attributes;return!Object(a["isNil"])(t)&&0!==t.length})},getCurTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:e})},addObject(e){this.selectedIndex=e+1;const{role:t,content:s,multimedias:i,extData:o}=this.messages[e],r="objects_object_"+t;if(0===this.getComponentConfig(r).items.length)return;const l=Object(a["find"])(this.objects,t=>t.data.index===e+1);if(l)return void this.$emit("select-msg",l.featureId);const{type:c,label:d}=this.getCurTool(r),u="feature-"+Object(n["j"])(8);this.objects.push({type:c,data:{index:e+1,role:t,output:[{name:"assistant"===t?this.model:"user",content:s,extData:o,multimedias:i}]},tags:this.$refs["form_"+e][0].tags,featureId:u,name:r,label:d,extData:{}}),this.$emit("select-msg",u)},updateObjTags(e){const t=Object(a["findIndex"])(this.objects,t=>{const{data:{index:s}}=t;return s===e+1});-1!==t&&(this.objects[t].tags=this.$refs["form_"+e][0].tags)},handleEnter(e){if(this.$optimus.disabled)return;const{shiftKey:t,key:s}=e;t&&"Enter"===s||"Enter"===s&&(e.preventDefault(),this.sendMessage())},sendMessage(){this.loading?this.$Message.error("请等待回答"):this.input?(this.messages.push({role:"user",content:this.input,multimedias:this.files.map(e=>({type:"image",url:e.attach_path}))}),this.isHasDefaultValue(this.USER_TOOL_NAME)&&this.$nextTick(()=>{this.addObject(this.messages.length-1)}),this.moveToEnd(),this.fetchModelAnswer()):this.$Message.error("请输入问题开始对话")},async fetchModelAnswer(){const e={cid:this.cid,multimedias:this.files.map(e=>({type:"image",url:this.fileSignMap[e.attach_path]})),prompt:this.input,messages:this.messages.map(e=>({role:e.role,content:e.content}))};Object.keys(e).forEach(t=>{this.modelConfig[this.model][t]||delete e[t]}),e.model_name=this.model;try{this.input="",this.files=[],this.loading=!0;const t=await Y["a"].askGpt(e);return this.messages.push({role:"assistant",content:t.answer,extData:{traceId:t["hy-traceid"]},debug:t.debug,multimedias:t.multimedias||[]}),this.isHasDefaultValue(this.USER_TOOL_NAME)&&this.$nextTick(()=>{this.addObject(this.messages.length-1)}),this.moveToEnd(),this.error=!1,t}catch(t){this.$Message.error(`${this.model}：${t.message}`),this.error=!0}finally{this.loading=!1}},moveToEnd(){this.$nextTick(()=>{const e=this.$refs.message;e.scrollTop=e.scrollHeight})},handleDeleteAttachments(e){const t={attach_id:e};return zn(t).then(()=>{this.files=[]}).catch(e=>{console.log(e),this.$Message.error("删除失败："+e.message)})},selectMsg(e){this.selectedIndex=e.data.index,document.getElementById("chat-"+this.selectedIndex).scrollIntoViewIfNeeded()},deleteObj(e){const{featureId:t,data:{index:s}}=e,i=this.objects.findIndex(e=>e.featureId===t);-1!==i&&(this.objects.splice(i,1),this.selectedIndex===s&&(this.selectedIndex=null))}},asyncMethods:{fetchAttachments(){const{objectId:e,objectType:t}=this.$optimus,s={obj_type:t,obj_id:e,attach_scene:this.attachScene};return Bn(s).then(e=>{e.data.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,"https://"+e.download_link)})})}}},Kj=Gj,Yj=(s("ac2c"),Object(S["a"])(Kj,Fj,Vj,!1,null,"5c752112",null)),Zj=Yj.exports,Xj=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},e._l(e.myObjects,(function(t){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.activeItem===t.featureId},attrs:{slot:"content",id:t.featureId,type:"flex",justify:"space-between",wrap:!1},nativeOn:{click:function(s){return e.editObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("div",{staticClass:"color",style:{backgroundColor:e.getTool(t.data.role).color}}),s("div",{staticClass:"feature-title"},[e._v(e._s(e.getObjectLabel(t)))])]),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.editObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)],1)})),1)])},eO=[],tO={mixins:[Re["a"]],props:{model:String},data(){return{objects:this.$optimus.objects,activeItem:""}},computed:{myObjects(){return Object(a["sortBy"])(this.objects,e=>e.data.index)},messages(){return this.$optimus.formData[this.model]}},mounted(){this.$optimus.getObjectLabel=this.getObjectLabel},methods:{getObjectLabel(e){const t="user"===e.data.role?"Q"+this.getIndex(e.data.index):"A"+this.getIndex(e.data.index-1);return`${t}-${e.data.role}`},getIndex(e){const t=this.messages.slice(0,e-1);return t.filter(e=>"user"===e.role).length+1},editObject(e){this.selectObject(e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})},selectActiveObject(e){var t;this.activeItem=e,null===(t=document.getElementById(this.activeItem))||void 0===t||t.scrollIntoViewIfNeeded()},selectObject(e){this.selectActiveObject(e.featureId),this.$emit("select-object",e)},getTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:"objects_object_"+e})}}},sO=tO,iO=(s("5c1e"),Object(S["a"])(sO,Xj,eO,!1,null,"2dcf9660",null)),aO=iO.exports,oO={components:{BaseLayout:Lp,AiChat:Nj,AiMultipleModalChat:Zj,AiMultipleChatObjects:aO},mixins:[Re["a"]],inheritAttrs:!1,props:{type:String,modelList:Array,model:String,question:String,round:String},computed:{roundNum(){const e=parseFloat(this.round);return isNaN(e)?1:e}},mounted(){Object.keys(this.$optimus.formData).forEach(e=>{this.$optimus.formData[e]||delete this.$optimus.formData[e]})},methods:{selectMsg(e){this.$nextTick(()=>{this.$refs.AiMultipleChatObjectsRef.selectActiveObject(e)})},selectObject(e){this.$refs.AiMultipleModalChatRef.selectMsg(e)},deleteObject(e){this.$refs.AiMultipleModalChatRef.deleteObj(e)}}},nO=oO,rO=(s("8b52"),Object(S["a"])(nO,Ej,Lj,!1,null,"4051f042",null)),lO=rO.exports;const cO={icon:"ios-image-outline",toolReadonly:!0,attributes:[{name:"type",label:"标注类型",type:String,component:"z-single-select",attributes:{clearable:!1,basicMode:!0,exhibit:"dropdown",options:[{label:"单模型评测",value:"single"},{label:"多模型对比",value:"multiple"}]},value:"single"},{name:"question",label:"初始问题",value:"",type:String,attributes:{isVisible:"${output.type === 'multiple'}"}},{name:"round",label:"问答轮次",value:1,type:Number,attributes:{isVisible:"${output.type === 'multiple'}"}}],tools:[{type:"objects/object",label:"选择标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"objects_object_"+(new Date).getTime()}}]}],defaultTools:[{type:"objects/object",label:"用户",name:"objects_object_user",color:"#4399ED"},{type:"objects/object",label:"模型",name:"objects_object_assistant",color:"#999999"}],hiddenItems:[{component:"modelA",attributes:{label:"modelA",name:"modelA",type:Array,hidden:!0,required:!0}},{component:"modelB",attributes:{label:"modelB",name:"modelB",type:Array,hidden:!0,required:!0}},{component:"modelC",attributes:{label:"modelC",name:"modelC",type:Array,hidden:!0,required:!0}},{component:"modelE",attributes:{label:"modelE",name:"modelE",type:Array,hidden:!0,required:!0}},{component:"modelE.cid",attributes:{label:"modelE.cid",name:"modelE.cid",type:Array,hidden:!0,required:!0}},{component:"modelF",attributes:{label:"modelF",name:"modelF",type:Array,hidden:!0,required:!0}}]},dO=Object(a["cloneDeep"])(cO);dO.name="z-ai-model-stage",dO.label="大模型问答标注工具(modelA/B/C/E)",dO.attributes=[...dO.attributes,{name:"model",label:"选择模型",type:String,component:"z-single-select",attributes:{isVisible:"${output.type === 'single'}",clearable:!1,basicMode:!0,exhibit:"dropdown",options:[{label:"modelE(hunyuan-text-image)",value:"modelE"}]},value:"modelE"},{name:"modelList",label:"模型配置",value:["modelA","modelB","modelC"],type:Array,component:"z-multiple-select",attributes:{isVisible:"${output.type === 'multiple'}",options:[{label:"modelA(ERNIE-Bot-4)",value:"modelA"},{label:"modelB(hunyuan)",value:"modelB"},{label:"modelC(hunyuanapipre)",value:"modelC"}]}}];const uO=Object(a["cloneDeep"])(cO);uO.name="z-ai-model-stage-2",uO.label="大模型问答标注工具(modelF/G/H)",uO.attributes=[...uO.attributes,{name:"model",label:"选择模型",type:String,component:"z-single-select",attributes:{isVisible:"${output.type === 'single'}",clearable:!1,basicMode:!0,exhibit:"dropdown",options:[{label:"modelF(search-enhance-sbs)",value:"modelF"},{label:"modelG(search-enhance-sbs2)",value:"modelG"},{label:"modelH(search-enhance-sbs-pro)",value:"modelH"}]},value:"modelF"},{name:"modelList",label:"模型配置",value:["modelF","modelG","modelH"],type:Array,component:"z-multiple-select",attributes:{isVisible:"${output.type === 'multiple'}",options:[{label:"modelF(search-enhance-sbs)",value:"modelF"},{label:"modelG(search-enhance-sbs2)",value:"modelG"},{label:"modelH(search-enhance-sbs-pro)",value:"modelH"}]}}];const hO={...lO,metadata:dO},pO={...lO,metadata:uO};var mO=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(){return[s("AiAgentChat",{ref:"AiAgentChatRef",attrs:{agentID:e.agentID,question:e.question,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-msg":e.selectMsg}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0},{key:"objects",fn:function(){},proxy:!0}],null,!0)})},gO=[],bO=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{ref:"message",staticClass:"chat-box"},[s("div",{staticClass:"tools-exp"},[s("t-card",{attrs:{bordered:!0,size:"small",title:"tools示例:","header-bordered":!0}},[s("editor",{attrs:{lang:"json",theme:"chrome",width:"100%",height:"200"},on:{init:e.editorInit}})],1)],1),e.messages[0]?s("div",{staticClass:"chat-item",attrs:{id:"chat-0"}},[s("div",{staticClass:"chat-index"},[e._v("Q1")]),s("div",{staticClass:"chat-message"},[s("modelMessage",{attrs:{message:e.messages[0]},scopedSlots:e._u([{key:"operation",fn:function(){return[0!==e.stepsLength||e.loading?e._e():s("t-button",{attrs:{theme:"primary",loading:e.loading,size:"small",disabled:e.isDisabled},on:{click:function(t){return e.sendMessage()}}},[e._v("重试")])]},proxy:!0}],null,!1,2812313491)})],1)]):e._e(),e._l(e.steps||[],(function(t,i){return s("div",{key:""+i,staticClass:"chat-item",attrs:{id:"step-"+(i+1)}},[s("div",{staticClass:"chat-index"},[e._v("T"+e._s(i+1))]),s("div",{staticClass:"chat-message"},[s("modelMessage",{attrs:{message:Object.assign({},t,{role:"tool",roleLabel:i+1+" / "+e.toolLimit}),wordCount:{enabled:!1},toggleEnabled:!1,copyEnabled:!1},scopedSlots:e._u([e.messages[1]||i!==e.stepsLength-1||e.loading?null:{key:"operation",fn:function(){return[s("t-button",{attrs:{theme:"danger",size:"small",disabled:e.isDisabled},on:{click:function(t){return e.deleteStep(i)}}},[e._v("删除")])]},proxy:!0},{key:"content",fn:function(){return[s("div",{staticClass:"step-thought"},[e.editable(i)&&!e.loading?[s("div",{staticClass:"title"},[e._v("思考过程：")]),s("t-textarea",{attrs:{autosize:{minRows:5,maxRows:15}},model:{value:e.steps[i].thought,callback:function(t){e.$set(e.steps[i],"thought",t)},expression:"steps[index].thought"}})]:s("modelMessage",{attrs:{message:{content:t.thought||"",roleLabel:"思考过程："},icon:!1}}),s("t-divider")],2),s("div",{staticClass:"step-action"},[e.editable(i)&&!e.loading?[s("div",{staticClass:"title"},[e._v("action参数：")]),e.editable(i)?s("editor",{attrs:{lang:"json",theme:"chrome",width:"100%",height:"200"},on:{init:function(s){return e.editorInitAction(s,t.action)}},model:{value:e.steps[i].action,callback:function(t){e.$set(e.steps[i],"action",t)},expression:"steps[index].action"}}):e._e()]:s("modelMessage",{attrs:{message:{content:t.action||"",roleLabel:"action参数："},icon:!1}}),s("t-divider")],2),t.observation?s("div",{staticClass:"step-observation"},[s("modelMessage",{attrs:{message:{content:e.formatObservation(t.observation||""),roleLabel:"observation："},icon:!1}}),s("t-divider")],1):e._e(),e.editable(i)?s("div",{staticClass:"step-operate"},[s("t-space",[s("t-button",{attrs:{theme:"primary",loading:e.loading,disabled:e.isDisabled},on:{click:function(t){return e.sendMessage()}}},[e._v("请求执行")]),e.steps.length<e.toolLimit&&!e.loading?s("t-button",{attrs:{theme:"success",disabled:e.isDisabled},on:{click:function(t){return e.checkAction(e.steps[i].action)}}},[e._v("参数校验")]):e._e(),e.tmpAnswer.content?s("t-button",{attrs:{theme:"success",disabled:e.isDisabled},on:{click:function(t){return e.finishMessage()}}},[e._v("确认结束")]):e._e()],1)],1):e._e()]},proxy:!0}],null,!0)})],1)])})),e.messages[1]?s("div",{staticClass:"chat-item",attrs:{id:"chat-1"}},[s("div",{staticClass:"chat-index"},[e._v("A1")]),s("div",{staticClass:"chat-message"},[s("modelMessage",{attrs:{message:e.messages[1]},scopedSlots:e._u([{key:"operation",fn:function(){return[s("t-button",{attrs:{theme:"primary",loading:e.loading,size:"small",disabled:e.isDisabled},on:{click:function(t){e.answerEditing=!e.answerEditing}}},[e._v(e._s(e.answerEditing?"保存":"编辑"))]),s("t-button",{attrs:{theme:"danger",loading:e.loading,size:"small",disabled:e.isDisabled},on:{click:e.deleteAnswer}},[e._v("删除")])]},proxy:!0},e.answerEditing?{key:"content",fn:function(){return[s("t-textarea",{attrs:{autosize:{minRows:10,maxRows:25}},model:{value:e.messages[1].content,callback:function(t){e.$set(e.messages[1],"content",t)},expression:"messages[1].content"}})]},proxy:!0}:null],null,!0)})],1)]):e._e(),e.loading?s("div",{staticClass:"chat-item"},[s("div",{staticClass:"chat-index"},[e._v("T"+e._s(e.steps.length+1))]),s("div",{staticClass:"chat-message"},[s("modelMessage",{attrs:{message:{role:"tool",roleLabel:e.steps.length+1+" / "+e.toolLimit}},scopedSlots:e._u([{key:"content",fn:function(){return[s("div",{staticClass:"spin"},[s("Spin"),s("span",[e._v("agent请求中...")])],1)]},proxy:!0}],null,!1,1019143462)})],1)]):e._e()],2)])},fO=[],vO={components:{safeImage:Bs,Attachment:Jj,modelMessage:sC,editor:s("0d75")},mixins:[Re["a"]],props:{agentID:String,question:String},data(){const{objects:e}=this.$optimus;return{objects:e,input:"",loading:!1,error:!1,toolsEditor:null,messages:[],steps:[],USER_TOOL_NAME:"objects_object_user",ASSISTANT_TOOL_NAME:"objects_object_assistant",selectedIndex:null,tmpAnswer:{},answerEditing:!1}},computed:{isDisabled(){return this.$optimus.disabled},toolLimit(){return 10},userComponentConfig(){return this.getComponentConfig(this.USER_TOOL_NAME)},stepsLength(){var e;return(null===(e=this.steps)||void 0===e?void 0:e.length)||0},editable(){return e=>!this.messages[1]&&e===this.stepsLength-1}},watch:{tmpAnswer(){this.$optimus.formData[this.agentID]&&(this.$optimus.formData[this.agentID].tmpAnswer=this.tmpAnswer)},messages(){this.$optimus.formData[this.agentID]&&(this.$optimus.formData[this.agentID].messages=this.messages)},steps(){this.$optimus.formData[this.agentID]&&(this.$optimus.formData[this.agentID].steps=this.steps)}},mounted(){var e,t,s;(this.$message.closeAll(),this.agentID)?this.question?(this.getAgentTools(),this.$optimus.formData[this.agentID]?(this.messages=(null===(e=this.$optimus.formData[this.agentID])||void 0===e?void 0:e.messages)||[],this.steps=(null===(t=this.$optimus.formData[this.agentID])||void 0===t?void 0:t.steps)||[],this.tmpAnswer=(null===(s=this.$optimus.formData[this.agentID])||void 0===s?void 0:s.tmpAnswer)||{}):(this.$set(this.$optimus.formData,this.agentID,{messages:[],steps:[],tmpAnswer:{}}),this.messages.push({role:"user",content:this.question}),this.sendMessage())):this.$message.error("初始问题不能为空"):this.$message.error("agentID不能为空")},methods:{tryParseJSON(e){if("string"!==typeof e)return e;const t=e.trim();if(!t.startsWith("{")&&!t.startsWith("["))return t;try{return JSON.parse(t)}catch(s){return t}},deepParse(e){if(Array.isArray(e))return e.map(this.deepParse);if("object"===typeof e&&null!==e){const t={};for(const s in e){const i=e[s],a=this.tryParseJSON(i);t[s]=a!==i?this.deepParse(a):i}return t}return e},formatObservation(e){let t;try{t=JSON.stringify(this.deepParse(JSON.parse(e)),null,2)}catch(s){t=e}return t},async getAgentTools(){const e=await Y["a"].getAgentTools({agent_id:this.agentID}).catch(e=>{this.$message.error(e||"请求Agent失败")});if(0===(null===e||void 0===e?void 0:e.code)){var t,s,i;const a=(null===(t=e.data)||void 0===t?void 0:t.tools)||[];null===(s=this.toolsEditor)||void 0===s||s.setValue(JSON.stringify(a,null,2)),null===(i=this.toolsEditor)||void 0===i||i.gotoLine(1)}else await this.$message.error(`${this.agentID}：${e.message}`)},getComponentConfig(e){const t=this.$optimus.renderedComponentConfig.$object_items.filter(t=>{const{attributes:{reference:s}}=t;return"all"===s||s===e});return{component:"z-form-stage",items:t}},editorInit(e){s("b8eb"),s("babf"),s("06da"),null===e||void 0===e||e.setOptions({fontSize:"12px",readOnly:!0}),this.toolsEditor=e},editorInitAction(e,t){s("b8eb"),s("babf"),s("06da"),null===e||void 0===e||e.setOptions({fontSize:"12px"}),null===e||void 0===e||e.setOption("wrap","free"),this.$nextTick(()=>{t&&(null===e||void 0===e||e.setValue(t),null===e||void 0===e||e.gotoLine(1))})},getCurTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:e})},addObject(e){console.log("index",e)},checkAction(e,t=!0){let s=!0;try{JSON.parse(e)}catch(i){s=!1}return s?t&&this.$message.success("校验通过"):this.$message.error("action参数json格式错误，请检查"),s},deleteStep(e){this.steps.splice(e,1),this.tmpAnswer={}},deleteAnswer(){this.messages=[{role:"user",content:this.question}]},sendMessage(){if(this.loading)return void this.$message.error("请等待agent回答");const{action:e}=this.steps[this.steps.length-1]||{};if(this.steps.length<this.toolLimit){if(this.steps.length){const t=this.checkAction(e,!1);if(!t)return}this.fetchAgentAnswer()}else this.$message.error("调用次数已满，请确认结束或者删除本轮再提交")},async fetchAgentAnswer(){const e={agent_id:this.agentID,messages:this.messages||[],steps:this.steps.map(e=>({...e,observation:e.observation?JSON.parse(e.observation):e.observation,action:e.action?JSON.parse(e.action):e.action}))||[]};try{this.loading=!0,this.moveToEnd(),this.tmpAnswer={};const i=await Y["a"].askGgentChat(e);if(0===(null===i||void 0===i?void 0:i.code)){var t,s;const e=(null===i||void 0===i?void 0:i.data)||{};this.steps=(null===(t=e.steps)||void 0===t?void 0:t.map(e=>({...e,observation:e.observation?JSON.stringify(e.observation,null,2):e.observation,action:e.action?JSON.stringify(e.action,null,2):e.action})))||[],null!==(s=e.message)&&void 0!==s&&s.content&&(this.tmpAnswer=e.message),this.moveToEnd(),this.error=!1}else await this.$message.error(`${this.agentID}：${i.message}`)}catch(i){await this.$message.error(`${this.agentID}：${i||"请求Agent失败"}`),this.error=!0}finally{this.loading=!1}},finishMessage(){this.messages.push(this.tmpAnswer),this.tmpAnswer={}},moveToEnd(){this.$nextTick(()=>{const e=this.$refs.message;e&&(e.scrollTop=e.scrollHeight)})},selectMsg(e){this.selectedIndex=e.data.index,document.getElementById("chat-"+this.selectedIndex).scrollIntoViewIfNeeded()},deleteObj(e){console.log("object",e)}}},yO=vO,wO=(s("d4e0"),Object(S["a"])(yO,bO,fO,!1,null,"4689b797",null)),xO=wO.exports,CO={components:{BaseLayout:Lp,AiAgentChat:xO},mixins:[Re["a"]],inheritAttrs:!1,props:{agentID:String,question:String},computed:{},mounted(){Object.keys(this.$optimus.formData).forEach(e=>{this.$optimus.formData[e]||delete this.$optimus.formData[e]})},methods:{selectMsg(e){this.$nextTick(()=>{var t;null===(t=this.$refs.AiAgentChatObjectsRef)||void 0===t||t.selectActiveObject(e)})}}},jO=CO,OO=Object(S["a"])(jO,mO,gO,!1,null,"53a21ba3",null),kO=OO.exports;const AO={icon:"ios-image-outline",toolReadonly:!0,attributes:[{name:"agentID",label:"agentID",value:"",type:String,attributes:{required:!0}},{name:"question",label:"初始问题",value:"",type:String,attributes:{required:!0}}],tools:[{type:"objects/object",label:"选择标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"objects_object_"+(new Date).getTime()}}]}],defaultTools:[],hiddenItems:[]},SO=Object(a["cloneDeep"])(AO);SO.name="z-ai-agent-stage",SO.label="通用Agent SFT数据标注",SO.attributes=[...SO.attributes];const _O={...kO,metadata:SO};var IO=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0},scopedSlots:e._u([{key:"component",fn:function(t){var i=t.wordCount;return[s("AiChat",{ref:"AiChatRef",attrs:{$renderedComponentConfig:e.$renderedComponentConfig,modelList:e.modelList,question:e.question,round:e.roundNum,wordCount:i},on:{"select-msg":e.selectMsg}})]}},{key:"global",fn:function(){return[e._t("default")]},proxy:!0},{key:"objects",fn:function(){return[s("AiChatObjects",{ref:"AiChatObjectsRef",attrs:{$renderedComponentConfig:e.$renderedComponentConfig,modelList:e.modelList},on:{"select-object":e.selectObject,"delete-object":e.deleteObject}})]},proxy:!0}],null,!0)})},$O=[],MO=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",[s("h2",[e._v("对话")]),e.round>0?s("div",[s("span",[e._v("问答轮次：")]),s("span",{staticClass:"number"},[e._v(e._s(Math.floor(e.maxLengthModelMessage.length/2))+" / "+e._s(e.round))])]):s("div",[e._v("试试和我聊天吧～")])]),s("div",{ref:"message",staticClass:"chat-box"},e._l(e.maxLengthModelMessage,(function(t,i){return s("div",{key:"model-"+i,staticClass:"chat-item"},[s("div",{staticClass:"chat-index"},[e._v(e._s(e.roleConfig[t.role].name)+e._s("user"===t.role?e.getIndex(i):e.getIndex(i-1)))]),s("div",{staticClass:"chat-message",class:{isSelect:e.curSelected===""+i},attrs:{id:"chat_"+i},on:{click:function(s){return e.addObject(i,e.roleConfig[t.role].toolType)}}},[s("modelMessage",{attrs:{message:t,"url-map":e.fileSignMap,"operation-enabled":"assistant"!==t.role},scopedSlots:e._u(["assistant"===t.role?{key:"content",fn:function(){return[s("div",{staticClass:"answer-list"},e._l(e.modelList,(function(t){return s("div",{staticClass:"answer-item",class:{isSelect:e.curSelected===i+"_"+t},attrs:{id:"chat_"+i+"_"+t},on:{click:function(s){return s.stopPropagation(),e.addObject(i,"chat/answer",t)}}},["loading"===e.requestStatusMap[t]&&i===e.maxLengthModelMessage.length-1?s("div",{staticClass:"spin"},[s("Spin"),s("span",[e._v("模型请求中...")])],1):s("modelMessage",{attrs:{message:e.getModelContent(i,t),"url-map":e.fileSignMap,defaultTextType:"MD"},scopedSlots:e._u([{key:"title",fn:function(){return[s("b",[e._v(e._s(t))])]},proxy:!0},{key:"divider",fn:function(){return[s("Divider",{staticClass:"divider"})]},proxy:!0},e.answerComponentConfig.items.length?{key:"optimus",fn:function(){return[s("Divider",{staticClass:"divider"}),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{index:i,model:t},expression:"{ index, model }"}],ref:"form_chat_"+i+"_"+t,refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.answerComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled,answer:e.initAnswer[i+"_"+t]}})]},proxy:!0}:null],null,!0)})],1)})),0)]},proxy:!0}:null,{key:"optimus",fn:function(){return[s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:{index:i},expression:"{ index }"}],ref:"form_chat_"+i,refInFor:!0,staticClass:"optimus-engine",attrs:{component:"user"===t.role?e.questionRoundComponentConfig:e.answerRoundComponentConfig,context:e.$optimus.context,disabled:e.$optimus.disabled||e.formDisabled(i),answer:e.initAnswer[i]}})]},proxy:!0}],null,!0)})],1)])})),0),s("ChatInput",{attrs:{fileSignMap:e.fileSignMap,$optimus:e.$optimus,loading:e.isLoading,isDisabled:e.isDisabled,attachScene:e.attachScene,validate:e.submitValidate},on:{sendMessage:e.handleSendMessage}})],1)},TO=[],EO=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"send-box"},[s("Input",{staticClass:"send-input",attrs:{type:"textarea",autosize:{minRows:2,maxRows:3},placeholder:"请输入您的问题，shift+回车换行，回车发送",disabled:e.disabled,autofocus:!0},on:{"on-keydown":e.handleEnter,change:e.handleChangeInput},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}),s("div",{staticClass:"bottom"},[s("div",{staticClass:"file-list"},e._l(e.files,(function(t){return s("div",{key:t.attach_id.toString(),staticClass:"file-item"},[s("safeImage",{staticStyle:{width:"48px",height:"48px"},attrs:{src:e.fileSignMap[t.attach_path],fit:"contain"}}),s("Icon",{staticClass:"delete-icon",attrs:{type:"md-close-circle",size:"15",color:"#000c"},on:{click:function(s){return e.handleDeleteAttachments(t.attach_id)}}})],1)})),0),s("div",{staticClass:"operation"},[s("Tooltip",{attrs:{content:"目前只支持图片上传",placement:"top"}},[s("Attachment",{attrs:{attachments:e.files,disabled:e.disabled,objType:e.$optimus.objectType,objId:e.$optimus.objectId,attachScene:e.attachScene},on:{"update:attachments":function(t){e.files=t}}})],1),s("Button",{staticClass:"send-button",attrs:{type:"primary",loading:e.loading,disabled:e.disabled},on:{click:e.sendMessage}},[e._v("发送")])],1)])],1)},LO=[],DO={components:{Attachment:Jj,safeImage:Bs},props:{fileSignMap:Object,loading:Boolean,isDisabled:Boolean,$optimus:Object,attachScene:String,validate:Function},data(){return{inputValue:"",files:[]}},computed:{disabled(){return this.loading||this.$optimus.disabled||this.isDisabled}},watch:{files(){this.files.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,"https://"+e.download_link)})}},methods:{handleChangeInput(e){this.$emit("update:inputValue",e)},handleDeleteAttachments(e){const t={attach_id:e};return zn(t).then(()=>{this.files=[]}).catch(e=>{console.log(e),this.$Message.error("删除失败："+e.message)})},sendMessage(){if(this.loading)return void this.$Message.error("请等待回答");if(!this.inputValue)return void this.$Message.error("请输入问题开始对话");const{isValid:e,msg:t}=this.validate();e?(this.$emit("sendMessage",{inputValue:this.inputValue,files:this.files}),this.inputValue="",this.files=[]):this.$Message.error(t)},handleEnter(e){if(this.$optimus.disabled)return;const{shiftKey:t,key:s}=e;t&&"Enter"===s||"Enter"===s&&(e.preventDefault(),this.sendMessage())}}},PO=DO,BO=(s("e999"),Object(S["a"])(PO,EO,LO,!1,null,"56a5a6bc",null)),RO=BO.exports,zO={components:{ChatInput:RO,modelMessage:sC},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],props:{modelList:Array,question:String,round:Number},data(){const{objects:e}=this.$optimus,t=Object(a["cloneDeep"])(e).reduce((e,t)=>{const{data:s}=t,i=s.model?`${s.index}_${s.model}`:s.index;return Object.assign(e,{[i]:{tags:t.tags}})},{});return{cid:Object(n["j"])(8),objects:e,curSelected:"",initAnswer:t,fileSignMap:{},requestStatusMap:{},attachScene:"label",roleConfig:{user:{name:"Q",label:"用户",toolType:"chat/question_round"},assistant:{name:"A",label:"助手",toolType:"chat/answer_round"}},modelConfig:{modelA:{messages:!0},modelB:{messages:!0},modelC:{messages:!0},modelE:{multimedias:!0,cid:!0,prompt:!0},modelF:{messages:!0},modelG:{messages:!0},modelH:{messages:!0},modelJ:{session_id:!0,prompt:!0},modelK:{messages:!0}}}},computed:{maxLengthModelMessage(){const e=this.modelList.map(e=>({model:e,msgLength:this.$optimus.formData[e].length})),t=Object(a["maxBy"])(e,"msgLength");return 0===this.modelList.length?[]:this.$optimus.formData[t.model]},questionRoundComponentConfig(){return this.getComponentConfig("chat/question_round")},answerRoundComponentConfig(){return this.getComponentConfig("chat/answer_round")},answerComponentConfig(){return this.getComponentConfig("chat/answer")},isLoading(){return Object.keys(this.requestStatusMap).some(e=>"loading"===this.requestStatusMap[e])},isAllLoading(){return Object.keys(this.requestStatusMap).every(e=>"loading"===this.requestStatusMap[e])},isDisabled(){return this.round>0&&this.maxLengthModelMessage.length===2*this.round}},created(){this.modelList.forEach(e=>{this.modelConfig[e].cid&&(this.$optimus.formData[e+".cid"]=this.getCid(e)),this.$optimus.formData[e]||this.$set(this.$optimus.formData,e,[]),this.$set(this.requestStatusMap,e,"")}),Object(a["find"])(this.modelConfig,e=>e.multimedias)&&this.fetchAttachments()},mounted(){const e=this.modelList.every(e=>0===this.$optimus.formData[e].length);this.question&&e&&this.handleSendMessage({inputValue:this.question,files:[]}),this.$optimus.$on("optimus:forms-stage:check",()=>{const{isValid:e,msg:t}=this.validate();this.$optimus.$emit("optimus:optimus-engine:check",e,t)})},methods:{formDisabled(e){if(this.$refs["form_chat_"+e]){const t=this.$refs["form_chat_"+e][0].tags.find(e=>"message_new_content"===e.name);if(t)return this.maxLengthModelMessage.length-e>1}return!1},validate(){return this.round>0&&this.maxLengthModelMessage.length<2*this.round?(console.log("问答轮次未达到指定轮次。"),{isValid:!1,msg:"问答轮次未达到指定轮次。"}):{isValid:!0,msg:""}},submitValidate(){const e=this.$refs["form_chat_"+(this.maxLengthModelMessage.length-1)];if(null!==e&&void 0!==e&&e.length){const[t]=e;if(t.validate(),!t.isValid)return{isValid:!1,msg:"请检查表单"}}return{isValid:!0}},handleSendMessage({inputValue:e,files:t}){this.modelList.forEach(s=>{this.$optimus.formData[s].push({role:"user",content:e,multimedias:t.map(e=>({type:"image",url:e.attach_path}))})}),this.addDefaultObject(this.roleConfig.user.toolType),this.moveToEnd(),this.fetchModelAnswer({inputValue:e,files:t})},async fetchModelAnswer({inputValue:e,files:t}){this.modelList.forEach(s=>{const i={cid:this.getCid(s),multimedias:t.map(e=>({type:"image",url:this.fileSignMap[e.attach_path]})),prompt:e,messages:this.$optimus.formData[s].map(e=>({role:e.role,content:e.newContent||e.content})),session_id:this.$optimus.formData[s+".sessionId"]||""};Object.keys(i).forEach(e=>{this.modelConfig[s][e]||delete i[e]}),this.requestStatusMap[s]="loading",Y["a"].askGpt({...i,model_name:s}).then(e=>{this.requestStatusMap[s]="success",this.$optimus.formData[s].push({role:"assistant",content:e.answer,extData:{traceId:e["hy-traceid"]},debug:e.debug,multimedias:e.multimedias||[]}),e.session_id&&(this.$optimus.formData[s+".sessionId"]=e.session_id)}).catch(e=>{this.requestStatusMap[s]="error",console.log(e),this.$optimus.formData[s].push({role:"assistant",content:"请求出错："+e.message})}).finally(()=>{this.addDefaultObject("chat/answer",s),this.addDefaultObject(this.roleConfig.assistant.toolType),this.moveToEnd()})})},getCid(e){var t;return null!==(t=this.$optimus.formData[e+".cid"])&&void 0!==t?t:this.cid},getIndex(e){const t=this.maxLengthModelMessage.slice(0,e);return t.filter(e=>"user"===e.role).length+1},getModelContent(e,t){return this.$optimus.formData[t]?this.$optimus.formData[t][e]:""},getTags(e,t){return t?this.$refs[`form_chat_${e}_${t}`][0].tags:this.$refs["form_chat_"+e][0].tags},getComponentConfig(e){const{name:t}=this.getCurTool(e),s=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:s}}=e;return"all"===s||s===t});return{component:"z-form-stage",items:s}},updateObjTags(e){const t=Object(a["findIndex"])(this.objects,t=>{const{data:{index:s,model:i}}=t;return s===e.index&&(e.model?i===e.model:!i)});if(-1!==t){const s=this.getTags(e.index,e.model);this.objects[t].tags=s;const i=s.find(e=>"message_new_content"===e.name);if(i){const e=Object(a["isArray"])(a["find"].value)?i.value[0]:i.value;if(e){const{index:s}=this.objects[t].data,i=this.getModelContent(s,e).content||e;this.$refs["form_chat_"+s][0].formData.message_new_content=i,this.modelList.forEach(e=>{this.$optimus.formData[e][this.objects[t].data.index]&&(this.$optimus.formData[e][this.objects[t].data.index].newContent=i)})}}}},addObject(e,t,s){if(this.curSelected=s?`${e}_${s}`:""+e,0===this.getComponentConfig(t).items.length)return;const i=Object(a["find"])(this.objects,t=>t.data.index===e&&(s?t.data.model===s:!t.data.model));if(i)return void this.$emit("select-msg",i.featureId);const{type:o,label:r,name:l}=this.getCurTool(t),c="feature-"+Object(n["j"])(8);this.objects.push({type:o,data:{index:e,model:s},tags:this.getTags(e,s),featureId:c,name:l,label:r,extData:{}}),this.$emit("select-msg",c)},addDefaultObject(e,t){const s=this.getComponentConfig(e).items.some(e=>{const{value:t}=e.attributes;return!Object(a["isNil"])(t)&&0!==t.length});s&&this.$nextTick(()=>{this.addObject(this.maxLengthModelMessage.length-1,e,t)})},getCurTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{type:e})},selectMsg(e){const{data:{model:t,index:s}}=e;this.curSelected=t?`${s}_${t}`:""+s,document.getElementById("chat_"+this.curSelected).scrollIntoViewIfNeeded()},deleteObj(e){const{featureId:t,data:{model:s,index:i}}=e,a=this.objects.findIndex(e=>e.featureId===t);-1!==a&&(this.objects.splice(a,1),this.curSelected===(s?`${i}_${s}`:i)&&(this.curSelected=""))},moveToEnd(){this.$nextTick(()=>{const e=this.$refs.message;e.scrollTop=e.scrollHeight})}},asyncMethods:{fetchAttachments(){const{objectId:e,objectType:t}=this.$optimus,s={obj_type:t,obj_id:e,attach_scene:this.attachScene};return Bn(s).then(e=>{e.data.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,"https://"+e.download_link)})})}}},NO=zO,FO=(s("2e78"),Object(S["a"])(NO,MO,TO,!1,null,"233a5217",null)),VO=FO.exports,qO=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")])],1),s("div",{staticClass:"z-stage__objects"},e._l(e.myObjects,(function(t,i){return s("Row",{key:t.featureId,staticClass:"object-item",class:{activeObj:e.activeItem===t.featureId},attrs:{slot:"content",id:t.featureId,type:"flex",justify:"space-between",wrap:!1},nativeOn:{click:function(s){return e.selectObject(t)}},slot:"content"},[s("Col",{staticClass:"object-left",attrs:{flex:"auto"}},[s("div",{staticClass:"color",style:{backgroundColor:e.getTool(t.type).color}}),s("div",{staticClass:"feature-title"},[s("span",[e._v(e._s(e.getObjectLabel(t)))])])]),s("Col",{staticClass:"object-right"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.selectObject(t)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t)}}})],1)],1)})),1)])},HO=[],WO={mixins:[Re["a"]],props:{modelList:Array},data(){return{objects:this.$optimus.objects,activeItem:""}},computed:{myObjects(){return Object(a["sortBy"])(this.objects,e=>e.data.index)},messages(){const e=this.modelList.map(e=>({model:e,msgLength:this.$optimus.formData[e].length})),t=Object(a["maxBy"])(e,"msgLength");return 0===this.modelList.length?[]:this.$optimus.formData[t.model]}},mounted(){this.$optimus.getObjectLabel=this.getObjectLabel},methods:{getObjectLabel(e){const t="user"===this.messages[e.data.index].role?"Q"+this.getIndex(e.data.index):"A"+this.getIndex(e.data.index-1),{role:s}=this.messages[e.data.index];return e.data.model?`${t}-${s}-${e.data.model}`:`${t}-${s}`},getIndex(e){const t=this.messages.slice(0,e);return t.filter(e=>"user"===e.role).length+1},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e.featureId,onOk:()=>{this.$emit("delete-object",e)}})},selectActiveObject(e){var t;this.activeItem=e,null===(t=document.getElementById(this.activeItem))||void 0===t||t.scrollIntoViewIfNeeded()},selectObject(e){this.selectActiveObject(e.featureId),this.$emit("select-object",e)},getTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{type:e})}}},UO=WO,QO=(s("5f67"),Object(S["a"])(UO,qO,HO,!1,null,"b913dcb8",null)),JO=QO.exports,GO={components:{BaseLayout:Lp,AiChat:VO,AiChatObjects:JO},mixins:[Re["a"]],inheritAttrs:!1,props:{modelList:{type:Array,required:!0,default:()=>[]},question:String,round:[Number,String]},computed:{roundNum(){const e=parseFloat(this.round);return isNaN(e)?0:e}},mounted(){Object.keys(this.$optimus.formData).forEach(e=>{this.$optimus.formData[e]||delete this.$optimus.formData[e]})},methods:{selectMsg(e){this.$nextTick(()=>{this.$refs.AiChatObjectsRef.selectActiveObject(e)})},selectObject(e){this.$refs.AiChatRef.selectMsg(e)},deleteObject(e){this.$refs.AiChatRef.deleteObj(e)}}},KO=GO,YO=Object(S["a"])(KO,IO,$O,!1,null,null,null),ZO=YO.exports;const XO={icon:"ios-image-outline",toolReadonly:!0,attributes:[{name:"question",label:"初始问题",value:"",type:String},{name:"round",label:"问答轮次",value:"",type:Number}],tools:[{type:"chat/question",label:"问题标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_"+(new Date).getTime()}}]},{type:"chat/answer",label:"答案标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer"+(new Date).getTime()}}]},{type:"chat/question_round",label:"问题轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/question_round_"+(new Date).getTime()}}]},{type:"chat/answer_round",label:"答案轮次标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"chat/answer_round"+(new Date).getTime()}}]}],defaultTools:[{type:"chat/question_round",label:"问题整体标注",name:"chat/question_round_1715152234924",color:"#4399ED"},{type:"chat/answer_round",label:"答案整体标注",name:"chat/answer_round_1715152314813",color:"#999999"},{type:"chat/answer",label:"单个答案标注",name:"chat/answer_1715152255523",color:"#999999"}]},ek=Object(a["cloneDeep"])(XO);ek.name="z-ai-chat-stage",ek.label="大模型实时对话标注(modelA/B/C/E)",ek.hiddenItems=[{component:"modelA",attributes:{label:"modelA",name:"modelA",type:Array,hidden:!0,required:!0}},{component:"modelB",attributes:{label:"modelB",name:"modelB",type:Array,hidden:!0,required:!0}},{component:"modelC",attributes:{label:"modelC",name:"modelC",type:Array,hidden:!0,required:!0}},{component:"modelE",attributes:{label:"modelE",name:"modelE",type:Array,hidden:!0,required:!0}},{component:"modelE.cid",attributes:{label:"modelE.cid",name:"modelE.cid",type:Array,hidden:!0,required:!0}}],ek.attributes=[...ek.attributes,{name:"modelList",label:"模型配置",value:["modelA","modelB","modelC","modelE"],type:Array,component:"z-multiple-select",attributes:{options:[{label:"modelA(ERNIE-Bot-4)",value:"modelA"},{label:"modelB(hunyuan)",value:"modelB"},{label:"modelC(hunyuanapipre)",value:"modelC"},{label:"modelE(hunyuan-text-image)",value:"modelE"}]}}];const tk=Object(a["cloneDeep"])(XO);tk.name="z-ai-chat-stage-2",tk.label="大模型实时对话标注(modelF/G/H)",tk.hiddenItems=[{component:"modelF",attributes:{label:"modelF",name:"modelF",type:Array,hidden:!0,required:!0}},{component:"modelG",attributes:{label:"modelG",name:"modelG",type:Array,hidden:!0,required:!0}},{component:"modelH",attributes:{label:"modelH",name:"modelH",type:Array,hidden:!0,required:!0}}],tk.attributes=[...tk.attributes,{name:"modelList",label:"模型配置",value:["modelF","modelG","modelH"],type:Array,component:"z-multiple-select",attributes:{options:[{label:"modelF(search-enhance-sbs)",value:"modelF"},{label:"modelG(search-enhance-sbs2)",value:"modelG"},{label:"modelH(search-enhance-sbs-pro)",value:"modelH"}]}}];const sk=Object(a["cloneDeep"])(XO);sk.name="z-ai-competing-products-stage",sk.label="实时搜索类竞品评测模版",sk.hiddenItems=[{component:"modelA",attributes:{label:"modelA",name:"modelA",type:Array,hidden:!0,required:!0}},{component:"modelJ",attributes:{label:"modelJ",name:"modelJ",type:Array,hidden:!0,required:!0}},{component:"modelJ.sessionId",attributes:{label:"modelJ.sessionId",name:"modelJ.sessionId",type:Array,hidden:!0,required:!0}}],sk.attributes=[...sk.attributes,{name:"modelList",label:"模型配置",value:["modelA","modelJ"],type:Array,component:"z-multiple-select",attributes:{options:[{label:"modelA(文心一言)",value:"modelA"},{label:"modelJ(ppl)",value:"modelJ"}]}}];const ik=Object(a["cloneDeep"])(XO);ik.name="z-ai-chat-stage-4",ik.label="大模型实时对话标注(modelK)",ik.hiddenItems=[{component:"modelK",attributes:{label:"modelK",name:"modelK",type:Array,hidden:!0,required:!0}}],ik.attributes=[...ik.attributes,{name:"modelList",label:"模型配置",value:["modelK"],type:Array,component:"z-multiple-select",attributes:{options:[{label:"modelK(doubao)",value:"modelK"}]}}];const ak={...ZO,metadata:ek},ok={...ZO,metadata:tk},nk={...ZO,metadata:sk},rk={...ZO,metadata:ik};var lk=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{scopedSlots:e._u([{key:"component",fn:function(){return[s("files-collect-annotation",e._b({ref:"filesCollectAnnotation",attrs:{$renderedComponentConfig:e.$renderedComponentConfig}},"files-collect-annotation",e.$attrs,!1))]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},ck=[],dk=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container"},[s("div",{staticClass:"files-collect-annotation"},e._l(e.collectList,(function(t){return s("Row",{key:t.name},[s("Col",{attrs:{span:"24"}},[s("Card",{staticClass:"collect-item"},[s("div",{staticClass:"header"},[s("Row",{staticClass:"title",attrs:{type:"flex",align:"middle"}},[s("Icon",{attrs:{type:e.configMap[t.type].icon,size:"20"}}),s("h3",{staticClass:"mls"},[e._v(e._s(t.label))])],1),t.description?s("div",{staticClass:"desc",domProps:{innerHTML:e._s(t.description)}}):e._e()],1),s("div",{staticClass:"content"},[e.objectsMap[t.name]&&e.objectsMap[t.name].length>0?[s("div",{staticClass:"file-item"},e._l(e.objectsMap[t.name][0].data,(function(i){return s("Row",{key:i.url,attrs:{align:"bottom"}},[e.fileSignMap[i.url]?s("Col",["collect/image"===t.type||"gif"===i.format?s("safeImage",{staticClass:"file-contaner",attrs:{src:e.fileSignMap[i.url].previewUrl,fit:"contain"}}):"max"===i.format?s("Icon",{staticClass:"file-contaner",attrs:{type:e.configMap[t.type].icon,size:"100",color:"#ddd"},on:{click:function(t){return e.handleDownload(e.fileSignMap[i.url].downloadLink)}}}):s("preview",{attrs:{previewType:e.getPreviewType(t.type),filename:i.name,previewUrl:e.fileSignMap[i.url].previewUrl}},[s("Icon",{staticClass:"file-contaner",attrs:{type:e.configMap[t.type].icon,size:"100",color:"#ddd"}})],1)],1):e._e(),s("Col",{attrs:{flex:"auto"}},[t.isRenameFile?s("Row",{attrs:{type:"flex",align:"middle"}},[s("Col",[e._v("文件名：")]),s("Col",{staticStyle:{display:"flex","align-items":"center","min-width":"300px"}},[s("Input",{attrs:{disabled:e.disabled},model:{value:i.rename,callback:function(t){e.$set(i,"rename",t)},expression:"file.rename"}}),s("span",[e._v("."+e._s(i.format))])],1)],1):s("p",[e._v("文件名："+e._s(i.name))]),["collect/image"].includes(t.type)?s("p",[e._v("尺寸："+e._s(i.width+" x "+i.height))]):e._e(),["collect/audio","collect/video"].includes(t.type)?s("p",[e._v("时长："+e._s(i.duration.toFixed(2))+"s")]):e._e(),s("p",[e._v("大小："+e._s((i.size/1048576).toFixed(2))+" MB")]),s("p",[e._v("种类："+e._s(i.format))])],1),s("Col",{staticStyle:{display:"flex"}},[s("Attachment",{attrs:{attachments:e.fileData[t.name],disabled:e.disabled,objType:e.$optimus.objectType,objId:e.$optimus.objectId,attachScene:e.attachScene,accept:e.configMap[t.type].accept||void 0,metadata:!0,label:"重新上传",labelMode:"text"},on:{"update:attachments":[function(s){return e.$set(e.fileData,t.name,s)},function(s){return e.updateFile(s,e.objectsMap[t.name][0])}]}}),s("a",{attrs:{disabled:e.disabled},on:{click:function(s){return e.deleteFile(e.objectsMap[t.name][0])}}},[e._v("  删除")])],1)],1)})),1),s("optimus-engine",{directives:[{name:"collectTags",rawName:"v-collectTags",value:t.name,expression:"item.name"}],ref:"form_"+t.name,refInFor:!0,staticClass:"optimus-engine",attrs:{component:e.componentConfigMap[t.name],context:e.$optimus.context,disabled:e.disabled,answer:e.initAnswer[t.name]}})]:s("div",[s("Row",{attrs:{type:"flex",justify:"center"}},[s("Attachment",{attrs:{attachments:e.fileData[t.name],disabled:e.disabled,objType:e.$optimus.objectType,objId:e.$optimus.objectId,attachScene:e.attachScene,accept:e.configMap[t.type].accept||void 0,metadata:!0},on:{"update:attachments":[function(s){return e.$set(e.fileData,t.name,s)},function(s){return e.addFile(s,t)}]}})],1),s("Row",{attrs:{type:"flex",justify:"center"}},[s("div",{staticClass:"txt-muted mts"},[e._v("支持格式为"+e._s(e.getFileAcceptLabel(e.configMap[t.type].accept)))])])],1)],2)])],1)],1)})),1)])},uk=[],hk={components:{Attachment:Jj,preview:Gn,safeImage:Bs},directives:{collectTags:{inserted:(e,t,s)=>{s.componentInstance.$watch("tags",()=>{s.context.updateObjTags(t.value)},{immediate:!0})}}},mixins:[Re["a"]],data(){const{objects:e}=this.$optimus,t=Object(a["cloneDeep"])(e).reduce((e,t)=>Object.assign(e,{[t.name]:{tags:t.tags}}),{});return{configMap:{"collect/image":{icon:"ios-image-outline",accept:".png,.jpg,.gif,.GIF"},"collect/3D":{icon:"ios-cube-outline",accept:".max,.gif"},"collect/video":{icon:"ios-videocam-outline",accept:".mp4,.avi"},"collect/audio":{icon:"ios-volume-up",accept:".wav,.mp3,.m4a"},"collect/office":{icon:"ios-document-outline",accept:".ppt,.pdf,.txt,.csv,.xls,.xlsm,.xlsx,.doc,.docx"}},initAnswer:t,objects:e,fileData:{},fileSignMap:{},attachScene:"label"}},computed:{collectList(){return this.$renderedComponentConfig.$object_tools},disabled(){return this.$optimus.disabled},componentConfigMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{const{name:s}=t,i=this.$optimus.renderedComponentConfig.$object_items.filter(e=>{const{attributes:{reference:t}}=e;return"all"===t||t===s});e[s]={component:"z-form-stage",items:i}}),e},objectsMap(){return Object(a["groupBy"])(this.objects,e=>e.name)}},watch:{fileData:{handler(e){console.log("watch fileData: ",e),Object.keys(this.fileData).forEach(e=>{this.fileData[e].forEach(e=>{this.$set(this.fileSignMap,e.attach_path,{previewUrl:e.preview_url,attachId:e.attach_id,downloadLink:e.download_link})})})},deep:!0}},created(){this.fetchAttachments(),this.collectList.forEach(e=>{!this.fileData[e.name]&&this.$set(this.fileData,e.name,[])})},mounted(){this.$optimus.$on("optimus:forms-stage:check",()=>{const{isValid:e,msg:t}=this.validate();this.$optimus.$emit("optimus:optimus-engine:check",e,t)})},methods:{validate(){return this.objects.some(e=>e.data.some(e=>!e.rename))?{isValid:!1,msg:"请检查是否有未命名的文件"}:{isValid:!0,msg:""}},updateObjTags(e){const t=Object(a["findIndex"])(this.objects,t=>e===t.name);-1!==t&&(this.objects[t].tags=this.$refs["form_"+e][0].tags)},addFile(e,t){const{type:s,name:i,label:o}=t,r=[];e.forEach(e=>{console.log(e.media_metadata);const{size:t,width:i,height:a,duration:o}=e.media_metadata;r.push({url:e.attach_path,name:e.filename,rename:e.filename.substring(0,e.filename.lastIndexOf(".")),size:t,format:e.filename.split(".").pop(),width:"collect/image"===s?i:void 0,height:"collect/image"===s?a:void 0,duration:["collect/audio","collect/video"].includes(s)?o:void 0})});const l="feature-"+Object(n["j"])(8);this.objects.push({type:s,name:i,label:o,featureId:l,data:r}),this.$nextTick(()=>{const e=Object(a["find"])(this.objects,{featureId:l});Object.assign(e,{tags:this.$refs["form_"+i][0].tags})})},async deleteFile(e){const[{rename:t,format:s,url:i}]=e.data;this.$Modal.confirm({title:"确定要删除？",content:`${t}.${s}`,onOk:()=>{zn({attach_id:this.fileSignMap[i].attachId}).then(()=>{this.fileData[e.name].length=0,this.handleDeleteObj(e),this.$Message.success("删除成功")}).catch(e=>{this.$Message.error("删除失败："+e.message)})}})},handleDeleteObj(e){const t=this.objects.findIndex(t=>t.featureId===e.featureId);-1!==t&&this.objects.splice(t,1)},updateFile(e,t){try{var s;const[{url:i}]=t.data;(null===(s=this.fileSignMap[i])||void 0===s?void 0:s.attachId)&&zn({attach_id:this.fileSignMap[i].attachId}),this.handleDeleteObj(t),this.addFile(e,this.getTool(t.name))}catch(i){console.log(i)}},handleDownload(e){window.open("https://"+e,"_blank")},getFileAcceptLabel(e){return e.split(",").map(e=>e.slice(1)).join("，")},getPreviewType(e){return"collect/3D"===e?"model":"collect/office"===e?"cos":e.split("/")[1]},getTool(e){return Object(a["find"])(this.$renderedComponentConfig.$object_tools,{name:e})}},asyncMethods:{fetchAttachments(){const{objectId:e,objectType:t}=this.$optimus,s={obj_type:t,obj_id:e,attach_scene:this.attachScene};return Bn(s).then(e=>{e.data.forEach(e=>{this.$set(this.fileSignMap,e.attach_path,{previewUrl:e.preview_url,attachId:e.attach_id,downloadLink:e.download_link})})})}}},pk=hk,mk=(s("cb04"),Object(S["a"])(pk,dk,uk,!1,null,"11c9dbb6",null)),gk=mk.exports,bk={label:"多模态数据采标模版",icon:"ios-image-outline",name:"z-files-collect-stage",repeatable:!0,attributes:[],tools:[{type:"collect/image",label:"图片采集",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!0,value(){return`collect_image_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"文件数量",name:"fileCount",type:Number,value:1,attributes:{isVisible:!1}},{label:"文件名可编辑",name:"isRenameFile",type:Boolean,component:"z-switch",value:!0},{label:"采集说明（可填写采集相关要求）",name:"description",type:String,required:!1,component:"z-input",value:""}]},{type:"collect/3D",label:"3D采集",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!0,value(){return`collect_3D_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"文件数量",name:"fileCount",type:Number,value:1,attributes:{isVisible:!1}},{label:"文件名可编辑",name:"isRenameFile",type:Boolean,component:"z-switch",value:!0},{label:"采集说明（可填写采集相关要求）",name:"description",type:String,required:!1,component:"z-input",value:""}]},{type:"collect/audio",label:"音频采集",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!0,value(){return`collect_audio_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"文件数量",name:"fileCount",type:Number,value:1,attributes:{isVisible:!1}},{label:"文件名可编辑",name:"isRenameFile",type:Boolean,component:"z-switch",value:!0},{label:"采集说明（可填写采集相关要求）",name:"description",type:String,required:!1,component:"z-input",value:""}]},{type:"collect/video",label:"视频采集",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!0,value(){return`collect_video_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"文件数量",name:"fileCount",type:Number,value:1,attributes:{isVisible:!1}},{label:"文件名可编辑",name:"isRenameFile",type:Boolean,component:"z-switch",value:!0},{label:"采集说明（可填写采集相关要求）",name:"description",type:String,required:!1,component:"z-input",value:""}]},{type:"collect/office",label:"文档采集",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!0,value(){return`collect_office_${(new Date).getTime()}${Math.floor(1e6*Math.random()).toString().padStart(6,"0")}`}},{label:"文件数量",name:"fileCount",type:Number,value:1,attributes:{isVisible:!1}},{label:"文件名可编辑",name:"isRenameFile",type:Boolean,component:"z-switch",value:!0},{label:"采集说明（可填写采集相关要求）",name:"description",type:String,required:!1,component:"z-input",value:""}]}]},fk={metadata:bk,components:{FilesCollectAnnotation:gk,BaseLayout:Lp},mixins:[Re["a"]],inheritAttrs:!1},vk=fk,yk=Object(S["a"])(vk,lk,ck,!1,null,null,null),wk=yk.exports,xk=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("BaseLayout",{attrs:{showObjects:!0,isWatermarkEnabled:e.isWatermarkEnabled},scopedSlots:e._u([{key:"component",fn:function(){return[s("screenshot-annotation",{ref:"screenshotAnnotation",attrs:{src:e.src,field:e.field,$renderedComponentConfig:e.$renderedComponentConfig},on:{"select-feature":e.selectFeature}})]},proxy:!0},{key:"objects",fn:function(){return[s("screenshot-objects",{ref:"screenshotObjects",attrs:{$renderedComponentConfig:e.$renderedComponentConfig},on:{"objects:select-object":e.selectObject,"delete-object":e.deleteObject}})]},proxy:!0},{key:"global",fn:function(){return[e._t("default")]},proxy:!0}],null,!0)})},Ck=[],jk=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"z-file-screenshot"},[s("Row",[s("div",{staticClass:"copy-container",on:{click:e.triggerPaste}},[s("Icon",{staticClass:"icon",attrs:{type:"md-information-circle"}}),e._v("请先用外部工具截图，再点击当前区域进行粘贴")],1)]),s("Row",{staticStyle:{gap:"8px",height:"calc(100% - 50px)"}},e._l(e.urls,(function(e,t){return s("Col",{key:e,staticStyle:{flex:"1"}},[s("iframe",{attrs:{src:e,height:"100%",width:"100%"}})])})),1),s("modal",{ref:"mark_modal",attrs:{title:e.markModal.title,draggable:!0,mask:!1,styles:{left:"600px"}},on:{"on-cancel":e.cancelMark},model:{value:e.markModal.showModal,callback:function(t){e.$set(e.markModal,"showModal",t)},expression:"markModal.showModal"}},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"screenshot"},[s("safeImage",{key:e.markModal.image,staticStyle:{height:"200px"},attrs:{src:e.markModal.image,fit:"contain"}})],1),[e.markModal.showModal?s("optimus-engine",{key:e.markModal.featureId,ref:"object",attrs:{component:e.markModal.componentConfig,context:e.$optimus.context,answer:e.markModal.objAnswer,disabled:e.$optimus.disabled}}):e._e()]],2),s("template",{slot:"footer"},[s("Button",{on:{click:e.cancelMark}},[e._v("取消")]),s("Button",{attrs:{loading:e.loading},on:{click:e.confirmMark}},[e._v(e._s(e.loading?"上传中":"确认"))])],1)],2)],1)},Ok=[],kk={components:{safeImage:Bs},mixins:[Re["a"]],props:{src:[Array,String],field:String},data(){const{objects:e}=this.$optimus;return{objects:e,markModal:{showModal:!1,featureId:"",title:"截图",componentConfig:{},objAnswer:{},file:null,data:{index:"",url:""},image:null,updateFeatureId:!1},loading:!1,urls:[]}},mounted(){try{const e=JSON.parse(this.src);this.urls=e.map(e=>this.field&&e[this.field]||e)}catch(t){this.urls=[this.src]}this.markModal.componentConfig={component:"z-form-stage",items:this.$optimus.renderedComponentConfig.$object_items};const e=localStorage.getItem("modal-dragData");if(e){const{x:t,y:s}=JSON.parse(e);this.$refs.mark_modal.dragData.x=t,this.$refs.mark_modal.dragData.y=s}this.$refs.mark_modal.$watch("contentStyles",()=>{const{x:e,y:t}=this.$refs.mark_modal.dragData;localStorage.setItem("modal-dragData",JSON.stringify({x:e,y:t}))})},methods:{async triggerPaste(){if(navigator.clipboard)try{const e=await navigator.clipboard.read();if(e.length){const[t]=e,s=t.types.findIndex(e=>e.startsWith("image/"));if(-1===s)console.error("截图工具：没有找到可粘贴的图片");else{const e=await t.getType(t.types[s]),i="feature-"+Object(n["j"])(8);this.markModal.updateFeatureId="",this.markModal.objAnswer={},this.markModal.featureId=i,this.markModal.title="截图："+i;const a=new FileReader;a.onload=t=>{this.markModal.image=t.target.result,this.markModal.showModal=!0,this.markModal.file=e},a.readAsDataURL(e)}}else console.error("截图工具：没有找到可粘贴的数据")}catch(e){this.$Message.error("无法读取剪贴板内容",e)}else this.$Message.error("浏览器不支持 Clipboard API")},async getUrl(e){try{const t=await Object(Wg["f"])({attach_id:e,need_preview:!0});this.markModal.data.index=e,this.markModal.data.url=t.attach_path,this.markModal.image=t.preview_url}catch(t){console.error(t)}finally{this.loading=!1}},async addObject(e){const{file:t}=this.markModal,s=this;s.loading=!0;try{const i=`${this.markModal.featureId}.${t.type.split("/")[1]}`,a={obj_type:this.$optimus.objectType,obj_id:this.$optimus.objectId,attach_scene:"label",attach_name:i,attach_size:t.size},{data:[{attach_id:o,bucket:n,region:r,prefix:l,scene:c}]}=await Object(Wg["b"])(a),d={id:o,type:"attachment",Bucket:n,Region:r,Key:`${l}/${this.$optimus.objectId}/${c}/${i}`,file:t,handleTaskReady(){},async handleUploadSuccess(){await s.getUrl(o),s.loading=!1,s.markModal.showModal=!1;const[{type:t,name:i,label:a}]=s.$renderedComponentConfig.$object_tools,n={type:t,data:{index:s.markModal.data.index,url:s.markModal.data.url},tags:e,featureId:s.markModal.featureId,name:i,label:a};s.objects.push(n),s.$emit("select-feature",s.markModal.featureId)},handleUploadFail(){s.$Message.error("文件上传出错，请联系任务负责人解决"),s.loading=!1}};fu(d)}catch(i){console.log(i)}},deleteObj(e){const t=this.objects.findIndex(t=>t.featureId===e);this.objects.splice(t,1)},selectFeature(e){this.markModal.feature=e;const t=this.objects.find(t=>t.featureId===e);this.markModal.objAnswer={tags:t.tags},this.markModal.title="截图："+e,this.markModal.updateFeatureId=e,this.getUrl(t.data.index),this.markModal.showModal=!0},async confirmMark(){if(this.$refs.object.validate(),this.$refs.object.isValid){const e=this.$refs.object.tags;if(this.markModal.updateFeatureId){const t=this.objects.findIndex(e=>e.featureId===this.markModal.updateFeatureId);-1!==t&&(this.objects[t].tags=e,this.markModal.updateFeatureId="",this.markModal.showModal=!1)}else this.markModal.updateFeatureId="",this.addObject(e)}else this.markModal.showModal=!0},cancelMark(){this.markModal.showModal=!1,this.markModal.image="",this.markModal.file=null}}},Ak=kk,Sk=(s("8327"),Object(S["a"])(Ak,jk,Ok,!1,null,"8b122ee4",null)),_k=Sk.exports,Ik=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{attrs:{bordered:!1}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-albums-outline"}}),s("span",{staticClass:"mls"},[e._v("元素标签")]),e.objects.length?s("span",[e._v("（"+e._s(e.objects.length)+"）")]):e._e()],1),s("div",{staticClass:"z-stage__objects"},[e.objects.length>0?s("CellGroup",[s("draggable",{attrs:{list:e.objects},on:{end:e.handleDrag}},e._l(e.objects,(function(t){return s("Cell",{key:t.featureId,attrs:{selected:e.activeItem===t.featureId,id:t.featureId,name:t.featureId},nativeOn:{click:function(s){return e.selectObject(t.featureId)}}},[s("div",{staticClass:"title"},[s("div",{staticClass:"ellipsis"},[s("span",[e._v(e._s(e.getLable(t)))])])]),s("template",{slot:"extra"},[s("Tooltip",{attrs:{placement:"left","max-width":"400",theme:"light",transfer:!0,content:JSON.stringify(t,null,"\t")}},[s("Button",{attrs:{icon:"ios-information-circle-outline"},on:{click:function(e){e.stopPropagation()}}})],1),s("Button",{attrs:{icon:"ios-create-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.selectObject(t.featureId)}}}),s("Button",{attrs:{icon:"ios-trash-outline",disabled:e.$optimus.disabled},on:{click:function(s){return s.stopPropagation(),e.removeObject(t.featureId)}}})],1)],2)})),1)],1):e._e()],1)])},$k=[],Mk={components:{draggable:ls.a},mixins:[Re["a"]],props:["objDisplays"],data(){const{objects:e}=this.$optimus;return{activeItem:null,objects:e}},computed:{componentConfig(){return{component:"z-form-stage",items:this.$renderedComponentConfig.$object_items}},toolLabelMap(){const e={};return this.$renderedComponentConfig.$object_tools.forEach(t=>{e[t.name]=t.label}),e}},methods:{getLable(e){const{name:t,featureId:s}=e,i=this.objects.filter(e=>e.name===t),a=i.findIndex(e=>e.featureId===s)+1,o=this.getLocalVal(e);return`${this.toolLabelMap[t]}-${a}${o}`},selectActiveObject(e){this.activeItem=e},getLocalVal(e){let t="";try{this.componentConfig.items.some(s=>{const i=Object(a["find"])(e.tags,{name:s.attributes.name});if(i){if(Object(a["isString"])(i.value)&&i.value)return t=i.value,!0;if(Object(a["isArray"])(i.value)&&i.value.length>0)return t=i.value.join(","),!0}return!1})}catch(s){console.log(s)}return t?`（${t}）`:""},handleDrag({oldIndex:e,newIndex:t}){this.objects[e].name===this.objects[t].name&&this.$optimus.$emit("optimus:image-stage:dragObj",this.objects[t].name)},selectObject(e){this.$emit("objects:select-object",e)},removeObject(e){this.$Modal.confirm({title:"确定要删除？",content:e,onOk:()=>{this.$emit("delete-object",e)}})}}},Tk=Mk,Ek=(s("63d0"),Object(S["a"])(Tk,Ik,$k,!1,null,"65d154bf",null)),Lk=Ek.exports,Dk={label:"文件截图标注工具",icon:"ios-image-outline",name:"file-screenshot-stage",toolReadonly:!0,attributes:[{name:"src",label:"文件地址",value:"",vType:["array","url"]},{name:"field",label:"链接字段名(文件地址为对象数组时使用)",value:"",vType:"string"},{name:"isWatermarkEnabled",label:"文件水印",component:"z-switch",type:Boolean,value:!0,attributes:{description:"关闭水印可能导致数据泄露无法追溯，请谨慎操作",openLabel:"开",closeLabel:"关"}}],tools:[{type:"objects/object",label:"截图标注",attributes:[{label:"标签名称",name:"label",type:String,value:""},{label:"元素标签",name:"name",type:String,required:!1,value(){return"objects_object_"+(new Date).getTime()}}]}],defaultTools:[{type:"objects/object",label:"截图",name:"objects_object_screenshot"}]},Pk={metadata:Dk,components:{BaseLayout:Lp,ScreenshotAnnotation:_k,ScreenshotObjects:Lk},mixins:[Re["a"]],props:{src:String,field:String,isWatermarkEnabled:{type:Boolean,default:!0}},methods:{selectObject(e){this.$refs.screenshotAnnotation.selectFeature(e),this.selectFeature(e)},deleteObject(e){this.$refs.screenshotAnnotation.deleteObj(e)},selectFeature(e){this.$nextTick(()=>{this.$refs.screenshotObjects.selectActiveObject(e)})}}},Bk=Pk,Rk=Object(S["a"])(Bk,xk,Ck,!1,null,null,null),zk=Rk.exports;const Nk=Object(n["n"])([Kh,sp,am,km,nb,Sb,Nb,ef,rf,yf,Af,zf,Xf,pv,Ev,Av,tw,ww,Dw,Jw,ex,Ax,yx,dC,jC,JC,pj,Tj,hO,pO,ak,ok,rk,wk,nk,zk,_O]);var Fk={components:{...Nk},metadata:Object(n["p"])([am,km,nb,Sb,Nb,ef,rf,yf,Af,zf,Xf,pv,Ev,Av,tw,ww,Dw,Jw,Ax,yx,dC,jC,JC,pj,Tj,hO,pO,ak,ok,rk,wk,nk,zk,_O])};const Vk=e=>{let t=0,s=null;return function(...i){const a=this;t+=1;const n=t,r=o.a.bind(e,a,{isOutdated(){return t!==n},previous:s});return s=r.apply(a,i)}},qk=e=>{const t=e.replace(/^(fetch|get|load|delete)/,"");return t.slice(0,1).toLowerCase()+t.slice(1)},Hk={install(e){e.config.optionMergeStrategies.asyncMethods=e.config.optionMergeStrategies.methods,e.mixin({data(){const e={};return Object.keys(this.$options.asyncMethods||{}).forEach(t=>{e[qk(t)]=null}),e},beforeCreate(){const t=this;Object.keys(this.$options.asyncMethods||{}).forEach(s=>{const i=this.$options.asyncMethods[s],a=qk(s),o=Vk((...e)=>{const[o,...n]=e,r=i.apply(t,n);return t[s].promise=Promise.resolve().then(()=>{if(!o.isOutdated())return t[s].isPending=!0,t[s].isResolved=!1,t[s].isRejected=!1,r}).then(e=>{if(!o.isOutdated())return t[a]=e,t[s].rejectedWith=null,t[s].isPending=!1,t[s].isResolved=!0,t[s].isRejected=!1,e}).catch(e=>{if(!o.isOutdated())throw t[a]=null,t[s].rejectedWith=e,t[s].isPending=!1,t[s].isResolved=!1,t[s].isRejected=!0,e}),t[s].promise});e.util.defineReactive(t,s,o);const n={execute:o,promise:null,isPending:!1,isResolved:!1,isRejected:!1,rejectedWith:null};Object.keys(n).forEach(t=>{e.util.defineReactive(o,t,n[t])})})}})}};var Wk=Hk;class Uk{init(){let e=document.getElementById("fast-modal");e||(e=document.createElement("div"),e.setAttribute("id","fast-modal"),e.setAttribute("style","position: absolute; left: -100000px; top: -10000px;"),document.body.appendChild(e));const t=this;t.$modal=new da["default"]({data(){return{modal:null,props:null,events:null,key:null}},render(e){return e(this.modal,{props:{...this.props},key:this.key,on:{...this.events,destroy:this.destroy}})},methods:{destroy(){this.$destroy(),this.$el&&document.body.removeChild(this.$el),t.$modal=void 0}}}).$mount(e)}show(e,t,s){this.$modal||this.init();const i=String(Math.random()).slice(2);Object.assign(this.$modal,{modal:e,key:"fast-modal-"+i,props:{...t},events:s})}hide(e,t,s){if(!this.$modal)return;const i=String(Math.random()).slice(2);Object.assign(this.$modal,{modal:e,key:"fast-modal-"+i,props:t,events:s})}}var Qk={install(e){e.prototype.$FastModal=new Uk}},Jk=s("f9b0"),Gk=s("fa1f"),Kk=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{"ok-text":"引用",draggable:!0,width:"1100","mask-closable":!1,title:"智能纠错输入框",loading:!0},on:{"on-ok":e.handleConfirm,"on-cancel":e.handleCancel},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("iframe",{ref:"modal-iframe",staticStyle:{border:"none"},attrs:{width:"100%",height:"100%",src:e.url}})])},Yk=[],Zk={props:{$optimus:Object,name:String,initValue:{type:[String,Array,Object,Number]},url:{type:String,default:""},wordCount:{type:Boolean,default:!0}},data(){return{visible:!0}},mounted(){const e=this.$refs["modal-iframe"],t={type:"initvalue",data:{name:`${this.$optimus._uid}-${this.name}`,initValue:this.initValue,wordCount:this.wordCount}};e.onload=function(){null===e||void 0===e||e.contentWindow.postMessage(t,"*")}},methods:{handleConfirm(){var e;null===(e=this.$refs["modal-iframe"])||void 0===e||e.contentWindow.postMessage({type:"confirmModal"},"*")},handleCancel(){var e;null===(e=this.$FastModal.$modal)||void 0===e||e.destroy()}}},Xk=Zk,eA=(s("4a0e"),Object(S["a"])(Xk,Kk,Yk,!1,null,"28687272",null)),tA=eA.exports,sA=s("5e4b");s("9639");da["default"].use(sA["a"]),da["default"].use(Wk),da["default"].use(Qk),da["default"].use(Gk["a"]);var iA={components:{...qh.components,...Fk.components},inject:{$optimus:{default:void 0}},render(e){const t=this,s=i=>{const o=i.items?i.items.map(e=>e.attributes&&(e.attributes.hidden||!1===e.attributes.isVisible)?[]:s(e)):[],n={};return Object(a["forEach"])(i.attributes,(e,s)=>{if(e&&Object(a["isFunction"])(e.$expressionFn))try{n[s]=e.$expressionFn(t.rawContext,t.formData,t.objectFormDatas,t.groupFormDatas)}catch(i){console.error("[OPTIMUS ENGINE] 表达式配置出错 1:",e.$expression)}else n[s]=Object(a["cloneDeep"])(e)}),"z-slot"===i.component?e("div",[this.$slots[n.name]]):e(i.component,{attrs:n,props:{$renderedComponentConfig:i},slot:i.slot},o)};return s(this.renderedComponentConfig)},props:{component:Object,context:Object,objectContext:Object,schema:Array,answer:{type:Object,default(){return{tags:[],objects:[],extData:null}}},validAnswer:Object,disabled:{type:Boolean,default:!1},debug:{type:Boolean,default:!1},active:{type:Boolean,default:!1},isNeedValidate:{type:Boolean,default:!0},isNeedAutoValidate:{type:Boolean,default:!1},curLabelGroup:String,group:String,objectId:String,objectType:String,reference:Object},provide(){return{$optimus:this}},data(){var e;return{formData:{},objectFormDatas:(null===(e=this.$optimus)||void 0===e?void 0:e.objectFormDatas)||{},objects:[],extData:null,validFormData:{},isValid:!0,isAutoValid:!0,validateMsg:"",renderedComponentConfig:null,referrer:document.referrer||null,getObjectLabel:null,beforeSubmit:{},enginePrimaryKey:Object(Ve["a"])()}},computed:{rawContext(){const e={};return Object.keys(this.context).forEach(t=>{Object(a["isObject"])(this.context[t])?(e[t]=JSON.stringify(this.context[t]),e[t+"_raw"]=this.context[t]):e[t]=this.context[t]}),e},tags(){return Object(a["map"])(this.formData,(e,t)=>{const s=Object(a["find"])(this.renderedComponentConfig.items,e=>e.attributes&&e.attributes.name===t);let i=s?s.attributes.label:"",o=!0;try{var n,r;o=null!==s&&void 0!==s&&null!==(n=s.attributes)&&void 0!==n&&null!==(r=n.isVisible)&&void 0!==r&&r.$expressionFn?s.attributes.isVisible.$expressionFn(this.rawContext,this.formData,this.objectFormDatas):!1!==(null===s||void 0===s?void 0:s.attributes.isVisible),i=i.$expressionFn?i.$expressionFn(this.rawContext,this.formData,this.objectFormDatas):i}catch(l){console.error("[OPTIMUS ENGINE] 表达式配置出错 5:",l)}return{name:t,label:i.toString(),value:o?e:null}})},result(){const e={tags:this.tags,extData:this.extData};return Object(a["isArray"])(this.objects)&&(e.objects=this.objects),e},answerJsonSchema(){return g(this,Fk.metadata,qh.metadata)},groupFormDatas(){var e;const t=null===(e=this.$optimus)||void 0===e?void 0:e.objectFormDatas;if(!t||!this.group)return{};const[s]=this.group.split("_");return Object.keys(t).filter(e=>e.startsWith(s)).map(e=>t[e])}},watch:{component:{handler(){this.init()},deep:!0},answer:{handler(){this.init()},deep:!0},context:{handler(){this.init()},deep:!0}},mounted(){this.$on("optimus:optimus-engine:check",(e,t)=>{this.isValid=this.isValid&&e,this.validateMsg=Object(a["isUndefined"])(t)?this.validateMsg:t,this.$optimus&&this.$optimus.$emit("optimus:optimus-engine:check",e),this.isValid&&this.isNeedAutoValidate&&this.autoValidate()}),this.$optimus&&this.$optimus.$on("optimus:forms-stage:check",()=>{this.validate()}),this.$on("optimus:forms-stage:auto-check",e=>{this.isAutoValid=this.isAutoValid&&e}),this.$on("optimus:optimus-engine:submit",()=>{this.$emit("submit")})},methods:{init(){const e=Object(a["cloneDeep"])(this.component),t=Object(a["cloneDeep"])(this.answer);this.renderedComponentConfig=d(e,this.rawContext,[]);const s={};u(this.renderedComponentConfig,s,{input:this.context,output:s,objOutput:this.objectFormDatas,groupOutput:this.groupFormDatas});let i=[];if(Object(a["isObject"])(t)){const{tags:e,objects:o,extData:n}=t;this.extData=n,Object(a["isArray"])(e)?Object(a["forEach"])(e,e=>{var t;const i="average"===(null===(t=e.fitting)||void 0===t?void 0:t.type)&&!isNaN(Number(e.value))&&this.renderedComponentConfig.items.find(t=>t.attributes.name===e.name&&"z-multiple-select"===t.component);s[e.name]=i?[e.value.toString()]:e.value}):Object(a["forEach"])(t,(e,t)=>{s[t]=e}),Object(a["isArray"])(o)&&(i=o)}this.objects=i,this.formData=s,this.group&&this.$optimus.$emit("optimus:group-formdata",this.group,this.formData);const o=Object(a["cloneDeep"])(s);this.$on("optimus:group-formdata",(e,t)=>{this.$set(this.objectFormDatas,e,t),Object.keys(this.formData).forEach(e=>{this.formData[e]=o[e]})});const n={isValid:!0,invalidRemark:""};this.validAnswer&&Object.keys(n).forEach(e=>{void 0!==this.validAnswer[e]&&(n[e]=this.validAnswer[e])}),this.validFormData=n},validate(e){this.isValid=!0,this.isAutoValid=!0,this.isNeedValidate&&"save"!==(null===e||void 0===e?void 0:e.eventType)&&this.$emit("optimus:forms-stage:check",e)},autoValidate(){const e=this.renderedComponentConfig.items.every(e=>{var t;let s=e.attributes.autoValidatorEnabled?e.attributes.autoValidator:{result:!0};if(Object(a["isFunction"])(s.$expressionFn)&&(s=s.$expressionFn(this.rawContext,this.formData,this.objectFormDatas)),s&&Object(a["isString"])(s))try{s=JSON.parse(s)}catch(i){console.error("[OPTIMUS ENGINE] 标注检查配置出错2:",s,i)}return null===(t=s)||void 0===t?void 0:t.result});this.$emit("optimus:forms-stage:auto-check",e),this.$optimus&&this.$optimus.$emit("optimus:forms-stage:auto-check",e)},validateAnswerJson(e){const t=new Jk["Validator"],s=v(this.renderedComponentConfig,Object(a["cloneDeep"])(e||this.result)),i=t.validate(s,this.answerJsonSchema);console.log("validateAnswerJson",this.answerJsonSchema,s,i);const o={res:i,defaultRes:this.result,valid:i.valid,errorMsg:""};return i.valid||Object(a["forEach"])(i.errors,e=>{o.errorMsg=o.errorMsg?`${o.errorMsg}、${e.message}`:""+e.message}),o},updateFormData(e,t){this.$set(this.formData,e,t)},showWujieModal({url:e,name:t,initValue:s,wordCount:i}){console.log("showWujieModal:",s),this.$FastModal.show(tA,{$optimus:this,name:t,initValue:s,url:e,wordCount:null===i||void 0===i||i})},initBeforeSubmitEvent(e,t={saveEnabled:!0}){this.beforeSubmit.event=e,this.beforeSubmit.options=t}},created(){this.init()}};const aA={install(e){e.component("optimus-engine",iA),e.prototype.$OptimusComponentMetadata=qh.metadata,e.prototype.$OptimusStageMetadata=Fk.metadata,e.prototype.$OptimusConfigs=pi}}},c4f6:function(module,__webpack_exports__,__webpack_require__){"use strict";var _mixins_input_widget_mixin__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("6385"),_chat_metadata__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("6b23"),lodash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("9ec3"),lodash__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_2__),_fitting_fitting_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("13c8"),_ai_helpers_ai_suggest_vue__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("9a35"),_payload_vue__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("62f8"),_services_ai_help__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("3732");__webpack_exports__["a"]={metadata:_chat_metadata__WEBPACK_IMPORTED_MODULE_1__["a"],components:{Fitting:_fitting_fitting_vue__WEBPACK_IMPORTED_MODULE_3__["a"],AISuggest:_ai_helpers_ai_suggest_vue__WEBPACK_IMPORTED_MODULE_4__["a"],Payload:_payload_vue__WEBPACK_IMPORTED_MODULE_5__["a"]},mixins:[_mixins_input_widget_mixin__WEBPACK_IMPORTED_MODULE_0__["a"]],props:{readOnly:{type:Boolean,default:!1},fittingType:{type:String,default:""},isVisible:{type:Boolean,default:!0},type:{type:String,default:"string"},enableExpression:{type:Boolean,default:!0},apiUrl:{type:String,default:"string"},headers:{type:String,default:"string"},resPath:{type:String,default:"string"},targetTag:{type:String,default:"string"}},data(){return{typeMode:"",fixedValue:"",expressionValue:"${}",contentEditor:"",optimusId:this._uid,help:null,loading:!1,visible:!1}},computed:{httpConf(){let e={},t={};try{e=JSON.parse(this.$optimus.formData[this.name]),t=JSON.parse(this.headers)}catch(s){}return{url:this.apiUrl,headers:t,params:e}}},created(){const e=this.$optimus.formData[this.name]||"";this.$optimus.formData[this.name]=e,Object(lodash__WEBPACK_IMPORTED_MODULE_2__["isString"])(e)&&e.match(/^\$\{.*\}$/)?(this.typeMode="表达式",this.expressionValue=e):(this.typeMode="固定值",this.fixedValue=e),this.help=this.$renderedComponentConfig.$rawConfig.attributes.help},mounted(){},methods:{updateTypeMode(e){this.typeMode=e,this.$optimus.formData[this.name]="表达式"===e?this.expressionValue:this.fixedValue},handleFixedInputChange(e){this.fixedValue=e},handleExpressionInputChange(e){this.expressionValue=e},async sendApi(){this.loading=!0;const res=await _services_ai_help__WEBPACK_IMPORTED_MODULE_6__["a"].askChat(this.httpConf).catch(()=>{this.loading=!1});if(this.loading=!1,0===(null===res||void 0===res?void 0:res.code)){const result=eval(this.resPath);console.log(result),this.targetTag&&Object(lodash__WEBPACK_IMPORTED_MODULE_2__["has"])(this.$optimus.formData,this.targetTag)?(this.$optimus.formData[this.targetTag]=result||"",await this.$message.success("返回值成功写入目的标签")):await this.$message.error("未填写目的标签，无法赋值")}else await this.$message.error((null===res||void 0===res?void 0:res.message)||"调用接口失败")}}}},c5bd:function(e,t,s){"use strict";s("b148")},c66b:function(e,t,s){},c710:function(e,t,s){},c787:function(e,t,s){"use strict";s("88d5")},c7a8:function(e,t,s){},c800:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACtWK6eAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAyKADAAQAAAABAAAAyAAAAACbWz2VAAAMdUlEQVR4Ae2dz4scxxXHd7SS8SbxQQfZIAV0WWkhyWFBmBDroAVdcouzi2MZgyAYdLEOe3AOkXJ2MLH9B/gSCOSHLMkot/hg4xxEZGzBHrQGOb7IZhckHWxYy4oshfX3zc5MtbZG65mqmerqqU/B01TX9Ot67/Pqq5nZ6e6ZmqqpbW5uzshOy96X3ZTdk30uOy/7taxVU2hJp1Wec7I3ZNdkGx2zvo3NJQ2mpsmUZ0u2KLPa2xqwtWBrwtaGrZGZmkKrZ1olfFy2JtupXdGTB+uJcPyzKrdp2Wuy+7JHNXvO9pkef0T1zKDcDsqs1js1WyvH64kw8axKdEm206KogrqljdnEIY59OuVk/2NeqCb6PX3bd+JeUZXTrMxqPEizNbM09uLUOYESPCS7MwiNyj6r6u+pM+5Rz618zlbyG7R7dtRx1Hk8q6nMajtMs7VzqM64xzq3krP3mCHt5bEGlvDgSv4p2dcBEMznyYShjnUq5fJyAANzOT/WwOo6uBLbKxv0rZWBqLaP64p71PMqKfvQGdpOjzqeuo4nAB8HQrA1tDdV3LtSTaR5jsp2B853RFCeCPTNzW0hIqAY34hpR+vaqeWRwKPaGrK1lKSlFMiByIz2R/rn4h7DIcY3l/wtjthaJuOQUiCxf8uO9c9lgcTkEeObS/4WR2wesf4Ds0gpkIGDYkcI5EIAgeRSCeLIkgACybIsBJULAQSSSyWII0sCCCTLshBULgQQSC6VII4sCSCQLMtCULkQQCC5VII4siSAQLIsC0HlQgCB5FIJ4siSAALJsiwElQsBBJJLJYgjSwIIJMuyEFQuBBBILpUgjiwJIJAsy0JQuRBAILlUgjiyJIBAsiwLQeVCoO814p2L4o8qSLu0cVRXbx2LTPpFxbUQeYwc3PdFBLFPDJYj/HNxjb1k9pg4jCqXuzrQmuxyq9X6cvtBH7oZmSa1ew69KntW1lc82w/ANgQmhMAD5XFJdkZC+W83p55AJA67a91fZD/oPskjBAok8I1yPimRXLTc2wKROOy+p/+S8aphVGilE7BXk19KJO/ZPWLtM8ZnsthbsZQOlfwni8C60pm1v2K9JEMck1VcsoknYJp4yQSyGH8sjgCBiSSwaG+xbiq1ibkp8kSWiaTqInDLBHJPsz9WVwTMC4GMCXxrb7FuZRwgoUGgTgI3TSBX6oyAuSGQMYEPTSB/zzhAQoNAnQT+Zp9B7MvC/8h+XmckzA2BzAh8qHh+0f0m3X5N9iNZzIl0meVHOBAIJnBbnk/rm/Qb9hZryjp6eEb2iW3TIFAwAdPAMx1NTLUFYjA0YKebzMvsd/CuymgQKImArXlb+/MdLbRzb7/F6kdBn03sNwHt6/ZRXQ/yoo71Sr+5Bhw7of2uD7hvzrudU3CHAwP8VH7PB/rm5DanYP4REdDr8v1rhH/V1a4HWZcoNqqD3f4jz97tOIxsQUpwC91JAx+vK6aVQN9s3MTBChLa7k4Ig9D8u35rqTj03mJ1Z+YRAhBwBBCIY0EPAh4BBOIhYQACjgACcSzoQcAjgEA8JAxAwBFAII4FPQh4BBCIh4QBCDgCCMSxoAcBjwAC8ZAwAAFHAIE4FvQg4BFAIB4SBiDgCCAQx4IeBDwCCMRDwgAEHAEE4ljQg4BHAIF4SBiAgCOAQBwLehDwCCAQDwkDEHAEEIhjQQ8CHgEE4iFhAAKOAAJxLOhBwCOAQDwkDEDAEUAgjgU9CHgEEIiHhAEIOAIIxLGgBwGPAALxkDAAAUcAgTgW9CDgEUAgHhIGIOAIIBDHgh4EPAIIxEPCAAQcAQTiWNCDgEcAgXhIGICAI4BAHAt6EPAIIBAPCQMQcAQQiGNBDwIeAQTiIWEAAo4AAnEs6EHAI4BAPCQMQMARQCCOBT0IeAQQiIeEAQg4AgjEsaAHAY8AAvGQMAABRwCBOBb0IOARQCAeEgYg4AggEMeCHgQ8AgjEQ8IABBwBBOJY0IOARwCBeEgYgIAjgEAcC3oQ8Ai0to9sbm4+qbHfyBZkB2QzslG0fTrI/ogDfSrfuxH+ubjOKZDHA4P5n/yuB/rm5GZr6nBEQOvyvR3hX3W1NbUm+0D2dqvVuqXHXusJRMKw/hnZ72U/7O1BBwLlELijVF+V/VFC2bS02wKROKbVPydbskEaBAoncFH5Py+R/L/7GcRUgzgKXxWk3yNgWjBNTLX06mHvia/JdtsADQIQaBN4oH9/Zq8gp2SIo82EfyDQI2CaOGWvIPbq8dPeMB0IQKBLYNUEsqGtH3VHeIQABHoEvu5+SO+N0IEABBwBE8gNt0kPAhCoELhhAnm3MkAXAhBwBN7lz7wOBj0IVAls/ZlX3xbauT1vVp+hDwEITL1p2uBUE1YCBHwCD59qYuecaJ/nZH+Q2QlbNAiUSMDWvmnguY4mtk5WrJLQ9yJP2Q6yBRmnuwvCiBunu29dQnE4guu6fJOc7h4R43CuEt6yLKbNDzdjnnsLwEoEhJU8sxouKuU/H8HAXJeHmzF8b74oDGeHZwEEEEgBRSbFcAIIJJwdngUQQCAFFJkUwwkgkHB2eBZAAIEUUGRSDCeAQMLZ4VkAAQRSQJFJMZwAAglnh2cBBBBIAUUmxXACCCScHZ4FEEAgBRSZFMMJIJBwdngWQACBFFBkUgwngEDC2eFZAAEEUkCRSTGcAAIJZ4dnAQQQSAFFJsVwAggknB2eBRBAIAUUmRTDCSCQcHZ4FkAAgRRQZFIMJ4BAwtnhWQABBFJAkUkxnAACCWeHZwEEEEgBRSbFcAIIJJwdngUQQCAFFJkUwwkgkHB2eBZAAIEUUGRSDCeAQMLZ4VkAAQRSQJFJMZwAAglnh2cBBBBIAUUmxXACCCScHZ4FEEAgBRSZFMMJIJBwdngWQACBFFBkUgwngEDC2eFZAAEEUkCRSTGcAAIJZ4dnAQQQSAFFJsVwAggknB2eBRBAIAUUmRTDCSCQcHZ4FkAAgRRQZFIMJ4BAwtnhWQABBFJAkUkxnMDuR7lubm4+oef2y2Yetc+Q4weG3H/77nOKaftYE7djeM6IwXwTk94W89y27WE3D4yQw11Nvt5qtTb6BdGqDmrSPdo+Jfut7Ej1OfoQmHACV5Xfn2VvSSz3u7n2BCJxzGrwn7KfdJ/kEQIFEvhEOf9KIvnMcm8LROI4qP5Hsn02SINA4QRuK/+nJZIbuyQOE8k5GeIofFWQfo+AaeGcaaOlfxa1cbH3FB0IQKBLYMn+zPtCd4tHCEDgIQIv2CvIFxr68UPDbEAAAkbgCxPIPXUegwcEIOAR+NbeYn3lDTMAAQgYga9MIKuwgAAE+hJYNYG80/cpBiEAgXfsM4idG2TfGtp5VzQIQGCLwLoeZnfp20I7Weuk7MHWOP9CoHgCpoWTpg17izWlznt6OCH7xrZpECiYgGngREcTU22BGAwN2Lfpdir1BRmvJoJAK4qArXlb+/MdLbST753NW0WhzyV7tX1UZtdwxFy/UD3sMW08Wx0Ysv+69l8b0ifH3X+noEI/79n74j/lmNSQMdm6emVIn+rul7Tx7+pARN8+Yti6uixhfBlxnDhXiW5ZFtPs1a3xTQBWIiCsNB6AElD+8xEMzHU5FYfeW6xUEzIPBJpEAIE0qVrEmpwAAkmOnAmbRACBNKlaxJqcAAJJjpwJm0QAgTSpWsSanAACSY6cCZtEAIE0qVrEmpwAAkmOnAmbRACBNKlaxJqcAAJJjpwJm0QAgTSpWsSanAACSY6cCZtEAIE0qVrEmpwAAkmOnAmbRACBNKlaxJqcAAJJjpwJm0QgpUDs0saYFusfM/cofWPyiPEdZQ6xx4rNI9Z/4PhTCiT2enK7HnsSWgyHGN+c2MXWMhmHlAK5rAqF3i3lqi6o7/sjizlVfcBYPhhwv367xfj2O14tY51a2m8ChjRbQ7aWkrRkAuncMcLuRhHS7McVJ6WdVyJ3ApIxn7cD/HJ1Ca3ppVrvPjJOmrobxSHZHbstxRBtVfvuGWdcqY+tfM4OkX931zOp4xznfFZTmdV2mGZr59A446r92EpwSXZ/QCq3tJ/9+u5ENeVk90S+MCAD28327XsPsyaDUU6zMqvxIM3WzFKT8x04diV6XLb2PVSu6Hn79d2JbMptWvaabKf/LOw522d6IiEoKeV2UGa13qnZWjk+qQz65qWEZ2SnZe/LbsruyT6XnZctyibuf8x+IJTnnOwN2TXZRsesb2Nz/XwmbUx52iuq1dxqb2vA1oKtCVsbtkZGdXfPodF9B21ceOJnoZjxAAAAAElFTkSuQmCC"},c83a:function(e,t,s){e.exports=s.p+"static/img/polygon.b4cb1f29.svg"},c952:function(e,t,s){},c979:function(e,t,s){e.exports=s.p+"static/img/dot.7f2ef151.svg"},cb01:function(e,t,s){"use strict";s("66b3")},cb04:function(e,t,s){"use strict";s("9150")},cb88:function(e,t,s){},ccc5:function(e,t,s){},ce0d:function(e,t,s){"use strict";s("8292")},ce3b:function(e,t,s){"use strict";s("b169")},cf02:function(e,t,s){"use strict";s("5e01")},cf75:function(e,t,s){"use strict";s("1f59")},cffa:function(e,t,s){},d010:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"list-mode"},[s("Dropdown",{on:{"on-click":e.handleDropdownClick}},[e._v(e._s(e.typeMode)),s("Icon",{attrs:{type:"md-arrow-dropdown",size:16}}),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},e._l(e.typeModeList,(function(t){return s("DropdownItem",{key:t,attrs:{name:t}},[e._v(e._s(t))])})),1)],1)],1)},a=[],o={props:{typeMode:{type:String}},data(){return{typeModeList:["固定值","表达式"]}},methods:{handleDropdownClick(e){this.$emit("updateTypeMode",e)}}},n=o,r=(s("557a"),s("2be6")),l=Object(r["a"])(n,i,a,!1,null,"b03d0c44",null);t["a"]=l.exports},d1aa:function(e,t,s){"use strict";s("7866")},d1e5:function(e,t,s){},d308:function(e,t,s){},d3bf:function(e,t,s){"use strict";s("7404")},d468:function(e,t,s){"use strict";s("e8b1")},d4e0:function(e,t,s){"use strict";s("bd3b")},d521:function(e,t,s){e.exports=s.p+"static/img/gridOff.3c229f50.svg"},d561:function(e,t,s){},d5a3:function(e,t,s){e.exports=s.p+"static/img/rectangle.09d236cb.svg"},d637:function(e,t,s){},d75b:function(e,t,s){},d9a5:function(e,t,s){},d9d0:function(e,t,s){},da33:function(e,t,s){},da67:function(e,t,s){"use strict";s("3043")},da81:function(e,t,s){"use strict";s("7294")},db49:function(e,t,s){"use strict";const i={DEFAULT:{PASSPORT_OA_ENABLED:!1,PASSPORT_WX_ENABLED:!0,SHARE_DOMAIN:null,INSIDE_DOMAIN:null,EAGIS_ID:null,EXTERNAL_URL:null,COS_DOMAIN:"${Bucket}.cos.${Region}.myqcloud.com",STORAGE_AIOSS_ENABLED:!1,HELP_LINK:"https://iwiki.woa.com/pages/viewpage.action?pageId=1992248861",LABEL_HELP_LINK:"https://docs.qq.com/doc/DSUxsdXRqVmljSnVF",PRIVATIZATION:!0},PROD:{STORAGE_AIOSS_ENABLED:!0,EXTERNAL_URL:{aidata:"http://aidata.oa.com",zhida:"https://aidata.tencent.com",hunyuan:"https://hy-op.woa.com/dev/index"},PRIVATIZATION:!1},DEV:{PASSPORT_OA_ENABLED:!0,PASSPORT_WX_ENABLED:!1,STORAGE_AIOSS_ENABLED:!0,EAGIS_ID:"mWLHQLJFCuYcgVrIOA",COS_DOMAIN:"${Bucket}.cos-internal.${Region}.tencentcos.cn",EXTERNAL_URL:{aidata:"http://dev-aidata.woa.com",zhida:"http://dev-zhida.woa.com",hunyuan:"https://t-hy-op.woa.com/dev/index"},PRIVATIZATION:!1}},a={"qlabel.woa.com":{...i.PROD,PASSPORT_OA_ENABLED:!0,PASSPORT_WX_ENABLED:!1,SHARE_DOMAIN:"qlabel.tencent.com",EAGIS_ID:"mWLHQLJFQRQRlWZORv",COS_DOMAIN:"${Bucket}.cos-internal.${Region}.tencentcos.cn"},"qlabel.tencent.com":{...i.PROD,INSIDE_DOMAIN:"qlabel.woa.com",EAGIS_ID:"PdVovEtzdborIEVihW"},"dev-qlabel.woa.com":{...i.DEV},"test-qlabel.woa.com":{...i.DEV},localhost:{...i.DEV},"local.woa.com":{...i.DEV}};t["a"]={...i.DEFAULT,...a[location.hostname],CONFIG_HOST_MAP:Object.keys(a)}},dc9f:function(e,t,s){e.exports=s.p+"static/img/show.6760fe49.png"},dde5:function(e,t,s){"use strict";s.d(t,"b",(function(){return S})),s.d(t,"d",(function(){return y})),s.d(t,"c",(function(){return j})),s.d(t,"a",(function(){return O})),s.d(t,"e",(function(){return A}));s("8d0d");var i=s("8206"),a=s.n(i),o=s("9ec3"),n=s.n(o),r=s("9c3a"),l=s.n(r),c=s("4f2b"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{transfer:!1,"mask-closable":!1,"footer-hide":"",width:"420"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[s("div",{staticClass:"loginTitle"},[s("p",{staticStyle:{"text-align":"center"}},[e._v("Qlabel登录状态已过期")]),s("p",{staticStyle:{"text-align":"center"}},[e._v("请重新登录")])]),s("div",{staticClass:"loginBox"},[e.showLoginSuccess?s("div",{staticClass:"flexCenterBox"},[s("Icon",{attrs:{type:"ios-checkmark-circle-outline",color:"#0DAC77",size:"60"}}),s("div",{staticClass:"loginMethod"},[e._v("登录成功")])],1):s("div",[s("div",{staticClass:"switchs"},[e.showIoaLogin&&e.isOA?s("div",[s("span",{staticClass:"loginMethod"},[e._v("iOA登录")])]):e._e(),e.isWX?s("div",[s("span",{staticClass:"loginMethod"},[e._v("微信登录")])]):e._e()]),e.showIoaLogin&&e.isOA?s("div",{directives:[{name:"show",rawName:"v-show",value:"OA"===e.loginPage,expression:'loginPage==="OA"'}],staticClass:"content"},[s("div",{staticClass:"IOAlogin"},[s("img",{attrs:{src:e.avatarUrl}}),s("span",[e._v(e._s(e.staffName))]),s("Button",{staticClass:"mtm",attrs:{type:"primary"},on:{click:e.fetchIOAlogin}},[e._v("通过IOA登录")])],1)]):e._e()])]),e.isWX&&!e.showLoginSuccess?s("div",{directives:[{name:"show",rawName:"v-show",value:"WECHAT"===e.loginPage,expression:'loginPage==="WECHAT"'}],staticClass:"content"},[s("div",{staticStyle:{"margin-top":"10%"},attrs:{id:"login_container"}})]):e._e()])},u=[],h=(s("ed08"),s("6df9")),p=s("db49"),m={data(){return{visible:!0,loginPage:"WECHAT",showIoaLogin:!1,avatarUrl:null,staffName:null,showLoginSuccess:!1}},computed:{isOA(){return p["a"].PASSPORT_OA_ENABLED},isWX(){return p["a"].PASSPORT_WX_ENABLED}},created(){this.isWX&&(window.modalLogin=this.fetchWxLogin),this.getIoaInfo(),this.isWX&&this.getScanCode()},asyncMethods:{fetchIOAlogin(){return y({method:"get",url:"passport/rio-login"}).then(e=>{e.data.result&&this.getLoginStatus()})},fetchWxLogin({code:e,state:t}){y({method:"get",url:"passport/wx-login",params:{code:e,state:t}}).then(e=>{e.data.result&&this.getLoginStatus()}).catch(e=>{console.log(e)})}},methods:{getLoginStatus(){y({method:"get",url:"passport/profile"}).then(e=>{window.AuthCache={},h["a"].commit("setUserInfo",e.data.result),this.showLoginSuccess=!0}).catch(e=>{console.log(e)})},getIoaInfo(){y({method:"get",url:"passport/rio-info"}).then(e=>{null!==e.data.result.staffname&&(this.showIoaLogin=!0,this.loginPage="OA",this.staffName=e.data.result.staffname,this.avatarUrl=`https://rhrc.woa.com/photo/150/${e.data.result.staffname}.png`)})},getScanCode(){const e=h["a"].getters.config.wx_app_id,t=window.location.origin+"/wx-callback";this.$nextTick(()=>{new WxLogin({self_redirect:!0,id:"login_container",appid:e,scope:"snsapi_login",redirect_uri:encodeURIComponent(t),state:Math.ceil(1e3*Math.random()),style:"black",href:"data:text/css;base64,LmltcG93ZXJCb3ggLnFyY29kZSB7d2lkdGg6IDIwMHB4O30NCi5pbXBvd2VyQm94IC50aXRsZSB7ZGlzcGxheTogbm9uZTt9DQouaW1wb3dlckJveCAuaW5mbyB7d2lkdGg6IDIwMHB4O30NCi5zdGF0dXNfaWNvbiB7ZGlzcGxheTpub25lfQ0KLmltcG93ZXJCb3ggLnN0YXR1cyB7dGV4dC1hbGlnbjogY2VudGVyO30="})})}}},g=m,b=(s("4f7c"),s("2be6")),f=Object(b["a"])(g,d,u,!1,null,"8b4a4940",null),v=f.exports;const y=a.a.create({timeout:6e4,transformResponse(e){const t=l.a.parse(e);return t}}),w=a.a.create({timeout:9e4,method:"post",maxRedirects:0,headers:{"X-Requested-With":"XMLHttpRequest"},transformResponse(e){let t={};try{t=l.a.parse(e)}catch(s){console.error("transformResponse error",e,s)}return t}});w.interceptors.request.use(e=>{const t={jsonrpc:"2.0",method:"noop",id:(new Date).getTime()+n.a.random(1e3,9999)};return e.data=Object.assign(t,e.data),e.url+="/"+e.data.method,e},e=>Promise.reject(e)),w.interceptors.response.use(e=>{if(n.a.has(e.data,"result"))return Promise.resolve(e);if(e.data.error){const{error:t}=e.data;return"string"===typeof t.message&&(t.message=t.message.replace("Exception:","")),Promise.reject(t)}return Promise.reject({message:"服务器内部错误：响应格式错误"})},e=>e.response&&401===e.response.status?(c["default"].prototype.$FastModal.show(v,{},{}),new Promise.reject(e)):e.message.includes("timeout")?Promise.reject({message:"网络超时"}):a.a.isCancel(e)?Promise.reject(e):Promise.reject({message:"服务器内部错误，请稍后重试"}));const x={},C=["api/report"],j=(e,t,s)=>{const i=new AbortController;let a="";return C.includes(e)&&(a=`${e}/${t}-${(new Date).getTime()}`,x[a]=i),w({url:e,data:{method:t,params:s},signal:null===i||void 0===i?void 0:i.signal}).then(({data:e})=>(a&&(null===x||void 0===x||delete x[a]),e.result)).catch(e=>(a&&(null===x||void 0===x||delete x[a]),"ERR_CANCELED"===(null===e||void 0===e?void 0:e.code)?(console.log(e),Promise.resolve(null)):Promise.reject(e)))},O=()=>{const e=Object.keys(x);e.length&&e.forEach(e=>{const t=x[e];t.signal.aborted||(t.abort(),console.log("已舍弃请求："+e))})},k=a.a.create({timeout:9e4,method:"post",maxRedirects:0,headers:{"X-Requested-With":"XMLHttpRequest"}}),A=(e,t,s,i)=>i?i.disabled&&i.instance?i.instance():A("qlabel.Dataset","IsGray",{method:t,...i.extra}).then(a=>a.is_gray?k({url:`${e}/${t}`,data:s}).then(({data:e})=>e):i.instance()).catch(e=>{var t,s;return console.error("请求失败",e.request.aegisUrl,e),e.request.aegisUrl.includes("IsGray")&&i.instance?i.instance():Promise.reject({...e,message:(null===(t=e.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||e.message})}):k({url:`${e}/${t}`,data:s}).then(({data:e})=>e);class S{post(e){const{method:t,url:s,params:i}=e;return w({url:s,data:{method:t,params:i}})}}a.a},df32:function(e,t,s){},df78:function(e,t,s){},e394:function(e,t,s){},e3fa:function(e,t,s){"use strict";s.d(t,"i",(function(){return a})),s.d(t,"r",(function(){return o})),s.d(t,"t",(function(){return n})),s.d(t,"z",(function(){return r})),s.d(t,"a",(function(){return l})),s.d(t,"u",(function(){return c})),s.d(t,"f",(function(){return d})),s.d(t,"h",(function(){return u})),s.d(t,"c",(function(){return h})),s.d(t,"k",(function(){return p})),s.d(t,"w",(function(){return m})),s.d(t,"s",(function(){return g})),s.d(t,"n",(function(){return b})),s.d(t,"y",(function(){return f})),s.d(t,"x",(function(){return v})),s.d(t,"d",(function(){return y})),s.d(t,"g",(function(){return w})),s.d(t,"l",(function(){return j})),s.d(t,"b",(function(){return O})),s.d(t,"m",(function(){return k})),s.d(t,"o",(function(){return x})),s.d(t,"e",(function(){return C})),s.d(t,"j",(function(){return A})),s.d(t,"v",(function(){return S})),s.d(t,"p",(function(){return _})),s.d(t,"q",(function(){return I})),s.d(t,"A",(function(){return $}));var i=s("dde5");const a=e=>Object(i["c"])("api/user","getCompany",e),o=e=>Object(i["c"])("api/role","listRoleUsers",e),n=e=>Object(i["c"])("api/user","listUsers",e),r=e=>Object(i["c"])("api/role","summarizeRoleUsers",e),l=e=>Object(i["c"])("api/role","addRoleUser",e),c=e=>Object(i["c"])("api/role","modifyRoleUserExpired",e),d=e=>Object(i["c"])("api/role","deleteRoleUser",e),u=e=>Object(i["c"])("api/user","listApplications",e),h=e=>Object(i["c"])("api/user","approveUser",e),p=e=>Object(i["c"])("api/user","inviteUser",e),m=e=>Object(i["c"])("api/user","refreshInviteCode",e),g=e=>Object(i["c"])("api/team","listTeams",e),b=e=>Object(i["c"])("api/company","listCompanySuppliers",e),f=e=>i["d"].post("passport/runAs",e),v=e=>i["d"].post("passport/releaseRunAs",e),y=e=>Object(i["c"])("api/user","changeTeamRole",e),w=e=>Object(i["c"])("api/user","deleteTeamUser",e),x=e=>Object(i["c"])("api/user","listJoinedTeam",e),C=e=>Object(i["c"])("api/user","deleteCompanyMember",e),j=e=>Object(i["c"])("api/secret","listApps",e),O=e=>Object(i["c"])("api/secret","applySecretKey",e),k=e=>Object(i["c"])("api/company","listCompanySupplier",e),A=e=>Object(i["c"])("api/role","getRole",e),S=e=>Object(i["c"])("api/role","modifyRoleUserProperties",e),_=e=>Object(i["c"])("api/role","listObjectRoles",e),I=e=>Object(i["c"])("api/role","listRoleUserGroups",e),$=e=>Object(i["c"])("api/role","unfreezeUser",e)},e634:function(e,t,s){"use strict";s("da33")},e64b:function(e,t,s){},e69a:function(e,t,s){"use strict";s("ccc5")},e7cb:function(e,t,s){"use strict";s("d1e5")},e839:function(e,t,s){},e8b1:function(e,t,s){},e97c:function(e,t,s){},e999:function(e,t,s){"use strict";s("81c6")},ea17:function(e,t,s){"use strict";s("9c14")},eafa:function(e,t,s){"use strict";s("4b72")},ecd5:function(e,t,s){},ecf8:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAshJREFUaEPtmEuojVEUx3//CZKxUhSZiFJuUmTghiiPGJhdynPC7EYpeUwkrlKiFArdiVJeYUAGIq7yLkNmMiAykYHlrNqntlv3nP19+37nnlPfntxuZ6+1/r+19l5770/0+FCP66cGmOgK1hWoK5CZgXoJZSYw27yjFTCzacBi4LWkn9nqobPngJk9BZY5AHBY0t1ciE5X4BMwOxJ9StKBHIiOArhQM7sE7IhEPwfWSfpeBqTjAAFiKXAZmBeJHpA0XBQiC8DMZgALgZnArKLBvSANm6OR3bCkgSJ+SgGY2SCwHVhQJFji3GOSYqiWZoUAzKwPOAmsHOXVW6J3lrJjRTAcATZJ+pLqKBnAzNYC9yPHvhmfhJ7+LjVgc56ZbQWuRnYnJB0s6icJwMz2AWcj59417hUNFom/DWwI/78B9kt6WMZfW4CwbJ4Bk4H3knzTlhpm5kvlcWR8BhiU9LeUw5ST2MyuA1tCgDmSPpcNZmYu3iE8675Zb5b11bRrWQEz807j/drHeUl7cwKamZ/C3gBuSPqR4ysV4BawEXgLLJH0ZzyCjqePMStgZtOBryHYOUm+kbtutAJYD9wJindJ8rbZdaMVwB7gQlDcJynnoKoMvBWAH+dHPLIaZ3tlCjIdtwLY2bikXezlCqwBHvTyHpgE+CVtCtB7Xcgzb2ZXgG2AX9aWS/qVuWTH3bzdSeynZvOSdU2Sw3TVaNtdGp9ChvzCFVSvkvSomwhSAKaGJTQ3CJ8v6WO3QLQFCHthUeNO9CoSfQg4Len3RIMkAQQIf7j7zXR1EO0n80vgAzAi6cVEwCQDBAhvrcejPdEJzf7+6B/rHVIIoKnWzLw77fYHeHipVQ2yeazHTymACMQr0l/yu5B/E/L4o/+OTsY3SfF7/L/fswCqTnuK/xogJUtVzqkrUGV2U3zXFUjJUpVz6gpUmd0U3/8AFu7DMX4jSWsAAAAASUVORK5CYII="},ed08:function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"b",(function(){return a})),s.d(t,"d",(function(){return o})),s.d(t,"a",(function(){return n}));const i=function(){let e;return function(t){return e||(e=document.createElement("a")),e.href=t,e.href}}();function a(e){const t={};for(const s in e)e[s]&&(t[s]=e[s]);return t}const o=e=>{const t={B:1,KB:1024,MB:1048576,GB:1073741824};return e<t.KB?"".concat(e," Bytes"):e>=t.KB&&e<t.MB?"".concat((e/t.KB).toFixed(2)," KB"):e>=t.MB&&e<t.GB?"".concat((e/t.MB).toFixed(2)," MB"):e>=t.GB?"".concat((e/t.GB).toFixed(2)," GB"):""},n=(e,t)=>{const s=new Set(e),i=new Set(t),a=[...i].filter(e=>!s.has(e)),o=[...s].filter(e=>!i.has(e)),n=0===o.length&&0===a.length;return{result:n,extra:o,missing:a,resultText:n?"":`导入数据列与模板定义列不一致，${o.length?`缺少【${o.join("、")}】字段`:""}${o.length&&a.length?"，":""}${a.length?`多余【${a.join("、")}】字段`:""}`}}},ed33:function(e,t,s){"use strict";s("0356")},ed85:function(e,t,s){e.exports=s.p+"static/img/pointOff.222120b8.svg"},efb2:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAABulJREFUaEPVWXvMV3Mcfh6bjdzDEilymRAiVOSeotxGCtGolvhDRtmaWea6kvuYXIYNKZFrUonKpVxHLMxl2CKX3JKZeXyfd9/z7vzOe37v75z37f31+my/7a1zzvd8nu/3c3k+zyH+58Z6+y/pAADHAlhBcl5r319XAJKuBHBNyuk/AbwMYAGA2SS/LQuobgAkbQPg5+jgdACbADgRwHYppy8leWsZEPUEMBTATO84SYdQg0k6EMBJ4e/J8b92I/lFURD1BOBdHwPgCpJTsg5KehLAaQBOJvlsewTwNYCdAfQm+U4OgM8A7A6gB8mV7QqApD0AfArgFwAdSSrtoCQDM8DVJDsVdd731SWEJI0DcBeAWSTPzNn9UQDuA/AgyfPbI4AkvseSdC5UmKQZAIYBOIfko+0KgCSf8u8ANgOQW2EkrQGwNYBOJFfXDYCkrULcXgRgIIDPAXinF5F0g0rK5CEAlgH4kmT3nN3fH8D7/pHsVcb5VuWApMEAHgFgEFl7FcD8+PN9VwGYTnJsDoDLANwUTmhqAD6xLgAkHRbbv7upqcAdADaOnfXUGA5ZX4aSfCIHwIvxBAeSfKnNAUjqAeD16GS1qnIEgCHx5/v/ANCVpGM9m8AOt00BdCC5rk0BSHKNdjx3AzCP5KBaL5Tk5vQ3Sdf5rPNHxxP8KeaS1/y11prp64X7gKTNAbwWEnU/AG+aEqeTtcxLUwlu6uDET5tP12E1l+TbtdYtA8Cx7h37EED/sjtVzRFJA+K6DjvnVtrcvSeTfKza84UASHo4lMlzXQpD6PQl+X2tnWnpdUmHhwLhnwGdENcZT/K2vDVrApCUxOlfgQ7vTdIg6mKSegN4C4DzonNekhcBkPAUO/0cAJe6hYHTfFwPFJJMrV3RBpN8IfvOIgBc681VTsk8vAqAF3wlVqQf2gKQpEmhx1znUZSkG2KF1QSQqhiOxyY7kFrtg9jcFhpUaytU6r2e3jwzzyd5fGsATAjNxpOUE/oGAMdEdcEvqEYnDGYByTdaejqStgDwmwkhyS1bA8A1+SAAI0iaAzWYpI0AmIQdFwG5grizps1JuCjupAF9UgaQJOebO/q+JD9KP1sohGI39chn257kj805ICk5HYMyG81akj8ODReEZvNH0gMAPOiMIum/G60ogDsBXBy1mzNK7p5DwGHmnwHtlXne46WbY0Och9BcnM0fSReGWeFuT20kLQwUBxD1nG/iQNKHpLlQi03SDhGIeZQB5c3ApuNJ4i6T5BB910BJmsqUAmAKfLrrf0hGDy7r1STtE0/HYeemmU1UJ7A5mKvgGpIdCwMI4+DVcRgxze1VNvlaglTSofFkfDpHZdZoQt9zcyAM2Y7T66PQ5DVKiU0tcTzvGUnjQ4m+JQxKywHc6wkwSyeaAJB0HoCH4oImbWeTNBOtu0m60UpemCcmkXTvaWIVACT52FwJbFaRp5D0NJVrsTrMIfldW6BLyS2jSd5fBIAHFcfgyKAguONWNUmJ1jkj5MZZbQTAFc99ZABJV6WaJ9Ag+ZFstj9IGh1j0rdXiFVhcrPCMDxUrX55Y2QZoJLc4Cy/d6u2VjaEEs2yezXeH+UU02pbhZaZaji+1pPkirTDsaOvIrm2FpA4wloQWxfU7A7V7s8CsH6f6PjjSCYfJBqej1r+Ei8apJRtAUwg6R33tXT+LAmJ74mq0SQl868ryYgCABLBy5+iehYFYOXsvVQzcQN5JtJoKxEmcV/FrmyKYKlwraQjATwf/9/vGkLS/06AuyybDFpevD3IK5dkwHntQSTvST1jfemp0H+eJum/cy2vjHqwNnXO64oesqeF8c4vGkZypiRzdH+sM9nbMcT/SpIeBRPnTR1cHOykx9Jd01UrUgvThM5+J0kPSD7RRLFzJXQpLQYgszOmxv6O1Sdycuugns76A/BnIMsfF8SZdY4T2spCGDwsjdiJLmabAPaM604LZfnyzDuWRjXC5bpLonakqtwYkpbeywPIe0LStYGTOASsE9lMrT2zOrGdG54XFkfnF3vHI4h+Qf/fJa0+S0p4ltep0EaDmGBC5zxqPJU8fwrR6SpA+sYX2HGDcZgk5i8x1kod89ZNHY4mgw6LJLTsvIXffwH8E0uln0uu+5PrTv4s1dzn1xYDyIKKQ4wpsgnYwfG6c2UuAIeXgZqi+PvYzUFOd2LOilWvYmBPjZE1e9J6A5CJa8/I7gNLM9wqfZuVBlNoVz4ndqOwKymZv5eTNDOoam0CIOd0uprRxoJgXm9xYHYUin272aapgpPffWhkXGM4ycc3OIAqOeTktuZZbYcnkpzanPO+VpcTaM6JGO+uNm6G7h+mGS63Df2glm1wALUcrHX9P9Y0mE96XDd1AAAAAElFTkSuQmCC"},f041:function(e,t,s){"use strict";s("0ca0")},f05f:function(e,t,s){"use strict";s("f60c")},f093:function(e,t,s){"use strict";s("e394")},f0dd:function(e,t,s){e.exports=s.p+"static/img/center.58e488fb.png"},f19c:function(e,t,s){"use strict";s("2d15")},f1ee:function(e,t,s){"use strict";s("3d81")},f2cf:function(e,t,s){"use strict";s("ba57")},f308:function(e,t,s){},f35e:function(e,t,s){"use strict";s("6e96")},f3a8:function(e,t,s){},f410:function(e,t,s){},f60c:function(e,t,s){},f618:function(e,t,s){"use strict";s("443e")},f6a5:function(e,t,s){"use strict";s("0ebb")},f6be:function(e,t,s){},f75f:function(e,t,s){},f8a4:function(e,t,s){"use strict";s("07b4")},f8bd:function(e,t,s){"use strict";s("28bd")},faa6:function(e,t,s){"use strict";s("9d3e")},fb76:function(e,t,s){"use strict";s("8e65")},fd0f:function(e,t,s){"use strict";s("39f9")},fd31:function(e,t,s){},fe3d:function(e,t,s){"use strict";s("a460")},ff1b:function(e,t,s){},ff86:function(e,t,s){},ffd0:function(e,t,s){"use strict";s.d(t,"h",(function(){return a})),s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return n})),s.d(t,"e",(function(){return r})),s.d(t,"d",(function(){return l})),s.d(t,"g",(function(){return c})),s.d(t,"f",(function(){return d})),s.d(t,"c",(function(){return u})),s.d(t,"i",(function(){return h}));var i=s("dde5");const a=e=>Object(i["c"])("api/attachment","listAttachments",e),o=e=>Object(i["c"])("api/attachment","addUpload",e),n=e=>Object(i["c"])("api/attachment","addLink",e),r=e=>Object(i["c"])("api/attachment","editAttachment",e),l=e=>Object(i["c"])("api/attachment","deleteAttachments",e),c=e=>Object(i["c"])("api/attachment","getUploadSecret",e),d=e=>Object(i["c"])("api/attachment","getAttachmentUrl",e),u=e=>Object(i["c"])("api/attachment","createBucket",e),h=e=>Object(i["c"])("api/attachment","overwriteAttachments",e)}});