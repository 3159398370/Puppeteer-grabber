(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["workbench-group"],{"037e":function(t,e,s){},"0465":function(t,e,s){"use strict";s("f31a")},"048d":function(t,e,s){"use strict";var a=s("312d"),i=s("9ec3");e["a"]={props:["value"],render(t){const{value:e}=this,s=Object(i["find"])(Object(i["values"])(a["g"]),{value:e});if(s)switch(e){case a["g"].WAIT_DELIVER.value:return t("Tag",{attrs:{color:"default"}},s.text);case a["g"].DELIVERED.value:return t("Tag",{attrs:{color:"success"}},s.text);default:return t("Tag",{props:{color:"default"}},s.text)}return t("Badge",{props:{}},"-")}}},"05fa":function(t,e,s){"use strict";s("b198")},"0689":function(t,e,s){},"07471":function(t,e,s){t.exports=s.p+"static/img/chrome.c978f2a2.svg"},"087d":function(t,e,s){},"0c372":function(t,e,s){"use strict";s("f7e3")},"0f4b":function(t,e,s){"use strict";s("ccb8")},"127e":function(t,e,s){},1351:function(t,e,s){"use strict";s("21d1")},1374:function(t,e,s){},1628:function(t,e,s){"use strict";s("3681")},"1ff2":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"z-result-wrapper"},[s("div",{staticClass:"z-result"},[s("div",{staticClass:"z-result__icon error"},[s("Icon",{attrs:{type:"ios-close",size:"70",color:"white"}})],1),s("div",{staticClass:"z-result__desc"},[t._v(t._s(t.message))])])])},i=[],l={props:{message:{type:String,default:"请求出错"}}},r=l,n=(s("1351"),s("2be6")),o=Object(n["a"])(r,a,i,!1,null,"4b9fffd7",null);e["a"]=o.exports},"21d1":function(t,e,s){},3681:function(t,e,s){},"36d2":function(t,e,s){"use strict";s("92f5")},"38e7":function(t,e,s){},3998:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",{staticStyle:{flex:"1",height:"100vh"}},[s("div",{staticClass:"z-header z-level"},[s("div",{staticClass:"z-level__left"},[s("Row",{staticClass:"z-header__logo z-header__item",attrs:{type:"flex",justify:"start"}},[s("div",{on:{click:function(e){return t.$router.push("/")}}},[s("Icon",{staticStyle:{"margin-right":"20px",cursor:"pointer","font-size":"24px"},attrs:{type:"ios-home"}})],1),s("b",[t._v(t._s(t.title)+"工作台:"),t.task?s("span",[t._v(t._s(t.task.task_name))]):t._e()])])],1)]),s("div",{staticClass:"z-main"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.fetchObject.isPending,expression:"fetchObject.isPending"}],staticClass:"z-result"},[s("div",{staticClass:"z-result__icon"},[s("Spin",{attrs:{size:"large"}},[s("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"50"}})],1)],1),s("div",{staticClass:"z-result__title"},[t._v("领取待"+t._s(t.title)+"题目")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.fetchObject.isResolved,expression:"fetchObject.isResolved"}],staticClass:"z-result"},[s("div",{staticClass:"z-result__icon success"},[s("Icon",{attrs:{type:"ios-checkmark",size:"70",color:"white"}})],1),["复检"].includes(t.title)?s("div",{staticClass:"z-result__title"},[t._v("没有可领取的题目了")]):s("div",{staticClass:"z-result__title"},[t._v("没有待"+t._s(t.title)+"的题目了")]),s("div",{staticClass:"z-result__extra"},[s("div",{staticClass:"links"},[s("a",{attrs:{href:"javascript:;"},on:{click:t.tryAgain}},[t._v("重试")])])])]),t.fetchObject.isRejected?s("div",{staticClass:"z-result"},[t.errorData?[s("LimitErrorPage",{attrs:{errorData:t.errorData}})]:[s("div",{staticClass:"z-result__icon error"},[s("Icon",{attrs:{type:"ios-close",size:"70",color:"white"}})],1),s("div",{staticClass:"z-result__title"},[t._v("领取失败")]),s("div",{staticClass:"z-result__desc"},[t._v(t._s(t.fetchObject.rejectedWith.message))]),s("div",{staticClass:"z-result__extra"},[s("div",{staticClass:"links"},[s("a",{attrs:{href:"javascript:;"},on:{click:t.tryAgain}},[t._v("重试")])])])]],2):t._e()])])},i=[],l=s("dde5"),r=s("4304"),n={components:{LimitErrorPage:r["a"]},props:{errorData:null,title:String,taskId:[String,Object],fetchObject:[Object,Function]},created(){this.fetchTask()},methods:{tryAgain(){this.$emit("try-again")}},asyncMethods:{fetchTask(){const t={task_id:this.taskId};return Object(l["c"])("api/workbench","getTask",t).then(t=>t)}}},o=n,c=(s("fe6f"),s("2be6")),d=Object(c["a"])(o,a,i,!1,null,"d0f531c4",null);e["a"]=d.exports},"3c61":function(t,e,s){"use strict";s("d4e2")},"47a5":function(t,e,s){"use strict";s("087d")},"4b94":function(t,e,s){},"54ef":function(t,e,s){},"55ba":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TableFilter",{on:{search:function(e){return t.fetchReviewDelivers(t.page.index=1)},reset:function(e){return t.reset(t.page.index=1)}}},[s("Form",{ref:"form",attrs:{inline:"","label-width":100,"label-colon":!0}},[s("Row",{attrs:{gutter:20}},[s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"批次ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入批次ID进行搜索"},model:{value:t.form.deliver_id,callback:function(e){t.$set(t.form,"deliver_id",e)},expression:"form.deliver_id"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"批次名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入批次名称进行搜索"},model:{value:t.form.deliver_name,callback:function(e){t.$set(t.form,"deliver_name",e)},expression:"form.deliver_name"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"所属任务ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入所属任务ID进行搜索"},model:{value:t.form.task_id,callback:function(e){t.$set(t.form,"task_id",e)},expression:"form.task_id"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"所属任务名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入所属任务名称进行搜索"},model:{value:t.form.task_name,callback:function(e){t.$set(t.form,"task_name",e)},expression:"form.task_name"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"批次状态"}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:t.form.deliver_status,callback:function(e){t.$set(t.form,"deliver_status",e)},expression:"form.deliver_status"}},[t._l(t.batchStatus,(function(e,a){return[e.value<40?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()]}))],2)],1)],1)],1)],1)],1),s("Alert",{attrs:{"show-icon":""}},[t._v("质检任务已调整为按批次进行质检， 仅显示当前可质检的批次。")]),s("Table",{ref:"reviewDelivers",attrs:{columns:t.columns,data:t.reviewDelivers,loading:t.fetchReviewDelivers.isPending},on:{"on-sort-change":t.sortSearch},scopedSlots:t._u([{key:"task_name",fn:function(e){var a=e.row;return[s("span",{staticClass:"mrs"},[t._v(t._s(a.task_name))]),a.cross_num>=2?s("span",{staticClass:"txt-muted"},[t._v("("+t._s(a.cross_num)+"人交叉)")]):t._e()]}},{key:"status",fn:function(t){var e=t.row;return[s("BatchStatusRender",{attrs:{value:e.status}})]}},{key:"wait_add_check_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatCheckTask.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.wait_add_check_num):"-"))])]}},{key:"check_wait_review_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatCheckTask.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.check_wait_review_num):"-"))])]}},{key:"wait_re_review_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatCheckTask.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.wait_re_review_num):"-"))])]}},{key:"my_wait_re_review_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatCheckTask.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.my_wait_re_review_num):"-"))])]}},{key:"my_reviewing_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatCheckTask.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.my_reviewing_num):"-"))])]}},{key:"my_checked_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatCheckTask.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.my_checked_num):"-"))])]}},{key:"action",fn:function(e){var a=e.row;return[a.accessible?s("div",[s("a",{on:{click:function(e){return t.getTaskDetailList(a)}}},[t._v("详情")]),s("auth-view",{attrs:{perm:{domain:"task",action:"queue-review",extra:{team:a.team_id}}}},[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.toReview(a)}}},[t._v("抽检")])],1)],1):s("a",{attrs:{disabled:""}},[t._v("安全策略不可操作")])]}}])}),s("Row",{staticClass:"mtm mbm",attrs:{type:"flex",justify:"space-between"}},[s("div"),s("Page",{attrs:{current:t.page.index,total:t.page.total,"page-size":t.page.size,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}})],1)],1)},i=[],l=s("9ec3"),r=s("864c"),n=s("bc94"),o=s("a638"),c=s("312d"),d=s("c605"),u={components:{BatchStatusRender:o["a"],TableFilter:d["a"]},data(){return{batchStatus:c["b"],form:{deliver_id:"",deliver_name:"",task_id:"",task_name:"",deliver_status:""},task_id:"",task_status:"",task_name:"",task_type:"",task_sort:[["a.created_at","desc"]],page:{index:1,size:10,total:0},columns:[{title:"批次ID",key:"deliver_id",width:180},{title:"批次名称",key:"deliver_name",minWidth:150},{title:"所属任务ID",key:"task_id",width:180},{title:"所属任务",slot:"task_name",minWidth:150},{title:"批次状态",slot:"status",align:"middle",width:95},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","未抽检"),t("Tooltip",{props:{content:"批次中未被抽检任务抽取的数据",transfer:!0,placement:"top",maxWidth:"350"}},[t("Icon",{props:{type:"ios-help-circle"},style:{marginLeft:"3px"}})])]),slot:"wait_add_check_num",align:"right",width:110},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","未领取"),t("Tooltip",{props:{content:"抽检任务中可领取质检的数据",transfer:!0,placement:"top",maxWidth:"300"}},[t("Icon",{props:{type:"ios-help-circle"},style:{marginLeft:"3px"}})])]),slot:"check_wait_review_num",align:"right",width:110},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","未复检"),t("Tooltip",{props:{content:"批次中返修后需要复检的数据",transfer:!0,placement:"top",maxWidth:"300"}},[t("Icon",{props:{type:"ios-help-circle"},style:{marginLeft:"3px"}})])]),slot:"wait_re_review_num",align:"right",width:100},{title:"我的抽检",align:"center",children:[{title:"待复检",slot:"my_wait_re_review_num",align:"center",width:80},{title:"质检中",slot:"my_reviewing_num",align:"center",width:80},{title:"已完成",slot:"my_checked_num",align:"center",width:80}]},{title:"执行小组",key:"team_name",minWidth:100},{title:"操作",slot:"action",align:"center",minWidth:130}],reviewDelivers:[],statLoading:-1}},created(){this.fetchReviewDelivers()},asyncMethods:{fetchReviewDelivers(){const t={page:{start:(this.page.index-1)*this.page.size,size:this.page.size,return_total:1}};return Object(l["forIn"])(this.form,(e,s)=>{e&&(t[s]=e)}),r["a"].ListMyDeliverTasks(t).then(t=>(this.page.total=t.data.result.total,this.mapStatCheckTask(t.data.result.data),t.data.result.data)).catch(t=>{console.log(t)})},fetchStatCheckTask(t,e,s){const a={task_id:t,deliver_id:e,team_id:s,stat_my_count:1,stat_scene:"deliver",stat_scope:"deliver-list"};return Object(n["q"])(a).then(t=>t).catch(t=>{console.log(t)})}},methods:{async mapStatCheckTask(t){for(let e=0;e<t.length;e++){this.statLoading=e;const s=t[e],a=await this.fetchStatCheckTask(s.task_id,s.deliver_id,s.team_id);if(a&&(this.statLoading=-1,this.$set(t[e],"check_stats_data",a)),"wb-tasks-review"!==this.$route.name)return}},sortSearch(t){"normal"!==t.order?this.task_sort=[["detail.pending_num",t.order]]:this.task_sort=[["a.created_at","desc"]],this.fetchReviewDelivers()},reset(){Object(l["forIn"])(this.form,(t,e)=>{this.form[e]=""}),this.fetchReviewDelivers()},changePage(t){this.page.index=t,this.fetchReviewDelivers()},getTaskDetailList(t){this.$router.push(`/workbench/review-tasks/${t.task_id}/${t.deliver_id}`)},toReview(t){this.$router.push({name:"wb-extract-review-task",params:{task_id:t.task_id,deliver_id:t.deliver_id},query:{team_id:t.team_id}})}}},h=u,_=(s("bd19"),s("2be6")),m=Object(_["a"])(h,a,i,!1,null,"7845ba37",null);e["default"]=m.exports},5720:function(t,e,s){"use strict";s("5f0a")},"597a":function(t,e,s){"use strict";s("8d0d"),s("f38f");var a=s("9ec3"),i=s.n(a),l=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[t._v(t._s(t.curTotalTime))])},r=[],n=s("050d"),o=s.n(n);const c=t=>{let e=[t.hours(),t.minutes(),t.seconds()];return 0===e[0]&&e.splice(0,1),e=Object(a["map"])(e,t=>Object(a["padStart"])(t,2,"0")),e.join(":")};var d={props:{initPausing:Boolean,startTime:String,systemTime:String,isCalcLastTime:Boolean,startTotalTime:{type:Number,default:0}},data(){const t=15e3;return{lastTimer:null,totalTimer:null,isPause:!1,lastTimeEnd:!1,jetLag:o()().diff(this.systemTime),totalTime:this.startTotalTime,reportTime:this.startTotalTime-t,reportInterval:t,curTotalTime:c(o.a.duration(this.startTotalTime))}},mounted(){var t,e,s,a;this.$EventBus.$on("counter-totalTimer-play",()=>{this.play()}),this.$EventBus.$on("counter-totalTimer-pause",()=>{this.pause()}),this.$EventBus.$on("counter-lastTime-clear",()=>{this.lastTimeEnd=!0,clearTimeout(this.lastTimer)}),this.isCalcLastTime&&this.calcTimeout(),!this.initPausing&&this.play();const i=null===(t=/Chrome\/([0-9.]+)/.exec(null===(s=window)||void 0===s||null===(a=s.navigator)||void 0===a?void 0:a.userAgent))||void 0===t||null===(e=t[1])||void 0===e?void 0:e.split(".")[0];if(i&&parseInt(i,10)>=88){var l;const t=document.createElement("video"),e=document.createElement("canvas");t.setAttribute("style","display:none"),t.setAttribute("muted",""),t.muted=!0,t.setAttribute("autoplay",""),t.autoplay=!0,t.setAttribute("playsinline",""),e.setAttribute("style","display:none"),e.setAttribute("width","1"),e.setAttribute("height","1"),null===(l=e.getContext("2d"))||void 0===l||l.fillRect(0,0,1,1),t.srcObject=null===e||void 0===e?void 0:e.captureStream()}},beforeDestroy(){clearTimeout(this.lastTimer),clearTimeout(this.totalTimer),this.$EventBus.$off("counter-totalTimer-play"),this.$EventBus.$off("counter-totalTimer-pause"),this.$EventBus.$off("counter-lastTime-clear")},methods:{calcTimeout(){if(this.lastTimeEnd)return;const t=()=>{const t=o()().diff(this.startTime)-this.jetLag;this.$EventBus.$emit("updateDuration",t)};t(),this.lastTimer=setTimeout(()=>{t(),this.calcTimeout()},1e3)},calcTotalTime(){this.isPause||(this.totalTimer=setTimeout(()=>{this.totalTime=this.totalTime+1e3,this.curTotalTime=c(o.a.duration(this.totalTime)),this.reportTime&&this.totalTime-this.reportTime>=this.reportInterval&&(this.$EventBus.$emit("reportHeartbeat"),this.reportTime=this.totalTime),this.calcTotalTime()},1e3))},play(){this.isPause=!1,this.calcTotalTime()},pause(){this.isPause=!0,clearTimeout(this.totalTimer)}}},u=d,h=s("2be6"),_=Object(h["a"])(u,l,r,!1,null,null,null),m=_.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Drawer",{attrs:{placement:"left",closable:!0,title:"查看历史",mask:!1,width:"300px"},on:{"on-close":function(e){return t.$emit("update:visible",!1)}},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[s("Tabs",{model:{value:t.logTab,callback:function(e){t.logTab=e},expression:"logTab"}},[s("TabPane",{attrs:{label:"日志",name:"log"}},[t.loading?s("Spin",{attrs:{fix:""}}):t._e(),"log"===t.logTab?s("div",{staticStyle:{overflow:"auto"}},[s("Timeline",t._l(t.flowLogs&&t.flowLogs.data,(function(e){return s("TimelineItem",{key:String(e.flow_log_id)},[s("p",{staticClass:"item",staticStyle:{"font-size":"12px"}},[s("span",[t._v(t._s(e.flow_handle_at)+" ")]),s("span",[t._v(t._s(e.nick_name))])]),s("div",{staticClass:"content",staticStyle:{"font-size":"12px"}},["REJECT_REVIEW"!==e.flow_action?s("p",[s("span",[t._v(t._s(e.flow_action_text))]),"PRE_AUTO_VALIDATE"===e.flow_action?s("span",[t._v("（"+t._s(JSON.parse(e.flow_extra).autoValidatorAccepted?"返回修改":"确认无误")+"）")]):t._e()]):s("p",[4===JSON.parse(e.flow_extra).reviewType?s("span",[t._v("批量驳回")]):s("span",[t._v("质检驳回")])]),t.flowActions.includes(e.flow_action)?s("p",{staticClass:"txt-red"},[t._v("原因："+t._s(e.flow_remark||"-"))]):t._e()])])})),1)],1):t._e()],1),s("TabPane",{attrs:{label:"版本",name:"version"}},[t.fetchLabelVersion.isPending?s("Spin",{attrs:{fix:""}}):t._e(),"version"===t.logTab?s("div",{staticStyle:{overflow:"auto"}},[t.labelVersion&&t.labelVersion.length>0?s("Collapse",{staticClass:"version",attrs:{value:t.openVersion,simple:""}},t._l(t.labelVersion,(function(e){return s("Panel",{key:e.version_id.toString(),class:t.activeVersion===e.version_id.toString()&&"active-version",attrs:{name:e.version_id.toString()},nativeOn:{click:function(s){return t.changeVersion(e)}},scopedSlots:t._u([{key:"content",fn:function(){return[s("small",{staticClass:"txt-muted"},[s("p",{staticClass:"mbm"},[t._v(t._s(e.date_time)+" ｜ "+t._s(e.operator))]),e.items&&e.items.length>0?s("ul",{staticClass:"mlb"},t._l(e.items,(function(e){return s("li",{staticClass:"mbm"},[s("p",[t._v(t._s(e.tag_name))]),s("p",[t._v(t._s(e.date_time)+" ｜ "+t._s(e.operator))]),"PASS_REVIEW"===e.action?s("p",{staticClass:"txt-green"},[t._v("质检通过")]):t._e(),"REJECT_REVIEW"===e.action?s("p",{staticClass:"txt-red"},[s("span",[t._v("质检不通过")]),e.remark?s("span",[t._v("（"+t._s(e.remark)+"）")]):t._e()]):t._e(),"EDIT_REVIEW"===e.action?s("p",{staticClass:"txt-orange"},[s("span",[t._v("修改通过")]),e.remark?s("span",[t._v("（"+t._s(e.remark)+"）")]):t._e()]):t._e()])})),0):t._e()])]},proxy:!0}],null,!0)},[s("b",[t._v(t._s(e.tag_name))])])})),1):s("span",{staticClass:"txt-muted txt-center"},[t._v("暂无数据")])],1):t._e()],1)],1)],1)},p=[],k=s("bc94"),f={props:{task:Object,flowLogs:[Object,Array],visible:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},data(){return{modal:this.visible,logTab:"log",flowActions:["REJECT_REVIEW","REJECT_APPROVE","EDIT_REVIEW"],activeVersion:"",openVersion:""}},computed:{userInfo(){return this.$store.state.userinfo},detailId(){var t;return this.flowLogs&&this.flowLogs.data&&(null===(t=this.flowLogs.data[0])||void 0===t?void 0:t.flow_code)||""}},watch:{visible(){this.modal=this.visible},detailId(t,e){t&&t.toString()!==e.toString()&&this.fetchLabelVersion(t)}},methods:{changeVersion(t){var e;const s=null===t||void 0===t||null===(e=t.version_id)||void 0===e?void 0:e.toString();this.activeVersion!==s&&(this.activeVersion=s,this.openVersion=s,this.$emit("onViewLabelVersion",{...t,version_id:s}),this.$router.replace({query:{...this.$route.query,version_id:s.toString()}}))},resetVersion(){var t;const e=this.labelVersion[0],s=null===e||void 0===e||null===(t=e.version_id)||void 0===t?void 0:t.toString();this.activeVersion=s,this.openVersion=s,this.$emit("onViewLabelVersion",!1),this.$emit("update:visible",!1),this.$router.replace({query:{...this.$route.query,version_id:void 0}})}},asyncMethods:{fetchLabelVersion(t){const e={task_id:this.task.task_id,detail_id:t};return Object(k["e"])(e).then(t=>{if((null===t||void 0===t?void 0:t.length)>0){var e;const s=t[0].version_id.toString();if(this.activeVersion=s,this.openVersion=s,null!==(e=this.$route.query)&&void 0!==e&&e.version_id){const e=t.find(t=>t.version_id.toString()===this.$route.query.version_id.toString());e?this.changeVersion(e):this.$Message.error("未找到对应标注版本")}}return t}).catch(t=>{console.log(t)})}}},b=f,g=(s("b6b8"),s("f5dd"),Object(h["a"])(b,v,p,!1,null,"0897ee33",null)),y=g.exports,w=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"z-level__left"},[s("div",{staticClass:"z-level__item z-header__back",on:{click:function(e){return t.$router.push("/")}}},[s("Icon",{staticStyle:{cursor:"pointer","font-size":"24px"},attrs:{type:"ios-home"}})],1),s("div",{staticClass:"z-level__item z-header__logo"},[s("b",[t._v(t._s(t.taskType||"")+"任务："+t._s(t.detail.task_name||"-")),t.detail.task_id?s("auth-view",{attrs:{perm:{domain:"task",action:"view"}},scopedSlots:t._u([{key:"forbidden",fn:function(){return[s("span",[t._v("("+t._s(t.detail.task_id)+")")])]},proxy:!0}],null,!1,380872753)},[s("t-link",{staticClass:"task-detail-href",attrs:{theme:"primary",hover:"underline",href:t.taskDetailHref,target:"_blank"}},[t._v("("+t._s(t.detail.task_id)+")")])],1):t._e(),t._t("time-out")],2),t.packKey||t.packId?s("p",{staticClass:"mrm mts",staticStyle:{"font-size":"14px"}},[s("span",{staticClass:"mrm"},[t._v("题包Key："+t._s(t.detail.pack_key||"-"))]),t.isPageDetails?s("span",[t._v("共 "+t._s(t.detailLength)+" 题")]):[t.isCrossNum?s("span",[t._v("题目ID: "+t._s(t.detail.dataset_item_id)),s("small",{staticClass:"txt-muted mls"},[t._v("("+t._s(t.statTask.cross_num)+"人交叉)")])]):s("span",[t._v("任务明细ID: "+t._s(t.detail.detail_id>2?t.detail.detail_id:"-"))])]],2):t._e(),t.packKey||t.packId||!t.isPageDetails?t._e():s("p",{staticClass:"mrm mts",staticStyle:{"font-size":"14px"}},[s("span",[t._v("共 "+t._s(t.detailLength)+" 题")])]),t.detailId?s("p",{staticClass:"mrm mts",staticStyle:{"font-size":"14px"}},[s("span",[t._v("任务明细ID: "+t._s(t.detail.detail_id))])]):t._e()])])},C=[],S=s("51cc"),T=s("312d"),I={props:["value"],render(t){const{value:e}=this,s=Object(a["find"])(Object(a["values"])(T["q"]),{value:e});if(s)switch(e){case T["q"].INIT.value:return t("span",s.text);case T["q"].WAIT_REVIEW.value:return t("Tag",{attrs:{color:"default"}},s.text);case T["q"].REVIEWING.value:return t("Tag",{attrs:{color:"blue"}},s.text);case T["q"].REVIEWED.value:return t("Tag",{attrs:{color:"success"}},s.text);case T["q"].REJECT_REVIEW.value:return t("Tag",{attrs:{color:"error"}},s.text);default:return t("Tag",{props:{color:"default"}},s.text)}return t("Badge",{props:{}},"-")}},$={components:{LabelStatusRender:S["a"],ReviewStatusRender:I},props:{detailLength:Number,detail:{type:Object,default:()=>({})},taskType:String,statTask:{type:Object,default:()=>({})}},data(){const{pack_key:t,pack_id:e,detail_id:s}=this.$route.params;return{userinfo:this.$store.state.userinfo.user,diff:0,packKey:"0"===t?0:t,packId:"0"===e?0:e,detailId:s}},computed:{isCrossNum(){var t;return null===(t=this.statTask)||void 0===t?void 0:t.cross_num},isPageDetails(){return this.detailLength>1},taskDetailHref(){const t=this.$router.resolve({name:"task",params:{id:this.detail.project_id,taskId:this.detail.task_id},query:{tab:"info"}});return t.href}}},x=$,D=(s("3c61"),Object(h["a"])(x,w,C,!1,null,"9cef8d1a",null)),L=D.exports,R=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"time-out"},[s("span",{staticClass:"mlm"},[t._v("剩余时间：")]),s("span",{staticStyle:{color:"#f7a205"}},[t._v(t._s(t.lastTime))])])},P=[],j={props:{siteTimeout:{type:Number,default:0},handleTimeout:{type:String,default:"return"},isFetchReturn:{type:Boolean,default:!1}},data(){return{diff:0}},computed:{lastTime(){if(!this.siteTimeout)return 0;const t=6e4*this.siteTimeout-this.diff,e=o.a.duration(t+1e3),s=24*e.days()+e.hours();if(t>0&&Math.round(t/1e3))return`${s||""}${s?"小时":""}${e.minutes()}分钟${e.seconds()}秒`;switch(this.handleTimeout){case"return":!this.isFetchReturn&&this.$emit("returnDetail","time-out");break;case"close":!this.isFetchReturn&&this.$emit("handlePauseOrResume","关闭");break}return 0}},created(){this.$EventBus.$on("updateDuration",t=>{this.diff=t})},destroyed(){this.$EventBus.$off("updateDuration")}},O=j,F=Object(h["a"])(O,R,P,!1,null,null,null),E=F.exports,A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"header-count"},[t.isAction?[t.isKeywordHighlight?a("div",{staticClass:"z-level__item"},[a("keyword-highlight")],1):t._e(),a("div",{staticClass:"z-level__item"},[a("Tooltip",{attrs:{content:"已处理/总量"}},[a("div",{staticClass:"middle"},[a("Icon",{attrs:{type:"ios-pie-outline",size:"20"}}),t._v(t._s(t.countInfo.actionNum||0)+"/"+t._s(t.countInfo.totalNum||0))],1)])],1),a("div",{staticClass:"z-level__item"},[a("Tooltip",{attrs:{content:"个人"+(t.isFormLabel?"标注":"质检")+"完成量"}},[a("div",{staticClass:"middle"},[a("Icon",{attrs:{type:"ios-checkbox-outline",size:"20"}}),t._v(t._s(t.isFormLabel?t.userLabeledNum:t.myReviewedNum))],1)])],1),t.detail?a("div",{staticClass:"z-level__item"},[a("Tooltip",{attrs:{content:"用时"}},[a("div",{staticClass:"middle"},[a("Icon",{attrs:{type:"ios-clock-outline",size:"20"}}),a("Counter",{ref:"label-counter",attrs:{initPausing:t.detail.pause,startTotalTime:t.detail.time_used,"start-time":t.detail.detail_assign_at,"system-time":t.detail.system_date,isCalcLastTime:Boolean(t.countInfo.timeout)}})],1)])],1):t._e(),a("div",{staticClass:"z-level__item"},[a("Tooltip",{attrs:{content:"点击暂停答题，并新开页面浏览答题记录","max-width":"500"}},[a("div",{staticClass:"middle hover-hand",on:{click:t.getDetailPath}},[a("Icon",{attrs:{type:"ios-paper-outline",size:"20"}}),t._v("答题记录")],1)])],1)]:t._e(),t._t("center"),t._t("returnBtn"),t.isAction?[a("div",{staticClass:"z-level__item"},[a("Tooltip",{attrs:{placement:"bottom-end",content:"关闭页面并自动暂停计时"}},[a("div",{staticClass:"middle",on:{click:t.handleClose}},[a("Icon",{attrs:{type:"ios-close-circle-outline",size:"20",color:"#ed4014"}}),a("span",{staticStyle:{color:"#ed4014"}},[t._v("结束做题")])],1)])],1)]:t._e(),a("div",{staticClass:"z-level__item"},[a("t-tooltip",{attrs:{"show-arrow":"",theme:"light"},scopedSlots:t._u([{key:"content",fn:function(){return[a("div",[a("t-list",{attrs:{size:"small"}},[a("t-list-item",[t._v("请使用chrome 、edge浏览器访问体验最佳")]),a("t-list-item",[a("t-link",{attrs:{theme:"primary",underline:"",href:"https://www.google.com/intl/zh-CN/chrome/",target:"_blank"}},[t._v("1. chrome (如无法下载，请联系标管人员提供或下载edge)")])],1),a("t-list-item",[a("t-link",{attrs:{theme:"primary",underline:"",href:"https://www.microsoft.com/zh-cn/edge/download",target:"_blank"}},[t._v("2. edge")])],1)],1)],1)]},proxy:!0}])},[a("div",{staticClass:"middle download-chrome"},[a("Icon",{attrs:{type:"ios-cloud-download-outline",size:"20"}}),a("img",{staticStyle:{width:"18px"},attrs:{src:s("07471")}})],1)])],1)],2)},M=[],N=s("864c"),B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"keyword-highlight"},[s("Tooltip",{attrs:{content:"关键词高亮"+(t.isKeywordHighlight?"已开启":"已关闭")}},[s("div",{staticClass:"middle",on:{click:function(e){return t.onChangeKeywordHighlight(!t.isKeywordHighlight)}}},[s("Icon",{attrs:{type:"md-bulb",size:"22",color:t.isKeywordHighlight?"gold":"grey"}}),s("div",{staticClass:"pointer"},[t._v("关键词")])],1)])],1)},z=[],V={data(){let t=!0;const e=localStorage.getItem("optimus-keyword-highlight");return e&&(t=JSON.parse(e)),{isKeywordHighlight:t}},methods:{onChangeKeywordHighlight(t){localStorage.setItem("optimus-keyword-highlight",t),this.$EventBus.$emit("optimus-keyword-highlight",t),this.isKeywordHighlight=t}}},q=V,U=(s("bc58"),Object(h["a"])(q,B,z,!1,null,"b88ab71c",null)),W=U.exports,J={components:{Counter:m,KeywordHighlight:W},beforeRouteEnter(t,e,s){s(t=>{"wb-label-countInfo-detail"!==e.name&&"wb-review-countInfo-detail"!==e.name||(localStorage.setItem("isShowShortCut",!1),t.isShowShortCut=!0===localStorage.getItem("isShowShortCut"))})},props:{isAction:Boolean,countInfo:Object,detail:Object,teamId:[Number,String]},data(){const{task_id:t}=this.$route.params;return{taskId:t,isFormLabel:this.$route.name.includes("label")}},computed:{isKeywordHighlight(){var t,e,s,a,i,l;return(null===(t=this.countInfo)||void 0===t||null===(e=t.templateComponent)||void 0===e||null===(s=e.$keyword_highlight)||void 0===s?void 0:s.open)||(null===(a=this.countInfo)||void 0===a||null===(i=a.templateComponent)||void 0===i||null===(l=i.attributes)||void 0===l?void 0:l.isKeywordHighlight)},userLabeledNum(){var t;return(null===(t=this.countInfo)||void 0===t?void 0:t.userLabeledNum)||0}},created(){this.isFormLabel?this.fetchMyLabeledNum():this.fetchMyReviewedNum()},methods:{handleClose(){this.$emit("handlePauseOrResume","关闭")},async getDetailPath(){var t,e;if(await this.fetchMyLabelLogDates(),!this.myLabelLogDates)return void this.$Message.warning("暂无答题记录");this.$emit("handlePauseOrResume","暂停");const s=this.myLabelLogDates,i=this.isFormLabel?{pack_key:s.pack_key||0}:{check_id:null!==(t=s.check_id)&&void 0!==t?t:0,pack_id:s.pack_key||0,dataset_id:0};let l={};l={type:"page",from:this.isFormLabel?"label":"review",scenes:this.isFormLabel?"label_again":"review_again",page_index:1,row_id:s.detail_id,deliver_id:null!==(e=this.detail)&&void 0!==e&&e.deliver_id?this.detail.deliver_id:Object(a["noop"])()};const r=this.$router.resolve({name:this.isFormLabel?"wb-task-label-detail":"wb-task-review-detail",params:{task_id:this.taskId,...i||{}},query:{team_id:this.teamId,...l||{}}});window.open(r.href,"_blank")}},asyncMethods:{fetchMyLabeledNum(){return Promise.resolve(0)},fetchMyReviewedNum(){var t,e,s,a,i;if(!["review","re_review"].includes(null===(t=this.$route)||void 0===t||null===(e=t.query)||void 0===e?void 0:e.scenes))return Promise.resolve(0);if(null===(s=this.detail)||void 0===s||!s.deliver_id)return Promise.resolve(0);const{scenes:l}=this.$route.query;if(!l||!["review"].includes(l))return Promise.resolve(0);const r={task_id:this.taskId,deliver_id:null===(a=this.detail)||void 0===a?void 0:a.deliver_id,check_id:null===(i=this.detail)||void 0===i?void 0:i.check_id,stat_scene:"check",stat_scope:"check"};return Object(k["r"])(r).then(t=>t.my_checked_num)},fetchMyLabelLogDates(){var t;const e={task_id:this.taskId,page:{start:0,size:1,return_total:0}};return this.isFormLabel?N["a"].ListMyLabelDetailLog(e).then(t=>{const e=t.data.result;return e.data[0]}).catch(t=>{console.log(t),this.$Message.error(t.message)}):(e.deliver_id=null===(t=this.detail)||void 0===t?void 0:t.deliver_id,N["a"].ListMyReviewDetailLog(e).then(t=>{const e=t.data.result;return e.data[0]}).catch(t=>{console.log(t),this.$Message.error(t.message)}))}}},H=J,K=(s("fd69"),Object(h["a"])(H,A,M,!1,null,"0b2bf66b",null)),G=K.exports,Q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"review_remark"},[s("Modal",{attrs:{draggable:"",sticky:"",scrollable:"",mask:t.mask,closable:!1,"mask-closable":!1,transfer:!1},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[t.isBatch?s("template",{slot:"header"},["reset"===t.type?s("span",[t._v("批量驳回")]):s("span",[t._v("批量修改")])]):s("template",{slot:"header"},["reset"===t.type?s("span",[t._v("质检不通过")]):[s("span",[t._v("提交修改")]),t.isReview?s("span",[t._v("并继续质检下一题")]):t._e()]],2),s("Input",{ref:"remarkInput",attrs:{type:"textarea",autosize:{minRows:5,maxRows:10},placeholder:"reset"===t.type?"请填写质检不通过的原因":"可在此处备注原标注错误信息和质检修改点"},on:{"hook:mounted":function(e){return t.focus("remarkInput")}},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}}),s("p",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:t.closeModal}},[t._v("取消")]),"reset"===t.type?s("Button",{attrs:{type:"primary"},on:{click:function(e){return t.submit(0)}}},[t._v("确认不通过")]):s("Button",{attrs:{type:"primary"},on:{click:function(e){return t.submit(2)}}},[t._v("确认")])],1)],2)],1)},Y=[],X={props:{isBatch:{type:Boolean,default:!1},mask:Boolean,visible:Boolean,currentDetail:Object,isReview:{type:Boolean,default:!1},type:String},data(){var t;return{modal:this.visible,remark:(null===(t=this.currentDetail)||void 0===t?void 0:t.remark)||""}},watch:{visible(){var t;this.remark=(null===(t=this.currentDetail)||void 0===t?void 0:t.remark)||"",this.modal=this.visible}},methods:{closeModal(){this.$emit("update:visible",!1)},focus(t){this.$refs[t]&&this.$refs[t].focus()},submit(t){this.$emit("on-ok",t,this.remark),this.closeModal()}}},Z=X,tt=Object(h["a"])(Z,Q,Y,!1,null,null,null),et=tt.exports,st=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"invalid_modal"},[s("Modal",{key:t.isUpdate,attrs:{closable:!1,"mask-closable":!1,transfer:!1,draggable:""},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[s("h3",{attrs:{slot:"header"},slot:"header"},[t._v("标记无效")]),t.modal?[s("optimus-engine",t._b({ref:"invalidEngine",attrs:{answer:t.detail&&t.detail.invalidAnswer,disabled:!(t.isUpdate||t.detail.isUpdate)}},"optimus-engine",t.invalidComponentJson,!1))]:t._e(),s("p",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:t.closeModal}},[t._v("取消")]),t.isUpdate?s("Button",{attrs:{type:"primary"},on:{click:t.handleForm}},[t._v(t._s(this.statusList.isPageDetails?"确定":"提交"))]):t._e()],1)],2)],1)},at=[],it={props:{visible:Boolean,statusList:Object,detail:{type:Object,default(){return{}}},isUpdate:{type:Boolean,default:!1}},data(){return{modal:this.visible,remark:""}},computed:{invalidComponentJson(){return{component:{component:"z-form-stage",items:this.detail?this.detail.component.invalid_items:[]},context:this.detail?this.detail.context:{}}}},watch:{visible(){this.modal=this.visible}},methods:{closeModal(){this.$emit("update:visible",!1)},handleForm(){const{invalidEngine:t}=this.$refs;if(!t)return this.$Modal.error("无效标签数据无法校验，请重试"),0;null===t||void 0===t||t.validate(),t.isValid?(this.statusList.isReLabeling&&!this.statusList.isPageDetails?this.$emit("on-submit","relabel",t.tags):this.statusList.isLabeling&&!this.statusList.isPageDetails?this.$emit("on-submit","label",t.tags):this.$emit("on-ok",t.tags),this.closeModal()):this.$Notice.error({title:"",desc:"提示",render:t=>t("span",["请选择无效标签 "])})}}},lt=it,rt=Object(h["a"])(lt,st,at,!1,null,null,null),nt=rt.exports,ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"z-banner z-level"},[s("div",{staticClass:"z-level__left"},[s("div",{staticClass:"z-level__item"},[s("Icon",{attrs:{type:"ios-alert-outline",size:18}})],1),s("div",{staticClass:"z-level__item"},[s("Strong",[t._v("无效数据")])],1)]),s("div",{staticClass:"z-level__right"},[t.isUpdate?[s("div",{staticClass:"z-level__item"},[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.setValid()}}},[t._v("改为有效")])]),s("div",{staticClass:"z-level__item mrm"},[s("a",{attrs:{href:"javascript:;"},on:{click:t.createModal}},[t._v("编辑原因")])])]:s("div",{staticClass:"z-level__item mrm"},[s("a",{attrs:{href:"javascript:;"},on:{click:t.createModal}},[t._v("查看原因")])])],2)])},ct=[],dt={props:{isUpdate:{type:Boolean,default:!1}},methods:{setValid(){this.$emit("updateValid",1)},createModal(){this.$emit("openInvalidModal","invalid")}}},ut=dt,ht=(s("e777"),Object(h["a"])(ut,ot,ct,!1,null,"43432949",null)),_t=ht.exports,mt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",{staticStyle:{height:"100vh"}},[t.errorData?[s("div",{staticClass:"z-header z-level"},[s("div",{staticClass:"z-level__left"},[s("Row",{staticClass:"z-header__logo z-header__item",attrs:{type:"flex",justify:"start"}},[s("div",{on:{click:function(e){return t.$router.push("/")}}},[s("Icon",{staticStyle:{"margin-right":"20px",cursor:"pointer","font-size":"24px"},attrs:{type:"ios-home"}})],1),s("b",[t._v(t._s(t.QuestionType[t.errorData.event])+"工作台:"),t.task?s("span",[t._v(t._s(t.task.task_name))]):t._e()])])],1)]),s("div",{staticClass:"errorPageContainer"},[s("LimitErrorPage",{attrs:{errorData:t.errorData}})],1)]:[t.fetchObject.isPending?s("Spin",{attrs:{fix:""}}):t._e(),t.fetchObject.isRejected?s("error",{attrs:{title:"内部接口错误",message:t.errorMessage},on:{tryAgain:function(e){return t.handle("tryAgain")}}}):t._e(),t.fetchObject.isResolved?[t.isPausePage?s("div",{staticClass:"z-pause-annotator"},[s("pause-page",{attrs:{task:t.task}})],1):t._e(),t._t("content"),t.isErrorPage?s("error",{attrs:{title:"找不到题目"},on:{tryAgain:function(e){return t.handle("reset")}}}):t._e()]:t._e()]],2)},vt=[],pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container"},[s("div",{staticClass:"contentText",staticStyle:{color:"black"}},[s("Icon",{staticStyle:{padding:"15px","border-radius":"50%","background-color":"#bbbcbd"},attrs:{type:"md-pause",color:"white",size:"30"}}),s("p",{staticStyle:{margin:"10px 0","font-size":"20px"}},[t._v("暂停中")]),t.timePauseData.timePauseTotal?s("p",{staticStyle:{"margin-bottom":"30px",color:"#838383"}},[t.isTaskTimePause?s("span",[s("span",[t._v("任务限制 "+t._s(t.timePauseData.timePauseTotal)+" "+t._s(t.timePauseData.curTimeUnit)+"不操作将自动暂停")])]):s("span",[s("span",[t._v("默认"+t._s(t.timePauseData.timePauseTotal)+" "+t._s(t.timePauseData.curTimeUnit)+"不操作将自动暂停，")]),s("span",[t._v("可在工作台")]),s("span",{staticStyle:{"font-weight":"bold",color:"black"}},[t._v("【暂停】")]),s("span",[t._v("更改配置")])])]):t._e(),s("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){return t.$EventBus.$emit("handlePauseOrResume","继续")}}},[t._v("继续做题")])],1)])},kt=[],ft={props:{task:Object},data(){let t=JSON.parse(localStorage.getItem("qlabel-time-pause-total"));return t||(t={timePauseTotal:1,curTimeUnit:"分钟"},localStorage.setItem("qlabel-time-pause-total",JSON.stringify(t))),{isTaskTimePause:!1,timePauseData:t}},watch:{task(){this.handleTaskTimePause()}},mounted(){this.handleTaskTimePause()},methods:{handleTaskTimePause(){if(this.task){const{label_auto_pause_timeout:t,check_auto_pause_timeout:e}=this.task;let s=this.$route.query.scenes.includes("label")?t:e,a="秒";if(-1===s)return;const i=s%60===0;s/=i?60:1,i&&(a=s?"分钟":"关闭"),this.isTaskTimePause=!0,this.timePauseData={timePauseTotal:s,curTimeUnit:a}}}}},bt=ft,gt=(s("7476"),Object(h["a"])(bt,pt,kt,!1,null,"5982455f",null)),yt=gt.exports,wt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"z-result-wrapper"},[s("div",{staticClass:"z-result"},[s("div",{staticClass:"z-result__icon error"},[s("Icon",{attrs:{type:"ios-close",size:"70",color:"white"}})],1),t.title?s("div",{staticClass:"z-result__title"},[t._v(t._s(t.title))]):t._e(),t.message?s("div",{staticClass:"z-result__desc"},[t._v(t._s(t.message))]):t._e(),s("div",{staticClass:"z-result__extra"},[s("div",{staticClass:"links"},[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.$emit("tryAgain")}}},[t._v(t._s(t.message?"重试":"重置"))])]),s("div",{staticClass:"links"},[s("a",{attrs:{href:"javascript:;"},on:{click:t.goHome}},[t._v("返回个人中心")])])])])])},Ct=[],St={props:{title:String,message:String},methods:{goHome(){this.$router.push("/personal-center/questions-processing")}}},Tt=St,It=Object(h["a"])(Tt,wt,Ct,!1,null,null,null),$t=It.exports,xt=s("4304"),Dt=s("c899"),Lt={components:{error:$t,PausePage:yt,LimitErrorPage:xt["a"]},props:{fetchObject:{type:[Object,Function],default(){return{isRejected:!0}}},isErrorPage:{type:Boolean,default:!1},isPausePage:{type:Boolean,default:!1},task:Object,errorData:null},data(){return{QuestionType:Dt["b"],show:!1}},computed:{errorMessage(){var t,e;return null===(t=this.fetchObject)||void 0===t||null===(e=t.rejectedWith)||void 0===e?void 0:e.message}},watch:{"fetchObject.isResolved"(t){if(t&&this.isErrorPage)throw new Error("找不到题目")}},methods:{handle(t){this.$emit(t)}}},Rt=Lt,Pt=(s("ec7e"),Object(h["a"])(Rt,mt,vt,!1,null,null,null)),jt=Pt.exports,Ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"detail_pages"},[s("div",{staticClass:"z-level__item"},[s("Page",{attrs:{current:t.detailPage.index,total:t.detailPage.total,"page-size":1,simple:"","show-elevator":""},on:{"on-change":t.changePage}})],1),s("div",{staticClass:"z-level__item"},[s("Tooltip",{attrs:{content:"搜索题目",placement:"left"}},[s("Button",{attrs:{type:t.isSearching?"info":"default",icon:"md-search"},on:{click:function(e){t.isShowSearchArea=!0}}})],1),s("Drawer",{attrs:{title:"搜索题目",width:"400",scrollable:""},model:{value:t.isShowSearchArea,callback:function(e){t.isShowSearchArea=e},expression:"isShowSearchArea"}},[s("Form",{attrs:{model:t.taskForm}},[s("FormItem",{attrs:{label:"任务明细ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务明细ID进行搜索"},model:{value:t.taskForm.detail_id_list,callback:function(e){t.$set(t.taskForm,"detail_id_list",e)},expression:"taskForm.detail_id_list"}})],1),s("FormItem",{attrs:{label:"题目ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入题目ID进行搜索"},model:{value:t.taskForm.dataset_item_id_list,callback:function(e){t.$set(t.taskForm,"dataset_item_id_list",e)},expression:"taskForm.dataset_item_id_list"}})],1),s("FormItem",{attrs:{label:"题包Key"}},[s("Input",{attrs:{type:"text",placeholder:"输入题包Key进行搜索"},model:{value:t.taskForm.pack_keys,callback:function(e){t.$set(t.taskForm,"pack_keys",e)},expression:"taskForm.pack_keys"}})],1),s("FormItem",{attrs:{label:"是否有效"}},[s("Select",{attrs:{transfer:""},model:{value:t.taskForm.detail_valid,callback:function(e){t.$set(t.taskForm,"detail_valid",e)},expression:"taskForm.detail_valid"}},[s("Option",{key:1,attrs:{value:1}},[t._v("有效")]),s("Option",{key:0,attrs:{value:0}},[t._v("无效")])],1)],1),s("FormItem",{attrs:{label:"当前处理人"}},[s("Input",{attrs:{type:"text",placeholder:"输入当前处理人名称"},model:{value:t.taskForm.nick_name_list,callback:function(e){t.$set(t.taskForm,"nick_name_list",e)},expression:"taskForm.nick_name_list"}})],1),"review"===t.$route.query.from?s("FormItem",{attrs:{label:"质检结果"}},[s("Select",{attrs:{transfer:""},model:{value:t.taskForm.flow_action,callback:function(e){t.$set(t.taskForm,"flow_action",e)},expression:"taskForm.flow_action"}},t._l(t.reviewResults,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1):t._e(),"page"===t.$route.query.type&&"review"!==t.$route.query.from?s("FormItem",{attrs:{label:"质检结果"}},[s("Select",{attrs:{transfer:""},model:{value:t.taskForm.check_status,callback:function(e){t.$set(t.taskForm,"check_status",e)},expression:"taskForm.check_status"}},t._l(t.deliverCheckStatus,(function(e,a){return 0!==e.value?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1):t._e(),t.isMyTask?t._e():[s("FormItem",{attrs:{label:"标注状态"}},[s("Select",{attrs:{transfer:""},model:{value:t.taskForm.detail_status,callback:function(e){t.$set(t.taskForm,"detail_status",e)},expression:"taskForm.detail_status"}},t._l(t.labelStatus,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1),"page"===t.$route.query.type?s("FormItem",{attrs:{label:"交付状态"}},[s("Select",{attrs:{transfer:""},model:{value:t.taskForm.is_deliver,callback:function(e){t.$set(t.taskForm,"is_deliver",e)},expression:"taskForm.is_deliver"}},t._l(t.deliverStatus,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1):s("FormItem",{attrs:{label:"交付批次状态"}},[s("Select",{model:{value:t.taskForm.deliver_status_list,callback:function(e){t.$set(t.taskForm,"deliver_status_list",e)},expression:"taskForm.deliver_status_list"}},t._l(t.batchStatus,(function(e,a){return 40!==e.value&&70!==e.value?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1),s("FormItem",{staticClass:"width",attrs:{label:"最后标注人"}},[s("Select",{attrs:{filterable:"",placeholder:"选择最后标注人"},on:{"on-open-change":t.fetchUsers},model:{value:t.taskForm.last_labeler_list,callback:function(e){t.$set(t.taskForm,"last_labeler_list",e)},expression:"taskForm.last_labeler_list"}},t._l(t.users,(function(e){return e.role_type.includes("admin")||e.role_type.includes("labeler")?s("Option",{key:e.user_id,attrs:{label:e.nick_name,value:e.user_id}},[s("p",[t._v(t._s(e.nick_name))]),s("p",{staticClass:"txt-muted"},[t._v(t._s(e.email||"无邮箱"))])]):t._e()})),1)],1)],s("Row",{staticClass:"mtm",attrs:{gutter:10}},[s("Col",{attrs:{span:"12"}},[s("Button",{attrs:{type:"primary",long:""},on:{click:t.getFilter}},[t._v("筛选")])],1),s("Col",{attrs:{span:"12"}},[s("Button",{attrs:{long:""},on:{click:t.handleResetSearch}},[t._v("重置")])],1)],1)],2)],1)],1)])},Ft=[],Et=s("e3fa"),At={components:{},props:{detailPage:Object,detailForm:Object},data(){return{batchStatus:T["b"],labelStatus:T["m"],deliverCheckStatus:T["f"],reviewResults:T["p"],deliverStatus:T["g"],isShowSearchArea:!1,taskForm:i.a.cloneDeep(this.detailForm)}},computed:{isMyTask(){return this.$route.query.from},isSearching(){let t=!1;return i.a.forIn(this.taskForm,(e,s)=>{switch(s){case"type":case"team_id":break;case"last_labelers":e&&e.length>0&&(t=!0);break;default:(e||0===e)&&(t=!0);break}}),i.a.forIn(this.myTaskForm,e=>{(e||0===e)&&(t=!0)}),t}},methods:{getFilter(){const t=this.taskForm;this.isShowSearchArea=!1,this.$emit("filterDetail",t)},changePage(t){this.$emit("changePage",t)},handleResetSearch(){this.isShowSearchArea=!1,this.$emit("handleResetSearch")}},asyncMethods:{fetchUsers(){if(!this.$route.query.team_id)return[];const t={page:{start:0,size:1e3,return_total:1},object_type:"team",object_id:this.$route.query.team_id,user_type:"user"};return Object(Et["q"])(t).then(t=>t.data).catch(t=>{this.$Message.error(t.message)})}}},Mt=At,Nt=Object(h["a"])(Mt,Ot,Ft,!1,null,null,null),Bt=Nt.exports,zt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"aid"},[t.isHotKey&&t.stagesMetadataSC.length>0?[s("div",{staticClass:"z-level__item"},[s("Tooltip",{attrs:{content:"打开/关闭快捷键窗口：control + ~",placement:"bottom-end","max-width":300}},[s("div",{staticClass:"middle hover-hand",on:{click:function(e){t.isShowShortCut=!t.isShowShortCut}}},[s("Icon",{attrs:{type:"ios-keypad-outline",size:"20"}}),t._v("快捷键")],1)])],1),t.isShowShortCut?s("div",{staticClass:"z-shortCuts-box"},[s("div",{staticClass:"z-shortCuts-header"},[s("h3",[t._v("快捷键"),s("div",{staticClass:"right hover-hand",attrs:{type:"text"},on:{click:function(e){t.isShowShortCut=!1}}},[s("icon",{attrs:{type:"ios-close",size:"30"}})],1)])]),s("div",{staticClass:"z-shortCuts-content"},t._l(t.stagesMetadataSC,(function(e){return s("div",{staticClass:"mbm"},[s("h4",{staticClass:"mbm"},[t._v(t._s(e.label))]),t._l(e.attributes,(function(e){return s("p",{staticClass:"mbm"},[t._l(e.name,(function(a,i){return s("span",[s("Button",{staticStyle:{width:"85px"},attrs:{size:"small",disabled:!e.global&&!t.isUpdate}},[t._v(t._s(a))]),i<e.name.length-1?[e.connection?s("span",{staticClass:"mrm mlm"},[t._v(t._s(e.connection))]):s("span",{staticClass:"mrm mlm"},[t._v("+")])]:t._e()],2)})),s("span",{staticClass:"right",class:{disabled:!e.global&&!t.isUpdate}},[t._v(t._s(e.label))])],2)}))],2)})),0)]):t._e()]:t._e(),t.isJsonViewEnabled?s("div",{staticClass:"z-level__item"},[s("div",{staticClass:"middle hover-hand",on:{click:function(e){return t.handleAction("enterJsonView")}}},[s("Icon",{attrs:{type:"ios-code-working",size:"20"}}),t._v("JSON")],1)]):t._e(),s("div",{staticClass:"z-level__item",on:{click:function(e){return t.handleAction("enterFullScreen")}}},[s("div",{staticClass:"middle hover-hand"},[s("Icon",{attrs:{type:"ios-expand",size:"20"}}),t._v("全屏")],1)]),t.isShare?s("div",{staticClass:"z-level__item"},[s("div",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.copyText,expression:"copyText",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.handleCopySuccess,expression:"handleCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.handleCopyError,expression:"handleCopyError",arg:"error"}],staticClass:"middle hover-hand",on:{click:function(e){return t.handleAction("handleShareDetail")}}},[s("Icon",{attrs:{type:"ios-share-alt-outline",size:"20"}}),t._v("分享")],1)]):t._e()],2)},Vt=[],qt={beforeRouteEnter(t,e,s){s(t=>{"wb-label-task-detail"!==e.name&&"wb-review-task-detail"!==e.name||(localStorage.setItem("isShowShortCut",!1),t.isShowShortCut=!0===localStorage.getItem("isShowShortCut"))})},props:{isHotKey:Boolean,stagesMetadataSC:{type:Array,default:()=>[]},isUpdate:Boolean,isJsonViewEnabled:Boolean,copyText:String},data(){const{pack_key:t,pack_id:e}=this.$route.params,s=t||e,a="0"!==s;return{isShowShortCut:"true"===localStorage.getItem("isShowShortCut"),isShare:a}},watch:{isShowShortCut(){localStorage.setItem("isShowShortCut",this.isShowShortCut)}},methods:{listenKeyboardEvent:i.a.debounce((function(t){const{ctrlKey:e,code:s}=t;e&&"Backquote"===s&&(this.isShowShortCut=!this.isShowShortCut)}),100),handleAction(t){this.$emit(t)},handleCopySuccess(){this.$Message.success("已将分享链接复制到剪贴板")},handleCopyError(){this.$Message.error("复制分享链接失败")}}},Ut=qt,Wt=(s("0f4b"),Object(h["a"])(Ut,zt,Vt,!1,null,"58b6cde0",null)),Jt=Wt.exports,Ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.isErrorCardShow?s("div",{staticClass:"errorSurveyCardContanier"},[s("div",{staticClass:"collapse"},[s("div",[s("Icon",{attrs:{type:"ios-alert",color:"red"}}),s("span",{staticStyle:{"margin-right":"8px"}},[t._v("上次交付验收质检驳回:")]),s("span",[t._v(t._s(t.rejectData.length>0?t.rejectData.slice(6):"未备注原因")),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit||!t.disabled,expression:"!isEdit || !disabled"}],staticClass:"space"},[s("span",[t._v("出错原因: "+t._s(t.form.mistake_reason_type))]),s("span",{directives:[{name:"show",rawName:"v-show",value:t.form.mistake_reason_desc.length,expression:"form.mistake_reason_desc.length"}]},[t._v("("+t._s(t.form.mistake_reason_desc)+")")])])])],1),s("a",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit&&t.disabled,expression:"!isEdit &&disabled"}],on:{click:function(e){t.isEdit=!0}}},[t._v("修改")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&t.disabled,expression:"isEdit && disabled"}],staticClass:"errorReason"},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("span",{staticStyle:{"margin-right":"8px"}},[t._v("出错原因:")]),s("RadioGroup",{model:{value:t.form.mistake_reason_type,callback:function(e){t.$set(t.form,"mistake_reason_type",e)},expression:"form.mistake_reason_type"}},t._l(t.errorInfo.mistake_reason_type.items,(function(e){return s("Radio",{key:e.value,attrs:{label:e.value,disabled:e.disabled}},[t._v(t._s(e.value))])})),1),s("Input",{staticStyle:{width:"400px"},attrs:{placeholder:"备注（必填）"},model:{value:t.form.mistake_reason_desc,callback:function(e){t.$set(t.form,"mistake_reason_desc",e)},expression:"form.mistake_reason_desc"}})],1),s("a",{directives:[{name:"show",rawName:"v-show",value:t.disabled,expression:"disabled"}],on:{click:t.handleSubmit}},[t._v("确认")])])]):t._e()},Kt=[],Gt={props:{cardData:Object,rejectData:String,update:Function,detail:Object,disabled:Boolean,updateStatus:Function},data(){var t,e,s;const a=(null===(t=this.detail)||void 0===t?void 0:t.mistake_reason)&&JSON.parse(this.detail.mistake_reason);return{form:{mistake_reason_type:null!==(e=null===a||void 0===a?void 0:a.mistake_reason_type)&&void 0!==e?e:"",mistake_reason_desc:null!==(s=null===a||void 0===a?void 0:a.mistake_reason_desc)&&void 0!==s?s:""},isEdit:!0}},computed:{errorInfo(){var t;return JSON.parse(null===this||void 0===this||null===(t=this.cardData)||void 0===t?void 0:t.business_config).mistake_error_config},isErrorCardShow(){var t;return 15===(null===this||void 0===this||null===(t=this.detailDeliverHistoryInfo)||void 0===t?void 0:t.recent_deliver_check_status)&&this.cardData.business_config}},mounted(){var t;this.fetchDetailDeliverHistoryInfo(this.detail),this.updateStatus(null===this||void 0===this||null===(t=this.detailDeliverHistoryInfo)||void 0===t?void 0:t.recent_deliver_check_status)},methods:{async handleSubmit(){var t;if(!this.form.mistake_reason_desc)return void this.$Message.error("请完善出错原因");if(!this.form.mistake_reason_type)return void this.$Message.error("请完善出错类型");const e=await N["a"].SubmitMistakeReason({task_id:this.detailDeliverHistoryInfo.task_id,detail_id:this.detailDeliverHistoryInfo.detail_id,check_detail_id:this.detailDeliverHistoryInfo.recent_deliver_check_detail_id,mistake_reason:JSON.stringify(this.form)});null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.result&&this.$Message.success("修改成功"),this.update(this.detail.detail_id),this.isEdit=!1}},asyncMethods:{fetchDetailDeliverHistoryInfo(t){const e={detail_id:null===t||void 0===t?void 0:t.detail_id};return N["a"].GetDetailDeliverHistory(e).then(t=>t.data.result)}}},Qt=Gt,Yt=(s("0c372"),Object(h["a"])(Qt,Ht,Kt,!1,null,"15662b5c",null)),Xt=Yt.exports,Zt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{attrs:{"footer-hide":!0,"mask-closable":!1,closable:!1,width:"400"},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[s("p",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.backTimer)+"秒后页面将关闭")]),t.isTimeOut?s("small",[t._v("当前题目已超时，将自动为您退回，已保存的标注结果不会被清空；您可以返回当前任务重新领取。")]):t._e()])},te=[],ee={props:{visible:Boolean,backTimer:Number,isTimeOut:Boolean},data(){return{modal:this.visible}},watch:{visible(){this.modal=this.visible}},methods:{closeModal(){this.$emit("update:visible",!1)}}},se=ee,ae=(s("d142"),Object(h["a"])(se,Zt,te,!1,null,"03feb94f",null)),ie=ae.exports,le=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{attrs:{width:850,draggable:"",sticky:"","footer-hide":""},on:{"on-cancel":t.closeModal},scopedSlots:t._u([{key:"header",fn:function(){return[t._v("JSON查看框")]},proxy:!0}]),model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[t.modal&&t.detail.detail_id?s("Tabs",{attrs:{value:t.tab,animated:!1}},[s("TabPane",{attrs:{label:"题目数据",name:"题目数据"}},[s("JsonViewer",{staticClass:"json-view",attrs:{value:t.detail.context,"expand-depth":5}})],1),s("TabPane",{attrs:{label:"标注答案",name:"标注答案"}},[s("JsonViewer",{staticClass:"json-view",attrs:{value:t.detail.label,"expand-depth":5}})],1)],1):t._e()],1)},re=[],ne=s("0200"),oe=s.n(ne),ce={components:{JsonViewer:oe.a},props:{visible:Boolean,detail:{type:Object,default(){return{}}},isJsonViewEnabled:Boolean},data(){return{modal:this.visible,tab:"题目数据"}},watch:{visible(){const{query:t}=this.$route;this.visible&&this.isJsonViewEnabled&&(this.modal=this.visible),this.$router.replace({query:{...t,json_view:this.modal?1:void 0}})}},methods:{closeModal(){this.$emit("update:visible",!1)}}},de=ce,ue=(s("9777"),Object(h["a"])(de,le,re,!1,null,null,null)),he=ue.exports,_e=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"z-footer z-level"},[s("div",{staticClass:"z-level__left"},[t.isList?t._e():[t.isShowLog&&t.latestFlowLog.email?s("div",{staticClass:"z-level__item"},[s("p",{staticClass:"z-log",on:{click:t.handle}},[s("Icon",{staticClass:"icon",attrs:{type:"ios-person-outline",size:"15"}}),s("span",[t._v(t._s(t._f("dayjs")(t.latestFlowLog.flow_handle_at,"fromNow"))+", ")]),s("span",[t._v(t._s(t.latestFlowLog.nick_name||t.latestFlowLog.email)+", ")]),s("span",[t._v(t._s(t.latestFlowLog.flow_action_text))]),s("span",[t._v("（点击查看历史）")])],1)]):t._e(),s("div",{staticClass:"z_level__center mlm mrm"},[t.rejectData&&t.rejectData.length>0?[s("Icon",{staticClass:"mrs",attrs:{type:"ios-close-circle-outline",color:"red"}}),s("span",[t._v("最新质检驳回原因:"+t._s(t.rejectData.substring(6)))]),t.rejectData.length>35?[s("span",[t._v("...")]),s("a",{on:{click:t.handle}},[t._v("详情")])]:t._e()]:t._e()],2)]],2),s("div",{staticClass:"z-level__center"},[t._t("tips")],2),s("div",{staticClass:"z-level__right"},[t._t("buttons")],2)])},me=[],ve={props:{task:Object,isList:Boolean,latestFlowLog:{type:Object,default:()=>{}},rejectData:String,isShowLog:{type:Boolean,default:!0}},computed:{userInfo(){return this.$store.state.userinfo}},methods:{handle(){this.$emit("openLogs","logs")}}},pe=ve,ke=Object(h["a"])(pe,_e,me,!1,null,null,null),fe=ke.exports,be=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},ge=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"illustration",staticStyle:{"text-align":"center",margin:"200px 0px",flex:"1"}},[a("img",{attrs:{src:s("8518"),width:"350",alt:"图片加载失败"}}),a("h2",{staticClass:"mtm"},[t._v("数据已删除")]),a("p",{staticClass:"mtm"},[t._v("抱歉，您访问的页面不存在")])])}],ye={},we=Object(h["a"])(ye,be,ge,!1,null,null,null),Ce=we.exports,Se=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"batch"},[s("div",{staticClass:"batch-header"},[s("Alert",{attrs:{"show-icon":""}},[t._v("已选择"),s("span",{staticClass:"selection-number"},[t._v(t._s(t.selectionList.length))]),t._v("项"),t.isUpdate&&"review"!==t.detailType?s("a",{on:{click:t.handleClear}},[t._v("清空")]):t._e()]),"review"!==t.detailType?[s("Button",{attrs:{type:"info",ghost:"",disabled:0===t.selectionList.length||!t.isUpdate},on:{click:t.handleBatchAnnotation}},[t._v("批量标注")]),s("Button",{attrs:{type:"warning",ghost:"",disabled:0===t.selectionList.length||!t.isUpdate},on:{click:t.handleBatchInValid}},[t._v("标记无效")])]:[s("Button",{attrs:{type:"error",ghost:"",disabled:0===t.selectionList.length||!t.isUpdate},on:{click:function(e){return t.handleBatchAnnotationRemark()}}},[t._v("批量驳回")]),s("Button",{attrs:{type:"info",ghost:"",disabled:0===t.selectionList.length||!t.isUpdate},on:{click:t.handleBatchAnnotation}},[t._v("批量修改")])]],2),s("div",{staticClass:"batch-table"},[s("Table",{ref:"selection",attrs:{border:"","row-class-name":t.rowClassName,columns:t.columns,data:t.data},on:{"on-selection-change":t.handleSelectionChange},scopedSlots:t._u([{key:"check_status",fn:function(e){var a=e.row;return[a.isError||a.isReUpdate?[s("Icon",{attrs:{type:"ios-close-circle",color:"red"}}),s("span",[t._v("此题错误")])]:a.isReAction?[s("Icon",{attrs:{type:"ios-alert",color:"#f90"}}),s("span",[t._v("质检不通过")])]:t._e()]}},{key:"action",fn:function(e){var a=e.row,i=e.index;return["label"===t.detailType?[t.isUpdate&&(t.isFirstTime||a.isReAction)?[1===a.detail_is_valid?[s("a",{on:{click:function(e){return t.handleAnnotation(a,i)}}},[t._v("标注")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.handleInValid(a,i)}}},[t._v("标记无效")])]:[s("a",{on:{click:function(e){return t.handleInValid(a,i)}}},[t._v("编辑原因")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.handleAnnotation(a,i)}}},[t._v("改为有效")])],s("Divider",{attrs:{type:"vertical"}})]:a.detail_is_valid?t._e():[s("a",{on:{click:function(e){return t.handleInValid(a,i)}}},[t._v("查看原因")]),s("Divider",{attrs:{type:"vertical"}})]]:t._e(),"review"===t.detailType?[t.isUpdate&&(a.isReAction||t.isFirstTime)?[a.isUpdate?[s("a",{on:{click:function(e){return t.updateLabel(i,"取消修改")}}},[t._v("取消修改")]),a.detail_is_valid?[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.handleAnnotation(a,i)}}},[t._v("标注")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.handleInValid(a,i)}}},[t._v("标记无效")])]:[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.handleInValid(a,i)}}},[t._v("编辑原因")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.handleAnnotation(a,i)}}},[t._v("改为有效")])],s("Divider",{attrs:{type:"vertical"}})]:[a.isReUpdate||a.isError?[s("a",{on:{click:function(e){return t.updateLabel(i,"重置")}}},[t._v("重置")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.updateLabel(i,"继续修改")}}},[t._v("继续修改")])]:[s("a",{on:{click:function(e){return t.updateLabel(i,"质检不通过")}}},[t._v("质检不通过")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.updateLabel(i,"修改标注")}}},[t._v("修改标注")])],s("Divider",{attrs:{type:"vertical"}})]]:a.detail_is_valid?t._e():[s("a",{on:{click:function(e){return t.handleInValid(a,i)}}},[t._v("查看原因")]),s("Divider",{attrs:{type:"vertical"}})]]:t._e(),s("a",{on:{click:function(e){return t.getLogs(a.detail_id)}}},[t._v("日志")])]}}])})],1),s("BatchAnnotationModal",{attrs:{type:t.type,detailType:t.detailType,selectionList:t.selectionList,batchAnnotationModal:t.batchAnnotationModal,currentDetail:t.currentDetail},on:{changeBatchAnnotationModal:t.changeBatchAnnotationModal,changCurrentDetailTags:t.changCurrentDetailTags}}),s("batchAnnotationInvalidModal",{attrs:{type:t.type,selectionList:t.selectionList,batchAnnotationInvalidModal:t.batchAnnotationInvalidModal,currentDetail:t.currentDetail,isUpdate:t.isUpdate&&(t.currentDetail.isReAction||t.isFirstTime||t.selectionList.length>0&&"single"!==t.type),detailType:t.detailType},on:{changeBatchAnnotationInvalidModal:t.changeBatchAnnotationInvalidModal,changCurrentDetailInvalidTags:t.changCurrentDetailInvalidTags}}),s("review-remark",{attrs:{visible:t.batchAnnotationRemarkModal,isBatch:!0,mask:!0,currentDetail:t.currentDetail,type:"reset"},on:{"update:visible":function(e){t.batchAnnotationRemarkModal=e},"on-ok":t.changCurrentDetailRemark}})],1)},Te=[],Ie=(s("7b4b"),s("c6f0"));const $e=["output"],xe=(t,e)=>{if(!Object(a["isString"])(t))return t;const s=t.match(/^\${(.+)}$/);if(null===s)return t;const[,i]=s,l=Object(Ie["tokenize"])(i),r=Object(a["some"])(l,t=>"Identifier"===t.type&&Object(a["some"])($e,e=>t.value===e)),n={input:{}};for(const[a,o]of Object.entries(e))n.input[a]=o;if(!r){const s=Object(a["template"])(t)({...e,...n});return s}return{$expressionFn:new Function("input","output","return "+i)}},De=(t,e)=>{const s={get(t,e,a){try{return new Proxy(t[e],s)}catch(i){return Reflect.get(t,e,a)}},defineProperty(t,s,a){const i=Reflect.defineProperty(t,s,a);return e(),i},deleteProperty(t,s){const a=Reflect.deleteProperty(t,s);return e(),a}};return new Proxy(t,s)};var Le=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{attrs:{title:t.title,loading:t.loading,draggable:""},on:{"on-ok":t.handleSave,"on-cancel":t.handleCancel},model:{value:t._batchAnnotationModal,callback:function(e){t._batchAnnotationModal=e},expression:"_batchAnnotationModal"}},[t._batchAnnotationModal?s("optimus-engine",t._b({ref:"configTags",attrs:{answer:t.answer,context:t.currentDetail.context}},"optimus-engine",t.configTags,!1)):t._e(),"review"===t.detailType?[s("span",[t._v("修改原因")]),s("Input",{ref:"remarkInput",staticClass:"mtm",attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"可在此处备注原标注错误信息和质检修改点"},on:{"hook:mounted":function(e){return t.focus("remarkInput")}},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})]:t._e()],2)},Re=[],Pe={name:"BatchAnnotationModal",props:{type:String,selectionList:Array,batchAnnotationModal:{type:Boolean,default:!1},currentDetail:Object,detailType:{type:String,required:!0}},data(){var t;return{loading:!0,remark:(null===(t=this.currentDetail)||void 0===t?void 0:t.remark)||"",componentContext:{}}},computed:{title(){var t;return"single"===this.type?`单题${"review"===this.detailType?"修改":"标注"}(${null===(t=this.currentDetail)||void 0===t?void 0:t.detail_id})`:`批量${"review"===this.detailType?"修改":"标注"}（共${this.selectionList.length}题）`},configTags(){var t,e;return{component:{component:"z-form-stage",items:null===(t=this.currentDetail)||void 0===t||null===(e=t.component)||void 0===e?void 0:e.items},context:{}}},_batchAnnotationModal:{get(){var t;return this.remark=(null===(t=this.currentDetail)||void 0===t?void 0:t.remark)||"",this.batchAnnotationModal},set(t){this.$emit("changeBatchAnnotationModal",t)}},answer(){var t,e;return{tags:(null===(t=this.currentDetail)||void 0===t||null===(e=t.label)||void 0===e?void 0:e.tags)||[]}}},mounted(){},methods:{focus(t){this.$refs[t]&&this.$refs[t].focus()},handleSave(){const{configTags:t,configTags:{validate:e,formData:s}}=this.$refs;if(e(),!t.isValid)return this.$Notice.error({title:"",desc:"",render:t=>t("span",["请完善必填项 "])}),this.loading=!1,void this.$nextTick(()=>{this.loading=!0});this.$Notice.success({title:"",desc:"修改成功",render:t=>t("span",["修改成功 "])}),this.$emit("changCurrentDetailTags",s,this.remark),this.$emit("changeBatchAnnotationModal",!1)},handleCancel(){this.$emit("changeBatchAnnotationModal",!1)}}},je=Pe,Oe=Object(h["a"])(je,Le,Re,!1,null,"463c860c",null),Fe=Oe.exports,Ee=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{attrs:{title:t.title,loading:t.loading,draggable:""},model:{value:t._batchAnnotationInvalidModal,callback:function(e){t._batchAnnotationInvalidModal=e},expression:"_batchAnnotationInvalidModal"}},[t._batchAnnotationInvalidModal?s("optimus-engine",t._b({ref:"configTags",attrs:{answer:t.answer,disabled:!t.isUpdate}},"optimus-engine",t.configTags,!1)):t._e(),"review"===t.detailType&&t.isUpdate?[s("span",[t._v("修改原因")]),s("Input",{ref:"remarkInput",staticClass:"mtm",attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"可在此处备注原标注错误信息和质检修改点"},on:{"hook:mounted":function(e){return t.focus("remarkInput")}},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})]:t._e(),s("p",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:t.handleCancel}},[t._v("取消")]),t.isUpdate?s("Button",{attrs:{type:"primary"},on:{click:t.handleSave}},[t._v("确定")]):t._e()],1)],2)},Ae=[],Me={name:"BatchAnnotationInvalidModal",props:{type:String,selectionList:Array,batchAnnotationInvalidModal:{type:Boolean,default:!1},currentDetail:Object,isUpdate:{type:Boolean,default:!1},detailType:{type:String,required:!0}},data(){var t;return{loading:!0,remark:(null===(t=this.currentDetail)||void 0===t?void 0:t.remark)||""}},computed:{title(){var t;return"single"===this.type?`标记无效(${null===(t=this.currentDetail)||void 0===t?void 0:t.detail_id})`:`标记无效（共${this.selectionList.length}题）`},configTags(){var t,e;return{component:{component:"z-form-stage",items:null===(t=this.currentDetail)||void 0===t||null===(e=t.component)||void 0===e?void 0:e.invalid_items},context:{}}},_batchAnnotationInvalidModal:{get(){var t;return this.remark=(null===(t=this.currentDetail)||void 0===t?void 0:t.remark)||"",this.batchAnnotationInvalidModal},set(t){this.$emit("changeBatchAnnotationInvalidModal",t)}},answer(){var t,e;return"single"===this.type?{tags:null===(t=this.currentDetail)||void 0===t||null===(e=t.label)||void 0===e?void 0:e.invalidTags}:{}}},mounted(){},methods:{focus(t){this.$refs[t]&&this.$refs[t].focus()},handleSave(){const{configTags:t,configTags:{validate:e,formData:s}}=this.$refs;if(e(),!t.isValid)return this.$Notice.error({title:"",desc:"",render:t=>t("span",["请完善必填项 "])}),this.loading=!1,void this.$nextTick(()=>{this.loading=!0});this.$Notice.success({title:"",desc:"修改成功",render:t=>t("span",["修改成功 "])}),this.$emit("changCurrentDetailInvalidTags",s,this.remark),this.$emit("changeBatchAnnotationInvalidModal",!1)},handleCancel(){this.$emit("changeBatchAnnotationInvalidModal",!1)}}},Ne=Me,Be=Object(h["a"])(Ne,Ee,Ae,!1,null,"12ce9906",null),ze=Be.exports,Ve={name:"BatchAnnotation",components:{BatchAnnotationModal:Fe,batchAnnotationInvalidModal:ze,ReviewRemark:et},props:{details:{type:Array},isUpdate:{type:Boolean,default:!1},detailType:{type:String,required:!0}},data(){return{type:"single",selectionList:[],currentDetail:{},batchAnnotationModal:!1,batchAnnotationInvalidModal:!1,batchAnnotationRemarkModal:!1,copyDetails:this.details}},computed:{isFirstTime(){const{scenes:t,from:e}=this.$route.query;return"label"===t||"review"===t||"label"===e||"review_again"===e},columns(){var t,e,s;const a=null===(t=this.details[0])||void 0===t||null===(e=t.component)||void 0===e||null===(s=e.items)||void 0===s?void 0:s.map(t=>{var e,s;return{title:null===(e=t.attributes)||void 0===e?void 0:e.label,key:null===(s=t.attributes)||void 0===s?void 0:s.name,width:200}}),i=[];return this.isUpdate&&("label"===this.detailType&&this.details.find(t=>t.isReAction)||"review"===this.detailType&&this.details.find(t=>t.isReAction||t.isError||t.isUpdate))&&i.push({title:" ",slot:"check_status",align:"center",width:110}),[...i,{type:"selection",width:60,align:"center"},{title:"任务明细ID",key:"detail_id",width:200},{title:"标注内容",key:"text",minWidth:600},...a,{title:"操作",slot:"action",fixed:"right",minWidth:220}]},data(){var t;return this.copyDetails=this.details,null===(t=this.details)||void 0===t?void 0:t.map(t=>{var e,s,a,i;const{detail_id:l,detail_is_valid:r,label:n}=t,{tagsData:o,cellClassName:c}=this.getTagsData(t);if(!t.detail_label){const e=t.component.items.map(t=>{const{name:e,label:s}=t.attributes;return{name:e,label:s,value:o[e]}});this.$set(t,"detail_label",JSON.stringify({tags:e}))}return{isUpdate:t.isUpdate,isError:t.isError,isReUpdate:t.isReUpdate,isReValid:!t.label.invalidTags,isReAction:t.isReAction,remark:t.remark,key:t.key,check_status:t.check_status,detail_id:String(l),detail_is_valid:r,detail_valid_reason:null===n||void 0===n||null===(e=n.invalidTags)||void 0===e||null===(s=e[0])||void 0===s?void 0:s.value,cellClassName:c,text:xe(null===(a=t.component)||void 0===a||null===(i=a.attributes)||void 0===i?void 0:i.text,t.context),...o,_checked:this.selectionIds.includes(String(l)),_disabled:!this.isUpdate||!(t.isReAction||this.isFirstTime)}})},selectionIds(){return this.selectionList.map(t=>t.detail_id)}},mounted(){},created(){},methods:{updateLabel(t,e){this.currentDetail=Object(a["isArray"])(this.details)&&this.details[t],this.$emit("updateLabel",t,e)},getLogs(t){this.$emit("getLogs",t,!0)},getTagsData(t){const{detail_is_valid:e,label:s,context:i}=t,l={},r=e?{}:{detail_id:"invalid-tag",text:"invalid-tag"},n=t.component.items.map(t=>{var a,l,r;const{name:n,label:o}=t.attributes,c=(null===(a=s.tags)||void 0===a||null===(l=a.find(t=>t.name===n))||void 0===l?void 0:l.value)||xe(null===(r=t.attributes)||void 0===r?void 0:r.value,i);return{name:n,label:o,value:e?c:"无效"}});try{const t=De(l,()=>{const e=Object.keys(t).filter(e=>Object(a["isFunction"])(t[e].$expressionFn));e.forEach(e=>{var s,a;null!==(s=t[e])&&void 0!==s&&s.$expressionFn(i,t)&&(t[e]=null===(a=t[e])||void 0===a?void 0:a.$expressionFn(i,t))})});Object(a["isArray"])(n)&&Object(a["forEach"])(n,s=>{var n,o;t[s.name]=Object(a["isFunction"])(s.value.$expressionFn)&&null!==(n=s.value)&&void 0!==n&&n.$expressionFn(i,l)?null===(o=s.value)||void 0===o?void 0:o.$expressionFn(i,t):s.value,r[s.name]=e?"":"invalid-tag"})}catch(o){console.error("[OPTIMUS ENGINE] 表达式配置出错 4")}return{tagsData:l,cellClassName:r}},rowClassName(t){var e;return(this.batchAnnotationModal||this.batchAnnotationInvalidModal)&&("single"===this.type&&String(null===(e=this.currentDetail)||void 0===e?void 0:e.detail_id)===String(t.detail_id)||"batch"===this.type&&this.selectionList.find(e=>String(e.detail_id)===String(t.detail_id)))?"table-selection-row-bg":""},handleClear(){this.$refs.selection.selectAll(!1)},handleSelectionChange(t){this.selectionList=t},changeBatchAnnotationModal(t){this.batchAnnotationModal=t},changeBatchAnnotationInvalidModal(t){this.batchAnnotationInvalidModal=t},changCurrentDetailRemark(t,e){this.copyDetails=this.copyDetails.map(s=>(("single"===this.type&&String(this.currentDetail.detail_id)===String(s.detail_id)||"batch"===this.type&&this.selectionIds.includes(String(s.detail_id)))&&("修改"===t?(this.$set(s,"isUpdate",!1),this.$set(s,"isReUpdate",!0),this.$set(s,"isError",!1),this.$set(s,"isReValid",s.detail_is_valid)):this.$set(s,"isError",!0),this.$set(s,"remark",e)),s)),this.$emit("changeDetails",this.copyDetails),this.selectionList=[]},changCurrentDetailTags(t,e){this.copyDetails=this.copyDetails.map(e=>{let s=null;return("single"===this.type&&String(this.currentDetail.detail_id)===String(e.detail_id)||"batch"===this.type&&this.selectionIds.includes(String(e.detail_id)))&&(s={tags:e.component.items.map(e=>{const{name:s,label:a}=e.attributes;return{name:s,label:a,value:null===t||void 0===t?void 0:t[s]}})},this.$set(e,"label",s),this.$set(e,"detail_is_valid",1)),this.$set(e,"detail_label",s?JSON.stringify(s):e.detail_label),e}),"review"===this.detailType?this.changCurrentDetailRemark("修改",e):(this.$emit("changeDetails",this.copyDetails),this.selectionList=[])},changCurrentDetailInvalidTags(t,e){this.copyDetails=this.copyDetails.map(e=>(("single"===this.type&&String(this.currentDetail.detail_id)===String(e.detail_id)||"batch"===this.type&&this.selectionIds.includes(String(e.detail_id)))&&(this.$set(e,"label",{invalidTags:e.component.invalid_items.map(e=>{const{name:s,label:a}=e.attributes;return{name:s,label:a,value:t[s]}})}),this.$set(e,"detail_is_valid",0)),this.$set(e,"invalidAnswer",{tags:e.label.invalidTags}),e)),"review"===this.detailType?this.changCurrentDetailRemark("修改",e):(this.$emit("changeDetails",this.copyDetails),this.selectionList=[])},handleSingle(t,e){this.type="single",this.currentDetail=Object(a["isArray"])(this.details)&&this.details[e]},handleBatch(){this.type="batch",this.currentDetail=Object(a["isArray"])(this.details)&&this.details.find(t=>String(t.detail_id)===this.selectionList[0].detail_id)},handleAnnotation(t,e){this.handleSingle(t,e),this.batchAnnotationModal=!0},handleBatchAnnotationRemark(){this.handleBatch(),this.batchAnnotationRemarkModal=!0},handleBatchAnnotation(){this.handleBatch(),this.batchAnnotationModal=!0},handleInValid(t,e){this.handleSingle(t,e),this.batchAnnotationInvalidModal=!0},handleBatchInValid(){this.handleBatch(),this.batchAnnotationInvalidModal=!0}}},qe=Ve,Ue=(s("6c07"),Object(h["a"])(qe,Se,Te,!1,null,"685be796",null)),We=Ue.exports,Je=s("bccd"),He=s("26b3"),Ke=s("f9b0"),Ge=s.n(Ke),Qe=s("c495"),Ye=(s("0689"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{display:"inline-block"}},[s("Tooltip",{attrs:{"max-width":"500"}},[s("Button",{staticClass:"mrm",attrs:{type:"default",size:"large"},on:{click:function(e){return t.$EventBus.$emit("handlePauseOrResume","暂停")}}},[t._v("暂停")]),t.isTaskTimePause?s("div",{attrs:{slot:"content"},slot:"content"},[t.timePauseData.timePauseTotal?s("span",[t._v("任务限制 "+t._s(t.timePauseData.timePauseTotal)+" "+t._s(t.timePauseData.curTimeUnit)+"不操作将自动暂停")]):s("span",[t._v("暂停做题")])]):s("div",{attrs:{slot:"content"},slot:"content"},[s("p",[t._v("默认"+t._s(t.timePauseData.timePauseTotal)+" "+t._s(t.timePauseData.curTimeUnit)+"不操作将自动暂停，可")]),s("span",{staticClass:"change-pause-config hover-hand",on:{click:function(e){t.isShowPauseConfig=!0}}},[t._v("点击更改配置")])])],1),s("Modal",{attrs:{title:"更改配置"},on:{"on-ok":t.confirm,"on-cancel":t.cancel},model:{value:t.isShowPauseConfig,callback:function(e){t.isShowPauseConfig=e},expression:"isShowPauseConfig"}},[s("p",[t._v("此时间段后自动暂停")]),s("div",{staticStyle:{"margin-top":"10px"}},[s("InputNumber",{attrs:{max:1440,min:1},model:{value:t.timePauseData.timePauseTotal,callback:function(e){t.$set(t.timePauseData,"timePauseTotal",e)},expression:"timePauseData.timePauseTotal"}}),s("Dropdown",{on:{"on-click":t.getTimeUnit}},[s("div",{staticClass:"hover-hand",staticStyle:{"margin-left":"10px"}},[s("span",[t._v(t._s(t.timePauseData.curTimeUnit))]),s("Icon",{attrs:{type:"md-arrow-dropdown",size:"15"}})],1),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.timeUnitLists,(function(e,a){return s("DropdownItem",{key:e,attrs:{name:e,selected:e===t.timePauseData.curTimeUnit}},[t._v(t._s(e))])})),1)],1)],1)])],1)}),Xe=[],Ze={props:{task:Object,isPausing:Boolean},data(){let t=JSON.parse(localStorage.getItem("qlabel-time-pause-total"));return t||(t={timePauseTotal:1,curTimeUnit:"分钟"},localStorage.setItem("qlabel-time-pause-total",JSON.stringify(t))),{isShowPauseConfig:!1,isTaskTimePause:!1,timeUnitLists:["分钟","秒"],timePauseData:t,timeObj:{}}},watch:{task(){this.removeEvent(),this.handleAutoPause()},isPausing:{handler(t){t?this.removeEvent():this.handleAutoPause()},immediate:!0}},beforeDestroy(){this.removeEvent()},methods:{handleAutoPause(){this.handleTaskTimePause();const t="分钟"===this.timePauseData.curTimeUnit?60*this.timePauseData.timePauseTotal*1e3:1e3*this.timePauseData.timePauseTotal;t?(this.timeObj={timer:null,handleResetTime:()=>{this.timeObj.timer&&clearTimeout(this.timeObj.timer),this.timeObj.timer=setTimeout(()=>{clearTimeout(this.timeObj.timer),this.$EventBus.$emit("handlePauseOrResume","暂停"),this.isShowPauseConfig=!1},t)}},this.timeObj.handleResetTime(),document.addEventListener("click",this.timeObj.handleResetTime),document.addEventListener("mousemove",this.timeObj.handleResetTime),document.addEventListener("keydown",this.timeObj.handleResetTime),document.addEventListener("mousewheel",this.timeObj.handleResetTime)):this.removeEvent()},removeEvent(){clearInterval(this.timeObj.timer),document.removeEventListener("click",this.timeObj.handleResetTime),document.removeEventListener("mousemove",this.timeObj.handleResetTime),document.removeEventListener("keydown",this.timeObj.handleResetTime),document.removeEventListener("mousewheel",this.timeObj.handleResetTime)},getTimeUnit(t){this.timePauseData.curTimeUnit=t},confirm(){localStorage.setItem("qlabel-time-pause-total",JSON.stringify(this.timePauseData)),this.removeEvent(),this.$Message.success("修改成功"),this.handleAutoPause()},cancel(){this.timePauseData=JSON.parse(localStorage.getItem("qlabel-time-pause-total"))},handleTaskTimePause(){if(this.task&&!this.isTaskTimePause){const{label_auto_pause_timeout:t,check_auto_pause_timeout:e}=this.task;let s=this.$route.query.scenes.includes("label")?t:e,a="秒";if(-1===s)return;const i=s%60===0;s/=i?60:1,i&&(a=s?"分钟":"关闭"),this.isTaskTimePause=!0,this.timePauseData={timePauseTotal:s,curTimeUnit:a}}}}},ts=Ze,es=(s("0465"),Object(h["a"])(ts,Ye,Xe,!1,null,"6fb7796e",null)),ss=es.exports,as=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{display:"inline-block"}},[s("Tooltip",{attrs:{"max-width":"500"}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",ghost:"",size:"large",loading:t.loading},on:{click:function(e){return t.$emit("handleSave")}}},[t._v("保存")]),s("div",{attrs:{slot:"content"},slot:"content"},[s("p",[t._v("默认每"+t._s(t.timeSaveData.timeSaveTotal)+t._s(t.timeSaveData.curTimeUnit)+"自动保存标注内容，不作提交")]),s("p",{staticClass:"change-pause-config hover-hand",on:{click:function(e){t.isShowAutoSaveModal=!0}}},[t._v("点击更改配置")])])],1),s("Modal",{attrs:{title:"更改配置"},on:{"on-ok":t.confirm,"on-cancel":t.cancel},model:{value:t.isShowAutoSaveModal,callback:function(e){t.isShowAutoSaveModal=e},expression:"isShowAutoSaveModal"}},[s("p",[t._v("此时间段后自动保存")]),s("div",{staticStyle:{"margin-top":"10px"}},[s("InputNumber",{attrs:{max:1440,min:1},model:{value:t.timeSaveData.timeSaveTotal,callback:function(e){t.$set(t.timeSaveData,"timeSaveTotal",e)},expression:"timeSaveData.timeSaveTotal"}}),s("Dropdown",{on:{"on-click":t.getTimeUnit}},[s("div",{staticClass:"hover-hand",staticStyle:{"margin-left":"10px"}},[s("span",[t._v(t._s(t.timeSaveData.curTimeUnit))]),s("Icon",{attrs:{type:"md-arrow-dropdown",size:"15"}})],1),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.timeUnitLists,(function(e,a){return s("DropdownItem",{key:e,attrs:{name:e,selected:e===t.timeSaveData.curTimeUnit}},[t._v(t._s(e))])})),1)],1)],1)])],1)},is=[],ls={props:{isPausing:Boolean,loading:{type:Boolean,default:!1}},data(){let t=JSON.parse(localStorage.getItem("qlabel-time-save-total"));return t||(t={timeSaveTotal:1,curTimeUnit:"分钟"},localStorage.setItem("qlabel-time-save-total",JSON.stringify(t))),{isShowAutoSaveModal:!1,timeUnitLists:["分钟","秒"],timeSaveData:t,timeObj:{}}},watch:{isPausing:{handler(t){t?this.removeEvent():this.handleAutoSave()},immediate:!0}},beforeDestroy(){this.removeEvent()},methods:{handleAutoSave(){const t="分钟"===this.timeSaveData.curTimeUnit?60*this.timeSaveData.timeSaveTotal*1e3:1e3*this.timeSaveData.timeSaveTotal;this.timeObj={timer:null,handleResetTime:()=>{this.timeObj.timer&&clearTimeout(this.timeObj.timer);const e=()=>{this.timeObj.timer=setTimeout(()=>{!document.hidden&&this.$emit("handleSave","auto"),e()},t)};e()}},this.timeObj.handleResetTime()},removeEvent(){clearTimeout(this.timeObj.timer)},getTimeUnit(t){this.timeSaveData.curTimeUnit=t},confirm(){localStorage.setItem("qlabel-time-save-total",JSON.stringify(this.timeSaveData)),this.removeEvent(),this.$Message.success("修改成功"),this.handleAutoSave()},cancel(){this.timeSaveData=JSON.parse(localStorage.getItem("qlabel-time-save-total"))}}},rs=ls,ns=(s("6bdc"),Object(h["a"])(rs,as,is,!1,null,"55abacb4",null)),os=ns.exports,cs=s("8416");const ds={label:7,review:2,review_again:3,relabel:4,re_review:5,label_again:6};e["a"]={components:{Container:jt,Logs:y,Counter:m,Info:L,TimeOut:E,Count:G,KeywordHighlight:W,ReviewRemark:et,InvalidModal:nt,InvalidBanner:_t,Pages:Bt,batchAnnotationList:We,ReturnModal:ie,JsonViewModal:he,Footer:fe,Aid:Jt,Delete:Ce,Pause:ss,Save:os,ErrorSurveyCard:Xt},data(){const{task_id:t}=this.$route.params,{team_id:e,scenes:s,type:a}=this.$route.query;return{statTask:{},latestFlowLog:{},countInfo:{},teamId:e,scenes:s,type:a,isTimeOut:!1,isReActionNum:0,scenesObj:ds,isPausing:!1,details:[],detailCopyList:[],packIdList:[],curIdx:0,rejectData:"",isUpdate:!1,detailStatus:T["i"],deliverStatus:T["g"],reviewStatus:T["q"],labelStatus:T["m"],showFullScreen:!1,stagesMetadataSC:[],requiredObj:[],taskId:Object(Je["BigNumber"])(t),backTimer:3,isFetchReturn:!1,detailPage:{index:1,total:0},detailForm:{detail_id_list:"",detail_status:"",check_status:"",deliver_status:"",deliver_status_list:"",is_deliver:"",nick_name_list:"",dataset_item_id_list:"",detail_valid:"",last_labeler_list:"",pack_keys:"",flow_action:""},copyText:"",modals:{review:!1,invalid:!1,detail:!1,logs:!1,type:"",jsonView:!1},operateType:"",isAutoValidating:!1,isAutoEditing:!1,errorData:null}},computed:{userInfo(){return this.$store.state.userinfo},isLabeler(){var t,e,s,a;const i=this.$store.getters.user.user_id.toString();return(null===(t=this.detail)||void 0===t||null===(e=t.detail_assignee)||void 0===e?void 0:e.toString())===i||(null===(s=this.detail)||void 0===s||null===(a=s.detail_labeler)||void 0===a?void 0:a.toString())===i},isLabelStatus(){var t;return null===(t=this.detail)||void 0===t?void 0:t.detail_status},isInit(){return this.isLabelStatus===T["i"].INIT.value},isLabeling(){var t;return this.isLabelStatus===T["m"].LABELING.value&&!(null!==(t=this.detail)&&void 0!==t&&t.deliver_id)&&"label"===this.scenes},isReLabeling(){var t,e;return(this.isLabelStatus===T["m"].LABELED.value||this.detailStatus===T["m"].LABELING.value)&&10===(null===(t=this.detail)||void 0===t?void 0:t.deliver_status)&&((null===(e=this.detail)||void 0===e?void 0:e.check_status)===T["q"].REJECT_REVIEW.value||this.isPageDetails)&&"relabel"===this.scenes},isAllowUpdateLabel(){var t,e,s,a,l;return this.isLabelStatus===T["m"].LABELED.value&&!(null!==(t=this.detail)&&void 0!==t&&t.check_status)&&(10===(null===(e=this.detail)||void 0===e?void 0:e.deliver_status)||!(null!==(s=this.detail)&&void 0!==s&&s.deliver_status))&&(i.a.isNil(null===(a=this.detail)||void 0===a?void 0:a.edit_label_result)||(null===(l=this.detail)||void 0===l?void 0:l.edit_label_result))},isUnDelivered(){var t,e,s,a,i,l;return 10===(null===(t=this.detail)||void 0===t?void 0:t.deliver_status)&&0===(null===(e=this.checkTask)||void 0===e?void 0:e.cycle_step)||20===(null===(s=this.detail)||void 0===s?void 0:s.deliver_status)&&2===(null===(a=this.checkTask)||void 0===a?void 0:a.cycle_step)||30===(null===(i=this.detail)||void 0===i?void 0:i.deliver_status)&&1===(null===(l=this.checkTask)||void 0===l?void 0:l.cycle_step)},isReviewer(){var t,e,s,a;const i=this.$store.getters.user.user_id.toString();return(null===(t=this.detail)||void 0===t||null===(e=t.review_by)||void 0===e?void 0:e.toString())===i||(null===(s=this.detail)||void 0===s||null===(a=s.detail_assignee)||void 0===a?void 0:a.toString())===i&&this.isReReviewing},isReviewing(){return this.isLabelStatus===T["m"].LABELED.value&&this.detail.check_status===T["q"].REVIEWING.value&&this.isUnDelivered&&"review"===this.scenes},isReviewed(){var t,e;return(null===(t=this.detail)||void 0===t?void 0:t.check_status)===T["q"].REVIEWED.value||(null===(e=this.detail)||void 0===e?void 0:e.check_status)===T["q"].REJECT_REVIEW.value},isReReviewing(){var t,e;return this.isLabelStatus===T["m"].LABELED.value&&10===(null===(t=this.detail)||void 0===t?void 0:t.deliver_status)&&((null===(e=this.detail)||void 0===e?void 0:e.check_status)===T["q"].REJECT_REVIEW.value||this.isPageDetails)&&"re_review"===this.scenes},isAllowUpdateReview(){return this.isFromReview&&!this.isReviewingAgain&&this.isLabelStatus===T["m"].LABELED.value&&this.isUnDelivered&&this.isReviewed},isReviewingAgain(){return"review_again"===this.$route.query.from&&this.isLabelStatus===T["m"].LABELED.value&&this.isUnDelivered&&this.isReviewed},isShowLog(){var t,e;return!(this.isReviewer&&(null===(t=this.checkTask)||void 0===t||!t.show_review_log)&&null!==(e=this.scenes)&&void 0!==e&&e.includes("review")&&"re_review"!==this.scenes)},isPage(){return this.type},isFromLabel(){return"label"===this.$route.query.from},isFromReview(){var t;return null===(t=this.$route.query.from)||void 0===t?void 0:t.includes("review")},isShowList(){return!!this.details.find(t=>{var e,s;return"list"===(null===t||void 0===t||null===(e=t.component)||void 0===e||null===(s=e.extra_attributes)||void 0===s?void 0:s.layout)})},isEventListener(){return this.isLabeler&&(this.isLabeling||this.isReLabeling)}},watch:{isEventListener(t){t&&window.addEventListener("beforeunload",this.handleBeforeunload)},"fetchDetail.isResolved"(t){let e=0;this.isFromLabel&&this.isLabeler&&(e=4),this.isFromReview&&this.isReviewer&&(e=6),e&&t?this.reportUpdate(e):!e&&t&&this.details[this.curIdx]&&this.fetchFlowLogs(this.details[this.curIdx].detail_id)}},mounted(){const t={},e=["detail_status","check_status","deliver_status","deliver_status_list","is_deliver","detail_valid"];i.a.forIn(i.a.cloneDeep(this.$route.query),(s,a)=>{"page_index"===a&&(this.detailPage.index=Number(s)),Object.keys(this.detailForm).includes(a)&&(t[a]=e.includes(a)?Number(s):s)}),this.detailForm=Object.assign(this.detailForm,t)},beforeDestroy(){window.removeEventListener("beforeunload",this.handleBeforeunload)},methods:{getDetailIdList(){return this.detailCopyList.filter(t=>t.isReAction).map(t=>t.detail_id)},reportRe(t){return this.getDetailIdList().length?Object(k["k"])({task_id:this.taskId,detail_id_list:this.getDetailIdList(),event_type:t}).then(()=>!0).catch(t=>{if(t.code===Dt["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");return console.log(t),!1}):(console.log("未找到返修/复检detail_id，不进行上报"),Promise.resolve())},reportUpdate(t,e={}){const s=this.details.map(t=>t.detail_id);if(!s.length)return console.log("未找到detail_id，不进行上报"),Promise.resolve();Object(k["k"])({task_id:this.taskId,detail_id_list:s,event_type:t,...e}).then(t=>{!t||this.isPageDetails||this.isShowList||this.$nextTick(()=>{this.fetchFlowLogs(this.details[this.curIdx].detail_id)})}).catch(t=>{if(t.code===Dt["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");console.log(t)})},getDetailIds(){const t=[];return this.isLabeling||this.isReLabeling||this.isFromLabel&&this.isUpdate?this.details.forEach(e=>{(this.isLabeling||this.isReLabeling&&e.isReAction||this.isFromLabel&&this.isUpdate)&&t.push(e.detail_id)}):(this.isReviewing||this.isReReviewing)&&this.detailCrossList.forEach(e=>{(this.isReviewing||this.isReReviewing&&e.isReAction)&&e.detail_id>2&&t.push(e.detail_id)}),t},reportHeartbeat(t){const e=this.getDetailIds();Object(k["l"])({task_id:this.taskId,detail_ids:e,event_type:t,event:Dt["e"][this.scenes]}).then(t=>{t&&console.log("心跳上报于"+(new Date).toLocaleTimeString("it-IT"))}).catch(t=>{if(t.code===Dt["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");console.log(t)})},handleBeforeunload(t){if(["退回","提交","关闭"].includes(this.operateType))return null;const e=window.event||t;return e&&(e.returnValue="关闭提示"),"关闭提示"},validateAnswerJson(t,e){if(!t)return!1;const s=e?JSON.parse(e):void 0,a=t.validateAnswerJson(s);return!a.valid&&(this.$Notice.error({title:"操作失败",desc:"标注结果校验不通过,请检查填写结果或联系管理员"}),console.log(a.errorMsg),this.$aegis.infoAll({msg:JSON.stringify(a),ext1:"标注结果格式校验失败",ext2:e}),!0)},handlePauseOrResume(t){this.closeModal("detail");const e=Dt["e"][this.scenes];e||this.$Message.error("请传入scenes");const s={task_id:this.taskId,detail_id_list:[],event:e};return this.isLabeling||this.isReLabeling||this.isFromLabel&&this.isUpdate?this.details.forEach(t=>{(this.isLabeling||this.isReLabeling&&t.isReAction||this.isFromLabel&&this.isUpdate)&&s.detail_id_list.push(t.detail_id)}):(this.isReviewing||this.isReReviewing)&&(this.detailCrossList.forEach(t=>{(this.isReviewing||this.isReReviewing&&t.isReAction)&&t.detail_id>2&&s.detail_id_list.push(t.detail_id)}),s.deliver_id=this.detail.deliver_id),Object(k["j"])(s).then(async()=>{"暂停"===t?(this.isPausing=!0,this.$EventBus.$emit("counter-totalTimer-pause")):"继续"===t?(this.isPausing=!1,this.$EventBus.$emit("counter-totalTimer-play")):"关闭"===t&&(this.operateType="关闭",window.close())}).catch(e=>{if(e.code===Dt["a"].LimitPageError)throw this.errorData=e.extra,Error("LimitPageError");console.log(e),this.$Notice.error({title:"",desc:t+"失败",render:s=>s("span",[`${t}失败${e.message}`])})})},changePage(t){t<=this.detailPage.total?(this.detailPage.index=t,this.fetchDetail()):this.$Message.success("这是最后一条了")},filterDetail(t){this.detailPage.index=1,this.detailForm=t,this.fetchDetail()},getQuery(){const{type:t,from:e,team_id:s,row_id:a,scenes:l,deliver_id:r,from_skip:n,json_view:o,version_id:c}=i.a.cloneDeep(this.$route.query),d={type:t,from:e,team_id:s,page_index:this.detailPage.index,row_id:a,scenes:l,from_skip:n,deliver_id:r,json_view:o,version_id:c};return i.a.forIn(this.detailForm,(t,e)=>{(t||0===t)&&(d[e]=t)}),d},createModal(t,e){e&&(this.modals.type=e),t&&(this.modals[t]=!0)},closeModal(t){t&&(this.modals[t]=!1)},handleSearchParams(){const t={};return i.a.forIn(this.detailForm,(e,s)=>{(e||0===e)&&("is_deliver"===s?t.deliver_status_list=0===e?[10]:[30,60]:(t[s]=-1!==s.indexOf("list")?[e]:e,"pack_keys"===s&&(t[s]=[e])))}),t},handleResetSearch(){i.a.forIn(this.detailForm,(t,e)=>{this.$set(this.detailForm,e,"")}),this.detailPage.index=1,this.fetchDetail()},setFontSizeEdit(t){i.a.forEach(t.items,t=>{t.attributes.editFontSize=!0}),i.a.forEach(t.$object_items,t=>{t.attributes.editFontSize=!0})},shortCutOptions(t){this.stagesMetadataSC=i.a.chain(this.$OptimusStageMetadata).find({name:t}).value().shortCuts},enterFullScreen(){this.showFullScreen=!this.showFullScreen},enterJsonView(){this.createModal("jsonView")},validateBatchData(t){let e=!0;return i.a.forEach(this.details,s=>{const{detail_is_valid:a,label:l,component:{items:r,invalid_items:n},detail_id:o}=s;if(a){const s=r.map(e=>{var s,a;return{...e.attributes,value:null===(s=i.a.find(null===t||void 0===t?void 0:t.data,{detail_id:String(o)}))||void 0===s?void 0:s[null===(a=e.attributes)||void 0===a?void 0:a.name]}});if(s&&s.find(t=>t.required&&i.a.isEmpty(t.value)))return this.$Notice.error({title:"",desc:"提示",render:t=>t("span",[`请完善 ${String(o)} 的全局标签`])}),e=!1,!1}else{const t=n.map(t=>{var e,s;return{...t.attributes,value:null===l||void 0===l||null===(e=l.invalidTags)||void 0===e||null===(s=e.find(e=>e.name===t.attributes.name))||void 0===s?void 0:s.value}});if(t&&t.find(t=>t.required&&i.a.isEmpty(t.value)))return this.$Notice.error({title:"",desc:"提示",render:t=>t("span",[`请完善 ${String(o)} 的无效标签`])}),e=!1,!1}}),e},changeDetails(t){this.details=t},handleDetailInfo(t,e=""){var s,a;let l=[];if(t.template_schema)try{const e=JSON.parse(t.template_schema);l=[...e]}catch(h){throw new Error("数据格式错误，请联系管理员")}let r={};if(t.detail_label)try{r=JSON.parse(t.detail_label)}catch(h){throw new Error("标注结果损坏，请联系管理员")}else if(t.dataset_item_content)try{const e=JSON.parse(t.dataset_item_content);if(i.a.has(e,"$answer")){const s=i.a.find(l,{key:"$answer"}),a=Object(Qe["b"])(JSON.parse(t.template_component),e.$answer);if(s){const t=new Ge.a.Validator,e=t.validate(a,JSON.parse(s.json_schema));e.valid?r=a:(console.log(e),this.$Notice.error({title:"",desc:"提示",render:t=>t("span",["导入标注结果校验不通过，请重新标注"])}))}else r=a}}catch(_){console.log(_),this.$Notice.error({title:"",desc:"提示",render:t=>t("span",["导入标注结果错误，请重新标注"])})}const n={};if(t.dataset_item_content)try{const e=JSON.parse(t.dataset_item_content),s=JSON.parse(t.dataset_file_preview_urls);Object.keys(e).forEach(t=>{"string"!==typeof t||t.startsWith("_")||(n[t]=e["_sys_cos_mappings_"+t]||e[t])}),i.a.mergeWith(n,s,(t,e)=>{if(!e)return t})}catch(h){throw new Error("数据集格式错误，请联系管理员")}if((null===t||void 0===t||null===(s=t.template_tagset)||void 0===s?void 0:s.length)>0)try{t.template_tagset.forEach(t=>{n[t.tagset_key]=JSON.parse(t.tagset_content)})}catch(h){throw new Error("关联标签集格式错误，请联系管理员")}let o={};const c=[];try{o=JSON.parse(t.template_component),o.items&&(o.items.forEach(t=>{void 0!==t.attributes.required&&!1===t.attributes.required&&c.push(t.attributes.name)}),this.requiredObj=c)}catch(_){throw new Error("标注模板格式错误，请联系管理员")}if((null===t||void 0===t||null===(a=t.helper_results)||void 0===a?void 0:a.length)>0)try{t.helper_results.forEach(s=>{let a;try{a=JSON.parse(s.service_data)}catch(_){console.error("预处理服务解析错误",_)}!a||"default"!==s.service_type&&s.service_type||(n[s.key]=a),a&&e&&s.service_type===e&&!t.detail_label&&(!r.tags&&(r.tags=[]),a.tags.forEach(t=>{const e=t.label&&o.items.find(e=>Object(cs["o"])(e.attributes.label)===t.label);if(e){var s;const a=null===(s=r.tags)||void 0===s?void 0:s.findIndex(t=>t.name===e.name),i=Object(cs["o"])(e.attributes.value);-1!==a?(r.tags[a].autoLabel=t.autoLabel,r.tags[a].value=!1===e.attributes.autoLabelValueEnabled?i:t.autoLabel.value):r.tags.push({...t,value:!1===e.attributes.autoLabelValueEnabled?i:t.autoLabel.value,name:e.attributes.name})}}))})}catch(h){throw new Error("关联预处理服务错，请联系管理员")}const d={tags:r.tags?r.tags:[],objects:r.objects?r.objects:[],fitting:r.fitting?r.fitting:[],extData:r.extData?r.extData:null},u={tags:r.invalidTags?r.invalidTags:[]};return this.shortCutOptions(o.component),this.setFontSizeEdit(o),{label:r,component:o,schema:l,context:n,isValidAnswer:d,invalidAnswer:u,key:Math.random()}}},asyncMethods:{fetchTask(){return Object(k["c"])({task_id:this.taskId,need_stat_task:!0}).then(t=>(Object.assign(this.statTask,t),t)).catch(t=>{console.log(t)})},fetchStatTask(){return Object(k["s"])({task_id:this.taskId,stat_object:["total_num","labeled_num"]}).then(t=>{const{labeled_num:e,total_num:s,user_labeled_num:a}=t;return Object.assign(this.statTask,{labeled_num:e,total_num:s,user_labeled_num:a}),this.statTask}).catch(t=>(console.log(t),this.statTask))},fetchFlowLogs(t,e){return t<3||!this.isShowLog||0!==this.detail.is_delete_source?[]:(e&&this.createModal("logs"),this.latestFlowLog={},Object(He["a"])({task_id:this.taskId,flow_code_list:[t],page:{start:0,size:100},get_cycle_step:1}).then(t=>{var e;return this.rejectData="",i.a.forEach(t.data,t=>"PASS_REVIEW"!==t.flow_action&&"PASS_APPROVE"!==t.flow_action&&"EDIT_REVIEW"!==t.flow_action&&(("REJECT_REVIEW"!==t.flow_action||(this.rejectData="质检不通过："+(t.flow_remark||"无"),!t.flow_extra||4===JSON.parse(t.flow_extra).reviewType))&&("REJECT_APPROVE"===t.flow_action?(this.rejectData="验收不通过："+(t.flow_remark||"无"),!1):void 0))),this.latestFlowLog=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e[0])||{},t}))}}}},"5f0a":function(t,e,s){},6637:function(t,e,s){"use strict";s("037e")},"6bdc":function(t,e,s){"use strict";s("127e")},"6c07":function(t,e,s){"use strict";s("9909")},"6e35":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"history-detail"},[s("Container",{attrs:{fetchObject:t.fetchDetail,isErrorPage:!(t.detail&&t.detail.detail_id)},on:{tryAgain:t.fetchDetail}},[t.detail&&t.detail.detail_id?s("template",{slot:"content"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],staticClass:"z-header z-level"},[s("info",{attrs:{detailLength:0,detail:t.detail,siteTimeout:0}}),s("div",{staticClass:"z-level__right"},[s("div",{staticClass:"z-level__item",staticStyle:{cursor:"pointer"},on:{click:t.enterFullScreen}},[s("Icon",{attrs:{type:"ios-expand",size:"20"}}),t._v("全屏")],1)])],1),0!==t.detail.is_delete_source?[s("Delete")]:[s("div",{staticClass:"z-main z-main-s"},[t.showFullScreen?s("div",{staticClass:"closeFullScreen",on:{click:t.enterFullScreen}},[s("Icon",{attrs:{type:"ios-contract",size:"18"}}),s("span",[t._v("退出全屏模式")])],1):t._e(),s("optimus-engine",{key:t.detail.key,ref:"engine",attrs:{component:t.detail.component,context:t.detail.context,answer:t.detail.isValidAnswer,schema:t.detail.schema,disabled:!0,active:!1,reference:{watermarkContent:t.userInfo.real_user_id}}})],1),t.detail.detail_is_valid?t._e():s("invalid-banner",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],attrs:{detail:t.detail}})],s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],staticClass:"z-footer z-level"},[s("Footer",{attrs:{latestFlowLog:t.latestFlowLog,rejectData:t.rejectData},on:{openLogs:t.createModal}})],1)],2):t._e()],2),s("logs",{attrs:{flowLogs:t.flowLogs,visible:t.modals.logs,loading:t.fetchFlowLogs.isPending},on:{"update:visible":function(e){return t.$set(t.modals,"logs",e)}}}),s("invalid-modal",{attrs:{visible:t.modals.invalid,detail:t.detail,statusList:{}},on:{"update:visible":function(e){return t.$set(t.modals,"invalid",e)}}})],1)},i=[],l=(s("8d0d"),s("f38f"),s("dde5")),r=s("bccd"),n=s("597a"),o={mixins:[n["a"]],data(){const t=this.$route.params.detail_id;return{detailId:Object(r["BigNumber"])(t)}},created(){this.fetchTask()},mounted(){this.fetchDetail()},asyncMethods:{fetchDetail(){const t={task_id:this.taskId,detail_id_list:[this.detailId],need_template_info:1},e=location.href.includes("workbench")?"api/workbench":"api";return Object(l["c"])(e,"listDetail",t).then(t=>{var e,s;if(null!==t&&void 0!==t&&null!==(e=t.data)&&void 0!==e&&null!==(s=e[0])&&void 0!==s&&s.detail_id){var a,i,l,r;const e=this.handleDetailInfo(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a[0]);return this.fetchFlowLogs(null===t||void 0===t||null===(i=t.data)||void 0===i||null===(l=i[0])||void 0===l?void 0:l.detail_id),Object.assign({},null===t||void 0===t||null===(r=t.data)||void 0===r?void 0:r[0],e)}return{}}).catch(t=>{throw console.log(t),new Error("内部错误，请刷新重试")})}}},c=o,d=s("2be6"),u=Object(d["a"])(c,a,i,!1,null,null,null);e["default"]=u.exports},7476:function(t,e,s){"use strict";s("f003")},"7a5d":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("queue-base",{attrs:{title:"质检","task-id":t.taskId,"fetch-object":t.fetchDetail,errorData:t.errorData},on:{"try-again":t.fetchDetail}})},i=[],l=(s("f38f"),s("dde5")),r=s("bccd"),n=s("3998"),o=s("c899"),c={components:{QueueBase:n["a"]},data(){const{task_id:t,deliver_id:e}=this.$route.params,{check_id:s}=this.$route.query;return{taskId:Object(r["BigNumber"])(t),checkId:Object(r["BigNumber"])(s),deliverId:Object(r["BigNumber"])(e),errorData:null}},created(){this.fetchDetail()},asyncMethods:{fetchDetail(){const t={task_id:this.taskId,check_id:this.checkId,deliver_id:this.deliverId};return Object(l["c"])("api/workbench","queueReview",t).then(t=>{var e,s,a,i;if(localStorage.removeItem("pack_key_list"),(null===t||void 0===t||null===(e=t.pack_keys)||void 0===e?void 0:e.length)>1)localStorage.setItem("pack_key_list",JSON.stringify(null===t||void 0===t?void 0:t.pack_keys));else if(0===(null===t||void 0===t||null===(s=t.pack_keys)||void 0===s?void 0:s.length))return{};this.$router.replace({name:"wb-task-review-detail",params:{task_id:this.taskId,check_id:this.checkId||0,pack_id:(null===t||void 0===t||null===(a=t.pack_keys)||void 0===a?void 0:a.length)>1?0:null===t||void 0===t||null===(i=t.pack_keys)||void 0===i?void 0:i[0],dataset_id:0},query:{team_id:this.$route.query.team_id,scenes:"review"}})}).catch(t=>{if(console.log(t),t.code===o["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");throw new Error(t.message)})}}},d=c,u=s("2be6"),h=Object(u["a"])(d,a,i,!1,null,null,null);e["default"]=h.exports},"7a9f":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TableFilter",[s("Form",{attrs:{inline:"","label-width":90,"label-colon":!0}},[s("Row",{attrs:{gutter:10}},[s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务编号"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务编号"},model:{value:t.form.task_id,callback:function(e){t.$set(t.form,"task_id",e)},expression:"form.task_id"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务名称关键字"},model:{value:t.form.task_name,callback:function(e){t.$set(t.form,"task_name",e)},expression:"form.task_name"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务状态"}},[s("Select",{attrs:{transfer:"",clearable:"",disabled:t.isSelect},model:{value:t.form.task_status,callback:function(e){t.$set(t.form,"task_status",e)},expression:"form.task_status"}},t._l(t.taskStatus,(function(e,a){return e.value>10&&e.value<50?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"物料类型"}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:t.form.materials_type,callback:function(e){t.$set(t.form,"materials_type",e)},expression:"form.materials_type"}},t._l(t.Materials,(function(e){return s("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{attrs:{label:"","label-width":18}},[s("Checkbox",{attrs:{disabled:t.isSelect},on:{"on-change":function(e){return t.changePage(1)}},model:{value:t.form.is_assign_team,callback:function(e){t.$set(t.form,"is_assign_team",e)},expression:"form.is_assign_team"}},[t._v("仅展示待分配小组的任务")])],1)],1)],1)],1),s("t-space",{attrs:{slot:"filterOperate",direction:"vertical"},slot:"filterOperate"},[s("t-button",{attrs:{theme:"primary",loading:t.fetchAuditTasks.isPending},on:{click:function(e){return t.changePage(1)}}},[s("t-icon",{attrs:{slot:"icon",name:"search"},slot:"icon"}),t._v("查询")],1),t.isSelect?t._e():s("t-button",{attrs:{theme:"default",disabled:t.fetchAuditTasks.isPending},on:{click:function(e){return t.reset()}}},[s("t-icon",{attrs:{slot:"icon",name:"refresh"},slot:"icon"}),t._v("重置")],1)],1)],1),t.fetchWaitAuditCount.isResolved?[s("batch",{attrs:{taskType:2,unConfirmTotal:t.waitAuditCount,selectLength:t.selection.length},on:{updateStatus:t.updateStatus,batchTask:t.batchTask}})]:t._e(),s("Table",{ref:"table",attrs:{loading:t.fetchAuditTasks.isPending,columns:t.columns,data:t.auditTasks},on:{"on-selection-change":t.selectTasks,"on-select-all":function(e){return t.selectTasksAll(!0)},"on-select-all-cancel":function(e){return t.selectTasksAll(!1)}},scopedSlots:t._u([{key:"task_id",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.task_id||"-"))])]}},{key:"task_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.task_name||"-"))])]}},{key:"creator",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.creator||"-"))])]}},{key:"materials_type",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.materials_type||"-"))])]}},{key:"total_num",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.total_num||"-"))])]}},{key:"task_progress",fn:function(t){var e=t.row;return[s("taskProgress",{attrs:{task:e,type:["已交付","已审核"]}})]}},{key:"status",fn:function(t){var e=t.row;return[s("taskStatusRender",{attrs:{value:e.task_status}})]}},{key:"audit_team_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.audit_team_name||"-"))])]}},{key:"action",fn:function(e){var a=e.row;return[a.accessible?s("div",[s("a",{on:{click:function(e){return t.getTaskDetailList(a)}}},[t._v("详情")]),a.audit_team_id&&-1!==a.audit_team_id?t._e():s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userinfo.company_id}}"}]},[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.showModal("taskAccept",[a])}}},[t._v("分配小组")])],1)]):s("a",{attrs:{disabled:""}},[t._v("安全策略不可操作")])]}}])}),s("br"),s("Row",{attrs:{type:"flex",justify:"end"}},[s("Page",{attrs:{current:t.page.index,total:t.page.total,"page-size":t.page.size,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}})],1),s("taskAccept",{attrs:{visible:t.taskAcceptModal,tasks:t.taskAcceptModel,isBatch:t.selection.length>0,isAudit:!0},on:{hideModal:function(e){t.hideModal("taskAccept","refresh"===e&&(t.reset(),t.fetchWaitAuditCount()))}}})],2)},i=[],l=(s("8d0d"),s("9ec3")),r=s("8859"),n=s("cd7e"),o=s("ccb4"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.task.total_num||!t.task.is_dynamic?s("div",{staticClass:"progress_box"},[t._l(t.typeOptions,(function(e,a){return[t.type.includes(e)?s("div",{key:a,staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v(t._s(e))]),s("Progress",{staticClass:"progress_p",attrs:{percent:t.percent(t.task[a]),"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(t.task[a]||0)+" / "+t._s(t.task.total_num||0))]),s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(t.percent(t.task[a]))+"%)")])],1):t._e()]}))],2):[s("span",[t._v("-")])]],2)},d=[],u={props:{type:Array,task:Object},data(){return{typeOptions:{labeled_num:"已标注",reviewed_num:"已质检",deliver_num:"已交付",audit_num:"已审核",deliver_receive_num:"已验收"}}},computed:{percent(){return function(t){return this.task.total_num?Math.round((t||0)/this.task.total_num*1e4)/100:0}}},methods:{isNil(t){return Object(l["isNil"])(t)}}},h=u,_=(s("7cc0"),s("2be6")),m=Object(_["a"])(h,c,d,!1,null,"e12a1378",null),v=m.exports,p=s("3a9c"),k=s("312d"),f=s("2289"),b=s("864c"),g=s("bc94"),y=s("c605"),w={components:{batch:n["a"],taskAccept:o["a"],taskProgress:v,taskStatusRender:p["a"],TableFilter:y["a"]},mixins:[r["a"]],modals:["taskAccept"],data(){return{taskStatus:k["r"],Materials:f["e"],form:{task_id:"",task_name:"",task_status:"",materials_type:"",is_assign_team:!1},columnsOptions:{task_id:"任务编号",task_name:"任务名称",creator:"对接人",materials_type:"物料类型",total_num:"题目数",task_progress:"完成进度",status:"任务状态",audit_team_name:"审核小组",action:"操作"},auditTasks:[],page:{index:1,size:10,total:0},isSelect:!1,selection:[]}},computed:{userinfo(){return this.$store.state.userinfo.user},columns(){return Object(l["map"])(this.columnsOptions,(t,e)=>{let s={title:t,slot:e};return e.includes("id")&&(s.width=180),e.includes("name")&&(s.minWidth=100),e.includes("progress")&&(s.minWidth=200),e.includes("action")&&(s.minWidth=100),e.includes("selection")&&(s={type:"selection",align:"center",width:60}),s})}},watch:{isSelect(){this.isSelect?this.columnsOptions={selection:"",...this.columnsOptions}:(this.selection.length>0&&(this.selection=[],this.$refs.table.selectAll(!1)),this.$delete(this.columnsOptions,"selection"))}},mounted(){this.reset(),this.fetchWaitAuditCount()},methods:{reset(){Object(l["forIn"])(this.form,(t,e)=>{"boolean"===typeof t&&(this.form[e]=!1),"string"===typeof t&&(this.form[e]=""),"number"===typeof t&&(this.form[e]="")}),this.changePage(1)},changePage(t){this.page.index=t,this.fetchAuditTasks()},selectTasks(t){this.selection=t},selectTasksAll(t){t&&this.$Message.info("已选当前页所有任务")},batchTask(t){this.showModal(t,this.selection)},updateStatus(t){t?(this.form.is_assign_team=!0,this.form.task_status=20,this.fetchAuditTasks()):(this.form.is_assign_team=!1,this.form.task_status="",this.fetchAuditTasks()),this.isSelect=t},getTaskDetailList(t){this.$router.push("/workbench/audit-tasks/"+t.task_id)},async mapStatTaskProgress(t){for(let e=0;e<t.length;e++){const s=await this.fetchStatTaskProgress(t[e].task_id);if(s){const a={...t[e],audit_num:s.audit_num,deliver_num:s.deliver_num,total_num:s.total_num};this.$set(this.auditTasks,e,a)}}}},asyncMethods:{fetchAuditTasks(){const{form:t,page:e}=this,s={page:{start:(e.index-1)*e.size,size:e.size,return_total:1},task_type:2,need_stat_task:!0,need_stat_deliver:!0,task_status_list:[20,30,40]};return Object(l["forIn"])(t,(t,e)=>{t&&(s[e]=t),"is_assign_team"===e&&(s[e]=t?1:0),"task_status"===e&&t&&(s.task_status_list=[t],delete s.task_status)}),b["a"].ListAuditTasks(s).then(t=>{const e=t.data.result;return this.page.total=e.total,Object(l["map"])(e.data,t=>{t.audit_team_id&&-1!==t.audit_team_id&&this.$set(t,"_disabled",!0),!t.accessible&&this.$set(t,"_disabled",!0)}),this.mapStatTaskProgress(e.data),e.data}).catch(t=>{console.log(t)})},fetchStatTaskProgress(t){const e={task_id:t,stat_object:["total_num","deliver_num","audit_num"]};return Object(g["s"])(e).then(t=>t).catch(t=>{console.log(t)})},fetchWaitAuditCount(){const t={page:{start:0,size:0,return_total:1},task_type:2,task_status:20,is_assign_team:1};return b["a"].ListAuditTasks(t).then(t=>t.data.result.total||0)}}},C=w,S=Object(_["a"])(C,a,i,!1,null,null,null);e["default"]=S.exports},"7cc0":function(t,e,s){"use strict";s("c122")},"7f65":function(t,e,s){},8518:function(t,e,s){t.exports=s.p+"static/img/illustration.b2442355.png"},"92f5":function(t,e,s){},"939b":function(t,e,s){},"940f":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.fetchTask.pending?s("Spin",{attrs:{fix:""}}):t._e(),t.fetchTask.isRejected?s("error",{attrs:{message:t.fetchTask.rejectedWith.message}}):t._e(),t.fetchTask.isResolved?[s("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("Breadcrumb",[s("BreadcrumbItem",[t._v("任务管理")]),t.labelPath?s("BreadcrumbItem",{attrs:{to:"/workbench/label-tasks"}},[t._v("标注任务")]):s("BreadcrumbItem",{attrs:{to:"/workbench/review-tasks"}},[t._v("质检任务")]),s("BreadcrumbItem",[t._v("任务详情")])],1),s("div",{staticClass:"right"},[20===t.task.task_status?[t.labelPath?[s("auth-view",{attrs:{perm:{domain:"task",action:"queue-label",extra:{team:t.task.team_id}}}},[s("Button",{staticClass:"mls",attrs:{type:"primary",shape:"circle"},on:{click:function(e){return t.goToQueue("wb-queue-label")}}},[t._v("开始标注")]),s("Button",{staticClass:"mls",attrs:{type:"primary",shape:"circle"},on:{click:function(e){return t.goToQueue("wb-queue-relabel")}}},[t._v("返修标注")])],1)]:[s("auth-view",{attrs:{perm:{domain:"task",action:"queue-review",extra:{team:t.task.team_id}}}},[s("Button",{staticClass:"mls",attrs:{type:"primary",shape:"circle"},on:{click:function(e){return t.goToQueue("wb-extract-review-task",{deliver_id:t.deliverId})}}},[t._v("抽检")]),s("Tooltip",{attrs:{transfer:""}},[s("div",{staticStyle:{"white-space":"normal"},attrs:{slot:"content"},slot:"content"},[s("span",[t._v("优先领取本人质检过的数据；完成后可领取其他未复检数据，先到先得")])]),s("Button",{staticClass:"mls",attrs:{type:"primary",shape:"circle"},on:{click:function(e){return t.goToQueue("wb-queue-rereview",{deliver_id:t.deliverId})}}},[t._v("不通过复检")])],1)],1)]]:t._e(),s("Tooltip",{attrs:{content:"关闭页面"}},[t.labelPath?s("Button",{staticClass:"mls",attrs:{type:"dashed",icon:"md-close",shape:"circle",to:"/workbench/label-tasks"}}):s("Button",{staticClass:"mls",attrs:{type:"dashed",icon:"md-close",shape:"circle",to:"/workbench/review-tasks"}})],1)],2)],1),s("Divider",{attrs:{orientation:"left"}},[t.labelPath?s("div",{staticClass:"display-flex"},[s("h3",[t._v(t._s(t.task.task_name))]),s("task-status-render",{staticClass:"mlm",attrs:{value:t.task.task_status}}),1===t.task.is_dynamic?s("Tag",{staticClass:"mls",attrs:{color:"cyan",title:"支持API动态追加数据包，并将数据包自动同步到标注任务中"}},[t._v("动态任务")]):t._e(),t.task.cross_num&&t.task.cross_num>=2?s("Tag",{staticClass:"mls",attrs:{color:"orange",title:t.task.cross_num+"个人同时标注一道题"}},[t._v(t._s(t.task.cross_num)+"人交叉")]):t._e()],1):s("div",{staticClass:"display-flex"},[s("h3",[t._v(t._s(t.task.deliver_name))]),s("batch-status-render",{staticClass:"mlm",attrs:{value:t.task.status}})],1)]),s("div",{staticClass:"margin-x"},[s("Info",{attrs:{task:t.task}}),s("Tabs",{staticClass:"mtm",attrs:{name:"0"},on:{"on-click":t.changeTab},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("TabPane",{attrs:{label:t.detailTitle,name:"Details",tab:"0"}}),s("TabPane",{attrs:{label:t.waitDetailTitle,name:"WaitDetails",tab:"0"}}),s("TabPane",{attrs:{label:t.logTitle,name:"LogDates",tab:"0"}})],1),s("Detail",{attrs:{tab:t.tab,task:t.task,roleUsers:t.roleUsers||[]}})],1)]:t._e()],2)},i=[],l=(s("f38f"),s("864c")),r=s("bc94"),n=s("e3fa"),o=s("3a9c"),c=s("a638"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"margin"},[t.labelPath?[s("Row",[s("Col",{attrs:{span:"3"}},[s("b",[t._v("项目编号")])]),s("Col",{attrs:{span:"9"}},[s("Tag",{staticClass:"mrm",staticStyle:{"font-size":"10px"},attrs:{color:"primary"}},[t._v(t._s(1===t.task.project_type?"外部":"内部"))]),s("span",[t._v(t._s(t.task.project_id||"-"))])],1),s("Col",{attrs:{span:"3"}},[s("b",[t._v("创建时间")])]),s("Col",{attrs:{span:"9"}},[s("span",[t._v(t._s(t.task.created_at||"-"))])])],1),s("Row",{staticClass:"row-height"},[s("Col",{attrs:{span:"3"}},[s("b",[t._v("任务编号")])]),s("Col",{attrs:{span:"9"}},[s("Tag",{staticClass:"mrm",attrs:{color:1===t.task.task_type?"error":"success"}},[t._v(t._s(1===t.task.task_type?"试标":"正式"))]),s("span",{staticClass:"mrm"},[t._v(t._s(t.task.task_id||"-"))])],1),s("Col",{attrs:{span:"3"}},[s("b",[t._v("标注小组")])]),s("Col",{attrs:{span:"9"}},[t._v(t._s(t.task.team_name||"-"))])],1)]:[s("Row",{staticClass:"row-height",attrs:{align:"middle"}},[s("Col",{attrs:{span:"3"}},[s("b",[t._v("批次ID")])]),s("Col",{attrs:{span:"9"}},[s("span",[t._v(t._s(t.task.deliver_id||"-"))])]),s("Col",{attrs:{span:"3"}},[s("b",[t._v("批次数量")])]),s("Col",{attrs:{span:"9"}},[s("span",[t._v(t._s(t.task.deliver_num||"-"))])])],1),s("Row",{staticClass:"row-height"},[s("Col",{attrs:{span:"3"}},[s("b",[t._v("所属任务ID")])]),s("Col",{attrs:{span:"9"}},[s("Tag",{staticClass:"mrm",attrs:{color:1===t.task.related_object_type?"error":"success"}},[t._v(t._s(1===t.task.related_object_type?"试标":"正式"))]),s("span",{staticClass:"mrm"},[t._v(t._s(t.task.task_id||"-"))])],1),s("Col",{attrs:{span:"3"}},[s("b",[t._v(" 执行小组")])]),s("Col",{attrs:{span:"9"}},[s("span",[t._v(t._s(t.task.team_name||"-"))])])],1),s("Row",{staticClass:"row-height"},[s("Col",{attrs:{span:"3"}},[s("b",[t._v("所属任务")])]),s("Col",{attrs:{span:"9"}},[s("span",{staticClass:"mrm"},[t._v(t._s(t.task.task_name||"-"))])])],1)]],2)},u=[],h={props:{task:{type:Object,default(){return{}}}},data(){return{labelPath:"wb-label-task-detail"===this.$route.name}}},_=h,m=(s("5720"),s("2be6")),v=Object(m["a"])(_,d,u,!1,null,"626d53bb",null),p=v.exports,k=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"detail"},[s("tableFilter",{attrs:{searchLoading:!t.Fetch.isResolved,btnDirection:"horizontal"},on:{search:t.filter,reset:function(e){return t.resetDetails()}}},[s("Form",{attrs:{inline:"","label-position":"right","label-width":90,"label-colon":!0}},[s("Row",{attrs:{gutter:10}},[s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{label:"任务明细ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务明细ID进行搜索"},on:{"on-enter":t.filter},model:{value:t.detailForm.detail_id_list,callback:function(e){t.$set(t.detailForm,"detail_id_list",e)},expression:"detailForm.detail_id_list"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{label:"题目ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入题目ID进行搜索"},on:{"on-enter":t.filter},model:{value:t.detailForm.dataset_item_id_list,callback:function(e){t.$set(t.detailForm,"dataset_item_id_list",e)},expression:"detailForm.dataset_item_id_list"}})],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{label:"题包Key"}},[s("Input",{attrs:{type:"text",placeholder:"输入题包Key进行搜索"},on:{"on-enter":t.filter},model:{value:t.detailForm.pack_keys,callback:function(e){t.$set(t.detailForm,"pack_keys",e)},expression:"detailForm.pack_keys"}})],1)],1),"LogDates"===t.tab?[s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{label:"是否有效"}},[s("Select",{model:{value:t.detailForm.detail_valid,callback:function(e){t.$set(t.detailForm,"detail_valid",e)},expression:"detailForm.detail_valid"}},[s("Option",{attrs:{value:1}},[t._v("有效")]),s("Option",{attrs:{value:0}},[t._v("无效")])],1)],1)],1),s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{label:"处理人"}},[s("Select",{attrs:{placeholder:"选择当前处理人",clearable:"",filterable:"",transfer:""},model:{value:t.detailForm.nick_name_list,callback:function(e){t.$set(t.detailForm,"nick_name_list",e)},expression:"detailForm.nick_name_list"}},[t._l(t.roleUsers,(function(e){return e.user_id&&e.nick_name&&e.email?[s("Option",{key:e.user_id,attrs:{value:e.nick_name,label:e.nick_name}},[s("span",[t._v(t._s(e.nick_name))])])]:t._e()}))],2)],1)],1),t.labelPath?s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"质检结果"}},[s("Select",{attrs:{transfer:""},model:{value:t.detailForm.check_status,callback:function(e){t.$set(t.detailForm,"check_status",e)},expression:"detailForm.check_status"}},t._l(t.reviewStatus,(function(e,a){return 0!==e.value?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1)],1):s("Col",{attrs:{span:"8"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"质检结果"}},[s("Select",{attrs:{transfer:""},model:{value:t.detailForm.flow_action,callback:function(e){t.$set(t.detailForm,"flow_action",e)},expression:"detailForm.flow_action"}},t._l(t.reviewResults,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1)],1)]:t._e()],2)],1)],1),s("Row",{staticClass:"mtm mbm",attrs:{type:"flex",align:"middle"}},[["WaitDetails"].includes(t.tab)&&!t.labelPath?s("Col",{attrs:{span:"24"}},[s("Icon",{attrs:{type:"ios-help-circle-outline"}}),s("span",{staticClass:"txt-muted mls"},[t._v("优先领取本人质检过的数据；完成后可领取其他未复检数据，先到先得")])],1):t._e()],1),s("Table",{ref:"details",attrs:{border:"",columns:t.columns,data:t.detailList,loading:t.Fetch.isPending},scopedSlots:t._u([{key:"detail_is_valid",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(1===a.detail_is_valid?"有效":"无效"))])]}},{key:"flow_action",fn:function(e){var a=e.row;return[s("span",[t._v(t._s("PASS_REVIEW"===a.flow_action?"通过":"EDIT_REVIEW"===a.flow_action?"修改通过":"不通过"))])]}},{key:"detail_status",fn:function(t){var e=t.row;return[s("label-status-render",{attrs:{value:e.detail_status}})]}},{key:"check_status",fn:function(t){var e=t.row;return[s("deliver-check-status-render",{attrs:{value:e.check_status}})]}},{key:"deliver_status",fn:function(e){var a=e.row;return[a.deliver_status?s("deliver-status-render",{attrs:{value:a.deliver_status>10&&a.deliver_status<70?1:0}}):s("span",[t._v("-")])]}},{key:"assignee_nick_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.assignee_nick_name||"-"))])]}},{key:"action",fn:function(e){var a=e.row,i=e.index;return[20===t.task.task_status||"LogDates"===t.tab?[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.getDetailPath(a,i)}}},[t._v(t._s("Details"===t.tab?"继续做题":"详情"))]),s("Divider",{attrs:{type:"vertical"}}),20===a.detail_status&&"Details"===t.tab?[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.returnLabel(a)}}},[t._v("退回")]),s("Divider",{attrs:{type:"vertical"}})]:t._e()]:t._e(),s("Tooltip",{attrs:{content:"点击复制分享链接到剪贴板",placement:"top",transfer:""}},[s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.copyText,expression:"copyText",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:t.handleCopySuccess,expression:"handleCopySuccess",arg:"success"},{name:"clipboard",rawName:"v-clipboard:error",value:t.handleCopyError,expression:"handleCopyError",arg:"error"}],staticClass:"row-actions",on:{click:function(e){return t.handleShareDetail(a)}}},[t._v("分享")])])]}}])}),s("Page",{staticClass:"mtm right",attrs:{current:t.detailPage.index,total:t.detailPage.total,"page-size":t.detailPage.size,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}})],1)},f=[],b=s("dde5"),g=s("26b3"),y=s("51cc"),w=s("048d"),C=s("259f"),S=s("312d"),T=s("9ec3"),I=s("db49"),$=s("c605"),x={components:{DeliverStatusRender:w["a"],LabelStatusRender:y["a"],deliverCheckStatusRender:C["a"],tableFilter:$["a"]},props:{tab:{type:String,default:"Details"},task:{type:Object,default(){return{}}},roleUsers:{type:Array,default(){return[]}}},data(){const{deliver_id:t,task_id:e}=this.$route.params;return{labelPath:"wb-label-task-detail"===this.$route.name,deliverId:t,taskId:e,reviewStatus:S["q"],reviewResults:S["p"],detailPage:{index:1,size:10,total:0},detailForm:{detail_id_list:"",detail_status:"",nick_name_list:"",dataset_item_id_list:"",check_status:"",pack_keys:"",is_deliver:"",detail_valid:"",flow_action:""},detailColumns:[{title:"任务明细ID",key:"detail_id",minWidth:120},{title:"题目ID",key:"dataset_item_id",minWidth:120},{title:"题包Key",key:"pack_key",minWidth:120},{title:"当前处理人",slot:"assignee_nick_name",minWidth:120},{title:"操作",slot:"action",minWidth:120}],labelLogColumns:[{title:"任务明细ID",key:"detail_id",minWidth:120},{title:"题目ID",key:"dataset_item_id",minWidth:120},{title:"题包Key",key:"pack_key",minWidth:120},{title:"我的标注时间",key:"detail_assign_at",minWidth:120},{title:"是否有效",slot:"detail_is_valid",minWidth:120},{title:"当前标注状态",slot:"detail_status",minWidth:120},{title:"当前质检结果",slot:"check_status",minWidth:120},{title:"当前交付状态",slot:"deliver_status",minWidth:120},{title:"当前处理人",slot:"assignee_nick_name",minWidth:120},{title:"操作",slot:"action",minWidth:120}],reviewLogColumns:[{title:"任务明细ID",key:"detail_id",minWidth:120},{title:"题目ID",key:"dataset_item_id",minWidth:120},{title:"题包Key",key:"pack_key",minWidth:120},{title:"我的质检时间",key:"detail_assign_at",minWidth:120},{title:"我的质检结果",slot:"flow_action",minWidth:120},{title:"是否有效",slot:"detail_is_valid",minWidth:120},{title:"当前处理人",slot:"assignee_nick_name",minWidth:120},{title:"操作",slot:"action",minWidth:120}],detailList:[],columns:[],copyText:""}},watch:{tab(){this.columns=this.detailColumns,"LogDates"===this.tab&&(this.columns=this.labelPath?this.labelLogColumns:this.reviewLogColumns),this.filter()}},created(){this.columns=this.detailColumns,"LogDates"===this.tab&&(this.columns=this.labelPath?this.labelLogColumns:this.reviewLogColumns),this.Fetch()},methods:{changePage(t){this.detailPage.index=t,this.Fetch()},resetPage(){this.detailPage={index:1,size:10,total:0}},resetDetails(){Object(T["forIn"])(this.detailForm,(t,e)=>{this.$set(this.detailForm,e,"")}),this.Fetch()},handleCopySuccess(){this.$Message.success("已将分享链接复制到剪贴板")},handleCopyError(){this.$Message.error("复制分享链接失败")},handleShareDetail(t){const{host:e,protocol:s}=window.location;let a="wb-task-label-detail";const i={task_id:this.taskId};this.labelPath?i.pack_key=t.pack_key:(a="wb-task-review-detail",i.check_id=0,i.pack_id=t.pack_key||0,i.dataset_id=0);const l=this.$router.resolve({name:a,params:i});return this.copyText=`${s}//${I["a"].SHARE_DOMAIN?I["a"].SHARE_DOMAIN:e}${l.href}`,this.copyText},returnLabel(t){return Object(g["a"])({task_id:this.task.task_id,flow_code_list:[String(t.detail_id)],page:{start:0,size:100}}).then(e=>{e.data[0]&&"SAVE_LABEL"===e.data[0].flow_action?this.$Modal.confirm({title:"确定要退回题目吗？",content:"<p>题目中有已保存的标注内容，退回将被清空。</p><p>点击确定按钮继续退回。</p>",onOk:()=>this.fetchReturn(t)}):this.fetchReturn(t)})},routeChange(t,e){const s=this.$router.resolve({name:this.labelPath?"wb-task-label-detail":"wb-task-review-detail",params:{task_id:this.taskId,...t||{}},query:{team_id:this.task.team_id,...e||{}}});window.open(s.href,"_blank")},getDetailPath(t,e){var s;const a=null!==(s=t.pack_key)&&void 0!==s?s:0,i=this.labelPath?{pack_key:a}:{check_id:t.check_id||0,pack_id:a,dataset_id:0};let l={};if("LogDates"===this.tab){const s={};Object(T["forIn"])(this.detailForm,(t,e)=>{(t||0===t)&&(s[e]=t)}),l={type:"page",from:this.labelPath?"label":"review",scenes:this.labelPath?"label_again":"review_again",page_index:e+1+(this.detailPage.index-1)*this.detailPage.size,row_id:t.detail_id,deliver_id:this.deliverId,...s}}else if("Details"===this.tab){var r,n,o,c;this.detailList.length>1&&(null===(r=this.detailList)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.pack_key)!==(null===(o=this.detailList)||void 0===o||null===(c=o[1])||void 0===c?void 0:c.pack_key)&&((null===i||void 0===i?void 0:i.pack_key)&&(i.pack_key=0),(null===i||void 0===i?void 0:i.pack_id)&&(i.pack_id=0)),l.scenes=this.labelPath?"label":"review",!this.labelPath&&(l.row_id=t.detail_id)}else l.scenes=this.labelPath?"relabel":"re_review",!this.labelPath&&(l.row_id=t.detail_id);this.routeChange(i,l)},filter(){this.resetPage(),this.Fetch()}},asyncMethods:{Fetch(){return this["fetch"+this.tab]&&this["fetch"+this.tab]()},fetchDetails(){const t=this.detailPage,e={task_id:this.taskId,page:{start:(t.index-1)*t.size,size:t.size,return_total:1}};return this.labelPath?(e.status=[20,25],l["a"].ListMyLabelDetail(e).then(e=>{var s;if(null===e||void 0===e||!e.data)return[];const a=(null===(s=e.data)||void 0===s?void 0:s.result)||{};return t.total=(null===a||void 0===a?void 0:a.total)||0,this.detailList=a.data,a.data}).catch(t=>{console.log(t)})):(e.status=[30],e.check_status=[40],e.deliver_id=this.deliverId,l["a"].ListMyReviewDetail(e).then(e=>{const s=e.data.result;return t.total=s.total,this.detailList=s.data,s.data}).catch(t=>{console.log(t)}))},fetchWaitDetails(){const t=this.detailPage,e={task_id:this.taskId,page:{start:(t.index-1)*t.size,size:t.size,return_total:1}};return Object(T["forIn"])(this.detailForm,(t,s)=>{(t||0===t)&&(e[s]=-1!==s.indexOf("list")?[t]:t,"pack_keys"===s&&(e[s]=[t]))}),this.labelPath?l["a"].listMyReLabelDetail(e).then(e=>{const s=e.data.result;return t.total=s.total,this.detailList=s.data,s.data}).catch(t=>{console.log(t)}):(e.check_status=[40],e.deliver_id=this.deliverId,l["a"].listReReviewDetail(e).then(e=>{const s=e.data.result;return t.total=s.total,s.data.forEach(t=>{30!==t.detail_status&&50!==t.detail_status&&70!==t.detail_status&&this.$set(t,"_disabled",!0)}),this.detailList=s.data,s.data}).catch(t=>{console.log(t),this.$Message.error(t.message)}))},fetchLogDates(){const t=this.detailPage,e={task_id:this.taskId,page:{start:(t.index-1)*t.size,size:t.size,return_total:1}};return Object(T["forIn"])(this.detailForm,(t,s)=>{(t||0===t)&&(e[s]=-1!==s.indexOf("list")?[t]:t,"pack_keys"===s&&(e[s]=[t]))}),this.labelPath?l["a"].ListMyLabelDetailLog(e).then(e=>{const s=e.data.result;return t.total=s.total,this.detailList=s.data,s.data}).catch(t=>{console.log(t)}):(e.deliver_id=this.deliverId,l["a"].ListMyReviewDetailLog(e).then(e=>{const s=e.data.result;return t.total=s.total,this.detailList=s.data,s.data}).catch(t=>{console.log(t),this.$Message.error(t.message)}))},fetchReturn(t){const e={task_id:this.taskId,pack_keys:[t.pack_key]};return!this.labelPath&&(e.check_id=t.check_id),Object(b["c"])("api/workbench",this.labelPath?"returnLabel":"returnReview",e).then(()=>{this.$Message.info("题目已退回"),this.Fetch()}).catch(t=>{console.log(t),this.$Message.error("退回失败，请重试")})}}},D=x,L=(s("47a5"),Object(m["a"])(D,k,f,!1,null,"3785af79",null)),R=L.exports,P=s("1ff2"),j={components:{TaskStatusRender:o["a"],BatchStatusRender:c["a"],Info:p,Detail:R,error:P["a"]},data(){const{deliver_id:t,task_id:e}=this.$route.params;return{labelPath:"wb-label-task-detail"===this.$route.name,deliverId:t,taskId:e,tab:this.$route.query.tab||"Details",detailTitle:"",waitDetailTitle:"",logTitle:""}},async created(){this.labelPath?(this.waitDetailTitle="待返修",this.detailTitle="标注中",this.logTitle="我的标注记录"):(this.waitDetailTitle="不通过复检",this.detailTitle="质检中",this.logTitle="我的质检记录"),this.fetchTask()},methods:{async goToQueue(t,e,s){const{task:a,taskId:i}=this;let l=!1;switch(t){case"wb-queue-label":if(l=await this.validateTeamCondition("labeler"),!l)break;break;case"wb-extract-review-task":l=!0;break;default:l=!0;break}if(!l)return;const r=this.$router.resolve({name:t,params:{task_id:i,...e||{}},query:{team_id:a.team_id,...s||{}}});window.open(r.href,"_blank")},changeTab(t){this.$route.query.tab!==t&&(this.tab=t,this.$router.replace({query:{tab:t}}))},validateTeamCondition(t){const{[t+"_condition"]:e}=this.task;return!e||"{}"===e||this.fetchCheckCondition(t)}},asyncMethods:{fetchTask(){const t={task_id:this.taskId};return this.labelPath?l["a"].GetTask(t).then(t=>{var e,s,a;return null!==t&&void 0!==t&&null!==(e=t.data)&&void 0!==e&&null!==(s=e.result)&&void 0!==s&&s.team_id&&this.fetchRoleUsers(t.data.result.team_id),(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.result)||{}}).catch(t=>{throw new Error("获取数据失败："+t.message)}):(t.deliver_id=this.deliverId,l["a"].GetDeliverWithTaskInfo(t).then(t=>{const e=t.data.result,s=Object.assign(e||{},(null===e||void 0===e?void 0:e.task_info)||{},{team_id:e.team_id});return s.team_id&&this.fetchRoleUsers(s.team_id),s}).catch(t=>{throw new Error("获取数据失败："+t.message)}))},fetchRoleUsers(t){const e={object_id:t,object_type:"team",user_type:"user",page:{start:0,size:100,return_total:1}};return Object(n["q"])(e).then(t=>t.data).catch(t=>(console.log(t),Promise.reject("获取用户列表失败："+t.message)))},fetchCheckCondition(t){const e={labeler:{label:"标注",value:1},reviewer:{label:"质检",value:2}},s={task_id:this.task.task_id,operate_type:e[t].value};return Object(r["a"])(s).then(()=>!0).catch(s=>(console.log(s),this.$Message.error(`您不符合当前任务的${e[t].label}员要求，不能进行${e[t].label}`),!1))}}},O=j,F=(s("e26c"),Object(m["a"])(O,a,i,!1,null,"4cbb7b04",null));e["default"]=F.exports},9620:function(t,e,s){},9647:function(t,e,s){},9777:function(t,e,s){"use strict";s("9620")},"97db":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Layout",[t.$route.meta.group?s("Sider",{class:t.isGlobalGray&&"global-gray",style:{background:"#fff"},attrs:{"hide-trigger":""}},[s("Menu",{ref:"menu",attrs:{"active-name":t.activeName,theme:"light",width:"auto"}}),s("Menu",{key:t.group[0],staticClass:"console_s_menu",attrs:{"active-name":t.activeName,theme:"light",width:"auto"}},[t._l(t.menuOptions[t.group[0]],(function(e){return[void 0===e.visible||e.visible?s("MenuItem",{directives:[{name:"permissions",rawName:"v-permissions",value:e.permissions,expression:"item.permissions"}],attrs:{name:e.name,to:{name:e.name}}},[s("span",[t._v(t._s(e.title))])]):t._e()]}))],2)],1):t._e(),s("Layout",{staticClass:"layout-container"},[s("Content",{staticClass:"layout-container-content"},[s("keep-alive",[t.$route.meta.keepAlive?s("router-view"):t._e()],1),t.$route.meta.keepAlive?t._e():s("router-view")],1),s("Copyright")],1)],1)},i=[],l=s("189e"),r=s("dde5"),n=s("2a20"),o=s("db49");const c=["2022-12-05 18:00:00","2022-12-07 09:00:00"];var d={components:{Copyright:n["default"]},data(){const t=new Date,e=new Date(c[0]),s=new Date(c[1]);return{isGlobalGray:t>=e&&t<=s&&o["a"].INSIDE_DOMAIN,Config:o["a"],isTeamLeaderOfAnyBusiness:!1,menuOptions:{"wb-tasks":[{name:"wb-bid-tasks",title:"试标管理",tip:"管理承接的试标任务",visible:!o["a"].PRIVATIZATION},{name:"wb-formal-tasks",title:"标注管理",tip:"管理承接的正式任务"},{name:"wb-audit-tasks",title:"审核管理",tip:"管理承接的正式任务",visible:!o["a"].PRIVATIZATION}],"wb-my-task":[{name:"wb-tasks-label",title:"标注任务"},{name:"wb-tasks-review",title:"质检任务"}],"wb-exam":[{name:"wb-tasks-workTime",title:"工时报表"}],"wb-salary":[{name:"wb-settlement-task-config",title:"任务关联信息",permissions:{domain:"menu",action:"view",extra:{name:"wb-task-settlement"}}},{name:"wb-settlement-monthly-salary",title:"人员关联信息",permissions:{domain:"menu",action:"view",extra:{name:"wb-task-settlement"}}},{name:"wb-settlement-work-hour",title:"结算工时"}]}}},computed:{userInfo(){return this.$store.state.userinfo},activeName(){return this.group[1]||this.$route.name},group(){var t;return null===(t=this.$route.meta.group)||void 0===t?void 0:t.split(".")}},async created(){await this.fetchIsTeamLeaderOfAnyBusiness(),await this.fetchIsSettlementPermitted(),this.$nextTick(()=>{this.$refs.menu.updateOpened(),this.$refs.menu.updateActiveName()})},asyncMethods:{fetchIsSettlementPermitted(){const{company_id:t}=this.userInfo.user,e={data:[{domain:"settlement",action:"view",extra:{company:t.toString()}}]};return Object(r["c"])("api/auth","isPermitted",e).then(t=>t[0])},fetchIsTeamLeaderOfAnyBusiness(){return Object(l["b"])()}}},u=d,h=s("2be6"),_=Object(h["a"])(u,a,i,!1,null,null,null);e["default"]=_.exports},"98f7":function(t,e,s){},9909:function(t,e,s){},"9a69":function(t,e,s){},"9d1c":function(t,e,s){},"9f02":function(t,e,s){"use strict";s("ecd58")},a3fb:function(t,e,s){"use strict";s("7f65")},a7de:function(t,e,s){},a822:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Breadcrumb",[s("BreadcrumbItem",[t._v("我的任务")]),s("BreadcrumbItem",{attrs:{to:"/workbench/review-tasks/extract-review-tasks/"+t.taskId+"/"+t.deliverId+"?team_id="+t.$route.query.team_id}},[t._v("质检任务")]),s("BreadcrumbItem",[t._v(t._s(t.isEdit?"编辑抽检任务":"新建抽检任务"))])],1),s("t-divider",{attrs:{align:"left"}},[s("h3",[t._v(t._s(t.isEdit?"编辑抽检任务":"新建抽检任务"))])]),s("div",{staticClass:"padding",staticStyle:{position:"relative"}},[t.fetchCheckTask.isPending||t.fetchTask.isPending||t.fetchDeliver.isPending?s("Spin",{attrs:{fix:""}}):t._e(),s("Form",{ref:"form",attrs:{model:t.form,"label-position":"left","label-width":160,"label-colon":!0}},[s("h4",[t._v("1、基础信息")]),s("div",{staticClass:"padding width"},[s("FormItem",{attrs:{label:"所属任务"}},[s("span",[t._v(t._s(t.task.task_name))]),t.task.cross_num>=2?s("span",{staticClass:"txt-muted"},[t._v("（交叉标注）")]):t._e(),t.task.pack_num?s("span",{staticClass:"txt-muted"},[t._v("（题包任务）")]):t._e()]),s("FormItem",{attrs:{label:"所属批次"}},[s("span",[t._v(t._s(t.deliver.deliver_name))])]),s("FormItem",{attrs:{label:"抽检名称",prop:"check_name",rules:t.rule_not_empty}},[s("Input",{attrs:{type:"text",placeholder:"请输入抽检任务名称"},model:{value:t.form.check_name,callback:function(e){t.$set(t.form,"check_name",e)},expression:"form.check_name"}})],1),s("FormItem",{attrs:{label:"是否最后一次抽检",prop:"is_finish_check",rules:t.rule_not_empty}},[s("t-switch",{attrs:{label:["开","关"],size:"large"},model:{value:t.form.is_finish_check,callback:function(e){t.$set(t.form,"is_finish_check",e)},expression:"form.is_finish_check"}}),s("span",{staticClass:"txt-muted"},[t._v("（开启后本批次不可创建新的抽检任务）")])],1),s("FormItem",{attrs:{label:"质检员",prop:"is_assign_reviewer",rules:t.rule_not_empty}},[s("div",{staticClass:"mbs inline"},[s("RadioGroup",{on:{"on-change":t.getNum},model:{value:t.form.is_assign_reviewer,callback:function(e){t.$set(t.form,"is_assign_reviewer",e)},expression:"form.is_assign_reviewer"}},[s("Radio",{attrs:{label:0}},[t._v("全部质检员")]),s("Radio",{attrs:{label:1}},[t._v("指定质检员")])],1),1===t.form.is_assign_reviewer?[s("Select",{ref:"reviewer_list",staticClass:"mls",attrs:{multiple:"",filterable:"",transfer:"",placeholder:"请选择指定的质检员"},on:{"on-open-change":function(e){e&&t.fetchRoleUsers()},"on-query-change":function(e){return t.fetchRoleUsers(e)},"on-change":t.getNum},model:{value:t.form.reviewer_list,callback:function(e){t.$set(t.form,"reviewer_list",e)},expression:"form.reviewer_list"}},[t._l(t.roleUsers,(function(e){return e.role_type.includes("admin")||e.role_type.includes("reviewer")?[s("Option",{key:e.user_id,attrs:{value:e.user_id,label:e.nick_name,tag:e.nick_name}},[s("p",[t._v(t._s(e.nick_name))]),s("p",{staticClass:"txt-muted"},[t._v(t._s(e.email))])])]:t._e()}))],2)]:t._e()],2),s("div",{staticClass:"mbs"},[s("Checkbox",{model:{value:t.form.is_label_editable,callback:function(e){t.$set(t.form,"is_label_editable",e)},expression:"form.is_label_editable"}},[t._v("允许质检员修改结果")])],1),s("div",{staticClass:"mbs"},[s("Checkbox",{model:{value:t.form.is_reviewer_view_log,callback:function(e){t.$set(t.form,"is_reviewer_view_log",e)},expression:"form.is_reviewer_view_log"}},[t._v("允许质检员查看日志")])],1)])],1),s("h4",[t._v("2、数据范围")]),s("div",{staticClass:"padding width"},[s("FormItem",{attrs:{label:"动态添加",prop:"allow_auto_add",rules:t.rule_not_empty}},[s("div",{staticClass:"mbs"},[s("i-switch",{attrs:{disabled:t.isEdit},scopedSlots:t._u([{key:"open",fn:function(){return[t._v("开")]},proxy:!0},{key:"close",fn:function(){return[t._v("关")]},proxy:!0}]),model:{value:t.form.allow_auto_add,callback:function(e){t.$set(t.form,"allow_auto_add",e)},expression:"form.allow_auto_add"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.form.allow_auto_add,expression:"form.allow_auto_add"}],staticClass:"txt-muted"},[t._v("（每分钟会自动添加符合筛选条件的数据到抽检任务）")])],1)]),s("FormItem",{attrs:{label:"筛选条件",prop:"is_range",rules:t.rule_not_empty}},[s("div",{staticClass:"mbs"},[s("RadioGroup",{on:{"on-change":t.getNum},model:{value:t.form.is_range,callback:function(e){t.$set(t.form,"is_range",e)},expression:"form.is_range"}},[s("Radio",{attrs:{label:0,disabled:t.isEdit||t.form.allow_auto_add}},[t._v("全部")]),s("Radio",{attrs:{label:1,disabled:t.isEdit}},[t._v("自定义")])],1)],1),s("Alert",{attrs:{"show-icon":""}},[t.form.is_range?t._e():s("p",[t._v("未指定筛选条件时，数据范围为整个批次数据")]),s("p",[t._v("支持多轮质检：已抽检数据若再次抽检，原质检结果将失效")])]),s("div",{staticStyle:{display:"flex","flex-direction":"column"}},[1===t.form.is_range?[s("div",{staticClass:"mbs"},[s("p",[t._v("需同时满足：")])]),s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"isCheckIds",staticClass:"auto-width",attrs:{disabled:t.isEdit},on:{"on-change":t.getNum},model:{value:t.form.isCheckIds,callback:function(e){t.$set(t.form,"isCheckIds",e)},expression:"form.isCheckIds"}},[t._v("筛选抽检任务")]),t.form.isCheckIds?[s("Select",{ref:"check_id_list",staticClass:"mls",attrs:{disabled:t.isEdit,multiple:"",filterable:"",transfer:"",placeholder:"请选择抽检任务"},on:{"on-open-change":function(e){e&&t.fetchCheckTasks()},"on-change":t.getNum},model:{value:t.form.check_id_list,callback:function(e){t.$set(t.form,"check_id_list",e)},expression:"form.check_id_list"}},[t._l(t.checkTasks,(function(e){return[s("Option",{key:e.check_id.toString(),attrs:{value:e.check_id.toString()}},[t._v(t._s(e.check_name))])]}))],2)]:t._e()],2),s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"isCheckStatus",staticClass:"auto-width",attrs:{disabled:t.isEdit},on:{"on-change":t.getNum},model:{value:t.form.isCheckStatus,callback:function(e){t.$set(t.form,"isCheckStatus",e)},expression:"form.isCheckStatus"}},[t._v("筛选质检结果")]),t.form.isCheckStatus?s("Row",{staticStyle:{width:"100%"}},[s("Select",{ref:"check_status_list",staticClass:"mls",attrs:{disabled:t.isEdit,multiple:"",filterable:"",transfer:"",placeholder:"请选择质检结果"},on:{"on-change":t.getNum},model:{value:t.form.check_status_list,callback:function(e){t.$set(t.form,"check_status_list",e)},expression:"form.check_status_list"}},t._l(t.checkStatusOptions,(function(e){return s("Option",{key:e.value,attrs:{value:e.value,disabled:-1===e.value&&t.form.isCheckIds}},[t._v(t._s(e.label))])})),1),s("Row",{attrs:{type:"flex",justify:"start",align:"middle"}},[s("small",{staticClass:"mls"},[t._v("是否忽略失效的质检结果")]),s("i-switch",{staticClass:"mls",attrs:{size:"large",disabled:t.isEdit},on:{"on-change":t.getNum},scopedSlots:t._u([{key:"open",fn:function(){return[t._v("忽略")]},proxy:!0},{key:"close",fn:function(){return[t._v("包含")]},proxy:!0}],null,!1,3452185245),model:{value:t.form.ignore_invalid_check_status,callback:function(e){t.$set(t.form,"ignore_invalid_check_status",e)},expression:"form.ignore_invalid_check_status"}})],1)],1):t._e()],1),t.isCross?t._e():[s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"is_assign_labeler",staticClass:"auto-width",attrs:{disabled:t.isEdit},on:{"on-change":t.getNum},model:{value:t.form.is_assign_labeler,callback:function(e){t.$set(t.form,"is_assign_labeler",e)},expression:"form.is_assign_labeler"}},[t._v("指定标注员的提交结果")]),t.form.is_assign_labeler?[s("Select",{ref:"detail_labeler_list",staticClass:"mls",attrs:{disabled:t.isEdit,multiple:"",filterable:"",transfer:"",placeholder:"请选择指定的标注员"},on:{"on-open-change":function(e){e&&t.fetchTaskLabelers()},"on-query-change":function(e){return t.fetchTaskLabelers(e)},"on-change":t.getNum},model:{value:t.form.detail_labeler_list,callback:function(e){t.$set(t.form,"detail_labeler_list",e)},expression:"form.detail_labeler_list"}},[t._l(t.taskLabelers,(function(e){return[s("Option",{key:e.user_id,attrs:{value:e.user_id,label:e.nick_name,tag:e.nick_name}},[s("p",[t._v(t._s(e.nick_name))]),s("p",{staticClass:"txt-muted"},[t._v(t._s(e.email))])])]}))],2)]:t._e()],2),s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"is_assign_label_time",staticClass:"auto-width",attrs:{disabled:t.isEdit},on:{"on-change":t.getNum},model:{value:t.form.is_assign_label_time,callback:function(e){t.$set(t.form,"is_assign_label_time",e)},expression:"form.is_assign_label_time"}},[t._v("指定标注提交时间")]),t.form.is_assign_label_time?[s("DatePicker",{ref:"label_time",staticClass:"mls",staticStyle:{width:"100%"},attrs:{disabled:t.isEdit,type:"datetimerange",placeholder:"开始时间 - 结束时间"},on:{"on-change":t.getNum},model:{value:t.form.label_time,callback:function(e){t.$set(t.form,"label_time",e)},expression:"form.label_time"}})]:t._e()],2),t.isPack?t._e():s("div",{staticClass:"mbs"},[s("Tooltip",{attrs:{placement:"left",transfer:"",delay:1e3}},[s("span",{staticStyle:{"white-space":"normal"},attrs:{slot:"content"},slot:"content"},[t._v("筛选标注结果和调整有效比例不能同时选择")]),s("Checkbox",{ref:"isLabelFilter",staticClass:"auto-width",attrs:{disabled:t.isEdit||t.form.is_valid_percent},on:{"on-change":t.getNum},model:{value:t.form.isLabelFilter,callback:function(e){t.$set(t.form,"isLabelFilter",e)},expression:"form.isLabelFilter"}},[t._v("筛选标注结果（仅选择器类型）")])],1),t.form.isLabelFilter?[s("br"),s("t-space",{attrs:{align:"center"}},[s("RadioGroup",{model:{value:t.groupLogic,callback:function(e){t.groupLogic=e},expression:"groupLogic"}},[s("Radio",{attrs:{label:"and"}},[t._v("满足以下全部条件")]),s("Radio",{attrs:{label:"or"}},[t._v("满足以下任一条件")])],1)],1),s("LabelFilter",{ref:"LabelFilter",attrs:{filterType:"label",template:t.template,editEnabled:!t.isEdit},on:{"update:filter":function(e){t.form.LabelFilterList=e},getNum:t.getNum}}),s("AttributesLabel",{ref:"AttributesLabel",attrs:{filterType:"label",template:t.template,editEnabled:!t.isEdit},on:{"update:filter":function(e){t.form.AttributesLabel=e},getNum:t.getNum}})]:t._e()],2)],t.isCross?[s("div",{staticClass:"mbs"},[s("Checkbox",{ref:"isCrossFilter",staticClass:"auto-width",attrs:{disabled:t.isEdit},on:{"on-change":t.getNum},model:{value:t.form.isCrossFilter,callback:function(e){t.$set(t.form,"isCrossFilter",e)},expression:"form.isCrossFilter"}},[t._v("筛选结果评价指标（仅交叉标注）")]),t.form.isCrossFilter?[s("br"),s("t-space",{attrs:{align:"center"}},[s("RadioGroup",{model:{value:t.groupLogic,callback:function(e){t.groupLogic=e},expression:"groupLogic"}},[s("Radio",{attrs:{label:"and"}},[t._v("满足以下全部条件")]),s("Radio",{attrs:{label:"or"}},[t._v("满足以下任一条件")])],1)],1),s("LabelFilter",{ref:"CrossFilter",attrs:{filterType:"cross",template:t.template,editEnabled:!t.isEdit,scene:"check"},on:{"update:filter":function(e){t.form.CrossFilterList=e},getNum:t.getNum}}),s("AttributesLabel",{ref:"AttributesLabel",attrs:{filterType:"cross",template:t.template,editEnabled:!t.isEdit},on:{"update:filter":function(e){t.form.AttributesLabel=e},getNum:t.getNum}})]:t._e()],2)]:t._e(),s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"is_detail_id_list",staticClass:"auto-width",attrs:{disabled:t.isEdit||t.form.is_item_id_list||t.form.is_pack_key_list},on:{"on-change":t.getNum},model:{value:t.form.is_detail_id_list,callback:function(e){t.$set(t.form,"is_detail_id_list",e)},expression:"form.is_detail_id_list"}},[t._v("指定任务明细ID")]),t.form.is_detail_id_list?[s("Input",{attrs:{type:"textarea",autosize:{maxRows:6},placeholder:"请输入要筛选的任务明细ID，不支持筛选超过500个ID",disabled:t.isEdit},on:{"on-change":t.getNum},model:{value:t.form.detail_id_list,callback:function(e){t.$set(t.form,"detail_id_list",e)},expression:"form.detail_id_list"}}),s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)]:t._e()],2),s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"is_item_id_list",staticClass:"auto-width",attrs:{disabled:t.isEdit||t.form.is_detail_id_list||t.form.is_pack_key_list},on:{"on-change":t.getNum},model:{value:t.form.is_item_id_list,callback:function(e){t.$set(t.form,"is_item_id_list",e)},expression:"form.is_item_id_list"}},[t._v("指定题目ID")]),t.form.is_item_id_list?[s("Input",{attrs:{type:"textarea",autosize:{maxRows:6},disabled:t.isEdit,placeholder:"请输入要筛选的题目ID，不支持筛选超过500个ID"},on:{"on-change":t.getNum},model:{value:t.form.item_id_list,callback:function(e){t.$set(t.form,"item_id_list",e)},expression:"form.item_id_list"}}),s("Tooltip",{attrs:{content:"ID间的间隔符号支持中英文逗号、分号、空格、换行符",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)]:t._e()],2),s("div",{staticClass:"mbs inline"},[s("Checkbox",{ref:"is_pack_key_list",staticClass:"auto-width",attrs:{disabled:t.isEdit||t.form.is_detail_id_list||t.form.is_item_id_list},on:{"on-change":t.getNum},model:{value:t.form.is_pack_key_list,callback:function(e){t.$set(t.form,"is_pack_key_list",e)},expression:"form.is_pack_key_list"}},[t._v("指定题包Key")]),t.form.is_pack_key_list?[s("Input",{attrs:{type:"textarea",autosize:{maxRows:6},disabled:t.isEdit,placeholder:"请输入要筛选的题包Key，不支持筛选超过500个Key"},on:{"on-change":t.getNum},model:{value:t.form.pack_key_list,callback:function(e){t.$set(t.form,"pack_key_list",e)},expression:"form.pack_key_list"}}),s("Tooltip",{attrs:{content:"Key间的间隔符号支持中英文逗号、分号、空格、换行符",placement:"top",transfer:"","max-width":300}},[s("Icon",{staticClass:"mls",attrs:{type:"ios-help-circle-outline"}})],1)]:t._e()],2)]:t._e()],2)],1),1!==t.form.is_range||t.isCross||t.isPack?t._e():[s("FormItem",{attrs:{label:"调整有效/无效比例",prop:"is_valid_percent",rules:t.rule_not_empty}},[s("div",{staticClass:"mbs inline",staticStyle:{height:"33.8px"}},[s("Tooltip",{attrs:{placement:"left",transfer:"",delay:1e3}},[s("span",{staticStyle:{"white-space":"normal"},attrs:{slot:"content"},slot:"content"},[t._v("调整有效比例和筛选标注结果不能同时选择")]),s("i-switch",{attrs:{disabled:t.isEdit||t.form.isLabelFilter},on:{"on-change":t.getNum},model:{value:t.form.is_valid_percent,callback:function(e){t.$set(t.form,"is_valid_percent",e)},expression:"form.is_valid_percent"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v("是")]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v("否")])])],1),t.form.is_valid_percent?s("div",{staticClass:"mlm"},[s("span",{staticClass:"mlm"},[t._v("标注有效的占比")]),s("InputNumber",{ref:"valid_percent",staticClass:"mlm",attrs:{disabled:t.isEdit,min:0,max:100,precision:.1},on:{"on-change":t.getNum},model:{value:t.form.valid_percent,callback:function(e){t.$set(t.form,"valid_percent",e)},expression:"form.valid_percent"}}),s("span",{staticClass:"mlm"},[t._v("%")])],1):t._e(),t.form.is_valid_percent&&null===t.form.valid_percent?s("div",{staticClass:"mlm txt-red"},[t._v("不能为空")]):t._e()],1),t.isEdit||t.form.is_valid_percent&&(!t.form.is_valid_percent||null===t.form.valid_percent)?t._e():s("p",{staticClass:"txt-muted"},[s("span",[t._v(t._s(t.form.is_valid_percent?"(调整后：":"(调整前："))]),s("span",[t._v(t._s("有效数"+t.statCheck.valid_wait_add_count+"，无效数"+(t.statCheck.range_wait_add_count-t.statCheck.valid_wait_add_count)+")"))])])])]],2),s("h4",[t._v("3、抽检配置")]),s("div",{staticClass:"padding width"},[s("FormItem",{attrs:{label:"抽取方式",prop:"queue_type",rules:t.rule_not_empty}},[s("RadioGroup",{model:{value:t.form.queue_type,callback:function(e){t.$set(t.form,"queue_type",e)},expression:"form.queue_type"}},[s("Radio",{attrs:{label:0,disabled:t.isEdit}},[t._v("随机抽取")]),s("Radio",{attrs:{label:1,disabled:t.isEdit}},[t._v("顺序抽取")])],1)],1),t.form.allow_auto_add?s("FormItem",{attrs:{label:"本次抽检数量"}},[s("div",{staticClass:"inline"},[s("span",{staticClass:"txt-muted"},[t._v("动态添加抽检任务默认全检")])])]):s("FormItem",{attrs:{label:"本次抽检数量",prop:"check_num",rules:[t.rule_not_empty,t.rule_minimum]}},[s("InputNumber",{attrs:{size:"small",disabled:t.isEdit||t.isValidPercentInRange,min:1,max:t.statCheck.range_wait_add_count,precision:.1},model:{value:t.form.check_num,callback:function(e){t.$set(t.form,"check_num",e)},expression:"form.check_num"}}),[t.isPack&&t.isCross?s("span",{staticClass:"mlm txt-muted"},[t._v("个题包")]):t.isCross?s("span",{staticClass:"mlm txt-muted"},[t._v("题")]):t._e()],t.form.is_valid_percent?s("span",{staticClass:"mlm txt-muted"},[t._v("(当标注有效占比为100%或0%时，允许修改质检总量和抽检总量)")]):t.check_percent?s("span",{staticClass:"mlm txt-muted"},[t._v("(从数据范围内抽取，当前抽检比例"+t._s(t.check_percent)+"%；实际抽检量以最终下发值为准)")]):t._e()],2),t.isPack&&t.isCross?s("FormItem",{attrs:{prop:"checkPack",label:"题包内数据",rules:t.rule_not_empty}},[s("RadioGroup",{model:{value:t.form.checkPack,callback:function(e){t.$set(t.form,"checkPack",e)},expression:"form.checkPack"}},[s("Radio",{attrs:{label:0,disabled:!0}},[t._v("全检")]),s("Tooltip",{attrs:{content:"交叉标注场景暂不支持题包内数据抽检",placement:"top"}},[s("Radio",{attrs:{label:1,disabled:!0}},[t._v("抽检")])],1)],1)],1):t.isPack?s("FormItem",{attrs:{label:"题包内数据",prop:"checkPack",rules:t.rule_not_empty}},[s("RadioGroup",{model:{value:t.form.checkPack,callback:function(e){t.$set(t.form,"checkPack",e)},expression:"form.checkPack"}},[s("Radio",{attrs:{label:0,disabled:t.isEdit}},[t._v("全检")]),s("Radio",{attrs:{label:1,disabled:t.isEdit}},[t._v("抽检")]),1===t.form.checkPack?[s("InputNumber",{attrs:{size:"small",disabled:t.isEdit,min:1},model:{value:t.form.check_detail_num,callback:function(e){t.$set(t.form,"check_detail_num",e)},expression:"form.check_detail_num"}}),s("span",[t._v("条")])]:t._e()],2)],1):t._e(),s("FormItem",{attrs:{label:"每页质检题数",prop:"batch_check_num",rules:[t.rule_not_empty,t.rule_minimum]}},[s("InputNumber",{staticClass:"mrs",attrs:{size:"small",min:1,max:50,disabled:!t.isRepeatable||!!t.task.cross_num||!!t.task.pack_num},model:{value:t.form.batch_check_num,callback:function(e){t.$set(t.form,"batch_check_num",e)},expression:"form.batch_check_num"}}),s("span",[t._v("题 ")]),t.task.cross_num||t.task.pack_num?s("span",[t._v("(交叉标注/题包场景默认一页一题)")]):s("span",[t._v("(范围为1～50；建议复杂标注场景一页一题；当前只支持文本、网页、视频、部分图片、多url通用模板、多模态数据采标质检场景)")])],1),s("FormItem",{attrs:{label:"质检超时时间",prop:"check_timeout",rules:[t.rule_not_empty]}},[s("i-switch",{on:{"on-change":function(e){t.form.check_timeout=e?120:0}},model:{value:t.form.isTime,callback:function(e){t.$set(t.form,"isTime",e)},expression:"form.isTime"}},[s("span",{attrs:{slot:"open"},slot:"open"},[t._v("开")]),s("span",{attrs:{slot:"close"},slot:"close"},[t._v("关")])]),t.form.isTime?[s("InputNumber",{staticClass:"mrs mls",attrs:{size:"small",min:1,max:1440},model:{value:t.form.check_timeout,callback:function(e){t.$set(t.form,"check_timeout",e)},expression:"form.check_timeout"}}),s("span",{staticClass:"mlm txt-muted"},[t._v("分钟（范围为1～1440）")])]:t._e()],2)],1),s("br"),s("div",{staticClass:"width"},[s("Alert",{attrs:{"show-Icon":""}},[t.form.allow_auto_add?s("Row",[s("Col",{attrs:{span:"24"}},[s("span",{staticClass:"txt-muted"},[t._v("动态添加抽检任务默认全检，实际抽检量以抽检任务列表显示数据为准")])])],1):s("Row",[t.isEdit?t._e():[s("Col",{attrs:{span:"8"}},[s("span",[t._v("数据范围总量：")]),t.isCross||t.isPack?t._e():s("span",[t._v(t._s(t.statCheck.range_wait_add_count))]),t.isPack?s("span",[t._v(t._s(t.statCheck.range_wait_add_count)+"个题包")]):t.isCross?s("span",[t._v(t._s(t.statCheck.range_wait_detail_count)+" ("+t._s(t.statCheck.range_wait_add_count)+"题)")]):t._e()])],s("Col",{attrs:{span:"8"}},[s("span",[t._v("本次抽检总量：")]),t.isCross||t.isPack?t._e():s("span",[t._v(t._s(t.form.check_num))]),t.isPack?s("span",[t._v(t._s(t.form.check_num)+"个题包")]):t.isCross?s("span",[t._v(t._s(t.form.check_num*t.task.cross_num)+" ("+t._s(t.form.check_num)+"题)")]):t._e()]),t.isPack?[s("Col",{attrs:{span:"8"}},[s("span",[t._v("题包内数据：")]),0===t.form.checkPack?s("span",[t._v("全检")]):t._e(),1===t.form.checkPack?s("span",[t._v("抽检"+t._s(t.form.check_detail_num)+"条")]):t._e()])]:t._e()],2)],1)],1),s("Divider"),s("div",{staticClass:"right"},[s("Button",{staticClass:"mrm",attrs:{size:"large",type:"primary",loading:t.fetchCreateCheckTask.isPending,disabled:!t.form.check_num},on:{click:t.handleSubmit}},[t._v(t._s(t.isEdit?"修改":"提交"))]),t.isEdit?t._e():s("Button",{staticClass:"mrm",attrs:{size:"large"},on:{click:t.handleReset}},[t._v("重置")])],1)],1)],1)],1)},i=[],l=(s("8d0d"),s("0f30"),s("9ec3")),r=s("e3fa"),n=s("864c"),o=s("bc94"),c=s("b0f9"),d=s("4463"),u=s("c206"),h=s.n(u),_=s("6982"),m=s("b53d"),v={components:{LabelFilter:_["a"],AttributesLabel:m["a"]},data(){const{task_id:t,deliver_id:e}=this.$route.params;return{isEdit:!!this.$route.query.check_id,taskId:t,deliverId:e,groupLogic:"and",form:{check_name:"",is_finish_check:0,is_assign_reviewer:0,reviewer_list:[],is_label_editable:!0,is_reviewer_view_log:!0,allow_auto_add:!1,ignore_invalid_check_status:!0,is_range:0,isCheckIds:!1,check_id_list:[],isCheckStatus:!1,check_status_list:[],is_assign_labeler:!1,detail_labeler_list:[],is_assign_label_time:!1,label_time:[],isLabelFilter:!1,LabelFilterList:[],is_valid_percent:!1,valid_percent:100,isCrossFilter:!1,CrossFilterList:[],queue_type:0,detail_num:0,check_num:0,check_timeout:0,isTime:!1,batch_check_num:1,is_detail_id_list:!1,detail_id_list:"",is_item_id_list:!1,item_id_list:"",is_pack_key_list:!1,pack_key_list:"",check_event_list:[],checkPack:0,check_detail_num:0},statCheck:{valid_wait_add_count:0,range_wait_add_count:0,range_wait_detail_count:0,wait_add_count:0,wait_detail_count:0},total_num:0,range_num:0,valid_num:0,task:{},deliver:{},checkTask:{},rule_not_empty:{required:!0,message:"不能为空"},rule_minimum:{type:"number",min:1,message:"不能小于1"},template:{},isRepeatable:"default",checkStatusOptions:[{label:"质检通过",value:50},{label:"修改通过",value:60},{label:"质检不通过",value:15},{label:"待质检",value:30},{label:"质检中",value:40},{label:"未抽检",value:-1}]}},computed:{queryParams(){const t=this.form,e={type:0,task_id:this.taskId,deliver_id:this.deliverId,is_range:t.is_range?1:0};let s={};if(t.is_range){var a,i;const e=t.is_assign_label_time&&"object"===typeof t.label_time[0]&&"object"===typeof t.label_time[1];s={check_id_list:t.isCheckIds&&t.check_id_list.length?t.check_id_list:null,check_status_list:t.isCheckStatus&&t.check_status_list.length?t.check_status_list:null,ignore_invalid_check_status:t.isCheckStatus?Number(t.ignore_invalid_check_status):null,detail_labeler_list:t.is_assign_labeler?t.detail_labeler_list:null,label_begin_date:e?h()(t.label_time[0]).format("YYYY-MM-DD HH:mm:ss"):null,label_end_date:e?h()(t.label_time[1]).format("YYYY-MM-DD HH:mm:ss"):null,label_value_cond:t.isRange&&t.isLabelFilter?t.LabelFilter.groupLogic:null,check_filters_score_condition:this.isCross&&t.isRange&&t.isCrossFilter?t.CrossFilter.groupLogic:null,check_filters_group_condition:this.isCross?this.groupLogic:null,check_filters_object_label_score_conditions:this.isCross?t.AttributesLabel:null,label_group_condition:this.isCross?null:this.groupLogic,object_label_value_conditions:this.isCross?null:t.AttributesLabel,item_id_list:t.is_item_id_list?this.handleIDs(t.item_id_list):null,detail_id_list:t.is_detail_id_list?this.handleIDs(t.detail_id_list):null,pack_key_list:t.is_pack_key_list?this.handleIDs(t.pack_key_list):null,label_value_cond_dtos:t.isLabelFilter&&null!==(a=t.LabelFilterList.data)&&void 0!==a&&a.length?t.LabelFilterList.data:null,check_filters:this.isCross&&t.isCrossFilter&&null!==(i=t.CrossFilterList.data)&&void 0!==i&&i.length?t.CrossFilterList.data:null,valid_percent:t.is_valid_percent?t.valid_percent:null,valid_count:this.statCheck.valid_wait_add_count}}return Object.assign(e,s),Object(l["omitBy"])(e,l["isNil"])},submitParams(){const t=this.form,e={task_id:this.taskId,deliver_id:this.deliverId,check_name:t.check_name,is_finish_check:t.is_finish_check?1:0,check_num:t.check_num,detail_range:this.queryParams,check_config:{},check_detail_num:t.check_detail_num},s={allow_auto_add:t.allow_auto_add?1:0,is_use_task_team:t.is_assign_reviewer?0:1,reviewer_list:t.is_assign_reviewer?t.reviewer_list:null,is_label_editable:t.is_label_editable?1:0,is_reviewer_view_log:t.is_reviewer_view_log?1:0,queue_type:t.queue_type?1:0,batch_check_num:t.batch_check_num,check_timeout:t.check_timeout};return Object.assign(e.check_config,Object(l["omitBy"])(s,l["isNil"])),e},check_percent(){return this.form.detail_num&&Math.round(this.form.check_num/this.form.detail_num*1e4)/100},isValidPercentInRange(){return!!(this.form.is_range&&this.form.is_valid_percent&&this.form.valid_percent&&this.form.valid_percent>0&&this.form.valid_percent<100)},isCross(){var t;return(null===(t=this.task)||void 0===t?void 0:t.cross_num)>=2},isPack(){var t;return(null===(t=this.task)||void 0===t?void 0:t.pack_num)>0}},watch:{total_num(){this.form.detail_num>this.total_num&&!this.isEdit&&(this.form.detail_num=this.total_num)},"form.detail_num"(){this.form.check_num>this.form.detail_num&&(this.form.check_num=this.form.detail_num)},"form.isLabelFilter"(){this.form.isLabelFilter&&(this.form.is_valid_percent=!1,this.form.valid_percent=100)},"form.is_valid_percent"(){this.form.is_valid_percent&&(this.form.isLabelFilter=!1)},"form.check_timeout"(){this.form.isTime=!!this.form.check_timeout},"form.allow_auto_add"(t){t&&!this.isEdit&&(this.form.is_range=1)},"form.is_range"(t){t&&!this.isEdit&&(this.form.isCheckStatus=!0,this.form.check_status_list=[-1])},"form.isCheckIds"(t){const{isEdit:e,form:s}=this;t&&!e&&s.check_status_list.includes(-1)&&this.form.check_status_list.splice(s.check_status_list.indexOf(-1),1)}},created(){this.fetchRoleUsers(),this.fetchTask().then(()=>{this.fetchDeliver();const{isEdit:t}=this;t?(this.fetchCheckTasks(),this.fetchCheckTask().then(t=>{this.initCheckTask(t)}).catch(t=>{this.$Modal.error({title:"获取抽检任务失败",content:`<p>原因：${t.message}。</p><p>点击确定回到列表。</p>`,onOk:()=>{this.$router.push({name:"wb-extract-review-task",param:{task_id:this.task_id,deliver_id:this.deliver_id},query:{team_id:this.$route.query.team_id}})}})})):this.form.is_range=1})},methods:{initCheckTask(t){const{form:e}=this;this.form.check_name=t.check_name,this.form.is_finish_check=Number(t.is_finish_check);const{check_config:s,detail_range:a}=t;this.form.checkPack=0===t.item_sub_num?0:1,this.form.check_detail_num=t.item_sub_num;const i=t=>{t&&Object.keys(t).forEach(s=>{if(Object.hasOwn(e,s)&&!Object(l["isNil"])(t[s]))switch(typeof e[s]){case"number":this.form[s]=t[s];break;case"boolean":this.form[s]=!!t[s];break;case"object":["check_status_list"].includes(s)?this.form[s]=t[s]:this.form[s]=t[s].map(t=>t.toString());break}})};var r,n,o,c,d,u,h,_;(i(s),this.form.is_assign_reviewer=Number(!e.is_use_task_team&&!!e.reviewer_list.length),this.form.check_num=t.item_num||t.check_num,this.form.isTime=!!e.check_timeout,a&&a.is_range)&&(i(a),this.form.is_range=e.is_range,this.form.isCheckIds=!!e.check_id_list.length,this.form.isCheckStatus=!!e.check_status_list.length,this.form.is_assign_labeler=!!e.detail_labeler_list&&!!e.detail_labeler_list.length,this.taskLabelers=this.roleUsers||[],this.form.is_detail_id_list=!(null===(r=a.detail_id_list)||void 0===r||!r.length),this.form.is_item_id_list=!(null===(n=a.item_id_list)||void 0===n||!n.length),this.form.is_pack_key_list=!(null===(o=a.pack_key_list)||void 0===o||!o.length),this.form.detail_id_list=null===(c=a.detail_id_list)||void 0===c?void 0:c.join("、"),this.form.item_id_list=null===(d=a.item_id_list)||void 0===d?void 0:d.join("、"),this.form.pack_key_list=null===(u=a.pack_key_list)||void 0===u?void 0:u.join("、"),a.label_begin_date&&a.label_end_date&&(this.form.is_assign_label_time=!0,this.form.label_time=[a.label_begin_date,a.label_end_date]),null!==(h=a.label_value_cond_dtos)&&void 0!==h&&h.length&&(this.form.isLabelFilter=!0,this.form.LabelFilterList=a.label_value_cond_dtos,this.$nextTick(()=>{this.$refs.LabelFilter.form.label=[...this.form.LabelFilterList]})),null!==(_=a.check_filters)&&void 0!==_&&_.length&&(this.form.isCrossFilter=!0,this.form.CrossFilterList=null===a||void 0===a?void 0:a.check_filters,this.$nextTick(()=>{this.$refs.CrossFilter.form.cross=[...this.form.CrossFilterList]})),"number"===typeof a.valid_percent&&-1!==a.valid_percent&&(this.form.is_valid_percent=!0))},handleIDs(t){var e;if(!t)return[];let s=Object(l["compact"])(t.split(/[\n\s+,，;；、]/g));return(null===(e=s)||void 0===e?void 0:e.length)>=5e3&&(s=s.slice(0,5e3)),s},handleReset(){this.$Modal.confirm({title:"确定重置吗？",content:"已填写的表单信息会被清除",onOk:()=>{Object(l["forIn"])(this.form,(t,e)=>{switch(typeof t){case"string":this.form[e]="";break;case"number":this.form[e]=0;break;case"object":this.form[e]=[];break;case"boolean":this.form[e]=!1;break}"is_label_editable"===e&&(this.form[e]=!0),"is_reviewer_view_log"===e&&(this.form[e]=!0),"valid_percent"===e&&(this.form[e]=100)})}})},handleSubmit(){this.$refs.form.validate(t=>{if(t){const t=this.form;if(t.is_assign_reviewer&&t.reviewer_list.length<=0)return this.$Message.error("尚未选择指定的质检员"),this.$refs.reviewer_list.toggleMenu(),Promise.resolve();if(t.is_range){var e,s,a,i,l,r,n,o,c,d,u,h;if(!(t.is_assign_labeler||t.is_assign_label_time||t.isLabelFilter||t.isCrossFilter||t.is_valid_percent||t.is_detail_id_list||t.is_item_id_list||t.is_pack_key_list||t.isCheckStatus||t.isCheckIds))return this.$Message.error("尚未选择自定义的筛选条件"),null===(a=this.$refs.isCheckIds)||void 0===a||a.onFocus(),null===(i=this.$refs.isCheckStatus)||void 0===i||i.onFocus(),null===(l=this.$refs.is_assign_labeler)||void 0===l||l.onFocus(),null===(r=this.$refs.is_assign_label_time)||void 0===r||r.onFocus(),null===(n=this.$refs.isLabelFilter)||void 0===n||n.onFocus(),null===(o=this.$refs.isCrossFilter)||void 0===o||o.onFocus(),null===(c=this.$refs.is_detail_id_list)||void 0===c||c.onFocus(),null===(d=this.$refs.is_item_id_list)||void 0===d||d.onFocus(),null===(u=this.$refs.is_pack_key_list)||void 0===u||u.onFocus(),null===(h=this.$refs.valid_percent)||void 0===h||h.focus(),Promise.resolve();if(t.isCheckIds&&t.check_id_list.length<=0)return this.$Message.error("尚未筛选抽检任务"),Promise.resolve();if(t.isCheckStatus&&t.check_status_list.length<=0)return this.$Message.error("尚未筛选质检结果"),Promise.resolve();if(t.is_assign_labeler&&t.detail_labeler_list.length<=0)return this.$Message.error("尚未选择指定的标注员"),this.$refs.detail_labeler_list.toggleMenu(),Promise.resolve();if(t.is_assign_label_time&&!t.label_time[0]&&!t.label_time[1])return this.$Message.error("尚未选择完整的提交时间"),this.$refs.label_time.handleFocus(),Promise.resolve();if(t.isLabelFilter&&this.$refs.LabelFilter.verifyFilter(),t.isLabelFilter&&(null===(e=t.LabelFilterList.data)||void 0===e?void 0:e.length)<=0&&t.AttributesLabel.length<=0)return this.$Message.error("未找到筛选标注结果的筛选条件"),Promise.resolve();if(t.isCrossFilter&&this.$refs.CrossFilter.verifyFilter(),t.isCrossFilter&&(null===(s=t.CrossFilterList.data)||void 0===s?void 0:s.length)<=0&&t.AttributesLabel.length<=0)return this.$Message.error("未找到筛选结果评价指标的筛选条件"),Promise.resolve();if(t.is_valid_percent&&null===t.valid_percent)return this.$Message.error("尚未填写标注有效占比"),Promise.resolve()}this.isEdit?this.fetchUpdateCheckTask():this.fetchCreateCheckTask()}else this.$Message.error("提交失败，请检查是否有遗漏")})},validateIds(t){let e=!0;return t&&t.length&&t.forEach(t=>{e=e&&RegExp(/^[0-9]+$/).test(t)}),e},getNum(){return this.fetchStatDeliverTask()},toSnakeCase(t){return Object.fromEntries(Object.entries(t).map(t=>[Object(l["snakeCase"])(t[0]),t[1]]))}},asyncMethods:{fetchCreateCheckTask(){const t={};return Object.assign(t,this.submitParams),n["a"].CreateCheckTask(t).then(t=>{t.data.result.check_id&&(this.$Message.success("创建成功"),this.$router.push({name:"wb-extract-review-task",params:{task_id:this.taskId,deliver_id:this.deliverId},query:{team_id:this.$route.query.team_id}}))}).catch(t=>{console.log(t),this.$Message.error("创建失败："+t.message)})},fetchUpdateCheckTask(){const t={check_id:this.$route.query.check_id};return Object.assign(t,this.submitParams),delete t.detail_range,n["a"].UpdateCheckTask(t).then(t=>{t.data.result&&(this.$Message.success("修改成功"),this.$router.push({name:"wb-extract-review-task",params:{task_id:this.taskId,deliver_id:this.deliverId},query:{team_id:this.$route.query.team_id}}))}).catch(t=>{console.log(t),this.$Message.error("修改失败："+t.message)})},fetchTask(){const t={task_id:this.taskId};return n["a"].GetTask(t).then(t=>(t.data.result.template_id&&this.fetchTemplateLabels(t.data.result.template_id),t.data.result))},fetchDeliver(){const t={task_id:this.task.task_id,deliver_id:this.$route.params.deliver_id,page:{start:0,size:1,return_total:0}};return n["a"].ListMyDeliverTasks(t).then(t=>{const{result:e}=t.data;return e.data.length>0?e.data[0]:(this.$Message.error("获取批次详情失败"),{})})},fetchCheckTask(){const t={task_id:this.taskId,check_id:this.$route.query.check_id};return n["a"].GetCheckTask(t).then(async t=>{const e=t.data.result,s=await this.fetchStatCheckTask();if(s)return{...e,check_num:s.check_num}})},fetchStatCheckTask(){const t={task_id:this.taskId,deliver_id:this.deliverId,check_id:this.$route.query.check_id,team_id:Number(this.$route.query.team_id)||void 0,stat_scene:"check",stat_scope:"check"};return Object(o["q"])(t).then(t=>t)},fetchCheckTasks(){const t={task_id:this.taskId,deliver_id:this.deliverId,team_id:Number(this.$route.query.team_id)||void 0};return Object(d["h"])(t).then(t=>t.data).catch(t=>{console.log(t)})},fetchTemplateLabels(t){const e={template_id:t};return Object(c["k"])(e).then(t=>(this.isRepeatable=Object(l["chain"])(this.$OptimusStageMetadata).find({name:t.template_type}).value().repeatable,this.template={...t,repeatable:this.isRepeatable},this.template))},fetchRoleUsers(t){const e={object_id:this.$route.query.team_id,object_type:"team",user_type:"user",page:{start:0,size:100,return_total:1}};return t&&(e.nick_name=t),Object(r["q"])(e).then(t=>t.data).catch(t=>{console.log(t),this.$Message.error("获取用户列表失败："+t.message)})},fetchTaskLabelers(){const t={task_id:this.task.task_id,deliver_id:this.$route.params.deliver_id};return n["a"].ListLabelerUser(t).then(t=>t.data.result).catch(t=>{console.log(t),this.$Message.error("获取标注员列表失败："+t.message)})},fetchStatDeliverTask(){const{isEdit:t,queryParams:e}=this;if(t)return Promise.resolve();if(!this.validateIds(e.detail_id_list)||!this.validateIds(e.item_id_list))return this.$Message.error("校验失败：ID筛选只允许输入分割符和数字"),this.form.check_num=0,Promise.resolve();const s={};return Object.assign(s,e),n["a"].GetTaskCheckRangeNum(s).then(t=>{const e=t.data.result;return this.isEdit||(this.form.check_num=e.range_wait_add_count),this.statCheck=e,e}).catch(t=>{this.total_num=0,this.form.detail_num=0,this.form.check_num=0,this.$Message.error(t.message)})}}},p=v,k=(s("6637"),s("2be6")),f=Object(k["a"])(p,a,i,!1,null,"01522078",null);e["default"]=f.exports},af56:function(t,e,s){"use strict";s("939b")},b198:function(t,e,s){},b21b:function(t,e,s){"use strict";s("1374")},b392e:function(t,e,s){"use strict";s("9a69")},b6b8:function(t,e,s){"use strict";s("4b94")},ba19:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("queue-base",{attrs:{title:"返修","task-id":t.taskId,"fetch-object":t.fetchDetail,errorData:t.errorData},on:{"try-again":t.fetchDetail}})},i=[],l=(s("f38f"),s("bc94")),r=s("bccd"),n=s("3998"),o=s("c899"),c={components:{QueueBase:n["a"]},data(){const{task_id:t}=this.$route.params;return{taskId:Object(r["BigNumber"])(t),errorData:null}},created(){this.fetchDetail()},asyncMethods:{fetchDetail(){const t={task_id:this.taskId,page:{start:0,size:1,return_total:1}};return Object(l["h"])(t).then(t=>{if(0===t.data.length)return{};const[e]=t.data;this.$router.replace({name:"wb-task-label-detail",params:{task_id:this.taskId,pack_key:e.pack_key},query:{scenes:"relabel",team_id:this.$route.query.team_id}})}).catch(t=>{if(t.code===o["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");throw console.log(t),new Error(t.message)})}}},d=c,u=s("2be6"),h=Object(u["a"])(d,a,i,!1,null,null,null);e["default"]=h.exports},bc58:function(t,e,s){"use strict";s("9647")},bd19:function(t,e,s){"use strict";s("d946")},bee4:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label-detail"},[s("Container",{attrs:{fetchObject:t.fetchDetail,isErrorPage:!t.details[t.curIdx],isPausePage:t.isPausing&&t.isLabeler&&(t.isLabeling||t.isReLabeling||t.isFromLabel&&t.isUpdate),task:t.statTask,errorData:t.errorData},on:{tryAgain:t.fetchDetail,reset:t.handleResetSearch},scopedSlots:t._u([{key:"content",fn:function(){return[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],staticClass:"z-header z-level"},[s("info",{attrs:{detailLength:t.details?t.details.length:0,detail:t.detail,taskType:t.isReLabeling?"返修":"标注"},scopedSlots:t._u([{key:"time-out",fn:function(){return[t.statTask&&t.statTask.label_timeout&&t.isLabeling?[s("time-out",{attrs:{siteTimeout:t.statTask.label_timeout,isFetchReturn:t.isFetchReturn},on:{returnDetail:t.fetchReturn}})]:t._e(),t.statTask&&t.statTask.relabel_timeout&&t.isReLabeling?[s("time-out",{attrs:{siteTimeout:t.statTask.relabel_timeout,handleTimeout:"close",isFetchReturn:t.isFetchReturn},on:{handlePauseOrResume:t.handlePauseOrResume}})]:t._e()]},proxy:!0}])}),t.isViewLabelVersion?[s("div",{staticClass:"label-version-view-tag"},[s("span",{staticClass:"mrs"},[t._v(t._s(t.isViewLabelVersion.tag_name))]),s("Tooltip",{attrs:{content:"关闭查看版本",placement:"top",transfer:""}},[s("Icon",{staticClass:"pointer",attrs:{type:"ios-close"},on:{click:function(e){return t.$refs.logs.resetVersion()}}})],1)],1)]:t._e(),s("div",{staticClass:"z-level__right"},[t.isPage&&!t.isViewLabelVersion?s("pages",{attrs:{detailForm:t.detailForm,detailPage:t.detailPage},on:{filterDetail:t.filterDetail,changePage:t.changePage,handleResetSearch:t.handleResetSearch}}):t._e(),s("count",{attrs:{isAction:(t.isLabeling||t.isReLabeling)&&t.isLabeler,detail:t.detail,countInfo:t.countInfo,teamId:t.teamId},on:{handlePauseOrResume:t.handlePauseOrResume},scopedSlots:t._u([{key:"center",fn:function(){return[t.details[t.curIdx]?s("aid",{attrs:{isHotKey:!t.isPageDetails,stagesMetadataSC:t.stagesMetadataSC,isUpdate:t.isUpdate||t.isLabeling||t.isReLabeling,copyText:t.copyText,isCanReturn:t.isLabeling&&t.isLabeler},on:{enterFullScreen:t.enterFullScreen,handleShareDetail:t.handleShareDetail}}):t._e()]},proxy:!0},{key:"returnBtn",fn:function(){return[t.isLabeling&&t.isLabeler?s("div",{staticClass:"z-level__item"},[s("Tooltip",{attrs:{content:"把题目退回并停止标注"}},[s("div",{staticClass:"middle hover-hand",on:{click:t.returnLabel}},[s("Icon",{attrs:{type:"ios-return-left",size:"20"}}),t._v("退回")],1)])],1):t._e()]},proxy:!0}])})],1)],2),t.detail&&t.details.length>0?[0!==t.detail.is_delete_source&&void 0!==t.detail.is_delete_source?[s("Delete")]:[t.isShowList?[s("div",{staticClass:"z-main-list"},[t.showFullScreen?s("div",{staticClass:"closeFullScreen",on:{click:t.enterFullScreen}},[s("Icon",{attrs:{type:"ios-contract",size:"18"}}),s("span",[t._v("退出全屏模式")])],1):t._e(),s("batch-annotation-list",{ref:"batch-annotation-list",attrs:{details:t.details,isUpdate:(t.isUpdate||t.isLabeling||t.isReLabeling)&&t.isLabeler,detailType:"label"},on:{changeDetails:t.changeDetails,getLogs:t.fetchFlowLogs}})],1)]:[t.details[t.curIdx]?s("div",{ref:"zMainRef",staticClass:"z-main",class:{"z-main-s":!t.isPageDetails,"label-version-view":!!t.isViewLabelVersion},on:{scroll:t.handleDebouncedScroll}},[t.showFullScreen?s("div",{staticClass:"closeFullScreen",on:{click:t.enterFullScreen}},[s("Icon",{attrs:{type:"ios-contract",size:"18"}}),s("span",[t._v("退出全屏模式")])],1):t._e(),t._l(t.newDetails,(function(e,a){return s("div",{class:{optimus:t.isPageDetails,"z-main-s":!t.isPageDetails,"is-re-action":t.isPageDetails&&t.isReLabeling&&!e.isReAction},staticStyle:{display:"flex","flex-direction":"column"},on:{click:function(e){t.curIdx=a}}},[[s("ErrorSurveyCard",{attrs:{cardData:t.statTask,rejectData:t.rejectData,update:t.updateIsErrorSurVeyCardSubmit,detail:e,disabled:t.isReLabeling&&t.isLabeler,updateStatus:t.updateStatus}})],s("optimus-engine",{key:t.isViewLabelVersion?t.isViewLabelVersion.version_id:e.key+t.isUpdate+e.detail_is_valid,ref:"engine"+a,refInFor:!0,style:{borderTopRightRadius:"10px",maxHeight:t.isPageDetails?"calc(100vh - "+(t.showFullScreen?"80px":"220px")+")":""},attrs:{component:e.component,context:e.context,answer:t.isViewLabelVersion?t.LabelVersionContent:e.isValidAnswer,curLabelGroup:t.statTask&&t.statTask.template_label_group,schema:e.schema,disabled:!(t.isLabeler&&(t.isLabeling||t.isReLabeling&&e.isReAction||t.isUpdate)&&e.detail_is_valid)||!!t.isViewLabelVersion||t.isAutoValidating,active:!t.isPageDetails,name:"engine"+a,objectId:e.detail_id.toString(),objectType:"task-detail",isNeedAutoValidate:!0,reference:{datasetItemId:e.dataset_item_id.toString(),watermarkContent:t.userInfo.real_user_id,rawAnswer:e.detail_label}},on:{submit:t.handleSubmit}}),t.isPageDetails&&e.detail_id&&!e.detail_is_valid?s("invalid-banner",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],attrs:{detail:e,isUpdate:(t.isUpdate||t.isLabeling||t.isReLabeling&&e.isReAction)&&t.isLabeler},on:{updateValid:function(t){return e.detail_is_valid=t},openInvalidModal:t.createModal}}):t._e(),t.isPageDetails?s("Row",{staticClass:"optimus-footer"},[s("Col",{attrs:{span:"12"}},[s("span",{staticClass:"mrm"},[t._v("题目ID："+t._s(e.dataset_item_id))]),s("span",{staticClass:"mrm"},[t._v("|")]),s("span",[t._v("任务明细ID："+t._s(e.detail_id))]),s("a",{staticClass:"mlm",on:{click:function(s){return t.fetchFlowLogs(e.detail_id,!0)}}},[t._v("日志")])]),t.isLabeler?s("Col",{staticClass:"right",attrs:{span:"12"}},[e.isReAction?s("span",{staticStyle:{"line-height":"22px"}},[s("Icon",{attrs:{type:"ios-alert",color:"#f90"}}),s("span",{staticClass:"mrm"},[t._v("质检不通过")])],1):t._e(),e.detail_is_valid&&(t.isUpdate||t.isLabeling||t.isReLabeling&&e.isReAction)&&t.isLabeler&&!t.btnDisabled.includes("invalid")?s("Button",{attrs:{type:"warning",ghost:"",size:"small"},on:{click:function(e){return t.createModal("invalid",t.curIdx=a)}}},[t._v("标记无效")]):t._e()],1):t._e()],1):t._e()],2)})),t.details.length>0&&t.unLoadedCount>0?s("Alert",{class:{"load-more":!0}},[s("span",[t._v("还有 "+t._s(t.unLoadedCount)+" 题，")]),s("Button",{attrs:{type:"primary",size:"small"},on:{click:t.clickLoadMore}},[t._v("继续加载")])],1):t._e()],2):t._e()],t.details[t.curIdx]&&!t.details[t.curIdx].detail_is_valid&&!t.isPageDetails&&!t.isShowList&&!t.isViewLabelVersion||t.isViewLabelVersion&&t.LabelVersionContent.invalidAnswer?s("invalid-banner",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],attrs:{detail:t.isViewLabelVersion?t.LabelVersionContent:t.detail,isUpdate:(t.isUpdate||t.isLabeling||t.isReLabeling)&&t.isLabeler},on:{openInvalidModal:t.createModal,updateValid:function(e){return t.details[t.curIdx].detail_is_valid=e}}}):t._e()],s("Footer",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen&&t.details[t.curIdx],expression:"!showFullScreen && details[curIdx]"}],attrs:{task:t.statTask,isList:t.isPageDetails||t.isShowList,latestFlowLog:t.latestFlowLog,rejectData:t.rejectData},on:{openLogs:t.createModal},scopedSlots:t._u([t.isAutoValidating||t.isAutoEditing?{key:"tips",fn:function(){return[s("Icon",{staticClass:"txt-red mrs",attrs:{type:"md-information-circle",size:"16"}}),s("b",{staticClass:"txt-red"},[t._v("机审判定标注结果有误，请检查！")])]},proxy:!0}:null,{key:"buttons",fn:function(){return[t.isViewLabelVersion?[s("Button",{attrs:{type:"success",ghost:""},on:{click:function(e){return t.$refs.logs.resetVersion()}}},[t._v("回到当前版本")])]:t.isInit?[s("b",[t._v("接受任务后就可以开始标注了")])]:t.isPending?[s("Button",{attrs:{loading:"",size:"large",type:"primary"}},[t._v("提交中")])]:[s("div",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"queue-label",extra:{team:t.teamId}},expression:"{domain: 'task', action: 'queue-label', extra: {team: teamId}}"}]},[(t.isLabeling||t.isReLabeling)&&t.isLabeler&&!t.isAutoValidating?[s("Pause",{attrs:{task:t.statTask,isPausing:t.isPausing}})]:t._e(),t.isAutoValidating?[s("Button",{staticClass:"mrm",attrs:{type:"primary",ghost:"",size:"large"},on:{click:function(e){return t.handleAutoEdit(!1)}}},[t._v("确认无误")]),s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.handleAutoEdit(!0)}}},[t._v("返回修改")])]:t._e(),t.isLabeling&&t.isLabeler&&!t.isAutoValidating?[s("Tooltip",{attrs:{content:t.fromSkip?"剩余题目均已跳过，暂不支持再次跳过":"跳过这条题目，领取下一条","max-width":"300"}},[s("Button",{staticClass:"mrm",attrs:{type:"default",size:"large",loading:t.fetchSkip.isPending,disabled:t.fromSkip},on:{click:t.skipLabel}},[t._v("跳过")])],1),t.isPageDetails||t.isShowList||t.btnDisabled.includes("invalid")?t._e():s("Button",{staticClass:"mrm",attrs:{type:"warning",ghost:"",size:"large"},on:{click:function(e){return t.createModal("invalid")}}},[t._v("标记无效")]),s("Save",{attrs:{isPausing:t.isPausing},on:{handleSave:function(e){e?t.fetchAutoSaveRet(!1,e):t.fetchSaveRet(!1)}}}),s("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitRet("label",void 0,!0)}}},[s("div",{staticClass:"button-board"},[t._v("提交并继续标注")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:t._e(),t.isReLabeling&&t.isLabeler&&!t.isAutoValidating?[t.isPageDetails||t.isShowList?s("span",{staticClass:"mrm"},[t._v("（待修改题数："+t._s(t.isReActionNum)+"）")]):t._e(),t.isPageDetails||!t.details[t.curIdx].detail_is_valid||t.isShowList||t.btnDisabled.includes("invalid")?t._e():s("Button",{staticClass:"mrm",attrs:{type:"warning",ghost:"",size:"large"},on:{click:function(e){return t.createModal("invalid")}}},[t._v("标记无效")]),s("Button",{attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitRet("relabel")}}},[s("div",{staticClass:"button-board"},[t._v("提交并继续标注")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:t._e(),t.isFromLabel?[t.isUpdate?[s("span",{staticClass:"mrm"},[t._v("修改标注中……")]),s("Pause",{attrs:{isPausing:t.isPausing}}),s("Button",{staticClass:"mrm",attrs:{type:"default",size:"large"},on:{click:t.handleReset}},[t._v("取消修改")]),t.isPageDetails||!t.details[t.curIdx].detail_is_valid||t.isShowList||t.btnDisabled.includes("invalid")?t._e():s("Button",{staticClass:"mrm",attrs:{type:"warning",ghost:"",size:"large"},on:{click:function(e){return t.createModal("invalid")}}},[t._v("标记无效")]),s("Button",{attrs:{type:"primary",size:"large",loading:t.fetchSaveRet.isPending},on:{click:t.submitUpdate}},[s("div",{staticClass:"button-board"},[t._v("提交修改")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:[s("Tooltip",{attrs:{content:t.isEditLabelResult?"不允许修改标注结果":"仅未质检且未交付的题目允许修改",transfer:"",placement:"top-end"}},[s("Button",{attrs:{size:"large",type:"primary",ghost:"",disabled:!(t.isAllowUpdateLabel&&t.isLabeler)},on:{click:function(e){t.reportUpdate(5),t.isUpdate=!0}}},[s("div",{staticClass:"button-board"},[t._v("修改标注")]),s("div",{staticClass:"key-board"},[t._v("(m)")])])],1)]]:t._e()],2)]]},proxy:!0}],null,!0)})]:t._e()]},proxy:!0}])}),s("logs",{ref:"logs",attrs:{task:t.statTask,flowLogs:t.flowLogs,visible:t.modals.logs,loading:t.fetchFlowLogs.isPending},on:{"update:visible":function(e){return t.$set(t.modals,"logs",e)},onViewLabelVersion:t.onViewLabelVersion}}),s("invalid-modal",{attrs:{visible:t.modals.invalid,statusList:t.statusList,detail:t.isViewLabelVersion?Object.assign({},t.details[t.curIdx],{invalidAnswer:t.LabelVersionContent.invalidAnswer}):t.details[t.curIdx],isUpdate:(t.isUpdate||t.isLabeling||t.isReLabeling&&t.details[t.curIdx].isReAction)&&t.isLabeler},on:{"update:visible":function(e){return t.$set(t.modals,"invalid",e)},"on-ok":t.handleForm,"on-submit":t.fetchSubmitRet}}),s("return-modal",{attrs:{visible:t.isFetchReturn,backTimer:t.backTimer,isTimeOut:t.isTimeOut},on:{"update:visible":function(e){t.isFetchReturn=e}}})],1)},i=[],l=(s("8d0d"),s("f38f"),s("9ec3")),r=s.n(l),n=s("dde5"),o=s("bc94"),c=s("db49"),d=s("597a"),u={mixins:[d["a"]],data(){const{pack_key:t}=this.$route.params,{from_skip:e}=this.$route.query;return{packKey:t&&"0"!==t?t:"",fromSkip:!!e,isViewLabelVersion:!1,LabelVersionContent:"",isErrorSurVeyCardSubmitArray:[],status:null,pLoading:!1,pagination:{current:1,pageSize:25,total:0},newDetails:[],debouncedHandleScroll:null}},computed:{unLoadedCount(){return this.details.length-this.newDetails.length},btnDisabled(){var t,e;const s=this.$refs["engine"+this.curIdx]&&this.$refs["engine"+this.curIdx][0];return null!==(t=null===s||void 0===s||null===(e=s.renderedComponentConfig.attributes)||void 0===e?void 0:e.btnDisabled)&&void 0!==t?t:[]},isEditLabelResult(){var t,e;return!r.a.isNil(null===(t=this.detail)||void 0===t?void 0:t.edit_label_result)&&!(null!==(e=this.detail)&&void 0!==e&&e.edit_label_result)},isPageDetails(){var t;return(null===(t=this.detailCopyList)||void 0===t?void 0:t.length)>1},statusList(){return{isLabeling:this.isLabeling,isReLabeling:this.isReLabeling,isPageDetails:this.isPageDetails}},isPending(){return this.fetchReturn.isPending||this.fetchSubmitRet.isPending||this.fetchSkip.isPending||this.fetchSaveRet.isPending}},watch:{"fetchTask.isResolved"(t){t&&this.getCountInfo()},"fetchStatTask.isResolved"(t){t&&this.getCountInfo()},"fetchDetail.isResolved"(t){t&&this.$nextTick(()=>{console.log("zMainRef",this.$refs.zMainRef)})}},async created(){await this.fetchTask(),this.fetchDetail(),["label","relabel"].includes(this.$route.query.scenes)&&this.fetchStatTask()},mounted(){this.packIdList=this.packKey?[this.packKey]:JSON.parse(localStorage.getItem("pack_key_list"))||[],document.addEventListener("keydown",this.listenKeyboardEvent),this.$EventBus.$on("handlePauseOrResume",t=>{this.handlePauseOrResume(t)}),this.$EventBus.$on("reportHeartbeat",()=>{this.reportHeartbeat(0)}),this.fromSkip&&this.$nextTick(()=>{this.$Message.warning("剩余题目均已跳过，暂不支持再次跳过")}),document.addEventListener("visibilitychange",this.onCheckPauseOrResume),this.debouncedHandleScroll=r.a.debounce(this.handleScroll,200)},beforeDestroy(){var t;this.$EventBus.$off("handlePauseOrResume"),this.$EventBus.$off("reportHeartbeat"),null===(t=this.debouncedHandleScroll)||void 0===t||t.cancel()},destroyed(){document.removeEventListener("keydown",this.listenKeyboardEvent),document.removeEventListener("visibilitychange",this.onCheckPauseOrResume)},methods:{handleDebouncedScroll(){this.debouncedHandleScroll()},handleScroll(){const t=this.$refs.zMainRef;t&&t.scrollTop+t.clientHeight>=t.scrollHeight-50&&console.log("滚动到底部")},clickLoadMore(){const{current:t,pageSize:e}=this.pagination;this.unLoadedCount>0&&(this.pLoading=!0,this.newDetails=this.details.slice(0,t*e),console.log("newDetails.length",this.newDetails.length),this.pagination.current+=1,this.pLoading=!1)},handleSubmit(){this.isLabeling&&this.fetchSubmitRet("label"),this.isReLabeling&&this.fetchSubmitRet("relabel"),this.isUpdate&&this.fetchSaveRet(!0)},async onCheckPauseOrResume(){if(!this.details||!this.details.length)return;if(!this.getDetailIds().length)return;const[t]=this.getDetailIds();if(t&&!document.hidden){await this.fetchFlowLogs(t);const{flow_code:e,flow_action:s}=this.latestFlowLog;(null===e||void 0===e?void 0:e.toString())===t.toString()&&s&&"PAUSE"===s&&!this.isPausing&&(console.log("检测到暂停事件于"+(new Date).toLocaleTimeString("it-IT")),this.isPausing=!0)}},listenKeyboardEvent:r.a.debounce((function(t){var e;const{target:s,code:a,altKey:i}=t;if(!this.isLabeler||null===(e=this.detail)||void 0===e||!e.detail_id)return 0;if(!("INPUT"===s.tagName&&"checkbox"!==s.getAttribute("type")||"TEXTAREA"===s.tagName||s.getAttribute("contenteditable")))if("KeyC"===a&&i){if(this.isViewLabelVersion)return void this.$Message.warning("请先退出查看版本，再使用快捷键");if(this.isPending&&this.details.length)return void this.$Message.warning("太快了，请尝试重新提交");this.isLabeling&&this.fetchSubmitRet("label"),this.isReLabeling&&this.fetchSubmitRet("relabel"),this.isAllowUpdateLabel&&this.isUpdate&&this.submitUpdate()}else"KeyM"!==a||this.isPageDetails||this.isAllowUpdateLabel&&(this.isUpdate=!0,this.reportUpdate(5))}),200),getCountInfo(){if(!this.statTask)return;const{labeled_num:t,total_num:e,label_timeout:s,template_component:a,user_labeled_num:i}=this.statTask;Object.assign(this.countInfo,r.a.omitBy({actionNum:t,totalNum:e,timeout:s,templateComponent:JSON.parse(a),userLabeledNum:i},r.a.isNil))},handleReset(){this.isUpdate=!1,this.details[this.curIdx]=Object.assign(this.details[this.curIdx],r.a.cloneDeep(this.detailCopyList[this.curIdx]))},handleForm(t){this.details[this.curIdx].invalidAnswer.tags=t,this.details[this.curIdx].detail_is_valid=!1},submitUpdate(){this.$Modal.confirm({title:"确定要修改当前已标注的结果吗？",onOk:()=>{this.fetchSaveRet(!0)}})},skipLabel(){if("SAVE_LABEL"!==this.latestFlowLog.flow_action&&!this.isPageDetails)return this.fetchSkip();this.$Modal.confirm({title:"确定要跳过题目吗？",content:"<p>题目中有已保存的标注内容，跳过将被清空。</p><p>点击确定按钮继续跳过。</p>",onOk:()=>this.fetchSkip()})},returnLabel(){"SAVE_LABEL"===this.latestFlowLog.flow_action||this.isPageDetails?this.$Modal.confirm({title:"确定要退回题目吗？",content:"<p>题目中有已保存的标注内容，退回将会清空标注。</p><p>点击确定按钮继续退回。</p>",onOk:()=>this.fetchReturn()}):this.$Modal.confirm({title:"确定要退回题目吗？",content:"<p>退回题目将清空已标注内容。</p><p>点击确定按钮继续退回。</p>",onOk:()=>this.fetchReturn()})},handleShareDetail(){var t;const{host:e,protocol:s}=window.location,a=this.$router.resolve({name:"wb-task-label-detail",params:{task_id:this.taskId,pack_key:null===(t=this.detail)||void 0===t?void 0:t.pack_key}});return this.copyText=`${s}//${c["a"].SHARE_DOMAIN?c["a"].SHARE_DOMAIN:e}${a.href}`,this.copyText},async getPages(){const t=this.detailPage,e={task_id:this.taskId,page:{start:t.index-1,size:1,return_total:1}};let s={status:-1,msg:""};return Object.assign(e,this.handleSearchParams()),await Object(o["g"])(e).then(t=>{if(t){var e,a,i;let l={};if(this.detailPage.total=t.total,0===t.data.length)return s={status:0,msg:""};null!==(e=t.data)&&void 0!==e&&null!==(a=e[0])&&void 0!==a&&a.pack_key&&(this.packKey=t.data[0].pack_key||0,this.packIdList=[this.packKey]),l=this.getQuery(),this.$router.replace({name:"wb-task-label-detail",params:{task_id:this.taskId,pack_key:this.packKey},query:{...l,row_id:null===(i=t.data)||void 0===i?void 0:i[0].detail_id}})}s={status:1,msg:""}}).catch(t=>{console.log(t),s={status:-1,msg:t.message}}),s},onViewLabelVersion(t){this.isViewLabelVersion=t||"";const e=null!==t&&void 0!==t&&t.label?JSON.parse(t.label):"";e&&(this.LabelVersionContent={tags:e.tags?e.tags:[],objects:e.objects?e.objects:[],extData:e.extData?e.extData:null,fitting:e.fitting?e.fitting:[]},e.invalidTags&&(this.LabelVersionContent.invalidAnswer={tags:e.invalidTags?e.invalidTags:[]}))},updateIsErrorSurVeyCardSubmit(t){console.log(this.isErrorSurVeyCardSubmitArray),this.isErrorSurVeyCardSubmitArray.includes(t)||this.isErrorSurVeyCardSubmitArray.push(t)},updateStatus(t){this.status=t},handleAutoEdit(t){const e=this.details.map((e,s)=>{const a=this.$refs["engine"+s]&&this.$refs["engine"+s][0];return{detail_id:e.detail_id,flow_extra:{detail_label:this.isShowList?e.detail_label:JSON.stringify(null===a||void 0===a?void 0:a.result),batch_num:this.details.length,auto_validator_result:0,auto_validator_accepted:t?1:0}}});this.reportUpdate(8,{event_info_list:e}),this.isAutoEditing=!0,t?(this.isAutoValidating=!1,this.handlePauseOrResume(),this.$EventBus.$emit("counter-totalTimer-play")):this.fetchSubmitRet(this.isReLabeling?"relabel":"label")}},asyncMethods:{async fetchDetail(){var t,e;if(this.details=[],this.isFromLabel){const{status:t,msg:e}=await this.getPages();if(-1===t)throw new Error(e);if(0===t)return{}}const s={task_id:this.taskId,pack_keys:this.packIdList,need_check_info:1,cycle_step:0,need_deliver_info:!0,need_template_info:0,source:1,reason_deliver_id:null===this||void 0===this||null===(t=this.detailDeliverHistory)||void 0===t?void 0:t.reason_deliver_id};if(this.isReActionNum=0,this.scenesObj[this.scenes]&&(s.source=this.scenesObj[this.scenes]),0===(null===(e=s.pack_keys)||void 0===e?void 0:e.length))throw new Error("一页多题标注链接无法分享，请从标注领取入口进入");return Object(o["f"])(s).then(async t=>{var e;if((null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.length)>0){var s;const e=null===t||void 0===t?void 0:t.data;return e.forEach(t=>{var e,s,a;const i=this.handleDetailInfo({...t,template_schema:null===(e=this.statTask)||void 0===e?void 0:e.template_schema,template_component:null===(s=this.statTask)||void 0===s?void 0:s.template_component,template_tagset:null===(a=this.statTask)||void 0===a?void 0:a.template_tagset},"label"),l=15===t.check_status;l&&(this.isReActionNum=this.isReActionNum+1),this.details.push(Object.assign({},t,{...i,isReAction:15===t.check_status}))}),this.detailCopyList=r.a.cloneDeep(this.details),this.isPausing=this.details[0].pause,"relabel"!==this.scenes||await this.reportRe(1)?(this.pagination={current:1,pageSize:25,total:(null===(s=this.details)||void 0===s?void 0:s.length)||0},this.newDetails=[],this.clickLoadMore(),r.a.cloneDeep(this.details[0])):Promise.reject()}return{}}).catch(t=>{throw console.log(t),new Error(t.message)})},async fetchSave(t,e=!1){const s=t?"updateLabel":"saveLabel",a=t?"修改":"保存";let i=!0;if(this.isShowList&&!this.validateBatchData(this.$refs["batch-annotation-list"]))return Promise.resolve({});const r=[];if(this.details.forEach((t,e)=>{if(t.detail_is_valid){const t=this.$refs["engine"+e]&&this.$refs["engine"+e][0];t&&t.beforeSubmit.event&&t.beforeSubmit.options.saveEnabled&&r.push(t.beforeSubmit.event)}}),await Promise.all(r.map(t=>t())),this.details.forEach((s,a)=>{if(s.detail_is_valid){const s=this.$refs["engine"+a]&&this.$refs["engine"+a][0];!this.isShowList&&(null===s||void 0===s||s.validate({eventType:t?"submit":"save",auto:!!e})),!this.isShowList&&(i=(null===s||void 0===s?void 0:s.isValid)&&i)}}),!i&&t){const t=this.$refs.engine0&&this.$refs.engine0[0],s=null!==t.validateMsg,a=t&&t.validateMsg?t.validateMsg:"请完善必填项";return console.log("保存-validateMsg:",t,t.validateMsg),s&&this.$Notice.error({title:"",desc:"提示",render:t=>t("span",[`${e?"自动保存失败：":""}${a}`])}),Promise.resolve({})}const o=this.details.map((t,e)=>{const s={detail_id:t.detail_id,detail_label:"{}",detail_is_valid:t.detail_is_valid?1:0},a=this.$refs["engine"+e]&&this.$refs["engine"+e][0];return s.detail_is_valid?s.detail_label=this.isShowList?t.detail_label:JSON.stringify(null===a||void 0===a?void 0:a.result):s.detail_label=JSON.stringify({invalidTags:t.invalidAnswer.tags}),s});if(!this.isShowList){const e=Object(l["cloneDeep"])(o).some((e,s)=>{if(e.detail_is_valid&&t){const t=this.$refs["engine"+s][0];return this.validateAnswerJson(t,e.detail_label)}return!1});if(e)return Promise.resolve({})}const c={list:o,task_id:this.taskId};return Object(n["c"])("api/workbench",s,c).then(()=>{this.$Notice.success({title:"",desc:a+"成功",render:t=>t("span",[`${e?"自动":""}${a}成功`])}),this.isUpdate=!1,!e&&this.fetchDetail()}).catch(t=>{this.$Notice.error({title:"",desc:a+"失败",render:s=>s("span",[`${e?"自动":""}${a}失败${t.message}`])})})},fetchSaveRet(t){return this.fetchSave(t,!1)},fetchAutoSaveRet(t,e){return this.fetchSave(t,e)},async fetchSubmitRet(t,e){var s,a,i;if(Object(n["a"])(),this.unLoadedCount>0)return void this.$Message.error("存在未加载的题，请滚动到底部点击【继续加载】");if(this.isErrorSurVeyCardSubmitArray.length!==(null===(s=this.details)||void 0===s?void 0:s.length)&&null!==this&&void 0!==this&&null!==(a=this.statTask)&&void 0!==a&&a.business_config&&JSON.parse(null===this||void 0===this||null===(i=this.statTask)||void 0===i?void 0:i.business_config).enableSettlement&&15===this.status)return void this.$Message.error("请确认出错原因");this.operateType="提交";const r="relabel"===t?"submitRelabel":"submitLabel",o=[];if(this.isShowList&&!this.validateBatchData(this.$refs["batch-annotation-list"]))return Promise.resolve({});let c=!0,d=!0;if(!e&&this.details[this.curIdx].detail_is_valid||this.isShowList||this.isPageDetails){const t=[];if(this.details.forEach((e,s)=>{if(e.detail_is_valid){const e=this.$refs["engine"+s]&&this.$refs["engine"+s][0];e&&e.beforeSubmit.event&&t.push(e.beforeSubmit.event)}}),await Promise.all(t.map(t=>t())),this.details.forEach((t,e)=>{if(t.detail_is_valid){const t=this.$refs["engine"+e]&&this.$refs["engine"+e][0];!this.isShowList&&(null===t||void 0===t||t.validate({eventType:"submit"})),!this.isShowList&&(c=(null===t||void 0===t?void 0:t.isValid)&&c),!this.isShowLis&&c&&!this.isAutoEditing&&(d=t.isAutoValid)}}),!c){const t=this.$refs.engine0&&this.$refs.engine0[0],e=null!==t.validateMsg,s=t&&t.validateMsg?t.validateMsg:"请完善必填项";return console.log("提交-validateMsg:",t,t.validateMsg),e&&this.$Notice.error({title:"",desc:"提示",render:t=>t("span",[s])}),Promise.resolve({})}if(!d)return this.isLabeling&&this.fetchAutoSaveRet(!1,!0),this.isAutoValidating=!0,this.$Notice.error({title:"机审判定标注结果有误，请检查！"}),this.$EventBus.$emit("counter-totalTimer-pause"),this.handlePauseOrResume(),Promise.resolve({});this.details.forEach((t,s)=>{const a={detail_id:t.detail_id,detail_label:"{}",detail_is_valid:t.detail_is_valid?1:0},i=this.$refs["engine"+s]&&this.$refs["engine"+s][0];a.detail_is_valid?a.detail_label=this.isShowList?t.detail_label:JSON.stringify(null===i||void 0===i?void 0:i.result):a.detail_label=JSON.stringify({invalidTags:this.isPageDetails||this.isShowList?t.invalidAnswer.tags:e}),(!this.isReLabeling||t.isReAction)&&o.push(a)})}else{const t={};e?(t.detail_label=JSON.stringify({invalidTags:e}),t.detail_is_valid=0):(t.detail_label=this.details[this.curIdx].detail_label,t.detail_is_valid=this.details[this.curIdx].detail_is_valid),t.detail_id=this.details[this.curIdx].detail_id,o.push(t)}const u=Object(l["cloneDeep"])(o);if(!this.isShowList){const t=u.some((t,e)=>{if(t.detail_is_valid){const s=this.$refs["engine"+e][0];return this.validateAnswerJson(s,t.detail_label)}return!1});if(t)return Promise.resolve({})}const{taskId:h,teamId:_}=this;return console.log("提交标注",r,u),Object(n["c"])("api/workbench",r,{list:u,task_id:h}).then(()=>{this.$Notice.success({title:"",desc:"提交成功",render:t=>t("span",["提交成功 "])}),"relabel"===t?this.$router.push({name:"wb-queue-relabel",params:{task_id:h},query:{team_id:_}}):this.$router.push({name:"wb-queue-label",params:{task_id:h},query:{team_id:_}})}).catch(t=>{this.$Notice.error({title:"",desc:"提交失败",render:e=>e("span",["提交失败"+t.message])})})},fetchSkip(){const t={task_id:this.taskId};return t.pack_keys=this.packIdList,Object(o["o"])(t).then(()=>{this.$router.push({name:"wb-queue-label",params:{task_id:this.taskId},query:{type:this.type,team_id:this.teamId}})}).catch(t=>{location.reload(),this.$Notice.error({title:"",desc:"操作失败",render:e=>e("span",["操作失败："+t.message])})})},fetchReturn(t){const e={task_id:this.taskId,pack_keys:this.packIdList};return this.operateType="退回","time-out"===t&&(e.is_keep_label_result=1),Object(o["m"])(e).then(()=>{"time-out"===t&&(this.isTimeOut=!0),this.isFetchReturn=!0;const e=setInterval(()=>{this.backTimer=this.backTimer-1,this.backTimer<=0&&(window.opener=null,window.open(" ","_self"),window.close(),clearInterval(e))},1e3)}).catch(t=>{this.$Notice.error({title:"",desc:"操作失败",render:e=>e("span",["操作失败："+t.message])})})}}},h=u,_=s("2be6"),m=Object(_["a"])(h,a,i,!1,null,null,null);e["default"]=m.exports},c122:function(t,e,s){},c351:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TableFilter",{attrs:{searchLoading:t.fetchTasks.isPending,btnDirection:"horizontal"},on:{search:function(e){return t.changePage(1)},reset:function(e){return t.Reset(t.pageIndex=1)}}},[s("Form",{attrs:{inline:"","label-width":90,"label-colon":!0}},[s("Row",[s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务编号"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务编号"},model:{value:t.tasks_form.task_id,callback:function(e){t.$set(t.tasks_form,"task_id",e)},expression:"tasks_form.task_id"}})],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务名称关键字"},model:{value:t.tasks_form.task_name,callback:function(e){t.$set(t.tasks_form,"task_name",e)},expression:"tasks_form.task_name"}})],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务状态"}},[s("Select",{attrs:{transfer:"",clearable:"",disabled:t.isSelect},model:{value:t.tasks_form.task_status,callback:function(e){t.$set(t.tasks_form,"task_status",e)},expression:"tasks_form.task_status"}},t._l(t.taskStatus,(function(e,a){return 0!==e.value?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"物料类型"}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:t.tasks_form.materials_type,callback:function(e){t.$set(t.tasks_form,"materials_type",e)},expression:"tasks_form.materials_type"}},t._l(t.Materials,(function(e){return s("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1)],1)],1)],1)],1),t.fetchUnConfirmTaskCount.isResolved?[s("Batch",{attrs:{unConfirmTotal:t.unConfirmTotal,selectLength:t.selection.length},on:{updateStatus:t.updateStatus,batchTask:t.batchTask}})]:t._e(),s("Table",{ref:"table",attrs:{loading:t.fetchTasks.isPending,columns:t.columns,data:t.tasks},on:{"on-selection-change":t.selectDetails,"on-select-all":function(e){return t.selectAllDetails(!0)},"on-select-all-cancel":function(e){return t.selectAllDetails(!1)}},scopedSlots:t._u([{key:"bid_code",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.bid_code||"-"))])]}},{key:"task_id",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.task_id))]),a.created_at?s("p",[s("small",{staticClass:"txt-muted"},[t._v("创建:"+t._s(a.created_at))])]):t._e()]}},{key:"task_name",fn:function(e){var a=e.row;return[a.is_dynamic?s("div",{staticClass:"dynamic_tag mrs"},[t._v("动态")]):t._e(),s("span",{staticClass:"mrs ellipsis pointer",attrs:{title:a.task_name},on:{click:function(e){return t.showModal("editTasks",a)}}},[t._v(t._s(a.task_name))]),a.cross_num>=2?s("span",{staticClass:"txt-muted"},[t._v("("+t._s(a.cross_num)+"人交叉)")]):t._e()]}},{key:"team_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.team_name||"-"))])]}},{key:"total_num",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(t.$FormatNumber(a.total_num)||"-"))])]}},{key:"task_progress",fn:function(e){var a=e.row;return[void 0!==a.total_num&&void 0!==a.labeled_num&&!a.is_dynamic&&50!==a.task_status||a.total_num&&a.is_dynamic?s("div",{staticClass:"progress_box"},[void 0!==a.labeled_num?s("div",{staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v("已标注")]),a.total_num||a.labeled_num?[s("Progress",{staticClass:"progress_p",attrs:{percent:Math.round(a.labeled_num/a.total_num*1e4)/100,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(a.labeled_num||0)+" / "+t._s(a.total_num||0))]),0!==a.total_num?s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(Math.round(a.labeled_num/a.total_num*1e4)/100)+"%)")]):t._e()]:[s("Progress",{staticClass:"progress_p",attrs:{percent:0,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v("0 / 0")]),s("span",{staticClass:"mls txt-muted"},[t._v("(0%)")])]],2):t._e(),void 0!==a.reviewed_num?s("div",{staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v("已质检")]),a.total_num||a.reviewed_num?[s("Progress",{staticClass:"progress_p",attrs:{percent:Math.round(a.reviewed_num/a.total_num*1e4)/100,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(a.reviewed_num||0)+" / "+t._s(a.total_num||0))]),0!==a.total_num?s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(Math.round(a.reviewed_num/a.total_num*1e4)/100)+"%)")]):t._e()]:[s("Progress",{staticClass:"progress_p",attrs:{percent:0,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v("0 / 0")]),s("span",{staticClass:"mls txt-muted"},[t._v("(0%)")])]],2):t._e(),void 0!==a.deliver_num?s("div",{staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v("已交付")]),a.total_num||a.deliver_num?[s("Progress",{staticClass:"progress_p",attrs:{percent:Math.round(a.deliver_num/a.total_num*1e4)/100,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(a.deliver_num||0)+" / "+t._s(a.total_num||0))]),0!==a.total_num?s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(Math.round(a.deliver_num/a.total_num*1e4)/100)+"%)")]):t._e()]:[s("Progress",{staticClass:"progress_p",attrs:{percent:0,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v("0 / 0")]),s("span",{staticClass:"mls txt-muted"},[t._v("(0%)")])]],2):t._e()]):[s("span",[t._v("-")])]]}},{key:"task_status",fn:function(t){var e=t.row;return[s("task-status-render",{attrs:{value:e.task_status}})]}},{key:"creator",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.creator||"-"))])]}},{key:"materials_type",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.materials_type||"-"))])]}},{key:"action",fn:function(e){var a=e.row;return[a.accessible?s("div",[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.getTaskDetailList(a)}}},[t._v("详情")]),10===a.task_status?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userinfo.company_id}}"}]},[s("Divider",{attrs:{type:"vertical"}}),s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.showModal("taskAccept",[a])}}},[t._v("接受任务")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.showModal("taskReject",[a])}}},[t._v("放弃任务")])],1)]:t._e()],2):s("a",{attrs:{disabled:""}},[t._v("安全策略不可操作")])]}}])}),s("br"),s("Page",{staticClass:"right",attrs:{current:t.pageIndex,total:t.pageTotal,"page-size":t.pageSize,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}}),s("task-accept",{attrs:{visible:t.taskAcceptModal,tasks:t.taskAcceptModel,isBatch:t.selection.length>0},on:{hideModal:function(e){t.hideModal("taskAccept","refresh"===e?t.Fetch(t.tasks_form.task_status=""):"")}}}),s("task-reject",{attrs:{visible:t.taskRejectModal,tasks:t.taskRejectModel||[]},on:{hideModal:function(e){t.hideModal("taskReject","refresh"===e?t.Fetch(t.tasks_form.task_status=""):"")}}})],2)},i=[],l=s("9ec3"),r=s.n(l),n=s("8859"),o=s("ccb4"),c=s("d1d5"),d=s("864c"),u=s("bc94"),h=s("3a9c"),_=s("312d"),m=s("2289"),v=s("cd7e"),p=s("c605"),k={components:{TaskAccept:o["a"],TaskReject:c["a"],taskStatusRender:h["a"],Batch:v["a"],TableFilter:p["a"]},mixins:[n["a"]],modals:["taskAccept","taskReject"],data(){return{isSelect:!1,Materials:m["e"],pageIndex:1,pageSize:10,pageTotal:0,unConfirmTotal:0,bidTaskTotal:0,taskTotal:0,tasks_form:{bid_code:"",task_id:"",task_name:"",task_status:"",materials_type:""},taskStatus:_["r"],columns:[{title:"任务编号",slot:"task_id",width:200},{title:"任务名称",slot:"task_name",minWidth:150},{title:"对接人",key:"creator",align:"center",minWidth:100},{title:"物料类型",key:"materials_type",align:"center",minWidth:100},{title:"题目数",slot:"total_num",align:"right",minWidth:105},{title:"完成进度",slot:"task_progress",align:"left",minWidth:250},{title:"任务状态",slot:"task_status",align:"center",minWidth:100},{title:"标注小组",slot:"team_name",minWidth:100},{title:"操作",slot:"action",minWidth:220}],tasks:[],user:[],selection:[]}},computed:{userinfo(){return this.$store.state.userinfo.user}},watch:{isSelect(){this.isSelect?this.columns.unshift({type:"selection",align:"center",width:60}):(this.selection.length>0&&(this.selection=[],this.$refs.table.selectAll(!1)),this.columns.shift())}},mounted(){this.Fetch()},methods:{Fetch(){this.isSelect=!1,this.fetchTasks(),this.fetchUnConfirmTaskCount()},Reset(){r.a.forIn(this.tasks_form,(t,e)=>{this.tasks_form[e]=this.isSelect&&"task_status"===e?t:""}),this.fetchTasks()},changePage(t){this.pageIndex=t,this.fetchTasks()},selectDetails(t){this.selection=t},selectAllDetails(t){t&&this.$Message.info("已选当前页所有题目")},batchTask(t){this.showModal(t,this.selection)},updateStatus(t){t?(this.tasks_form.task_status=10,this.fetchTasks()):(this.tasks_form.task_status="",this.fetchTasks()),this.isSelect=t},getTaskDetailList(t){this.$router.push("/workbench/formal-tasks/"+t.task_id)},async mapStatTaskProgress(t){for(let e=0;e<t.length;e++){const s=await this.fetchStatTaskProgress(t[e].task_id);if(s){const a={...t[e],deliver_num:s.deliver_num,labeled_num:s.labeled_num,reviewed_num:s.reviewed_num,total_num:s.total_num};this.$set(this.tasks,e,a)}}}},asyncMethods:{fetchTasks(){const t={page:{start:(this.pageIndex-1)*this.pageSize,size:this.pageSize,return_total:1},task_type:0,need_stat_task:!0,need_stat_deliver:!0};return r.a.forIn(this.tasks_form,(e,s)=>{""!==this.tasks_form[s]&&(t[s]=this.tasks_form[s])}),t.task_status&&(t.task_status=Number(t.task_status)),d["a"].ListFormalManagerTasks(t).then(t=>{const{data:e}=t.data.result;return this.pageTotal=t.data.result.total,this.taskTotal<this.pageTotal&&(this.taskTotal=this.pageTotal),e.forEach(t=>{10!==t.task_status&&this.$set(t,"_disabled",!0),!t.accessible&&this.$set(t,"_disabled",!0)}),this.mapStatTaskProgress(e),e}).catch(t=>{this.$Message.error(t.message)})},fetchStatTaskProgress(t){const e={task_id:t,stat_object:["total_num","labeled_num","reviewed_num","deliver_num"]};return Object(u["s"])(e).then(t=>t).catch(t=>{console.log(t)})},fetchUnConfirmTaskCount(){const t={page:{start:0,size:0,return_total:1},task_type:0,task_status:10};return d["a"].ListFormalManagerTasks(t).then(t=>{this.unConfirmTotal=t.data.result.total})}}},f=k,b=(s("b392e"),s("2be6")),g=Object(b["a"])(f,a,i,!1,null,"baee9848",null);e["default"]=g.exports},c930:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"review-detail"},[s("Container",{attrs:{fetchObject:t.fetchDetail,isErrorPage:!t.details[t.curIdx],isPausePage:t.isPausing&&t.isReviewer&&(t.isReviewing||t.isReReviewing),task:t.statTask,errorData:t.errorData},on:{tryAgain:t.fetchDetail,reset:t.handleResetSearch},scopedSlots:t._u([{key:"content",fn:function(){return[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],staticClass:"z-header z-level"},[s("info",{attrs:{detailLength:t.details?t.details.length:0,detail:t.details[t.curIdx]||{},statTask:t.statTask,taskType:t.scenes?t.isReReviewing?"复检":"质检":""},scopedSlots:t._u([{key:"time-out",fn:function(){return[t.isReviewing&&t.checkTask&&t.checkTask.check_timeout?[s("time-out",{attrs:{siteTimeout:t.checkTask.check_timeout,isFetchReturn:t.isFetchReturn},on:{returnDetail:t.fetchReturn}})]:t._e()]},proxy:!0}])}),t.statTask&&t.statTask.cross_num&&t.details[t.curIdx]?s("div",{ref:"detailList",staticClass:"z-level__center",staticStyle:{cursor:"pointer","font-weight":"bold"},on:{click:function(e){t.modals.detail=!t.modals.detail}}},[s("cross-detail",{attrs:{detail:t.details[t.curIdx]}})],1):t._e(),t.isViewLabelVersion?[s("div",{staticClass:"label-version-view-tag"},[s("span",{staticClass:"mrs"},[t._v(t._s(t.isViewLabelVersion.tag_name))]),s("Tooltip",{attrs:{content:"关闭查看版本",placement:"top",transfer:""}},[s("Icon",{staticClass:"pointer",attrs:{type:"ios-close"},on:{click:function(e){return t.$refs.logs.resetVersion()}}})],1)],1)]:t._e(),s("div",{staticClass:"z-level__right"},[t.isPage&&!t.isViewLabelVersion?s("pages",{attrs:{detailForm:t.detailForm,detailPage:t.detailPage},on:{filterDetail:t.filterDetail,changePage:t.changePage,handleResetSearch:t.handleResetSearch}}):t._e(),s("count",{attrs:{isAction:(t.isReviewing||t.isReReviewing||t.isReviewingAgain)&&t.isReviewer,detail:t.detail,countInfo:t.countInfo,teamId:t.teamId},on:{handlePauseOrResume:t.handlePauseOrResume},scopedSlots:t._u([{key:"center",fn:function(){return[t.details[t.curIdx]?s("aid",{attrs:{isHotKey:!t.isPageDetails,stagesMetadataSC:t.stagesMetadataSC,isUpdate:t.isUpdate,copyText:t.copyText,isJsonViewEnabled:t.isJsonViewEnabled},on:{enterFullScreen:t.enterFullScreen,handleShareDetail:t.handleShareDetail,enterJsonView:t.enterJsonView}}):t._e()]},proxy:!0},{key:"returnBtn",fn:function(){return[t.isReviewing&&t.isReviewer?s("div",{staticClass:"z-level__item"},[s("Tooltip",{attrs:{content:"把题目退回并停止质检"}},[s("div",{staticClass:"middle hover-hand",on:{click:t.fetchReturn}},[s("Icon",{attrs:{type:"ios-return-left",size:"20"}}),t._v("退回")],1)])],1):t._e()]},proxy:!0}])})],1)],2),t.detail&&t.details.length>0?[0!==t.detail.is_delete_source?[s("Delete")]:[t.isShowList?[s("div",{staticClass:"z-main-list"},[t.showFullScreen?s("div",{staticClass:"closeFullScreen",on:{click:t.enterFullScreen}},[s("Icon",{attrs:{type:"ios-contract",size:"18"}}),s("span",[t._v("退出全屏模式")])],1):t._e(),s("batch-annotation-list",{ref:"batch-annotation-list",attrs:{details:t.details,isUpdate:(t.isUpdate||t.isReviewing||t.isReReviewing||t.isReviewingAgain)&&t.isReviewer,detailType:"review"},on:{changeDetails:t.changeDetails,getLogs:t.fetchFlowLogs,updateLabel:t.updateLabel}})],1)]:[t.detail.detail_id?s("div",{staticClass:"z-main",class:{"z-main-s":!t.isPageDetails,"label-version-view":!!t.isViewLabelVersion}},[t.showFullScreen?s("div",{staticClass:"closeFullScreen",on:{click:t.enterFullScreen}},[s("Icon",{attrs:{type:"ios-contract",size:"18"}}),s("span",[t._v("退出全屏模式")])],1):t._e(),t._l(t.computedDetailsForPage,(function(e,a){return s("div",{class:{optimus:t.isPageDetails,"z-main-s":!t.isPageDetails,"is-re-action":t.isPageDetails&&t.isReReviewing&&!e.isReAction},on:{click:function(e){t.curIdx=a}}},[s("optimus-engine",{key:t.isViewLabelVersion?t.isViewLabelVersion.version_id:e.key+t.isUpdate+e.detail_is_valid,ref:"engine"+a,refInFor:!0,style:{"border-top-right-radius":t.isPageDetails?"10px":"0px",maxHeight:t.isPageDetails?"calc(100vh - "+(t.showFullScreen?"80px":"220px")+")":""},attrs:{component:e.component,context:e.context,answer:t.isViewLabelVersion?t.LabelVersionContent:e.isValidAnswer,schema:e.schema,curLabelGroup:t.statTask&&t.statTask.template_label_group,disabled:!(t.isReviewer&&(e.isUpdate||t.isUpdate)&&e.detail_is_valid)||!!t.isViewLabelVersion,name:"engine"+a,active:!t.isPageDetails,objectId:e.detail_id.toString(),objectType:"task-detail",debug:t.isJsonViewEnabled,reference:{datasetItemId:e.dataset_item_id.toString(),watermarkContent:t.userInfo.real_user_id,rawAnswer:e.detail_label}}}),t.isPageDetails&&e.detail_id&&!e.detail_is_valid?s("invalid-banner",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],attrs:{detail:e,isUpdate:e.isUpdate},on:{updateValid:function(t){return e.detail_is_valid=t},openInvalidModal:t.createModal}}):t._e(),t.isPageDetails?s("Row",{staticClass:"optimus-footer"},[s("Col",{attrs:{span:"12"}},[s("span",{staticClass:"mrm"},[t._v("题目ID："+t._s(e.dataset_item_id))]),s("span",{staticClass:"mrm"},[t._v("|")]),s("span",[t._v("任务明细ID："+t._s(e.detail_id))]),t.isShowLog&&e.detail_id>2?s("a",{staticClass:"mlm",on:{click:function(s){return t.fetchFlowLogs(e.detail_id,!0)}}},[t._v("日志")]):t._e()]),t.isReviewer&&(t.isUpdate||t.isReviewing||t.isReReviewing&&e.isReAction||t.isReviewingAgain)?s("Col",{staticClass:"right",attrs:{span:"12"}},[e.isUpdate?[s("Button",{staticClass:"mrm",attrs:{size:"small"},on:{click:function(e){return t.updateLabel(a,"取消修改")}}},[t._v("取消修改")]),e.detail_is_valid?s("Button",{staticClass:"mrm",attrs:{type:"warning",ghost:"",size:"small"},on:{click:function(e){return t.createModal("invalid")}}},[t._v("标记无效")]):t._e(),s("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.updateLabel(a,"提交修改")}}},[t._v("提交修改")])]:[e.isReUpdate||e.isError?[s("span",{staticStyle:{"line-height":"22px"}},[s("Icon",{staticClass:"mrs",attrs:{type:"md-close-circle",color:"red"}}),s("span",{staticClass:"mrm"},[t._v("此题错误")])],1),s("Button",{staticClass:"mrm",attrs:{size:"small"},on:{click:function(e){return t.updateLabel(a,"重置")}}},[t._v("重置")]),s("Button",{attrs:{type:"primary",ghost:"",size:"small"},on:{click:function(e){return t.updateLabel(a,"继续修改")}}},[t._v("继续修改")])]:[e.isReAction?[s("Icon",{staticClass:"mtm",attrs:{type:"ios-alert",color:"#f90"}}),s("span",{staticClass:"mrm"},[t._v("质检不通过")])]:t._e(),s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:"",size:"small"},on:{click:function(e){return t.updateLabel(a,"质检不通过")}}},[t._v("质检不通过")]),s("Button",{attrs:{type:"primary",ghost:"",size:"small"},on:{click:function(e){return t.updateLabel(a,"修改标注")}}},[t._v("修改标注")])]]],2):t._e()],1):t._e()],1)})),!t.loaded&&t.isPageDetails&&t.details.length-t.pageEnd>0?s("Alert",{class:{"load-more":!0}},[s("span",[t._v("还有 "+t._s(t.details.length-t.pageEnd)+" 题，")]),s("Button",{attrs:{type:"primary",size:"small"},on:{click:t.loadMore}},[t._v("继续加载")])],1):t._e()],2):t._e()],t.details[t.curIdx]&&!t.details[t.curIdx].detail_is_valid&&!t.isPageDetails&&!t.isShowList&&!t.isViewLabelVersion||t.isViewLabelVersion&&t.LabelVersionContent.invalidAnswer?s("invalid-banner",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen,expression:"!showFullScreen"}],attrs:{detail:t.isViewLabelVersion?t.LabelVersionContent:t.details[t.curIdx],isUpdate:t.isUpdate},on:{openInvalidModal:t.createModal,updateValid:function(e){return t.details[t.curIdx].detail_is_valid=e}}}):t._e()],s("Footer",{directives:[{name:"show",rawName:"v-show",value:!t.showFullScreen&&t.detail.detail_id,expression:"!showFullScreen && detail.detail_id"}],attrs:{task:t.statTask,isList:t.isPageDetails||t.isShowList,isShowLog:t.isShowLog&&t.detail.detail_id>2,latestFlowLog:t.latestFlowLog,rejectData:t.rejectData},on:{openLogs:t.createModal},scopedSlots:t._u([{key:"buttons",fn:function(){return[t.isViewLabelVersion?t._e():s("div",{staticClass:"z-level__right"},[t.isPending?[s("Button",{attrs:{loading:"",size:"large",type:"primary"}},[t._v("提交中")])]:[s("div",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"queue-review",extra:{team:t.teamId}},expression:"{domain: 'task', action: 'queue-review', extra: {team: teamId}}"}]},[t.isReviewer?[t.isReviewing||t.isReReviewing?[s("Pause",{attrs:{task:t.statTask,isPausing:t.isPausing}})]:t._e(),t.isReviewing&&!t.isUpdate?[t.statTask&&t.statTask.cross_num?[s("Checkbox",{staticClass:"checkbox-disabled",attrs:{disabled:!0,value:!0}},[s("span",{staticClass:"txt-muted mrm"},[t._v("质检提交时，默认取当前标注作为最终结果")])])]:t._e(),t.isPageDetails||t.isShowList?[s("b",[t._v("（错误题数："+t._s(t.getErrorNum())+" ｜ 正确题数："+t._s(t.details.length-t.getErrorNum())+"）")])]:t._e(),s("Tooltip",{attrs:{content:"跳过这条题目，领取下一条"}},[s("Button",{staticClass:"mrm",attrs:{type:"default",size:"large",loading:t.fetchSkip.isPending},on:{click:t.fetchSkip}},[t._v("跳过")])],1),t.statTask.cross_num||!t.isPageDetails&&!t.isShowList?t._e():s("Save",{attrs:{isPausing:t.isPausing,loading:t.fetchSaveLabel.isPending},on:{handleSave:t.fetchSaveLabel}}),t.isPageDetails||t.isShowList?[s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitReviewRet(0)}}},[s("div",{staticClass:"button-board"},[t._v("提交并继续质检")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:[s("Tooltip",{attrs:{content:"提交后自动领取下一条待质检题目",transfer:"",placement:"top-end"}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitReviewRet(1)}}},[s("div",{staticClass:"button-board"},[t._v("质检通过")]),t.isPageDetails?t._e():s("div",{staticClass:"key-board"},[t._v("(ALT + p)")])])],1),s("Tooltip",{attrs:{content:"此题错误，待原标注员修改"}},[s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:"",size:"large"},on:{click:function(e){return t.createModal("review","reset")}}},[s("div",{staticClass:"button-board"},[t._v("质检不通过")]),t.isPageDetails?t._e():s("div",{staticClass:"key-board"},[t._v("(f)")])])],1),s("Tooltip",{attrs:{content:"此题错误，直接修改标注结果",placement:"top-end"}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large",ghost:"",disabled:!t.checkTask.label_editable},on:{click:function(e){return t.update()}}},[s("div",{staticClass:"button-board"},[t._v("修改标注")]),t.isPageDetails?t._e():s("div",{staticClass:"key-board"},[t._v("(m)")])])],1)]]:t._e(),t.isReReviewing&&!t.isUpdate?[t.isPageDetails||t.isShowList?[s("b",[t._v("（复检错误题数："+t._s(t.getErrorNum())+" ｜ 待复检题数："+t._s(t.isReActionNum)+"）")]),s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitReviewRet(0)}}},[s("div",{staticClass:"button-board"},[t._v("提交并继续质检")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:[s("Tooltip",{attrs:{content:"提交后自动领取下一条待复检题目"}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitReviewRet(1)}}},[s("div",{staticClass:"button-board"},[t._v("质检通过")]),t.isPageDetails||t.isShowList?t._e():s("div",{staticClass:"key-board"},[t._v("(ALT + p)")])])],1),s("Tooltip",{attrs:{content:"此题错误，待原标注员修改"}},[s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:"",size:"large"},on:{click:function(e){return t.createModal("review","reset")}}},[s("div",{staticClass:"button-board"},[t._v("质检不通过")]),t.isPageDetails||t.isShowList?t._e():s("div",{staticClass:"key-board"},[t._v("(f)")])])],1),s("Tooltip",{attrs:{content:"此题错误，直接修改标注结果",placement:"top-end"}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large",ghost:"",disabled:!t.checkTask.label_editable},on:{click:function(e){return t.update()}}},[s("div",{staticClass:"button-board"},[t._v("修改标注")]),t.isPageDetails||t.isShowList?t._e():s("div",{staticClass:"key-board"},[t._v("(m)")])])],1)]]:t._e(),t.isAllowUpdateReview&&!t.isUpdate?[s("Button",{staticClass:"mrm",attrs:{type:"primary",ghost:"",size:"large"},on:{click:function(e){return t.handleReviewAgain("review_again")}}},[t._v("重新质检")])]:t._e(),t.isReviewingAgain&&!t.isUpdate?[s("span",{staticClass:"mrm"},[t._v("重新质检中……")]),t.isPageDetails||t.isShowList?[s("b",[t._v("（错误题数："+t._s(t.getErrorNum())+" ｜ 正确题数："+t._s(t.details.length-t.getErrorNum())+"）")]),s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitReviewRet(0)}}},[s("div",{staticClass:"button-board"},[t._v("提交并继续质检")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:[s("Pause",{attrs:{task:t.statTask,isPausing:t.isPausing}}),s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large"},on:{click:function(e){return t.fetchSubmitReviewRet(1)}}},[s("div",{staticClass:"button-board"},[t._v("质检通过")]),t.isPageDetails||t.isShowList?t._e():s("div",{staticClass:"key-board"},[t._v("(ALT + p)")])]),s("Tooltip",{attrs:{content:"此题错误，待原标注员修改"}},[s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:"",size:"large"},on:{click:function(e){return t.createModal("review","reset")}}},[s("div",{staticClass:"button-board"},[t._v("质检不通过")]),t.isPageDetails||t.isShowList?t._e():s("div",{staticClass:"key-board"},[t._v("(f)")])])],1),s("Tooltip",{attrs:{content:"此题错误，直接修改标注结果",placement:"top-end"}},[s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large",ghost:"",disabled:!t.checkTask.label_editable},on:{click:function(e){return t.update()}}},[s("div",{staticClass:"button-board"},[t._v("修改标注")]),t.isPageDetails||t.isShowList?t._e():s("div",{staticClass:"key-board"},[t._v("(m)")])])],1)]]:t._e(),(t.isReviewing||t.isReReviewing||t.isReviewingAgain)&&t.isUpdate?[s("Button",{staticClass:"mrm",attrs:{type:"default",size:"large"},on:{click:t.handleReset}},[t._v("取消修改")]),t.isPageDetails||!t.details[t.curIdx].detail_is_valid||t.isShowList?t._e():s("Button",{staticClass:"mrm",attrs:{type:"warning",ghost:"",size:"large"},on:{click:function(e){return t.createModal("invalid")}}},[t._v("标记无效")]),t.statTask.cross_num?t._e():s("Save",{attrs:{isPausing:t.isPausing,loading:t.fetchSaveLabel.isPending},on:{handleSave:t.fetchSaveLabel}}),s("Button",{staticClass:"mrm",attrs:{type:"primary",size:"large",loading:t.fetchSubmitReviewRet.isPending},on:{click:function(e){return t.createModal("review","update")}}},[s("div",{staticClass:"button-board"},[t._v("提交修改")]),s("div",{staticClass:"key-board"},[t._v("(ALT + c)")])])]:t._e()]:t._e()],2)]],2)]},proxy:!0}],null,!1,3589102791)})]:t._e()]},proxy:!0}])}),s("logs",{ref:"logs",attrs:{task:t.statTask,flowLogs:t.flowLogs,visible:t.modals.logs,loading:t.fetchFlowLogs.isPending},on:{"update:visible":function(e){return t.$set(t.modals,"logs",e)},onViewLabelVersion:t.onViewLabelVersion}}),s("review-remark",{attrs:{visible:t.modals.review,isReview:(t.isReviewing||t.isReReviewing)&&!t.isPageDetails&&!t.isShowList,type:t.modals.type,mask:t.isPageDetails,currentDetail:t.details[t.curIdx]},on:{"update:visible":function(e){return t.$set(t.modals,"review",e)},"on-ok":t.getRemark}}),t.details[t.curIdx]?s("invalid-modal",{attrs:{visible:t.modals.invalid,statusList:t.statusList,detail:t.isViewLabelVersion?Object.assign({},t.details[t.curIdx],{invalidAnswer:t.LabelVersionContent.invalidAnswer}):t.details[t.curIdx],isUpdate:(t.isUpdate||t.isReviewing&&t.details[t.curIdx].isUpdate||t.isReReviewing&&t.details[t.curIdx].isReAction)&&t.isReviewer},on:{"update:visible":function(e){return t.$set(t.modals,"invalid",e)},"on-ok":t.handleForm}}):t._e(),s("detail-list",{attrs:{details:t.detailCrossList,detail:t.details[t.curIdx],visible:t.modals.detail},on:{"update:visible":function(e){return t.$set(t.modals,"detail",e)},"change-detail":t.changeDetail}}),s("json-view-modal",{attrs:{visible:t.modals.jsonView,detail:t.details[t.curIdx],isJsonViewEnabled:t.isJsonViewEnabled},on:{"update:visible":function(e){return t.$set(t.modals,"jsonView",e)}}}),s("return-modal",{attrs:{visible:t.isFetchReturn,backTimer:t.backTimer,isTimeOut:t.isTimeOut},on:{"update:visible":function(e){t.isFetchReturn=e}}})],1)},i=[],l=(s("8d0d"),s("f38f"),s("9ec3")),r=s.n(l),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{key:t.modal,ref:"detailList",attrs:{draggable:"",scrollable:"","footer-hide":"",mask:!1,transfer:!1,width:550},on:{"on-cancel":t.closeModal},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[s("template",{slot:"header"},[s("b",[t._v("当前标注结果")])]),s("Input",{staticClass:"mbm",attrs:{placeholder:"搜索",clearable:""},model:{value:t.selectDetail,callback:function(e){t.selectDetail=e},expression:"selectDetail"}},[s("Icon",{attrs:{slot:"suffix",type:"ios-search"},slot:"suffix"})],1),t.groupDetails&&t.detail?s("div",{staticClass:"detail_list"},t._l(t.groupDetails,(function(e,a){return e[0].message&&e[0].message.includes(t.selectDetail)||!t.selectDetail?s("div",{staticClass:"detail_info cursor hover-hand",style:{"font-weight":t.detail.cross_id===e[0].cross_id?"bold":"normal",cursor:"pointer"},on:{click:function(s){return t.changeDetail({cross_id:a,row_id:e[0].detail_id})}}},[s("span",[t._v(t._s(e[0].message))])]):t._e()})),0):t._e()],2)},o=[],c={props:{visible:Boolean,details:Array,detail:Object},data(){return{groupDetails:{},modal:this.visible,showInput:!1,selectDetail:""}},watch:{visible(t){this.modal=t},details(t){t&&t.length>0&&this.initDetails()}},methods:{initDetails(){this.groupDetails=Object(l["groupBy"])(this.details,"cross_id")},closeModal(){this.$emit("update:visible",!1)},changeDetail(t){this.$emit("change-detail",t)}}},d=c,u=(s("f087"),s("2be6")),h=Object(u["a"])(d,n,o,!1,null,"469f8069",null),_=h.exports,m=s("dde5"),v=s("bc94"),p=s("bccd"),k=s("db49"),f=s("597a"),b=s("864c"),g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"cross-detail"},[t.detail.detail_id<3?s("Tooltip",{attrs:{placement:"top-end","max-width":"300"}},[s("template",{slot:"content"},[1===t.detail.detail_id?s("p",[t._v("根据模板配置，拟合结果取多人标注的众数或平均数；置信度反映了有几人结果同拟合结果一致；分差反映了多人结果同拟合结果的差值之和")]):s("p",[t._v("最终结果为交付时最终提交的结果；一致率反映了有几人结果同最终结果一致；分差反映了多人结果同最终结果的差值之和")])]),s("Icon",{staticClass:"mrs",attrs:{type:"ios-help-circle-outline"}})],2):t._e(),s("span",[t._v(t._s(t.detail.message))]),s("Icon",{staticClass:"mrs",attrs:{type:"ios-arrow-down"}})],1)},y=[],w={props:{detail:{type:Object,default(){return{}}}}},C=w,S=Object(u["a"])(C,g,y,!1,null,null,null),T=S.exports,I=s("c495"),$={components:{DetailList:_,CrossDetail:T},mixins:[f["a"]],data(){const{check_id:t}=this.$route.params,e=this.$route.params.dataset_id||"0",s=this.$route.params.pack_id||"0",{row_id:a,cross_id:i,deliver_id:l}=this.$route.query;return{pageIndex:0,pageSize:25,detailCrossList:[],packIdList:[],datasetId:"0"===e?Number(e):Object(p["BigNumber"])(e),checkId:t,rowId:a,crossId:i,deliverId:l,packId:"0"===s?"":s,isPageDetails:!1,editScores:"",isViewLabelVersion:!1,LabelVersionContent:"",checkTask:{},isRecord:!1,isSaved:!1,visibleDetails:{},loaded:!1}},computed:{companyInfo(){return this.$store.state.companyinfo},statusList(){return{isPageDetails:this.isPageDetails}},isPending(){return this.fetchReturn.isPending||this.fetchSkip.isPending||this.fetchSubmitReviewRet.isPending},isJsonViewEnabled(){const{query:t,path:e}=this.$route;return["page_project"].includes(t.type)||!e.includes("workbench")},isRequestCheck(){const{query:t}=this.$route,{check_id:e}=this.$route.params;return"0"!==e&&(!["page_project","page","page_audit"].includes(t.type)||"review"===t.from)},computedDetailsForPage(){return this.isPageDetails?this.details.slice(0,this.pageEnd):this.details},pageEnd(){return this.pageSize+this.pageIndex>=this.details.length?this.details.length:this.pageSize+this.pageIndex}},watch:{$route(t){var e,s;this.rowId=null===t||void 0===t||null===(e=t.query)||void 0===e||null===(s=e.row_id)||void 0===s?void 0:s.toString()},"fetchTask.isResolved"(t){t&&this.getCountInfo(this.task)}},async mounted(){await this.fetchTask(),this.fetchCheckTask();const t=await this.fetchDetail();document.addEventListener("keydown",this.listenKeyboardEvent),this.$EventBus.$on("handlePauseOrResume",t=>{this.handlePauseOrResume(t)}),this.$EventBus.$on("reportHeartbeat",()=>{this.reportHeartbeat(1)}),t&&this.$route.query.json_view&&this.enterJsonView(),document.addEventListener("visibilitychange",this.onCheckPauseOrResume)},beforeDestroy(){this.$EventBus.$off("handlePauseOrResume"),this.$EventBus.$off("reportHeartbeat"),document.removeEventListener("visibilitychange",this.onCheckPauseOrResume)},destroy(){document.removeEventListener("keydown",this.listenKeyboardEvent)},methods:{loadMore(){this.details.length>=this.pageIndex?this.pageIndex=this.pageSize+this.pageIndex:this.loaded=!0},listenKeyboardEvent:r.a.debounce((function(t){const{target:e,code:s,altKey:a}=t,i=(this.isReviewing||this.isReReviewing||this.isReviewingAgain)&&!this.isUpdate;if(!this.isReviewer||0===this.details.length)return 0;"INPUT"===e.tagName&&"checkbox"!==e.getAttribute("type")||"TEXTAREA"===e.tagName||e.getAttribute("contenteditable")||("KeyP"===s&&a&&i&&!this.isPageDetails?this.fetchSubmitReviewRet(1):"KeyC"===s&&a&&this.isUpdate?(!this.isPageDetails&&this.createModal("review","update"),this.isPageDetails&&this.fetchSubmitReviewRet(0)):"KeyM"===s&&!this.isPageDetails&&i&&this.checkTask.label_editable?this.update():"KeyF"===s&&i&&!this.isPageDetails&&this.createModal("review","reset"))}),200),getCountInfo(t){const{reviewedNum:e,totalNum:s,check_timeout:a,template_component:i}=t;Object.assign(this.countInfo,r.a.omitBy({actionNum:e,totalNum:s,timeout:a,templateComponent:i?JSON.parse(i):null},r.a.isNil))},update(){this.closeModal("review"),this.isUpdate=!0},changeDetail(t){if(this.closeModal("logs"),t.cross_id){this.details=this.detailCrossList.filter(e=>e.cross_id===t.cross_id);const e=r.a.cloneDeep(Object.assign({},this.$route.query,{cross_id:t.cross_id,row_id:t.row_id}));return e.from&&(e.from="review"),this.$router.replace(this.getRouteInfo(e)),void(null!==t&&void 0!==t&&t.row_id&&(this.detail.detail_id=t.row_id,["1","2"].includes(t.row_id.toString())?this.latestFlowLog={}:this.fetchFlowLogs(t.row_id)))}this.detail=this.detailCrossList[t.value],this.details=[r.a.cloneDeep(this.detail)],this.detailCopyList=[r.a.cloneDeep(this.detail)],this.handleReviewAgain("review"),this.detail.detail_id>2&&this.fetchFlowLogs(this.detail.detail_id)},getDetailMessage(t){var e,s,a;const i=t=>Math.round(10*t)/10,l=t=>Math.round(100*t)/100,r=t.detail_id;let n=(null===t||void 0===t||null===(e=t.label)||void 0===e?void 0:e.fitting)||[];var o,c;((null===t||void 0===t||null===(s=t.label)||void 0===s?void 0:s.editScores)&&(this.editScores=null===t||void 0===t||null===(a=t.label)||void 0===a?void 0:a.editScores),t.cross_pack_fitting)&&(n=null===t||void 0===t||null===(o=t.cross_pack_fitting)||void 0===o?void 0:o.fitting,this.editScores=null===t||void 0===t||null===(c=t.cross_pack_fitting)||void 0===c?void 0:c.editScores);const d={0:{distance:"编辑距离得分"},1:{result:"拟合结果",most:"置信度",average:"分差",distance:"平均编辑距离得分"},2:{result:"最终结果",most:"一致率",average:"分差",distance:"平均编辑距离得分"}};let u="";if([1,2].includes(r)){const t=n&&n.find(t=>"most"===t.type),e=n&&n.find(t=>"average"===t.type),s={most:t&&t.score?i(t.score):0,average:e&&e.score?i(e.score):0,score:this.editScores?l(this.editScores.avgScore):0};u=`${d[r].result}（${d[r].most}：${s.most}%｜${d[r].average}：${s.average}`,this.editScores&&(u+=`｜${d[r].distance}：${s.score}`),u+="）"}else{var h,_,m;u=this.isPageDetails&&null!==(h=this.statTask)&&void 0!==h&&h.cross_num?`${t.labeler_nick_name||"-"}（准确率：${t.accurate||"0"}%）`:`${t.labeler_nick_name||"-"}（任务明细ID：${r}）`;const e=null===(_=this.editScores)||void 0===_||null===(m=_.detailScore)||void 0===m?void 0:m.find(t=>t.detailId===r.toString());e&&(u+=`（${d[0].distance}：${e.score}）`)}return u},getRemark(t,e){if(this.isPageDetails||this.isShowList){const s=this.curIdx;this.details[s].remark=e,2===t?(!this.isShowList&&(this.details[s].isValidAnswer={objects:this.$refs["engine"+s][0].result.objects,tags:this.$refs["engine"+s][0].result.tags,extData:this.$refs["engine"+s][0].result.extData}),this.details[s].isUpdate=!1,this.details[s].isReUpdate=!0,this.details[s].isError=!1,this.details[s].isReValid=this.details[s].detail_is_valid):this.details[s].isError=!0,this.details[s].key=Math.random()}else this.fetchSubmitReviewRet(t,e)},getErrorNum(){return this.details.filter(t=>t.isError||t.isReUpdate).length},updateLabel(t,e){const s=Math.random();switch(this.curIdx=t,e){case"修改标注":case"继续修改":this.details[t].isUpdate=!0,this.details[t].key=s===this.details[t].key?Math.random():s;break;case"提交修改":{let e=!0;const s=this.$refs["engine"+t]&&this.$refs["engine"+t][0];if(s&&this.details[t].detail_is_valid){s.validate({eventType:"submit"}),e=s.isValid&&e;const t=s.validateMsg?s.validateMsg:"请完善必填项";e||this.$Notice.error({title:"",desc:"提示",render:e=>e("span",[t])})}e&&this.createModal("review","update");break}case"取消修改":this.details[t].isUpdate=!1,this.details[t].detail_is_valid=this.details[t].isReValid,this.details[t].key=s===this.details[t].key?Math.random():s,this.isSaved&&this.fetchSaveLabel("reset",t);break;case"重置":this.details[t]=Object.assign(this.details[t],r.a.cloneDeep(this.detailCopyList[t])),this.details[t].key=s===this.details[t].key?Math.random():s,this.details[t].isError=!1;break;case"质检不通过":this.createModal("review","reset");break}},async handleReset(){this.closeModal("review"),this.details[this.curIdx]=Object.assign(this.details[this.curIdx],r.a.cloneDeep(this.detailCopyList[this.curIdx])),this.isSaved&&await this.fetchSaveLabel("reset"),this.isUpdate=!1},handleForm(t){this.details[this.curIdx].invalidAnswer.tags=t,this.details[this.curIdx].detail_is_valid=!1},handleReviewAgain(t,e){const s=Object.assign({},this.$route.query,{row_id:this.detail.detail_id,from:t});this.$router.replace(this.getRouteInfo(s)),e?this.fetchDetail():this.reportUpdate(7)},getRouteInfo(t){return{name:"wb-task-review-detail",params:{task_id:this.taskId,check_id:this.checkId||0,pack_id:this.packId||0,dataset_id:0},query:t}},handleShareDetail(){const{host:t,protocol:e}=window.location,s=this.$router.resolve(this.getRouteInfo({team_id:this.teamId}));return this.copyText=`${e}//${k["a"].SHARE_DOMAIN?k["a"].SHARE_DOMAIN:t}${s.href}`,this.copyText},async onCheckPauseOrResume(){if(!this.details||!this.details.length)return;if(!this.getDetailIds().length)return;const[t]=this.getDetailIds();if(t&&!document.hidden){await this.fetchFlowLogs(t);const{flow_code:e,flow_action:s}=this.latestFlowLog;(null===e||void 0===e?void 0:e.toString())===t.toString()&&s&&"PAUSE"===s&&!this.isPausing&&(console.log("检测到暂停事件于"+(new Date).toLocaleTimeString("it-IT")),this.isPausing=!0)}},async initializeDetail(t){var e,s,a,i;if(null!==t&&void 0!==t&&null!==(e=t.pack_list)&&void 0!==e&&null!==(s=e[0])&&void 0!==s&&null!==(a=s.dataset_list)&&void 0!==a&&null!==(i=a[0])&&void 0!==i&&i.detail_list){const e=[],{statTask:s,rowId:a}=this,i=t.pack_list;let l=0,n={};this.isPageDetails=i.length>1,this.isReActionNum=0;let o=!1;if(i.forEach(t=>{var i;this.isPageDetails=(null===t||void 0===t||null===(i=t.dataset_list)||void 0===i?void 0:i.length)>1||this.isPageDetails,t.dataset_list.forEach(i=>{const n=i.detail_list;o=n.length>1;const{fitting_result:c,final_result:d}=i,u=i.detail_list[0],h=JSON.parse(s.template_component);if(c){const e=Object(I["b"])(h,c);e.tags.forEach(t=>{var e;"average"===(null===(e=t.fitting)||void 0===e?void 0:e.type)&&this.$set(t,"value",Number(t.value).toString())}),e.objects.forEach(t=>{t.tags.forEach(t=>{var e;"average"===(null===(e=t.fitting)||void 0===e?void 0:e.type)&&this.$set(t,"value",Number(t.value).toString())})});const s=Object.assign(r.a.cloneDeep(u),{detail_id:1,detail_label:JSON.stringify(e),labeler_nick_name:"$fitting_result",cross_id:"$fitting_result",cross_pack_fitting:JSON.parse(t.fitting_result)});s.message=this.getDetailMessage(s),n.unshift(s)}if(d){const e=Object(I["b"])(h,d);e.tags.forEach(t=>{var e;if("average"===(null===(e=t.fitting)||void 0===e?void 0:e.type)){const e=isNaN(Number(t.value))?t.value:Number(t.value).toString();this.$set(t,"value",e)}}),e.objects.forEach(t=>{t.tags.forEach(t=>{var e;if("average"===(null===(e=t.fitting)||void 0===e?void 0:e.type)){const e=isNaN(Number(t.value))?t.value:Number(t.value).toString();this.$set(t,"value",e)}})});const s=Object.assign(r.a.cloneDeep(u),{detail_id:2,detail_label:JSON.stringify(e),labeler_nick_name:"$final_result",cross_id:"$final_result",cross_pack_fitting:JSON.parse(t.final_result)});s.message=this.getDetailMessage(s),n.unshift(s)}n.forEach((t,i)=>{let r={};const n=15===t.check_status,c=this.handleDetailInfo({...t,template_schema:s.template_schema,template_component:s.template_component,template_tagset:s.template_tagset});n&&(this.isReActionNum=this.isReActionNum+1),r=Object.assign({},t,{...c,isUpdate:!1,isError:this.isFromReview&&n,isReUpdate:!1,isReValid:!c.label.invalidTags,isReAction:n,remark:"",detail_is_valid:!c.label.invalidTags,cross_id:t.cross_id||"result"+t.cross_no}),o&&(r.message=this.getDetailMessage(r)),e.push(r),o&&a&&(Number(a)===t.detail_id||Object(p["BigNumber"])(a)===t.detail_id||JSON.stringify(a)===JSON.stringify(t.detail_id))&&(l=i),this.$set(this.visibleDetails,t.detail_id,!1)})})}),n=r.a.cloneDeep(e[l]),this.details=this.isPageDetails?e:[n],this.detailCopyList=r.a.cloneDeep(this.details),this.detailCrossList=r.a.cloneDeep(e),o&&i[0].dataset_item_count){let t="";t=this.crossId?this.crossId:this.rowId?this.details.find(t=>t.detail_id.toString()===this.rowId).cross_id:i[0].final_result?"$final_result":"result0",this.details=e.filter(e=>e.cross_id===t),this.rowId&&(l=this.details.findIndex(t=>t.detail_id.toString()===this.rowId));const s=r.a.cloneDeep(Object.assign({},this.$route.query,{cross_id:t}));this.$router.replace(this.getRouteInfo(s)),this.detailCopyList=r.a.cloneDeep(this.details)}return this.curIdx=this.isPageDetails?l:0,this.packId=n.pack_key,this.isPausing=n.pause,this.shortCutOptions(n.component.component),"re_review"!==this.scenes||await this.reportRe(2)?r.a.cloneDeep(n):Promise.reject()}throw new Error("数据错误，请联系管理员")},async getPages(){const t=this.detailPage,e={task_id:this.taskId,page:{start:t.index-1,size:1,return_total:1}};let s={status:-1,msg:""},a="";if(this.isFromReview)e.deliver_id=this.deliverId,Object.assign(e,this.handleSearchParams()),a=Object(v["i"])(e);else if(this.isPage){const t="page_project"===this.type?"api":"api/workbench";Object.assign(e,this.handleSearchParams()),e.need_deliver_info=!0,a="page_audit"===this.type?Object(m["c"])(t,"listAuditDetail",e):Object(m["c"])(t,"listDetail",e)}return this.closeModal("logs"),await a.then(t=>{if(t){this.detailPage.total=t.total;const e=r.a.cloneDeep(this.$route.params);if(0===t.data.length)return s={status:0,msg:""};let a={};this.packId=t.data[0].pack_id||t.data[0].pack_key||0,this.checkId=t.data[0].check_id||"0",this.datasetId=0,a=this.getQuery(),this.$router.push({name:"wb-task-review-detail",params:Object.assign({},e,{pack_id:this.packId||0,check_id:this.checkId,dataset_id:0}),query:Object.assign({},a,{row_id:t.data[0].detail_id})})}s={status:1,msg:""}}).catch(t=>{console.log(t),s={status:-1,msg:t.message}}),s},getPackIds(){this.packIdList=[],this.packId?this.packIdList=[this.packId]:this.packId||this.datasetId||(this.packIdList=JSON.parse(localStorage.getItem("pack_key_list")))},onViewLabelVersion(t){this.isViewLabelVersion=t||"";const e=null!==t&&void 0!==t&&t.label?JSON.parse(t.label):"";e&&(this.LabelVersionContent={tags:e.tags?e.tags:[],objects:e.objects?e.objects:[],extData:e.extData?e.extData:null,fitting:e.fitting?e.fitting:[]},e.invalidTags&&(this.LabelVersionContent.invalidAnswer={tags:e.invalidTags?e.invalidTags:[]}))}},asyncMethods:{async fetchDetail(){var t;if(this.details=[],this.isPage){const{status:t,msg:e}=await this.getPages();if(-1===t)throw new Error(e);if(0===t)return{}}this.getPackIds();const e={task_id:this.taskId};if("0"!==this.checkId&&(e.check_id=this.checkId),(null===(t=this.packIdList)||void 0===t?void 0:t.length)>0&&(e.pack_keys=this.packIdList),this.datasetId&&(e.item_ids=[this.datasetId]),this.scenesObj[this.scenes]&&(e.source=this.scenesObj[this.scenes]),!e.item_ids&&!e.pack_keys)throw new Error("一页多题质检链接无法分享，请从抽检入口进入");return this.isRequestCheck?Object(v["d"])(e).then(t=>this.initializeDetail(t)).catch(t=>{throw console.log(t),new Error(t.message)}):Object(v["v"])(e).then(t=>this.initializeDetail(t)).catch(t=>{throw console.log(t),new Error(t.message)})},async fetchSubmitReviewRet(t,e){var s;if(!this.loaded&&this.isPageDetails&&this.details.length>this.pageEnd)return void this.$Message.error("请加载完所有题目后提交");if(Object(m["a"])(),this.operateType="提交",this.isShowList&&!this.validateBatchData(this.$refs["batch-annotation-list"]))return Promise.resolve({});const a=[];let i=!1,r=!0;const n=this.isReviewing?"submitReview":"updateReview",o=[];if(this.details.forEach((t,e)=>{if(t.detail_is_valid){const t=this.$refs["engine"+e]&&this.$refs["engine"+e][0];t.beforeSubmit.event&&o.push(t.beforeSubmit.event)}}),await Promise.all(o.map(t=>t())),this.details.forEach((s,l)=>{let n=t;i=i||s.isUpdate;const o={dataset_item_id:s.dataset_item_id,detail_is_valid:s.detail_is_valid?1:0,detail_id:s.detail_id},c=this.$refs["engine"+l]&&this.$refs["engine"+l][0];(this.isPageDetails||this.isShowList)&&(s.isError&&(n=0),s.isReUpdate&&!s.isError&&(n=2),!s.isUpdate&&!s.isReUpdate&&!s.isError&&(n=1)),o.result=n,2===o.result?(!this.isShowList&&(null===c||void 0===c||c.validate()),!this.isShowList&&(r=(null===c||void 0===c?void 0:c.isValid)&&r),o.detail_is_valid?o.detail_label=this.isShowList?s.detail_label:JSON.stringify({objects:null===c||void 0===c?void 0:c.result.objects,tags:null===c||void 0===c?void 0:c.result.tags.filter(t=>"invalidTags"!==t.name),extData:null===c||void 0===c?void 0:c.result.extData}):o.detail_label=JSON.stringify({invalidTags:s.invalidAnswer.tags}),o.remark=this.isPageDetails||this.isShowList?s.remark:e):0===n&&(o.remark=this.isPageDetails||this.isShowList?s.remark:e),(!this.isReReviewing||s.isReAction)&&a.push(o)}),!r){const t=this.$refs.engine0&&this.$refs.engine0[0],e=t.validateMsg?t.validateMsg:"请完善必填项";return this.$Notice.error({title:"",desc:"提示",render:t=>t("span",[e])}),Promise.resolve({})}if(i)return this.$Notice.error({title:"",desc:"提示",render:t=>t("span",["存在未提交的修改"])}),Promise.resolve({});const c=Object(l["cloneDeep"])(a);if(!this.isShowList){const t=c.some((t,e)=>{if(t.detail_is_valid){const s=this.$refs["engine"+e][0];return this.validateAnswerJson(s,t.detail_label)}return!1});if(t)return Promise.resolve({})}return Object(m["c"])("api/workbench",n,{check_id:this.checkId,dataset_items:a,task_id:this.taskId,deliver_id:null===(s=this.detail)||void 0===s?void 0:s.deliver_id,review_type:this.isReReviewing?1:2}).then(()=>{const{taskId:t}=this;return this.isUpdate=!1,this.$Notice.success({title:"",desc:"质检提交成功",render:t=>t("span",["已提交"])}),this.isReviewingAgain?this.handleReviewAgain("review",!0):(this.isReviewing&&localStorage.removeItem("pack_key_list"),this.$router.push({name:this.isReReviewing?"wb-queue-rereview":"wb-queue-review",params:{task_id:t,deliver_id:this.detail.deliver_id},query:{type:this.type,team_id:this.teamId,check_id:this.checkId}})),!0}).catch(t=>{console.log(t),this.$Notice.error({title:"",desc:"提交失败",render:t=>t("span",["提交失败"])})})},fetchSkip(){const t={task_id:this.taskId,check_id:this.checkId,pack_keys:this.isPageDetails?this.packIdList:[this.packId]};return Object(v["p"])(t).then(()=>{this.isReviewing&&localStorage.removeItem("pack_key_list"),this.$router.push({name:"wb-queue-review",params:{task_id:this.taskId,deliver_id:this.detail.deliver_id},query:{type:this.type,team_id:this.teamId,check_id:this.checkId}})}).catch(t=>{this.$Notice.error({title:"",desc:"操作失败",render:e=>e("span",["操作失败："+t.message])}),location.reload()})},fetchReturn(t){const e={task_id:this.taskId,pack_keys:this.isPageDetails?this.packIdList:[this.packId],check_id:this.checkId};return this.operateType="退回",Object(v["n"])(e).then(()=>{"time-out"===t&&(this.isTimeOut=!0),this.isFetchReturn=!0,this.isReviewing&&localStorage.removeItem("pack_key_list");const e=setInterval(()=>{this.backTimer=this.backTimer-1,this.backTimer<=0&&(window.opener=null,window.open(" ","_self"),window.close(),clearInterval(e))},1e3)}).catch(t=>{this.$Notice.error({title:"",desc:"操作失败",render:e=>e("span",["操作失败："+t.message])})})},async fetchSaveLabel(t,e){const s="auto"===t;this.isSaved=!0;const a=[];this.computedDetailsForPage.forEach((t,e)=>{if(t.detail_is_valid){const t=this.$refs["engine"+e]&&this.$refs["engine"+e][0];t.beforeSubmit.event&&t.beforeSubmit.options.saveEnabled&&a.push(t.beforeSubmit.event)}}),await Promise.all(a.map(t=>t()));const i=this.computedDetailsForPage.map((a,i)=>{const l={detail_id:a.detail_id,detail_label:"{}",detail_is_valid:a.detail_is_valid?1:0},r=this.$refs["engine"+i]&&this.$refs["engine"+i][0];return r.validate({eventType:"save",auto:s}),"reset"!==t||void 0!==e&&e!==i?l.detail_is_valid?l.detail_label=JSON.stringify(null===r||void 0===r?void 0:r.result):l.detail_label=JSON.stringify({invalidTags:a.invalidAnswer.tags}):l.detail_label=a.detail_label,l}),l={list:i,task_id:this.taskId};return Object(m["c"])("api/workbench","saveLabel",l).then(()=>{"reset"!==t&&this.$Notice.success({title:"",desc:"保存成功",render:t=>t("span",[(s?"自动":"")+"保存成功"])})}).catch(e=>{this.$Notice.error({title:"",desc:"reset"===t?"取消修改失败":"保存失败",render:a=>a("span",[`${s?"自动":""}${"reset"===t?"取消修改":"保存"}失败：${e.message}`])})})},fetchCheckTask(){if("0"===this.checkId||!this.scenes&&!this.$route.query.from)return{};const t={task_id:this.taskId,check_id:this.checkId};return b["a"].GetCheckTask(t).then(t=>{var e,s,a,i;const l=t.data.result,r={label_editable:!(null===(e=l.check_config)||void 0===e||!e.is_label_editable),batch_check_num:null===(s=l.check_config)||void 0===s?void 0:s.batch_check_num,check_timeout:null===(a=l.check_config)||void 0===a?void 0:a.check_timeout,cross_num:l.cross_num,cycle_step:l.cycle_step,show_review_log:null===(i=l.check_config)||void 0===i?void 0:i.is_reviewer_view_log};return this.isRecord=1!==l.cycle_step,this.fetchStatCheckTask(l.deliver_id),r}).catch(t=>{this.$Message.error(t.message)})},fetchStatCheckTask(t){const e={task_id:this.taskId,deliver_id:t,check_id:this.checkId,team_id:Number(this.teamId)||void 0,stat_scene:"check",stat_scope:"check"};return Object(v["q"])(e).then(t=>{const e=t;return this.checkTask={...this.checkTask,totalNum:e.item_num||e.check_num||0,reviewedNum:e.checked_num||0},this.getCountInfo(this.checkTask),e}).catch(t=>{console.log(t)})}}},x=$,D=(s("1628"),Object(u["a"])(x,a,i,!1,null,"647a1267",null));e["default"]=D.exports},ccb4:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{attrs:{title:t.isAudit?"分配小组":"接受任务",width:"400","mask-closable":!1,closable:!1},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[t.isFetch?[t.fetchBatchAcceptTask.isPending?s("Alert",{attrs:{"show-icon":""}},[t._v("任务处理中......")]):t.fetchBatchAcceptTask.isRejected?s("Alert",{attrs:{"show-icon":"",type:"warning"}},[t._v("成功处理"+t._s(t.tasks.length-t.failTasks.length)+"个任务，失败"+t._s(t.failTasks.length)+"个任务，请重试")]):t._e()]:[s("Form",{ref:"form",attrs:{model:t.formData,"label-position":"top","hide-required-mark":""}},[s("FormItem",{attrs:{prop:"team_id",rules:{required:!0,message:"小组不能为空"}},scopedSlots:t._u([{key:"label",fn:function(){return[s("span",[t._v("请选择负责这")]),t.isBatch&&t.tasks?s("a",[t._v(" "+t._s(t.tasks.length)+" ")]):t._e(),s("span",[t._v("个任务的小组：")])]},proxy:!0}],null,!1,3653415612)},[s("Select",{staticClass:"accept_select",attrs:{transfer:"",filterable:""},model:{value:t.formData.team_id,callback:function(e){t.$set(t.formData,"team_id",e)},expression:"formData.team_id"}},t._l(t.teams,(function(e){return s("Option",{key:e.team_id,attrs:{value:e.team_id}},[t._v(t._s(e.team_name))])})),1)],1)],1)],s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{loading:t.fetchBatchAcceptTask.isPending},on:{click:function(e){return t.hideModal(t.isFetch&&"refresh")}}},[t._v("取消")]),t.isFetch?t.isFetch&&t.fetchBatchAcceptTask.isRejected?s("Button",{attrs:{type:"primary",loading:t.fetchBatchAcceptTask.isPending},on:{click:function(e){return t.fetchBatchAcceptTask(t.failTasks)}}},[t._v("重试")]):t._e():s("Button",{attrs:{type:"primary",loading:t.fetchBatchAcceptTask.isPending},on:{click:function(e){return t.Submit(t.tasks)}}},[t._v("确认并处理")])],1)],2)},i=[],l=s("e3fa"),r=s("864c"),n={props:{visible:Boolean,tasks:Array,isBatch:Boolean,isAudit:Boolean},data(){return{modal:this.visible,formData:{team_id:""},teams:[],failTasks:[],isFetch:!1}},computed:{companyinfo(){return this.$store.state.companyinfo}},watch:{visible(){this.modal=this.visible,this.modal&&this.fetchTeams()}},methods:{Submit(t){this.$refs.form.validate(e=>{e?this.isBatch?this.fetchBatchAcceptTask(t):this.fetchAcceptTask(t):this.$Message.error("提交失败，请检查是否有遗漏")})},hideModal(t){var e;this.$emit("hideModal",t),this.isFetch=!1,this.failTasks=[],this.formData.team_id="",null===(e=this.$refs.form)||void 0===e||e.resetFields()}},asyncMethods:{fetchTeams(){const t={page:{start:0,size:500,return_total:1},company_id:this.companyinfo.company_id};return Object(l["s"])(t).then(t=>t.data).catch(t=>{console.log(t)})},fetchAcceptTask(){const{formData:t,isAudit:e}=this,s={task_id:this.tasks[0].task_id,team_id:t.team_id};return e&&(s.task_type=2),r["a"].AcceptTask(s).then(t=>{t.data.result&&(this.$Message.success("已接受任务！"),this.hideModal("refresh"))}).catch(t=>{console.log(t),this.$Message.error(t.message)})},fetchBatchAcceptTask(t){const e=[];return this.failTasks=[],this.isFetch=!0,t.forEach(t=>{const s={task_id:t.task_id,team_id:this.formData.team_id};this.isAudit&&(s.task_type=2),e.push(r["a"].AcceptTask(s).then(e=>({task:t,result:e.data.result})).catch(e=>({task:t,error:e})))}),Promise.all(e).then(t=>(console.log(t),this.isBatch&&(null===t||void 0===t||t.forEach(t=>{t.result&&!t.error||this.failTasks.push(t.task)})),this.failTasks.length>0?Promise.reject(!1):(this.$Message.success("批量接受任务成功！"),this.hideModal("refresh"),Promise.resolve(!0))))}}},o=n,c=s("2be6"),d=Object(c["a"])(o,a,i,!1,null,null,null);e["a"]=d.exports},ccb8:function(t,e,s){},cd7e:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mbm mtm"},[t.isBatch?s("p",[s("Button",{staticClass:"mrm",attrs:{type:"primary",ghost:"",icon:"md-build"},on:{click:function(e){return t.batchAction(!1)}}},[t._v("退出批量操作")]),2===t.taskType?[s("Button",{staticClass:"mrm",attrs:{type:"success",ghost:"",disabled:!t.selectLength},on:{click:function(e){return t.batchTask("taskAccept")}}},[t._v("分配小组")])]:[s("Button",{staticClass:"mrm",attrs:{type:"success",ghost:"",disabled:!t.selectLength},on:{click:function(e){return t.batchTask("taskAccept")}}},[t._v("接受任务")]),s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:"",disabled:!t.selectLength},on:{click:function(e){return t.batchTask("taskReject")}}},[t._v("放弃任务")])],s("span",{staticClass:"right mtm"},[t._v("已选中 "+t._s(t.selectLength||0)+" 个任务。")])],2):s("div",{staticClass:"alert"},[s("Icon",{staticClass:"mrm",attrs:{type:"ios-alert",color:"#2d8cf0"}}),s("span",[t._v("您共有 "+t._s(t.unConfirmTotal)+" 个任务待"+t._s(2===t.taskType?"分配小组":"接单")+"。")]),s("a",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userInfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userInfo.company_id}}"}],staticClass:"right",on:{click:function(e){return t.batchAction(!0)}}},[t._v("批量操作")])],1)])},i=[],l={props:{taskType:Number,unConfirmTotal:Number,selectLength:Number},data(){return{isBatch:!1}},computed:{userInfo(){return this.$store.state.userinfo.user}},mounted(){},methods:{batchAction(t){this.isBatch=t,this.$emit("updateStatus",t)},batchTask(t){this.$emit("batchTask",t)}},asyncMethods:{}},r=l,n=(s("a3fb"),s("2be6")),o=Object(n["a"])(r,a,i,!1,null,"11b62669",null);e["a"]=o.exports},d142:function(t,e,s){"use strict";s("a7de")},d1d5:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Modal",{staticClass:"bid-reject",attrs:{title:t.isFetch?"当前进度":"确认要放弃这"+(t.tasks.length>1?t.tasks.length:"")+"个试标任务吗？",width:"400","mask-closable":!1,closable:!1},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[t.isFetch?[t.fetchBatchRejectTask.isPending?s("Alert",{attrs:{"show-icon":""}},[t._v("任务处理中......")]):t.fetchBatchRejectTask.isRejected?s("Alert",{attrs:{"show-icon":"",type:"warning"}},[t._v("成功处理"+t._s(t.tasks.length-t.failTasks.length)+"个任务，失败"+t._s(t.failTasks.length)+"个任务，请重试")]):t._e()]:[t.isBid?s("Form",{ref:"form",attrs:{model:t.form}},[s("FormItem",{staticClass:"width",attrs:{prop:"remark",rules:{required:!0,message:"请选择放弃原因"}}},[s("RadioGroup",{attrs:{vertical:""},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}},t._l(t.REMARKS,(function(e){return s("Radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])})),1)],1),"其他"===t.form.remark?s("FormItem",{staticClass:"width",attrs:{prop:"remarkInfo",rules:{required:!0,message:"请填写具体原因"}}},[s("Input",{attrs:{type:"textarea",placeholder:"请填写具体原因"},model:{value:t.form.remarkInfo,callback:function(e){t.$set(t.form,"remarkInfo",e)},expression:"form.remarkInfo"}})],1):t._e()],1):s("p",{staticClass:"mtm mbm mlm"},[t._v("确定放弃的话，任务会变成已放弃状态。")])],s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{loading:t.fetchBatchRejectTask.isPending},on:{click:function(e){return t.hideModal(t.isFetch&&"refresh")}}},[t._v("取消")]),t.isFetch?t.isFetch&&t.fetchBatchRejectTask.isRejected?s("Button",{attrs:{type:"primary",loading:t.fetchBatchRejectTask.isPending},on:{click:function(e){return t.fetchBatchRejectTask(t.failTasks)}}},[t._v("重试")]):t._e():s("Button",{attrs:{type:"warning",loading:t.fetchBatchRejectTask.isPending},on:{click:function(e){return t.fetchBatchRejectTask(t.tasks)}}},[t._v("确定")])],1)],2)},i=[],l=s("864c");const r=["暂无相关资源","人力不足","暂无相关标注能力","涉及敏感数据无法承接","试标截至时间紧急","供应商侧标注平台不支持","其他"];var n={props:{visible:Boolean,tasks:Array,isBid:Boolean},data(){return{REMARKS:r,modal:this.visible,failTasks:[],isFetch:!1,form:{remark:null,remarkInfo:""}}},watch:{visible(){this.modal=this.visible}},methods:{hideModal(t){this.$emit("hideModal",t),this.isFetch=!1,this.failTasks=[],this.form.remark=null,this.form.remarkInfo=""}},asyncMethods:{async fetchBatchRejectTask(t){var e;let s=!0;if(await(null===(e=this.$refs.form)||void 0===e?void 0:e.validate(t=>{s=t})),!s)return 0;const a=[],{remark:i,remarkInfo:r}=this.form,n="其他"===i?r:i;return this.failTasks=[],this.isFetch=!0,t.forEach(t=>{const e={task_id:t.task_id,remark:n};a.push(l["a"].AbstainTask(e).then(e=>({task:t,result:e.data.result})).catch(e=>({task:t,error:e})))}),Promise.all(a).then(t=>(null===t||void 0===t||t.forEach(t=>{t.result&&!t.error||this.failTasks.push(t.task)}),this.failTasks.length>0?Promise.reject(!1):(this.$Message.success("放弃任务成功！"),this.hideModal("refresh"),Promise.resolve(!0))))}}},o=n,c=s("2be6"),d=Object(c["a"])(o,a,i,!1,null,null,null);e["a"]=d.exports},d361:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.Fetch.isRejected?s("error",{attrs:{message:t.Fetch.rejectedWith.message}}):t._e(),t.Fetch.isResolved?s("div",{staticStyle:{position:"relative"}},[s("auth-view",{attrs:{perm:{domain:"task",action:"view",extra:{company:t.userinfo.company_id,team:t.task&&(t.isAudit?t.task.audit_team_id:t.task.team_id)}}}},[s("div",{attrs:{slot:"forbidden"},slot:"forbidden"},[s("Deny")],1),s("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[s("Breadcrumb",[s("BreadcrumbItem",[t._v("任务管理")]),s("BreadcrumbItem",{attrs:{to:t.RouteToTasks}},[t._v("任务列表")]),s("BreadcrumbItem",[t._v("任务详情")])],1),s("div",[t.isAudit?[t.task.audit_team_id&&-1!==t.task.audit_team_id?t._e():s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mls",attrs:{type:"primary",shape:"circle"},on:{click:function(e){return t.showModal("taskAccept")}}},[t._v("分配小组")])],1),20===t.task.task_status?s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"submit",extra:{team:t.task.audit_team_id,company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'submit', extra: {team: task.audit_team_id, company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mls",attrs:{type:"primary",icon:"md-contacts",shape:"circle"},on:{click:t.deliverSubmit}},[t._v("审核提交")])],1):t._e()]:[10===t.task.task_status?s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mls",attrs:{type:"success",icon:"md-checkmark-circle-outline",shape:"circle"},on:{click:function(e){return t.showModal("taskAccept")}}},[t._v("接受任务")]),s("Button",{staticClass:"mls",attrs:{type:"error",icon:"md-close-circle",shape:"circle"},on:{click:function(e){return t.showModal("taskReject",[t.task])}}},[t._v("放弃任务")])],1):t._e(),20!==t.task.task_status||t.task.task_type&&!t.bidTask?t._e():s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"submit",extra:{team:t.task.team_id,company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'submit', extra: {team: task.team_id, company: userinfo.company_id}}"}]},[s("Button",{staticClass:"mls",attrs:{type:"primary",icon:"md-contacts",shape:"circle"},on:{click:t.deliverSubmit}},[t._v("批次交付")])],1)],s("Tooltip",{attrs:{content:"关闭页面"}},[s("Button",{staticClass:"mls",attrs:{type:"dashed",icon:"md-close",shape:"circle",to:t.RouteToTasks}})],1)],2)],1),s("t-divider",{attrs:{align:"left"}},[s("span",{staticStyle:{display:"flex"}},[s("h3",[t._v(t._s(t.task.task_name))]),s("task-status-render",{staticClass:"mlm",attrs:{value:t.task.task_status}}),1===t.task.is_dynamic?s("Tag",{staticClass:"mls",attrs:{color:"cyan",title:"支持API动态追加数据包，并将数据包自动同步到标注任务中"}},[t._v("动态任务")]):t._e(),t.task.cross_num&&t.task.cross_num>=2?s("Tag",{staticClass:"mls",attrs:{color:"orange",title:t.task.cross_num+"个人同时标注一道题"}},[t._v(t._s(t.task.cross_num)+"人交叉")]):t._e()],1)]),s("div",{staticClass:"margin"},[s("div",{staticClass:"margin"},[s("Row",{staticClass:"row-height"},[s("Col",{attrs:{span:"3"}},[s("b",[t._v("项目编号")])]),s("Col",{attrs:{span:"9"}},[s("Tag",{staticClass:"mrm",staticStyle:{"font-size":"10px"},attrs:{color:"primary"}},[t._v(t._s(1===t.task.project_type?"外部":"内部"))]),s("span",[t._v(t._s(t.task.project_id||"-"))])],1),s("Col",{attrs:{span:"3"}},[s("b",[t._v("任务编号")])]),s("Col",{attrs:{span:"9"}},[s("Tag",{staticClass:"mrm",attrs:{color:1===t.task.task_type?"error":"success"}},[t._v(t._s(1===t.task.task_type?"试标":"正式"))]),s("span",[t._v(t._s(t.task.task_id||"-"))])],1)],1),s("Row",{staticClass:"row-height"},[t.isAudit?[s("Col",{attrs:{span:"3"}},[s("b",[t._v("审核小组")])]),s("Col",{attrs:{span:"9"}},[t._v(t._s(t.task.audit_team_name||"-"))]),s("Col",{attrs:{span:"3"}},[s("b",[t._v("审核数据统计")])]),s("Col",{attrs:{span:"9"}},[t._v(t._s(t.$FormatNumber(t.task.deliver_num)+" / "+t.$FormatNumber(t.task.audit_num)+" / "+t.$FormatNumber(t.task.total_num)+" (已交付/已审核/总量）"))])]:[s("Col",{attrs:{span:"3"}},[s("b",[t._v("标注小组")])]),s("Col",{attrs:{span:"9"}},[t._v(t._s(t.task.team_name||"-"))]),s("Col",{attrs:{span:"3"}},[s("b",[t._v("标注数据统计")])]),s("Col",{attrs:{span:"9"}},[t._v(t._s(t.$FormatNumber(t.task.labeled_num)+" / "+t.$FormatNumber(t.task.reviewed_num)+" / "+t.$FormatNumber(t.task.deliver_num)+" / "+t.$FormatNumber(t.task.total_num)+" (已标注/已质检/已交付/总量）"))])]],2),s("Row",{staticClass:"row-height"},[s("Col",{attrs:{span:"3"}},[s("b",[t._v("创建时间")])]),s("Col",{attrs:{span:"9"}},[s("span",[t._v(t._s(t.task.created_at||"-"))])])],1)],1),s("Tabs",{attrs:{name:"0"},on:{"on-click":t.ChangeTab},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[s("TabPane",{attrs:{label:"基本信息",name:"info",tab:"0"}},[t.fetchBidTask.isResolved||t.fetchFormalTask.isResolved?s("Info",{attrs:{taskInfo:t.task,task:1===t.task.task_type?t.bidTask:t.formalTask,taskType:t.task.task_type,projectType:!!t.task.project_type}}):t._e()],1),s("TabPane",{attrs:{label:"标注题目",name:"details",tab:"0"}},[s("tableFilter",{attrs:{searchLoading:t.fetchDetails.isPending},on:{search:function(e){return t.fetchDetails(t.detail_page.index=1)},reset:function(e){return t.ResetDetails(t.detail_page.index=1)}}},[s("Form",{attrs:{inline:"","label-position":"right","label-width":100,"label-colon":!0}},[s("Row",{attrs:{gutter:10}},[s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"任务明细ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务明细ID进行搜索"},model:{value:t.detail_form.detail_id_list,callback:function(e){t.$set(t.detail_form,"detail_id_list",e)},expression:"detail_form.detail_id_list"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"题目ID"}},[s("Input",{attrs:{type:"text",placeholder:"输入题目ID进行搜索"},model:{value:t.detail_form.dataset_item_id_list,callback:function(e){t.$set(t.detail_form,"dataset_item_id_list",e)},expression:"detail_form.dataset_item_id_list"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"是否有效"}},[s("Select",{attrs:{transfer:""},model:{value:t.detail_form.detail_valid,callback:function(e){t.$set(t.detail_form,"detail_valid",e)},expression:"detail_form.detail_valid"}},[s("Option",{key:1,attrs:{value:1}},[t._v("有效")]),s("Option",{key:0,attrs:{value:0}},[t._v("无效")])],1)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"交付状态"}},[s("Select",{attrs:{transfer:""},model:{value:t.detail_form.is_deliver,callback:function(e){t.$set(t.detail_form,"is_deliver",e)},expression:"detail_form.is_deliver"}},t._l(t.deliverStatus,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"质检结果"}},[s("Select",{attrs:{transfer:""},model:{value:t.detail_form.check_status,callback:function(e){t.$set(t.detail_form,"check_status",e)},expression:"detail_form.check_status"}},t._l(t.deliverCheckStatus,(function(e,a){return 0!==e.value?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1)],1),t.isAudit?s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"审核状态"}},[s("Select",{attrs:{transfer:""},model:{value:t.detail_form.is_audit,callback:function(e){t.$set(t.detail_form,"is_audit",e)},expression:"detail_form.is_audit"}},t._l(t.auditStatus,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1)],1):s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"标注状态"}},[s("Select",{attrs:{transfer:""},model:{value:t.detail_form.detail_status,callback:function(e){t.$set(t.detail_form,"detail_status",e)},expression:"detail_form.detail_status"}},t._l(t.labelStatus,(function(e,a){return s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))])})),1)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"处理人"}},[s("Input",{attrs:{type:"text",placeholder:"输入当前处理人名称"},model:{value:t.detail_form.nick_name_list,callback:function(e){t.$set(t.detail_form,"nick_name_list",e)},expression:"detail_form.nick_name_list"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"标注人"}},[s("Select",{attrs:{filterable:"",transfer:"",placeholder:"输入最后标注人相关信息"},on:{"on-open-change":function(e){e&&t.fetchUsers()}},model:{value:t.detail_form.last_labeler_list,callback:function(e){t.$set(t.detail_form,"last_labeler_list",e)},expression:"detail_form.last_labeler_list"}},t._l(t.users,(function(e){return e.role_type.includes("admin")||e.role_type.includes("labeler")?s("Option",{key:e.user_id,attrs:{label:e.nick_name,value:e.user_id}},[s("p",[t._v(t._s(e.nick_name))])]):t._e()})),1)],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticClass:"width",attrs:{label:"题包Key"}},[s("Input",{attrs:{type:"text",placeholder:"输入题包Key进行搜索"},model:{value:t.detail_form.pack_keys,callback:function(e){t.$set(t.detail_form,"pack_keys",e)},expression:"detail_form.pack_keys"}})],1)],1)],1)],1)],1),t.isAudit?t._e():s("Row",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"update-status",extra:{team:t.task.team_id}},expression:"{domain: 'task', action: 'update-status', extra: {team: task.team_id}}"}],staticClass:"mbm",staticStyle:{gap:"12px"},attrs:{type:"flex"}},[s("Col",[[s("auth-view",{attrs:{perm:{domain:"task",action:"wb-export",extra:{company:t.user.company_id.toString(),team:t.task.team_id}}}},[s("Button",{attrs:{type:"primary",icon:"md-download"},on:{click:t.exportDetailList}},[t._v("导出题目列表")])],1)]],2),s("Col",[20===t.task.task_status?[s("Button",{attrs:{type:"primary",icon:"md-build",ghost:t.isSelect,loading:t.fetchUpdateDetailStatus.isPending},on:{click:function(e){t.isSelect=!t.isSelect}}},[t._v(t._s(t.isSelect?"退出批量操作":"批量操作题目"))]),t.isSelect?[s("Tooltip",{attrs:{content:"打回到待标注，无处理人",placement:"top",transfer:""}},[s("Button",{staticClass:"mlm",attrs:{type:"primary",loading:t.fetchUpdateDetailStatus.isPending,disabled:t.btn_disabled},on:{click:function(e){return t.UpdateDetailStatus(10)}}},[t._v("清空标注")])],1),s("Tooltip",{attrs:{content:"自动添加一个抽检任务，数据默认质检不通过",placement:"top","max-width":180,transfer:""}},[s("Button",{staticClass:"mlm",attrs:{type:"primary",loading:t.fetchUpdateDetailStatus.isPending,disabled:t.btn_disabled},on:{click:function(e){return t.UpdateDetailStatus(15)}}},[t._v("打回返修")])],1)]:t._e()]:t._e()],2)],1),s("Table",{ref:"details",attrs:{border:"",columns:t.columns,data:t.details,loading:t.fetchDetails.isPending},on:{"on-selection-change":t.SelectDetails,"on-select-cancel":function(e){t.isSelectAll=!1},"on-select-all":function(e){return t.SelectAllDetails(!0)},"on-select-all-cancel":function(e){return t.SelectAllDetails(!1)}},scopedSlots:t._u([{key:"detail_id",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.detail_id||"-"))])]}},{key:"dataset_item_id",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.dataset_item_id||"-"))])]}},{key:"pack_key",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.pack_key||"-"))])]}},{key:"detail_status",fn:function(t){var e=t.row;return[s("label-status-render",{attrs:{value:e.detail_status}})]}},{key:"check_status",fn:function(t){var e=t.row;return[s("deliver-check-status-render",{attrs:{value:e.check_status}})]}},{key:"deliver_status",fn:function(e){var a=e.row;return[a.deliver_status?s("deliverStatusRender",{attrs:{value:a.deliver_status>10&&a.deliver_status<70?1:0}}):s("span",[t._v("-")])]}},{key:"audit_status",fn:function(e){var a=e.row;return[a.deliver_status>=30&&a.deliver_status<=60?s("span",[t._v("已审核")]):s("span",[t._v("待审核")])]}},{key:"assignee_nick_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.assignee_nick_name||"-"))])]}},{key:"labeler_nick_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.labeler_nick_name||"-"))])]}},{key:"detail_is_valid",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.detail_is_valid?"有效":"无效"))])]}},{key:"detail_action",fn:function(e){var a=e.row,i=e.index;return[50!==t.task.task_status?[s("a",{staticClass:"row-actions",on:{click:function(e){return t.goDetail(a,i)}}},[t._v("查看")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.showDetailLog(a)}}},[t._v("日志")])]:s("span",[t._v("-")])]}}],null,!1,4098372831)}),s("div",{staticClass:"space-between mtm mbm"},[s("div",[t.isSelect?[s("Icon",{attrs:{type:"ios-alert",color:"#2D8CF0"}}),s("Poptip",{attrs:{trigger:"hover",placement:"left-end",transfer:""}},[s("div",{attrs:{slot:"content"},slot:"content"},[s("p",[t._v("清空标注：仅 已标注&&不在有效批次 的数据支持")]),s("p",[t._v("打回返修：仅 待交付/验收驳回的批次&&不在有效抽检任务 的数据支持")])]),s("span",{staticClass:"mls"},[t._v("注：目前仅支持部分场景下的状态流转。")])])]:t._e()],2),s("Page",{attrs:{current:t.detail_page.index,total:t.detail_page.total,"page-size":t.detail_page.size,"show-total":"","show-elevator":""},on:{"on-change":function(e){return t.ChangePage(e,"details")}}})],1)],1),s("TabPane",{attrs:{label:"批次列表",name:"delivers",tab:"0"}},["delivers"===t.tab?s("Delivers",{attrs:{task:t.task,relation:t.relations[0]||{}},on:{update:t.fetchTask}}):t._e()],1),s("auth-view",{attrs:{perm:{domain:"anysis",action:"view-task-reports",extra:{company:t.user.company_id.toString(),team:t.task.team_id}}}},[s("TabPane",{attrs:{label:"效率统计",name:"taskResult",tab:"0"}},["taskResult"===t.tab?s("task-result",{attrs:{taskId:t.$route.params.task_id,tabName:"1"}}):t._e()],1)],1)],1),s("task-accept",{attrs:{visible:t.taskAcceptModal,tasks:[t.task]},on:{hideModal:function(e){t.hideModal("taskAccept","refresh"===e?t.Fetch():"")}}}),s("task-reject",{attrs:{visible:t.taskRejectModal,tasks:t.taskRejectModel||[],isBid:1===t.task.task_type},on:{hideModal:function(e){t.hideModal("taskReject","refresh"===e?t.Fetch():"")}}})],1)],1)],1):t._e()],1)},i=[],l=(s("8d0d"),s("f38f"),s("9ec3")),r=s.n(l),n=s("f78a"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.task?s("div",{staticClass:"margin"},[!t.taskType&&t.taskInfo.project_type?[s("h3",[t._v("结算信息")]),s("Row",[s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("任务是否结算")]),s("div",{staticClass:"content"},[t._v(t._s(t.relation.need_settle?"结算":"不结算"))])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("无效数据是否结算")]),t.relation.need_settle?s("div",{staticClass:"content"},[t._v(t._s(t.relation.include_invalid?"结算":"不结算"))]):s("div",{staticClass:"content"},[t._v("-")])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("最大首检占比")]),s("div",{staticClass:"content"},[t._v(t._s(t.taskInfo.max_first_check_ratio?100*t.taskInfo.max_first_check_ratio+"%":"无"))])])])],1)]:t._e(),[s("h3",[t._v("基础信息")]),s("Row",[s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("物料类型")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.materials_type||"无"))])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("总需求数量")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.overall_total||"无")+" "+t._s(t.task.unit||""))])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v(t._s(1===t.taskType?"试标截止日期":"任务截止时间"))]),s("div",{staticClass:"content"},[t._v(t._s(t.task.deadline_time||"无"))])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("合格率要求")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.passed_rate?t.task.passed_rate+"%":"无"))])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("交付周期")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.lead_time_str||"无"))])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("数据描述")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.materials_description||"无"))])])]),t.isAudit?t._e():[s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("备注")]),t.projectType?s("div",{staticClass:"content"},[t._v("企鹅智达任务编号（"),t.Config.EXTERNAL_URL?[t.taskType&&t.task.bid_code||!t.taskType&&t.task.formal_code?s("a",{on:{click:t.goToExternal}},[t._v(t._s(1===t.taskType?t.task.bid_code:t.task.formal_code))]):t._e()]:[t.taskType&&t.task.bid_code||!t.taskType&&t.task.formal_code?s("span",[t._v(t._s(1===t.taskType?t.task.bid_code:t.task.formal_code))]):t._e()],s("span",[t._v("）")])],2):s("div",{staticClass:"content"},[t._v("无")])])]),s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("规则文档")]),s("attachment",{attrs:{options:["download"],task:t.relation,from:"workbench",objId:t.ruleAttachment.objId,objType:t.ruleAttachment.objType,objScene:t.ruleAttachment.objScene}})],1)])]],2)],t.isDynamic||t.isCross?[s("h3",[t._v("流程配置")]),s("Row",[s("Col",{attrs:{span:12}},[t.isDynamic?s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("动态任务")]),s("div",{staticClass:"content"},[t._v("是")])]):t._e()]),s("Col",{attrs:{span:12}},[t.isCross?s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("交叉标注")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.cross_num)+" 个人同时标注一道题")])]):t._e()])],1)]:t._e(),t.isPack||t.isCross||t.isLabelTimeout||t.relation.labeler_condition&&"{}"!==t.relation.labeler_condition?[s("h3",[t._v("做题配置")]),s("Row",[t.isPack?s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("题包")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.pack_num)+" 个")])])]):t._e(),t.isCross?s("Col",{attrs:{span:12}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("交叉标注")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.cross_num)+" 个人同时标注一道题")])])]):t._e(),t.isLabelTimeout?s("Col",{attrs:{span:"12"}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("超时释放")]),s("div",{staticClass:"content"},[t._v(t._s(t.task.label_timeout)+" 秒")])])]):t._e(),t.relation.labeler_condition&&"{}"!==t.relation.labeler_condition?s("Col",{attrs:{span:"12"}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("标注员要求")]),s("div",{staticClass:"content"},[t._l(JSON.parse(t.relation.labeler_condition),(function(e,a){return[e?s("div",[s("Tag",[t._v(t._s(t.teamConditionOptions[a])+"："+t._s(e))])],1):t._e()]}))],2)])]):t._e(),t.relation.reviewer_condition&&"{}"!==t.relation.reviewer_condition?s("Col",{attrs:{span:"12"}},[s("div",{staticClass:"item"},[s("div",{staticClass:"label"},[t._v("质检员要求")]),s("div",{staticClass:"content"},[t._l(JSON.parse(t.relation.reviewer_condition),(function(e,a){return[e?s("div",[s("Tag",[t._v(t._s(t.teamConditionOptions[a])+"："+t._s(e))])],1):t._e()]}))],2)])]):t._e()],1)]:t._e()],2):t._e()},c=[],d=s("db49"),u=s("ad4a"),h={components:{attachment:u["a"]},props:{projectType:Boolean,taskType:Number,taskInfo:Object,task:{type:Object,default(){return{}}}},data(){return console.log(this.task),{Config:d["a"],teamConditionOptions:{sex:"性别",age:"年龄",education:"学历",profession:"专业分类",native:"籍贯",residence:"常驻地",social_work_age:"社会工龄",label_work_age:"标注工龄",label_experience:"标注项目经验",english_level:"英语水平"}}},computed:{isDynamic(){var t;return 1===(null===(t=this.task)||void 0===t?void 0:t.is_dynamic)},isCross(){var t;return(null===(t=this.task)||void 0===t?void 0:t.cross_num)>1},isPack(){var t;return(null===(t=this.task)||void 0===t?void 0:t.pack_num)>0},isLabelNums(){var t;return(null===(t=this.task)||void 0===t?void 0:t.label_nums)>1},isLabelTimeout(){var t;return(null===(t=this.task)||void 0===t?void 0:t.label_timeout)>0},isAudit(){return this.$route.path.includes("audit")},relation(){const{taskType:t,task:e}=this;return(t?e.bid_task_relation_vos[0]:e.formal_task_relation_vos[0])||[]},ruleAttachment(){const{relation:t,taskType:e}=this,s={objId:"",objType:"",objScene:"rule"};var a,i;t&&(s.objId=e?null===(a=t.bid_id)||void 0===a?void 0:a.toString():null===(i=t.formal_id)||void 0===i?void 0:i.toString(),s.objType=e?"bid-task":"formal-task");return s}},methods:{goToExternal(){var t,e;const{bid_code:s,formal_code:a}=this.task;if(null===(t=this.Config)||void 0===t||null===(e=t.EXTERNAL_URL)||void 0===e||!e.zhida)return this.$Message.error("暂时不支持跳转到其他系统"),0;if(!(this.taskType&&s||!this.taskType&&a))return this.$Message.error("企鹅智达任务编号缺失"),0;const i=1===this.taskType?s:a,l=1===this.taskType?"bidtask":"formaltask",r=`${this.Config.EXTERNAL_URL.zhida}/${l}/${i}?origin=qlabel`;window.open(r,"_blank")}}},_=h,m=(s("b21b"),s("2be6")),v=Object(m["a"])(_,o,c,!1,null,"9c7f1c2e",null),p=v.exports,k=s("8859"),f=s("5a3e"),b=s("5ea9"),g=s("ccb4"),y=s("864c"),w=s("bc94"),C=s("3a9c"),S=s("a638"),T=s("51cc"),I=s("048d"),$=s("259f"),x=s("312d"),D=s("e3fa"),L=s("175d"),R=s("ed08"),P=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-result"},[s("tableFilter",{attrs:{searchLoading:t.loading,btnDirection:"horizontal"},on:{search:function(e){return t.fetchReportDatas({reset:!1})},reset:function(e){return t.fetchReportDatas({reset:!0})}}},[s("Form",{attrs:{"label-width":90,"label-colon":!0}},[s("Row",{attrs:{gutter:16}},[s("Col",{attrs:{span:"6"}},[s("FormItem",{attrs:{label:"成员编号"}},[s("Input",{attrs:{type:"text",placeholder:"输入成员编号"},model:{value:t.searchParams.user_id,callback:function(e){t.$set(t.searchParams,"user_id",e)},expression:"searchParams.user_id"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{attrs:{label:"成员名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入成员名称"},model:{value:t.searchParams.nick_name,callback:function(e){t.$set(t.searchParams,"nick_name",e)},expression:"searchParams.nick_name"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{attrs:{label:"统计区间"}},[s("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"datetimerange",options:t.dataPickerOptions,placeholder:"选择统计区间"},model:{value:t.searchParams.queryDate,callback:function(e){t.$set(t.searchParams,"queryDate",e)},expression:"searchParams.queryDate"}})],1)],1)],1)],1)],1),s("tableArea",{attrs:{tableLists:t.tableLists,tabName:t.tabName},on:{"export-report-datas":t.exportReportDatas}})],1)},j=[],O=s("b0cd"),F=s("c206"),E=s.n(F),A=s("c605"),M={components:{tableFilter:A["a"]},mixins:[O["a"]],props:["taskId","tabName"],data(){const t={task_id:this.taskId,user_id:"",nick_name:"",queryDate:[]};return{searchParams:{...t},queryParams:{...t},dataPickerOptions:{disabledDate(t){return t&&t.valueOf()>Date.now()}},tableLists:[{label:"标注",component:"taskLabelTable"},{label:"质检",component:"taskReviewTable"}]}},mounted(){this.isAudit&&(this.tableLists=[{label:"质检",component:"taskReviewTable"}])},methods:{toHump(t){return Object(l["isString"])(t)?t.replace(/_(\w)/g,(t,e)=>e.toUpperCase()):"error"},resetSearchParams(){this.searchParams={task_id:this.taskId,user_id:"",nick_name:"",queryDate:[]}},exportReportDatas(t){const{queryDate:e,nick_name:s,...a}=this.searchParams,i={};Object(l["forIn"])({...a,...t||{}},(t,e)=>{t&&(i[this.toHump(e)]=t)}),2===t.statType&&(i.cycleStep=this.isAudit?2:0),e&&e[0]&&e[1]&&(i.beginDate=E()(e[0]).format("YYYY-MM-DD HH:mm:ss"),i.endDate=E()(e[1]).format("YYYY-MM-DD HH:mm:ss")),s&&(i.nickName=s),Object(L["w"])({method:"task-report",data:{...i},etr:"/report"})}}},N=M,B=Object(m["a"])(N,P,j,!1,null,null,null),z=B.exports,V=s("9ce4"),q=s("f294"),U=s("b92b"),W=s("d1d5"),J=s("1ff2"),H={components:{Deny:n["default"],Info:p,DetailLog:f["a"],DetailUpdate:b["a"],TaskAccept:g["a"],taskStatusRender:C["a"],batchStatusRender:S["a"],taskResult:z,deliverStatusRender:I["a"],deliverCheckStatusRender:$["a"],labelStatusRender:T["a"],Delivers:q["a"],DeliverSubmit:U["a"],TaskReject:W["a"],error:J["a"],tableFilter:A["a"]},mixins:[k["a"]],modals:["detailLog","taskAccept","taskReject"],data(){return{userinfo:this.$store.state.userinfo.user,tab:this.$route.query.tab?this.$route.query.tab:"details",detail_form:{detail_id_list:"",detail_status:"",check_status:"",is_deliver:"",is_audit:"",nick_name_list:"",dataset_item_id_list:"",detail_valid:"",last_labeler_list:"",pack_keys:""},deliverTasks:[],columnsOptions:{detail_id:"任务明细ID",dataset_item_id:"题目ID",pack_key:"题包Key",detail_is_valid:"是否有效",detail_status:"标注状态",check_status:"质检结果",deliver_status:"交付状态",assignee_nick_name:"当前处理人",labeler_nick_name:"最后标注人",detail_action:"操作"},detail_page:{index:1,size:10,total:0},detailStatus:x["i"],labelStatus:x["m"],deliverCheckStatus:x["f"],deliverStatus:x["g"],auditStatus:x["a"],isSelect:!1,isSelectAll:!1,selection:[],relations:[],deliverPage:{index:1,size:10,total:1}}},computed:{...Object(V["c"])({user:"user"}),userInfo(){return this.$store.state.userinfo},companyInfo(){return this.$store.state.companyinfo},columns(){return r.a.map(this.columnsOptions,(t,e)=>{let s={title:t,slot:e,minWidth:100};return e.includes("_id")&&this.$set(s,"minWidth",150),e.includes("_key")&&this.$set(s,"minWidth",150),e.includes("_name")&&this.$set(s,"minWidth",120),e.includes("_action")&&this.$set(s,"minWidth",130),e.includes("selection")&&(s={type:"selection",align:"center",width:60}),s})},btn_disabled(){return this.selection.length<=0},RouteToTasks(){const{path:t}=this.$route;return t.substring(0,t.lastIndexOf("/"))},isAudit(){return this.RouteToTasks.includes("audit")}},watch:{isSelect(){this.isSelect?this.columnsOptions={selection:"",...this.columnsOptions}:(this.selection.length>0&&(this.selection=[],this.$refs.details.selectAll(!1)),this.$delete(this.columnsOptions,"selection"))}},created(){},mounted(){this.Fetch(),this.isAudit&&(this.columnsOptions={detail_id:"任务明细ID",dataset_item_id:"题目ID",pack_key:"题包Key",detail_is_valid:"是否有效",deliver_status:"交付状态",check_status:"质检结果",audit_status:"审核状态",assignee_nick_name:"当前处理人",labeler_nick_name:"最后标注人",detail_action:"操作"})},methods:{goDetail(t,e){const s={};r.a.forIn(this.detail_form,(t,e)=>{(t||0===t)&&(s[e]=t)});const a=this.$router.resolve({name:"wb-task-review-detail",params:{task_id:this.task.task_id,check_id:t.check_id||0,pack_id:t.pack_key||0,dataset_id:0},query:{type:this.isAudit?"page_audit":"page",team_id:this.task.team_id,page_index:e+1+(this.detail_page.index-1)*this.detail_page.size,row_id:t.detail_id,...s}});window.open(a.href,"_blank")},showDetailLog(t){const{task:e,userInfo:s}=this;this.$FastModal.show(f["a"],{task:e,detail:t,userInfo:s},{})},SelectDetails(t){this.selection=t},SelectAllDetails(t){this.isSelectAll=t,t&&this.$Message.info("已全选题目")},ResetDetails(){r.a.forIn(this.detail_form,(t,e)=>{this.$set(this.detail_form,e,"")}),this.fetchDetails()},UpdateDetailStatus(t){const e=this,{task:s,selection:a,detail_form:i,isSelectAll:l}=this;this.$FastModal.show(b["a"],{task:s,status:t,selection:a,form:i,isAll:l},{refresh(){e.Fetch()}})},ChangePage(t,e){switch(e){case"details":this.detail_page.index=t,this.fetchDetails();break}},ChangeTab(t){"details"===t&&this.fetchDetails(),this.$route.query.tab!==t&&(this.tab=t,this.$router.replace({query:{tab:t}}))},deliverSubmit(){const t=this;this.$FastModal.show(U["a"],{task:t.task,relation:t.relations[0]||{},isAudit:t.isAudit},{refresh(){t.Fetch()}})},exportDetailList(){const{name:t}=this.$route;let e;e=1;const s={task_id:this.$route.params.task_id,need_deliver_info:!0,need_check_info:1,cycle_step:0,...Object(R["b"])(this.detail_form),type:e};Object(L["o"])(s)}},asyncMethods:{Fetch(){return this.isSelect=!1,Promise.all([this.fetchTask(),this.fetchDetails()])},fetchUsers(){var t,e;if(null===(t=this.task)||void 0===t||!t.team_id)return[];const s={page:{start:0,size:1e3,return_total:1},object_type:"team",object_id:null===(e=this.task)||void 0===e?void 0:e.team_id,user_type:"user"};return Object(D["q"])(s).then(t=>t.data).catch(t=>{this.$Message.error(t.message)})},fetchTask(){this.task={};const t={task_id:this.$route.params.task_id};return y["a"].GetTask(t).then(t=>{const e=t.data.result;return 1===e.task_type?this.fetchBidTask(e.project_id):this.fetchFormalTask(e.project_id),e}).catch(t=>{throw new Error("获取数据失败："+t.message)})},fetchBidTask(t){const e={project_id:t,task_id:this.$route.params.task_id,page:{start:0,size:1,return_total:0},need_stat_task:!0,need_relation:!0,need_stat_deliver:!0};return y["a"].ListBidTasks(e).then(t=>{var e,s,a,i;const l=r.a.cloneDeep(null===t||void 0===t||null===(e=t.data)||void 0===e||null===(s=e.result)||void 0===s||null===(a=s.data)||void 0===a?void 0:a[0]);var n;(null===(i=l.bid_task_relation_vos)||void 0===i?void 0:i.length)>0&&l.bid_task_relation_vos[0]&&(l.task_id=l.bid_task_relation_vos[0].task_id,l.model_type=l.bid_task_relation_vos[0].model_type,l.model_unit=l.bid_task_relation_vos[0].model_unit,l.model_unit_price=l.bid_task_relation_vos[0].model_unit_price,l.work_time=l.bid_task_relation_vos[0].work_time,l.work_period=l.bid_task_relation_vos[0].work_period,l.commit_remark=l.bid_task_relation_vos[0].commit_remark,l.status_id=l.bid_task_relation_vos[0].status_id,this.task.audit_team_name=null===(n=l.bid_task_relation_vos[0])||void 0===n?void 0:n.audit_team_name);return void 0!==l.model_unit_price&&("工时"===l.model_type&&void 0!==l.work_time&&(l.total_price=(l.work_time*l.model_unit_price).toFixed(3)),"任务"===l.model_type&&void 0!==l.overall_total&&(l.total_price=(l.overall_total*l.model_unit_price).toFixed(3))),this.relations=[l],this.fetchStatTaskProgress(l.task_id),l})},fetchFormalTask(t){const e={project_id:t,task_id:this.$route.params.task_id,page:{start:0,size:1,return_total:0},need_stat_task:!0,need_relation:!0,need_stat_deliver:!0};return y["a"].ListFormalTasks(e).then(t=>{var e,s,a,i,l;const r=null===(e=t.data)||void 0===e||null===(s=e.result)||void 0===s||null===(a=s.data)||void 0===a?void 0:a[0];return this.task.materials_type=r.materials_type,this.task.deadline_time=r.deadline_time,this.task.passed_rate=r.passed_rate,this.task.materials_description=r.materials_description,this.task.is_dynamic=r.is_dynamic,this.task.task_id=(null===(i=r.formal_task_relation_vos[0])||void 0===i?void 0:i.task_id)||0,this.task.audit_team_name=null===(l=r.formal_task_relation_vos[0])||void 0===l?void 0:l.audit_team_name,this.relations=[r],this.fetchStatTaskProgress(this.task.task_id),r})},fetchStatTaskProgress(t){const e={task_id:t,stat_object:["total_num","labeled_num","reviewed_num","deliver_num","audit_num"]};return Object(w["s"])(e).then(t=>{Object.assign(this.task,{audit_num:t.audit_num,deliver_num:t.deliver_num,labeled_num:t.labeled_num,reviewed_num:t.reviewed_num,total_num:t.total_num})}).catch(t=>{console.log(t)})},fetchDetails(){const t=this.detail_page,e={task_id:this.$route.params.task_id,page:{start:(t.index-1)*t.size,size:t.size,return_total:1},need_deliver_info:!0,need_check_info:1,cycle_step:0};return r.a.forIn(this.detail_form,(t,s)=>{(t||0===t)&&("is_deliver"===s?e.deliver_status_list=0===t?[10]:[20,30,60]:"is_audit"===s?e.deliver_status_list=0===t?[10,20]:[30,60]:(e[s]=-1!==s.indexOf("list")?[t]:t,"pack_keys"===s&&(e[s]=[t])))}),this.isAudit?y["a"].ListAuditDetail(e).then(e=>{const s=e.data.result;return t.total=s.total,r.a.map(s.data,t=>{(t.detail_status<30||t.deliver_status&&![10,70].includes(t.deliver_status)||t.check_id)&&this.$set(t,"_disabled",!0)}),s.data}).catch(t=>{throw console.log(t),new Error("获取数据失败："+t.message)}):y["a"].GetTaskDetailList(e).then(e=>{const s=e.data.result;return t.total=s.total,r.a.map(s.data,t=>{(t.detail_status<30||t.deliver_status&&![10,70].includes(t.deliver_status)||t.check_id)&&this.$set(t,"_disabled",!0)}),s.data}).catch(t=>{throw console.log(t),new Error("获取数据失败："+t.message)})},fetchAcceptTask(){const t={task_id:this.$route.params.task_id};return y["a"].AcceptTask(t).then(t=>{t.data.result&&(this.$Message.success("已接受任务！"),location.reload())}).catch(t=>{console.log(t),this.$Message.error(t.message)})},fetchUpdateDetailStatus(t,e){const s={task_id:this.task.task_id,detail_status:t};if("all"===e)r.a.forIn(this.detail_form,(t,e)=>{(t||0===t)&&(s[e]=-1!==e.indexOf("list")?[t]:t,"pack_keys"===e&&(s[e]=[t]))});else{const t=r.a.map(this.selection,t=>t.detail_id);s.detail_ids=t}return y["a"].UpdateDetailStatus(s).then(t=>{var e;const s=t.data.result;null===(e=this.$Modal)||void 0===e||e.remove(),this.Fetch(),setTimeout(()=>{this.$Modal.success({title:"批量操作题目结果",content:`\n                <p>成功处理了 ${s} 条题目。</p>\n              `})},500)}).catch(t=>{var e;console.log(t),null===(e=this.$Modal)||void 0===e||e.remove(),this.$Message.error(t.message)})}}},K=H,G=(s("05fa"),Object(m["a"])(K,a,i,!1,null,"4e8d48fe",null));e["default"]=G.exports},d3eb:function(t,e,s){},d4e2:function(t,e,s){},d946:function(t,e,s){},e26c:function(t,e,s){"use strict";s("9d1c")},e497:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TableFilter",{attrs:{searchLoading:t.fetchBidTasks.isPending,btnDirection:"horizontal"},on:{search:function(e){return t.changePage(1)},reset:function(e){return t.Reset(t.pageIndex=1)}}},[s("Form",{attrs:{inline:"","label-width":90,"label-colon":!0}},[s("Row",[s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务(TB)单号","label-width":100}},[s("Input",{attrs:{type:"text",placeholder:"输入任务(TB)单号"},model:{value:t.tasks_form.bid_code,callback:function(e){t.$set(t.tasks_form,"bid_code",e)},expression:"tasks_form.bid_code"}})],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务编号"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务编号"},model:{value:t.tasks_form.task_id,callback:function(e){t.$set(t.tasks_form,"task_id",e)},expression:"tasks_form.task_id"}})],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务名称关键字"},model:{value:t.tasks_form.task_name,callback:function(e){t.$set(t.tasks_form,"task_name",e)},expression:"tasks_form.task_name"}})],1)],1),s("Col",{attrs:{span:"4"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务状态"}},[s("Select",{attrs:{transfer:"",clearable:"",disabled:t.isSelect},model:{value:t.tasks_form.task_status,callback:function(e){t.$set(t.tasks_form,"task_status",e)},expression:"tasks_form.task_status"}},t._l(t.taskStatus,(function(e,a){return 0!==e.value?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1)],1),s("Col",{attrs:{span:"4"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"物料类型"}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:t.tasks_form.materials_type,callback:function(e){t.$set(t.tasks_form,"materials_type",e)},expression:"tasks_form.materials_type"}},t._l(t.Materials,(function(e){return s("Option",{key:e,attrs:{value:e}},[t._v(t._s(e))])})),1)],1)],1)],1)],1)],1),t.fetchUnconfirmBidTaskCount.isResolved?[s("Batch",{attrs:{unConfirmTotal:t.unConfirmTotal,selectLength:t.selection.length},on:{updateStatus:t.updateStatus,batchTask:t.batchTask}})]:t._e(),s("Table",{ref:"table",attrs:{loading:t.fetchBidTasks.isPending,columns:t.columns,data:t.bidTasks},on:{"on-selection-change":t.selectDetails,"on-select-all":function(e){return t.selectAllDetails(!0)},"on-select-all-cancel":function(e){return t.selectAllDetails(!1)}},scopedSlots:t._u([{key:"bid_code",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.bid_code||"-"))])]}},{key:"task_id",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.task_id))]),a.deadline_time?s("p",[s("small",{staticClass:"txt-muted"},[t._v("截止:"+t._s(a.deadline_time))])]):t._e()]}},{key:"task_name",fn:function(e){var a=e.row;return[s("span",{staticClass:"mrs ellipsis pointer",attrs:{title:a.task_name},on:{click:function(e){return t.showModal("editTasks",a)}}},[t._v(t._s(a.task_name))]),a.cross_num>=2?s("span",{staticClass:"txt-muted"},[t._v("("+t._s(a.cross_num)+"人交叉)")]):t._e()]}},{key:"team_name",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.team_name||"-"))])]}},{key:"total_num",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(t.$FormatNumber(a.total_num)||"-"))])]}},{key:"task_progress",fn:function(e){var a=e.row;return[void 0===a.total_num||void 0===a.labeled_num||a.is_dynamic||50===a.task_status?[s("span",[t._v("-")])]:s("div",{staticClass:"progress_box"},[void 0!==a.labeled_num?s("div",{staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v("已标注")]),a.total_num||a.labeled_num?s("Progress",{staticClass:"progress_p",attrs:{percent:Math.round(a.labeled_num/a.total_num*1e4)/100,"stroke-width":8,"hide-info":""}}):s("Progress",{staticClass:"progress_p",attrs:{percent:0,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(a.labeled_num||0)+" / "+t._s(a.total_num||0))]),0!==a.total_num?s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(Math.round(a.labeled_num/a.total_num*1e4)/100)+"%)")]):t._e()],1):t._e(),void 0!==a.reviewed_num?s("div",{staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v("已质检")]),a.total_num||a.reviewed_num?s("Progress",{staticClass:"progress_p",attrs:{percent:Math.round(a.reviewed_num/a.total_num*1e4)/100,"stroke-width":8,"hide-info":""}}):s("Progress",{staticClass:"progress_p",attrs:{percent:0,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(a.reviewed_num||0)+" / "+t._s(a.total_num||0))]),0!==a.total_num?s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(Math.round(a.reviewed_num/a.total_num*1e4)/100)+"%)")]):t._e()],1):t._e(),void 0!==a.deliver_num?s("div",{staticClass:"progress_cont"},[s("span",{staticClass:"font mrs"},[t._v("已交付")]),a.total_num||a.deliver_num?s("Progress",{staticClass:"progress_p",attrs:{percent:Math.round(a.deliver_num/a.total_num*1e4)/100,"stroke-width":8,"hide-info":""}}):s("Progress",{staticClass:"progress_p",attrs:{percent:0,"stroke-width":8,"hide-info":""}}),s("span",{staticClass:"mlm"},[t._v(t._s(a.deliver_num||0)+" / "+t._s(a.total_num||0))]),0!==a.total_num?s("span",{staticClass:"mls txt-muted"},[t._v("("+t._s(Math.round(a.deliver_num/a.total_num*1e4)/100)+"%)")]):t._e()],1):t._e()])]}},{key:"task_status",fn:function(t){var e=t.row;return[s("task-status-render",{attrs:{value:e.task_status}})]}},{key:"creator",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.creator||"-"))])]}},{key:"materials_type",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.materials_type||"-"))])]}},{key:"action",fn:function(e){var a=e.row;return[a.accessible?s("div",[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.getTaskDetailList(a)}}},[t._v("详情")]),10===a.task_status?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userinfo.company_id}}"}]},[s("Divider",{attrs:{type:"vertical"}}),s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.showModal("taskAccept",[a])}}},[t._v("接受任务")]),s("Divider",{attrs:{type:"vertical"}}),s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.showModal("taskReject",[a])}}},[t._v("放弃任务")])],1)]:t._e(),1===a.task_type?[s("span",{directives:[{name:"permissions",rawName:"v-permissions",value:{domain:"task",action:"accept",extra:{company:t.userinfo.company_id}},expression:"{domain: 'task', action: 'accept', extra: {company: userinfo.company_id}}"}]},[2===a.bid_status?[s("Divider",{attrs:{type:"vertical"}}),s("a",{on:{click:function(e){return t.fetchAcceptWinBidTask(a)}}},[t._v("确认中标")])]:t._e(),5===a.bid_status?[s("Divider",{attrs:{type:"vertical"}}),s("a",{attrs:{disabled:""}},[t._v("已确认中标")])]:t._e()],2)]:t._e()],2):s("a",{attrs:{disabled:""}},[t._v("安全策略不可操作")])]}}])}),s("br"),s("Page",{staticClass:"right",attrs:{current:t.pageIndex,total:t.pageTotal,"page-size":t.pageSize,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}}),s("task-accept",{attrs:{visible:t.taskAcceptModal,tasks:t.taskAcceptModel,isBatch:t.selection.length>0},on:{hideModal:function(e){t.hideModal("taskAccept","refresh"===e?t.Fetch(t.tasks_form.task_status=""):"")}}}),s("task-reject",{attrs:{visible:t.taskRejectModal,tasks:t.taskRejectModel||[],isBid:!0},on:{hideModal:function(e){t.hideModal("taskReject","refresh"===e?t.Fetch(t.tasks_form.task_status=""):"")}}})],2)},i=[],l=s("9ec3"),r=s.n(l),n=s("8859"),o=s("ccb4"),c=s("d1d5"),d=s("864c"),u=s("bc94"),h=s("3a9c"),_=s("312d"),m=s("2289"),v=s("cd7e"),p=s("c605"),k={components:{TaskAccept:o["a"],TaskReject:c["a"],taskStatusRender:h["a"],Batch:v["a"],TableFilter:p["a"]},mixins:[n["a"]],modals:["taskAccept","taskReject"],data(){return{isSelect:!1,Materials:m["e"],pageIndex:1,pageSize:10,pageTotal:0,unConfirmTotal:0,bidTaskTotal:0,taskTotal:0,tasks_form:{bid_code:"",task_id:"",task_name:"",task_status:"",materials_type:""},taskStatus:_["r"],columns:[{title:"任务(TB)单号",slot:"bid_code",width:200},{title:"任务编号",slot:"task_id",width:180},{title:"任务名称",slot:"task_name",minWidth:150},{title:"对接人",slot:"creator",align:"center",minWidth:100},{title:"物料类型",slot:"materials_type",align:"center",minWidth:100},{title:"题目数",slot:"total_num",align:"right",minWidth:80},{title:"完成进度",slot:"task_progress",align:"left",minWidth:260},{title:"任务状态",slot:"task_status",align:"center",minWidth:110},{title:"标注小组",slot:"team_name",minWidth:100},{title:"操作",slot:"action",minWidth:220}],selection:[],bidTasks:[],user:[]}},computed:{userinfo(){return this.$store.state.userinfo.user}},watch:{isSelect(){this.isSelect?this.columns.unshift({type:"selection",align:"center",width:60}):(this.selection.length>0&&(this.selection=[],this.$refs.table.selectAll(!1)),this.columns.shift())}},mounted(){this.Fetch()},methods:{Fetch(){this.isSelect=!1,this.fetchBidTasks(),this.fetchUnconfirmBidTaskCount()},Reset(){r.a.forIn(this.tasks_form,(t,e)=>{this.tasks_form[e]=this.isSelect&&"task_status"===e?t:""}),this.fetchBidTasks()},changePage(t){this.pageIndex=t,this.fetchBidTasks()},selectDetails(t){this.selection=t},selectAllDetails(t){t&&this.$Message.info("已选当前页所有题目")},batchTask(t){this.showModal(t,this.selection)},updateStatus(t){t?(this.tasks_form.task_status=10,this.fetchBidTasks()):(this.tasks_form.task_status="",this.fetchBidTasks()),this.isSelect=t},getTaskDetailList(t){this.$router.push("/workbench/bid-tasks/"+t.task_id)},async mapStatTaskProgress(t){for(let e=0;e<t.length;e++){const s=await this.fetchStatTaskProgress(t[e].task_id);if(s){const a={...t[e],deliver_num:s.deliver_num,labeled_num:s.labeled_num,reviewed_num:s.reviewed_num,total_num:s.total_num};this.$set(this.bidTasks,e,a)}}}},asyncMethods:{fetchBidTasks(){const t={page:{start:(this.pageIndex-1)*this.pageSize,size:this.pageSize,return_total:1},task_type:1,need_stat_task:!0,need_stat_deliver:!0};return r.a.forIn(this.tasks_form,(e,s)=>{""!==this.tasks_form[s]&&(t[s]=this.tasks_form[s])}),t.task_status&&(t.task_status=Number(t.task_status)),d["a"].ListBidManagerTasks(t).then(t=>{const{data:e}=t.data.result;return this.pageTotal=t.data.result.total,this.bidTaskTotal<this.pageTotal&&(this.bidTaskTotal=this.pageTotal),e.forEach(t=>{10!==t.task_status&&this.$set(t,"_disabled",!0),!t.accessible&&this.$set(t,"_disabled",!0)}),this.mapStatTaskProgress(e),e}).catch(t=>{console.log(t)})},fetchStatTaskProgress(t){const e={task_id:t,stat_object:["total_num","labeled_num","reviewed_num","deliver_num"]};return Object(u["s"])(e).then(t=>t).catch(t=>{console.log(t)})},fetchUnconfirmBidTaskCount(){const t={page:{start:0,size:0,return_total:1},task_type:1,task_status:10};return d["a"].ListBidManagerTasks(t).then(t=>{this.unConfirmTotal=t.data.result.total})},fetchAcceptWinBidTask(t){const e={task_id:t.task_id};return d["a"].AcceptWinBidTask(e).then(t=>{t.data.result?this.$Message.success("已确认中标，请等待正式交付"):this.$Message.error("确认失败："+t.data.result),this.Fetch()})}}},f=k,b=(s("36d2"),s("2be6")),g=Object(b["a"])(f,a,i,!1,null,"0b66fa09",null);e["default"]=g.exports},e777:function(t,e,s){"use strict";s("d3eb")},ec7e:function(t,e,s){"use strict";s("fc3d")},ecd58:function(t,e,s){},f003:function(t,e,s){},f087:function(t,e,s){"use strict";s("38e7")},f08e:function(t,e,s){},f31a:function(t,e,s){},f3bc:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.fetchTask.isRejected?s("error",{attrs:{message:t.fetchTask.rejectedWith.message}}):t._e(),t.fetchTask.isResolved?[s("Row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[t.$route.query.type?[s("Breadcrumb",[s("BreadcrumbItem",[t._v("我的任务")]),s("BreadcrumbItem",{attrs:{to:"/workbench/review-tasks"}},[t._v("质检任务")]),s("BreadcrumbItem",{attrs:{to:"/workbench/review-tasks/"+t.task.task_id}},[t._v("任务详情")]),s("BreadcrumbItem",[t._v("抽检 - "+t._s(t.task.task_name||"-"))])],1),s("Tooltip",{attrs:{content:"关闭页面"}},[s("Button",{staticClass:"mls",attrs:{type:"dashed",icon:"md-close",shape:"circle",to:"/workbench/review-tasks/"+t.task.task_id}})],1)]:[s("Breadcrumb",[s("BreadcrumbItem",[t._v("我的任务")]),s("BreadcrumbItem",{attrs:{to:"/workbench/review-tasks"}},[t._v("质检任务")]),s("BreadcrumbItem",[t._v("抽检 - "+t._s(t.task.task_name||"-"))])],1),s("Tooltip",{attrs:{content:"关闭页面"}},[s("Button",{staticClass:"mls",attrs:{type:"dashed",icon:"md-close",shape:"circle",to:"/workbench/review-tasks"}})],1)]],2),s("t-divider",{attrs:{align:"left"}},[s("h3",[t._v("批次抽检")])]),s("div",{staticClass:"margin"},[t.fetchStatCheckTaskNum.isResolved&&t.statCheckTaskNum?s("Card",{staticClass:"mbm"},[s("Row",{attrs:{justify:"space-between",align:"middle"}},[s("div",[s("h4",{staticClass:"mbm"},[t._v("批次信息")]),s("span",[t._v("批次名称："+t._s(t.deliver.deliver_name))]),s("div",{staticClass:"space"},[s("span",[t._v("批次总量/抽检总量/已抽检："+t._s(t.statCheckTaskNum.deliver_num||0)+"/"+t._s(t.statCheckTaskNum.check_num||0)+"/"+t._s(t.statCheckTaskNum.checked_num||0))]),s("span",[t._v("已抽检占比："+t._s(t.checkedPercent))]),s("span",[t._v("抽检通过率："+t._s(t.statCheckTaskNum.check_passed_str||"0.00%"))]),s("span",{staticClass:"txt-muted"},[t._v("(已剔除失效数据)")])])]),s("auth-view",{attrs:{perm:{domain:"project",action:"edit",extra:{company:t.companyInfo.company_id,project:t.task.project_id}}}},[30===t.deliver.status?s("div",[s("Button",{staticClass:"mrm",attrs:{type:"success",ghost:""},on:{click:function(e){return t.approveDeliver("pass")}}},[t._v("验收通过")]),s("Button",{staticClass:"mrm",attrs:{type:"error",ghost:""},on:{click:function(e){return t.approveDeliver("reject")}}},[t._v("验收驳回")]),s("Button",{staticClass:"primary",attrs:{type:"primary"},on:{click:function(e){return t.$router.push({path:"/projects/list/"+t.task.project_id+"/tasks/"+t.taskId+"?tab=delivers&deliver_id="+t.deliverId+"&type=check"})}}},[t._v("批次详情")])],1):t._e()])],1)],1):t._e(),s("Row",{staticClass:"mbm",attrs:{justify:"space-between",align:"middle"}},[s("Col",[s("auth-view",{attrs:{perm:{domain:"task",action:"queue-review",extra:{team:t.$route.query.team_id}}}},[20!==t.task.task_status||t.isFinishCheck?s("t-tooltip",{attrs:{content:"已创建最后一次抽检，关闭后才可新建"}},[s("Button",{attrs:{type:"primary",icon:"md-add",disabled:!0}},[t._v("新建")])],1):[s("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:function(e){return t.createTask("新建抽检任务",{})}}},[t._v("新建")])],t.isOnCheckDisabled?[s("ButtonGroup",{staticClass:"mlm"},[s("Button",{attrs:{icon:"md-remove-circle",disabled:!t.checkDisabledRows.length},on:{click:function(e){return t.onCheckDisabled()}}},[t._v("确定失效")]),s("Button",{on:{click:function(e){t.isOnCheckDisabled=!1}}},[t._v("取消")])],1),s("span",{staticClass:"txt-muted mlm"},[t.checkDisabledRows.length>0?s("span",[t._v("已选择"+t._s(t.checkDisabledRows.length)+"个抽检任务")]):s("span",[t._v("勾选需要使其失效的抽检任务，然后点击确定")])])]:[s("Button",{staticClass:"mlm",on:{click:function(e){t.isOnCheckDisabled=!0}}},[t._v("失效")])]],2)],1)],1),s("Table",{key:t.fetchCheckTasks.isResolved,ref:"checkTable",attrs:{columns:t.columns,data:t.checkTasks,loading:t.fetchCheckTasks.isPending},on:{"on-selection-change":function(e){t.checkDisabledRows=e}},scopedSlots:t._u([{key:"check_code",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.check_code))]),a.created_at?s("p",[s("small",{staticClass:"txt-muted"},[t._v("创建:"+t._s(a.created_at))])]):t._e()]}},{key:"check_name",fn:function(e){var a=e.row;return[s("Row",{attrs:{type:"flex",align:"middle"}},[s("span",[t._v(t._s(a.check_name))]),[1,-1].includes(a.allow_auto_add)?s("Tooltip",{attrs:{transfer:""}},[s("div",{staticStyle:{"white-space":"normal"},attrs:{slot:"content"},slot:"content"},[t._v("符合条件的批次数据将"+t._s(1===a.allow_auto_add?"继续":"不再")+"添加进当前抽检任务")]),s("Tag",{staticClass:"mlm",class:-1===a.allow_auto_add?"auto-add-disabled":"",attrs:{color:"success"}},[t._v("动态")])],1):t._e()],1)]}},{key:"check_num",fn:function(e){var a=e.row;return[s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.check_num):"-"))])]}},{key:"checked_num",fn:function(e){var a=e.row;return[s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.checked_num):"-"))])]}},{key:"check_passed_str",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.check_stats_data?a.check_stats_data.check_passed_str:"-"))])]}},{key:"check_passed_re_str",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.check_stats_data?a.check_stats_data.check_passed_re_str:"-"))])]}},{key:"check_task_status",fn:function(t){var e=t.row;return[s("check-task-status-render",{staticClass:"mls",attrs:{value:e.check_task_status}})]}},{key:"check_invalided_num",fn:function(e){var a=e.row;return[s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.check_invalided_num):"-"))])]}},{key:"check_wait_review_num",fn:function(e){var a=e.row;return[s("b",[t._v(t._s(a.check_stats_data?t.$FormatNumber(a.check_stats_data.check_wait_review_num):"-"))])]}},{key:"is_finish_check",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.is_finish_check?"是":"否"))])]}},{key:"action",fn:function(e){var a=e.row;return[20!==a.check_task_status?[s("auth-view",{attrs:{perm:{domain:"task",action:"queue-review",extra:{team:t.$route.query.team_id}}}},[t.queueReviewEnabled(a)?[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.goToQueue("wb-queue-review",{deliver_id:t.deliverId},{type:"review",check_id:a.check_id},a.cycle_step)}}},[t._v("去抽检")])]:[s("span",{staticClass:"txt-muted",staticStyle:{cursor:"not-allowed"}},[t._v("去抽检")])]],2),s("auth-view",{attrs:{perm:{domain:"task",action:"update-check-task",extra:{checktask:a.check_id,team:t.$route.query.team_id}}}},[t.fetchCheckTasks.isResolved?s("span",[s("Divider",{attrs:{type:"vertical"}}),s("Dropdown",{attrs:{transfer:""},on:{"on-click":function(e){return t.batchAction(e,a)}}},[s("a",{attrs:{href:"javascript:;"}},[t._v("更多"),s("Icon",{attrs:{type:"ios-arrow-down"}})],1),s("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[0===a.check_task_status?s("DropdownItem",{attrs:{name:"配置"}},[t._v("配置")]):t._e(),s("DropdownItem",{attrs:{name:"导出"}},[t._v("导出")]),20===t.task.task_status&&0===a.check_task_status?s("DropdownItem",{attrs:{name:"删除"}},[t._v("删除")]):t._e(),20===t.task.task_status&&a.check_stats_data&&a.check_stats_data.check_wait_review_num>0&&0===a.check_task_status?[s("DropdownItem",{attrs:{name:"批量驳回"}},[t._v("批量驳回")])]:t._e(),[1,-1].includes(a.allow_auto_add)?[s("DropdownItem",{attrs:{name:"自动添加"}},[t._v(t._s(1===a.allow_auto_add?"暂停添加":"继续添加"))])]:t._e()],2)],1)],1):t._e(),s("template",{slot:"forbidden"},[a.created_by!==t.userId&&"reviewer"===t.role&&a.check_num===a.checked_num&&0===a.wait_check_num||0!==a.check_task_status?s("span",[t._v("-")]):t._e()])],2)]:[s("auth-view",{attrs:{perm:{domain:"task",action:"update-check-task",extra:{checktask:a.check_id,team:t.$route.query.team_id}}}},[t.fetchCheckTasks.isResolved?s("span",[s("a",{attrs:{href:"javascript:;"},on:{click:function(e){return t.loadTask(a)}}},[t._v("导出")])]):s("span",[t._v("-")])])]]}}],null,!1,2558873182)}),s("Page",{staticClass:"right mtm",attrs:{current:t.page.index,total:t.page.total,"page-size":t.page.size,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}})],1),s("Modal",{model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[s("p",{attrs:{slot:"header"},slot:"header"},[s("span",[t._v("确认对剩余")]),s("span",{staticClass:"mls mrs",staticStyle:{color:"#2d8cf0"}},[t._v(t._s(t.curCheckTask.check_wait_review_num||0))]),s("span",[t._v("道待质检的题目批量驳回？")])]),t.restNum>0?s("span",[s("span",[t._v("已完成 ")]),s("span",{staticStyle:{color:"green","font-weight":"700"}},[t._v(t._s(t.curCheckTask.check_wait_review_num-t.restNum))]),s("span",[t._v("/")]),s("span",{staticStyle:{"font-weight":"700"}},[t._v(t._s(t.curCheckTask.check_wait_review_num))]),s("span",[t._v(" 条题目的驳回")])]):s("Input",{attrs:{"show-word-limit":"",type:"textarea",placeholder:"请填写不通过的原因"},model:{value:t.rejectionInfo,callback:function(e){t.rejectionInfo=e},expression:"rejectionInfo"}}),t.curCheckTask.check_reviewing_num>0?s("Alert",{staticClass:"mtm",attrs:{"show-icon":""}},[t._v("有"+t._s(t.curCheckTask.check_reviewing_num)+"条数据处于质检中，请提醒当前处理人退回再执行批量操作。")]):t._e(),s("p",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),s("Button",{attrs:{loading:t.loading,type:"primary"},on:{click:function(e){return t.fetchAllRejectReview(t.curCheckTask)}}},[t._v("确认批量驳回")])],1)],1)]:t._e()],2)},i=[],l=(s("8d0d"),s("f38f"),s("9ec3")),r=s("864c"),n=s("bc94"),o=s("e3fa"),c=s("175d"),d=s("4bd1"),u=s("1ff2"),h=s("4932"),_={components:{CheckTaskStatusRender:d["a"],error:u["a"],DeliverApprove:h["a"]},data(){const{deliver_id:t,task_id:e}=this.$route.params;return{deliver:{},taskId:e,deliverId:t,rejectionInfo:"",curCheckTask:{},visible:!1,role:"",isNone:!1,task:{},page:{index:1,size:10,total:0},columns:[{title:"抽检编号",slot:"check_code",minWidth:190},{title:"抽检名称",slot:"check_name",minWidth:100},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","抽检总量"),t("Tooltip",{props:{content:"抽检任务数据范围内的任务明细数量，包含已失效数据",transfer:!0,placement:"top",maxWidth:"300"}},[t("Icon",{props:{type:"ios-help-circle-outline"},style:{marginLeft:"3px"}})])]),slot:"check_num",align:"center",minWidth:100},{title:"已抽检",slot:"checked_num",align:"center",minWidth:80},{title:"状态",slot:"check_task_status",align:"center",minWidth:110},{title:"创建人",key:"creator",minWidth:100},{renderHeader:t=>t("Tooltip",{props:{content:"原标注结果的抽检通过率",transfer:!0,placement:"top",maxWidth:"300"}},[t("span","抽检通过率")]),slot:"check_passed_str",align:"center",minWidth:110},{renderHeader:t=>t("Tooltip",{props:{content:"原标注结果修改校正后的通过率",transfer:!0,placement:"top",maxWidth:"300"}},[t("span","校正后通过率")]),slot:"check_passed_re_str",align:"center",minWidth:120},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","已失效"),t("Tooltip",{props:{content:"抽检任务中质检结果失效的数量",transfer:!0,placement:"top",maxWidth:"300"}},[t("Icon",{props:{type:"ios-help-circle-outline"},style:{marginLeft:"3px"}})])]),slot:"check_invalided_num",align:"center",minWidth:80},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","待领取"),t("Tooltip",{props:{content:"抽检任务中可领取质检的数量",transfer:!0,placement:"top",maxWidth:"300"}},[t("Icon",{props:{type:"ios-help-circle-outline"},style:{marginLeft:"3px"}})])]),slot:"check_wait_review_num",align:"center",minWidth:80},{title:"是否最后一次抽检",slot:"is_finish_check",align:"center",minWidth:150},{title:"操作",slot:"action",minWidth:200}],checkTasks:[],isOnCheckDisabled:!1,checkDisabledRows:[],restNum:0,loading:!1,isFinishCheck:!1}},computed:{companyInfo(){return this.$store.state.companyinfo},userId(){const t=this.$store.state.userinfo.user?this.$store.state.userinfo.user.user_id:"";return t},checkedPercent(){const{statCheckTaskNum:t}=this;return t.deliver_num?(t.checked_num/t.deliver_num*100).toFixed(2)+"%":"0.00%"},queueReviewEnabled(){return function(t){const{task:e}=this;return 20===e.task_status&&t.check_stats_data&&t.check_num!==t.checked_num&&0===t.check_task_status}}},watch:{isOnCheckDisabled(t){const{columns:e}=this;t?e.unshift({type:"selection",align:"center",width:60}):["selection"].includes(e[0].type)&&(this.$refs.checkTable.selectAll(!1),e.shift())}},async created(){this.fetchTask(),this.fetchCheckTasks(),this.getUserObj(),this.fetchStatCheckTaskNum(),this.fetchDeliver()},asyncMethods:{fetchStatCheckTaskNum(){const t={task_id:this.taskId,deliver_id:this.deliverId,team_id:Number(this.$route.query.team_id)||void 0,stat_my_count:0,stat_scene:"deliver",stat_scope:"deliver"};return Object(n["q"])(t).then(t=>t).catch(t=>{this.$Message.error(t.message)})},fetchTask(){const t={task_id:this.taskId};return r["a"].GetTask(t).then(t=>t.data.result).catch(t=>{throw this.$Message.error(t.message),new Error(t.message)})},fetchCheckTasks(){const t={page:{start:(this.page.index-1)*this.page.size,size:this.page.size,return_total:1},task_id:this.taskId,deliver_id:this.deliverId,team_id:Number(this.$route.query.team_id)||void 0};return r["a"].ListCheckTasks(t).then(t=>{this.isFinishCheck=!1,this.page.total=t.data.result.total;const e=Object(l["map"])(t.data.result.data,t=>("已失效"===t.check_task_status_name&&this.$set(t,"_disabled",!0),t.is_finish_check&&"已失效"!==t.check_task_status_name&&(this.isFinishCheck=!0),t));return e}).catch(t=>{console.log(t)})},fetchDeleteCheckTask(t){const e={task_id:this.taskId,deliver_id:this.deliverId,check_id:t};return r["a"].DeleteCheckTask(e).then(t=>{t&&t.data.result&&(this.$Message.success("删除成功"),this.fetchCheckTasks(),this.fetchStatCheckTaskNum())}).catch(t=>{this.$Message.error("删除失败："+t.message)})},fetchRepealCheckTask(){const t={task_id:this.taskId,deliver_id:this.deliverId,check_ids:Object(l["map"])(this.checkDisabledRows,t=>t.check_id.toString())};return r["a"].RepealCheckTask(t).then(t=>(t&&(this.$Message.success("处理成功"),this.fetchCheckTasks(),this.fetchStatCheckTaskNum()),t)).catch(t=>(this.$Message.error("处理失败："+t.message),t))},async fetchAllRejectReview(t){const e={task_id:this.taskId,deliver_id:this.deliverId,check_id:t.check_id,remark:this.rejectionInfo,result:0};this.restNum=t.check_num-t.checked_num,this.loading=!0;try{while(this.restNum>0){const{data:{result:t,error:s}}=await r["a"].SubmitAllRejectReview(e);if(this.restNum=t,s||!t&&0!==t)return void this.$Message.error("批量驳回失败："+s.message)}this.restNum<=0&&this.$Message.success("批量驳回成功")}catch(s){console.log(s),this.$Message.error("批量驳回失败："+s.message)}finally{this.visible=!1,this.loading=!1,this.fetchCheckTasks(),this.fetchStatCheckTaskNum()}},fetchCheckCondition(t){const e={labeler:{label:"标注",value:1},reviewer:{label:"质检",value:2}},s={task_id:this.task.task_id,operate_type:e[t].value};return Object(n["a"])(s).then(()=>!0).catch(s=>(console.log(s),this.$Message.error(`您不符合当前任务的${e[t].label}员要求，不能进行${e[t].label}`),!1))},fetchCheckSwitchAutoAdd(t){const e={check_id:t.check_id};return Object(n["t"])(e).then(()=>{this.$Message.success(`已${1===t.allow_auto_add?"暂停":"继续"}执行批次数据自动添加进该抽检任务`),this.fetchCheckTasks()}).catch(t=>{this.$Message.error("配置失败："+t.message),console.log(t)})}},methods:{fetchDeliver(){const t={task_id:this.taskId,deliver_id:this.deliverId};r["a"].GetDeliverWithTaskInfo(t).then(t=>{this.deliver=t.data.result}).catch(t=>{throw new Error("获取数据失败："+t.message)})},approveDeliver(t){const{task:e}=this,s=[{...this.statCheckTaskNum,task_id:this.taskId,project_id:this.task.project_id}],a=this;this.$FastModal.show(h["a"],{task:e,approveResult:t,selection:s,isSelectAll:!1,isSelect:!1,fetchPath:1,stat:this.statCheckTaskNum},{refresh(){a.fetchStatCheckTaskNum()}})},async goToQueue(t,e,s,a){let i=!1;switch(t){case"wb-queue-review":if(1===a)i=!0;else if(i=await this.validateTeamCondition("reviewer"),!i)break;break;default:i=!0;break}if(!i)return;const l=this.$router.resolve({name:t,params:{task_id:this.task.task_id,...e||{}},query:{team_id:this.$route.query.team_id,...s||{}}});window.open(l.href,"_blank")},validateTeamCondition(t){const{[t+"_condition"]:e}=this.task;return!e||"{}"===e||this.fetchCheckCondition(t)},batchAction(t,e){switch(this.isOnCheckDisabled=!1,t){case"配置":this.createTask("编辑抽检任务",e);break;case"导出":this.loadTask(e);break;case"删除":this.deleteTask(e);break;case"批量驳回":this.visible=!0,this.curCheckTask=e.check_stats_data;break;case"批量通过":this.$Modal.confirm({title:`确认对剩余${e.check_stats_data?e.check_stats_data.check_wait_review_num:0}道待质检的题目批量通过？`,onOk:()=>{}});break;case"自动添加":this.fetchCheckSwitchAutoAdd(e);break}},loadTask(t){const e="check_id="+t.check_id;Object(c["f"])(e)},deleteTask(t){this.isNone=!0,this.$Modal.confirm({title:"确定要删除这个抽检任务吗？",content:`\n          <p>任务名称：${t.check_name}</p>\n          <p>删除任务后，任务已质检数据也将同步删除。</p>\n        `,onOk:()=>{this.fetchDeleteCheckTask(t.check_id),this.fetchStatCheckTaskNum()}})},createTask(t,e){"新建抽检任务"===t&&this.$router.push({name:"wb-create-check-task",params:{task_id:this.taskId,deliver_id:this.deliverId},query:{team_id:this.$route.query.team_id}}),"编辑抽检任务"===t&&this.$router.push({name:"wb-edit-check-task",params:{task_id:this.taskId,deliver_id:this.deliverId},query:{check_id:e.check_id,team_id:this.$route.query.team_id}})},changePage(t){this.page.index=t,this.fetchCheckTasks()},getUserObj(){const t={page:{start:0,size:1,return_total:1},object_type:"team",object_id:this.$route.query.team_id,user_type:"user",user_id:this.userId};return Object(o["q"])(t).then(t=>{t.data.length>0&&(this.role=t.data[0].role_type)}).catch(t=>{this.$Message.error(t.message)})},onCheckDisabled(){const t=this;this.$Modal.confirm({title:"操作失效",content:`\n          <p>确认对<b class="txt-blue">已选的${t.checkDisabledRows.length}个</b>抽检任务失效？</p>\n          <p>操作失效后：</p>\n          <p>1、抽检任务下全部数据的质检结果均将失效，变为“未抽检”状态。</p>\n          <p>2、仍可通过导出查看失效质检结果。</p>`,width:550,loading:!0,onOk:async()=>{const e=await t.fetchRepealCheckTask();e&&(t.$Modal.remove(),t.isOnCheckDisabled=!1)}})}}},m=_,v=(s("af56"),s("2be6")),p=Object(v["a"])(m,a,i,!1,null,"3cc9cdc7",null);e["default"]=p.exports},f5dd:function(t,e,s){"use strict";s("f08e")},f7e3:function(t,e,s){},fa79:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("queue-base",{attrs:{title:"标注","task-id":t.taskId,"fetch-object":t.fetchDetail,errorData:t.errorData},on:{"try-again":t.fetchDetail}})},i=[],l=(s("f38f"),s("dde5")),r=s("bccd"),n=s("3998"),o=s("c899"),c={components:{QueueBase:n["a"]},data(){const{task_id:t}=this.$route.params;return{taskId:Object(r["BigNumber"])(t),errorData:null}},created(){this.fetchDetail()},asyncMethods:{fetchDetail(){const t={task_id:this.taskId,apply_num:1};return Object(l["c"])("api/workbench","queueLabel",t).then(t=>{var e,s,a;if(localStorage.removeItem("pack_key_list"),t.pack_key_list.length>1)localStorage.setItem("pack_key_list",JSON.stringify(t.pack_key_list));else if(0===(null===(e=t.pack_key_list)||void 0===e?void 0:e.length))return{};this.$router.replace({name:"wb-task-label-detail",params:{task_id:this.taskId,pack_key:(null===(s=t.pack_key_list)||void 0===s?void 0:s.length)>1?0:null===(a=t.pack_key_list)||void 0===a?void 0:a[0]},query:{scenes:"label",team_id:this.$route.query.team_id,from_skip:t.from_skip||void 0}})}).catch(t=>{if(t.code===o["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");throw console.log(t),new Error(t.message)})}}},d=c,u=s("2be6"),h=Object(u["a"])(d,a,i,!1,null,null,null);e["default"]=h.exports},fb8d:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TableFilter",{attrs:{btnDirection:"horizontal"},on:{search:function(e){return t.fetchLabels(t.page.start=1)},reset:t.reset}},[s("Form",{attrs:{inline:"","label-width":90,"label-colon":!0}},[s("Row",[s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务编号"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务编号进行搜索"},model:{value:t.task_id,callback:function(e){t.task_id=e},expression:"task_id"}})],1)],1),s("Col",{attrs:{span:"6"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务名称"}},[s("Input",{attrs:{type:"text",placeholder:"输入任务名称进行搜索"},model:{value:t.task_name,callback:function(e){t.task_name=e},expression:"task_name"}})],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务状态"}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:t.task_status,callback:function(e){t.task_status=e},expression:"task_status"}},t._l(t.taskStatus,(function(e,a){return e.value>10&&e.value<50?s("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.text))]):t._e()})),1)],1)],1),s("Col",{attrs:{span:"5"}},[s("FormItem",{staticStyle:{width:"100%"},attrs:{label:"任务类型"}},[s("Select",{attrs:{transfer:"",clearable:""},model:{value:t.task_type,callback:function(e){t.task_type=e},expression:"task_type"}},[s("Option",{attrs:{value:"1"}},[t._v("试标")]),s("Option",{attrs:{value:"0"}},[t._v("正式")])],1)],1)],1)],1)],1)],1),s("Table",{attrs:{columns:t.columns,data:t.labels,loading:t.fetchLabels.isPending},on:{"on-sort-change":t.sortSearch},scopedSlots:t._u([{key:"task_id",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(a.task_id))]),a.created_at?s("p",[s("small",{staticClass:"txt-muted"},[t._v("创建:"+t._s(a.created_at))])]):t._e()]}},{key:"task_name",fn:function(e){var a=e.row;return[s("span",{staticClass:"mrs"},[t._v(t._s(a.task_name))]),a.cross_num>=2?s("span",{staticClass:"txt-muted"},[t._v("("+t._s(a.cross_num)+"人交叉)")]):t._e()]}},{key:"task_type",fn:function(e){var a=e.row;return[s("span",[t._v(t._s(1===a.task_type?"试标":"正式"))])]}},{key:"wait_label_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatTaskProgress.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.label_stats_data?t.$FormatNumber(a.label_stats_data.wait_label_num):"-"))])]}},{key:"wait_relabel_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatTaskProgress.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.label_stats_data?t.$FormatNumber(a.label_stats_data.wait_relabel_num):"-"))])]}},{key:"user_wait_relabel_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatTaskProgress.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.label_stats_data?t.$FormatNumber(a.label_stats_data.user_wait_relabel_num):"-"))])]}},{key:"user_labeling_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatTaskProgress.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.label_stats_data?t.$FormatNumber(a.label_stats_data.user_labeling_num):"-"))])]}},{key:"user_labeled_num",fn:function(e){var a=e.row,i=e.index;return[t.fetchStatTaskProgress.isPending&&i===t.statLoading?s("Icon",{attrs:{type:"ios-more"}}):s("b",[t._v(t._s(a.label_stats_data?t.$FormatNumber(a.label_stats_data.user_labeled_num):"-"))])]}},{key:"task_status",fn:function(t){var e=t.row;return[s("task-status-render",{attrs:{value:e.task_status}})]}},{key:"action",fn:function(e){var a=e.row;return[a.accessible?s("a",{on:{click:function(e){return t.getTaskDetailList(a)}}},[t._v("详情")]):s("a",{attrs:{disabled:""}},[t._v("安全策略不可操作")])]}}])}),s("Page",{staticClass:"right mtm",attrs:{current:t.page.start,total:t.page.return_total,"page-size":t.page.size,"show-total":"","show-elevator":""},on:{"on-change":t.changePage}})],1)},i=[],l=s("864c"),r=s("bc94"),n=s("3a9c"),o=s("312d"),c=s("c605"),d={components:{taskStatusRender:n["a"],TableFilter:c["a"]},data(){return{taskStatus:o["r"],task_id:"",task_name:"",task_status:"",task_type:"",task_sort:[["a.created_at","desc"]],page:{start:1,size:10,return_total:1},labels:[],columns:[{title:"任务编号",slot:"task_id",width:200},{title:"任务名称",slot:"task_name",minWidth:150},{title:"任务类型",key:"task_type",slot:"task_type",align:"center",minWidth:80},{title:"任务状态",slot:"task_status",align:"center",minWidth:100},{title:"未领取",key:"wait_label_num",slot:"wait_label_num",align:"right",sortable:"custom",width:100},{renderHeader:t=>t("Row",{props:{justify:"end",align:"middle"}},[t("span","未返修"),t("Tooltip",{props:{content:"任务中全部未返修的数据",transfer:!0,placement:"top",maxWidth:"300"}},[t("Icon",{props:{type:"ios-help-circle"},style:{marginLeft:"3px"}})])]),slot:"wait_relabel_num",align:"right",width:100},{title:"我的标注",align:"center",children:[{title:"待返修",slot:"user_wait_relabel_num",align:"center",width:80},{title:"标注中",slot:"user_labeling_num",align:"center",width:80},{title:"已标注",slot:"user_labeled_num",align:"center",width:80}]},{title:"标注小组",key:"team_name",minWidth:100},{title:"操作",slot:"action",align:"center",minWidth:100}],statLoading:-1}},created(){this.fetchLabels()},asyncMethods:{fetchLabels(){const t={page:{start:(this.page.start-1)*this.page.size,size:this.page.size,return_total:1}};return t.task_id=""!==this.task_id?this.task_id:void 0,t.task_name=""!==this.task_name?this.task_name:void 0,t.task_status=""!==this.task_status?Number(this.task_status):void 0,t.task_type=this.task_type?Number(this.task_type):void 0,t.sort=this.task_sort.length>0?this.task_sort:void 0,l["a"].ListLabelTasks(t).then(t=>(this.page.return_total=t.data.result.total,this.mapStatTaskProgress(t.data.result.data),t.data.result.data)).catch(t=>{this.$Message.error(t.message)})},fetchStatTaskProgress(t){const e={task_id:t,stat_object:["wait_label_num","wait_relabel_num"],stat_my_label_count:1};return Object(r["s"])(e).then(t=>t).catch(t=>{console.log(t)})}},methods:{async mapStatTaskProgress(t){for(let e=0;e<t.length;e++){this.statLoading=e;const s=await this.fetchStatTaskProgress(t[e].task_id);if(s){this.statLoading=-1;const{wait_label_num:a,wait_relabel_num:i,user_wait_relabel_num:l,user_labeling_num:r,user_labeled_num:n}=s,o={...t[e],label_stats_data:{wait_label_num:a,wait_relabel_num:i,user_wait_relabel_num:l,user_labeling_num:r,user_labeled_num:n}};this.$set(this.labels,e,o)}if("wb-tasks-label"!==this.$route.name)return}},sortSearch(t){"normal"!==t.order?this.task_sort=[["detail.pending_num",t.order]]:this.task_sort=[["a.created_at","desc"]],this.fetchLabels()},reset(){this.task_id="",this.task_name="",this.task_status="",this.task_type="",this.page.start=1,this.fetchLabels()},changePage(t){this.page.start=t,this.fetchLabels()},getTaskDetailList(t){this.$router.push("/workbench/label-tasks/"+t.task_id)}}},u=d,h=(s("9f02"),s("2be6")),_=Object(h["a"])(u,a,i,!1,null,"2985bda0",null);e["default"]=_.exports},fc3d:function(t,e,s){},fd69:function(t,e,s){"use strict";s("98f7")},fe6f:function(t,e,s){"use strict";s("54ef")},fee5:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("queue-base",{attrs:{title:"复检","task-id":t.taskId,"fetch-object":t.fetchDetail,errorData:t.errorData},on:{"try-again":t.fetchDetail}})},i=[],l=(s("f38f"),s("bc94")),r=s("bccd"),n=s("3998"),o=s("c899"),c={components:{QueueBase:n["a"]},data(){const{task_id:t,deliver_id:e}=this.$route.params;return{taskId:Object(r["BigNumber"])(t),deliverId:e,errorData:null}},created(){this.fetchDetail()},asyncMethods:{fetchDetail(){const t={task_id:this.taskId,page:{start:0,size:10,return_total:1},deliver_id:this.deliverId};return Object(l["w"])(t).then(t=>{if(0===t.data.length)return{};const[e]=t.data;this.$router.replace({name:"wb-task-review-detail",params:{task_id:this.taskId,check_id:e.check_id||0,pack_id:e.pack_key||0,dataset_id:0},query:{team_id:this.$route.query.team_id,scenes:"re_review"}})}).catch(t=>{if(console.log(t),t.code===o["a"].LimitPageError)throw this.errorData=t.extra,Error("LimitPageError");throw new Error(t.message)})}}},d=c,u=s("2be6"),h=Object(u["a"])(d,a,i,!1,null,null,null);e["default"]=h.exports}}]);